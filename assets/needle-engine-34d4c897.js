var FO=Object.defineProperty;var UO=(n,t,e)=>t in n?FO(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var c=(n,t,e)=>(UO(n,typeof t!="symbol"?t+"":t,e),e);import{V as ae,a as C,b as ke,Q as ne,B as pc,c as Ve,d as jt,C as we,D as pi,E as Ml,F as Zr,e as Oa,L as Tt,M as J,f as St,O as re,P as Oh,g as Ys,S as $e,T as pt,h as Ra,i as Qd,j as xt,k as Ws,U as $,W as Hh,l as Nn,m as fi,n as IR,o as TR,G as cx,p as ft,q as gc,r as ce,s as $r,t as Lh,u as Ue,v as Di,w as NO,x as oi,y as QO,z as fd,A as Bg,R as kn,H as zO,I as jO,J as GO,K as HO,N as VO,X as WO,Y as qO,Z as XO,_ as YO,$ as eo,a0 as On,a1 as zd,a2 as KO,a3 as JO,a4 as ZO,a5 as Fh,a6 as zu,a7 as mc,a8 as jS,a9 as $O,aa as b_,ab as RR,ac as pd,ad as hx,ae as $p,af as eg,ag as io,ah as e2,ai as ec,aj as t2,ak as i2,al as Sl,am as qf,an as Ba,ao as mr,ap as vr,aq as Io,ar as tg,as as Hs,at as n2,au as CA,av as To,aw as vt,ax as Vh,ay as ux,az as Pa,aA as JA,aB as dx,aC as GS,aD as Wt,aE as BR,aF as PR,aG as MR,aH as ZA,aI as DR,aJ as kR,aK as Ac,aL as $A,aM as __,aN as ig,aO as Wh,aP as s2,aQ as w_,aR as r2,aS as up,aT as o2,aU as wc,aV as OR,aW as hn,aX as a2,aY as l2,aZ as Ct,a_ as jd,a$ as _s,b0 as Xi,b1 as gm,b2 as yf,b3 as LR,b4 as c2,b5 as h2,b6 as Rs,b7 as fx,b8 as u2,b9 as d2,ba as FR,bb as UR,bc as ev,bd as px,be as f2,bf as NR,bg as p2,bh as Ms,bi as QR,bj as x_,bk as zR,bl as ay,bm as jR,bn as GR,bo as HR,bp as VR,bq as g2,br as m2,bs as Lc,bt as Do,bu as A2,bv as v2,bw as WR,bx as qR,by as ju,bz as ng,bA as In,bB as y2,bC as b2,bD as sg,bE as _2,bF as w2,bG as C_,bH as gx,bI as pu,bJ as gu,bK as HS,bL as x2,bM as C2,bN as S_,bO as S2,bP as XR,bQ as tv,bR as YR,bS as E2,bT as KR,bU as I2,bV as T2,bW as R2,bX as B2,bY as P2,bZ as M2,b_ as D2,b$ as k2,c0 as O2,c1 as L2,c2 as F2,c3 as U2,c4 as N2,c5 as Q2,c6 as z2,c7 as VS,c8 as j2,c9 as JR,ca as G2,cb as WS,cc as ZR,cd as H2,ce as V2,cf as E_,cg as $R,ch as I_,ci as W2,cj as ly,ck as gd,cl as eB,cm as cy,cn as tB,co as q2,cp as X2,cq as Y2,cr as Ss,cs as K2,ct as J2,cu as Z2,cv as $2,cw as eL}from"./three.module-8eacf7c9.js";import{_ as hy}from"./index-596547b4.js";let iB,qS=null;function La(){return iB}function nB(n){if(n==null){console.warn("Oh no: someone tried registering a non-existend gltf-loader. When you see this log it might mean that needle-engine is being imported multiple times. Please check your project setup.");return}qS!==n&&(qS=n,iB=new n)}const O0=new Map;function qs(n=(t=>(t=globalThis.location)==null?void 0:t.hostname)()){if(O0.has(n))return O0.get(n);const e=/(\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})|localhost/.test(n);return O0.set(n,e),e===!0}function tL(){return window.location.hostname.includes("glitch.me")}var yt;(function(n){n.ContextRegistered="ContextRegistered",n.ContextCreationStart="ContextCreationStart",n.ContextCreated="ContextCreated",n.ContextFirstFrameRendered="ContextFirstFrameRendered",n.ContextDestroying="ContextDestroying",n.ContextDestroyed="ContextDestroyed",n.MissingCamera="MissingCamera",n.ContextClearing="ContextClearing",n.ContextCleared="ContextCleared"})(yt||(yt={}));class mt{static get Current(){return globalThis["NeedleEngine.Context.Current"]}static set Current(t){globalThis["NeedleEngine.Context.Current"]=t}static get All(){return this.Registered}static register(t){this.Registered.push(t),this.dispatchCallback(yt.ContextRegistered,t)}static unregister(t){const e=this.Registered.indexOf(t);e!==-1&&this.Registered.splice(e,1)}static registerCallback(t,e){this._callbacks[t]||(this._callbacks[t]=[]),this._callbacks[t].push(e)}static unregisterCallback(t,e){if(!this._callbacks[t])return;const i=this._callbacks[t].indexOf(e);i!==-1&&this._callbacks[t].splice(i,1)}static dispatchCallback(t,e,i){if(!this._callbacks[t])return!0;const s={event:t,context:e};if(i)for(const o in i)s[o]=i[o];const r=new Array;return this._callbacks[t].forEach(o=>{const a=o(s);a instanceof Promise&&r.push(a)}),Promise.all(r)}static addContextCreatedCallback(t){this.registerCallback(yt.ContextCreated,t)}static addContextDestroyedCallback(t){this.registerCallback(yt.ContextDestroyed,t)}}c(mt,"Registered",[]),c(mt,"_callbacks",{});const iL=()=>n=>n;function aq(n){return iL()(n)}function lq(){return!!N("debug")}class ko{constructor(t,e){c(this,"_factory");c(this,"_cache",[]);c(this,"_maxSize");c(this,"_index",0);this._factory=t,this._maxSize=e}get(){const t=this._index%this._maxSize;return this._index++,this._cache.length<=t&&(this._cache[t]=this._factory()),this._cache[t]}}let oh=!1;const T_=new Array;typeof window<"u"&&setTimeout(()=>{if(oh){const n={},t=new URL(window.location.href),e=new URL(t);e.searchParams.append("console","");const i=e.toString().replace(/=$|=(?=&)/g,"");for(const r of T_){const o=new URL(t);o.searchParams.append(r,""),n[r]=o.toString().replace(/=$|=(?=&)/g,"")}console.log(`ðŸŒµ ?help: Debug Options for Needle Engine.
Append any of these parameters to the URL to enable specific debug options.
Example: ${i} will show an onscreen console window.`);const s=oh===!0?"":` (containing "${oh}")`;console.group("Available URL parameters:"+s);for(const r in n)typeof oh=="string"&&!r.toLowerCase().includes(oh.toLowerCase())||(console.groupCollapsed(r),console.log("Reload with this flag enabled:"),console.log(n[r]),console.groupEnd());console.groupEnd()}},100);function uy(){var n;return new URLSearchParams((n=globalThis.location)==null?void 0:n.search)}function N(n){oh&&!T_.includes(n)&&T_.push(n);const t=uy();if(t.has(n)){const e=t.get(n);if(e){const i=Number(e);return isNaN(i)?e:i}else return!0}return!1}oh=N("help");function cq(n,t){const e=uy();e.has(n)?e.set(n,t):e.append(n,t),document.location.search=e.toString()}function R_(n,t,e=!0){const i=uy();i.has(n)?t===null?i.delete(n):i.set(n,t):t!==null&&i.append(n,t),e?nL(n,i):sB(n,i)}function XS(n,t,e){n.has(t)?n.set(t,e.toString()):n.append(t,e.toString())}function nL(n,t,e){window.history.pushState(e,n,"?"+t.toString())}function sB(n,t,e){window.history.replaceState(e,n,"?"+t.toString())}function hq(n){for(var t="",e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",i=e.length,s=0;s<n;s++)t+=e.charAt(Math.floor(Math.random()*i));return t}function uq(n,t){return Math.floor(Math.random()*(t-n+1))+n}const YS=["smol","tiny","giant","interesting","smart","bright","dull","extreme","beautiful","pretty","dark","epic","salty","silly","funny","lame","lazy","loud","lucky","mad","mean","mighty","mysterious","nasty","odd","old","powerful","quiet","rapid","scary","shiny","shy","silly","smooth","sour","spicy","stupid","sweet","tasty","terrible","ugly","unusual","vast","wet","wild","witty","wrong","zany","zealous","zippy","zombie","zorro"],KS=["cat","dog","mouse","pig","cow","horse","sheep","chicken","duck","goat","panda","tiger","lion","elephant","monkey","bird","fish","snake","frog","turtle","hamster","penguin","kangaroo","whale","dolphin","crocodile","snail","ant","bee","beetle","butterfly","dragon","eagle","fish","giraffe","lizard","panda","penguin","rabbit","snake","spider","tiger","zebra"];function rB(){const n=YS[Math.floor(Math.random()*YS.length)],t=KS[Math.floor(Math.random()*KS.length)];return n+"_"+t}function sL(n){return n=n.replace(/[^a-z0-9Ã¡Ã©Ã­Ã³ÃºÃ±Ã¼ \.,_-]/gim,""),n.trim()}function rg(n,t,e=!0,i=!1){var s;if(t==null)return null;if(t.userData&&t.userData.guid===n)return t;if(t.guid==n)return t;if(i&&(s=t.userData)!=null&&s.components){for(const r of t.userData.components)if(r.guid===n)return r}if(e){if(t.scenes)for(const r in t.scenes){const o=t.scenes[r],a=rg(n,o,e,i);if(a)return a}if(t.children)for(const r in t.children){const o=t.children[r],a=rg(n,o,e,i);if(a)return a}}}function dy(n,t){if(n!=null&&typeof n=="object"){let e;Array.isArray(n)?e=[]:(e=Object.create(n),Object.assign(e,n));for(const i of Object.keys(n)){const s=n[i];t&&!t(n,i,s)?e[i]=s:(s==null?void 0:s.clone)!==void 0&&typeof s.clone=="function"?e[i]=s.clone():e[i]=dy(s,t)}return e}return n}function El(n){return new Promise((t,e)=>{setTimeout(t,n)})}function rL(n,t){if(n<=0)return Promise.resolve();if(t||(t=mt.Current),!t)return Promise.reject("No context");const e=t.time.frameCount+n;return new Promise((i,s)=>{if(!t)return s("No context");const r=()=>{t.time.frameCount>=e&&(t.pre_update_callbacks.splice(t.pre_update_callbacks.indexOf(r),1),i())};t.pre_update_callbacks.push(r)})}const mm=N("debugresolveurl"),oL="rel:";function dq(n,t){return qh(n,t)}function qh(n,t){if(t===void 0)return mm&&console.warn("getPath: uri is undefined, returning uri",t),t;if(t.startsWith("./"))return t;if(t.startsWith("http"))return mm&&console.warn("getPath: uri is absolute, returning uri",t),t;if(n===void 0)return mm&&console.warn("getPath: source is undefined, returning uri",t),t;t.startsWith(oL)&&(t=t.substring(4));const e=n.lastIndexOf("/");if(e>=0){const i=n.substring(0,e+1);for(;i.endsWith("/")&&t.startsWith("/");)t=t.substring(1);const s=i+t;return mm&&console.log("source:",n,`changed uri 
from`,t,`
to `,s,`
basePath: `+i),s}return t}class aL{constructor(t,e){c(this,"writeCallbacks",[]);c(this,"_applied",!1);c(this,"_object");c(this,"_prop");c(this,"_wrapperProp");this._object=t,this._prop=e,this._wrapperProp=Symbol("$"+e),this.apply()}subscribeWrite(t){this.writeCallbacks.push(t)}unsubscribeWrite(t){const e=this.writeCallbacks.indexOf(t);e!==-1&&this.writeCallbacks.splice(e,1)}apply(){if(this._applied||!this._object)return;const t=this._object,e=this._prop;if(t[e]===void 0)return;this._applied=!0,t[this._wrapperProp]!==void 0&&console.warn("Watcher is being applied to an object that already has a wrapper property. This is not (yet) supported");const i=t[e];t[this._wrapperProp]=i,Object.defineProperty(t,e,{get:()=>t[this._wrapperProp],set:o=>{t[this._wrapperProp]=o;for(const a of this.writeCallbacks)a(o,this._prop)}})}revoke(){if(!this._applied||!this._object)return;this._applied=!1;const t=this._object,e=this._prop;Reflect.deleteProperty(t,e);const i=t[this._wrapperProp];t[e]=i,Reflect.deleteProperty(t,this._wrapperProp)}dispose(){this.revoke(),this.writeCallbacks.length=0,this._object=null}}class xc{constructor(t,e){c(this,"_watches",[]);if(Array.isArray(e))for(const i of e)this._watches.push(new xc(t,i));else this._watches.push(new aL(t,e))}subscribeWrite(t){for(const e of this._watches)e.subscribeWrite(t)}unsubscribeWrite(t){for(const e of this._watches)e.unsubscribeWrite(t)}apply(){for(const t of this._watches)t.apply()}revoke(){for(const t of this._watches)t.revoke()}dispose(){for(const t of this._watches)t.dispose();this._watches.length=0}}const Mu=Symbol("needle:watches");function mx(n,t){if(!n[Mu])if(n instanceof ae)n[Mu]=new xc(n,["x","y"]);else if(n instanceof C)n[Mu]=new xc(n,["x","y","z"]);else if(n instanceof ke||n instanceof ne)n[Mu]=new xc(n,["x","y","z","w"]);else return!1;return n[Mu].subscribeWrite(t),!0}function oB(n,t){if(!n)return;const e=n[Mu];e&&e.unsubscribeWrite(t)}function Id(){const n=window.navigator.userAgent,t=/Windows|MacOS|Mac OS/.test(n),e=/Windows NT/.test(n)&&/Edg/.test(n)&&!/Win64/.test(n);return t&&!e&&!Td()}let Am;function No(){return Am!==void 0||(Am=/iPhone|iPad|iPod|Android|IEMobile/i.test(navigator.userAgent)),Am}function lL(){return/Android/.test(navigator.userAgent)}function md(){return/WebXRViewer\//i.test(navigator.userAgent)}const cL=["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"];function Td(){return cL.includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}function dp(){return/^((?!chrome|android).)*safari/i.test(navigator.userAgent)}function Ax(){return navigator.userAgent.includes("OculusBrowser")}async function JS(){try{return(await navigator.permissions.query({name:"microphone"})).state!=="denied"}catch(n){return console.error("Error querying `microphone` permissions.",n),!1}}const hL=/ip=(?<ip>.+?)\n/s;async function fq(){const t=await(await fetch("https://www.cloudflare.com/cdn-cgi/trace")).text(),e=hL.exec(t);return e?e[1]:null}async function pq(){return(await(await fetch("https://api.db-ip.com/v2/free/self")).json()).ipAddress}async function gq(){return await(await fetch("https://api.db-ip.com/v2/free/self").catch(()=>null)).json()}const vc=new WeakMap;function uL(n,t,e){if(!vc.get(n)){const s=new MutationObserver(r=>{fL(n,r)});vc.set(n,{observer:s,attributeChangedListeners:new Map}),s.observe(n,{attributes:!0})}const i=vc.get(n).attributeChangedListeners;i.has(t)||i.set(t,[]),i.get(t).push(e)}function dL(n,t,e){if(!vc.get(n))return;const i=vc.get(n).attributeChangedListeners;if(!i.has(t))return;const s=i.get(t),r=s.indexOf(e);if(r!==-1&&(s.splice(r,1),s.length<=0)){i.delete(t);const o=vc.get(n);o==null||o.observer.disconnect(),vc.delete(n)}}function fL(n,t){const e=vc.get(n).attributeChangedListeners;for(const i of t)if(i.type==="attributes"){const s=i.attributeName,r=n.getAttribute(s);if(e.has(s))for(const o of e.get(s))o(r)}}class ZS{constructor(t){c(this,"reason");this.reason=t}}async function vx(n){const t=await Promise.allSettled(n).catch(s=>[new ZS(s.message)]);let e=!1;const i=t.map(s=>"value"in s?s.value:(e=!0,new ZS(s.reason)));return{anyFailed:e,results:i}}async function pL(n){if(!globalThis.QRCode){const i="https://cdn.rawgit.com/davidshimjs/qrcodejs/gh-pages/qrcode.min.js";let s=document.head.querySelector(`script[src="${i}"]`);s||(s=document.createElement("script"),s.src=i,document.head.appendChild(s)),await new Promise((r,o)=>{s.addEventListener("load",()=>{r(!0)})})}const t=globalThis.QRCode,e=n.domElement??document.createElement("div");return new t(e,{width:n.width??256,height:n.height??256,colorDark:"#000000",colorLight:"#ffffff",correctLevel:t.CorrectLevel.M,...n}),e}const aB=N("debugdebug");let og=!1;(N("noerrors")||N("nooverlaymessages"))&&(og=!0);const L0="needle_engine_global_error_container";var Ui;(function(n){n[n.Log=0]="Log",n[n.Warn=1]="Warn",n[n.Error=2]="Error"})(Ui||(Ui={}));function yx(){return hB}const B_=new Array;function gL(n){B_.push(n)}let F0=!1;function mL(...n){if(!F0){F0=!0;try{for(let t=0;t<B_.length;t++)B_[t](...n)}catch(t){console.error(t)}F0=!1}}const lB=console.error,cB=function(...n){lB.apply(console,n),yL(n),xa(Ui.Error,n),P_(...n)};function AL(n){og=!n,n?console.error=cB:console.error=lB}function mq(n){return AL(n)}function vL(){og||(aB&&console.warn("Patch console",window.location.hostname),console.error=cB,window.addEventListener("error",n=>{if(!n)return;const t=n.error;if(t===void 0){qs()&&console.warn("Received unknown error",n,n.target);return}xa(Ui.Error,t,n.filename,n.lineno),P_(n)},!0),window.addEventListener("unhandledrejection",n=>{og||n&&(n.reason?xa(Ui.Error,n.reason.message,n.reason.stack):xa(Ui.Error,"unhandled rejection"),P_(n))}))}let hB=0;function P_(...n){hB+=1,mL(...n)}function yL(n){if(Array.isArray(n))for(let t=0;t<n.length;t++){const e=n[t];typeof e=="string"&&e.startsWith("THREE.PropertyBinding: Trying to update node for track:")&&(n[t]="Some animated objects couldn't be found: see console for details")}}function xa(n,t,e,i){if(og)return;const s=mt.Current,r=(s==null?void 0:s.domElement)??document.querySelector("needle-engine");if(r){if(Array.isArray(t)){let o="";for(let a=0;a<t.length;a++){let l=t[a];l instanceof Error&&(l=l.message),typeof l!="object"&&(a>0&&(o+=" "),o+=l)}t=o}!t||t.length<=0||bL(n,r,t)}}const fp=new Map;function bL(n,t,e){if(e==null)return;const i=wL(t);if(i.childElementCount>=20){const a=i.lastElementChild;$S(a)}e.length>400&&(e=e.substring(0,400)+"...");const s=e;if(fp.has(s))return;const r=xL(n,e);i.prepend(r);const o=()=>{fp.delete(s),$S(r)};fp.set(s,o),setTimeout(o,1e4)}function Aq(){aB&&console.log("Clearing messages");for(const n of fp.values())n==null||n.call(n);fp.clear()}const _L=`

@import url('https://fonts.googleapis.com/css2?family=Roboto+Flex:opsz,wght@8..144,100..1000&display=swap');

div[data-needle_engine_debug_overlay] {
    font-family: 'Roboto Flex', sans-serif;
    font-weight: 400;
}

div[data-needle_engine_debug_overlay] strong {
    font-weight: 700;
}

div[data-needle_engine_debug_overlay] a {
    color: white;
    text-decoration: none;
    border-bottom: 1px solid rgba(255, 255, 255, 0.3);
}

div[data-needle_engine_debug_overlay] a:hover {
    text-decoration: none;
    border: none;
}

div[data-needle_engine_debug_overlay] .log strong {
    color: rgba(200,200,200,.9);
}

div[data-needle_engine_debug_overlay] .warn strong {
    color: rgba(255,255,230, 1);
}

div[data-needle_engine_debug_overlay] .error strong {
    color: rgba(255,100,120, 1);
}
`;function wL(n){globalThis[L0]||(globalThis[L0]=new Map);const t=globalThis[L0];if(t.has(n))return t.get(n);{const e=document.createElement("div");t.set(n,e),e.setAttribute("data-needle_engine_debug_overlay",""),e.classList.add("debug-container"),e.style.cssText=`
            position: absolute;
            top: 0;
            right: 5px;
            padding-top: 0px;
            max-width: 70%;
            max-height: calc(100% - 5px);
            z-index: 9999999999;
            pointer-events: scroll;
            display: flex;
            align-items: end;
            flex-direction: column;
            color: white;
            overflow: auto;
            word-break: break-word;
        `,n.shadowRoot?n.shadowRoot.appendChild(e):n.appendChild(e);const i=document.createElement("style");return i.innerHTML=_L,e.appendChild(i),e}}const uB=Symbol("logtype"),iv=new Map;function $S(n){n.remove();const t=n[uB],e=iv.get(t)??[];e.push(n),iv.set(t,e)}function xL(n,t){if(iv.has(n)){const i=iv.get(n);if(i.length>0){const s=i.pop();return s.innerHTML=t,s}}const e=document.createElement("div");switch(e.setAttribute("data-id","__needle_engine_debug_overlay"),e.style.marginRight="5px",e.style.padding=".5em",e.style.backgroundColor="rgba(0,0,0,.9)",e.style.marginTop="5px",e.style.marginBottom="3px",e.style.borderRadius="8px",e.style.pointerEvents="all",e.style.userSelect="text",e.style.maxWidth="250px",e.style.whiteSpace="pre-wrap",e.style["backdrop-filter"]="blur(10px)",e.style["-webkit-backdrop-filter"]="blur(10px)",e.style.backgroundColor="rgba(20,20,20,.8)",e.style.boxShadow="inset 0 0 80px rgba(0,0,0,.2), 0 0 5px rgba(0,0,0,.2)",e.style.border="1px solid rgba(160,160,160,.2)",e[uB]=n,n){case Ui.Log:e.classList.add("log"),e.style.color="rgba(200,200,200,.7)",e.style.backgroundColor="rgba(40,40,40,.7)";break;case Ui.Warn:e.classList.add("warn"),e.style.color="rgb(255, 255, 150)",e.style.backgroundColor="rgba(50,50,20,.8)";break;case Ui.Error:e.classList.add("error"),e.style.color="rgb(255, 50, 50",e.style.backgroundColor="rgba(50,20,20,.8)";break}return e.title="Open the browser console (F12) for more information",e.innerHTML=t,e}let fr=null,cr=null,Ca=null,U0=!1,eE=null;const dB="terminal",Xf=N("console"),CL=N("noerrors")||N("noconsole");Xf&&fB();if(!CL&&(Xf||qs())){if(qs()&&!Xf){const t=new URL(window.location.href);t.searchParams.set("console","1"),console.log('ðŸŒµ Tip: You can add the "?console" query parameter to the url to show the debug console (on mobile it will automatically open in the bottom right corner when your get errors during development. In VR a spatial console will appear.)',`
Open this page to get the console: `+t.toString())}const n=No()||Ax()&&xe();if((n||Xf)&&(vL(),pB(),gB(!0),n)){const t=document.querySelector("needle-engine");t==null||t.addEventListener("enter-ar",()=>{(Xf||fr||yx()>0)&&N("noerrors")}),t==null||t.addEventListener("exit-ar",()=>{RL()})}}const M_=Symbol("consoleParent");function fB(){if(fr!==null){fr.showSwitch();return}gB()}function SL(){fr!==null&&(fr.hide(),fr.hideSwitch())}function pB(){eE||(eE=setInterval(EL,500))}let tE=0;function EL(){const n=yx(),t=n!==tE;tE=n,t&&IL()}function IL(){fB(),Ca&&(Ca.setAttribute("error","true"),Ca.innerText="ðŸ¤¬")}function TL(){Ca&&(Ca.removeAttribute("error"),Ca.innerText=dB)}function RL(){cr&&cr[M_]&&cr[M_].appendChild(cr)}function gB(n=!1){if(fr||U0)return;U0=!0;const t=document.createElement("script");t.onload=()=>{U0=!1,pB(),fr=new VConsole({pluginOrder:["default","needle-console"]});const e=globalThis["needle:codegen_files"];if(e&&e.length>0&&fr.addPlugin(BL()),cr=ML(),cr&&(cr[M_]=cr.parentElement,cr.style.position="absolute",cr.style.zIndex=Number.MAX_SAFE_INTEGER.toString()),fr.setSwitchPosition(20,30),Ca=PL(),Ca){Ca.innerText=dB,Ca.addEventListener("click",TL);const i=document.createElement("style"),s=40;i.innerHTML=`
                #__vconsole .vc-switch {
                    border: 1px solid rgba(255, 255, 255, .1);
                    border-radius: 50%;
                    width: ${s}px;
                    height: ${s}px;
                    padding: 0;
                    line-height: ${s}px;
                    font-size: ${s*.4}px;
                    text-align: center;
                    background: #ffffff5c;
                    backdrop-filter: blur(16px);
                    -webkit-backdrop-filter: blur(16px);
                    user-select: none;
                    pointer-events: auto;
                    transition: transform .2s ease-in-out;
                    box-shadow: 0px 7px 0.5rem 0px rgb(0 0 0 / 6%), inset 0px 0px 1.3rem rgba(0,0,0,.05);

                    font-family: 'Material Symbols Outlined';
                    color: black;
                    font-size: 2.3em;
                    font-weight: 100;
                }
                #__vconsole .vc-switch:hover {
                    cursor: pointer;
                    transform: scale(1.1);
                    transition: transform .1s ease-in-out, background .1s linear;
                    background: rgba(245, 245, 245, .8);
                    outline: rgba(0, 0, 0, .05) 1px solid;
                }
                #__vconsole .vc-switch[error] {
                    background: rgba(255,0,0,.2);
                    animation: vconsole-notify 1s ease-in-out;
                    line-height: 35px;
                }
                @keyframes vconsole-notify {
                    from {
                        transform: scale(1, 1);
                    }
                    10% {
                        transform: scale(1.3, 1.3);
                    }
                    70% {
                        transform: scale(1.4, 1.4);
                    }
                    to {
                        transform: scale(1, 1);
                    }
                }
                #__vconsole .vc-panel {
                    font-family: monospace;
                    font-size: 11px;
                }
                #__vconsole .vc-plugin-box.vc-actived {
                    height: 100%;
                }
                #__vconsole .vc-mask {
                    overflow: hidden;
                }
            `,cr==null||cr.prepend(i),n===!0&&yx()<=0&&SL(),console.log("ðŸŒµ Debug console has loaded")}},t.src="https://unpkg.com/vconsole@latest/dist/vconsole.min.js",document.body.appendChild(t)}function BL(){const n=new VConsole.VConsolePlugin("needle-console","ðŸŒµ Inspect glTF"),t=()=>document.querySelector("#__vc_plug_"+n._id+" iframe");return n.on("renderTab",function(e){const i=globalThis["needle:codegen_files"];if(!i||i.length===0)return;let s=globalThis["needle:codegen_files"][0];const r=s.indexOf("?");r>-1&&(s=s.substring(0,r));const a=location.protocol+"//"+location.host+location.pathname+"/"+s,l=encodeURIComponent(a);n.fullUrl="https://viewer.needle.tools?inspect&file="+l;var h='<iframe src="" style="width: 100%; height: 99%; border: none;"></iframe>';e(h)}),n.on("show",function(){const e=t();e&&e.src!==n.fullUrl&&(e.src=n.fullUrl)}),n.on("hide",function(){const e=t();e&&(e.src="")}),n.on("addTopBar",function(e){var i=new Array;i.push({name:"Open in new window â†—",onClick:function(s){window.open(n.fullUrl,"_blank"),fr==null||fr.hide()}}),i.push({name:"Reload",onClick:function(s){const r=t();r&&(r.src=n.fullUrl)}}),i.push({name:"Fullscreen",onClick:function(s){const r=t();r.requestFullscreen?r.requestFullscreen():r.webkitRequestFullscreen instanceof Function&&r.webkitRequestFullscreen()}}),e(i)}),n}function PL(){const n=document.querySelector("#__vconsole .vc-switch");return n||null}function ML(){const n=document.querySelector("#__vconsole");return n||null}var Ro={};Ro.d=(n,t)=>{for(var e in t)Ro.o(t,e)&&!Ro.o(n,e)&&Object.defineProperty(n,e,{enumerable:!0,get:t[e]})};Ro.o=(n,t)=>Object.prototype.hasOwnProperty.call(n,t);Ro.r=n=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})};var Ni={};Ro.d(Ni,{ti:()=>Mt,nS:()=>eP,eB:()=>cg,Yp:()=>bx,VB:()=>Uh,BC:()=>Pg,zN:()=>Xh,cV:()=>Bd,hW:()=>ug,k2:()=>yB,K6:()=>zr,M7:()=>_x,ls:()=>Mg,Hi:()=>LB,EY:()=>hg,MR:()=>TB,zf:()=>vB,Ay:()=>q3,yo:()=>tP});var bx={};Ro.r(bx);Ro.d(bx,{get:()=>mB,set:()=>DL});var _x={};Ro.r(_x);Ro.d(_x,{alphaTestTransformer:()=>py,asPreprocessorValueTransformer:()=>RB,toPreprocessorTriggerTransformer:()=>Mx,toUserDataTransformer:()=>HF,uniformOrUserDataTransformer:()=>Ur});const D_={fontFamily:null,fontSize:.05,fontKerning:"auto",fontStyle:"normal",fontWeight:"normal",offset:.005,lineHeight:1.2,lineBreak:`- ,.:?!
`,whiteSpace:"pre-line",flexDirection:"column",justifyContent:"start",alignItems:"start",backgroundImage:null,textAlign:"left",boxSizing:"content-box",position:"static",color:16777215,fontColor:16777215,fontOpacity:1,opacity:1,fontPXRange:4,fontSupersampling:!0,fontSmooth:"antialiased",borderRadius:0,borderWidth:0,borderColor:"black",borderOpacity:1,backgroundSize:"cover",backgroundColor:0,backgroundOpacity:0,overflow:"visible",letterSpacing:0,invertAlpha:!1,segments:1},DL=function(n){for(const t in n)D_[t]=n[t]},mB=function(n){return Object.prototype.hasOwnProperty.call(D_,n)||console.warn(`ThreeMeshUI::DefaultValues is trying to retrieve non-existing property '${n}'`),D_[n]};class Mt{constructor(t,e=null,i=!0){this._id=t,this._value=e,this._needsUpdate=!0,this._needsProcess=!1,this._needsRender=!1,this._isPrimitive=i}get id(){return this._id}get value(){return this._value}set value(t){this.isValid(t)&&this._value!==t&&(this._value=t,this._needsUpdate=!0)}update(t,e){this.output(e)}output(t){}_outputValue(t){t[this._id]=this._value}process(t){}render(t){}getInheritedInput(t){if(this._value!=="inherit")return this._value;const e=t._parent._value;return e&&e[`_${this._id}`]?e[`_${this._id}`].getInheritedInput(e):this.getDefaultValue()}getDefaultValue(){return mB(this._id)}isValid(t){return!0}emptyStrategyLogic(){throw new Error(`ThreeMeshUI::${this.constructor.name} has empty strategy. Update has not been processed.`)}requestUpdate(){this._needsUpdate=!0}requestProcess(){this._needsProcess=!1}requestRender(){this._needsRender=!1}}class kL extends Mt{constructor(){super("renderOrder","auto",!0),this.output=this._outputValue,this._actualValue=0}set value(t){this.isValid(t)&&(this._value=t,this._needsUpdate=!0)}update(t,e){if(this._value!=="auto")this._actualValue=this._value;else{const i=t._parent._value;if(i!==null){const s=i._renderOrder._actualValue,r=1+i._children._uis.indexOf(t);this._actualValue=s+r}}for(const i of t._children._uis)i._renderOrder._value==="auto"&&(i._renderOrder._needsUpdate=!0);this._outputValue(e)}_outputValue(t){t[this._id]=this._actualValue}get value(){return this._value}}class Xh extends Mt{constructor(t,e=null,i=!0){super(t,e,i),this.output=this._outputValue,this._notInheritedValue=null}update(t,e){this._notInheritedValue=this._value,this._notInheritedValue==="inherit"&&(this._notInheritedValue=this.getInheritedInput(t)),this.propagate(t),this._outputValue(e)}propagate(t){for(const e of t._children._uis){const i=e[`_${this._id}`];i!==void 0&&i._value==="inherit"&&(e[`_${this._id}`]._needsUpdate=!0)}}_outputValue(t){t[this._id]=this._notInheritedValue}set value(t){this.isValid(t)&&this._value!==t&&(this._value=t,this._needsUpdate=!0)}get value(){return this._value==="inherit"?this._notInheritedValue:this._value}}class OL extends Xh{constructor(){super("offset","inherit",!1)}update(t,e){super.update(t,e),t._parent._value!==null&&(t.position.z=this._notInheritedValue)}}class LL extends Xh{constructor(){super("fontSmooth","inherit",!0),this._needsUpdate=!1,this.isValid=UL,this.output=this._outputValue}}const FL=["inherit","none","antialiased"];function UL(n){return FL.indexOf(n)===-1?(console.warn(`.fontSmoothing value '${n}' is not valid. Aborted`),!1):!0}var NL=n=>{var t={};return Ro.d(t,n),t};const fe=NL({BackSide:()=>pc,BufferAttribute:()=>Ve,BufferGeometry:()=>jt,Color:()=>we,DoubleSide:()=>pi,EventDispatcher:()=>Ml,FileLoader:()=>Zr,FrontSide:()=>Oa,LinearFilter:()=>Tt,Mesh:()=>J,MeshBasicMaterial:()=>St,Object3D:()=>re,Plane:()=>Oh,PlaneGeometry:()=>Ys,ShaderMaterial:()=>$e,Texture:()=>pt,TextureLoader:()=>Ra,Vector2:()=>ae,Vector3:()=>C,Vector4:()=>ke});class hi extends Mt{constructor(t,e,i=!0){super(t,"unset",i),this._input="inherit",this._allowsInherit=!0,this._inheritedInput=void 0,this._inline=void 0}update(t,e){this._allowsInherit||(this._inheritedInput=this.getInheritedInput(t)),this.computeOutputValue(t);for(const i of t._children._uis){const s=i[`_${this._id}`];(s._input?s._input:s._value)==="inherit"&&(i[`_${this._id}`]._needsUpdate=!0)}this.output(e)}computeOutputValue(t){this._value=this._input}_computeFromInherited(t){this._value=this._inheritedInput}set value(t){console.warn(".(style) sub-property cannot be directly set. It must comes from inline or computed setter.")}set inline(t){this.isValidValue(t)&&t!==this._inline&&(this._input=this._inline=t,this._needsUpdate=!0)}get inline(){return this._inline}isValidValue(t){return!0}getInheritedInput(t){if(this._input!=="inherit")return this._input;const e=t._parent._value;return e?e[`_${this._id}`].getInheritedInput(e):this.getDefaultValue()}}class fy extends hi{constructor(t,e){super(t,e,!1),this._input=new fe.Vector4(0,0,0,0),this._inline=null,this._value=new fe.Vector4(0,0,0,0)}get value(){return this._value}computeOutputValue(t){this._vector4ValueSetter(this._value,this._input)}set inline(t){this._vector4ValueSetter(this._input,t),!this._input.equals(this._value)&&(this._needsUpdate=!0)}set top(t){this._input.x!==t&&(this._input.x=t,this._needsUpdate=!0)}get top(){return this._input.x}set right(t){this._input.y!==t&&(this._input.y=t,this._needsUpdate=!0)}get right(){return this._input.y}set bottom(t){this._input.z!==t&&(this._input.z=t,this._needsUpdate=!0)}get bottom(){return this._input.z}set left(t){this._input.w!==t&&(this._input.w=t,this._needsUpdate=!0)}get left(){return this._input.w}dispose(){this._computed=null,this._inline=null,this._input=null,this._output=null}_vector4ValueSetter(t,e){if(e instanceof fe.Vector4){t.copy(e);return}if((typeof e=="string"||e instanceof String)&&(e=e.split(" ")),Array.isArray(e))switch(e=e.map(i=>parseFloat(i)),e.length){case 1:t.setScalar(e[0]);return;case 2:t.x=t.z=e[0],t.y=t.w=e[1];return;case 3:t.x=e[0],t.y=e[1],t.z=e[2];return;case 4:t.x=e[0],t.y=e[1],t.z=e[2],t.w=e[3];return;default:console.error("StyleVector4Property::set() Four Dimension property had more than four values");return}isNaN(e)||t.setScalar(e)}}class QL extends fy{constructor(){super("padding",new fe.Vector4(0,0,0,0))}computeOutputValue(t){super.computeOutputValue(t),t._bounds._needsUpdate=!0,t._bounds._needsRender=!0,t._layouter._needsProcess=!0,t._renderer._needsRender=!0,t._parent._value&&(t._parent._value._layouter._needsProcess=!0)}}class zL extends fy{constructor(){super("margin",new fe.Vector4(0,0,0,0))}computeOutputValue(t){super.computeOutputValue(t),t._renderer._needsRender=!0,t._parent._value&&(t._parent._value._flexDirection._needsProcess=!0)}}const iE=function(n,t,e){n[t]=e},jL=function(n,t,e){e!==null&&(n[t]=e)};class vm{constructor(t){this._definition=t}set definition(t){this._definition=t}mediate(t,e,i,s=null){for(const r in this._definition){const o=this._definition[r];if(i[r]!==void 0){const a=o.t?o.t:iE;a(e,o.m,i[r]),s&&a(s,o.m,i[r])}}}static mediate(t,e,i,s,r=null){if(e)for(const o in s){const a=s[o];if(i[o]!==void 0){const l=a.t?a.t:iE;l(e,a.m,i[o]),r&&l(r,a.m,i[o])}}}}class GL extends Mt{constructor(){super("parent",null,!1)}update(t,e){t.parent&&t.parent.isUI?this._value=t.parent:this._value=null}set value(t){console.warn("ParentProperty is readonly")}get value(){return this._value}find(t){return this._value?t(this._value)?this._value:this._value._parent.find(t):null}dispose(){this._value=null}}const k_=function(n,t,e=6){return n.toFixed(e)===t.toFixed(e)};class nE extends Mt{constructor(t,e){super(t,e,!0),this.output=this._outputValue}set value(t){this.isValid(t)&&(k_(this._value,t)||(this._value=t,this._needsUpdate=!0))}get value(){return this._value}}class sE extends Xh{constructor(t){super(t,"inherit",!0),this.isValid=VL}}const HL=[fe.FrontSide,fe.BackSide,fe.DoubleSide];function VL(n){return HL.indexOf(n)===-1?(console.warn(`SideProperty value '${n}' is not valid. Abort`),!1):!0}class AB{constructor(){this._offsetX=0,this._offsetY=0,this._lineBreak=null,this._kerning=0,this._fontFactor=1,this._fontSize=0,this._cumulativeWidth=0,this._paddingLeft=0,this._paddingRight=0,this._marginLeft=0,this._marginRight=0}resetOffsets(){this._offsetX=this._offsetY=0,this._cumulativeWidth=0}get xadvance(){return 0}get xoffset(){return 0}get yoffset(){return 0}get width(){return 0}get height(){return 0}set lineBreak(t){this._lineBreak=t}get lineBreak(){return this._lineBreak}get anchor(){return 0}get kerning(){return this._kerning*this._fontFactor}set kerning(t){this._kerning=t}get fontSize(){return this._fontSize}set fontSize(t){this._fontSize=t}get lineHeight(){return 0}get offsetX(){return this._offsetX}set offsetX(t){this._offsetX=t}get offsetY(){return this._offsetY}set offsetY(t){this._offsetY=t}get cumulativeWidth(){return this._cumulativeWidth}set cumulativeWidth(t){this._cumulativeWidth=t}get marginLeft(){return this._marginLeft}set marginLeft(t){this._marginLeft=t}get marginRight(){return this._marginRight}set marginRight(t){this._marginRight=t}get paddingLeft(){return this._paddingLeft}set paddingLeft(t){this._paddingLeft=t}get paddingRight(){return this._paddingRight}set paddingRight(t){this._paddingRight=t}get lineBase(){return 0}set fontFactor(t){this._fontFactor=t}get fontFactor(){return this._fontFactor}}class vB{constructor(t){this._char="",this._width=1,this._heigth=1,this._xadvance=1,this._xoffset=0,this._yoffset=0,this._font=t}get font(){return this._font}get char(){return this._char}get width(){return this._width}get height(){return this._heigth}get xadvance(){return this._xadvance}get xoffset(){return this._xoffset}get yoffset(){return this._yoffset}set yoffset(t){this._yoffset=t}clone(t){throw new Error("Abstract... Need to be implemented")}asInlineGlyph(){throw new Error("Abstract... Need to be implemented")}}class yB extends AB{constructor(t){super(),this._typographic=t}get typographic(){return this._typographic}get xadvance(){return this._typographic.xadvance*this._fontFactor}get xoffset(){return this._typographic.xoffset*this._fontFactor}get yoffset(){return this._typographic.yoffset*this._fontFactor}get width(){return this._typographic.width*this._fontFactor}get height(){return this._typographic.height*this._fontFactor}get char(){return this._typographic.char}get anchor(){return this.yoffset}get lineHeight(){return this._typographic.font.lineHeight*this._fontFactor}get lineBase(){return this._typographic.font.lineBase*this._fontFactor}}const WL={light:"100",normal:"400",bold:"700",bolder:"900"};function wx(n){if(!isNaN(n))return n.toString();const t=WL[n];return t||n}class qL extends fe.EventDispatcher{constructor(t,e){super(),this._isReady=!1,this._weight=wx(t),this._style=e,this._size=42,this._lineHeight=42,this._lineBase=42,this._font=null}get typographic(){return this._font}get isReady(){return this._isReady}get weight(){return this._weight}get style(){return this._style}get texture(){return this._texture}set fontMaterial(t){throw Error(`FontVariant('${this.id}')::fontMaterial - is abstract.`)}get fontMaterial(){throw Error(`FontVariant('${this.id}')::fontMaterial - is abstract.`)}get id(){return`${this._name}(w:${this.weight},s:${this.style})`}getTypographicGlyph(t){let e=this._chars[t];if(e)return e;if(t.match(/\s/))return this._chars[" "];const i=this._getFallbackCharacter(t);if(i&&(e=this._chars[i],e))return e;throw Error(`FontVariant('${this.id}')::getTypographicGlyph() - character('${t}') and/or fallback character were not found in provided msdf charset.`)}_getFallbackCharacter(t){throw new Error(`FontVariant(${typeof this})::_getFallbackCharacter() is abstract and should therefore be overridden.`)}getGeometricGlyph(t,e){throw new Error(`FontVariant(${typeof this})::getGeometryCharacter() is abstract and should therefore be overridden.`)}getKerningAmount(t){return this._kernings[t]?this._kernings[t]:0}adjustTypographicGlyphs(t){for(const e in t){const i=this.getTypographicGlyph(e),s=t[e];for(const r in s)i["_"+r]=t[e][r]}}_checkReadiness(){this._readyCondition()&&YL(this)}_alterElementProperties(t){throw new Error(`FontVariant(${typeof this})::_alterElementProperties() is abstract and should therefore be overridden.`)}_readyCondition(){throw new Error(`FontVariant(${typeof this})::_readyCondition() is abstract and should therefore be overridden.`)}}const XL={type:"ready"};function YL(n){n._isReady=!0,n.dispatchEvent(XL)}const Pg=qL;class KL extends Mt{constructor(t=null){super("font",t,!1),this._needsUpdate=!1,this._fontVariant=null,this._handleFontReadyClosure=null,this.isValid=JL}output(t){t[this._id]=this._fontVariant}update(t,e){if(this._fontVariant&&!this._fontVariant.isReady&&this._fontVariant.removeEventListener("ready",this._handleFontReadyClosure),this._value&&this._value instanceof Pg)this._fontVariant=this._value;else{const i=t._fontFamily._value;i&&(this._fontVariant=i.getVariant(t._fontWeight._value,t._fontStyle._value))}this._fontVariant&&(this._fontVariant._alterElementProperties(t),this._handleFontReadyClosure=ZL(t,this),this._fontVariant.isReady?this._handleFontReadyClosure():this._fontVariant.addEventListener("ready",this._handleFontReadyClosure),(!t._fontMaterial._defaultMaterial||!(t._fontMaterial._defaultMaterial instanceof this._fontVariant.fontMaterial))&&(t._fontMaterial._defaultMaterial=new this._fontVariant.fontMaterial,t._fontMaterial._needsUpdate=!0))}set value(t){this.isValid(t)&&this._value!==t&&(this._value=t,this._needsUpdate=!0)}get value(){return this._value}get fontVariant(){return this._fontVariant}dispose(){this._handleFontReadyClosure&&(this._fontVariant.removeEventListener("ready",this._handleFontReadyClosure),this._handleFontReadyClosure=null),this._value=null,this._fontVariant=null}}function JL(n){return n instanceof Pg?!0:(console.warn(`.font value '${n}' is not valid. It requires a FontVariant instance. Aborted`),!1)}function ZL(n,t){return function(){t._needsUpdate=!0,n._glyphs._needsProcess=!0,t._fontVariant.removeEventListener("ready",t._handleFontReadyClosure),t._handleFontReadyClosure=null}}class $L extends hi{constructor(t){super("display",t),this._value="flex",this._allowsInherit=!1,this._needsUpdate=!1,this.isValidValue=tF}computeOutputValue(t){t._visible._value=this._output!=="none"}}const eF=["none","flex"];function tF(n){return eF.indexOf(n)===-1?(console.warn(`(.style) display value '${n}' is not valid. Aborted`),!1):!0}class iF extends hi{constructor(t){super("boxSizing",t),this._allowsInherit=!1,this.isValidValue=sF}computeOutputValue(t){this._value=this._inheritedInput,t._bounds._needsUpdate=!0}}const nF=["border-box","content-box"];function sF(n){return nF.indexOf(n)===-1?(console.warn(`(.style) boxSizing value '${n}' is not valid. Aborted`),!1):!0}class ag extends hi{constructor(t,e){super(t,e,!1),this._value=new fe.Color,this.output=this._outputValue}computeOutputValue(t){this._input!=="inherit"&&this._value.set(this._input)}set inline(t){this._input=this._inline=t,this._needsUpdate=!0}}class N0 extends hi{constructor(t,e){super(t,e,!0),this.isValidValue=rF,this._allowsInherit=!1,this._input=e,this._value=e,this.output=this._outputValue,this.computeOutputValue=this._computeFromInherited}_outputValue(t){t[this._id]=this._inheritedInput}}function rF(n){return n<0&&n>1?(console.warn(`(.style) styleFactorProperty('${this.id}') value '${n}' is not valid)`),!1):!0}class oF extends hi{constructor(t){super("backgroundImage",t,!0),this._input=null,this._allowsInherit=!1,this._textureSize=new fe.Vector2(1,1),this.isValidValue=aF}get value(){return this._value}output(t){t[this._id]=this._value,t.tSize=this._textureSize}computeOutputValue(t){if(this._value=this._inheritedInput,this._value instanceof fe.Texture&&!this._value.image){console.warn("ThreeMeshUI - .backgroundImage :: Please provide preloaded texture in order to have accurate sizing.");return}this._needsProcess=!0}process(t){this._value?this._textureSize.set(this._value.image.width,this._value.image.height):this._textureSize.set(1,1)}}function aF(n){return!0}class lF extends hi{constructor(t){super("backgroundSize",t,!0),this.isValidValue=hF,this.output=this._outputValue}}const cF=["cover","contain","stretch"];function hF(n){return cF.indexOf(n)===-1?(console.warn(`(.style) backgroundSize value '${n}' is not valid. Aborted`),!1):!0}class uF extends hi{constructor(t){super("overflow",t,!0),this.isValidValue=fF,this._clippingPlanes=null,this._renderStrategy=this._emptyRender}update(t,e){this._inline!==void 0&&this._inline!=="unset"?this._input=this._inline:this._computed!==void 0&&(this._input=this._computed),this._allowsInherit||(this._inheritedInput=this.getInheritedInput(t)),this.computeOutputValue(t);for(const i of t._children._uis)i._overflow._needsUpdate=!0;this.output(e)}output(t){t.clippingPlanes=this._clippingPlanes}computeOutputValue(t){super.computeOutputValue(t),this._value==="hidden"?this._renderStrategy=this._propagateRender:(this._renderStrategy=this._emptyRender,this._clippingPlanes=null);const e=t._parent._value;if(e!==null){const i=e._overflow;if((i._value==="hidden"||i._clippingPlanes!==null)&&!this._clippingPlanes){this._clippingPlanes=[new fe.Plane(new fe.Vector3(0,-1,0),1),new fe.Plane(new fe.Vector3(-1,0,0),1),new fe.Plane(new fe.Vector3(0,1,0),1),new fe.Plane(new fe.Vector3(1,0,0),1)];for(let s=0;s<this._clippingPlanes.length;s++)this._clippingPlanes[s].parent=e;i._clippingPlanes!==null&&this._clippingPlanes.push(...i._clippingPlanes),this._renderStrategy=this._hiddenRender,this._needsRender=!0}else(i._value==="visible"||i._clippingPlanes===null)&&this._clippingPlanes!==null&&(this._clippingPlanes=null,this._renderStrategy=this._emptyRender,this._needsRender=!0)}}render(t){this._renderStrategy(t)}_emptyRender(t){}_hiddenRender(t){const e=t._parent._value,i=e._bounds._offsetHeight,s=e._bounds._offsetWidth,r=e._padding._value,o=e._borderWidth._value;for(let a=0;a<4&&a<this._clippingPlanes.length;a++){const l=this._clippingPlanes[a];switch(a%4){case 0:l.constant=i/2-(r.x+o.x);break;case 1:l.constant=s/2-(r.y+o.y);break;case 2:l.constant=i/2-(r.z+o.z);break;case 3:l.constant=s/2-(r.w+o.w);break}l.applyMatrix4(e.matrixWorld)}for(let a=0;a<t._children._uis.length;a++){const l=t._children._uis[a];l._overflow._needsRender=!0}}_propagateRender(t){for(let e=0;e<t._children._uis.length;e++){const i=t._children._uis[e];i._overflow._needsRender=!0}}}const dF=["visible","hidden"];function fF(n){return dF.indexOf(n)===-1?(console.warn(`(.style) overflow value '${n}' is not valid. Aborted`),!1):!0}const Rd="rem",bB="em",nv="%",pF=[Rd,bB,nv],_B=function(n){return pF.indexOf(n)===-1?Rd:n};class gF extends fy{constructor(t){super("borderRadius",t),this._valueUV=this._value.clone(),this._input=new fe.Vector4(0,0,0,0),this._mediation=!0,this._cornerTL=new fe.Vector2(0,1),this._cornerTR=new fe.Vector2(1,1),this._cornerBR=new fe.Vector2(1,0),this._cornerBL=new fe.Vector2(0,0);const e=new ym(this._valueUV,["x","y"]),i=new ym(this._valueUV,["z","w"]),s=new ym(this._valueUV,["x","w"]),r=new ym(this._valueUV,["y","z"]);e.complementaryMediation=i,i.complementaryMediation=e,s.complementaryMediation=r,r.complementaryMediation=s,this._sideMediators=[e,i,s,r],this._units=Rd}set units(t){this._units=_B(t),this._needsProcess=!0}get units(){return this._units}set mediation(t){t!==this._mediation&&(this._mediation=t,this._needsUpdate=!0)}get mediation(){return this._mediation}output(t){t.cornerTL=this._cornerTL,t.cornerTR=this._cornerTR,t.cornerBR=this._cornerBR,t.cornerBL=this._cornerBL}computeOutputValue(t){this._vector4ValueSetter(this._value,this._input),this._needsProcess=!0}process(t){this._needsRender=!0}render(t){this._valueUV.copy(this._value);const e=t._bounds._offsetWidth,i=t._bounds._offsetHeight;if(this._units===nv&&this._valueUV.divideScalar(100),this._units===Rd&&this._valueUV.divideScalar(Math.min(e,i)),this._mediation)do this._sideMediators.forEach(o=>o.computeValue()),this._sideMediators.sort((o,a)=>o.value<a.value?1:-1),this._sideMediators[0].value>1&&this._sideMediators[0].mediate();while(this._sideMediators[0].value>1);let s=e>i?i/e:1,r=e<i?e/i:1;this._units===nv&&(s=r=1),this._cornerTL.x=this._valueUV.x*s,this._cornerTL.y=1-this._valueUV.x*r,this._cornerTR.x=1-this._valueUV.y*s,this._cornerTR.y=1-this._valueUV.y*r,this._cornerBR.x=1-this._valueUV.z*s,this._cornerBR.y=this._valueUV.z*r,this._cornerBL.x=this._valueUV.w*s,this._cornerBL.y=this._valueUV.w*r}dispose(){for(const t of this._sideMediators)t.dispose();this._sideMediators=null,this._cornerTL=null,this._cornerTR=null,this._cornerBR=null,this._cornerBL=null,super.dispose()}set topLeft(t){this._input.x!==t&&(this._input.x=t,this._needsUpdate=!0)}get topLeft(){return this._input.x}set topRight(t){this._input.y!==t&&(this._input.y=t,this._needsUpdate=!0)}get topRight(){return this._input.y}set bottomRight(t){this._input.z!==t&&(this._input.z=t,this._needsUpdate=!0)}get bottomRight(){return this._input.z}set bottomLeft(t){this._input.w!==t&&(this._input.w=t,this._needsUpdate=!0)}get bottomLeft(){return this._input.w}set top(t){this._input.x===t&&this._input.y===t||(this._input.x=this._input.y=t,this._needsUpdate=!0)}get top(){return(this._input.x+this._input.y)/2}set right(t){this._input.y===t&&this._input.z===t||(this._input.y=this._input.z=t,this._needsUpdate=!0)}get right(){return(this._input.y+this._input.z)/2}set bottom(t){this._input.z===t&&this._input.w===t||(this._input.z=this._input.w=t,this._needsUpdate=!0)}get bottom(){return(this._input.z+this._input.w)/2}set left(t){this._input.w===t&&this._input.x===t||(this._input.w=this._input.x=t,this._needsUpdate=!0)}get left(){return(this._input.w+this._input.x)/2}}class ym{constructor(t,e){this._borderRadiuses=t,this._sideProperties=e,this._complementaryMediation=null,this._value=0}get value(){return this._value}set complementaryMediation(t){this._complementaryMediation=t}computeValue(){let t=0;for(const e of this._sideProperties)t+=this._borderRadiuses[e];this._value=t}mediate(t=!0){if(!(this._value<1)){for(const e of this._sideProperties)this._borderRadiuses[e]/=this._value;t&&this._complementaryMediation.mediate(!1)}}dispose(){this._complementaryMediation=null,this._borderRadiuses=null}}class mF extends fy{constructor(t){super("borderWidth",t,!1),this._valueUV=this._value.clone(),this.output=this._outputValue,this._units=Rd}set units(t){this._units=_B(t),this._needsUpdate=!0}get units(){return this._units}computeOutputValue(t){this._vector4ValueSetter(this._value,this._input),this._needsProcess=!0,t._bounds._needsUpdate=!0,t._layouter._needsUpdate=!0}_outputValue(t){t[this._id]=this._valueUV}process(t){this._needsRender=!0,t._borderRadius._needsRender=!0}render(t){this._valueUV.copy(this._value);const e=t._bounds._offsetWidth,i=t._bounds._offsetHeight;if(this._units===nv&&(console.log("Percent"),console.log(this._valueUV)),this._units===Rd)e!==0&&(this._valueUV.w/=e,this._valueUV.y/=e),i!==0&&(this._valueUV.x/=i,this._valueUV.z/=i);else if(this._units===bB){if(e!==0){const s=e>i?i/e:1;this._valueUV.y*=s,this._valueUV.w*=s}if(i!==0){const s=e<i?e/i:1;this._valueUV.x*=s,this._valueUV.z*=s}}}}class AF extends Mt{constructor(t,e=!0){super("visible",e,!0),this._needsUpdate=!1}update(t,e){t.visible=this._value,t._parent._value&&(t._parent._value._children._needsUpdate=!0)}set value(t){this.isValid(t)&&this._value!==t&&(this._value=t,this._needsUpdate=!0)}get value(){return this._value}}class wB extends ag{constructor(t){super("backgroundColor",t,!1),this._input="transparent",this._allowsInherit=!1}computeOutputValue(t){t._backgroundMesh.visible=!(this._input==="none"||this._input==="transparent"),this._input==="inherit"?this._value.set(this.getInheritedInput(t)):this._input==="transparent"||this._input==="none"||this._value.set(this._input)}}class Za extends Mt{constructor(t="untitled"){super(t,void 0,!1)}update(t,e){}output(t){}}class vF extends Mt{constructor(){super("inlineJustificator",null,!1),this._value=null}update(t,e){}process(t){const e=t._bounds._innerHeight,i=t._layouter._value,s=Math.abs(i.height);let r=(()=>{switch(t._alignItems._value){case"inherit":case"start":return e/2;case"end":return s-e/2;case"stretch":case"center":return s/2}})();const o=t._padding._value,a=t._borderWidth._value;r+=(-o.x+o.z)/2+(-a.x+a.z)/2,i.forEach(l=>{l.y+=r,l.forEach(h=>{h.offsetY+=r})})}}const yF=["start","center","end","stretch"],bF=function(n){return yF.indexOf(n)===-1?(console.warn(`(.style) alignItems value '${n}' is not valid. Aborted`),!1):!0};class xx extends hi{constructor(){super("alignItems","inherit",!0),this.isValidValue=bF}}class Cx extends hi{constructor(){super("textAlign","inherit",!0),this.isValidValue=wF}}const _F=["left","right","center","justify","justify-left","justify-right","justify-center"],wF=function(n){return _F.indexOf(n)===-1?(console.warn(`(.style) textAlign value '${n}' is not valid. Aborted`),!1):!0};class Sx extends hi{constructor(){super("flexDirection","inherit",!0),this.isValid=CF}}const xF=["row","row-reverse","column","column-reverse"];function CF(n){return xF.indexOf(n)===-1?(console.warn(`(.style) flexDirection value '${n}' is not valid. Aborted`),!1):!0}class Ex extends hi{constructor(){super("justifyContent","inherit",!0),this.isValidValue=EF}}const SF=["start","center","end","space-between","space-around","space-evenly"];function EF(n){return SF.indexOf(n)===-1?(console.warn(`(.style) justifyContent value '${n}' is not valid. Aborted`),!1):!0}class IF extends hi{constructor(){super("order",0,!0),this._value=0,this._input=0,this._allowsInherit=!1}computeOutputValue(t){this._value=this._inheritedInput,t._parent._value&&(t._parent._value._children._needsProcess=!0)}}class xB extends hi{constructor(){super("position","static",!0),this._allowsInherit=!1,this._value="static",this._needsUpdate=!1,this.computeOutputValue=this._computeFromInherited,this.isValidValue=RF}_computeFromInherited(t){super._computeFromInherited(t),t._parent._value&&(t._parent._value._children._needsProcess=!0)}}const TF=["static","absolute"];function RF(n){return TF.indexOf(n)===-1?(console.warn(`(.style) position value '${n}' is not valid. Aborted`),!1):!0}class CB extends hi{constructor(t,e=null){super(t,e,!0),this._input="auto",this._auto=!0,this._relative=!1,this._updateRequired=!0}set inline(t){this.isValidValue(t)&&t!==this._inline&&(this._inline=t,this._input!==this._inline&&this._parseInput())}get inline(){return this._inline}_parseInput(){let t=!0;if(this._inline!==void 0&&this._inline!=="unset"?this._input=this._inline:this._computed!==void 0?(this._computed===this._input&&(t=!1),this._input=this._computed):t=this._input==="inherit",t){if(this._auto=!this._input||this._input==="auto",this._auto)this._relative=!1;else if((typeof this._input=="string"||this._input instanceof String)&&this._input.endsWith("%")){this._relative=!0,this._value=0;const e=parseFloat(this._input.replace("%","").trim());isNaN(e)||(this._value=e/100)}else this._relative=!1,this._value=this._input;this._needsUpdate=this._updateRequired=t}}update(t,e){if(this._updateRequired){this._updateRequired=!1,this._allowsInherit||(this._inheritedInput=this.getInheritedInput(t)),this.computeOutputValue(t);for(const i of t._children._uis)i[`_${this._id}`]._needsUpdate=!0;this.output(e),t._parent._value&&(t._parent._value._layouter._needsProcess=!0)}}computeOutputValue(t){t._bounds._needsUpdate=!0,t._renderer._needsRender=!0}getInheritedInput(t){if(this._input!=="inherit"&&!this._auto)return this._input;const e=t._parent._value;return e?e[`_${this._id}`].getInheritedInput(e):this.getDefaultValue()}getDefaultValue(){return 0}get value(){return this._value}}class BF extends CB{constructor(){super("width")}}class PF extends CB{constructor(){super("height")}computeOutputValue(t){super.computeOutputValue(t)}}class SB extends Za{constructor(){super("textContent"),this._needsUpdate=!1}set value(t){}process(t){let e="";for(let i=0;i<t.children.length;i++){const s=t.children[i];s.isUI&&(e+=s.textContent)}this._value=e}}class EB extends hi{constructor(t){super("fontStyle",t,!0),this.isValidValue=DF}}const MF=["normal","italic"];function DF(n){return MF.indexOf(n)===-1?(console.warn(`(.style) fontStyle value '${n}' is not valid. Aborted`),!1):!0}class IB extends hi{constructor(){super("fontWeight","inherit",!0),this.isValid=OF}}const kF=["100","200","300","400","500","600","700","800","900","light","normal","bold","bolder"];function OF(n){return kF.indexOf(n.toString())===-1?(console.warn(`(.style) fontWeight value '${n}' is not valid. Aborted`),!1):!0}class TB{constructor(){this._size=42,this._lineHeight=42,this._lineBase=38,this._name="-",this._charset=""}get size(){return this._size}get lineHeight(){return this._lineHeight}get lineBase(){return this._lineBase}get name(){return this._name}get charset(){return this._charset}}class LF extends TB{constructor(t){super(),this._size=t.info.size,this._lineHeight=t.common.lineHeight,this._lineBase=t.common.base,this._name=t.info.face,this._textureWidth=t.common.scaleW,this._textureHeight=t.common.scaleH,this._charset=t.chars.map(e=>e.char).join("")}get textureWidth(){return this._textureWidth}get textureHeight(){return this._textureHeight}}class FF extends yB{constructor(t){super(t)}get uv(){return this.typographic.uv}}class sv extends vB{constructor(t,e){super(t),this._char=e.char,this._width=e.width,this._heigth=e.height,this._xadvance=e.xadvance?e.xadvance:this._width,this._xoffset=e.xoffset?e.xoffset:0,this._yoffset=e.yoffset?e.yoffset:0,this._uv=e.uv?e.uv:null,isNaN(e.x)||(this._uv={left:e.x/t.textureWidth,right:(e.x+e.width)/t.textureWidth,top:1-(e.y+e.height)/t.textureHeight,bottom:1-e.y/t.textureHeight})}get uv(){return this._uv}clone(t){return new sv(this._font,{char:t,width:this._width,height:this._heigth,xadvance:this._xadvance,xoffset:this._xoffset,yoffset:this._yoffset,uv:null})}asInlineGlyph(){return new FF(this)}}class UF extends fe.PlaneGeometry{constructor(t,e){let i=1,s=1;const r=t.typographic.font.size,o=e._segments.value;i=Math.ceil(t.typographic.width/r*o),s=Math.ceil(t.typographic.height/r*o),super(t.width,t.height,i,s),t.uv?(this._mapUVs(t),this._transformGeometry(t)):(this._nullifyUVs(),this.scale(0,0,1),this.translate(0,t.fontSize/2,0)),this.name="GlyphGeometry"}_mapUVs(t){const e=t.uv.right-t.uv.left,i=t.uv.bottom-t.uv.top,s=this.getAttribute("uv").array.slice(),r=[];for(let o=0;o<s.length;o+=2){const a=s[o],l=s[o+1];r.push(t.uv.left+e*a),r.push(t.uv.top+i*l)}this.setAttribute("uvG",new fe.BufferAttribute(new Float32Array(r),2))}_nullifyUVs(){const t=[],e=this.getAttribute("uv").array.length;for(let i=0;i<e;i++)t.push(0);this.setAttribute("uvG",new fe.BufferAttribute(new Float32Array(t),2))}_transformGeometry(t){this.translate(t.width/2,-t.height/2,0)}}const NF=`
attribute vec2 uvG;
varying vec2 vUvG;
`,Ix=NF,QF=`
vUvG = uvG;
`,Tx=QF,zF=`
gl_Position.z -= 0.00001;
`,Rx=zF,jF=`
varying vec2 vUvG;
uniform sampler2D glyphMap;
uniform vec2 unitRange;
// functions from the original msdf repo:
// https://github.com/Chlumsky/msdfgen#using-a-multi-channel-distance-field
float median(float r, float g, float b) {
	return max(min(r, g), min(max(r, g), b));
}
float screenPxRange() {

	// precomputed unitRange as recommended by Chlumsky
	// vec2 unitRange = vec2(pxRange)/vec2(textureSize(glyphMap, 0));
	vec2 screenTexSize = vec2(1.0)/fwidth(vUvG);
	return max(0.5*dot(unitRange, screenTexSize), 1.0);
}
float tap(vec2 offsetUV) {
	vec3 msd = texture( glyphMap, offsetUV ).rgb;
	float sd = median(msd.r, msd.g, msd.b);
	float screenPxDistance = screenPxRange() * (sd - 0.5);
	float alpha = clamp(screenPxDistance + 0.5, 0.0, 1.0);
	return alpha;
}
`,Bx=jF,GF=`
	float alpha;
#ifdef NO_RGSS

	alpha = tap( vUvG );

#else

	// shader-based supersampling based on https://bgolus.medium.com/sharper-mipmapping-using-shader-based-supersampling-ed7aadb47bec
	// per pixel partial derivatives
	vec2 dx = dFdx(vUvG);
	vec2 dy = dFdy(vUvG);
	// rotated grid uv offsets
	vec2 uvOffsets = vec2(0.125, 0.375);
	vec2 offsetUV = vec2(0.0, 0.0);
	// supersampled using 2x2 rotated grid
	alpha = 0.0;
	offsetUV.xy = vUvG + uvOffsets.x * dx + uvOffsets.y * dy;
	alpha += tap(offsetUV);
	offsetUV.xy = vUvG - uvOffsets.x * dx - uvOffsets.y * dy;
	alpha += tap(offsetUV);
	offsetUV.xy = vUvG + uvOffsets.y * dx - uvOffsets.x * dy;
	alpha += tap(offsetUV);
	offsetUV.xy = vUvG - uvOffsets.y * dx + uvOffsets.x * dy;
	alpha += tap(offsetUV);
	alpha *= 0.25;

#endif

	alpha = clamp( alpha, 0.0, 1.0 );

#ifdef INVERT_ALPHA

	alpha = 1.0 - alpha;

#endif

	diffuseColor.a *= alpha;
`,Px=GF,py=function(n,t,e){n.alphaTest=e,Mx(n,"USE_ALPHATEST",e>0)},Mx=function(n,t,e){n.defines&&(e?n.defines[t]===void 0&&(n.defines[t]="",n.needsUpdate=!0):n.defines[t]!==void 0&&(delete n.defines[t],n.needsUpdate=!0))},RB=function(n,t,e){n.defines[t]&&n.defines[t]===e||(n.defines[t]=e,n.needsUpdate=!0)},Ur=function(n,t,e){n.userData[t]?n.userData[t].value=e:n.uniforms[t].value=e},HF=function(n,t,e){n.userData[t].value=e};class zr{static ensureMaterialOptions(t){t.transparent=!0,t.alphaTest=t.alphaTest||.02}static ensureDefines(t){t.defines||(t.defines={})}static ensureUserData(t,e){t.userData.glyphMap={value:e.glyphMap},t.userData.unitRange={value:new fe.Vector2}}static bindUniformsWithUserData(t,e){t.uniforms.glyphMap=e.userData.glyphMap,t.uniforms.unitRange=e.userData.unitRange}static injectShaderChunks(t){zr.injectVertexShaderChunks(t),zr.injectFragmentShaderChunks(t)}static injectVertexShaderChunks(t){t.vertexShader=t.vertexShader.replace("#include <uv_pars_vertex>",`#include <uv_pars_vertex>
`+Ix),t.vertexShader=t.vertexShader.replace("#include <uv_vertex>",`#include <uv_vertex>
`+Tx),t.vertexShader=t.vertexShader.replace("#include <project_vertex>",`#include <project_vertex>
`+Rx)}static injectFragmentShaderChunks(t){t.fragmentShader=t.fragmentShader.replace("#include <uv_pars_fragment>",`#include <uv_pars_fragment>
`+Bx),t.fragmentShader=t.fragmentShader.replace("#include <alphamap_fragment>",`#include <alphamap_fragment>
`+Px)}static from(t){return class extends t{constructor(i={}){zr.ensureMaterialOptions(i);super(i);c(this,"_cumulativeOnBeforeCompile",i=>{zr.bindUniformsWithUserData(i,this),zr.injectShaderChunks(i),this._userDefinedOnBeforeCompile(i)});zr.ensureDefines(this),zr.ensureUserData(this,i),this._userDefinedOnBeforeCompile=s=>{},this._onBeforeCompile=this._cumulativeOnBeforeCompile}static get fontMaterialProperties(){return zr.mediation}set onBeforeCompile(i){this._userDefinedOnBeforeCompile=i}get onBeforeCompile(){return this._onBeforeCompile}}}static get mediation(){return qF}}const VF=function(n,t,e){const i=e?e.texture:null,s=e?e.unitRange:new fe.Vector2;if(n[t]!==void 0){n.glyphMap=i,n.unitRange=s;return}n.userData&&n.userData.glyphMap&&(n.userData.glyphMap.value=i,n.userData.unitRange.value=s)},WF=function(n,t,e){e&&e!=="antialiased"?n.defines.NO_RGSS="":delete n.defines.NO_RGSS,n.needsUpdate=!0},qF={clippingPlanes:{m:"clippingPlanes"},fontAlphaTest:{m:"alphaTest",t:py},fontSide:{m:"side"},font:{m:"glyphMap",t:VF},color:{m:"color"},fontOpacity:{m:"opacity"},fontSmooth:{m:"NO_RGSS",t:WF},invertAlpha:{m:"INVERT_ALPHA",t:Mx}},XF=`
${Ix}
#include <clipping_planes_pars_vertex>
void main() {
	${Tx}
	#include <begin_vertex>
	#include <project_vertex>
	${Rx}
	#include <clipping_planes_vertex>
}
`,YF=`
uniform vec3 diffuse;
uniform float opacity;
${Bx}
#include <alphatest_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	// instead of <color_fragment> : vec4 diffuseColor
	vec4 diffuseColor = vec4( diffuse, opacity );
	${Px}
	#include <alphatest_fragment>
	// instead of <output_fragment>
	gl_FragColor = diffuseColor;
	#include <clipping_planes_fragment>
}
`,KF=.02;class Dx extends fe.ShaderMaterial{static get mediation(){return zr.mediation}constructor(t={}){super({uniforms:{glyphMap:{value:null},diffuse:{value:null},opacity:{value:1},unitRange:{value:new fe.Vector2(0,0)},alphaTest:{value:KF}},transparent:!0,clipping:!0,vertexShader:XF,fragmentShader:YF,extensions:{derivatives:!0}}),this.defines.USE_ALPHATEST="",this.needsUpdate=!0,this.noRGSS=t.noRGSS||!1}get color(){return this.uniforms.diffuse.value}set color(t){this.uniforms.diffuse.value=t}set opacity(t){this.uniforms&&(this.uniforms.opacity.value=t)}get opacity(){return this.uniforms.opacity.value}get unitRange(){return this.uniforms.unitRange.value}set unitRange(t){this.uniforms.unitRange.value.copy(t)}get glyphMap(){return this.uniforms.glyphMap.value}set glyphMap(t){this.uniforms.glyphMap.value=t}get isDefault(){return this.constructor===Dx}get alphaTest(){return this.uniforms.alphaTest.value}set alphaTest(t){this.uniforms.alphaTest.value=t}}class JF extends Pg{constructor(t,e,i,s){if(super(t,e),this._unitRange=new fe.Vector2(1,1),i.pages?this._buildData(i):ZF(this,i),s instanceof fe.Texture)this._texture=s,this._buildTexture(s);else if(typeof s=="string"||s instanceof String)$F(this,s);else throw new Error(`ThreeMeshUI::MSDFVariant provided 'texture' parameter is '${typeof s}'. Only Texture and String allowed.`);this._defaultMaterialClass=Dx,this._checkReadiness()}get texture(){return this._texture}get unitRange(){return this._unitRange}set fontMaterial(t){this._defaultMaterialClass=t}get fontMaterial(){return this._defaultMaterialClass}_buildData(t){this._font=new LF(t),this._kernings=this._buildKerningPairs(t),this._chars=this._buildCharacters(t),this._chars[" "]=this._buildCharacterWhite(t),this._chars[`
`]=this._buildCharacterWhite(t,`
`,.001,1),this._chars["	"]=this._buildCharacterWhite(t,"	",4,1),this._size=t.info.size,this._lineHeight=t.common.lineHeight,this._lineBase=t.common.base,this._distanceRange=t.distanceField.distanceRange,this._unitRange=new fe.Vector2(this._distanceRange,this._distanceRange).divide(new fe.Vector2(t.common.scaleW,t.common.scaleH))}_buildTexture(t){t.generateMipmaps=!1,t.minFilter=fe.LinearFilter,t.magFilter=fe.LinearFilter,t.needsUpdate=!0}_getFallbackCharacter(t){return Uh.missingCharacter(this,t)}getGeometricGlyph(t,e){return new UF(t,e)}_readyCondition(){return this._chars&&this._texture&&this._texture.image}_buildKerningPairs(t){const e={};for(let i=0;i<t.kernings.length;i++){const s=t.kernings[i];if(s.amount===0)continue;const r=String.fromCharCode(s.first,s.second);e[r]=s.amount}return e}_buildCharacters(t){const e={};for(let i=0;i<t.chars.length;i++){const s=t.chars[i];e[s.char]=new sv(this._font,s)}return e}_buildCharacterWhite(t,e=" ",i=1,s=1){return new sv(this._font,{char:e,width:t.info.size/3*i,height:t.info.size*.7*s})}_alterElementProperties(t){}}function ZF(n,t){new fe.FileLoader().setResponseType("json").load(t,e=>{n._buildData(e),n._checkReadiness()})}function $F(n,t){n._texture=new fe.TextureLoader().load(t,e=>{n._buildTexture(e),n._checkReadiness()})}class gy extends fe.EventDispatcher{constructor(e){super();c(this,"_checkReadiness",()=>{this._variants.every(e=>e.isReady)&&tU(this)});this._name=e,this._variants=[],this._isReady=!1}get isReady(){return this._isReady}addVariant(e,i,s,r,o=!1){if(o||!this.getVariant(e,i)){this._isReady=!1;const a=new JF(e,i,s,r);this._variants.push(a),a.isReady?this._checkReadiness():a.addEventListener("ready",this._checkReadiness)}else console.warn(`FontFamily('${this._name}')::addVariant() - Variant(${e}, ${i}) already exists.`);return this}addCustomImplementationVariant(e,i=!1){return i||!this.getVariant(e.weight,e.style)?(this._isReady=!1,this._variants.push(e),e.isReady?this._checkReadiness():e.addEventListener("ready",this._checkReadiness)):console.warn(`FontFamily('${this._name}')::addCustomImplementationVariant() - Variant(${e.weight}, ${e.style}) already exists.`),this}getVariant(e,i){return e=wx(e),this._variants.find(s=>s.weight===e&&s.style===i)}get name(){return this._name}}const eU={type:"ready"};function tU(n){n._isReady=!0,n.dispatchEvent(eU)}const SA={},iU=function(n){const t=[...arguments];t.forEach(i=>{if(!(i instanceof gy))throw new Error(`FontLibrary::prepare() - One of the provided parameter is not a FontFamily. Instead ${typeof i} given.`)});const e=function(){return t.every(i=>i.isReady)};return new Promise((i,s)=>{if(e())i();else for(let r=0;r<t.length;r++){const o=t[r];o.isReady||o.addEventListener("ready",()=>{e()&&i()})}})},nU=function(n){return SA[n]&&console.error(`FontLibrary::addFontFamily - Font('${n}') is already registered`),SA[n]=new gy(n),SA[n]},sU=function(n){return SA[n]},rU=function(n){BB=n};let BB=function(n,t){return console.error(`The character '${t}' is not included in the font characters set.`)," "};function oU(n,t){return BB(n,t)}const aU={addFontFamily:nU,getFontFamily:sU,prepare:iU,setMissingCharacterHandler:rU,missingCharacter:oU},Uh=aU;class PB extends hi{constructor(){super("fontFamily","inherit",!0)}computeOutputValue(t){if(this._input instanceof gy)this._value=this._input;else if(this._input!=="inherit")if(typeof this._input=="string"){const e=Uh.getFontFamily(this._input);e?this._value=e:console.warn(`(.style) fontFamily, the font '${this._input}' is not registered. Aborted.`)}else console.warn("(.style) fontFamily requires a registered fontFamily instance, or the id of a registered fontFamily."),console.warn("If you want to set a specific font, please use .font property instead.")}get value(){return this._value}getInheritedInput(t){if(this._input!=="inherit")return this._input;const e=t._parent._value;return e?e[`_${this._id}`].getInheritedInput(e):this.getDefaultValue()}}class MB extends hi{constructor(){super("lineHeight","inherit",!0)}update(t,e){super.update(t,e),t._layouter._needsProcess=!0}}class DB extends hi{constructor(){super("whiteSpace","inherit"),this.isValidValue=cU}}const lU=["normal","nowrap","pre","pre-line","pre-wrap"];function cU(n){return lU.indexOf(n)===-1?(console.warn(`(.style) whiteSpace value '${n}' is not valid. Aborted`),!1):!0}class kB extends hi{constructor(){super("letterSpacing","inherit",!0)}}class hU extends hi{constructor(){super("fontSize","inherit",!0)}}class OB extends Mt{constructor(){super("segments",1,!1)}}class uU extends Xh{constructor(){super("invertAlpha","inherit")}}class my extends hi{constructor(){super("fontKerning","inherit"),this.isValidValue=fU}}const dU=["normal","none","inherit"];function fU(n){return dU.indexOf(n)===-1?(console.warn(`(.style) fontKerning value '${n}' is not valid. Aborted`),!1):!0}class bm extends Xh{constructor(t){super(t,"inherit",!0)}}class rE extends Xh{constructor(t){super(t,"inherit",!1),this._mediation={},this._defaultMaterial=null}update(t,e){this._notInheritedValue=this._value,this._notInheritedValue==="inherit"?this._notInheritedValue=this.getInheritedInput(t):this.propagate(t),this._notInheritedValue?this._notInheritedValue.constructor.mediation?this._mediation={...this._notInheritedValue.constructor.mediation}:this._mediation={clippingPlanes:{m:"clippingPlanes"},fontAlphaTest:{m:"alphaTest",t:py},fontSide:{m:"side"},color:{m:"color"},fontOpacity:{m:"opacity"}}:this._mediation={},t._transferToFontMaterial(),this._outputValue(e)}getInheritedInput(t){if(this._value!=="inherit")return this._value;let e=t,i=null;for(;e._parent._value;)if(e=e._parent._value,e[`_${this._id}`]._value!=="inherit"){i=e[`_${this._id}`]._value;break}return i!==null?i:this.getDefaultValue()}getDefaultValue(){return this._defaultMaterial}}const pU=function(n,t,e){n.traverse(i=>{i.renderOrder=e})};class Mg extends fe.Object3D{constructor(e,i){super();c(this,"_rebuildParentUI",()=>{this._parent._needsUpdate=!0,this.parent&&!this.parent.isUI?(rv.register(this),this.activatePseudoState("root")):(rv.remove(this),this.deactivatePseudoState("root"))});Object.defineProperties(this,{isUI:{configurable:!1,enumerable:!0,value:!0}}),this._backgroundMesh=null,this._backgroundMaterial=null,this._backgroundCustomDepthMaterial=null,this._backgroundMaterialMediation={},this._backgroundMeshMediation={backgroundCastShadow:{m:"castShadow"},backgroundReceiveShadow:{m:"receiveShadow"},renderOrder:{m:"renderOrder",t:pU}},this._fontMesh=null,this._fontMaterial=new rE("fontMaterial"),this._fontCustomDepthMaterial=new rE("fontCustomDepthMaterial"),this._fontMeshMediation={fontMaterial:{m:"material"},fontCustomDepthMaterial:{m:"customDepthMaterial",t:jL},fontCastShadow:{m:"castShadow"},fontReceiveShadow:{m:"receiveShadow"},renderOrder:{m:"renderOrder"}},this._children=e.children?new e.children:new Za("children"),this._parent=new GL,this.addEventListener("added",this._rebuildParentUI),this.addEventListener("removed",this._rebuildParentUI),this._backgroundSide=new sE("backgroundSide"),this._fontSide=new sE("fontSide"),this._backgroundAlphaTest=new nE("backgroundAlphaTest",.02),this._fontAlphaTest=new nE("fontAlphaTest",.02),this._visible=new AF("visible",!0),this._backgroundCastShadow=new bm("backgroundCastShadow"),this._fontCastShadow=new bm("fontCastShadow"),this._backgroundReceiveShadow=new bm("backgroundReceiveShadow"),this._fontReceiveShadow=new bm("fontReceiveShadow"),this._renderOrder=new kL,this._segments=e.segments?new e.segments:new OB,this._bounds=e.bounds?new e.bounds:new Za("bounds"),this._order=new IF,this._padding=new QL,this._margin=new zL,this._position=new xB,this._flexDirection=e.flexDirection?new e.flexDirection:new Sx,this._justifyContent=e.justifyContent?new e.justifyContent:new Ex,this._alignItems=e.alignItems?new e.alignItems:new xx,this._display=new $L("flex"),this._boxSizing=new iF("border-box"),this._width=new BF,this._height=new PF,this._backgroundColor=e.backgroundColor?new e.backgroundColor:new wB,this._backgroundOpacity=new N0("backgroundOpacity",.5),this._backgroundImage=new oF,this._backgroundSize=new lF("cover"),this._color=e.color?new e.color:new ag("color","inherit"),this._fontOpacity=new N0("fontOpacity","inherit"),this._whiteSpace=e.whiteSpace?new e.whiteSpace:new DB,this._fontFamily=e.fontFamily?new e.fontFamily:new PB,this._fontStyle=e.fontStyle?new e.fontStyle:new EB("normal"),this._fontWeight=e.fontWeight?new e.fontWeight:new IB,this._fontSize=e.fontSize?new e.fontSize:new hU,this._lineHeight=e.lineHeight?new e.lineHeight:new MB,this._fontKerning=e.fontKerning?new e.fontKerning:new my,this._letterSpacing=e.letterSpacing?new e.letterSpacing:new kB,this._overflow=new uF("visible"),this._borderRadius=new gF(0),this._borderWidth=new mF(0),this._borderColor=new ag("borderColor",16711935),this._borderOpacity=new N0("borderOpacity",1),this._font=new KL,this._lineBreak=e.lineBreak?new e.lineBreak:new Za("lineBreak"),this._textContent=e.textContent?new e.textContent:new SB,this._glyphs=e.glyphs?new e.glyphs:new Za("glyphs"),this._inlines=e.inlines?new e.inlines:new Za("inlines"),this._layouter=e.layouter?new e.layouter:new Za("layouter"),this._inlineJustificator=new vF,this._textAlign=e.textAlign?new e.textAlign:new Cx,this._autoSize=e.autoSize?new e.autoSize:new Za("autoSize"),this._renderer=e.renderer?new e.renderer:new Za("renderer"),this._offset=new OL,this._invertAlpha=new uU,this._fontSmooth=e.fontSmooth?new e.fontSmooth:new LL,this._components=[this._textContent,this._children,this._parent,this._autoSize,this._fontFamily,this._fontStyle,this._fontWeight,this._font,this._whiteSpace,this._glyphs,this._inlines,this._visible,this._backgroundSide,this._fontSide,this._backgroundAlphaTest,this._fontAlphaTest,this._backgroundCastShadow,this._fontCastShadow,this._backgroundReceiveShadow,this._fontReceiveShadow,this._renderOrder,this._segments,this._padding,this._margin,this._width,this._height,this._borderWidth,this._boxSizing,this._bounds,this._position,this._flexDirection,this._justifyContent,this._alignItems,this._order,this._display,this._backgroundColor,this._backgroundOpacity,this._backgroundImage,this._backgroundSize,this._fontOpacity,this._color,this._fontSize,this._lineHeight,this._fontKerning,this._letterSpacing,this._borderRadius,this._borderColor,this._borderOpacity,this._lineBreak,this._offset,this._layouter,this._inlineJustificator,this._textAlign,this._invertAlpha,this._fontSmooth,this._fontMaterial,this._fontCustomDepthMaterial,this._overflow,this._renderer],this._onAfterUpdates=[],i.backgroundSide||(i.backgroundSide=0),i&&this.set(i)}update(){const e={};for(const i of this._components)i._needsUpdate&&(i.update(this,e),i._needsUpdate=!1);this._transferToBackgroundMesh(e),this._transferToFontMesh(e),this._transferToBackgroundMaterial(e),this._transferToFontMaterial(e);for(const i of this._children._uis)i.update()}process(){for(const e of this._children._uis)e.process();for(const e of this._components)e._needsProcess&&(e.process(this),e._needsProcess=!1)}render(){for(let e=0;e<this._components.length;e++){const i=this._components[e];i._needsRender&&(i.render(this),i._needsRender=!1)}for(const e of this._children._uis)e.render()}set(e){if(e.fontTexture&&(console.warn("ThreeMeshUI::set( {fontTexture} ) is deprecated. Please use fontLibrary to register font families and variants."),e.fontFamily)){const i=e.fontFamily.pages?e.fontFamily.info.face:e.fontFamily;let s=Uh.getFontFamily(i);if(!s){const r=e.fontStyle?e.fontStyle:"normal",o=e.fontWeight?e.fontWeight:"400";s=Uh.addFontFamily(i).addVariant(o,r,e.fontFamily,e.fontTexture)}e.fontFamily=s,delete e.fontTexture}for(let i of Object.keys(e)){const s=e[i];switch(i){case"contentDirection":console.warn("ThreeMeshUI v7xx: property `contentDirection` is deprecated and has been renamed as `flexDirection`"),i="flexDirection";break;case"interLine":console.warn("ThreeMeshUI v7xx: property `interLine` is deprecated and has been renamed as `lineHeight`"),i="lineHeight";break;case"content":console.warn("ThreeMeshUI v7xx: property `content` is deprecated and has been renamed as `textContent`"),i="textContent";break;case"fontColor":console.warn("ThreeMeshUI v7xx: property `fontColor` is deprecated and has been renamed as `color`"),i="color";break;case"hiddenOverflow":console.warn("ThreeMeshUI v7xx: property `hiddenOverflow` is deprecated and has been renamed as `overflow`"),i="overflow";break;case"backgroundTexture":console.warn("ThreeMeshUI v7xx: property `backgroundTexture` is deprecated and has been renamed as `backgroundImage`"),i="backgroundImage";break;case"alignContent":console.warn("ThreeMeshUI v7xx: property `alignContent` is deprecated and has been renamed as `alignItems`"),i="alignItems";break;case"borderTopColor":case"borderBottomColor":case"borderLeftColor":case"borderRightColor":i="borderColor";break}switch(i){case"fontSmooth":case"renderOrder":case"segments":case"visible":case"offset":this[`_${i}`].value=s;break;case"flexDirection":case"justifyContent":case"alignItems":case"color":case"fontFamily":case"fontOpacity":case"fontKerning":case"fontSize":case"fontStyle":case"fontWeight":case"textAlign":case"letterSpacing":case"lineHeight":case"whiteSpace":case"breakOn":case"width":case"height":case"padding":case"margin":case"backgroundColor":case"backgroundOpacity":case"backgroundImage":case"backgroundSize":case"borderColor":case"borderOpacity":case"borderRadius":case"borderWidth":case"overflow":case"order":case"boxSizing":this[`_${i}`]&&(this[`_${i}`].inline=s);break;case"paddingTop":this._padding.top=s;break;case"paddingRight":this._padding.right=s;break;case"paddingBottom":this._padding.bottom=s;break;case"paddingLeft":this._padding.left=s;break;case"marginTop":this._margin.top=s;break;case"marginRight":this._margin.right=s;break;case"marginBottom":this._margin.bottom=s;break;case"marginLeft":this._margin.left=s;break;case"borderTopWidth":this._borderWidth.top=s;break;case"borderRightWidth":this._borderWidth.right=s;break;case"borderBottomWidth":this._borderWidth.bottom=s;break;case"borderLeftWidth":this._borderWidth.left=s;break;case"borderTopLeftRadius":this._borderRadius.topLeft=s;break;case"borderTopRightRadius":this._borderRadius.topRight=s;break;case"borderBottomRightRadius":this._borderRadius.bottomRight=s;break;case"borderBottomLeftRadius":this._borderRadius.bottomLeft=s;break;case"side":case"castShadow":case"receiveShadow":const r=i.charAt(0).toUpperCase()+i.substr(1);this[`_background${r}`].value=s,this[`_font${r}`].value=s;break;case"fontSide":case"backgroundSide":case"fontCastShadow":case"backgroundCastShadow":case"fontReceiveShadow":case"backgroundReceiveShadow":case"fontMaterial":case"fontCustomDepthMaterial":this[`_${i}`].value=s;break;default:this[`_${i}`]!==void 0?this[`_${i}`].value=s:this[i]=s}}}get(e){switch(e){case"overflow":case"width":case"height":return this[`_${e}`].inline}}_rebuildChildrenLists(){this._children._needsUpdate=!0}add(e){let i=!1;for(let s=0;s<arguments.length;s++)super.add(arguments[s]),arguments[s].isUI&&(i=!0);return i&&this._rebuildChildrenLists(),this}remove(e){for(const i of Object.keys(arguments))arguments[i].isInline&&this.update(null,!0);return super.remove(...arguments),this._rebuildChildrenLists(),this}clear(){return this.removeFromParent(),this.traverse(e=>{e.material&&e.material.dispose(),e.geometry&&e.geometry.dispose()}),super.clear(),this._backgroundMesh=null,this._backgroundMaterial=null,this._backgroundMaterialMediation=null,this._backgroundMeshMediation=null,this._children.dispose(),this._children=null,this._parent.dispose(),this._parent=null,this._backgroundSide=null,this._backgroundAlphaTest=null,this._visible=null,this._backgroundCastShadow=null,this._backgroundReceiveShadow=null,this._renderOrder=null,this._segments=null,this._bounds=null,this._boxSizing=null,this._padding=null,this._margin=null,this._position=null,this._flexDirection=null,this._justifyContent=null,this._alignItems=null,this._display=null,this._backgroundColor=null,this._backgroundOpacity=null,this._backgroundSize=null,this._fontOpacity=null,this._color=null,this._whiteSpace=null,this._fontFamily=null,this._fontStyle=null,this._fontWeight=null,this._lineHeight=null,this._fontKerning=null,this._letterSpacing=null,this._overflow=null,this._textAlign=null,this._font=null,this._lineBreak=null,this._layouter=null,this}get textContent(){return this._textContent.process(this),this._textContent._value}get backgroundMaterial(){return this._backgroundMaterial}set backgroundMaterial(e){this._backgroundMaterial=e,this._backgroundMaterialMediation={...e.constructor.mediation},this._transferToBackgroundMaterial(),this._backgroundMesh&&(this._backgroundMesh.material=this._backgroundMaterial,Ur(e,"frameSize",this._backgroundMesh.scale))}set backgroundCustomDepthMaterial(e){this._backgroundCustomDepthMaterial=e,this._transferToBackgroundMaterial(),this._backgroundMesh&&(this._backgroundMesh.customDepthMaterial=this._backgroundCustomDepthMaterial)}get backgroundCustomDepthMaterial(){return this._backgroundCustomDepthMaterial}_transferToBackgroundMaterial(e=null){if(!e){e={};for(const i of this._components)i.output(e)}vm.mediate(this,this._backgroundMaterial,e,this._backgroundMaterialMediation,this._backgroundCustomDepthMaterial)}set backgroundSide(e){this._backgroundSide.value=e,this._backgroundMaterial&&(this._backgroundMaterial.side=e)}get backgroundSide(){return this._backgroundSide.value}set backgroundAlphaTest(e){this._backgroundAlphaTest.value=e,this._backgroundMaterial&&(this._backgroundMaterial.alphaTest=e)}get backgroundAlphaTest(){return this._backgroundAlphaTest.value}get fontMaterial(){return this._fontMaterial.value}set fontMaterial(e){this._fontMaterial.value=e}set fontCustomDepthMaterial(e){this._fontCustomDepthMaterial.value=e}get fontCustomDepthMaterial(){return this._fontCustomDepthMaterial.value}_transferToFontMaterial(e=null){const i=this._fontMaterial.value;if(i){if(!e){e={};for(const s of this._components)s.output(e)}vm.mediate(this,i,e,this._fontMaterial._mediation,this._fontCustomDepthMaterial.value)}}set fontSide(e){this._fontSide.value=e}get fontSide(){return this._fontSide.value}set fontAlphaTest(e){this._fontAlphaTest.value=e}get fontAlphaTest(){return this._fontAlphaTest.value}_transferToBackgroundMesh(e=null){if(!e){e={};for(const i of this._components)i.output(e)}vm.mediate(this,this._backgroundMesh,e,this._backgroundMeshMediation)}setBackgroundMesh(e){this._backgroundMesh&&(this.remove(this._backgroundMesh),this.unbindBackgroundMeshProperties()),this._backgroundMesh=e,this._backgroundMesh&&(this.bindBackgroundMeshProperties(),this._backgroundCustomDepthMaterial&&(this._backgroundMesh.customDepthMaterial=this._backgroundCustomDepthMaterial),this._backgroundMaterial&&Ur(this._backgroundMaterial,"frameSize",this._backgroundMesh.scale),this._transferToBackgroundMesh(),this.add(this._backgroundMesh))}bindBackgroundMeshProperties(){}unbindBackgroundMeshProperties(){}activatePseudoState(e){}deactivatePseudoState(e){}togglePseudoState(e){}hasPseudoState(e){return!1}set borderRadiusMediation(e){this._borderRadius.mediation=e}set backgroundCastShadow(e){this._backgroundCastShadow&&(this._backgroundCastShadow.value=e)}get backgroundCastShadow(){return this._backgroundCastShadow}set backgroundReceiveShadow(e){this._backgroundReceiveShadow&&(this._backgroundReceiveShadow.value=e)}get backgroundReceiveShadow(){return this._backgroundReceiveShadow}set renderOrder(e){this._renderOrder&&(this._renderOrder.value=e)}get renderOrder(){return this._renderOrder.value}_transferToFontMesh(e=null){if(this._fontMesh){if(!e){e={};for(const i of this._components)i.output(e)}vm.mediate(this,this._fontMesh,e,this._fontMeshMediation)}}setFontMesh(e){this._fontMesh&&(this.remove(this._fontMesh),this._fontMesh.material&&this._fontMesh.material.dispose(),this._fontMesh.geometry&&this._fontMesh.geometry.dispose(),this._fontMesh=null,this.unbindFontMeshProperties()),this._fontMesh=e,this._fontMesh&&(this._fontMesh.raycast=()=>{},this.bindFontMeshProperties(),this._transferToFontMaterial(),this._transferToFontMesh(),this.add(this._fontMesh))}bindFontMeshProperties(){}unbindFontMeshProperties(){}set fontCastShadow(e){this._fontCastShadow&&(this._fontCastShadow.value=e)}get fontCastShadow(){return this._fontCastShadow}set fontReceiveShadow(e){this._fontReceiveShadow&&(this._fontReceiveShadow.value=e)}get fontReceiveShadow(){return this._fontReceiveShadow}set segments(e){this._segments.value=e}get segments(){return this._segments.value}set onAfterUpdate(e){console.warn("ThreeMeshUI v7xx : `onAfterUpdate()` property has been deprecated, please rely on `addAfterUpdate` instead."),this.addAfterUpdate(e)}addAfterUpdate(e){this._onAfterUpdates.push(e)}removeAfterUpdate(e){const i=this._onAfterUpdates.indexOf(e);i!==-1&&this._onAfterUpdates.splice(i,1)}performAfterUpdate(){for(let e=0;e<this._onAfterUpdates.length;e++)this._onAfterUpdates[e]()}getProperty(e){return this[`_${e}`]?this[`_${e}`]:null}appendProperty(e,i){this[`_${e}`]=i,this._components.push(i)}replaceProperty(e,i){const s=this[`_${e}`],r=this._components.indexOf(s);return this._components[r]=this[`_${e}`]=i,i.needsUpdate=!0,s}}class rv{static register(t){this.elements.includes(t)||this.elements.push(t)}static remove(t){const e=this.elements.indexOf(t);e!==-1&&this.elements.splice(e,1)}static update(){for(const t of this.elements)t.update(),t.process(),t.process(),t.render()}}rv.elements=[];const gU=`

// FrameBorder vertex pars
attribute vec2 uvB;
varying vec2 vUvB;

`,kx=gU,mU=`

	// FrameBorder vertex shader
	vUvB = uvB;

`,Ox=mU,AU=`

// borders sequences are : x:TOP, y:RIGHT, z:BOTTOM, w:LEFT
uniform vec4 borderWidth;
uniform vec3 borderColor;
uniform float borderOpacity;
uniform vec4 borderRadius;

uniform vec2 cornerTL;
uniform vec2 cornerTR;
uniform vec2 cornerBR;
uniform vec2 cornerBL;

varying vec2 vUvB;

float getEllipticFactor( vec2 uv, vec2 center, float radiusX, float radiusY )
{

		float edx = uv.x - center.x;
		float edy = uv.y - center.y;

		float ddx = (edx * edx) / (radiusX * radiusX);
		float ddy = (edy * edy) / (radiusY * radiusY);

		return ddx + ddy;

}

`,Lx=AU,vU=`

vec4 borderColor = vec4( borderColor, borderOpacity );

// This could be tweak to produce more smoothing
float mult = 1.0;

// Step 1 ----------------------------------------------
// Draw the four borders ( top - right - bottom - left )
// Without worrying about radiuses ( Straight boorders )

// Top
float topBorderUVy = 1.0 - borderWidth.x;
if( borderWidth.x > 0.0 && vUvB.y > topBorderUVy )
{

	float w = fwidth( 1.0 - vUvB.y ) * mult;
	float step = smoothstep( topBorderUVy , topBorderUVy + w , vUvB.y );
	diffuseColor = mix( diffuseColor, borderColor, step );

}

// Left
float leftBorderUVx = borderWidth.w;
if( borderWidth.w > 0.0 && vUvB.x < leftBorderUVx )
{

	float w = fwidth( vUvB.x ) * mult ;
	float step = smoothstep( leftBorderUVx , leftBorderUVx - w , vUvB.x );
	diffuseColor = mix( diffuseColor, borderColor, step );

}

// Bottom
float bottomBorderUVy = borderWidth.z;
if( borderWidth.z > 0.0 && vUvB.y < bottomBorderUVy )
{
	float w = fwidth( vUvB.y ) * mult;
	float step = smoothstep( bottomBorderUVy , bottomBorderUVy - w , vUvB.y );
	diffuseColor = mix( diffuseColor, borderColor, step );
}

// Right
float rightBorderUVx = 1.0 - borderWidth.y;
if( borderWidth.y > 0.0 && vUvB.x > rightBorderUVx )
{
	float w = fwidth( 1.0 - vUvB.x ) * mult;
	float step = smoothstep( rightBorderUVx , rightBorderUVx + w , vUvB.x );
	diffuseColor = mix( diffuseColor, borderColor, step );
}


// Step 2 ----------------------------------------------
// Process each corners ( topLeft, topRight, bottomRight, bottomLeft )
// To transparentize outside radiuses
// To draw ellipse border on the corner


// Top Left corner
if( vUvB.x < cornerTL.x && vUvB.y > cornerTL.y ) {

		// Only draw border if width is set
		if( borderWidth.w + borderWidth.x > 0.0 ){

			float borderFactor = getEllipticFactor( vUvB, cornerTL, cornerTL.x - borderWidth.w,  ( 1.0 - cornerTL.y ) - borderWidth.x );
			float step = smoothstep( 1.0, 1.0 + fwidth( borderFactor ) * mult, borderFactor );
			diffuseColor = mix( diffuseColor, borderColor, step );

		}

		// Then then radius
		float radiusFactor = getEllipticFactor( vUvB, cornerTL, cornerTL.x, 1.0 - cornerTL.y );
		float alphaStep = smoothstep( 1.0 , 1.0 + fwidth(radiusFactor) * mult , radiusFactor );
		diffuseColor.a = mix( diffuseColor.a, 0.0, alphaStep );

}
// Bottom Left
if( vUvB.x < cornerBL.x && vUvB.y < cornerBL.y ) {

		if( borderWidth.w + borderWidth.z > 0.0 ){

			float borderFactor = getEllipticFactor( vUvB, cornerBL, cornerBL.x - borderWidth.w,  cornerBL.y - borderWidth.z );
			float step = smoothstep( 1.0, 1.0 + fwidth( borderFactor ) * mult, borderFactor );
			diffuseColor = mix( diffuseColor, borderColor, step );

		}


		float radiusFactor = getEllipticFactor( vUvB, cornerBL, cornerBL.x, cornerBL.y );
		float alphaStep = smoothstep( 1.0 , 1.0 + fwidth(radiusFactor) * mult , radiusFactor );
		diffuseColor.a = mix( diffuseColor.a, 0.0, alphaStep );

}
// Top Right
if( vUvB.x > cornerTR.x && vUvB.y > cornerTR.y ) {

		if( borderWidth.y + borderWidth.x > 0.0 ){

			float borderFactor = getEllipticFactor( vUvB, cornerTR, ( 1.0 - cornerTR.x ) - borderWidth.y,  ( 1.0 - cornerTR.y ) - borderWidth.x );
			float step = smoothstep( 1.0, 1.0 + fwidth( borderFactor ) * mult, borderFactor );
			diffuseColor = mix( diffuseColor, borderColor, step );

		}

		float radiusFactor = getEllipticFactor( vUvB, cornerTR, 1.0 - cornerTR.x, 1.0 - cornerTR.y );
		float alphaStep = smoothstep( 1.0 , 1.0 + fwidth(radiusFactor) * mult , radiusFactor );
		diffuseColor.a = mix( diffuseColor.a, 0.0, alphaStep );

}
// Bottom Right
if( vUvB.x > cornerBR.x && vUvB.y < cornerBR.y ) {

		if( borderWidth.y + borderWidth.z > 0.0 ){

			float borderFactor = getEllipticFactor( vUvB, cornerBR, ( 1.0 - cornerBR.x ) - borderWidth.y,  cornerBR.y - borderWidth.z );
			float step = smoothstep( 1.0, 1.0 + fwidth( borderFactor ) * mult, borderFactor );
			diffuseColor = mix( diffuseColor, borderColor, step );

		}

		float radiusFactor = getEllipticFactor( vUvB, cornerBR, 1.0 - cornerBR.x, cornerBR.y );
		float alphaStep = smoothstep( 1.0 , 1.0 + fwidth(radiusFactor) * mult , radiusFactor );
		diffuseColor.a = mix( diffuseColor.a, 0.0, alphaStep );

}

`,Fx=vU,yU=`

// To be removed - required for both border and background
uniform vec3 frameSize;
uniform vec2 textureSize;

`,Ux=yU,bU=`

#ifdef USE_MAP

vec4 sampleTexture() {

	vec2 uv = vUv;

	// default stretch
	#if BACKGROUND_MAPPING != 0

	float textureRatio = textureSize.x / textureSize.y;
	float panelRatio = frameSize.x / frameSize.y;
	float ratio = panelRatio / textureRatio;
	float ratio2 = textureRatio / panelRatio;

		// contain
		#if BACKGROUND_MAPPING == 1
		if ( textureRatio < panelRatio ) { // repeat on X
			float newX = uv.x * ratio;
			newX += 0.5 - 0.5 * ratio;
			uv.x = newX;
		} else { // repeat on Y
			float newY = uv.y * ratio2;
			newY += 0.5 - 0.5 * ratio2;
			uv.y = newY;
		}
		#else
		// cover
		if ( textureRatio < panelRatio ) { // stretch on Y
			float newY = uv.y * ratio2;
			newY += 0.5 - 0.5 * ratio2;
			uv.y = newY;
		} else { // stretch on X
			float newX = uv.x * ratio;
			newX += 0.5 - 0.5 * ratio;
			uv.x = newX;
		}

		#endif

	#endif

	return texture2D( map, uv );

}
#endif
`,Nx=bU,_U=`
#ifdef USE_MAP

	vec4 textureSample = sampleTexture();
	diffuseColor *= textureSample;

#endif
`,Qx=_U,LB={msdfAlphaglyphParsVertexGlsl:Ix,msdfAlphaglyphVertexGlsl:Tx,msdfOffsetglyphVertexGlsl:Rx,msdfAlphaglyphParsFragmentGlsl:Bx,msdfAlphaglyphFragmentGlsl:Px,frameBorderParsVertexGlsl:kx,frameBorderVertexGlsl:Ox,frameCommonParsFragmentGlsl:Ux,frameBorderParsFragmentGlsl:Lx,frameBorderFragmentGlsl:Fx,frameBackgroundParsFragmentGlsl:Nx,frameBackgroundFragmentGlsl:Qx},wU=`
// Would be automatic on three materials and from USE_UV
#ifdef USE_MAP
varying vec2 vUv;
#endif

${kx}

#include <clipping_planes_pars_vertex>

void main() {

	#ifdef USE_MAP
	vUv = uv;
	#endif

	${Ox}

	vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );
	gl_Position = projectionMatrix * mvPosition;

	#include <clipping_planes_vertex>

}
`,xU=`

// Basic
uniform vec3 diffuse;
uniform float opacity;

#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif

${Ux}

${Lx}


#ifdef USE_MAP
varying vec2 vUv;
uniform sampler2D map;
#endif

${Nx}

#include <clipping_planes_pars_fragment>

void main() {

	vec4 diffuseColor = vec4( diffuse, opacity );

	// map
	${Qx}

	${Fx}

	#ifdef USE_ALPHATEST

	if ( diffuseColor.a < alphaTest ) discard;

	#endif

	// output
	gl_FragColor = diffuseColor;


	#include <clipping_planes_fragment>
}
`;class ov{static get mediation(){return SU}static ensureMaterialOptions(t){t.transparent=!0,t.alphaTest=t.alphaTest||.02}static ensureDefines(t){t.defines||(t.defines={})}static ensureUserData(t,e){t.userData.borderColor={value:null},t.userData.borderRadius={value:new fe.Vector4(0,0,0,0)},t.userData.cornerTL={value:new fe.Vector2(0,1)},t.userData.cornerTR={value:new fe.Vector2(1,1)},t.userData.cornerBR={value:new fe.Vector2(1,0)},t.userData.cornerBL={value:new fe.Vector2(0,0)},t.userData.borderWidth={value:new fe.Vector4(0,0,0,0)},t.userData.borderOpacity={value:null},t.userData.frameSize={value:new fe.Vector3(1,1,1)},t.userData.textureSize={value:new fe.Vector2(1,1)}}static bindUniformsWithUserData(t,e){t.uniforms.borderColor=e.userData.borderColor,t.uniforms.borderRadius=e.userData.borderRadius,t.uniforms.cornerTL=e.userData.cornerTL,t.uniforms.cornerTR=e.userData.cornerTR,t.uniforms.cornerBR=e.userData.cornerBR,t.uniforms.cornerBL=e.userData.cornerBL,t.uniforms.borderWidth=e.userData.borderWidth,t.uniforms.borderOpacity=e.userData.borderOpacity,t.uniforms.frameSize=e.userData.frameSize,t.uniforms.textureSize=e.userData.textureSize}static injectShaderChunks(t){ov.injectVertexShaderChunks(t),ov.injectFragmentShaderChunks(t)}static injectVertexShaderChunks(t){t.vertexShader=t.vertexShader.replace("#include <uv_pars_vertex>",`#include <uv_pars_vertex>
`+kx),t.vertexShader=t.vertexShader.replace("#include <uv_vertex>",`#include <uv_vertex>
`+Ox)}static injectFragmentShaderChunks(t){t.fragmentShader=t.fragmentShader.replace("#include <map_pars_fragment>",`#include <map_pars_fragment>
`+Nx),t.fragmentShader=t.fragmentShader.replace("#include <map_pars_fragment>",`#include <map_pars_fragment>
`+Lx),t.fragmentShader=t.fragmentShader.replace("#include <map_pars_fragment>",`#include <map_pars_fragment>
`+Ux),t.fragmentShader=t.fragmentShader.replace("#include <map_fragment>",Qx),t.fragmentShader=t.fragmentShader.replace("#include <alphamap_fragment>",Fx+`
#include <alphamap_fragment>`)}}const CU=function(n,t,e){e=["stretch","contain","cover"].indexOf(e),RB(n,"BACKGROUND_MAPPING",e)},SU={clippingPlanes:{m:"clippingPlanes"},backgroundAlphaTest:{m:"alphaTest",t:py},backgroundSide:{m:"side"},backgroundImage:{m:"map"},backgroundColor:{m:"color"},backgroundOpacity:{m:"opacity"},backgroundSize:{m:"computedBackgroundSize",t:CU},borderWidth:{m:"borderWidth",t:Ur},borderColor:{m:"borderColor",t:Ur},cornerTL:{m:"cornerTL",t:Ur},cornerTR:{m:"cornerTR",t:Ur},cornerBR:{m:"cornerBR",t:Ur},cornerBL:{m:"cornerBL",t:Ur},borderOpacity:{m:"borderOpacity",t:Ur},size:{m:"frameSize",t:Ur},tSize:{m:"textureSize",t:Ur}};class FB extends fe.ShaderMaterial{static get mediation(){return ov.mediation}constructor(){super({uniforms:{alphaTest:{value:.02},map:{value:null},diffuse:{value:new fe.Color(16777215)},opacity:{value:1},borderColor:{value:new fe.Color(0)},borderOpacity:{value:0},borderRadius:{value:new fe.Vector4(0,0,0,0)},cornerTL:{value:new fe.Vector2(0,1)},cornerTR:{value:new fe.Vector2(1,1)},cornerBR:{value:new fe.Vector2(1,0)},cornerBL:{value:new fe.Vector2(0,0)},borderWidth:{value:new fe.Vector4(0,0,0,0)},frameSize:{value:new fe.Vector3(1,1,1)},textureSize:{value:new fe.Vector2(1,1)}},side:fe.FrontSide,transparent:!0,clipping:!0,vertexShader:wU,fragmentShader:xU,extensions:{derivatives:!0}}),this.defines.USE_ALPHATEST="",this.needsUpdate=!0}set map(t){this.uniforms.map.value=t,t?this.defines.USE_UV===void 0&&(this.defines.USE_UV="",this.needsUpdate=!0):this.defines.USE_UV!==void 0&&(delete this.defines.USE_UV,this.needsUpdate=!0),this.needsUpdate=!0}get map(){return this.uniforms.map.value}get alphaTest(){return this.uniforms.alphaTest.value}set alphaTest(t){this.uniforms.alphaTest.value=t}set opacity(t){this.uniforms&&(this.uniforms.opacity.value=t)}get opacity(){return this.uniforms.opacity.value}get color(){return this.uniforms.diffuse.value}set color(t){this.uniforms.diffuse.value=t}}class EU extends Mt{constructor(){super("children",null,!1);c(this,"_sortOrder",(e,i)=>e._order._value<i._order._value?-1:e._order._value>i._order._value?1:this._uis.indexOf(e)<this._uis.indexOf(i)?-1:1);this._uis=[],this._boxes=[]}update(e,i){this._compute(e),e._layouter._needsUpdate=!0,e._renderOrder._needsUpdate=!0}process(e){this._compute(e),e._flexDirection._needsProcess=!0,e._layouter._needsProcess=!0,e._overflow._needsRender=!0}_compute(e){this._uis=e.children.filter(i=>i.visible&&i.isUI),this._boxes=this._uis.filter(i=>i.isBox).sort(this._sortOrder)}dispose(){this._uis=null,this._boxes=null}}class UB extends Mt{constructor(){super("bounds",null,!1),this._size=new fe.Vector3(1,1,1),this._offsetWidth=0,this._offsetHeight=0,this._innerWidth=0,this._innerHeight=0,this._centerX=.5,this._centerY=.5,this._needsProcess=!0}setReferenceWidth(t,e){const i=t._width,s=t._padding._value,r=t._borderWidth._value,o=t._margin._value,a=i._auto?1:i._value,l=e*a-(o.y+o.w);k_(l,this._offsetWidth)||(this._offsetWidth=l,this._innerWidth=this._offsetWidth-(s.y+s.w+r.y+r.w),this._centerX=Q0(t),this._propagateWidth(t),this._triggerCascadingDependencies(t))}setReferenceHeight(t,e){const i=t._height,s=t._padding._value,r=t._borderWidth._value,o=t._margin._value,a=i._auto?1:i._value,l=e*a-(o.x+o.z);k_(l,this._offsetHeight)||(this._offsetHeight=l,this._innerHeight=this._offsetHeight-(s.x+s.z+r.x+r.z),this._centerY=z0(t),this._propagateHeight(t),this._triggerCascadingDependencies(t))}setChildrenWidth(t,e){const i=t._padding._value,s=t._borderWidth._value;this._innerWidth=e,this._offsetWidth=this._innerWidth+(i.y+i.w+s.y+s.w),this._centerX=Q0(t),this._propagateWidth(t),this._triggerCascadingDependencies(t)}setChildrenHeight(t,e){const i=t._padding._value,s=t._borderWidth._value;this._innerHeight=e,this._offsetHeight=this._innerHeight+(i.x+i.z+s.x+s.z),this._centerY=z0(t),this._propagateHeight(t),this._triggerCascadingDependencies(t)}update(t,e){const i=t._padding._value,s=t._borderWidth._value,r=t._width;!r._auto&&!r._relative&&(t._boxSizing._value==="content-box"?(this._innerWidth=r._value,this._offsetWidth=this._innerWidth+i.y+i.w+s.y+s.w):(this._offsetWidth=r._value,this._innerWidth=this._offsetWidth-(i.y+i.w+s.y+s.w)),this._centerX=Q0(t),this._needsProcess=!0,this._propagateWidth(t),this._triggerCascadingDependencies(t));const o=t._height;!o._auto&&!o._relative&&(t._boxSizing._value==="content-box"?(this._innerHeight=o._value,this._offsetHeight=this._innerHeight+i.x+i.z+s.x+s.z):(this._offsetHeight=o._value,this._innerHeight=this._offsetHeight-(i.x+i.z+s.x+s.z)),this._centerY=z0(t),this._needsProcess=!0,this._propagateHeight(t),this._triggerCascadingDependencies(t))}render(t){this._size.x=this._offsetWidth,this._size.y=this._offsetHeight,t._backgroundMesh&&t._backgroundMesh.updateScale(),t._renderer._needsRender=!0}output(t){t.size=this._size}process(t){t._overflow._needsRender=!0}_computeChildrenSideWidth(t){return IU(t)}_computeChildrenSideHeight(t){return TU(t)}_propagateWidth(t){for(let e=0;e<t._children._boxes.length;e++){const i=t._children._boxes[e];i._width._relative&&i._bounds.setReferenceWidth(i,this._innerWidth)}}_propagateHeight(t){for(let e=0;e<t._children._boxes.length;e++){const i=t._children._boxes[e];i._height._relative&&i._bounds.setReferenceHeight(i,this._innerHeight)}}_triggerCascadingDependencies(t){t._parent._value&&(t._parent._value._autoSize._needsProcess=!0),t._flexDirection._needsProcess=!0,t._fontSize._needsProcess=!0,t._layouter._needsProcess=!0,this._needsRender=!0,t._borderWidth._needsRender=!0,t._borderRadius._needsRender=!0,t._overflow._needsRender=!0}}function Q0(n){const t=n._padding._value,e=n._borderWidth._value,i=t.w+e.w,s=t.y+e.y;return(i-s)/2}function z0(n){const t=n._padding._value,e=n._borderWidth._value,i=t.x+e.x;return(t.z+e.z-i)/2}function IU(n){return n._children._boxes.reduce((t,e)=>{const i=e._margin._value,s=e._bounds._offsetWidth+i.y+i.w;return t+s},0)}function TU(n){return n._children._boxes.reduce((t,e)=>{const i=e._margin._value,s=e._bounds._offsetHeight+i.x+i.z;return t+s},0)}class RU extends xx{constructor(){super(),this._allowsInherit=!1,this._needsUpdate=!0,this._process=this.emptyStrategyLogic,this._childAlign=this.emptyStrategyLogic}computeOutputValue(t){switch(this._value=this._inheritedInput,t._flexDirection._value){case"row":case"row-reverse":switch(this._process=OU,this._value){case"start":this._childAlign=PU;break;case"end":this._childAlign=BU;break;default:this._childAlign=oE}break;case"column":case"column-reverse":switch(this._process=kU,this._value){case"start":this._childAlign=DU;break;case"end":this._childAlign=MU;break;default:this._childAlign=oE}break}this._needsProcess=!0,t._autoSize._needsProcess=!0,t._flexDirection._needsProcess=!0,t._justifyContent._needsProcess=!0,this._needsProcess=!0,t._fontSize._needsProcess=!0,t._layouter._needsProcess=!0}process(t){this._process(t,this._childAlign);let e="center",i="center",s="center";const r=t._padding._value,o=t._borderWidth._value;t._flexDirection._value.indexOf("column")!==-1?this._value==="start"?e=i="left":this._value==="end"?e=i="right":e="centerX":this._value==="start"?e=s="top":this._value==="end"?e=s="bottom":e="centerY";let a=-(r.x-r.z)/2-(o.x-o.z)/2,l=-(r.y-r.w)/2-(o.y-o.w)/2;i==="left"?l=(r.w-r.y)/2+(o.w-o.y)/2:i==="right"&&(l=-(r.y-r.w)/2-(o.y-o.w)/2),s==="top"?a=-(r.x-r.z)/2-(o.x-o.z)/2:s==="bottom"&&(a=(r.z-r.x)/2+(o.z-o.x)/2),t._children._boxes.forEach(h=>{let u=0,d=0;e==="top"?d=-h._margin._value.x:e==="bottom"?d=h._margin._value.z:e==="left"?u=h._margin._value.w:e==="right"?u=-h._margin._value.y:e==="centerX"?u=(h._margin._value.w-h._margin._value.y)/2:e==="centerY"&&(d=(-h._margin._value.x+h._margin._value.z)/2),t._layouter._childrenPos[h.id].x+=l+u,t._layouter._childrenPos[h.id].y+=a+d})}}function oE(){return 0}function BU(n,t){return-t+n._bounds._offsetHeight/2}function PU(n,t){return t-n._bounds._offsetHeight/2}function MU(n,t){return t-n._bounds._offsetWidth/2}function DU(n,t){return-t+n._bounds._offsetWidth/2}function kU(n,t){const e=n._bounds._innerWidth/2;n._children._boxes.forEach(i=>{n._layouter._childrenPos[i.id].x=t(i,e)})}function OU(n,t){const e=n._bounds._innerHeight/2;n._children._boxes.forEach(i=>{n._layouter._childrenPos[i.id].y=t(i,e)})}class LU extends Sx{constructor(){super(),this._allowsInherit=!1,this._needsUpdate=!0,this._offset=0,this._reverse=1,this._process=this.emptyStrategyLogic}computeOutputValue(t){switch(this._value=this._inheritedInput,this._value){case"row":this._process=FU;break;case"row-reverse":this._process=UU;break;case"column":this._process=NU;break;case"column-reverse":this._process=QU;break}t._justifyContent._needsUpdate||t._justifyContent.computeOutputValue(t),t._alignItems._needsUpdate||t._alignItems.computeOutputValue(t),this._needsProcess=!0}process(t){switch(this._value){case"row":this._offset=-t._bounds._innerWidth/2;break;case"row-reverse":this._offset=t._bounds._innerWidth/2;break;case"column":this._offset=t._bounds._innerHeight/2;break;case"column-reverse":this._offset=-t._bounds._innerHeight/2;break}this._reverse=-Math.sign(this._offset),this._reverse===0&&(this._reverse=1),this._process(t),t._justifyContent._needsProcess=!0,t._layouter._needsProcess=!0}}function FU(n){let t=n._flexDirection._offset;const e=n._flexDirection._reverse,i=n._children._boxes;for(let s=0;s<i.length;s++){const r=i[s],o=r.id,a=r._bounds._offsetWidth;t+=r._margin._value.w*e;const l=n._layouter._childrenPos[o];l.x=t+a/2*e,l.y=0,t+=e*(a+r._margin._value.y)}}function UU(n){let t=n._flexDirection._offset;const e=n._flexDirection._reverse,i=n._children._boxes;for(let s=0;s<i.length;s++){const r=i[s],o=r.id,a=r._bounds._offsetWidth;t+=r._margin._value.y*e;const l=n._layouter._childrenPos[o];l.x=t+a/2*e,l.y=0,t+=(a+r._margin._value.w)*e}}function NU(n){let t=n._flexDirection._offset;const e=n._flexDirection._reverse,i=n._children._boxes;for(let s=0;s<i.length;s++){const r=i[s],o=r.id,a=r._bounds._offsetHeight;t+=r._margin._value.x*e;const l=n._layouter._childrenPos[o];l.x=0,l.y=t+a/2*e,t+=(a+r._margin._value.z)*e}}function QU(n){let t=n._flexDirection._offset;const e=n._flexDirection._reverse,i=n._children._boxes;for(let s=0;s<i.length;s++){const r=i[s],o=r.id,a=r._bounds._offsetHeight;t+=r._margin._value.z*e;const l=n._layouter._childrenPos[o];l.x=0,l.y=t+a/2*e,t+=(a+r._margin._value.x)*e}}class zU extends Ex{constructor(t){super("justifyContent",t,!0),this._allowsInherit=!1,this._needsUpdate=!0,this._computeOffset=this.emptyStrategyLogic,this._computeMargin=this.emptyStrategyLogic,this._process=this.emptyStrategyLogic}computeOutputValue(t){switch(this._value=this._inheritedInput,t._flexDirection._value){case"column-reverse":case"column":this._process=GU.bind(this);break;case"row-reverse":case"row":this._process=jU.bind(this);break}switch(this._value){case"end":this._computeOffset=WU,this._computeMargin=j0;break;case"center":this._computeOffset=qU,this._computeMargin=j0;break;case"start":this._computeOffset=_m,this._computeMargin=j0;break;case"space-between":this._computeOffset=_m,this._computeMargin=XU;break;case"space-around":this._computeOffset=_m,this._computeMargin=KU;break;case"space-evenly":this._computeOffset=_m,this._computeMargin=YU;break}t._flexDirection._needsProcess=!0}process(t){this._process(t),t._alignItems._needsProcess=!0}}function jU(n){const t=n._flexDirection._offset,{usedDirectionSpace:e,remainingSpace:i}=HU(n),s=t*2-e*Math.sign(t),r=this._computeOffset(s),o=this._computeMargin(n,i,n._flexDirection._reverse);n._children._boxes.forEach((a,l)=>{n._layouter._childrenPos[a.id].x-=r-o[l]})}function GU(n){const t=n._flexDirection._offset,{usedDirectionSpace:e,remainingSpace:i}=VU(n),s=t*2-e*Math.sign(t),r=this._computeOffset(s),o=this._computeMargin(n,i,n._flexDirection._reverse);n._children._boxes.forEach((a,l)=>{n._layouter._childrenPos[a.id].y-=r-o[l]})}function HU(n){const t=n._bounds._computeChildrenSideWidth(n);return{usedDirectionSpace:t,remainingSpace:n._bounds._innerWidth-t}}function VU(n){const t=n._bounds._computeChildrenSideHeight(n);return{usedDirectionSpace:t,remainingSpace:n._bounds._innerHeight-t}}function _m(n){return 0}function WU(n){return n}function qU(n){return n/2}function j0(n,t=0,e=1){return Array(n._children._boxes.length).fill(0)}function XU(n,t=0,e=1){const s=n._children._boxes.length,r=Array(s).fill(0);if(t>0&&s>1){const o=t/(s-1)*e;r[0]=0;for(let a=1;a<s;a++)r[a]=o*a}return r}function YU(n,t=0,e=1){const s=n._children._boxes.length,r=Array(s).fill(0);if(t>0){const o=t/(s+1)*e;for(let a=0;a<s;a++)r[a]=o*(a+1)}return r}function KU(n,t=0,e=1){const s=n._children._boxes.length,r=Array(s).fill(0);if(t>0){const o=t/s*e,a=o/2;r[0]=a;for(let l=1;l<s;l++)r[l]=a+o*l}return r}let G0;class NB extends fe.Mesh{constructor(t){const e=t.slice,i={};let s=1,r=1;if(e){if(s=e.width?e.width:1,r=e.height?e.height:1,e.top){if(e.left){const f=new fe.PlaneGeometry(e.left*s,e.top*r,1,1);Ya(f,0,e.left,1-e.top,1),f.translate(e.left*s/2,-e.top*r/2,0),i.topLeft=f}const d=new fe.PlaneGeometry(1,e.top*r,1,1);if(Ya(d,e.left,1-e.right,1-e.top,1),d.translate(0,-e.top*r/2,0),i.top=d,e.right){const f=new fe.PlaneGeometry(e.right*s,e.top*r,1,1);Ya(f,1-e.right,1,1-e.top,1),f.translate(-e.right*s/2,-e.top*r/2,0),i.topRight=f}}if(e.left){const d=new fe.PlaneGeometry(e.left*s,1,1,1);Ya(d,0,e.left,e.bottom,1-e.top),d.translate(e.left*s/2,0,0),i.left=d}const u=new fe.PlaneGeometry(1,1,1,1);if(Ya(u,e.left,1-e.right,e.bottom,1-e.top),i.middle=u,e.right){const d=new fe.PlaneGeometry(e.right*s,1,1,1);Ya(d,1-e.right,1,e.bottom,1-e.top),d.translate(-e.right*s/2,0,0),i.right=d}if(e.bottom){if(e.left){const f=new fe.PlaneGeometry(e.left*s,e.bottom*r,1,1);Ya(f,0,e.left,0,e.bottom),f.translate(e.left*s/2,e.bottom*r/2,0),i.bottomLeft=f}const d=new fe.PlaneGeometry(1,e.bottom*r,1,1);if(Ya(d,e.left,1-e.right,0,e.bottom),d.translate(0,e.bottom*r/2,0),i.bottom=d,e.right){const f=new fe.PlaneGeometry(e.right*s,e.bottom*r,1,1);Ya(f,1-e.right,1,0,e.bottom),f.translate(-e.right*s/2,e.bottom*r/2,0),i.bottomRight=f}}}let o=t.backgroundMaterial;e&&(G0||(G0=new fe.MeshBasicMaterial({alphaTest:1.1})),o=G0);const a=new fe.PlaneGeometry(1,1,t._segments.value,t._segments.value),l=new fe.BufferAttribute(new Float32Array(a.getAttribute("uv").array),2);if(a.setAttribute("uvB",l).name="uvB",super(a,o),this.name="UIBackgroundBox",e){this.slice=e,this.sliceSize=new fe.Vector3(1-(e.left+e.right),1-(e.bottom+e.top),1),this.sliceScale=new fe.Vector3(s,r,1);for(const h in i){const u=new fe.Mesh(i[h],t.backgroundMaterial);this.add(u),i[h]=u}this.updateScale=this.updateScaleSlice,this.slices=i}}updateScale(){}updateScaleSlice(){const t=new fe.Vector3(1,1,1);this.scale.x<(this.slice.left+this.slice.right)*this.sliceScale.x&&(t.x=this.scale.x/((this.slice.left+this.slice.right)*this.sliceScale.x)),this.scale.y<(this.slice.bottom+this.slice.top)*this.sliceScale.y&&(t.y=this.scale.y/((this.slice.bottom+this.slice.top)*this.sliceScale.y));for(const e in this.slices){const i=this.slices[e];i.scale.set(1/this.scale.x,1/this.scale.y,this.scale.y);const s=JU[e];for(const o in s)i.position[o]=this.scale[o]*s[o]*i.scale[o];const r=ZU[e];if(r){r.x&&(i.position.x=this.sliceScale.x*.5*(this.slice.left-this.slice.right)*(1/this.scale.x)),r.y&&(i.position.y=this.sliceScale.y*.5*(this.slice.bottom-this.slice.top)*(1/this.scale.y));for(const o in r){const a=this.scale[o]-(1-this.sliceSize[o])*this.sliceScale[o];i.scale[o]=Math.max(0,a*(1/this.scale[o]))}}}t.x!==1&&(this.slices.left.scale.x*=t.x,this.slices.topLeft.scale.x*=t.x,this.slices.bottomLeft.scale.x*=t.x,this.slices.right.scale.x*=t.x,this.slices.topRight.scale.x*=t.x,this.slices.bottomRight.scale.x*=t.x),t.y!==1&&(this.slices.top.scale.y*=t.y,this.slices.topLeft.scale.y*=t.y,this.slices.topRight.scale.y*=t.y,this.slices.bottom.scale.y*=t.y,this.slices.bottomLeft.scale.y*=t.y,this.slices.bottomRight.scale.y*=t.y)}}const JU={topLeft:{x:-.5,y:.5},top:{y:.5},topRight:{x:.5,y:.5},left:{x:-.5},right:{x:.5},bottomLeft:{x:-.5,y:-.5},bottom:{y:-.5},bottomRight:{x:.5,y:-.5}},ZU={top:{x:1},left:{y:1},right:{y:1},bottom:{x:1},middle:{x:1,y:1}};function Ya(n,t,e,i,s){const r=e-t,o=s-i,a=n.attributes.uv;for(let h=0;h<a.count;h++){const u=a.getX(h),d=a.getY(h);a.setXY(h,t+u*r,i+d*o)}const l=new fe.BufferAttribute(new Float32Array(n.getAttribute("uv").array),2);n.setAttribute("uvB",l).name="uvB"}class QB extends Mt{constructor(){super("renderer")}render(t){t._backgroundMesh||t.setBackgroundMesh(new NB(t)),t.performAfterUpdate()}}class $U extends xB{constructor(){super("position")}update(t,e){super.update(t,e),this._needsProcess=!0}}class e3 extends Mt{constructor(){super("autosize"),this._needsProcess=!0}process(t){t._width._auto&&t3(t),t._height._auto&&i3(t);const e=t._alignItems._value==="stretch",i=e&&t._flexDirection._value.indexOf("column")!==-1,s=e&&!i;for(const r of t._children._boxes)(r._width._auto&&i||r._width._relative)&&r._bounds.setReferenceWidth(r,t._bounds._innerWidth),(r._height._auto&&s||r._height._relative)&&r._bounds.setReferenceHeight(r,t._bounds._innerHeight)}}function t3(n){n._bounds.setChildrenWidth(n,s3(n))}function i3(n){n._bounds.setChildrenHeight(n,n3(n))}function n3(n){switch(n._flexDirection._value){case"row":case"row-reverse":return l3(n);case"column":case"column-reverse":return o3(n)}}function s3(n){switch(n._flexDirection._value){case"row":case"row-reverse":return r3(n);case"column":case"column-reverse":return a3(n)}}function r3(n){let t=0;for(const e of n._children._boxes){if(e._position._value!=="static")continue;const i=e._margin._value,s=e._bounds._offsetWidth+i.y+i.w;t+=s}return t}function o3(n){let t=0;for(const e of n._children._boxes){if(e._position._value!=="static")continue;const i=e._margin._value,s=e._bounds._offsetHeight+i.x+i.z;t+=s}return t}function a3(n){let t=0;for(const e of n._children._boxes){if(e._position._value!=="static")continue;const i=e._margin._value,s=e._bounds._offsetWidth+i.y+i.w;s>t&&(t=s)}return t}function l3(n){let t=0;for(const e of n._children._boxes){if(e._position._value!=="static")continue;const i=e._margin._value,s=e._bounds._offsetHeight+i.x+i.z;s>t&&(t=s)}return t}class lg extends Mg{constructor(t,e){lg.definePropertiesValues(t,e),super(t,e),lg.init(this)}bindBackgroundMeshProperties(){this._bounds._size=this._backgroundMesh.scale,this._bounds._needsProcess=!0}unbindBackgroundMeshProperties(){this._bounds._size=new fe.Vector3(1,1,1),this._bounds._needsProcess=!0}static definePropertiesValues(t,e){t.children||(t.children=EU),t.bounds||(t.bounds=UB),t.flexDirection||(t.flexDirection=LU),t.justifyContent||(t.justifyContent=zU),t.alignItems||(t.alignItems=RU),t.position||(t.position=$U),t.autoSize||(t.autoSize=e3),t.renderer||(t.renderer=QB),e.fontSide||(e.fontSide=0),e.invertAlpha||(e.invertAlpha=!1),e.fontCastShadow||(e.fontCastShadow=!1),e.fontReceiveShadow||(e.fontReceiveShadow=!1),e.backgroundCastShadow||(e.backgroundCastShadow=!1),e.backgroundReceiveShadow||(e.backgroundReceiveShadow=!1)}static init(t){Object.defineProperties(t,{isBox:{configurable:!1,enumerable:!0,value:!0}}),t.backgroundMaterial=new FB,t._renderer.render(t),t._backgroundMesh.visible=!1}}class aE extends Array{constructor(...t){super(...t),this.width=0,this.lineBase=0,this.lineHeight=0,this.y=0}}class c3 extends Mt{constructor(){super("layouter",null,!1),this._needsUpdate=!0,this._childrenPos={}}update(t,e){this._childrenPos={};for(const i of t._children._boxes)i._position._value==="static"&&(this._childrenPos[i.id]=i.position)}process(t){}}class cg extends lg{constructor(t={}){const e={};cg.definePropertiesValues(e,t),super(e,t),cg.init(this)}add(t){const e=[];for(let i=0;i<arguments.length;i++){const s=arguments[i];!s.isUI||s.isBox?e.push(s):console.warn("Block element can only contain Box elements.",s)}return super.add(...e)}static definePropertiesValues(t,e){t.layouter=c3}static init(t){Object.defineProperties(t,{isBlock:{configurable:!1,enumerable:!0,value:!0}})}}class h3 extends Mt{constructor(){super("textContent",null,!1)}update(t,e){t._glyphs._needsUpdate=!0,t._whiteSpace._needsProcess=!0}}class u3 extends Mt{constructor(){super("inlines",null,!1),this._value=null}process(t){if(this._value=t._glyphs._value.map(e=>e.asInlineGlyph()),this._value.length){this._value[0].paddingLeft=t._padding._value.w,this._value[0].marginLeft=t._margin._value.w;const e=this._value.length-1;this._value[e].paddingRight=t._padding._value.y,this._value[e].marginRight=t._margin._value.y}t._fontSize._needsProcess=!0,t._lineBreak._needsProcess=!0,t._fontKerning._needsProcess=!0,t._layouter._needsProcess=!0}get value(){return this._value}}class d3 extends Mt{constructor(){super("glyphs",null,!1),this._needsUpdate=!1,this._value=null}process(t){t._font._fontVariant&&t._font._fontVariant.isReady&&(this._value=t._whiteSpace._whiteSpacedContent.split("").map(e=>t._font._fontVariant.getTypographicGlyph(e)),this._value&&(t._inlines._needsProcess=!0))}get value(){return this._value}}class f3 extends ag{constructor(){super("color","inherit",!1),this.output=this._outputValue}computeOutputValue(t){this._input==="inherit"?this._value.set(this.getInheritedInput(t)):this._value.set(this._input)}}class zB extends Mt{constructor(t=`- ,.:?!
`){super("lineBreak",t,!0),this._newLineBreakability=null}update(t,e){this._needsProcess=!0}process(t){const e=t._whiteSpace._newLineBreakability;if(t._inlines._value)for(let i=0;i<t._inlines._value.length;i++){const s=t._inlines._value[i],r=s.char;let o=null;r!==void 0&&(e!=="nowrap"&&(this._value.includes(r)||r.match(/\s/g))&&(o="possible"),r.match(/\n/g)&&(o=e)),s.lineBreak=o}}get value(){return this._value}}class jB extends Mt{constructor(){super("layouter",null,!1),this._value=null}update(t,e){this._value=t._parent.find(i=>i.isUI&&i.isText),this._needsProcess=!0}process(t){this._value&&(this._value._layouter._needsProcess=!0)}}class p3 extends ag{constructor(t){super("backgroundColor",t,!1),this._allowsInherit=!1,this._input=0}computeOutputValue(t){this._input==="inherit"?this._value.set(this.getInheritedInput(t)):this._value.set(this._input)}}class GB extends EB{constructor(){super(),this._allowsInherit=!1,this.computeOutputValue=this._computeFromInherited}}class HB extends IB{constructor(){super()}computeOutputValue(t){this._value=wx(this.getInheritedInput(t))}}class VB extends PB{constructor(){super("fontFamily","inherit",!0),this._input="inherit",this._needsUpdate=!0,this._allowsInherit=!1}computeOutputValue(t){let e=this._inheritedInput;if(e==="inherit"&&(e=this.getInheritedInput(t)),e instanceof gy)this._value=e,t._font._needsUpdate=!0;else if(typeof e=="string"){const i=Uh.getFontFamily(e);i?(this._value=i,t._font._needsUpdate=!0):console.warn(`(.style) fontFamily, the font '${e}' is not registered. Aborted.`)}else console.warn("(.style) fontFamily requires a registered fontFamily instance, or the id of a registered fontFamily."),console.warn("If you want to set a specific font, please use .font property instead.")}get value(){return this._value}}class zx extends DB{constructor(){super(),this._allowsInherit=!1,this.computeOutputValue=this._computeFromInherited,this._whiteSpacedContent="",this._stringCollapser=this.emptyStrategyLogic,this._inlineCollapser=this.emptyStrategyLogic,this._inlineWrapper=this.emptyStrategyLogic}_computeFromInherited(t){switch(super._computeFromInherited(t),this._newLineBreakability=g3(this._value),this._value){case"nowrap":case"normal":this._stringCollapser=m3;break;case"pre-line":this._stringCollapser=WB;break;default:this._stringCollapser=A3}switch(this._value){case"pre-line":case"nowrap":case"normal":this._inlineCollapser=w3;break;case"pre-wrap":this._inlineCollapser=_3;break;default:this._inlineCollapser=x3}switch(this._value){case"pre-line":case"pre-wrap":case"normal":this._inlineWrapper=v3;break;case"pre":this._inlineWrapper=y3;break;default:this._inlineWrapper=b3}this._needsProcess=!0}process(t){t.isInline&&!t.isInlineBlock&&(this._whiteSpacedContent=this._stringCollapser(t._textContent._value),t._glyphs._needsProcess=!0)}}const lE={"	":"	","\n":`
`,"\r":"\r"," ":" "},g3=function(n){switch(n){case"pre":case"pre-wrap":case"pre-line":return"mandatory"}return null};function m3(n){return WB(n.replace(/\n/g," "))}function WB(n){return n.replace(/[ ]{2,}/g," ")}function A3(n){return n}function v3(n,t,e,i){const s=n[t];if(s.lineBreak==="mandatory"||e+s.xadvance+s.xoffset+s.kerning>i.INNER_WIDTH)return!0;const r=YB(n,t,i);return C3(n[t-1],e,r,i)}function y3(n,t,e,i){return n[t].lineBreak==="mandatory"}function b3(){return!1}function _3(n){if(!n[0])return 0;const t=n[0],e=n[n.length-1];return t.char&&t.char===`
`&&n.length>1&&XB([t],n[1]),e.char&&e.char===`
`&&n.length>1&&qB([e],n[n.length-2]),t.offsetX}function w3(n){if(!n[0])return 0;let t=[],e;for(let i=0;i<n.length;i++){const s=n[i];if(s.char&&lE[s.char]&&n.length>i){t.push(s),e=n[i+1];continue}break}XB(t,e),t=[],e=null;for(let i=n.length-1;i>0;i--){const s=n[i];if(s.char&&lE[s.char]&&i>0){t.push(s),e=n[i-1];continue}break}return qB(t,e),n[0].offsetX}function x3(n){return n[0]?n[0].offsetX:0}function qB(n,t){if(t)for(let e=0;e<n.length;e++){const i=n[e];i.fontFactor=0,i.offsetX=t.offsetX+t.cumulativeWidth,i.cumulativeWidth=0}}function XB(n,t){if(t)for(let e=0;e<n.length;e++){const i=n[e];i.fontFactor=0,i.offsetX=t.offsetX,i.cumulativeWidth=0}}function YB(n,t,e,i){if(i=i||0,!n[t])return i;const s=n[t];return s.lineBreak?i+s.xadvance:YB(n,t+1,e,i+s.xadvance+s.xoffset+s.kerning+e.LETTERSPACING)}function C3(n,t,e,i){return!n||!n.char||t+e<i.INNER_WIDTH?!1:i.BREAKON.indexOf(n.char)>-1}class KB extends kB{constructor(){super(),this._input="inherit",this._allowsInherit=!1,this.computeOutputValue=this._computeFromInherited}_computeFromInherited(t){super._computeFromInherited(t),t._fontSize._needsProcess=!0,t._layouter._needsProcess=!0}}class JB extends hi{constructor(){super("fontSize","inherit",!0),this._allowsInherit=!1}computeOutputValue(t){this._value=this._inheritedInput,t._font._fontVariant&&(t._bounds._needsProcess=!0,t._layouter._needsProcess=!0)}process(t){if(!t._font._fontVariant||!t._font._fontVariant.isReady)return;const e=this._value/t._font._fontVariant.typographic.size,i=t._inlines._value;for(let s=0;s<i.length;s++){const r=i[s];r.resetOffsets(),r.fontSize=this._value,r.fontFactor=e}}get value(){return this._value}}class ZB extends OB{constructor(){super("segments",1,!1),this._notInheritedValue=void 0}update(t,e){this._notInheritedValue=this._value,this._notInheritedValue==="inherit"&&(this._notInheritedValue=this.getInheritedInput(t)),t._layouter._needsUpdate=!0}set value(t){this._value!==t&&(this._value=t,this._needsUpdate=!0)}get value(){return this._value==="inherit"?this._notInheritedValue:this._value}}class S3 extends ZB{constructor(){super(),this._value="inherit"}}class E3 extends my{constructor(){super(),this._allowsInherit=!1,this.computeOutputValue=this._computeFromInherited}_computeFromInherited(t){super._computeFromInherited(t),t._parent._value._layouter._needsProcess=!1}process(t){if(this._value!=="none"){const e=t._whiteSpace._whiteSpacedContent,i=t._inlines._value;for(let s=1;s<i.length;s++){const r=e[s-1]+e[s];i[s].kerning=t._font._fontVariant.getKerningAmount(r)}}}}class $B extends Mt{constructor(){super("children",null,!1),this._uis=[]}update(t,e){}process(t){}_compute(t){}dispose(){}}function I3(n,t=!1){const e=n[0].index!==null,i=new Set(Object.keys(n[0].attributes)),s=new Set(Object.keys(n[0].morphAttributes)),r={},o={},a=n[0].morphTargetsRelative,l=new fe.BufferGeometry;let h=0;for(let u=0;u<n.length;++u){const d=n[u];let f=0;if(e!==(d.index!==null))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+u+". All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them."),null;for(const p in d.attributes){if(!i.has(p))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+u+'. All geometries must have compatible attributes; make sure "'+p+'" attribute exists among all geometries, or in none of them.'),null;r[p]===void 0&&(r[p]=[]),r[p].push(d.attributes[p]),f++}if(f!==i.size)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+u+". Make sure all geometries have the same number of attributes."),null;if(a!==d.morphTargetsRelative)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+u+". .morphTargetsRelative must be consistent throughout all geometries."),null;for(const p in d.morphAttributes){if(!s.has(p))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+u+".  .morphAttributes must be consistent throughout all geometries."),null;o[p]===void 0&&(o[p]=[]),o[p].push(d.morphAttributes[p])}if(t){let p;if(e)p=d.index.count;else if(d.attributes.position!==void 0)p=d.attributes.position.count;else return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+u+". The geometry must have either an index or a position attribute"),null;l.addGroup(h,p,u),h+=p}}if(e){let u=0;const d=[];for(let f=0;f<n.length;++f){const p=n[f].index;for(let g=0;g<p.count;++g)d.push(p.getX(g)+u);u+=n[f].attributes.position.count}l.setIndex(d)}for(const u in r){const d=cE(r[u]);if(!d)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed while trying to merge the "+u+" attribute."),null;l.setAttribute(u,d)}for(const u in o){const d=o[u][0].length;if(d===0)break;l.morphAttributes=l.morphAttributes||{},l.morphAttributes[u]=[];for(let f=0;f<d;++f){const p=[];for(let m=0;m<o[u].length;++m)p.push(o[u][m][f]);const g=cE(p);if(!g)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed while trying to merge the "+u+" morphAttribute."),null;l.morphAttributes[u].push(g)}}return l}function cE(n){let t,e,i,s=-1,r=0;for(let h=0;h<n.length;++h){const u=n[h];if(t===void 0&&(t=u.array.constructor),t!==u.array.constructor)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes."),null;if(e===void 0&&(e=u.itemSize),e!==u.itemSize)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes."),null;if(i===void 0&&(i=u.normalized),i!==u.normalized)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes."),null;if(s===-1&&(s=u.gpuType),s!==u.gpuType)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.gpuType must be consistent across matching attributes."),null;r+=u.count*e}const o=new t(r),a=new fe.BufferAttribute(o,e,i);let l=0;for(let h=0;h<n.length;++h){const u=n[h];if(u.isInterleavedBufferAttribute){const d=l/e;for(let f=0,p=u.count;f<p;f++)for(let g=0;g<e;g++){const m=u.getComponent(f,g);a.setComponent(f+d,g,m)}}else o.set(u.array,l);l+=u.count*e}return s!==void 0&&(a.gpuType=s),a}class T3 extends Mt{constructor(){super("renderer")}render(t){if(!t._inlines._value||!t._inlines._value.length)return;const e=t._inlines._value.map(s=>t._font._fontVariant.getGeometricGlyph(s,t).translate(s.offsetX,s.offsetY,0)),i=I3(e);t.setFontMesh(new fe.Mesh(i,t.fontMaterial)),t._fontMesh.renderOrder=1/0}}class R3 extends Cx{constructor(){super(),this._allowsInherit=!1,this._needsUpdate=!1}computeOutputValue(t){this._value=this._inheritedInput,t._layouter._needsProcess=!0}}class Bd extends Mg{constructor(e={}){const i={};Bd.definePropertiesValues(i,e);super(i,e);c(this,"_rebuildParentUI",()=>{super._rebuildParentUI(),this._layouter._needsUpdate=!0});Bd.init(this)}add(e){const i=[];for(let s=0;s<arguments.length;s++){const r=arguments[s];!r.isUI||r.isInline?(i.push(r),r.position.z=.005):console.warn("Block element can only contain Box elements.",r)}return super.add(...i)}set textContent(e){this._textContent.value=e}get textContent(){return this._textContent._value}set invertAlpha(e){this._invertAlpha.value=e}get invertAlpha(){return this._invertAlpha._value}static definePropertiesValues(e,i){e.children||(e.children=$B),e.textContent||(e.textContent=h3),e.glyphs||(e.glyphs=d3),e.inlines||(e.inlines=u3),e.layouter||(e.layouter=jB),e.renderer||(e.renderer=T3),e.fontFamily||(e.fontFamily=VB),e.fontWeight||(e.fontWeight=HB),e.fontStyle||(e.fontStyle=GB),e.fontSize||(e.fontSize=JB),e.color||(e.color=f3),e.backgroundColor||(e.backgroundColor=p3),e.lineBreak||(e.lineBreak=zB),e.letterSpacing||(e.letterSpacing=KB),e.whiteSpace||(e.whiteSpace=zx),e.segments||(e.segments=S3),e.textAlign||(e.textAlign=R3),e.fontKerning||(e.fontKerning=E3)}static init(e){Object.defineProperties(e,{isInline:{configurable:!1,enumerable:!0,value:!0}})}}class B3 extends SB{constructor(){super("textContent",null,!1),this._needsUpdate=!1}set value(t){this._value!==t&&(this._value=t,this._needsUpdate=!0)}update(t,e){this._needsUpdate=!1;for(let i=t.children.length-1;i>=0;i--){const s=t.children[i];s.isUI&&(t.remove(s),s.clear())}t._children._uis=[],this._value&&t.add(new Bd({name:"anonymousInline",textContent:this._value}))}}class P3 extends Array{constructor(...t){super(...t),this.width=0,this.height=0}}class M3 extends Mt{constructor(){super("layouter",null,!1),this._value=null}update(t,e){}process(t){let e=t._width._value;t._width._auto?e=1/0:e=t._bounds._innerWidth;const i=t._lineHeight._value,s=new P3(new aE);let r=0;t._children._inlines.forEach(d=>{if(!d._inlines.value)return;this._resetInlines(d);const f=d._fontSize._value,p=d._letterSpacing._value*f,g=d._whiteSpace._value,m=d._lineBreak._value,v={WHITESPACE:g,LETTERSPACING:p,BREAKON:m,INNER_WIDTH:e},y=d._whiteSpace._inlineWrapper;r+=d._margin._value.w+d._padding._value.w,d._inlines.value.forEach((b,_,x)=>{const S=s[s.length-1];if(y(x,_,r,v)){if(s.push(new aE(b)),b.offsetX=b.xoffset,b.width===0){r=0;return}b.cumulativeWidth=b.xadvance+p,r=b.cumulativeWidth;return}s[s.length-1].push(b),b.offsetX=r+b.xoffset+b.kerning,b.cumulativeWidth=b.xadvance+b.kerning+p,r+=b.cumulativeWidth,S.length-1===1&&S[S.length-2].width===0&&(b.offsetX-=b.xoffset,r-=b.xoffset)}),r+=d._margin._value.y+d._padding._value.y});const o=t._whiteSpace._inlineCollapser;let a=0,l=0,h=0;s.forEach((d,f)=>{const p=o(d);let g=0,m=0;if(d.forEach(v=>{g=Math.max(g,v.lineHeight),m=Math.max(m,v.lineBase),v.offsetX-=p}),d.lineHeight=g,d.lineBase=m,f===0?h=-(g*i-g)*.5:h-=s[f-1].lineHeight*i,d.y=h,d.x=0,d.forEach(v=>{v.offsetY=h-v.anchor,v.lineHeight<d.lineHeight&&(v.offsetY-=d.lineBase-v.lineBase)}),l+=d.lineHeight*i,d.width=0,d[0]){const v=d[d.length-1];d.width=v.offsetX+v.cumulativeWidth+v.paddingRight+v.marginRight+d[0].offsetX,a=Math.max(a,d.width)}}),s.height=l,s.width=a,this._value=s,e===1/0&&t._bounds.setChildrenWidth(t,s.width),t._height._auto&&t._bounds.setChildrenHeight(t,s.height);const u=t._parent._value;u&&(u._autoSize._needsProcess=!0,u._flexDirection._needsProcess=!0),t._inlineJustificator._needsProcess=!0,t._textAlign._needsProcess=!0,t._overflow._needsUpdate=!0}_resetInlines(t){t._fontSize.process(t)}}class D3 extends Cx{constructor(){super(),this._allowsInherit=!1,this._needsUpdate=!0}computeOutputValue(t){this._value=this._inheritedInput,this._needsProcess=!0}process(t){k3(t),t._renderer._needsRender=!0}}function k3(n){const t=n._layouter._value,e=n._textAlign._value,i=n._bounds._innerWidth;for(let s=0;s<t.length;s++){const r=t[s],o=O3(n,r,s===t.length-1),a=n._padding._value,l=n._borderWidth._value,h=(-a.w+a.y)/2+(-l.w+l.y)/2;r.x+=o;for(let u=0;u<r.length;u++)r[u].offsetX+=o-h}if(e.indexOf("justify")===0)for(let s=0;s<t.length;s++){const r=t[s];if(e.indexOf("-")!==-1&&s===t.length-1)return;const o=i-r.width;if(o<=0)return;let a=0;for(let d=1;d<r.length-1;d++)a+=r[d].char===" "?1:0;const l=o/a;let h=1;e==="justify-right"&&(r.reverse(),h=-1);let u=0;for(let d=1;d<=r.length-1;d++){const f=r[d];f.offsetX+=u*h,u+=f.char===" "?l:0}e==="justify-right"&&r.reverse()}}function O3(n,t,e){switch(n._textAlign._value){case"justify-left":case"justify":case"left":return-n._bounds._innerWidth/2;case"justify-right":case"right":return-t.width+n._bounds._innerWidth/2;case"center":return-t.width/2;case"justify-center":return e?-t.width/2:-n._bounds._innerWidth/2;default:console.warn(`textAlign: '${n._textAlign._value}' is not valid`)}}class L3 extends Sx{constructor(){super(),this._value=this._input="column",this._allowsInherit=!1,this._needsUpdate=!0}computeOutputValue(t){this._value=this._inheritedInput}}class F3 extends MB{constructor(){super(),this._allowsInherit=!1,this.computeOutputValue=this._computeFromInherited}}class U3 extends my{constructor(){super(),this._value=this._input=this.getDefaultValue(),this._allowsInherit=!1,this.computeOutputValue=this._computeFromInherited}_computeFromInherited(t){super._computeFromInherited(t)}}class N3 extends UB{constructor(){super(),this._innerWidth=1/0,this._innerHeight=0}}class Q3 extends Mt{constructor(){super("children",null,!1);c(this,"_sortOrder",(e,i)=>e._order._value<i._order._value?-1:e._order._value>i._order._value?1:this._uis.indexOf(e)<this._uis.indexOf(i)?-1:1);this._uis=[],this._inlines=[],this._boxes=[]}update(e,i){this._compute(e),this._needsProcess=!0}process(e){this._compute(e),e._overflow._needsRender=!0}_compute(e){this._uis=e.children.filter(i=>i.visible&&i.isUI),this._inlines=this._uis.filter(i=>i.isInline).sort(this._sortOrder)}dispose(){this._inlines=null}}class z3 extends Mt{constructor(){super("autosize")}process(t){if(t._layouter._value&&t._layouter._value.length){const e=t._layouter._value,i=t._padding._value,s=t._borderWidth._value;t._width._auto&&t._bounds.setOffsetWidth(t,e.width+i.w+i.y+s.w+s.y),t._height._auto&&t._bounds.setOffsetHeight(t,e.height+i.x+i.z+s.x+s.z)}}}class j3 extends QB{constructor(){super("renderer"),this._needsUpdate=!1}render(t){super.render(t);for(const e of t._children._inlines)e._renderer.render(e);t.performAfterUpdate()}}class hg extends lg{constructor(t={},e={}){hg.definePropertiesValues(e,t),super(e,t),hg.init(this)}add(t){const e=[];let i=!1;for(let s=0;s<arguments.length;s++){const r=arguments[s];!r.isUI||r.isInline?(r.isInline&&(i=!0),e.push(r)):console.warn("Block element can only contain Box elements.",r)}return e.length>0&&super.add(...e),i&&(this._children._needsUpdate=!0,this._layouter._needsProcess=!0),this}set textContent(t){this._textContent.value=t}get textContent(){return super.textContent}set invertAlpha(t){this._invertAlpha.value=t}get invertAlpha(){return this._invertAlpha._value}get lines(){return this._layouter._value}static definePropertiesValues(t,e){t.flexDirection=L3,t.justifyContent=Ex,t.alignItems=xx,t.bounds=N3,t.autoSize=z3,t.renderer=j3,t.children||(t.children=Q3),t.textContent||(t.textContent=B3),t.layouter||(t.layouter=M3),t.lineHeight||(t.lineHeight=F3),t.textAlign||(t.textAlign=D3),t.whiteSpace||(t.whiteSpace=zx),t.fontKerning||(t.fontKerning=U3),t.segments||(t.segments=ZB),e.width||(e.width="100%"),e.fontSide||(e.fontSide=0)}static init(t){Object.defineProperties(t,{isText:{configurable:!1,enumerable:!0,value:!0}})}}class G3 extends Mt{constructor(){super("inlines",null,!1),this._value=[]}process(t){this._value[0].paddingLeft=t._padding._value.w,this._value[0].marginLeft=t._margin._value.w;const e=this._value.length-1;this._value[e].paddingRight=t._padding._value.y,this._value[e].marginRight=t._margin._value.y}}class H3 extends Mt{constructor(){super("renderer")}render(t){t._backgroundMesh||t.setBackgroundMesh(new NB(t)),t._backgroundMesh.position.x=t._inlines._value[0].offsetX+t._inlines._value[0].width/2,t._backgroundMesh.position.y=t._inlines._value[0].offsetY+t._inlines._value[0].lineBase/2,t._bounds.render(t)}}class V3 extends Mt{constructor(){super("bounds",null,!1),this._size=new fe.Vector3(1,1,1),this._offsetWidth=0,this._offsetHeight=0,this._innerWidth=0,this._innerHeight=0}update(t,e){this.output(e),this._needsProcess=!0}process(t){this._offsetWidth=this._innerWidth=t._inlines._value[0].width,this._offsetHeight=this._innerHeight=t._inlines._value[0].height,this._needsRender=!0,t._borderWidth._needsRender=!0,t._borderRadius._needsRender=!0}render(t){this._size.x=this._offsetWidth,this._size.y=this._offsetHeight}output(t){t.size=this._size}}class ug extends Mg{constructor(t={}){const e={};ug.definePropertiesValues(e,t),super(e,t),ug.init(this)}clear(){for(const t of this._inlines._value)t.clear();return super.clear()}bindBackgroundMeshProperties(){this._backgroundMesh.raycast=()=>{},this._bounds._size=this._backgroundMesh.scale,this._bounds._needsUpdate=!0}unbindBackgroundMeshProperties(){this._bounds._size=new fe.Vector3(1,1,1),this._bounds._needsUpdate=!0}add(t){const e=[];for(let i=0;i<arguments.length;i++){const s=arguments[i];s.isUI?console.warn("ThreeMeshUI::InlineBlockElement cannot contains UI Elements.",s):(e.push(s),s.position.z=.005)}return super.add(...e)}static definePropertiesValues(t,e){t.children||(t.children=$B),t.bounds||(t.bounds=V3),t.inlines||(t.inlines=G3),t.layouter||(t.layouter=jB),t.renderer||(t.renderer=H3),t.fontFamily||(t.fontFamily=VB),t.fontWeight||(t.fontWeight=HB),t.fontStyle||(t.fontStyle=GB),t.fontSize||(t.fontSize=JB),t.backgroundColor||(t.backgroundColor=wB),t.lineBreak||(t.lineBreak=zB),t.letterSpacing||(t.letterSpacing=KB),t.whiteSpace||(t.whiteSpace=zx),t.fontKerning||(t.fontKerning=my),e.backgroundSize||(e.backgroundSize="cover"),e.width||(e.width="100%"),e.height||(e.height="100%"),e.boxSizing||(e.boxSizing="border-box")}static init(t){Object.defineProperties(t,{isInline:{configurable:!1,enumerable:!0,value:!0},isInlineBlock:{configurable:!1,enumerable:!0,value:!0}}),t._inlines._value=[new W3(t)],t.backgroundMaterial=new FB,t._renderer.render(t)}}class W3 extends AB{constructor(t){super(),this._uiElement=t}get xadvance(){const t=this._uiElement._padding._value,e=this._uiElement._width;return e._relative?e._value*this._uiElement._fontSize.getInheritedInput(this._uiElement):t.w+t.y+e.value}get width(){const t=this._uiElement._width;return t._relative?t._value*this._uiElement._fontSize.getInheritedInput(this._uiElement):t.value}get height(){const t=this._uiElement._height;return t._relative?t._value*this._uiElement._fontSize.getInheritedInput(this._uiElement):t.value}get anchor(){return this.height}get lineHeight(){const t=this._uiElement._height;return t._relative?t._value*this._uiElement._fontSize.getInheritedInput(this._uiElement):t.value}get lineBase(){const t=this._uiElement._height;return t._relative?t._value*this._uiElement._fontSize.getInheritedInput(this._uiElement):t.value}clear(){this._uiElement=null}}class eP{constructor(t){this._subject=t}attach(){console.error(`Behavior::attach() - Is abstract and therefore should be overridden in ${this.constructor.name}`)}act(){throw new Error(`Behavior::act() - Is abstract and therefore should be overridden in ${this.constructor.name}`)}detach(){console.error(`Behavior::detach() - Is abstract and therefore should be overridden in ${this.constructor.name}`)}clear(){}}const tP=()=>rv.update(),iP={BaseProperty:Mt,Block:cg,Text:hg,Inline:Bd,InlineBlock:ug,MeshUIBaseElement:Mg,FontLibrary:Uh,update:tP,MSDFFontMaterialUtils:zr,ShaderChunkUI:LB,Behavior:eP,FontVariant:Pg};typeof global<"u"&&(global.ThreeMeshUI=iP);const q3=iP;var X3=Ni.ti,nP=Ni.nS,jx=Ni.eB,Y3=Ni.Yp,O_=Ni.VB,K3=Ni.BC,J3=Ni.zN,EA=Ni.cV,Z3=Ni.hW,$3=Ni.k2,eN=Ni.K6,tN=Ni.M7,iN=Ni.ls,nN=Ni.Hi,Gx=Ni.EY,sN=Ni.MR,rN=Ni.zf,zt=Ni.Ay,sP=Ni.yo;const hE=Object.freeze(Object.defineProperty({__proto__:null,BaseProperty:X3,Behavior:nP,Block:jx,DefaultValues:Y3,FontLibrary:O_,FontVariant:K3,InheritableProperty:J3,Inline:EA,InlineBlock:Z3,InlineGlyph:$3,MSDFFontMaterialUtils:eN,MaterialTransformers:tN,MeshUIBaseElement:iN,ShaderChunkUI:nN,Text:Gx,TypographicFont:sN,TypographicGlyph:rN,default:zt,update:sP},Symbol.toStringTag,{value:"Module"}));class oN{constructor(){c(this,"Rad2Deg",180/Math.PI);c(this,"Deg2Rad",Math.PI/180);c(this,"Epsilon",1e-5)}random(t,e){return t!==void 0&&e!==void 0?Math.random()*(e-t)+t:Math.random()}randomVector3(t,e=0,i=1){t.x=this.random(e,i),t.y=this.random(e,i),t.z=this.random(e,i)}clamp(t,e,i){return t<e?e:t>i?i:t}clamp01(t){return this.clamp(t,0,1)}lerp(t,e,i){return i=i<0?0:i,i=i>1?1:i,t+(e-t)*i}inverseLerp(t,e,i){return(i-t)/(e-t)}remap(t,e,i,s,r){return s+(r-s)*(t-e)/(i-e)}moveTowards(t,e,i){return t+=i,(i<0&&t<e||i>0&&t>e)&&(t=e),t}toDegrees(t){return t*180/Math.PI}toRadians(t){return t*Math.PI/180}tan(t){return Math.tan(t)}gammaToLinear(t){return Math.pow(t,2.2)}linearToGamma(t){return Math.pow(t,1/2.2)}approximately(t,e,i=Number.EPSILON){for(const s of aN){const r=t[s],o=e[s];if(r===void 0||o===void 0)break;if(Math.abs(r-o)>i)return!1}return!0}easeInOutCubic(t){return t<.5?4*t*t*t:1-Math.pow(-2*t+2,3)/2}}const aN=["x","y","z","w"],Ae=new oN;class uE{constructor(t){c(this,"y");c(this,"s");c(this,"alpha",0);this.setAlpha(t),this.y=null,this.s=null}setAlpha(t){if(t<=0||t>1)throw new Error;this.alpha=t}filter(t,e){e&&this.setAlpha(e);let i;return this.y?i=this.alpha*t+(1-this.alpha)*this.s:i=t,this.y=t,this.s=i,i}lastValue(){return this.y}reset(t){this.y=t,this.s=t}}class H0{constructor(t,e=1,i=0,s=1){c(this,"freq");c(this,"minCutOff");c(this,"beta");c(this,"dCutOff");c(this,"x");c(this,"dx");c(this,"lasttime");if(t<=0||e<=0||s<=0)throw new Error;this.freq=t,this.minCutOff=e,this.beta=i,this.dCutOff=s,this.x=new uE(this.alpha(this.minCutOff)),this.dx=new uE(this.alpha(this.dCutOff)),this.lasttime=null}alpha(t){const e=1/this.freq;return 1/(1+1/(2*Math.PI*t)/e)}filter(t,e=null){this.lasttime&&e&&(this.freq=1/(e-this.lasttime)),this.lasttime=e;const i=this.x.lastValue(),s=i?(t-i)*this.freq:0,r=this.dx.filter(s,this.alpha(this.dCutOff)),o=this.minCutOff+this.beta*Math.abs(r);return this.x.filter(t,this.alpha(o))}reset(t){t!=null&&this.x.reset(t),this.x.alpha=this.alpha(this.minCutOff),this.dx.alpha=this.alpha(this.dCutOff),this.lasttime=null}}class rP{constructor(t,e=1,i=0,s=1){c(this,"x");c(this,"y");c(this,"z");this.x=new H0(t,e,i,s),this.y=new H0(t,e,i,s),this.z=new H0(t,e,i,s)}filter(t,e,i=null){e.x=this.x.filter(t.x,i),e.y=this.y.filter(t.y,i),e.z=this.z.filter(t.z,i)}reset(t){this.x.reset(t==null?void 0:t.x),this.y.reset(t==null?void 0:t.y),this.z.reset(t==null?void 0:t.z)}}class oP extends J{constructor(t,e,i,s=128){if(e<=0||i<=0||s<=0)throw new Error("GroundedSkybox height, radius, and resolution must be positive.");const r=new Qd(i,2*s,s);r.scale(1,1,-1);const o=r.getAttribute("position"),a=new C;for(let l=0;l<o.count;++l)if(a.fromBufferAttribute(o,l),a.y<0){const h=-e*3/2,u=a.y<h?-e/a.y:1-a.y*a.y/(3*h*h);a.multiplyScalar(u),a.toArray(o.array,3*l)}o.needsUpdate=!0,super(r,new St({map:t,depthWrite:!1}))}}const IA="needle:cameraController";function lN(n){return n[IA]}function dE(n,t,e){e?n[IA]=t:n[IA]===t&&(n[IA]=null)}const L_="needle:autofit";function cN(n){return n[L_]===void 0?!0:n[L_]!==!1}function fE(n,t){n[L_]=t}function vq(n,t,e){const i=n.length(),s=t.length(),r=Ae.lerp(i,s,e);return n.lerp(t,e).normalize().multiplyScalar(r)}const V0=new ne,hN=new ne().setFromAxisAngle(new C(0,1,0),Math.PI);function yq(n,t){n.lookAt(t),n.quaternion.multiply(hN)}function Ay(n,t,e=!0,i=!1){if(n===t)return;V0.copy(n.quaternion);const s=qe(t),r=qe(n);if(i){if(Oo(n,Nt(t)),e){const o=r.y,a=r.sub(lP(n));a.y=o,n.lookAt(a)}Number.isNaN(n.quaternion.x)&&n.quaternion.copy(V0);return}e&&(s.y=r.y),n.lookAt(s),Number.isNaN(n.quaternion.x)&&n.quaternion.copy(V0)}const uN=new ko(()=>new C,100);function Pi(n,t,e){const i=uN.get();return n instanceof C?i.copy(n):n instanceof DOMPointReadOnly?i.set(n.x,n.y,n.z):(typeof n=="number"&&(i.x=n),typeof t=="number"&&(i.y=t),typeof e=="number"&&(i.z=e)),i}const dN=new ko(()=>new ne,100);function Gu(n){const t=dN.get();return n instanceof ne?t.copy(n):n instanceof DOMPointReadOnly&&t.set(n.x,n.y,n.z,n.w),t}const Hx=new ko(()=>new C,100),pE=Symbol("lastMatrixWorldUpdateKey");function qe(n,t=null,e=!0){const i=t??Hx.get();return n?n.parent?(e&&n.updateWorldMatrix(!0,!1),n.matrixWorldNeedsUpdate&&n[pE]!==Date.now()&&(n[pE]=Date.now(),n.updateMatrixWorld()),i.setFromMatrixPosition(n.matrixWorld),i):i.copy(n.position):i.set(0,0,0)}function Ts(n,t){if(!n)return n;const e=Hx.get();return t!==e&&e.copy(t),((n==null?void 0:n.parent)??n).worldToLocal(e),n.position.set(e.x,e.y,e.z),n}function Pd(n,t,e,i){const s=Hx.get();return s.set(t,e,i),Ts(n,s),n}const av=new ko(()=>new ne,100),yh=new ne,W0=new ne;function Nt(n,t=null){if(!n)return av.get().identity();const e=t??av.get();return n.parent?(n.getWorldQuaternion(e),e):e.copy(n.quaternion)}function Oo(n,t){if(!n)return;t!==yh&&yh.copy(t);const e=yh,i=n==null?void 0:n.parent;i==null||i.getWorldQuaternion(W0),W0.invert();const s=W0.multiply(e);n.quaternion.set(s.x,s.y,s.z,s.w)}function aP(n,t,e,i,s){yh.set(t,e,i,s),Oo(n,yh)}const fN=new ko(()=>new C,100),pN=new C;function ai(n,t=null){return t||(t=fN.get()),n?n.parent?(n.getWorldScale(t),t):t.copy(n.scale):t.set(0,0,0)}function lv(n,t){if(!n)return;if(!n.parent){n.scale.copy(t);return}const e=pN;n.parent.getWorldScale(e),n.scale.copy(t),n.scale.divide(e)}const gN=new C,gE=new ne;function bq(n){return Nt(n,gE),gN.set(0,0,1).applyQuaternion(gE)}const mN=new ko(()=>new C,100),mE=new ne;function lP(n,t){return t||(t=mN.get().set(0,0,1)),Nt(n,mE),t.applyQuaternion(mE)}const AE=new fi,vE=new fi,AN=new C;function cP(n){const t=av.get();return n.getWorldQuaternion(t),vE.setFromQuaternion(t),vE}function hP(n,t){const e=av.get();Oo(n,e.setFromEuler(t))}function vy(n){const t=cP(n),e=AN;return e.set(t.x,t.y,t.z),e.x=Ae.toDegrees(e.x),e.y=Ae.toDegrees(e.y),e.z=Ae.toDegrees(e.z),e}function uP(n,t){yy(n,t.x,t.y,t.z,!0)}function yy(n,t,e,i,s=!0){s&&(t=Ae.toRadians(t),e=Ae.toRadians(e),i=Ae.toRadians(i)),AE.set(t,e,i),yh.setFromEuler(AE),Oo(n,yh)}function F_(n,t=!0){n&&(t?function e(i){console.groupCollapsed((i.name?i.name:"(no name : "+i.type+")")+" %o",i),i.children.forEach(e),console.groupEnd()}(n):n.traverse(function(e){for(var i="|___",s=e;s.parent!==null;)i="	"+i,s=s.parent;console.log(i+e.name+" <"+e.type+">")}))}function _q(n){let t=(n==null?void 0:n.name)||"";if(!n)return t;let e=n.parent;for(;e;)t=e.name+"/"+t,e=e.parent;return t}function vN(n){if(n){const t=n;return t.blendMode!==void 0&&t.clampWhenFinished!==void 0&&t.enabled!==void 0&&t.fadeIn!==void 0&&t.getClip!==void 0}return!1}class ia{static createBlitMaterial(t){return new $e({uniforms:{map:new $(null)},vertexShader:this.vertex,fragmentShader:t})}static copyTexture(t,e){const i=e??this.blipMaterial;i.uniforms.map.value=t,i.needsUpdate=!0,i.uniformsNeedUpdate=!0,this.blipMaterial||(this.blipMaterial=new $e({uniforms:{map:new $(null)},vertexShader:this.vertex,fragmentShader:this.fragment})),this.mesh||(this.mesh=new J(this.planeGeometry,this.blipMaterial));const s=this.mesh;s.material=i,s.frustumCulled=!1,this.scene.children.length=0,this.scene.add(s),this.renderer||(this.renderer=new Hh({antialias:!1})),this.renderer.setSize(t.image.width,t.image.height),this.renderer.clear(),this.renderer.render(this.scene,this.perspectiveCam);const r=new pt(this.renderer.domElement);return r.name="Copy",r.needsUpdate=!0,r}static textureToCanvas(t,e){if(!t)return null;(e===!0||t.isCompressedTexture===!0)&&(t=yN(t));const i=t.image;if(bN(i)){const s=document.createElement("canvas");s.width=i.width,s.height=i.height;const r=s.getContext("2d");return r?(r.drawImage(i,0,0,i.width,i.height,0,0,s.width,s.height),s):(console.error("Failed getting canvas 2d context"),null)}return null}}c(ia,"planeGeometry",new Ys(2,2,1,1)),c(ia,"renderer"),c(ia,"perspectiveCam",new xt),c(ia,"scene",new Ws),c(ia,"vertex",`
    varying vec2 vUv;
    void main(){
        vUv = uv;
        gl_Position = vec4(position.xy * 1.0,0.,.999999);
    }`),c(ia,"fragment",`
    uniform sampler2D map; 
    varying vec2 vUv;
    void main(){ 
        vec2 uv = vUv;
        uv.y = 1.0 - uv.y;
        gl_FragColor = texture2D( map, uv);
        // gl_FragColor = vec4(uv.xy, 0, 1);
    }`),c(ia,"blipMaterial"),c(ia,"mesh");function yN(n){return ia.copyTexture(n)}function wq(n,t=!1){return ia.textureToCanvas(n,t)}function bN(n){return typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&n instanceof OffscreenCanvas||typeof ImageBitmap<"u"&&n instanceof ImageBitmap}function _N(n){const t=n.type;return t==="Mesh"||t==="SkinnedMesh"}function dP(n,t=[]){const e=new Nn;e.makeEmpty();const i=[];function s(o){let a=!0;if(o.visible&&cN(o)!==!1&&!(o.type==="TransformControlsGizmo"||o.type==="TransformControlsPlane")&&(o instanceof TR&&(a=!1),o instanceof cx&&(a=!1),o instanceof oP&&(a=!1),o.material instanceof IR&&(a=!1),_N(o)||(a=!1),!(t!=null&&t.includes(o))&&o.isUI!==!0)){if(a){const l=o.children;o.children=i;const h=o.position,u=o.scale;if(Number.isNaN(h.x)||Number.isNaN(h.y)||Number.isNaN(h.z)){console.warn(`Object "${o.name}" has NaN values in position or scale.... will ignore it`,h,u);return}e.expandByObject(o,!0),o.children=l}for(const l of o.children)s(l)}}let r=!1;for(const o of n)o&&(r=!0,o.updateMatrixWorld(),s(o));return r||console.warn("No objects to fit camera to..."),e}let wm=!1;gL((...n)=>{var t;xe()&&((t=mt.Current)!=null&&t.isInXR)&&(dg(!0),fP("error",...n))});function dg(n){if(n){if(wm)return;wm=!0,xN()}else{if(!wm)return;wm=!1,CN()}}const pp={log:void 0,warn:void 0,error:void 0};class wN{constructor(){c(this,"familyName","needle-xr");c(this,"root",null);c(this,"context",null);c(this,"defaultFontSize",.06);c(this,"targetObject",new re);c(this,"userForwardViewPoint",new C);c(this,"oneEuroFilter",new rP(90,.8));c(this,"_lastElementRemoveTime",0);c(this,"onBeforeRender",()=>{var e,i;const t=(e=this.context)==null?void 0:e.mainCamera;if(this.context&&t instanceof xt){const s=this.getRoot();Number.isNaN(s.position.x)&&s.position.set(0,0,0),Number.isNaN(s.quaternion.x)&&s.quaternion.set(0,0,0,1),this.context.scene.add(this.targetObject);const r=((i=this.context.xr)==null?void 0:i.rigScale)??1,o=3.5*r,a=t.worldForward;a.y=0,a.normalize().multiplyScalar(o),this.userForwardViewPoint.copy(t.worldPosition).sub(a),this.targetObject.position.distanceTo(this.userForwardViewPoint)>2*r&&(this.targetObject.position.copy(this.userForwardViewPoint),Ay(this.targetObject,t,!0,!0),this.targetObject.rotateY(Math.PI)),this.oneEuroFilter.filter(this.targetObject.position,s.position,this.context.time.time);const h=this.context.time.deltaTime;if(s.quaternion.slerp(this.targetObject.quaternion,h*5),s.scale.setScalar(r),this.targetObject.removeFromParent(),this.context.scene.add(s),this.context.time.time-this._lastElementRemoveTime>.1){this._lastElementRemoveTime=this.context.time.time;const u=Date.now();for(let d=0;d<this._activeTexts.length;d++){const f=this._activeTexts[d];if(f instanceof zt.Text&&u-f._activatedTime>2e4){f.removeFromParent(),this._textBuffer.push(f),this._activeTexts.splice(d,1);break}}}}});c(this,"textOptions",{fontSize:this.defaultFontSize,fontFamily:this.familyName,padding:.03,margin:.005,color:0,backgroundColor:16777215,backgroundOpacity:.4,borderRadius:.03,offset:.025});c(this,"_textBuffer",[]);c(this,"_activeTexts",[]);this.ensureFont()}onEnable(){this.context=mt.Current||mt.All[0],this.context.pre_render_callbacks.push(this.onBeforeRender)}onDisable(){var t,e,i;(e=this.context)==null||e.pre_render_callbacks.splice((t=this.context)==null?void 0:t.pre_render_callbacks.indexOf(this.onBeforeRender),1),(i=this.root)==null||i.removeFromParent()}addLog(t,e){const i=this.getRoot(),s=this.getText();let r=16777215,o=0;switch(t){case"log":r=16777215,o=0;break;case"warn":r=16772761,o=4465152;break;case"error":r=16755370,o=7798784;break}e.length>1e3&&(e=e.substring(0,1e3)+"...");const a=new Date().toISOString().split("T")[1].split(".")[0];s.textContent="["+a+"] "+e,s.visible=!0,s._activatedTime=Date.now(),i.add(s),this._activeTexts.push(s),this.context&&this.context.scene.add(i),s.set({backgroundColor:r,color:o}),zt.update()}ensureFont(){let t=zt.FontLibrary.getFontFamily(this.familyName);if(!t){t=zt.FontLibrary.addFontFamily(this.familyName);const e=t.addVariant("normal","normal","./include/needle/arial-msdf.json","./include/needle/arial.png");e==null||e.addEventListener("ready",()=>{zt.update()})}}getText(){const t=this.getRoot();if(this._textBuffer.length>0){const i=this._textBuffer.pop();return i.visible=!0,setTimeout(()=>this.disableDepthTestRecursive(i),100),i}if(t.children.length>20&&this._activeTexts.length>0)return this._activeTexts.shift();const e=new zt.Text(this.textOptions);return setTimeout(()=>this.disableDepthTestRecursive(e),500),setTimeout(()=>this.disableDepthTestRecursive(e),1500),e}disableDepthTestRecursive(t,e=0){for(let s=0;s<t.children.length;s++){const r=t.children[s];r instanceof re&&this.disableDepthTestRecursive(r,e+1)}t.renderOrder=10*e,t.layers.set(2);const i=t.material;i&&(i.depthWrite=!1,i.depthTest=!1,i.transparent=!0),e===0&&zt.update()}getRoot(){if(this.root)return this.root;const t=this.defaultFontSize,e={boxSizing:"border-box",fontFamily:this.familyName,width:"2.6",fontSize:t,color:0,lineHeight:1,backgroundColor:16777215,backgroundOpacity:0,whiteSpace:"pre-wrap",flexDirection:"column-reverse"};return this.root=new zt.Block(e),this.root}}let Cs=null;function xN(){Cs||(Cs=new wN),Cs.onEnable();for(const n in pp){pp[n]=console[n];let t=!1;console[n]=function(){var e;if((e=pp[n])==null||e.apply(console,arguments),!t)try{t=!0,fP(n,...arguments)}finally{t=!1}}}}function CN(){Cs==null||Cs.onDisable();for(const n in pp)console[n]=pp[n]}const bf=new Map;function fP(n,...t){try{switch(bf.clear(),n){case"log":Cs==null||Cs.addLog("log",e());break;case"warn":Cs==null||Cs.addLog("warn",e());break;case"error":Cs==null||Cs.addLog("error",e());break}}catch(r){console.error("Error in spatial console",r)}finally{bf.clear()}function e(){let r="";for(let o=0;o<t.length;o++){const a=t[o];r+=i(a),o<t.length-1&&(r+=", ")}return r}function i(r,o=0){if(typeof r=="string")return'"'+r+'"';if(typeof r=="number"){if(r%1!==0){const l=r.toFixed(5),h=l.indexOf(".");let u=l.length-1;for(;u>h&&l[u]==="0";)u--;return l.substring(0,u+1)}return r.toString()}else if(Array.isArray(r)){let a="[";for(let l=0;l<r.length;l++){const h=r[l];a+=i(h,o+1),l<r.length-1&&(a+=", ")}return a+="]",a}else{if(r===null)return"null";if(r===void 0)return"undefined";if(typeof r=="function")return r.name+"()"}if(r instanceof ae)return`(${i(r.x)}, ${i(r.y)})`;if(r instanceof C)return`(${i(r.x)}, ${i(r.y)}, ${i(r.z)})`;if(r instanceof ke)return`(${i(r.x)}, ${i(r.y)}, ${i(r.z)}, ${i(r.w)})`;if(r instanceof ne)return`(${i(r.x)}, ${i(r.y)}, ${i(r.z)}, ${i(r.w)})`;if(r instanceof ft||r instanceof pt)return r.name;if(r instanceof gc)return`[${r.elements.join(", ")}]`;if(r instanceof ce)return`[${r.elements.join(", ")}]`;if(r instanceof $r)return r.mask.toString();if(typeof r=="object"){if(bf.has(r))return"*";let a=`{
`;a+=s(o);const l=Object.keys(r);let h="";for(let u=0;u<l.length;u++){const d=l[u],f=r[d];if(bf.has(f)){h+="";continue}bf.set(f,!0),h+=d+":"+i(f,o+1),u<l.length-1&&(h+=", "),h.length>=60&&(h+=`
`,h+=s(o),a+=h,h="")}return a+=h,a+=`
}`,a}return r}function s(r){let o="";for(let a=0;a<r;a++)o+=" ";return o}}const SN=N("nodevlogs");function Ci(n,t=Ui.Log){xa(t,n)}function Yt(n){Ci(n,Ui.Warn)}function pP(n){Ci(n,Ui.Error)}let U_;function xe(){return SN?!1:U_!==void 0?U_:qs()}function xq(n){U_=n}const gP=N("debugdefines");Gd('if(!globalThis[""3.40.0-alpha.4""]) globalThis[""3.40.0-alpha.4""] = "0.0.0";');Gd('if(!globalThis[""Needle Engine for Blender 0.44.2""]) globalThis[""Needle Engine for Blender 0.44.2""] = "unknown";');Gd('if(!globalThis[""Thu Jun 13 2024 16:48:55 GMT+0700 (Indochina Time)""]) globalThis[""Thu Jun 13 2024 16:48:55 GMT+0700 (Indochina Time)""] = "unknown";');Gd('globalThis["__NEEDLE_ENGINE_VERSION__"] = "3.40.0-alpha.4";');Gd('globalThis["__NEEDLE_ENGINE_GENERATOR__"] = "Needle Engine for Blender 0.44.2";');Gd('globalThis["__NEEDLE_PROJECT_BUILD_TIME__"] = "Thu Jun 13 2024 16:48:55 GMT+0700 (Indochina Time)";');const Eo="3.40.0-alpha.4",Vx="Needle Engine for Blender 0.44.2",mP="Thu Jun 13 2024 16:48:55 GMT+0700 (Indochina Time)";gP&&console.log(`Engine version: ${Eo} (generator: ${Vx})
Project built at ${mP}`);const Cc="needle_isActiveInHierarchy",Du="builtin_components",TA="needle_editor_guid";function Gd(n){try{(0,eval)(n)}catch(t){gP&&console.error(t)}}const EN='<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 160 187.74"><defs><linearGradient id="a" x1="89.64" y1="184.81" x2="90.48" y2="21.85" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#62d399"/><stop offset=".51" stop-color="#acd842"/><stop offset=".9" stop-color="#d7db0a"/></linearGradient><linearGradient id="b" x1="69.68" y1="178.9" x2="68.08" y2="16.77" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#0ba398"/><stop offset=".5" stop-color="#4ca352"/><stop offset="1" stop-color="#76a30a"/></linearGradient><linearGradient id="c" x1="36.6" y1="152.17" x2="34.7" y2="84.19" gradientUnits="userSpaceOnUse"><stop offset=".19" stop-color="#36a382"/><stop offset=".54" stop-color="#49a459"/><stop offset="1" stop-color="#76a30b"/></linearGradient><linearGradient id="d" x1="15.82" y1="153.24" x2="18" y2="90.86" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#267880"/><stop offset=".51" stop-color="#457a5c"/><stop offset="1" stop-color="#717516"/></linearGradient><linearGradient id="e" x1="135.08" y1="135.43" x2="148.93" y2="63.47" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#b0d939"/><stop offset="1" stop-color="#eadb04"/></linearGradient><linearGradient id="f" x1="-4163.25" y1="2285.12" x2="-4160.81" y2="2215.34" gradientTransform="rotate(20 4088.49 13316.712)" gradientUnits="userSpaceOnUse"><stop offset=".17" stop-color="#74af52"/><stop offset=".48" stop-color="#99be32"/><stop offset="1" stop-color="#c0c40a"/></linearGradient><symbol id="g" viewBox="0 0 160 187.74"><path style="fill:url(#a)" d="M79.32 36.98v150.76L95 174.54l6.59-156.31-22.27 18.75z"/><path style="fill:url(#b)" d="M79.32 36.98 57.05 18.23l6.59 156.31 15.68 13.2V36.98z"/><path style="fill:url(#c)" d="m25.19 104.83 8.63 49.04 12.5-14.95-2.46-56.42-18.67 22.33z"/><path style="fill:url(#d)" d="M25.19 104.83 0 90.24l16.97 53.86 16.85 9.77-8.63-49.04z"/><path style="fill:#9c3" d="M43.86 82.5 18.69 67.98 0 90.24l25.18 14.59L43.86 82.5z"/><path style="fill:url(#e)" d="m134.82 78.69-9.97 56.5 15.58-9.04L160 64.1l-25.18 14.59z"/><path style="fill:url(#f)" d="m134.82 78.69-18.68-22.33-2.86 65 11.57 13.83 9.97-56.5z"/><path style="fill:#ffe113" d="m160 64.1-18.69-22.26-25.17 14.52 18.67 22.33L160 64.1z"/><path style="fill:#f3e600" d="M101.59 18.23 79.32 0 57.05 18.23l22.27 18.75 22.27-18.75z"/></symbol></defs><use width="160" height="187.74" xlink:href="#g"/></svg>',IN=btoa(EN),TN="data:image/svg+xml;base64,"+IN,RN=TN,BN=`<?xml version="1.0" encoding="UTF-8"?> <!DOCTYPE svg PUBLIC '-//W3C//DTD SVG 1.1//EN' 'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'> <svg clip-rule="evenodd" fill-rule="evenodd" stroke-linejoin="round" stroke-miterlimit="2" version="1.1" viewBox="0 0 1014 282" xml:space="preserve" xmlns="http://www.w3.org/2000/svg"> <g transform="matrix(1.008 0 0 1.008 -2.239 .61874)"> <path d="m665.95 132.73v44.88l-10.56-8.4c-0.8-0.64-1.2-1.44-1.2-2.4v-32.4c0-6.48-4.12-9.72-12.36-9.72-2.16 0-4.18 0.4-6.06 1.2s-3.54 1.8-4.98 3-2.56 2.5-3.36 3.9-1.2 2.7-1.2 3.9v40.92l-10.68-8.4c-0.72-0.64-1.08-1.44-1.08-2.4v-53.76l10.92 8.52c0.32 0.24 0.56 0.44 0.72 0.6s0.36 0.32 0.6 0.48c0.96-1.2 2.14-2.28 3.54-3.24s2.92-1.76 4.56-2.4 3.34-1.14 5.1-1.5 3.44-0.54 5.04-0.54c1.44 0 2.92 0.04 4.44 0.12s2.84 0.28 3.96 0.6c4.56 1.12 7.8 3.12 9.72 6s2.88 6.56 2.88 11.04z" fill-rule="nonzero"/> </g> <g transform="matrix(1.008 0 0 1.008 -2.239 .61874)"> <path d="m732.38 146.05c0 0.88 0.02 1.5 0.06 1.86s-0.02 0.98-0.18 1.86h-7.08c-2.08 0-4.44-0.02-7.08-0.06s-5.36-0.06-8.16-0.06h-22.08c0 2.88 0.56 5.36 1.68 7.44s2.6 3.8 4.44 5.16 3.94 2.36 6.3 3 4.74 0.96 7.14 0.96c3.04 0 5.9-0.76 8.58-2.28s4.94-3.52 6.78-6c0.64 0.56 1.54 1.48 2.7 2.76s2.94 3.2 5.34 5.76c-2.8 3.36-6.22 6.02-10.26 7.98s-8.42 2.94-13.14 2.94-8.92-0.64-12.84-1.92-7.32-3.24-10.2-5.88-5.12-5.98-6.72-10.02-2.4-8.82-2.4-14.34c0-4.96 0.66-9.42 1.98-13.38s3.22-7.32 5.7-10.08 5.44-4.9 8.88-6.42 7.32-2.28 11.64-2.28c5.76 0 10.52 0.88 14.28 2.64s6.72 4.16 8.88 7.2 3.66 6.54 4.5 10.5 1.26 8.18 1.26 12.66zm-29.4-22.8c-2.16 0.16-4.16 0.72-6 1.68s-3.42 2.2-4.74 3.72-2.36 3.28-3.12 5.28-1.14 4.12-1.14 6.36h33.12c0-2-0.22-4.06-0.66-6.18s-1.3-4.02-2.58-5.7-3.1-3.02-5.46-4.02-5.5-1.38-9.42-1.14z" fill-rule="nonzero"/> </g> <g transform="matrix(1.008 0 0 1.008 -2.239 .61874)"> <path d="m795.93 146.05c0 0.88 0.02 1.5 0.06 1.86s-0.02 0.98-0.18 1.86h-7.08c-2.08 0-4.44-0.02-7.08-0.06s-5.36-0.06-8.16-0.06h-22.08c0 2.88 0.56 5.36 1.68 7.44s2.6 3.8 4.44 5.16 3.94 2.36 6.3 3 4.74 0.96 7.14 0.96c3.04 0 5.9-0.76 8.58-2.28s4.94-3.52 6.78-6c0.64 0.56 1.54 1.48 2.7 2.76s2.94 3.2 5.34 5.76c-2.8 3.36-6.22 6.02-10.26 7.98s-8.42 2.94-13.14 2.94-8.92-0.64-12.84-1.92-7.32-3.24-10.2-5.88-5.12-5.98-6.72-10.02-2.4-8.82-2.4-14.34c0-4.96 0.66-9.42 1.98-13.38s3.22-7.32 5.7-10.08 5.44-4.9 8.88-6.42 7.32-2.28 11.64-2.28c5.76 0 10.52 0.88 14.28 2.64s6.72 4.16 8.88 7.2 3.66 6.54 4.5 10.5 1.26 8.18 1.26 12.66zm-29.4-22.8c-2.16 0.16-4.16 0.72-6 1.68s-3.42 2.2-4.74 3.72-2.36 3.28-3.12 5.28-1.14 4.12-1.14 6.36h33.12c0-2-0.22-4.06-0.66-6.18s-1.3-4.02-2.58-5.7-3.1-3.02-5.46-4.02-5.5-1.38-9.42-1.14z" fill-rule="nonzero"/> </g> <g transform="matrix(1.008 0 0 1.008 -2.239 .61874)"> <path d="m858.57 97.21c0.64 0.48 0.96 1.16 0.96 2.04v74.88c-0.08 1.04-0.12 2.12-0.12 3.24-1.84-1.52-3.56-2.92-5.16-4.2-1.36-1.12-2.66-2.18-3.9-3.18s-2.06-1.66-2.46-1.98c-1.76 2.48-4.26 4.44-7.5 5.88s-7.02 2.16-11.34 2.16c-3.84 0-7.4-0.7-10.68-2.1s-6.14-3.44-8.58-6.12-4.34-5.94-5.7-9.78-2.04-8.16-2.04-12.96c0-4.32 0.78-8.34 2.34-12.06s3.6-6.92 6.12-9.6 5.38-4.78 8.58-6.3 6.48-2.28 9.84-2.28c2.56 0 4.82 0.22 6.78 0.66s3.68 1.06 5.16 1.86 2.78 1.74 3.9 2.82 2.16 2.22 3.12 3.42v-35.04l10.68 8.64zm-27.96 67.92c3.6 0 6.52-0.68 8.76-2.04s3.98-3.06 5.22-5.1 2.1-4.22 2.58-6.54 0.72-4.44 0.72-6.36v-1.2c0-1.12-0.22-2.7-0.66-4.74s-1.28-4.06-2.52-6.06-3-3.7-5.28-5.1-5.22-2.02-8.82-1.86c-3.44 0-6.26 0.74-8.46 2.22s-3.96 3.26-5.28 5.34-2.24 4.2-2.76 6.36-0.78 3.92-0.78 5.28c0 1.84 0.24 3.92 0.72 6.24s1.36 4.48 2.64 6.48 3.04 3.68 5.28 5.04 5.12 2.04 8.64 2.04z" fill-rule="nonzero"/> </g> <g transform="matrix(1.008 0 0 1.008 -2.239 .61874)"> <path d="m882.81 97.09c0.64 0.48 0.96 1.12 0.96 1.92l-0.12 41.04v37.08l-10.56-8.4c-0.72-0.64-1.08-1.44-1.08-2.4v-77.88l10.8 8.64z" fill-rule="nonzero"/> </g> <g transform="matrix(1.008 0 0 1.008 -2.239 .61874)"> <path d="m950.36 146.05c0 0.88 0.02 1.5 0.06 1.86s-0.02 0.98-0.18 1.86h-7.08c-2.08 0-4.44-0.02-7.08-0.06s-5.36-0.06-8.16-0.06h-22.08c0 2.88 0.56 5.36 1.68 7.44s2.6 3.8 4.44 5.16 3.94 2.36 6.3 3 4.74 0.96 7.14 0.96c3.04 0 5.9-0.76 8.58-2.28s4.94-3.52 6.78-6c0.64 0.56 1.54 1.48 2.7 2.76s2.94 3.2 5.34 5.76c-2.8 3.36-6.22 6.02-10.26 7.98s-8.42 2.94-13.14 2.94-8.92-0.64-12.84-1.92-7.32-3.24-10.2-5.88-5.12-5.98-6.72-10.02-2.4-8.82-2.4-14.34c0-4.96 0.66-9.42 1.98-13.38s3.22-7.32 5.7-10.08 5.44-4.9 8.88-6.42 7.32-2.28 11.64-2.28c5.76 0 10.52 0.88 14.28 2.64s6.72 4.16 8.88 7.2 3.66 6.54 4.5 10.5 1.26 8.18 1.26 12.66zm-29.4-22.8c-2.16 0.16-4.16 0.72-6 1.68s-3.42 2.2-4.74 3.72-2.36 3.28-3.12 5.28-1.14 4.12-1.14 6.36h33.12c0-2-0.22-4.06-0.66-6.18s-1.3-4.02-2.58-5.7-3.1-3.02-5.46-4.02-5.5-1.38-9.42-1.14z" fill-rule="nonzero"/> </g> <g transform="matrix(1.8559 0 0 .7642 45.348 36.475)"> <g transform="translate(2.7114)"> <path d="m3.935 173.02c-0.331 0-0.497-0.402-0.497-1.207v-51.002c0-0.738 0.138-1.107 0.414-1.107h1.781c0.277 0 0.415 0.335 0.415 1.006v5.935c0 0.336 0.027 0.553 0.083 0.654 0.055 0.101 0.151-0.017 0.289-0.352 0.912-1.744 1.754-3.236 2.527-4.477 0.773-1.24 1.554-2.179 2.341-2.816s1.65-0.956 2.588-0.956c1.685 0 3.011 0.922 3.977 2.766 0.967 1.845 1.602 3.84 1.905 5.986 0.056 0.268 0.139 0.369 0.249 0.302s0.221-0.235 0.331-0.503c0.939-1.811 1.802-3.353 2.589-4.628 0.787-1.274 1.581-2.246 2.382-2.917s1.671-1.006 2.61-1.006c2.016 0 3.569 1.392 4.66 4.175 1.09 2.783 1.636 6.421 1.636 10.915v37.925c0 0.871-0.18 1.307-0.539 1.307h-1.739c-0.138 0-0.249-0.1-0.332-0.301-0.083-0.202-0.124-0.503-0.124-0.906v-36.315c0-3.555-0.338-6.321-1.015-8.3-0.676-1.978-1.76-2.967-3.251-2.967-0.884 0-1.726 0.386-2.527 1.157s-1.519 1.727-2.154 2.867-1.201 2.213-1.699 3.219c-0.248 0.469-0.421 0.905-0.517 1.308-0.097 0.402-0.145 0.972-0.145 1.71v37.221c0 0.871-0.166 1.307-0.497 1.307h-1.74c-0.166 0-0.29-0.1-0.373-0.301-0.083-0.202-0.124-0.503-0.124-0.906v-36.315c0-3.555-0.332-6.321-0.994-8.3-0.663-1.978-1.754-2.967-3.273-2.967-1.242 0-2.375 0.704-3.396 2.112-1.022 1.409-2.223 3.555-3.604 6.439v39.031c0 0.805-0.18 1.207-0.539 1.207h-1.698z" fill-rule="nonzero" stroke="#000" stroke-width=".7px"/> </g> <g transform="translate(2.7114)"> <path d="m53.642 166.28c-1.077 2.549-2.237 4.477-3.479 5.785-1.243 1.307-2.61 1.961-4.101 1.961-2.154 0-3.853-1.324-5.095-3.973-1.243-2.649-1.864-6.187-1.864-10.613 0-3.488 0.4-6.489 1.201-9.004s1.988-4.51 3.562-5.985c1.574-1.476 3.521-2.414 5.841-2.817l3.686-0.704c0.221-0.067 0.394-0.218 0.518-0.453 0.124-0.234 0.187-0.587 0.187-1.056v-2.917c0-3.89-0.504-6.975-1.512-9.255s-2.354-3.42-4.039-3.42c-1.298 0-2.472 0.72-3.521 2.162s-2.002 3.572-2.858 6.388c-0.083 0.268-0.159 0.453-0.228 0.554-0.069 0.1-0.172 0.083-0.311-0.051l-1.698-1.71c-0.083-0.134-0.138-0.285-0.166-0.453-0.027-0.167 0.014-0.452 0.125-0.855 0.856-3.353 2.009-6.052 3.459-8.098 1.449-2.045 3.224-3.068 5.322-3.068 1.74 0 3.211 0.687 4.412 2.062s2.112 3.37 2.734 5.986c0.621 2.615 0.932 5.7 0.932 9.255v35.712c0 0.536-0.035 0.888-0.104 1.056s-0.2 0.251-0.393 0.251h-1.533c-0.166 0-0.29-0.117-0.373-0.352-0.083-0.234-0.124-0.553-0.124-0.955l-0.083-5.231c-0.055-0.939-0.221-1.006-0.497-0.202zm0.456-19.314c0-1.14-0.194-1.643-0.58-1.509l-3.107 0.603c-1.436 0.202-2.686 0.638-3.749 1.308-1.063 0.671-1.953 1.543-2.671 2.616s-1.257 2.33-1.616 3.772-0.538 3.102-0.538 4.98c0 3.152 0.455 5.616 1.367 7.393 0.911 1.778 2.14 2.666 3.686 2.666 0.939 0 1.85-0.419 2.734-1.257s1.671-1.895 2.361-3.169c0.663-1.408 1.181-2.85 1.553-4.326 0.373-1.475 0.56-2.883 0.56-4.225v-8.852z" fill-rule="nonzero" stroke="#000" stroke-width=".7px"/> </g> <g transform="translate(2.7114)"> <path d="m79.034 173.02c-0.166 0-0.297-0.117-0.394-0.352-0.096-0.234-0.145-0.553-0.145-0.955v-4.628c0-0.536-0.041-0.838-0.124-0.905s-0.207 0.1-0.373 0.503c-0.276 0.67-0.69 1.593-1.242 2.766-0.553 1.174-1.271 2.23-2.154 3.169-0.884 0.939-1.961 1.408-3.231 1.408-1.74 0-3.314-0.989-4.722-2.967-1.409-1.979-2.534-4.963-3.376-8.953-0.843-3.991-1.264-8.937-1.264-14.838 0-5.701 0.415-10.68 1.243-14.939s1.988-7.595 3.479-10.009c1.492-2.415 3.204-3.622 5.137-3.622 1.436 0 2.616 0.57 3.541 1.71 0.926 1.14 1.719 2.381 2.382 3.722 0.249 0.47 0.414 0.637 0.497 0.503s0.125-0.536 0.125-1.207v-23.841c0-0.805 0.151-1.208 0.455-1.208h1.864c0.276 0 0.414 0.369 0.414 1.107v72.128c0 0.537-0.041 0.905-0.124 1.107-0.083 0.201-0.235 0.301-0.455 0.301h-1.533zm-0.621-42.049c-0.939-2.213-1.885-3.94-2.838-5.181s-2.009-1.861-3.169-1.861c-1.463 0-2.768 0.889-3.914 2.666s-2.044 4.376-2.693 7.796-0.973 7.578-0.973 12.474c0 5.097 0.338 9.272 1.015 12.524 0.676 3.253 1.567 5.651 2.672 7.193 1.104 1.543 2.305 2.314 3.603 2.314 1.188 0 2.258-0.704 3.211-2.113 0.952-1.408 1.705-3.118 2.257-5.13s0.829-3.957 0.829-5.835v-24.847z" fill-rule="nonzero" stroke="#000" stroke-width=".7px"/> </g> <g transform="translate(2.7114)"> <path d="m89.514 149.38c0 3.42 0.345 6.606 1.035 9.557 0.691 2.951 1.609 5.315 2.755 7.092s2.437 2.666 3.873 2.666c1.519 0 2.837-0.738 3.956-2.213 1.118-1.476 2.064-3.655 2.837-6.539 0.083-0.336 0.166-0.52 0.249-0.554 0.083-0.033 0.179 0.017 0.29 0.151l1.408 1.912c0.221 0.268 0.235 0.67 0.041 1.207-0.69 2.548-1.47 4.661-2.34 6.337-0.87 1.677-1.857 2.935-2.962 3.773-1.104 0.838-2.319 1.257-3.645 1.257-2.043 0-3.838-1.14-5.385-3.42-1.546-2.28-2.761-5.482-3.645-9.607-0.884-4.124-1.325-8.836-1.325-14.134 0-5.901 0.455-10.931 1.367-15.089 0.911-4.158 2.14-7.377 3.686-9.658 1.547-2.28 3.3-3.42 5.261-3.42 1.988 0 3.714 1.073 5.178 3.219 1.463 2.146 2.595 5.231 3.396 9.255s1.201 8.886 1.201 14.587c0 0.469-0.02 0.939-0.062 1.408-0.041 0.469-0.214 0.704-0.517 0.704h-16.362c-0.083 0-0.152 0.151-0.207 0.453-0.056 0.302-0.083 0.654-0.083 1.056zm13.752-6.237c0.304 0 0.497-0.1 0.58-0.302 0.083-0.201 0.124-0.57 0.124-1.106 0-3.219-0.283-6.187-0.849-8.903s-1.367-4.896-2.402-6.539c-1.036-1.643-2.272-2.464-3.708-2.464-1.629 0-2.996 0.955-4.101 2.867-1.104 1.911-1.94 4.342-2.506 7.293s-0.849 6.002-0.849 9.154h13.711z" fill-rule="nonzero" stroke="#000" stroke-width=".7px"/> </g> <g transform="translate(2.7114)"> <path d="m148.54 119.7c0.165 0 0.283 0.117 0.352 0.352s0.076 0.52 0.02 0.855l-6.254 50.902c-0.028 0.47-0.104 0.788-0.228 0.956s-0.297 0.251-0.518 0.251h-1.615c-0.442 0-0.718-0.402-0.829-1.207l-5.26-40.138c-0.111-0.604-0.201-0.905-0.27-0.905s-0.131 0.301-0.186 0.905l-5.012 40.138c-0.028 0.47-0.097 0.788-0.207 0.956-0.111 0.168-0.277 0.251-0.497 0.251h-1.74c-0.442 0-0.718-0.402-0.829-1.207l-6.503-50.801c-0.055-0.403-0.048-0.721 0.021-0.956s0.2-0.352 0.393-0.352h1.823c0.166 0 0.297 0.067 0.393 0.201 0.097 0.134 0.159 0.403 0.187 0.805l5.302 41.848c0.083 0.671 0.179 0.989 0.29 0.956 0.11-0.034 0.207-0.386 0.29-1.056l5.219-41.949c0.055-0.268 0.124-0.47 0.207-0.604s0.193-0.201 0.331-0.201h1.533c0.138 0 0.262 0.067 0.373 0.201 0.11 0.134 0.179 0.403 0.207 0.805l5.468 41.848c0.083 0.671 0.179 0.989 0.29 0.956 0.11-0.034 0.207-0.386 0.29-1.056l5.053-41.849c0.055-0.335 0.138-0.57 0.249-0.704 0.11-0.134 0.234-0.201 0.373-0.201h1.284z" fill-rule="nonzero" stroke="#000" stroke-width=".7px"/> </g> <g transform="translate(2.7114)"> <path d="m156.49 171.51c0 0.604-0.042 1.006-0.125 1.208-0.082 0.201-0.262 0.301-0.538 0.301h-1.533c-0.221 0-0.366-0.083-0.435-0.251s-0.103-0.486-0.103-0.956v-50.902c0-0.805 0.152-1.207 0.456-1.207h1.822c0.304 0 0.456 0.402 0.456 1.207v50.6zm0.165-63.979c0 1.207-0.207 1.811-0.621 1.811h-1.905c-0.221 0-0.366-0.135-0.435-0.403s-0.104-0.67-0.104-1.207v-7.847c0-1.006 0.18-1.509 0.539-1.509h1.988c0.359 0 0.538 0.47 0.538 1.409v7.746z" fill-rule="nonzero" stroke="#000" stroke-width=".7px"/> </g> <g transform="translate(2.7114)"> <path d="m168.3 124.83c-0.221 0-0.331 0.269-0.331 0.805v33.801c0 3.42 0.221 5.667 0.663 6.74 0.441 1.073 1.09 1.609 1.946 1.609h3.024c0.138 0 0.242 0.084 0.311 0.252 0.069 0.167 0.103 0.419 0.103 0.754v2.716c0 0.537-0.138 0.906-0.414 1.107-0.248 0.067-0.614 0.134-1.098 0.201-0.483 0.067-0.959 0.118-1.429 0.151-0.469 0.034-0.828 0.05-1.077 0.05-1.712 0-2.934-0.955-3.665-2.867-0.732-1.911-1.098-5.013-1.098-9.305v-35.108c0-0.604-0.124-0.906-0.373-0.906h-3.521c-0.248 0-0.373-0.268-0.373-0.804v-3.521c0-0.537 0.111-0.805 0.332-0.805h3.686c0.166 0 0.263-0.268 0.29-0.805l0.415-16.095c0-0.805 0.124-1.207 0.372-1.207h1.492c0.303 0 0.455 0.436 0.455 1.307v15.995c0 0.537 0.097 0.805 0.29 0.805h5.468c0.221 0 0.331 0.268 0.331 0.805v3.521c0 0.536-0.124 0.804-0.373 0.804h-5.426z" fill-rule="nonzero" stroke="#000" stroke-width=".7px"/> </g> <g transform="translate(2.7114)"> <path d="m179.4 173.02c-0.331 0-0.497-0.402-0.497-1.207v-72.329c0-0.738 0.138-1.107 0.414-1.107h1.782c0.276 0 0.414 0.336 0.414 1.006v27.162c0 0.335 0.034 0.536 0.103 0.603s0.159-0.033 0.27-0.302c0.994-1.81 1.898-3.319 2.713-4.526 0.814-1.208 1.629-2.113 2.444-2.717 0.814-0.603 1.691-0.905 2.63-0.905 2.182 0 3.839 1.375 4.971 4.125 1.132 2.749 1.698 6.404 1.698 10.965v37.925c0 0.871-0.166 1.307-0.497 1.307h-1.74c-0.165 0-0.29-0.1-0.373-0.301-0.082-0.202-0.124-0.503-0.124-0.906v-36.315c0-3.555-0.366-6.321-1.097-8.3-0.732-1.978-1.899-2.967-3.501-2.967-0.883 0-1.705 0.318-2.464 0.956-0.76 0.637-1.526 1.576-2.299 2.816-0.773 1.241-1.643 2.834-2.61 4.779v39.031c0 0.805-0.179 1.207-0.538 1.207h-1.699z" fill-rule="nonzero" stroke="#000" stroke-width=".7px"/> </g> </g> <g transform="matrix(.80638 0 0 .80638 452.53 65.421)" fill-rule="nonzero"> <path d="m79.32 36.98v150.76l15.68-13.2 6.59-156.31-22.27 18.75z" fill="url(#f)"/> <path d="m79.32 36.98-22.27-18.75 6.59 156.31 15.68 13.2v-150.76z" fill="url(#e)"/> <path d="m25.19 104.83 8.63 49.04 12.5-14.95-2.46-56.42-18.67 22.33z" fill="url(#d)"/> <path d="m25.19 104.83-25.19-14.59 16.97 53.86 16.85 9.77-8.63-49.04z" fill="url(#c)"/> <path d="M43.86,82.5L18.69,67.98L0,90.24L25.18,104.83L43.86,82.5Z" fill="#9c3"/> <path d="m134.82 78.69-9.97 56.5 15.58-9.04 19.57-62.05-25.18 14.59z" fill="url(#b)"/> <path d="m134.82 78.69-18.68-22.33-2.86 65 11.57 13.83 9.97-56.5z" fill="url(#a)"/> <path d="m160 64.1-18.69-22.26-25.17 14.52 18.67 22.33 25.19-14.59z" fill="#ffe113"/> <path d="M101.59,18.23L79.32,0L57.05,18.23L79.32,36.98L101.59,18.23Z" fill="#f3e600"/> </g> <defs> <linearGradient id="f" x2="1" gradientTransform="matrix(.84 -162.96 162.96 .84 89.64 184.81)" gradientUnits="userSpaceOnUse"><stop stop-color="#62d399" offset="0"/><stop stop-color="#acd842" offset=".51"/><stop stop-color="#d7db0a" offset=".9"/><stop stop-color="#d7db0a" offset="1"/></linearGradient> <linearGradient id="e" x2="1" gradientTransform="matrix(-1.6,-162.13,162.13,-1.6,69.68,178.9)" gradientUnits="userSpaceOnUse"><stop stop-color="#0ba398" offset="0"/><stop stop-color="#4ca352" offset=".5"/><stop stop-color="#76a30a" offset="1"/></linearGradient> <linearGradient id="d" x2="1" gradientTransform="matrix(-1.9,-67.98,67.98,-1.9,36.6,152.17)" gradientUnits="userSpaceOnUse"><stop stop-color="#36a382" offset="0"/><stop stop-color="#36a382" offset=".19"/><stop stop-color="#49a459" offset=".54"/><stop stop-color="#76a30b" offset="1"/></linearGradient> <linearGradient id="c" x2="1" gradientTransform="matrix(2.18,-62.38,62.38,2.18,15.82,153.24)" gradientUnits="userSpaceOnUse"><stop stop-color="#267880" offset="0"/><stop stop-color="#457a5c" offset=".51"/><stop stop-color="#717516" offset="1"/></linearGradient> <linearGradient id="b" x2="1" gradientTransform="matrix(13.85,-71.96,71.96,13.85,135.08,135.43)" gradientUnits="userSpaceOnUse"><stop stop-color="#b0d939" offset="0"/><stop stop-color="#eadb04" offset="1"/></linearGradient> <linearGradient id="a" x2="1" gradientTransform="matrix(26.159 -64.737 64.737 26.159 107.42 128.14)" gradientUnits="userSpaceOnUse"><stop stop-color="#74af52" offset="0"/><stop stop-color="#74af52" offset=".17"/><stop stop-color="#99be32" offset=".48"/><stop stop-color="#c0c40a" offset="1"/></linearGradient> </defs> </svg>`;btoa(BN);const PN='<svg viewBox="0 0 509 154" xmlns="http://www.w3.org/2000/svg" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2"><path d="M665.95 132.73v44.88l-10.56-8.4c-.8-.64-1.2-1.44-1.2-2.4v-32.4c0-6.48-4.12-9.72-12.36-9.72-2.16 0-4.18.4-6.06 1.2-1.88.8-3.54 1.8-4.98 3-1.44 1.2-2.56 2.5-3.36 3.9-.8 1.4-1.2 2.7-1.2 3.9v40.92l-10.68-8.4c-.72-.64-1.08-1.44-1.08-2.4v-53.76l10.92 8.52c.32.24.56.44.72.6.16.16.36.32.6.48.96-1.2 2.14-2.28 3.54-3.24 1.4-.96 2.92-1.76 4.56-2.4 1.64-.64 3.34-1.14 5.1-1.5 1.76-.36 3.44-.54 5.04-.54 1.44 0 2.92.04 4.44.12 1.52.08 2.84.28 3.96.6 4.56 1.12 7.8 3.12 9.72 6 1.92 2.88 2.88 6.56 2.88 11.04ZM732.38 146.05c0 .88.02 1.5.06 1.86.04.36-.02.98-.18 1.86h-7.08c-2.08 0-4.44-.02-7.08-.06-2.64-.04-5.36-.06-8.16-.06h-22.08c0 2.88.56 5.36 1.68 7.44 1.12 2.08 2.6 3.8 4.44 5.16 1.84 1.36 3.94 2.36 6.3 3 2.36.64 4.74.96 7.14.96 3.04 0 5.9-.76 8.58-2.28 2.68-1.52 4.94-3.52 6.78-6 .64.56 1.54 1.48 2.7 2.76 1.16 1.28 2.94 3.2 5.34 5.76-2.8 3.36-6.22 6.02-10.26 7.98-4.04 1.96-8.42 2.94-13.14 2.94-4.72 0-8.92-.64-12.84-1.92-3.92-1.28-7.32-3.24-10.2-5.88-2.88-2.64-5.12-5.98-6.72-10.02-1.6-4.04-2.4-8.82-2.4-14.34 0-4.96.66-9.42 1.98-13.38 1.32-3.96 3.22-7.32 5.7-10.08s5.44-4.9 8.88-6.42c3.44-1.52 7.32-2.28 11.64-2.28 5.76 0 10.52.88 14.28 2.64 3.76 1.76 6.72 4.16 8.88 7.2 2.16 3.04 3.66 6.54 4.5 10.5.84 3.96 1.26 8.18 1.26 12.66Zm-29.4-22.8c-2.16.16-4.16.72-6 1.68-1.84.96-3.42 2.2-4.74 3.72-1.32 1.52-2.36 3.28-3.12 5.28-.76 2-1.14 4.12-1.14 6.36h33.12c0-2-.22-4.06-.66-6.18-.44-2.12-1.3-4.02-2.58-5.7-1.28-1.68-3.1-3.02-5.46-4.02-2.36-1-5.5-1.38-9.42-1.14ZM795.93 146.05c0 .88.02 1.5.06 1.86.04.36-.02.98-.18 1.86h-7.08c-2.08 0-4.44-.02-7.08-.06-2.64-.04-5.36-.06-8.16-.06h-22.08c0 2.88.56 5.36 1.68 7.44 1.12 2.08 2.6 3.8 4.44 5.16 1.84 1.36 3.94 2.36 6.3 3 2.36.64 4.74.96 7.14.96 3.04 0 5.9-.76 8.58-2.28 2.68-1.52 4.94-3.52 6.78-6 .64.56 1.54 1.48 2.7 2.76 1.16 1.28 2.94 3.2 5.34 5.76-2.8 3.36-6.22 6.02-10.26 7.98-4.04 1.96-8.42 2.94-13.14 2.94-4.72 0-8.92-.64-12.84-1.92-3.92-1.28-7.32-3.24-10.2-5.88-2.88-2.64-5.12-5.98-6.72-10.02-1.6-4.04-2.4-8.82-2.4-14.34 0-4.96.66-9.42 1.98-13.38 1.32-3.96 3.22-7.32 5.7-10.08s5.44-4.9 8.88-6.42c3.44-1.52 7.32-2.28 11.64-2.28 5.76 0 10.52.88 14.28 2.64 3.76 1.76 6.72 4.16 8.88 7.2 2.16 3.04 3.66 6.54 4.5 10.5.84 3.96 1.26 8.18 1.26 12.66Zm-29.4-22.8c-2.16.16-4.16.72-6 1.68-1.84.96-3.42 2.2-4.74 3.72-1.32 1.52-2.36 3.28-3.12 5.28-.76 2-1.14 4.12-1.14 6.36h33.12c0-2-.22-4.06-.66-6.18-.44-2.12-1.3-4.02-2.58-5.7-1.28-1.68-3.1-3.02-5.46-4.02-2.36-1-5.5-1.38-9.42-1.14ZM858.57 97.21c.64.48.96 1.16.96 2.04v74.88c-.08 1.04-.12 2.12-.12 3.24-1.84-1.52-3.56-2.92-5.16-4.2-1.36-1.12-2.66-2.18-3.9-3.18-1.24-1-2.06-1.66-2.46-1.98-1.76 2.48-4.26 4.44-7.5 5.88-3.24 1.44-7.02 2.16-11.34 2.16-3.84 0-7.4-.7-10.68-2.1-3.28-1.4-6.14-3.44-8.58-6.12-2.44-2.68-4.34-5.94-5.7-9.78-1.36-3.84-2.04-8.16-2.04-12.96 0-4.32.78-8.34 2.34-12.06 1.56-3.72 3.6-6.92 6.12-9.6 2.52-2.68 5.38-4.78 8.58-6.3 3.2-1.52 6.48-2.28 9.84-2.28 2.56 0 4.82.22 6.78.66 1.96.44 3.68 1.06 5.16 1.86s2.78 1.74 3.9 2.82a35.92 35.92 0 0 1 3.12 3.42V88.57l10.68 8.64Zm-27.96 67.92c3.6 0 6.52-.68 8.76-2.04 2.24-1.36 3.98-3.06 5.22-5.1a20.5 20.5 0 0 0 2.58-6.54c.48-2.32.72-4.44.72-6.36v-1.2c0-1.12-.22-2.7-.66-4.74-.44-2.04-1.28-4.06-2.52-6.06s-3-3.7-5.28-5.1c-2.28-1.4-5.22-2.02-8.82-1.86-3.44 0-6.26.74-8.46 2.22-2.2 1.48-3.96 3.26-5.28 5.34-1.32 2.08-2.24 4.2-2.76 6.36-.52 2.16-.78 3.92-.78 5.28 0 1.84.24 3.92.72 6.24.48 2.32 1.36 4.48 2.64 6.48s3.04 3.68 5.28 5.04c2.24 1.36 5.12 2.04 8.64 2.04ZM882.81 97.09c.64.48.96 1.12.96 1.92l-.12 41.04v37.08l-10.56-8.4c-.72-.64-1.08-1.44-1.08-2.4V88.45l10.8 8.64ZM950.36 146.05c0 .88.02 1.5.06 1.86.04.36-.02.98-.18 1.86h-7.08c-2.08 0-4.44-.02-7.08-.06-2.64-.04-5.36-.06-8.16-.06h-22.08c0 2.88.56 5.36 1.68 7.44 1.12 2.08 2.6 3.8 4.44 5.16 1.84 1.36 3.94 2.36 6.3 3 2.36.64 4.74.96 7.14.96 3.04 0 5.9-.76 8.58-2.28 2.68-1.52 4.94-3.52 6.78-6 .64.56 1.54 1.48 2.7 2.76 1.16 1.28 2.94 3.2 5.34 5.76-2.8 3.36-6.22 6.02-10.26 7.98-4.04 1.96-8.42 2.94-13.14 2.94-4.72 0-8.92-.64-12.84-1.92-3.92-1.28-7.32-3.24-10.2-5.88-2.88-2.64-5.12-5.98-6.72-10.02-1.6-4.04-2.4-8.82-2.4-14.34 0-4.96.66-9.42 1.98-13.38 1.32-3.96 3.22-7.32 5.7-10.08s5.44-4.9 8.88-6.42c3.44-1.52 7.32-2.28 11.64-2.28 5.76 0 10.52.88 14.28 2.64 3.76 1.76 6.72 4.16 8.88 7.2 2.16 3.04 3.66 6.54 4.5 10.5.84 3.96 1.26 8.18 1.26 12.66Zm-29.4-22.8c-2.16.16-4.16.72-6 1.68-1.84.96-3.42 2.2-4.74 3.72-1.32 1.52-2.36 3.28-3.12 5.28-.76 2-1.14 4.12-1.14 6.36h33.12c0-2-.22-4.06-.66-6.18-.44-2.12-1.3-4.02-2.58-5.7-1.28-1.68-3.1-3.02-5.46-4.02-2.36-1-5.5-1.38-9.42-1.14Z" style="fill-rule:nonzero" transform="translate(-452.406 -63.709) scale(1.00797)"/><path d="M79.32 36.98v150.76L95 174.54l6.59-156.31-22.27 18.75Z" style="fill:url(#a);fill-rule:nonzero" transform="matrix(.80638 0 0 .80638 2.361 1.094)"/><path d="M79.32 36.98 57.05 18.23l6.59 156.31 15.68 13.2V36.98Z" style="fill:url(#b);fill-rule:nonzero" transform="matrix(.80638 0 0 .80638 2.361 1.094)"/><path d="m25.19 104.83 8.63 49.04 12.5-14.95-2.46-56.42-18.67 22.33Z" style="fill:url(#c);fill-rule:nonzero" transform="matrix(.80638 0 0 .80638 2.361 1.094)"/><path d="M25.19 104.83 0 90.24l16.97 53.86 16.85 9.77-8.63-49.04Z" style="fill:url(#d);fill-rule:nonzero" transform="matrix(.80638 0 0 .80638 2.361 1.094)"/><path d="M43.86 82.5 18.69 67.98 0 90.24l25.18 14.59L43.86 82.5Z" style="fill:#9c3;fill-rule:nonzero" transform="matrix(.80638 0 0 .80638 2.361 1.094)"/><path d="m134.82 78.69-9.97 56.5 15.58-9.04L160 64.1l-25.18 14.59Z" style="fill:url(#e);fill-rule:nonzero" transform="matrix(.80638 0 0 .80638 2.361 1.094)"/><path d="m134.82 78.69-18.68-22.33-2.86 65 11.57 13.83 9.97-56.5Z" style="fill:url(#f);fill-rule:nonzero" transform="matrix(.80638 0 0 .80638 2.361 1.094)"/><path d="m160 64.1-18.69-22.26-25.17 14.52 18.67 22.33L160 64.1Z" style="fill:#ffe113;fill-rule:nonzero" transform="matrix(.80638 0 0 .80638 2.361 1.094)"/><path d="M101.59 18.23 79.32 0 57.05 18.23l22.27 18.75 22.27-18.75Z" style="fill:#f3e600;fill-rule:nonzero" transform="matrix(.80638 0 0 .80638 2.361 1.094)"/><defs><linearGradient id="a" x1="0" y1="0" x2="1" y2="0" gradientUnits="userSpaceOnUse" gradientTransform="matrix(.84 -162.96 162.96 .84 89.64 184.81)"><stop offset="0" style="stop-color:#62d399;stop-opacity:1"/><stop offset=".51" style="stop-color:#acd842;stop-opacity:1"/><stop offset=".9" style="stop-color:#d7db0a;stop-opacity:1"/><stop offset="1" style="stop-color:#d7db0a;stop-opacity:1"/></linearGradient><linearGradient id="b" x1="0" y1="0" x2="1" y2="0" gradientUnits="userSpaceOnUse" gradientTransform="rotate(-90.565 123.412 54.953) scale(162.14)"><stop offset="0" style="stop-color:#0ba398;stop-opacity:1"/><stop offset=".5" style="stop-color:#4ca352;stop-opacity:1"/><stop offset="1" style="stop-color:#76a30a;stop-opacity:1"/></linearGradient><linearGradient id="c" x1="0" y1="0" x2="1" y2="0" gradientUnits="userSpaceOnUse" gradientTransform="scale(-68) rotate(88.4 .881 -1.396)"><stop offset="0" style="stop-color:#36a382;stop-opacity:1"/><stop offset=".19" style="stop-color:#36a382;stop-opacity:1"/><stop offset=".54" style="stop-color:#49a459;stop-opacity:1"/><stop offset="1" style="stop-color:#76a30b;stop-opacity:1"/></linearGradient><linearGradient id="d" x1="0" y1="0" x2="1" y2="0" gradientUnits="userSpaceOnUse" gradientTransform="rotate(-88 87.255 68.431) scale(62.42)"><stop offset="0" style="stop-color:#267880;stop-opacity:1"/><stop offset=".51" style="stop-color:#457a5c;stop-opacity:1"/><stop offset="1" style="stop-color:#717516;stop-opacity:1"/></linearGradient><linearGradient id="e" x1="0" y1="0" x2="1" y2="0" gradientUnits="userSpaceOnUse" gradientTransform="rotate(-79.1 149.53 -14.065) scale(73.28)"><stop offset="0" style="stop-color:#b0d939;stop-opacity:1"/><stop offset="1" style="stop-color:#eadb04;stop-opacity:1"/></linearGradient><linearGradient id="f" x1="0" y1="0" x2="1" y2="0" gradientUnits="userSpaceOnUse" gradientTransform="rotate(-67.997 148.705 -15.558) scale(69.8226)"><stop offset="0" style="stop-color:#74af52;stop-opacity:1"/><stop offset=".17" style="stop-color:#74af52;stop-opacity:1"/><stop offset=".48" style="stop-color:#99be32;stop-opacity:1"/><stop offset="1" style="stop-color:#c0c40a;stop-opacity:1"/></linearGradient></defs></svg>',MN=btoa(PN),DN="data:image/svg+xml;charset=utf-8;base64,"+MN,kN=DN,qr=N("debuglicense");let bh="basic";qr&&console.log("License Type: "+bh);function _h(){switch(bh){case"pro":case"enterprise":return!0}return!1}function AP(){switch(bh){case"indie":return!0}return!1}function Sc(){return _h()||AP()}const vP=[];function ON(n){if(_h()||AP())return n(!0);vP.push(n)}function LN(n){for(const t of vP)try{t(n)}catch{}}mt.registerCallback(yt.ContextRegistered,n=>{NN(n.context),zN(),UN(n.context)});let Ec,N_=!1,Yf="";async function FN(){if(Ec)return Ec;if(bh==="basic")try{const n="https://engine.needle.tools/licensing/check?location="+encodeURIComponent(window.location.href)+"&version="+Eo+"&generator="+encodeURIComponent(Vx),t=await fetch(n,{method:"GET"}).catch(e=>{qr&&console.error("License check failed",e)});(t==null?void 0:t.status)===200?(N_=!1,qr&&console.log("License check succeeded"),bh="pro",LN(!0)):(t==null?void 0:t.status)===403?(N_=!0,Yf=await t.text()):qr&&console.log("License check failed with status "+(t==null?void 0:t.status))}catch(n){qr&&console.error("License check failed",n)}else qr&&console.log('Runtime license check is skipped because license is already applied as "'+bh+'"')}Ec=FN();async function UN(n){function t(){const s=document.createElement("div");s.className="needle-forbidden",s.style.cssText=`
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: all;
        zIndex: 2147483647;
        line-height: 1.5;
        backdrop-filter: blur(15px);
        -webkit-backdrop-filter: blur(15px);
        `;const r=s.style.cssText,o=document.createElement("div");s.appendChild(o),o.style.cssText=`
        position: absolute;
        left: 0;
        right: 0;
        top:0;
        bottom: 0;
        padding: 10%;
        color: white;
        font-size: 20px;
        font-family: sans-serif;
        text-align: center;
        pointer-events: all;
        display: flex;
        justify-content: center;
        align-items: center;
        background-color: rgba(0,0,0,.3);
        text-shadow: 0 0 2px black;
        `;const a=o.style.cssText,l=(Yf==null?void 0:Yf.length)>1?Yf:"This web application has been paused.<br/>You might be in violation of the Needle Engine terms of use.<br/>Please contact the Needle support if you think this is a mistake.";return o.innerHTML=l,setInterval(()=>{o.innerHTML!==l&&(o.innerHTML=l),o.parentNode!==s&&s.appendChild(o),s.style.cssText!==r&&(s.style.cssText=r),o.style.cssText!==a&&(o.style.cssText=a)},500),s}let e=t();const i=e.style.cssText;setInterval(()=>{var s;N_===!0&&(e.style.cssText!==i&&(e=t()),n.domElement.shadowRoot?e.parentNode!==n.domElement.shadowRoot&&((s=n.domElement.shadowRoot)==null||s.appendChild(e)):e.parentNode!=document.body&&document.body.appendChild(e))},500)}async function NN(n){try{if(Sc()!==!0)return q0(n)}catch(t){return qr&&console.log("License check failed",t),q0(n)}qr&&q0(n)}async function q0(n){n.domElement.addEventListener("ready",()=>!0),await(Ec==null?void 0:Ec.catch(()=>{})),!Sc()&&QN()}let yE=0;async function QN(n){const t=Date.now();if(t-yE<2e3)return;yE=t;const i=`
        position: relative;
        display: block;
        font-size: 18px;
        background-size: 20px;
        background-position: 10px 5px;
        background-repeat:no-repeat;
        background-image:url('data:image/webp;base64,UklGRrABAABXRUJQVlA4WAoAAAAQAAAAHwAAHwAAQUxQSKEAAAARN6CmbSM4WR7vdARON11EBDq3fLiNbVtVzpMCPlKAEzsx0Y/x+Ovuv4dn0EFE/ydAvz6YggXzgh5sVgXM/zOC/4sii7qgGvB5N7hmuQYwkvazWAu1JPW41FXSHq6pnaQWvqYH18Fc0j1hO/BFTtIeSBlJi5w6qIIO7IOrwhFsB2Yxukif0FTRLpXswHR8MxbslKe9VZsn/Ub5C7YFOpqSTABWUDgg6AAAAFAGAJ0BKiAAIAA+7VyoTqmkpCI3+qgBMB2JbACdMt69DwMIQBLhkTO6XwY00UEDK6cNIDnuNibPf0EgAP7Y1myuiQHLDsF/0h5unrGh6WAbv7aegg2ZMd3uRKfT/3SJztcaujYfTvMXspfCTmYcoO6a+vhC3ss4M8uM58t4siiu59I4aOl59e9Sr6xoxYlHf2v+NnBNpJYeJf8jABQAId/PXuBkLEFkiCucgSGEcfhvajql/j3reCGl0M5/9gQWy7ayNPs+wlvIxFnNfSlfuND4CZOCyxOHhRqOmHN4ULHo3tCSrUNvgAA=');
        background-max-size: 40px;
        margin-bottom: 5px;
        margin-top: .3em;
        margin-bottom: .5em;
        padding: .2em;
        padding-left: 25px;
        border-radius: .5em;
        border: 2px solid rgba(160,160,160,.3);
    `,r=`Needle Engine â€” No license active, commercial use is not allowed. Visit https://needle.tools/pricing for more information and licensing options! v${Eo}`;console.log("%c "+r,i)}async function zN(){var n;try{const t="https://needle-engine-analytics-v2-r26roub2hq-lz.a.run.app";if(t){qr&&console.log("Analytics backend url",t);const e=window.location.href.split("?")[0];let i="api/v2/new/request";t.endsWith("/")||(i="/"+i);const s=bh,r=`${t}${i}`;qr&&console.log("Sending non-commercial usage message to analytics backend",r);const o={license:s,url:e,hostname:window.location.hostname,pathname:window.location.pathname,version:Eo,generator:Vx,build_time:mP},a=(n=navigator.sendBeacon)==null?void 0:n.call(navigator,r,JSON.stringify(o));qr&&console.log("Send beacon result",a)}}catch(t){qr&&console.log("Failed to send non-commercial usage message to analytics backend",t)}}const ah=N("debugloading"),_f=N("debugloadingrendering"),bE=N("debuglicense");class Cq{constructor(){c(this,"className");c(this,"additionalClasses")}}let wf=0,_E;function yP(n){ah&&console.log(n.progress.loaded.toFixed(0)+"/"+n.progress.total.toFixed(0),n);const t=n.count,e=n.progress.total;e===0||e===void 0?(_E!==n.name&&(wf=0),_E=n.name,wf+=(1-wf)*.001,ah&&Yt("Loading "+n.name+" did not report total size")):wf=n.progress.loaded/e;const i=n.index/t+wf/t;return Ae.clamp01(i)}const Jv=class{constructor(t,e){c(this,"loadingProgress",0);c(this,"_element");c(this,"_progress",0);c(this,"_allowCustomLoadingElement",!0);c(this,"_loadingElement");c(this,"_loadingTextContainer",null);c(this,"_loadingBar",null);c(this,"_messageContainer",null);c(this,"_loadingElementOptions");c(this,"_progressLoop");this._element=t,this._loadingElementOptions=e}async onLoadingBegin(t){const e=this._element.shadowRoot||this._element;if(ah&&console.warn("Begin Loading"),!this._loadingElement){for(let i=0;i<e.children.length;i++){const s=e.children[i];if(s.classList.contains(Jv.LoadingContainerClassName)){if(!this._allowCustomLoadingElement){ah&&console.warn("Remove custom loading container"),e.removeChild(s);continue}this._loadingElement=this.createLoadingElement(s)}}this._loadingElement||(this._loadingElement=this.createLoadingElement())}this._progress=0,this.loadingProgress=0,this._loadingElement.style.display="flex",e.appendChild(this._loadingElement),this.smoothProgressLoop(),this.setMessage(t??"")}onLoadingUpdate(t,e){var s;if(!((s=this._loadingElement)!=null&&s.parentNode))return;let i=0;typeof t=="number"?i=t:("index"in t&&(i=yP(t)),!e&&"name"in t&&this.setMessage("loading "+t.name)),this.loadingProgress=i,e&&this.setMessage(e),this.updateDisplay()}onLoadingFinished(){ah&&console.warn("Finished Loading"),_f||(this.loadingProgress=1,this.onDoneLoading())}setMessage(t){this._messageContainer&&(this._messageContainer.innerText=t)}smoothProgressLoop(){if(this._progressLoop)return;let t=1/12;_f&&(t=1/500,typeof _f=="number"&&(t*=_f)),this._progressLoop=setInterval(()=>{this.loadingProgress>=.95&&!_f&&(t=.9),this._progress=Ae.lerp(this._progress,this.loadingProgress,t*this.loadingProgress),this.updateDisplay()},t)}onDoneLoading(){this._loadingElement&&(ah&&console.log("Hiding loading element"),this._loadingElement.style.display="none",this._loadingElement.remove()),this._progressLoop&&clearInterval(this._progressLoop),this._progressLoop=null}updateDisplay(){const t=this._progress,e=(t*100).toFixed(0)+"%";this._loadingBar&&(this._loadingBar.style.width=t*100+"%"),this._loadingTextContainer&&(this._loadingTextContainer.textContent=e)}createLoadingElement(t){var g,m;ah&&!t&&console.log("Creating loading element"),this._loadingElement=t||document.createElement("div");let e=this._element.getAttribute("loading-style");(!e||e==="auto")&&(window.matchMedia("(prefers-color-scheme: dark)").matches?e="dark":e="light");const i=_h();if(!t&&(this._loadingElement.style.position="absolute",this._loadingElement.style.width="100%",this._loadingElement.style.height="100%",this._loadingElement.style.left="0",this._loadingElement.style.top="0",e==="light"?this._loadingElement.style.backgroundColor="#ddd":this._loadingElement.style.backgroundColor="#222",this._loadingElement.style.display="flex",this._loadingElement.style.alignItems="center",this._loadingElement.style.justifyContent="center",this._loadingElement.style.zIndex=Number.MAX_SAFE_INTEGER.toString(),this._loadingElement.style.flexDirection="column",this._loadingElement.style.pointerEvents="none",this._loadingElement.style.color="white",this._loadingElement.style.fontFamily='system-ui, Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"',this._loadingElement.style.fontSize="1rem",e==="light"?this._loadingElement.style.color="rgba(0,0,0,.6)":this._loadingElement.style.color="rgba(255,255,255,.3)",i&&this._element)){const v=this._element.getAttribute("loading-background-color");v&&(this._loadingElement.style.backgroundColor=v);const y=this._element.getAttribute("loading-text-color");y&&(this._loadingElement.style.color=y)}const s=((g=this._loadingElementOptions)==null?void 0:g.className)??Jv.LoadingContainerClassName;if(this._loadingElement.classList.add(s),(m=this._loadingElementOptions)!=null&&m.additionalClasses)for(const v of this._loadingElementOptions.additionalClasses)this._loadingElement.classList.add(v);const r=document.createElement("div");this._loadingElement.appendChild(r);const o=document.createElement("img"),a=120;o.style.width=`${a}px`,o.style.height=`${a}px`,o.style.paddingTop="20px",o.style.paddingBottom="10px",o.style.margin="0px",o.style.userSelect="none",o.style.objectFit="contain",o.style.transition="transform 1.5s ease-out, opacity .3s ease-in-out",o.style.transform="translateY(30px)",o.style.opacity="0.05",setTimeout(()=>{o.style.opacity="1",o.style.transform="translateY(0px)"},1),o.src=RN;let l=!1;if(i&&this._element){const v=this._element.getAttribute("loading-logo-src");v&&(l=!0,o.src=v)}l||(o.style.cursor="pointer",o.style.pointerEvents="all",o.addEventListener("click",()=>window.open("https://needle.tools","_blank"))),r.appendChild(o);const h=document.createElement("div");h.style.cssText=`
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        width: 100%;
        opacity: 0;
        transition: opacity 1s ease-in-out 4s;
        `,setTimeout(()=>{h.style.opacity="1"},1),this._loadingElement.appendChild(h);const u=document.createElement("div"),d=100;u.style.display="flex",u.style.width=d+"%",u.style.height="3px",u.style.position="absolute",u.style.left="0",u.style.bottom="0px",u.style.opacity="0",u.style.transition="opacity 1s ease-in-out 2s",setTimeout(()=>{u.style.opacity="1"},1),e==="light"?u.style.backgroundColor="rgba(0,0,0,.2)":u.style.backgroundColor="rgba(255,255,255,.2)",this._loadingElement.appendChild(u),this._loadingBar=document.createElement("div"),u.appendChild(this._loadingBar);const f=function(v){return Ae.lerp(0,d,v)+"%"};if(this._loadingBar.style.background=`linear-gradient(90deg, #204f49 ${f(0)}, #0BA398 ${f(.3)}, #66A22F ${f(.6)}, #D7DB0A ${f(1)})`,this._loadingBar.style.backgroundAttachment="fixed",this._loadingBar.style.width="0%",this._loadingBar.style.height="100%",i&&this._element){const v=this._element.getAttribute("primary-color"),y=this._element.getAttribute("secondary-color");v&&y?this._loadingBar.style.background=`linear-gradient(90deg, ${v} ${f(0)}, ${y} ${f(1)})`:v?this._loadingBar.style.background=v:y&&(this._loadingBar.style.background=y)}this._loadingTextContainer=document.createElement("div"),this._loadingTextContainer.style.display="flex",this._loadingTextContainer.style.justifyContent="center",this._loadingTextContainer.style.marginTop=".2rem",h.appendChild(this._loadingTextContainer);const p=document.createElement("div");if(this._messageContainer=p,p.style.display="flex",p.style.fontSize=".8rem",p.style.paddingTop=".1rem",p.style.justifyContent="center",h.appendChild(p),i&&this._element){const v=this._element.getAttribute("loading-text-color");v&&(p.style.color=v)}return this.handleRuntimeLicense(this._loadingElement),this._loadingElement}async handleRuntimeLicense(t){let e=Sc();if(e)return;bE&&console.log("Loading UI has commercial license?",e);const i=document.createElement("div");i.style.paddingTop=".6em",i.style.fontSize=".8em",i.style.textTransform="uppercase",i.innerText=`NEEDLE ENGINE NON COMMERCIAL VERSION
CLICK HERE TO GET A LICENSE`,i.style.cursor="pointer",i.style.userSelect="none",i.style.textAlign="center",i.style.pointerEvents="all",i.addEventListener("click",()=>window.open("https://needle.tools/pricing","_self")),i.style.opacity="0",t.appendChild(i),!xe()&&Ec&&(bE&&console.log("Waiting for runtime license check"),await Ec,e=Sc()),!e&&(i.style.transition="opacity .5s ease-in-out",i.style.opacity="1")}};let RA=Jv;c(RA,"LoadingContainerClassName","loading");const xf=N("debugoverlay"),bP="ar",jN="quit-ar";class GN{constructor(){c(this,"arContainer",null);c(this,"currentSession",null);c(this,"_createdAROnlyElements",[]);c(this,"_reparentedObjects",[]);c(this,"contentElement",null);c(this,"originalDomOverlayParent",null);c(this,"requestEndAR",()=>{this.onRequestedEndAR()})}get ARContainer(){return this.arContainer}onBegin(t,e,i){var s;if(this.currentSession=i,this.arContainer=e,md()){const r=t.domElement.children;for(let o=0;o<(r==null?void 0:r.length);o++){const a=r[o];if(!a||a===this.arContainer)return;this._reparentedObjects.push({el:a,previousParent:a.parentElement}),(s=this.arContainer)==null||s.appendChild(a)}e?(this.originalDomOverlayParent=e.parentNode,this.originalDomOverlayParent&&(console.log("Reparent DOM Overlay to body",e,e.style.display),e.style.display="",e.style.visibility="",document.body.appendChild(e))):console.warn("WebXRViewer: No DOM Overlay found")}this.ensureQuitARButton(this.arContainer)}onEnd(t){var e;for(const i of this._createdAROnlyElements)i.remove&&i.remove();for(const i of this._reparentedObjects){const s=i.el;(e=i.previousParent)==null||e.appendChild(s)}this._reparentedObjects.length=0,md()&&setTimeout(()=>{var o;const i=t.renderer.domElement;i&&((o=t.domElement.shadowRoot)==null||o.prepend(i));const s=document.querySelectorAll("*");for(var r=0;r<s.length;r++){const a=s[r];a&&a._displayChanged!==void 0&&a._displayWas!==void 0&&(a.style.display=a._displayWas)}},10)}createOverlayContainer(t){if(this.contentElement)return this.contentElement;xf&&console.log("Setup overlay container");const e=t.shadowRoot.querySelector(".content");this.contentElement=e;const i=t.shadowRoot.querySelector(".overlay-content");return i&&e.appendChild(i),xf&&!No()&&this.ensureQuitARButton(e),e}onRequestedEndAR(){this.currentSession&&(this.currentSession.end(),this.currentSession=null)}ensureQuitARButton(t){const e=document.createElement("slot");e.setAttribute("name","quit-ar"),this.appendElement(e,t),this._createdAROnlyElements.push(e),e.style.pointerEvents="auto";const i=document.querySelector(`.${jN}`);if(i){i.addEventListener("click",this.requestEndAR),xf&&i.addEventListener("click",()=>console.log("Clicked quit-ar button"));return}e.addEventListener("click",this.requestEndAR),xf&&e.addEventListener("click",()=>console.log("Clicked fallback close button"));const s=document.createElement("div");s.style.cssText=`
            position: fixed;
            top: 0;
            right: 0;
            z-index: 600;
            pointer-events: all;
        `,this.appendElement(s,e);var r=document.createElementNS("http://www.w3.org/2000/svg","svg");r.classList.add("quit-ar-button"),r.setAttribute("width","38px"),r.setAttribute("height","38px"),r.style.cssText=`
            background: radial-gradient(circle, rgba(0,0,0,.05) 70%, rgba(0,0,0,0) 100%);
            border-radius: 50%;
        `,s.appendChild(r);var o=document.createElementNS("http://www.w3.org/2000/svg","path");o.setAttribute("d","M 12,12 L 28,28 M 28,12 12,28"),o.setAttribute("stroke","#fff"),o.setAttribute("stroke-width","3px"),o.style.cssText=`
            filter: drop-shadow(0 0px 1.2px rgba(0,0,0,.7));
        `,r.appendChild(o),xf&&console.log("Created fallback close button",r,t)}appendElement(t,e){return e.shadowRoot?e.shadowRoot.appendChild(t):e.appendChild(t)}}var _P=function(){var n="b9H79Tebbbe8Fv9Gbb9Gvuuuuueu9Giuuub9Geueu9Giuuueuikqbeeedddillviebeoweuec:q;iekr;leDo9TW9T9VV95dbH9F9F939H79T9F9J9H229F9Jt9VV7bb8A9TW79O9V9Wt9F9KW9J9V9KW9wWVtW949c919M9MWVbeY9TW79O9V9Wt9F9KW9J9V9KW69U9KW949c919M9MWVbdE9TW79O9V9Wt9F9KW9J9V9KW69U9KW949tWG91W9U9JWbiL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9p9JtblK9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9r919HtbvL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWVT949Wbol79IV9Rbrq:P8Yqdbk;3sezu8Jjjjjbcj;eb9Rgv8Kjjjjbc9:hodnadcefal0mbcuhoaiRbbc:Ge9hmbavaialfgrad9Radz1jjjbhwcj;abad9UhoaicefhldnadTmbaoc;WFbGgocjdaocjd6EhDcbhqinaqae9pmeaDaeaq9RaqaDfae6Egkcsfgocl4cifcd4hxdndndndnaoc9WGgmTmbcbhPcehsawcjdfhzalhHinaraH9Rax6midnaraHaxfgl9RcK6mbczhoinawcj;cbfaogifgoc9WfhOdndndndndnaHaic9WfgAco4fRbbaAci4coG4ciGPlbedibkaO9cb83ibaOcwf9cb83ibxikaOalRblalRbbgAco4gCaCciSgCE86bbaocGfalclfaCfgORbbaAcl4ciGgCaCciSgCE86bbaocVfaOaCfgORbbaAcd4ciGgCaCciSgCE86bbaoc7faOaCfgORbbaAciGgAaAciSgAE86bbaoctfaOaAfgARbbalRbegOco4gCaCciSgCE86bbaoc91faAaCfgARbbaOcl4ciGgCaCciSgCE86bbaoc4faAaCfgARbbaOcd4ciGgCaCciSgCE86bbaoc93faAaCfgARbbaOciGgOaOciSgOE86bbaoc94faAaOfgARbbalRbdgOco4gCaCciSgCE86bbaoc95faAaCfgARbbaOcl4ciGgCaCciSgCE86bbaoc96faAaCfgARbbaOcd4ciGgCaCciSgCE86bbaoc97faAaCfgARbbaOciGgOaOciSgOE86bbaoc98faAaOfgORbbalRbiglco4gAaAciSgAE86bbaoc99faOaAfgORbbalcl4ciGgAaAciSgAE86bbaoc9:faOaAfgORbbalcd4ciGgAaAciSgAE86bbaocufaOaAfgoRbbalciGglalciSglE86bbaoalfhlxdkaOalRbwalRbbgAcl4gCaCcsSgCE86bbaocGfalcwfaCfgORbbaAcsGgAaAcsSgAE86bbaocVfaOaAfgORbbalRbegAcl4gCaCcsSgCE86bbaoc7faOaCfgORbbaAcsGgAaAcsSgAE86bbaoctfaOaAfgORbbalRbdgAcl4gCaCcsSgCE86bbaoc91faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc4faOaAfgORbbalRbigAcl4gCaCcsSgCE86bbaoc93faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc94faOaAfgORbbalRblgAcl4gCaCcsSgCE86bbaoc95faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc96faOaAfgORbbalRbvgAcl4gCaCcsSgCE86bbaoc97faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc98faOaAfgORbbalRbogAcl4gCaCcsSgCE86bbaoc99faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc9:faOaAfgORbbalRbrglcl4gAaAcsSgAE86bbaocufaOaAfgoRbbalcsGglalcsSglE86bbaoalfhlxekaOal8Pbb83bbaOcwfalcwf8Pbb83bbalczfhlkdnaiam9pmbaiczfhoaral9RcL0mekkaiam6mialTmidnakTmbawaPfRbbhOcbhoazhiinaiawcj;cbfaofRbbgAce4cbaAceG9R7aOfgO86bbaiadfhiaocefgoak9hmbkkazcefhzaPcefgPad6hsalhHaPad9hmexvkkcbhlasceGmdxikalaxad2fhCdnakTmbcbhHcehsawcjdfhminaral9Rax6mialTmdalaxfhlawaHfRbbhOcbhoamhiinaiawcj;cbfaofRbbgAce4cbaAceG9R7aOfgO86bbaiadfhiaocefgoak9hmbkamcefhmaHcefgHad6hsaHad9hmbkaChlxikcbhocehsinaral9Rax6mdalTmealaxfhlaocefgoad6hsadao9hmbkaChlxdkcbhlasceGTmekc9:hoxikabaqad2fawcjdfakad2z1jjjb8Aawawcjdfakcufad2fadz1jjjb8Aakaqfhqalmbkc9:hoxekcbc99aral9Radcaadca0ESEhokavcj;ebf8Kjjjjbaok;yzeHu8Jjjjjbc;ae9Rgv8Kjjjjbc9:hodnaeci9UgrcHfal0mbcuhoaiRbbgwc;WeGc;Ge9hmbawcsGgDce0mbavc;abfcFecjez:jjjjb8AavcUf9cu83ibavc8Wf9cu83ibavcyf9cu83ibavcaf9cu83ibavcKf9cu83ibavczf9cu83ibav9cu83iwav9cu83ibaialfc9WfhqaicefgwarfhodnaeTmbcmcsaDceSEhkcbhxcbhmcbhDcbhicbhlindnaoaq9nmbc9:hoxikdndnawRbbgrc;Ve0mbavc;abfalarcl4cu7fcsGcitfgPydlhsaPydbhzdnarcsGgPak9pmbavaiarcu7fcsGcdtfydbaxaPEhraPThPdndnadcd9hmbabaDcetfgHaz87ebaHcdfas87ebaHclfar87ebxekabaDcdtfgHazBdbaHclfasBdbaHcwfarBdbkaxaPfhxavc;abfalcitfgHarBdbaHasBdlavaicdtfarBdbavc;abfalcefcsGglcitfgHazBdbaHarBdlaiaPfhialcefhlxdkdndnaPcsSmbamaPfaPc987fcefhmxekaocefhrao8SbbgPcFeGhHdndnaPcu9mmbarhoxekaocvfhoaHcFbGhHcrhPdninar8SbbgOcFbGaPtaHVhHaOcu9kmearcefhraPcrfgPc8J9hmbxdkkarcefhokaHce4cbaHceG9R7amfhmkdndnadcd9hmbabaDcetfgraz87ebarcdfas87ebarclfam87ebxekabaDcdtfgrazBdbarclfasBdbarcwfamBdbkavc;abfalcitfgramBdbarasBdlavaicdtfamBdbavc;abfalcefcsGglcitfgrazBdbaramBdlaicefhialcefhlxekdnarcpe0mbaxcefgOavaiaqarcsGfRbbgPcl49RcsGcdtfydbaPcz6gHEhravaiaP9RcsGcdtfydbaOaHfgsaPcsGgOEhPaOThOdndnadcd9hmbabaDcetfgzax87ebazcdfar87ebazclfaP87ebxekabaDcdtfgzaxBdbazclfarBdbazcwfaPBdbkavaicdtfaxBdbavc;abfalcitfgzarBdbazaxBdlavaicefgicsGcdtfarBdbavc;abfalcefcsGcitfgzaPBdbazarBdlavaiaHfcsGgicdtfaPBdbavc;abfalcdfcsGglcitfgraxBdbaraPBdlalcefhlaiaOfhiasaOfhxxekaxcbaoRbbgzEgAarc;:eSgrfhsazcsGhCazcl4hXdndnazcs0mbascefhOxekashOavaiaX9RcsGcdtfydbhskdndnaCmbaOcefhxxekaOhxavaiaz9RcsGcdtfydbhOkdndnarTmbaocefhrxekaocdfhrao8SbegHcFeGhPdnaHcu9kmbaocofhAaPcFbGhPcrhodninar8SbbgHcFbGaotaPVhPaHcu9kmearcefhraocrfgoc8J9hmbkaAhrxekarcefhrkaPce4cbaPceG9R7amfgmhAkdndnaXcsSmbarhPxekarcefhPar8SbbgocFeGhHdnaocu9kmbarcvfhsaHcFbGhHcrhodninaP8SbbgrcFbGaotaHVhHarcu9kmeaPcefhPaocrfgoc8J9hmbkashPxekaPcefhPkaHce4cbaHceG9R7amfgmhskdndnaCcsSmbaPhoxekaPcefhoaP8SbbgrcFeGhHdnarcu9kmbaPcvfhOaHcFbGhHcrhrdninao8SbbgPcFbGartaHVhHaPcu9kmeaocefhoarcrfgrc8J9hmbkaOhoxekaocefhokaHce4cbaHceG9R7amfgmhOkdndnadcd9hmbabaDcetfgraA87ebarcdfas87ebarclfaO87ebxekabaDcdtfgraABdbarclfasBdbarcwfaOBdbkavc;abfalcitfgrasBdbaraABdlavaicdtfaABdbavc;abfalcefcsGcitfgraOBdbarasBdlavaicefgicsGcdtfasBdbavc;abfalcdfcsGcitfgraABdbaraOBdlavaiazcz6aXcsSVfgicsGcdtfaOBdbaiaCTaCcsSVfhialcifhlkawcefhwalcsGhlaicsGhiaDcifgDae6mbkkcbc99aoaqSEhokavc;aef8Kjjjjbaok:llevu8Jjjjjbcz9Rhvc9:hodnaecvfal0mbcuhoaiRbbc;:eGc;qe9hmbav9cb83iwaicefhraialfc98fhwdnaeTmbdnadcdSmbcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcdtfaicd4cbaice4ceG9R7avcwfaiceGcdtVgoydbfglBdbaoalBdbaDcefgDae9hmbxdkkcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcetfaicd4cbaice4ceG9R7avcwfaiceGcdtVgoydbfgl87ebaoalBdbaDcefgDae9hmbkkcbc99arawSEhokaok:Lvoeue99dud99eud99dndnadcl9hmbaeTmeindndnabcdfgd8Sbb:Yab8Sbbgi:Ygl:l:tabcefgv8Sbbgo:Ygr:l:tgwJbb;:9cawawNJbbbbawawJbbbb9GgDEgq:mgkaqaicb9iEalMgwawNakaqaocb9iEarMgqaqNMM:r:vglNJbbbZJbbb:;aDEMgr:lJbbb9p9DTmbar:Ohixekcjjjj94hikadai86bbdndnaqalNJbbbZJbbb:;aqJbbbb9GEMgq:lJbbb9p9DTmbaq:Ohdxekcjjjj94hdkavad86bbdndnawalNJbbbZJbbb:;awJbbbb9GEMgw:lJbbb9p9DTmbaw:Ohdxekcjjjj94hdkabad86bbabclfhbaecufgembxdkkaeTmbindndnabclfgd8Ueb:Yab8Uebgi:Ygl:l:tabcdfgv8Uebgo:Ygr:l:tgwJb;:FSawawNJbbbbawawJbbbb9GgDEgq:mgkaqaicb9iEalMgwawNakaqaocb9iEarMgqaqNMM:r:vglNJbbbZJbbb:;aDEMgr:lJbbb9p9DTmbar:Ohixekcjjjj94hikadai87ebdndnaqalNJbbbZJbbb:;aqJbbbb9GEMgq:lJbbb9p9DTmbaq:Ohdxekcjjjj94hdkavad87ebdndnawalNJbbbZJbbb:;awJbbbb9GEMgw:lJbbb9p9DTmbaw:Ohdxekcjjjj94hdkabad87ebabcwfhbaecufgembkkk;siliui99iue99dnaeTmbcbhiabhlindndnJ;Zl81Zalcof8UebgvciV:Y:vgoal8Ueb:YNgrJb;:FSNJbbbZJbbb:;arJbbbb9GEMgw:lJbbb9p9DTmbaw:OhDxekcjjjj94hDkalclf8Uebhqalcdf8UebhkabavcefciGaiVcetfaD87ebdndnaoak:YNgwJb;:FSNJbbbZJbbb:;awJbbbb9GEMgx:lJbbb9p9DTmbax:Ohkxekcjjjj94hkkabavcdfciGaiVcetfak87ebdndnaoaq:YNgoJb;:FSNJbbbZJbbb:;aoJbbbb9GEMgx:lJbbb9p9DTmbax:Ohqxekcjjjj94hqkabavcufciGaiVcetfaq87ebdndnJbbjZararN:tawawN:taoaoN:tgrJbbbbarJbbbb9GE:rJb;:FSNJbbbZMgr:lJbbb9p9DTmbar:Ohqxekcjjjj94hqkabavciGaiVcetfaq87ebalcwfhlaiclfhiaecufgembkkk9mbdnadcd4ae2geTmbinababydbgdcwtcw91:Yadce91cjjj;8ifcjjj98G::NUdbabclfhbaecufgembkkk9teiucbcbydj1jjbgeabcifc98GfgbBdj1jjbdndnabZbcztgd9nmbcuhiabad9RcFFifcz4nbcuSmekaehikaik;LeeeudndnaeabVciGTmbabhixekdndnadcz9pmbabhixekabhiinaiaeydbBdbaiclfaeclfydbBdbaicwfaecwfydbBdbaicxfaecxfydbBdbaiczfhiaeczfheadc9Wfgdcs0mbkkadcl6mbinaiaeydbBdbaeclfheaiclfhiadc98fgdci0mbkkdnadTmbinaiaeRbb86bbaicefhiaecefheadcufgdmbkkabk;aeedudndnabciGTmbabhixekaecFeGc:b:c:ew2hldndnadcz9pmbabhixekabhiinaialBdbaicxfalBdbaicwfalBdbaiclfalBdbaiczfhiadc9Wfgdcs0mbkkadcl6mbinaialBdbaiclfhiadc98fgdci0mbkkdnadTmbinaiae86bbaicefhiadcufgdmbkkabkkkebcjwklz9Kbb",t="b9H79TebbbeKl9Gbb9Gvuuuuueu9Giuuub9Geueuikqbbebeedddilve9Weeeviebeoweuec:q;Aekr;leDo9TW9T9VV95dbH9F9F939H79T9F9J9H229F9Jt9VV7bb8A9TW79O9V9Wt9F9KW9J9V9KW9wWVtW949c919M9MWVbdY9TW79O9V9Wt9F9KW9J9V9KW69U9KW949c919M9MWVblE9TW79O9V9Wt9F9KW9J9V9KW69U9KW949tWG91W9U9JWbvL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9p9JtboK9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9r919HtbrL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWVT949Wbwl79IV9RbDq;t9tqlbzik9:evu8Jjjjjbcz9Rhbcbheincbhdcbhiinabcwfadfaicjuaead4ceGglE86bbaialfhiadcefgdcw9hmbkaec:q:yjjbfai86bbaecitc:q1jjbfab8Piw83ibaecefgecjd9hmbkk;h8JlHud97euo978Jjjjjbcj;kb9Rgv8Kjjjjbc9:hodnadcefal0mbcuhoaiRbbc:Ge9hmbavaialfgrad9Rad;8qbbcj;abad9UhoaicefhldnadTmbaoc;WFbGgocjdaocjd6EhwcbhDinaDae9pmeawaeaD9RaDawfae6Egqcsfgoc9WGgkci2hxakcethmaocl4cifcd4hPabaDad2fhscbhzdnincehHalhOcbhAdninaraO9RaP6miavcj;cbfaAak2fhCaOaPfhlcbhidnakc;ab6mbaral9Rc;Gb6mbcbhoinaCaofhidndndndndnaOaoco4fRbbgXciGPlbedibkaipxbbbbbbbbbbbbbbbbpklbxikaialpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklbalclfaYpQbfaKc:q:yjjbfRbbfhlxdkaialpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklbalcwfaYpQbfaKc:q:yjjbfRbbfhlxekaialpbbbpklbalczfhlkdndndndndnaXcd4ciGPlbedibkaipxbbbbbbbbbbbbbbbbpklzxikaialpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklzalclfaYpQbfaKc:q:yjjbfRbbfhlxdkaialpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklzalcwfaYpQbfaKc:q:yjjbfRbbfhlxekaialpbbbpklzalczfhlkdndndndndnaXcl4ciGPlbedibkaipxbbbbbbbbbbbbbbbbpklaxikaialpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklaalclfaYpQbfaKc:q:yjjbfRbbfhlxdkaialpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklaalcwfaYpQbfaKc:q:yjjbfRbbfhlxekaialpbbbpklaalczfhlkdndndndndnaXco4Plbedibkaipxbbbbbbbbbbbbbbbbpkl8WxikaialpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibaXc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spkl8WalclfaYpQbfaXc:q:yjjbfRbbfhlxdkaialpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibaXc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spkl8WalcwfaYpQbfaXc:q:yjjbfRbbfhlxekaialpbbbpkl8Walczfhlkaoc;abfhiaocjefak0meaihoaral9Rc;Fb0mbkkdndnaiak9pmbaici4hoinaral9RcK6mdaCaifhXdndndndndnaOaico4fRbbaocoG4ciGPlbedibkaXpxbbbbbbbbbbbbbbbbpklbxikaXalpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklbalclfaYpQbfaKc:q:yjjbfRbbfhlxdkaXalpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklbalcwfaYpQbfaKc:q:yjjbfRbbfhlxekaXalpbbbpklbalczfhlkaocdfhoaiczfgiak6mbkkalTmbaAci6hHalhOaAcefgohAaoclSmdxekkcbhlaHceGmdkdnakTmbavcjdfazfhiavazfpbdbhYcbhXinaiavcj;cbfaXfgopblbgLcep9TaLpxeeeeeeeeeeeeeeeegQp9op9Hp9rgLaoakfpblbg8Acep9Ta8AaQp9op9Hp9rg8ApmbzeHdOiAlCvXoQrLgEaoamfpblbg3cep9Ta3aQp9op9Hp9rg3aoaxfpblbg5cep9Ta5aQp9op9Hp9rg5pmbzeHdOiAlCvXoQrLg8EpmbezHdiOAlvCXorQLgQaQpmbedibedibedibediaYp9UgYp9AdbbaiadfgoaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaoadfgoaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaoadfgoaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaoadfgoaYaEa8EpmwDKYqk8AExm35Ps8E8FgQaQpmbedibedibedibedip9UgYp9AdbbaoadfgoaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaoadfgoaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaoadfgoaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaoadfgoaYaLa8ApmwKDYq8AkEx3m5P8Es8FgLa3a5pmwKDYq8AkEx3m5P8Es8Fg8ApmbezHdiOAlvCXorQLgQaQpmbedibedibedibedip9UgYp9AdbbaoadfgoaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaoadfgoaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaoadfgoaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaoadfgoaYaLa8ApmwDKYqk8AExm35Ps8E8FgQaQpmbedibedibedibedip9UgYp9AdbbaoadfgoaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaoadfgoaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaoadfgoaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaoadfhiaXczfgXak6mbkkazclfgzad6mbkasavcjdfaqad2;8qbbavavcjdfaqcufad2fad;8qbbaqaDfhDc9:hoalmexikkc9:hoxekcbc99aral9Radcaadca0ESEhokavcj;kbf8Kjjjjbaokwbz:bjjjbk;uzeHu8Jjjjjbc;ae9Rgv8Kjjjjbc9:hodnaeci9UgrcHfal0mbcuhoaiRbbgwc;WeGc;Ge9hmbawcsGgDce0mbavc;abfcFecje;8kbavcUf9cu83ibavc8Wf9cu83ibavcyf9cu83ibavcaf9cu83ibavcKf9cu83ibavczf9cu83ibav9cu83iwav9cu83ibaialfc9WfhqaicefgwarfhodnaeTmbcmcsaDceSEhkcbhxcbhmcbhDcbhicbhlindnaoaq9nmbc9:hoxikdndnawRbbgrc;Ve0mbavc;abfalarcl4cu7fcsGcitfgPydlhsaPydbhzdnarcsGgPak9pmbavaiarcu7fcsGcdtfydbaxaPEhraPThPdndnadcd9hmbabaDcetfgHaz87ebaHcdfas87ebaHclfar87ebxekabaDcdtfgHazBdbaHclfasBdbaHcwfarBdbkaxaPfhxavc;abfalcitfgHarBdbaHasBdlavaicdtfarBdbavc;abfalcefcsGglcitfgHazBdbaHarBdlaiaPfhialcefhlxdkdndnaPcsSmbamaPfaPc987fcefhmxekaocefhrao8SbbgPcFeGhHdndnaPcu9mmbarhoxekaocvfhoaHcFbGhHcrhPdninar8SbbgOcFbGaPtaHVhHaOcu9kmearcefhraPcrfgPc8J9hmbxdkkarcefhokaHce4cbaHceG9R7amfhmkdndnadcd9hmbabaDcetfgraz87ebarcdfas87ebarclfam87ebxekabaDcdtfgrazBdbarclfasBdbarcwfamBdbkavc;abfalcitfgramBdbarasBdlavaicdtfamBdbavc;abfalcefcsGglcitfgrazBdbaramBdlaicefhialcefhlxekdnarcpe0mbaxcefgOavaiaqarcsGfRbbgPcl49RcsGcdtfydbaPcz6gHEhravaiaP9RcsGcdtfydbaOaHfgsaPcsGgOEhPaOThOdndnadcd9hmbabaDcetfgzax87ebazcdfar87ebazclfaP87ebxekabaDcdtfgzaxBdbazclfarBdbazcwfaPBdbkavaicdtfaxBdbavc;abfalcitfgzarBdbazaxBdlavaicefgicsGcdtfarBdbavc;abfalcefcsGcitfgzaPBdbazarBdlavaiaHfcsGgicdtfaPBdbavc;abfalcdfcsGglcitfgraxBdbaraPBdlalcefhlaiaOfhiasaOfhxxekaxcbaoRbbgzEgAarc;:eSgrfhsazcsGhCazcl4hXdndnazcs0mbascefhOxekashOavaiaX9RcsGcdtfydbhskdndnaCmbaOcefhxxekaOhxavaiaz9RcsGcdtfydbhOkdndnarTmbaocefhrxekaocdfhrao8SbegHcFeGhPdnaHcu9kmbaocofhAaPcFbGhPcrhodninar8SbbgHcFbGaotaPVhPaHcu9kmearcefhraocrfgoc8J9hmbkaAhrxekarcefhrkaPce4cbaPceG9R7amfgmhAkdndnaXcsSmbarhPxekarcefhPar8SbbgocFeGhHdnaocu9kmbarcvfhsaHcFbGhHcrhodninaP8SbbgrcFbGaotaHVhHarcu9kmeaPcefhPaocrfgoc8J9hmbkashPxekaPcefhPkaHce4cbaHceG9R7amfgmhskdndnaCcsSmbaPhoxekaPcefhoaP8SbbgrcFeGhHdnarcu9kmbaPcvfhOaHcFbGhHcrhrdninao8SbbgPcFbGartaHVhHaPcu9kmeaocefhoarcrfgrc8J9hmbkaOhoxekaocefhokaHce4cbaHceG9R7amfgmhOkdndnadcd9hmbabaDcetfgraA87ebarcdfas87ebarclfaO87ebxekabaDcdtfgraABdbarclfasBdbarcwfaOBdbkavc;abfalcitfgrasBdbaraABdlavaicdtfaABdbavc;abfalcefcsGcitfgraOBdbarasBdlavaicefgicsGcdtfasBdbavc;abfalcdfcsGcitfgraABdbaraOBdlavaiazcz6aXcsSVfgicsGcdtfaOBdbaiaCTaCcsSVfhialcifhlkawcefhwalcsGhlaicsGhiaDcifgDae6mbkkcbc99aoaqSEhokavc;aef8Kjjjjbaok:llevu8Jjjjjbcz9Rhvc9:hodnaecvfal0mbcuhoaiRbbc;:eGc;qe9hmbav9cb83iwaicefhraialfc98fhwdnaeTmbdnadcdSmbcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcdtfaicd4cbaice4ceG9R7avcwfaiceGcdtVgoydbfglBdbaoalBdbaDcefgDae9hmbxdkkcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcetfaicd4cbaice4ceG9R7avcwfaiceGcdtVgoydbfgl87ebaoalBdbaDcefgDae9hmbkkcbc99arawSEhokaok:EPliuo97eue978Jjjjjbca9Rhidndnadcl9hmbdnaec98GglTmbcbhvabhdinadadpbbbgocKp:RecKp:Sep;6egraocwp:RecKp:Sep;6earp;Geaoczp:RecKp:Sep;6egwp;Gep;Kep;LegDpxbbbbbbbbbbbbbbbbp:2egqarpxbbbjbbbjbbbjbbbjgkp9op9rp;Kegrpxbb;:9cbb;:9cbb;:9cbb;:9cararp;MeaDaDp;Meawaqawakp9op9rp;Kegrarp;Mep;Kep;Kep;Jep;Negwp;Mepxbbn0bbn0bbn0bbn0gqp;KepxFbbbFbbbFbbbFbbbp9oaopxbbbFbbbFbbbFbbbFp9op9qarawp;Meaqp;Kecwp:RepxbFbbbFbbbFbbbFbbp9op9qaDawp;Meaqp;Keczp:RepxbbFbbbFbbbFbbbFbp9op9qpkbbadczfhdavclfgval6mbkkalae9pmeaiaeciGgvcdtgdVcbczad9R;8kbaiabalcdtfglad;8qbbdnavTmbaiaipblbgocKp:RecKp:Sep;6egraocwp:RecKp:Sep;6earp;Geaoczp:RecKp:Sep;6egwp;Gep;Kep;LegDpxbbbbbbbbbbbbbbbbp:2egqarpxbbbjbbbjbbbjbbbjgkp9op9rp;Kegrpxbb;:9cbb;:9cbb;:9cbb;:9cararp;MeaDaDp;Meawaqawakp9op9rp;Kegrarp;Mep;Kep;Kep;Jep;Negwp;Mepxbbn0bbn0bbn0bbn0gqp;KepxFbbbFbbbFbbbFbbbp9oaopxbbbFbbbFbbbFbbbFp9op9qarawp;Meaqp;Kecwp:RepxbFbbbFbbbFbbbFbbp9op9qaDawp;Meaqp;Keczp:RepxbbFbbbFbbbFbbbFbp9op9qpklbkalaiad;8qbbskdnaec98GgxTmbcbhvabhdinadczfglalpbbbgopxbbbbbbFFbbbbbbFFgkp9oadpbbbgDaopmlvorxmPsCXQL358E8FpxFubbFubbFubbFubbp9op;6eaDaopmbediwDqkzHOAKY8AEgoczp:Sep;6egrp;Geaoczp:Reczp:Sep;6egwp;Gep;Kep;Legopxb;:FSb;:FSb;:FSb;:FSawaopxbbbbbbbbbbbbbbbbp:2egqawpxbbbjbbbjbbbjbbbjgmp9op9rp;Kegwawp;Meaoaop;Mearaqaramp9op9rp;Kegoaop;Mep;Kep;Kep;Jep;Negrp;Mepxbbn0bbn0bbn0bbn0gqp;Keczp:Reawarp;Meaqp;KepxFFbbFFbbFFbbFFbbp9op9qgwaoarp;Meaqp;KepxFFbbFFbbFFbbFFbbp9ogopmwDKYqk8AExm35Ps8E8Fp9qpkbbadaDakp9oawaopmbezHdiOAlvCXorQLp9qpkbbadcafhdavclfgvax6mbkkaxae9pmbaiaeciGgvcitgdfcbcaad9R;8kbaiabaxcitfglad;8qbbdnavTmbaiaipblzgopxbbbbbbFFbbbbbbFFgkp9oaipblbgDaopmlvorxmPsCXQL358E8FpxFubbFubbFubbFubbp9op;6eaDaopmbediwDqkzHOAKY8AEgoczp:Sep;6egrp;Geaoczp:Reczp:Sep;6egwp;Gep;Kep;Legopxb;:FSb;:FSb;:FSb;:FSawaopxbbbbbbbbbbbbbbbbp:2egqawpxbbbjbbbjbbbjbbbjgmp9op9rp;Kegwawp;Meaoaop;Mearaqaramp9op9rp;Kegoaop;Mep;Kep;Kep;Jep;Negrp;Mepxbbn0bbn0bbn0bbn0gqp;Keczp:Reawarp;Meaqp;KepxFFbbFFbbFFbbFFbbp9op9qgwaoarp;Meaqp;KepxFFbbFFbbFFbbFFbbp9ogopmwDKYqk8AExm35Ps8E8Fp9qpklzaiaDakp9oawaopmbezHdiOAlvCXorQLp9qpklbkalaiad;8qbbkk;4wllue97euv978Jjjjjbc8W9Rhidnaec98GglTmbcbhvabhoinaiaopbbbgraoczfgwpbbbgDpmlvorxmPsCXQL358E8Fgqczp:Segkclp:RepklbaopxbbjZbbjZbbjZbbjZpx;Zl81Z;Zl81Z;Zl81Z;Zl81Zakpxibbbibbbibbbibbbp9qp;6ep;NegkaraDpmbediwDqkzHOAKY8AEgrczp:Reczp:Sep;6ep;MegDaDp;Meakarczp:Sep;6ep;Megxaxp;Meakaqczp:Reczp:Sep;6ep;Megqaqp;Mep;Kep;Kep;Lepxbbbbbbbbbbbbbbbbp:4ep;Jepxb;:FSb;:FSb;:FSb;:FSgkp;Mepxbbn0bbn0bbn0bbn0grp;KepxFFbbFFbbFFbbFFbbgmp9oaxakp;Mearp;Keczp:Rep9qgxaqakp;Mearp;Keczp:ReaDakp;Mearp;Keamp9op9qgkpmbezHdiOAlvCXorQLgrp5baipblbpEb:T:j83ibaocwfarp5eaipblbpEe:T:j83ibawaxakpmwDKYqk8AExm35Ps8E8Fgkp5baipblbpEd:T:j83ibaocKfakp5eaipblbpEi:T:j83ibaocafhoavclfgval6mbkkdnalae9pmbaiaeciGgvcitgofcbcaao9R;8kbaiabalcitfgwao;8qbbdnavTmbaiaipblbgraipblzgDpmlvorxmPsCXQL358E8Fgqczp:Segkclp:RepklaaipxbbjZbbjZbbjZbbjZpx;Zl81Z;Zl81Z;Zl81Z;Zl81Zakpxibbbibbbibbbibbbp9qp;6ep;NegkaraDpmbediwDqkzHOAKY8AEgrczp:Reczp:Sep;6ep;MegDaDp;Meakarczp:Sep;6ep;Megxaxp;Meakaqczp:Reczp:Sep;6ep;Megqaqp;Mep;Kep;Kep;Lepxbbbbbbbbbbbbbbbbp:4ep;Jepxb;:FSb;:FSb;:FSb;:FSgkp;Mepxbbn0bbn0bbn0bbn0grp;KepxFFbbFFbbFFbbFFbbgmp9oaxakp;Mearp;Keczp:Rep9qgxaqakp;Mearp;Keczp:ReaDakp;Mearp;Keamp9op9qgkpmbezHdiOAlvCXorQLgrp5baipblapEb:T:j83ibaiarp5eaipblapEe:T:j83iwaiaxakpmwDKYqk8AExm35Ps8E8Fgkp5baipblapEd:T:j83izaiakp5eaipblapEi:T:j83iKkawaiao;8qbbkk:Pddiue978Jjjjjbc;ab9Rhidnadcd4ae2glc98GgvTmbcbhdabheinaeaepbbbgocwp:Recwp:Sep;6eaocep:SepxbbjZbbjZbbjZbbjZp:UepxbbjFbbjFbbjFbbjFp9op;Mepkbbaeczfheadclfgdav6mbkkdnaval9pmbaialciGgdcdtgeVcbc;abae9R;8kbaiabavcdtfgvae;8qbbdnadTmbaiaipblbgocwp:Recwp:Sep;6eaocep:SepxbbjZbbjZbbjZbbjZp:UepxbbjFbbjFbbjFbbjFp9op;Mepklbkavaiae;8qbbkk9teiucbcbydj1jjbgeabcifc98GfgbBdj1jjbdndnabZbcztgd9nmbcuhiabad9RcFFifcz4nbcuSmekaehikaikkkebcjwklz9Tbb",e=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),i=new Uint8Array([32,0,65,2,1,106,34,33,3,128,11,4,13,64,6,253,10,7,15,116,127,5,8,12,40,16,19,54,20,9,27,255,113,17,42,67,24,23,146,148,18,14,22,45,70,69,56,114,101,21,25,63,75,136,108,28,118,29,73,115]);if(typeof WebAssembly!="object")return{supported:!1};var s=WebAssembly.validate(e)?t:n,r,o=WebAssembly.instantiate(a(s),{}).then(function(y){r=y.instance,r.exports.__wasm_call_ctors()});function a(y){for(var b=new Uint8Array(y.length),_=0;_<y.length;++_){var x=y.charCodeAt(_);b[_]=x>96?x-97:x>64?x-39:x+4}for(var S=0,_=0;_<y.length;++_)b[S++]=b[_]<60?i[b[_]]:(b[_]-60)*64+b[++_];return b.buffer.slice(0,S)}function l(y,b,_,x,S,T){var L=r.exports.sbrk,I=_+3&-4,P=L(I*x),R=L(S.length),B=new Uint8Array(r.exports.memory.buffer);B.set(S,R);var Q=y(P,_,x,R,S.length);if(Q==0&&T&&T(P,I,x),b.set(B.subarray(P,P+_*x)),L(P-L(0)),Q!=0)throw new Error("Malformed buffer data: "+Q)}var h={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},u={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"},d=[],f=0;function p(y){var b={object:new Worker(y),pending:0,requests:{}};return b.object.onmessage=function(_){var x=_.data;b.pending-=x.count,b.requests[x.id][x.action](x.value),delete b.requests[x.id]},b}function g(y){for(var b="var instance; var ready = WebAssembly.instantiate(new Uint8Array(["+new Uint8Array(a(s))+"]), {}).then(function(result) { instance = result.instance; instance.exports.__wasm_call_ctors(); });self.onmessage = workerProcess;"+l.toString()+v.toString(),_=new Blob([b],{type:"text/javascript"}),x=URL.createObjectURL(_),S=0;S<y;++S)d[S]=p(x);URL.revokeObjectURL(x)}function m(y,b,_,x,S){for(var T=d[0],L=1;L<d.length;++L)d[L].pending<T.pending&&(T=d[L]);return new Promise(function(I,P){var R=new Uint8Array(_),B=f++;T.pending+=y,T.requests[B]={resolve:I,reject:P},T.object.postMessage({id:B,count:y,size:b,source:R,mode:x,filter:S},[R.buffer])})}function v(y){o.then(function(){var b=y.data;try{var _=new Uint8Array(b.count*b.size);l(r.exports[b.mode],_,b.count,b.size,b.source,r.exports[b.filter]),self.postMessage({id:b.id,count:b.count,action:"resolve",value:_},[_.buffer])}catch(x){self.postMessage({id:b.id,count:b.count,action:"reject",value:x})}})}return{ready:o,supported:!0,useWorkers:function(y){g(y)},decodeVertexBuffer:function(y,b,_,x,S){l(r.exports.meshopt_decodeVertexBuffer,y,b,_,x,r.exports[h[S]])},decodeIndexBuffer:function(y,b,_,x){l(r.exports.meshopt_decodeIndexBuffer,y,b,_,x)},decodeIndexSequence:function(y,b,_,x){l(r.exports.meshopt_decodeIndexSequence,y,b,_,x)},decodeGltfBuffer:function(y,b,_,x,S,T){l(r.exports[u[S]],y,b,_,x,r.exports[h[T]])},decodeGltfBufferAsync:function(y,b,_,x,S){return d.length>0?m(y,b,_,u[x],h[S]):o.then(function(){var T=new Uint8Array(y*b);return l(r.exports[u[x]],T,y,b,_,r.exports[h[S]]),T})}}}();const X0=new WeakMap;class by extends Lh{constructor(t){super(t),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(t){return this.decoderPath=t,this}setDecoderConfig(t){return this.decoderConfig=t,this}setWorkerLimit(t){return this.workerLimit=t,this}load(t,e,i,s){const r=new Zr(this.manager);r.setPath(this.path),r.setResponseType("arraybuffer"),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials),r.load(t,o=>{this.parse(o,e,s)},i,s)}parse(t,e,i=()=>{}){this.decodeDracoFile(t,e,null,null,Ue).catch(i)}decodeDracoFile(t,e,i,s,r=Di,o=()=>{}){const a={attributeIDs:i||this.defaultAttributeIDs,attributeTypes:s||this.defaultAttributeTypes,useUniqueIDs:!!i,vertexColorSpace:r};return this.decodeGeometry(t,a).then(e).catch(o)}decodeGeometry(t,e){const i=JSON.stringify(e);if(X0.has(t)){const l=X0.get(t);if(l.key===i)return l.promise;if(t.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let s;const r=this.workerNextTaskID++,o=t.byteLength,a=this._getWorker(r,o).then(l=>(s=l,new Promise((h,u)=>{s._callbacks[r]={resolve:h,reject:u},s.postMessage({type:"decode",id:r,taskConfig:e,buffer:t},[t])}))).then(l=>this._createGeometry(l.geometry));return a.catch(()=>!0).then(()=>{s&&r&&this._releaseTask(s,r)}),X0.set(t,{key:i,promise:a}),a}_createGeometry(t){const e=new jt;t.index&&e.setIndex(new Ve(t.index.array,1));for(let i=0;i<t.attributes.length;i++){const s=t.attributes[i],r=s.name,o=s.array,a=s.itemSize,l=new Ve(o,a);r==="color"&&(this._assignVertexColorSpace(l,s.vertexColorSpace),l.normalized=!(o instanceof Float32Array)),e.setAttribute(r,l)}return e}_assignVertexColorSpace(t,e){if(e!==Ue)return;const i=new we;for(let s=0,r=t.count;s<r;s++)i.fromBufferAttribute(t,s).convertSRGBToLinear(),t.setXYZ(s,i.r,i.g,i.b)}_loadLibrary(t,e){const i=new Zr(this.manager);return i.setPath(this.decoderPath),i.setResponseType(e),i.setWithCredentials(this.withCredentials),new Promise((s,r)=>{i.load(t,s,void 0,r)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const t=typeof WebAssembly!="object"||this.decoderConfig.type==="js",e=[];return t?e.push(this._loadLibrary("draco_decoder.js","text")):(e.push(this._loadLibrary("draco_wasm_wrapper.js","text")),e.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(e).then(i=>{const s=i[0];t||(this.decoderConfig.wasmBinary=i[1]);const r=HN.toString(),o=["/* draco decoder */",s,"","/* worker */",r.substring(r.indexOf("{")+1,r.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([o]))}),this.decoderPending}_getWorker(t,e){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const s=new Worker(this.workerSourceURL);s._callbacks={},s._taskCosts={},s._taskLoad=0,s.postMessage({type:"init",decoderConfig:this.decoderConfig}),s.onmessage=function(r){const o=r.data;switch(o.type){case"decode":s._callbacks[o.id].resolve(o);break;case"error":s._callbacks[o.id].reject(o);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+o.type+'"')}},this.workerPool.push(s)}else this.workerPool.sort(function(s,r){return s._taskLoad>r._taskLoad?-1:1});const i=this.workerPool[this.workerPool.length-1];return i._taskCosts[t]=e,i._taskLoad+=e,i})}_releaseTask(t,e){t._taskLoad-=t._taskCosts[e],delete t._callbacks[e],delete t._taskCosts[e]}debug(){console.log("Task load: ",this.workerPool.map(t=>t._taskLoad))}dispose(){for(let t=0;t<this.workerPool.length;++t)this.workerPool[t].terminate();return this.workerPool.length=0,this.workerSourceURL!==""&&URL.revokeObjectURL(this.workerSourceURL),this}}function HN(){let n,t;onmessage=function(o){const a=o.data;switch(a.type){case"init":n=a.decoderConfig,t=new Promise(function(u){n.onModuleLoaded=function(d){u({draco:d})},DracoDecoderModule(n)});break;case"decode":const l=a.buffer,h=a.taskConfig;t.then(u=>{const d=u.draco,f=new d.Decoder;try{const p=e(d,f,new Int8Array(l),h),g=p.attributes.map(m=>m.array.buffer);p.index&&g.push(p.index.array.buffer),self.postMessage({type:"decode",id:a.id,geometry:p},g)}catch(p){console.error(p),self.postMessage({type:"error",id:a.id,error:p.message})}finally{d.destroy(f)}});break}};function e(o,a,l,h){const u=h.attributeIDs,d=h.attributeTypes;let f,p;const g=a.GetEncodedGeometryType(l);if(g===o.TRIANGULAR_MESH)f=new o.Mesh,p=a.DecodeArrayToMesh(l,l.byteLength,f);else if(g===o.POINT_CLOUD)f=new o.PointCloud,p=a.DecodeArrayToPointCloud(l,l.byteLength,f);else throw new Error("THREE.DRACOLoader: Unexpected geometry type.");if(!p.ok()||f.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+p.error_msg());const m={index:null,attributes:[]};for(const v in u){const y=self[d[v]];let b,_;if(h.useUniqueIDs)_=u[v],b=a.GetAttributeByUniqueId(f,_);else{if(_=a.GetAttributeId(f,o[u[v]]),_===-1)continue;b=a.GetAttribute(f,_)}const x=s(o,a,f,v,y,b);v==="color"&&(x.vertexColorSpace=h.vertexColorSpace),m.attributes.push(x)}return g===o.TRIANGULAR_MESH&&(m.index=i(o,a,f)),o.destroy(f),m}function i(o,a,l){const u=l.num_faces()*3,d=u*4,f=o._malloc(d);a.GetTrianglesUInt32Array(l,d,f);const p=new Uint32Array(o.HEAPF32.buffer,f,u).slice();return o._free(f),{array:p,itemSize:1}}function s(o,a,l,h,u,d){const f=d.num_components(),g=l.num_points()*f,m=g*u.BYTES_PER_ELEMENT,v=r(o,u),y=o._malloc(m);a.GetAttributeDataArrayForAllPoints(l,d,v,m,y);const b=new u(o.HEAPF32.buffer,y,g).slice();return o._free(y),{name:h,array:b,itemSize:f}}function r(o,a){switch(a){case Float32Array:return o.DT_FLOAT32;case Int8Array:return o.DT_INT8;case Int16Array:return o.DT_INT16;case Int32Array:return o.DT_INT32;case Uint8Array:return o.DT_UINT8;case Uint16Array:return o.DT_UINT16;case Uint32Array:return o.DT_UINT32}}}class VN{constructor(t=4){this.pool=t,this.queue=[],this.workers=[],this.workersResolve=[],this.workerStatus=0}_initWorker(t){if(!this.workers[t]){const e=this.workerCreator();e.addEventListener("message",this._onMessage.bind(this,t)),this.workers[t]=e}}_getIdleWorker(){for(let t=0;t<this.pool;t++)if(!(this.workerStatus&1<<t))return t;return-1}_onMessage(t,e){const i=this.workersResolve[t];if(i&&i(e),this.queue.length){const{resolve:s,msg:r,transfer:o}=this.queue.shift();this.workersResolve[t]=s,this.workers[t].postMessage(r,o)}else this.workerStatus^=1<<t}setWorkerCreator(t){this.workerCreator=t}setWorkerLimit(t){this.pool=t}postMessage(t,e){return new Promise(i=>{const s=this._getIdleWorker();s!==-1?(this._initWorker(s),this.workerStatus|=1<<s,this.workersResolve[s]=i,this.workers[s].postMessage(t,e)):this.queue.push({resolve:i,msg:t,transfer:e})})}dispose(){this.workers.forEach(t=>t.terminate()),this.workersResolve.length=0,this.workers.length=0,this.queue.length=0,this.workerStatus=0}}const WN=0,wE=2,qN=1,xE=2,XN=0,YN=1,KN=10,JN=0,wP=9,xP=15,CP=16,SP=22,EP=37,IP=43,TP=76,RP=83,BP=97,PP=100,MP=103,DP=109,kP=165,OP=166;class ZN{constructor(){this.vkFormat=0,this.typeSize=1,this.pixelWidth=0,this.pixelHeight=0,this.pixelDepth=0,this.layerCount=0,this.faceCount=1,this.supercompressionScheme=0,this.levels=[],this.dataFormatDescriptor=[{vendorId:0,descriptorType:0,descriptorBlockSize:0,versionNumber:2,colorModel:0,colorPrimaries:1,transferFunction:2,flags:0,texelBlockDimension:[0,0,0,0],bytesPlane:[0,0,0,0,0,0,0,0],samples:[]}],this.keyValue={},this.globalData=null}}class Cf{constructor(t,e,i,s){this._dataView=new DataView(t.buffer,t.byteOffset+e,i),this._littleEndian=s,this._offset=0}_nextUint8(){const t=this._dataView.getUint8(this._offset);return this._offset+=1,t}_nextUint16(){const t=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,t}_nextUint32(){const t=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,t}_nextUint64(){const t=this._dataView.getUint32(this._offset,this._littleEndian)+4294967296*this._dataView.getUint32(this._offset+4,this._littleEndian);return this._offset+=8,t}_nextInt32(){const t=this._dataView.getInt32(this._offset,this._littleEndian);return this._offset+=4,t}_skip(t){return this._offset+=t,this}_scan(t,e=0){const i=this._offset;let s=0;for(;this._dataView.getUint8(this._offset)!==e&&s<t;)s++,this._offset++;return s<t&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+i,s)}}const ms=[171,75,84,88,32,50,48,187,13,10,26,10];function CE(n){return typeof TextDecoder<"u"?new TextDecoder().decode(n):Buffer.from(n).toString("utf8")}function $N(n){const t=new Uint8Array(n.buffer,n.byteOffset,ms.length);if(t[0]!==ms[0]||t[1]!==ms[1]||t[2]!==ms[2]||t[3]!==ms[3]||t[4]!==ms[4]||t[5]!==ms[5]||t[6]!==ms[6]||t[7]!==ms[7]||t[8]!==ms[8]||t[9]!==ms[9]||t[10]!==ms[10]||t[11]!==ms[11])throw new Error("Missing KTX 2.0 identifier.");const e=new ZN,i=17*Uint32Array.BYTES_PER_ELEMENT,s=new Cf(n,ms.length,i,!0);e.vkFormat=s._nextUint32(),e.typeSize=s._nextUint32(),e.pixelWidth=s._nextUint32(),e.pixelHeight=s._nextUint32(),e.pixelDepth=s._nextUint32(),e.layerCount=s._nextUint32(),e.faceCount=s._nextUint32();const r=s._nextUint32();e.supercompressionScheme=s._nextUint32();const o=s._nextUint32(),a=s._nextUint32(),l=s._nextUint32(),h=s._nextUint32(),u=s._nextUint64(),d=s._nextUint64(),f=new Cf(n,ms.length+i,3*r*8,!0);for(let M=0;M<r;M++)e.levels.push({levelData:new Uint8Array(n.buffer,n.byteOffset+f._nextUint64(),f._nextUint64()),uncompressedByteLength:f._nextUint64()});const p=new Cf(n,o,a,!0),g={vendorId:p._skip(4)._nextUint16(),descriptorType:p._nextUint16(),versionNumber:p._nextUint16(),descriptorBlockSize:p._nextUint16(),colorModel:p._nextUint8(),colorPrimaries:p._nextUint8(),transferFunction:p._nextUint8(),flags:p._nextUint8(),texelBlockDimension:[p._nextUint8(),p._nextUint8(),p._nextUint8(),p._nextUint8()],bytesPlane:[p._nextUint8(),p._nextUint8(),p._nextUint8(),p._nextUint8(),p._nextUint8(),p._nextUint8(),p._nextUint8(),p._nextUint8()],samples:[]},m=(g.descriptorBlockSize/4-6)/4;for(let M=0;M<m;M++){const H={bitOffset:p._nextUint16(),bitLength:p._nextUint8(),channelType:p._nextUint8(),samplePosition:[p._nextUint8(),p._nextUint8(),p._nextUint8(),p._nextUint8()],sampleLower:-1/0,sampleUpper:1/0};64&H.channelType?(H.sampleLower=p._nextInt32(),H.sampleUpper=p._nextInt32()):(H.sampleLower=p._nextUint32(),H.sampleUpper=p._nextUint32()),g.samples[M]=H}e.dataFormatDescriptor.length=0,e.dataFormatDescriptor.push(g);const v=new Cf(n,l,h,!0);for(;v._offset<h;){const M=v._nextUint32(),H=v._scan(M),ee=CE(H),Y=v._scan(M-H.byteLength);e.keyValue[ee]=ee.match(/^ktx/i)?CE(Y):Y,v._offset%4&&v._skip(4-v._offset%4)}if(d<=0)return e;const y=new Cf(n,u,d,!0),b=y._nextUint16(),_=y._nextUint16(),x=y._nextUint32(),S=y._nextUint32(),T=y._nextUint32(),L=y._nextUint32(),I=[];for(let M=0;M<r;M++)I.push({imageFlags:y._nextUint32(),rgbSliceByteOffset:y._nextUint32(),rgbSliceByteLength:y._nextUint32(),alphaSliceByteOffset:y._nextUint32(),alphaSliceByteLength:y._nextUint32()});const P=u+y._offset,R=P+x,B=R+S,Q=B+T,G=new Uint8Array(n.buffer,n.byteOffset+P,x),V=new Uint8Array(n.buffer,n.byteOffset+R,S),X=new Uint8Array(n.buffer,n.byteOffset+B,T),k=new Uint8Array(n.buffer,n.byteOffset+Q,L);return e.globalData={endpointCount:b,selectorCount:_,imageDescs:I,endpointsData:G,selectorsData:V,tablesData:X,extendedData:k},e}let Y0,$a,Q_;const K0={env:{emscripten_notify_memory_growth:function(n){Q_=new Uint8Array($a.exports.memory.buffer)}}};class e4{init(){return Y0||(Y0=typeof fetch<"u"?fetch("data:application/wasm;base64,"+SE).then(t=>t.arrayBuffer()).then(t=>WebAssembly.instantiate(t,K0)).then(this._init):WebAssembly.instantiate(Buffer.from(SE,"base64"),K0).then(this._init),Y0)}_init(t){$a=t.instance,K0.env.emscripten_notify_memory_growth(0)}decode(t,e=0){if(!$a)throw new Error("ZSTDDecoder: Await .init() before decoding.");const i=t.byteLength,s=$a.exports.malloc(i);Q_.set(t,s),e=e||Number($a.exports.ZSTD_findDecompressedSize(s,i));const r=$a.exports.malloc(e),o=$a.exports.ZSTD_decompress(r,e,s,i),a=Q_.slice(r,r+o);return $a.exports.free(s),$a.exports.free(r),a}}const SE="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IAMNACAEQQNxBEADQCACRQ0FIAAgAkF/aiICaiIDIAEgAmotAAA6AAAgA0EDcQ0ACwsgAkEDTQ0AA0AgACACQXxqIgJqIAEgAmooAgA2AgAgAkEDSw0ACwsgAkUNAgNAIAAgAkF/aiICaiABIAJqLQAAOgAAIAINAAsMAgsgAkEDTQ0AIAIhBANAIAMgASgCADYCACABQQRqIQEgA0EEaiEDIARBfGoiBEEDSw0ACyACQQNxIQILIAJFDQADQCADIAEtAAA6AAAgA0EBaiEDIAFBAWohASACQX9qIgINAAsLIAAL8wICAn8BfgJAIAJFDQAgACACaiIDQX9qIAE6AAAgACABOgAAIAJBA0kNACADQX5qIAE6AAAgACABOgABIANBfWogAToAACAAIAE6AAIgAkEHSQ0AIANBfGogAToAACAAIAE6AAMgAkEJSQ0AIABBACAAa0EDcSIEaiIDIAFB/wFxQYGChAhsIgE2AgAgAyACIARrQXxxIgRqIgJBfGogATYCACAEQQlJDQAgAyABNgIIIAMgATYCBCACQXhqIAE2AgAgAkF0aiABNgIAIARBGUkNACADIAE2AhggAyABNgIUIAMgATYCECADIAE2AgwgAkFwaiABNgIAIAJBbGogATYCACACQWhqIAE2AgAgAkFkaiABNgIAIAQgA0EEcUEYciIEayICQSBJDQAgAa0iBUIghiAFhCEFIAMgBGohAQNAIAEgBTcDGCABIAU3AxAgASAFNwMIIAEgBTcDACABQSBqIQEgAkFgaiICQR9LDQALCyAACy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAIajYCACADCy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAFajYCACADCx8AIAAgASACKAIEEAg2AgAgARAEGiAAIAJBCGo2AgQLCAAgAGdBH3MLugUBDX8jAEEQayIKJAACfyAEQQNNBEAgCkEANgIMIApBDGogAyAEEAsaIAAgASACIApBDGpBBBAVIgBBbCAAEAMbIAAgACAESxsMAQsgAEEAIAEoAgBBAXRBAmoQECENQVQgAygAACIGQQ9xIgBBCksNABogAiAAQQVqNgIAIAMgBGoiAkF8aiEMIAJBeWohDiACQXtqIRAgAEEGaiELQQQh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ASIDNgLE4AEgACgCvOABIQQgACABNgK84AEgACABIAJqNgK44AEgACABIAQgA2tqNgLA4AELpgEBAX8gACAAKALs4QEQFjYCyOABIABCADcD+OABIABCADcDuOABIABBwOABakIANwMAIABBqNAAaiIBQYyAgOAANgIAIABBADYCmOIBIABCADcDiOEBIABCAzcDgOEBIABBrNABakHgEikCADcCACAAQbTQAWpB6BIoAgA2AgAgACABNgIMIAAgAEGYIGo2AgggACAAQaAwajYCBCAAIABBEGo2AgALYQEBf0G4fyEDAkAgAUEDSQ0AIAIgABAhIgFBA3YiADYCCCACIAFBAXE2AgQgAiABQQF2QQNxIgM2AgACQCADQX9qIgFBAksNAAJAIAFBAWsOAgEAAgtBbA8LIAAhAwsgAwsMACAAIAEgAkEAEC4LiAQCA38CfiADEBYhBCAAQQBBKBAQIQAgBCACSwRAIAQPCyABRQRAQX8PCwJAAkAgA0EBRg0AIAEoAAAiBkGo6r5pRg0AQXYhAyAGQXBxQdDUtMIBRw0BQQghAyACQQhJDQEgAEEAQSgQECEAIAEoAAQhASAAQQE2AhQgACABrTcDAEEADwsgASACIAMQLyIDIAJLDQAgACADNgIYQXIhAyABIARqIgVBf2otAAAiAkEIcQ0AIAJBIHEiBkUEQEFwIQMgBS0AACIFQacBSw0BIAVBB3GtQgEgBUEDdkEKaq2GIgdCA4h+IAd8IQggBEEBaiEECyACQQZ2IQMgAkECdiEFAkAgAkEDcUF/aiICQQJLBEBBACECDAELAkACQAJAIAJBAWsOAgECAAsgASAEai0AACECIARBAWohBAwCCyABIARqLwAAIQIgBEECaiEEDAELIAEgBGooAAAhAiAEQQRqIQQLIAVBAXEhBQJ+AkACQAJAIANBf2oiA0ECTQRAIANBAWsOAgIDAQtCfyAGRQ0DGiABIARqMQAADAMLIAEgBGovAACtQoACfAwCCyABIARqKAAArQwBCyABIARqKQAACyEHIAAgBTYCICAAIAI2AhwgACAHNwMAQQAhAyAAQQA2AhQgACAHIAggBhsiBzcDCCAAIAdCgIAIIAdCgIAIVBs+AhALIAMLWwEBf0G4fyEDIAIQFiICIAFNBH8gACACakF/ai0AACIAQQNxQQJ0QaAeaigC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C0Egak8NAQsgByAHKQNoNwMQIAcgBykDYDcDCCAEIA0gB0EIaiAHQdwAaiAPIA4gESAQEB4hCwwBCyACIARqIQggBCAKEAcgAkERTwRAIARBEGohAgNAIAIgCkEQaiIKEAcgAkEQaiICIAhJDQALCyAIIAlrIQIgByATNgJcIAkgCCAOa0sEQCAJIAggEWtLBEBBbCELDAILIBAgAiAOayICaiIKIANqIBBNBEAgCCAKIAMQDxoMAgsgCCAKQQAgAmsQDyEIIAcgAiADaiIDNgJkIAggAmshCCAOIQILIAlBEE8EQCADIAhqIQMDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALDAELAkAgCUEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgCUECdCIDQcAeaigCAGoiAhAXIAIgA0HgHmooAgBrIQIgBygCZCEDDAELIAggAhAMCyADQQlJDQAgAyAIaiEDIAhBCGoiCCACQQhqIgJrQQ9MBEADQCAIIAIQDCACQQhqIQIgCEEIaiIIIANJDQAMAgALAAsDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALCyAHQRhqEAQaIAsgDCALEAMiAhshDCAEIAQgC2ogAhshBCAFQX9qIgUNAAsgDBADDQFBbCEMIAdBGGoQBEECSQ0BQQAhCANAIAhBA0cEQCAAIAhBAnQiAmpBrNABaiACIAdqKAJENgIAIAhBAWohCAwBCwsgBygCXCEIC0G6fyEMIA8gCGsiACANIARrSw0AIAQEfyAEIAggABALIABqBUEACyABayEMCyAHQfAAaiQAIAwLkRcCFn8FfiMAQdABayIHJAAgByAAKALw4QEiCDYCvAEgASACaiESIAggACgCgOIBaiETAkACQCAFRQRAIAEhAwwBCyAAKALE4AEhESAAKALA4AEhFSAAKAK84AEhDyAAQQE2AozhAUEAIQgDQCAIQQNHBEAgByAIQQJ0IgJqIAAgAmpBrNABaigCADYCVCAIQQFqIQgMAQsLIAcgETYCZCAHIA82AmAgByABIA9rNgJoQWwhECAHQShqIAMgBBAGEAMNASAFQQQgBUEESBshFyAHQTxqIAdBKGogACgCABATIAdBxABqIAdBKGogACgCCBATIAdBzABqIAdB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IAdB0AFqJAAgEAslACAAQgA3AgAgAEEAOwEIIABBADoACyAAIAE2AgwgACACOgAKC7QFAQN/IwBBMGsiBCQAIABB/wFqIgVBfWohBgJAIAMvAQIEQCAEQRhqIAEgAhAGIgIQAw0BIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahASOgAAIAMgBEEIaiAEQRhqEBI6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0FIAEgBEEQaiAEQRhqEBI6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBSABIARBCGogBEEYahASOgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEjoAACABIAJqIABrIQIMAwsgAyAEQRBqIARBGGoQEjoAAiADIARBCGogBEEYahASOgADIANBBGohAwwAAAsACyAEQRhqIAEgAhAGIgIQAw0AIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahAROgAAIAMgBEEIaiAEQRhqEBE6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0EIAEgBEEQaiAEQRhqEBE6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBCABIARBCGogBEEYahAROgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEToAACABIAJqIABrIQIMAgsgAyAEQRBqIARBGGoQEToAAiADIARBCGogBEEYahAROgADIANBBGohAwwAAAsACyAEQTBqJAAgAgtpAQF/An8CQAJAIAJBB00NACABKAAAQbfIwuF+Rw0AIAAgASgABDYCmOIBQWIgAEEQaiABIAIQPiIDEAMNAhogAEKBgICAEDcDiOEBIAAgASADaiACIANrECoMAQsgACABIAIQKgtBAAsLrQMBBn8jAEGAAWsiAyQAQWIhCAJAIAJBCUkNACAAQZjQAGogAUEIaiIEIAJBeGogAEGY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wOABCwutAgIEfwF+IwBBQGoiBCQAAkACQCACQQhJDQAgASgAAEFwcUHQ1LTCAUcNACABIAIQIiEBIABCADcDCCAAQQA2AgQgACABNgIADAELIARBGGogASACEC0iAxADBEAgACADEBoMAQsgAwRAIABBuH8QGgwBCyACIAQoAjAiA2shAiABIANqIQMDQAJAIAAgAyACIARBCGoQLCIFEAMEfyAFBSACIAVBA2oiBU8NAUG4fwsQGgwCCyAGQQFqIQYgAiAFayECIAMgBWohAyAEKAIMRQ0ACyAEKAI4BEAgAkEDTQRAIABBuH8QGgwCCyADQQRqIQMLIAQoAighAiAEKQMYIQcgAEEANgIEIAAgAyABazYCACAAIAIgBmytIAcgB0J/URs3AwgLIARBQGskAAslAQF/IwBBEGsiAiQAIAIgACABEFEgAigCACEAIAJBEGokACAAC30BBH8jAEGQBGsiBCQAIARB/wE2AggCQCAEQRBqIARBCGogBEEMaiABIAIQFSIGEAMEQCAGIQUMAQtBVCEFIAQoAgwiB0EGSw0AIAMgBEEQaiAEKAIIIAcQQSIFEAMNACAAIAEgBmogAiAGayADEDwhBQsgBEGQBGokACAFC4cBAgJ/An5BABAWIQMCQANAIAEgA08EQAJAIAAoAABBcHFB0NS0wgFGBEAgACABECIiAhADRQ0BQn4PCyAAIAEQVSIEQn1WDQMgBCAFfCIFIARUIQJCfiEEIAINAyAAIAEQUiICEAMNAwsgASACayEBIAAgAmohAAwBCwtCfiAFIAEbIQQLIAQLPwIBfwF+IwBBMGsiAiQAAn5CfiACQQhqIAAgARAtDQAaQgAgAigCHEEBRg0AGiACKQMICyEDIAJBMGokACADC40BAQJ/IwBBMGsiASQAAkAgAEUNACAAKAKI4gENACABIABB/OEBaigCADYCKCABIAApAvThATcDICAAEDAgACgCqOIBIQIgASABKAIoNgIYIAEgASkDIDcDECACIAFBEGoQGyAAQQA2AqjiASABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALKgECfyMAQRBrIgAkACAAQQA2AgggAEIANwMAIAAQWCEBIABBEGokACABC4cBAQN/IwBBEGsiAiQAAkAgACgCAEUgACgCBEVzDQAgAiAAKAIINgIIIAIgACkCADcDAAJ/IAIoAgAiAQRAIAIoAghBqOMJIAERBQAMAQtBqOMJECgLIgFFDQAgASAAKQIANwL04QEgAUH84QFqIAAoAgg2AgAgARBZIAEhAwsgAkEQaiQAIAMLywEBAn8jAEEgayIBJAAgAEGBgIDAADYCtOIBIABBADYCiOIBIABBADYC7OEBIABCADcDkOIBIABBADYCpOMJIABBADYC3OIBIABCADcCzOIBIABBADYCvOIBIABBADYCxOABIABCADcCnOIBIABBpOIBakIANwIAIABBrOIBakEANgIAIAFCADcCECABQgA3AhggASABKQMYNwMIIAEgASkDEDcDACABKAIIQQh2QQFxIQIgAEEANgLg4gEgACACNgKM4gEgAUEgaiQAC3YBA38jAEEwayIBJAAgAARAIAEgAEHE0AFqIgIoAgA2AiggASAAKQK80AE3AyAgACgCACEDIAEgAigCADYCGCABIAApArzQATcDECADIAFBEGoQGyABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALzAEBAX8gACABKAK00AE2ApjiASAAIAEoAgQiAjYCwOABIAAgAjYCvOABIAAgAiABKAIIaiICNgK44AEgACACNgLE4AEgASgCuNABBEAgAEKBgICAEDcDiOEBIAAgAUGk0ABqNgIMIAAgAUGUIGo2AgggACABQZwwajYCBCAAIAFBDGo2AgAgAEGs0AFqIAFBqNABaigCADYCACAAQbDQAWogAUGs0AFqKAIANgIAIABBtNABaiABQbDQAWooAgA2AgAPCyAAQgA3A4jhAQs7ACACRQRAQbp/DwsgBEUEQEFsDwsgAiAEEGAEQCAAIAEgAiADIAQgBRBhDwsgACABIAIgAyAEIAUQZQtGAQF/IwBBEGsiBSQAIAVBCGogBBAOAn8gBS0ACQRAIAAgASACIAMgBBAyDAELIAAgASACIAMgBBA0CyEAIAVBEGokACAACzQAIAAgAyAEIAUQNiIFEAMEQCAFDwsgBSAESQR/IAEgAiADIAVqIAQgBWsgABA1BUG4fwsLRgEBfyMAQRBrIgUkACAFQQhqIAQQDgJ/IAUtAAkEQCAAIAEgAiADIAQQYgwBCyAAIAEgAiADIAQQNQshACAFQRBqJAAgAAtZAQF/QQ8hAiABIABJBEAgAUEE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",J0=new WeakMap;let Z0=0,$0;class Jr extends Lh{constructor(t){super(t),this.transcoderPath="",this.transcoderBinary=null,this.transcoderPending=null,this.workerPool=new VN,this.workerSourceURL="",this.workerConfig=null,typeof MSC_TRANSCODER<"u"&&console.warn('THREE.KTX2Loader: Please update to latest "basis_transcoder". "msc_basis_transcoder" is no longer supported in three.js r125+.')}setTranscoderPath(t){return this.transcoderPath=t,this}setWorkerLimit(t){return this.workerPool.setWorkerLimit(t),this}async detectSupportAsync(t){return this.workerConfig={astcSupported:await t.hasFeatureAsync("texture-compression-astc"),etc1Supported:await t.hasFeatureAsync("texture-compression-etc1"),etc2Supported:await t.hasFeatureAsync("texture-compression-etc2"),dxtSupported:await t.hasFeatureAsync("texture-compression-bc"),bptcSupported:await t.hasFeatureAsync("texture-compression-bptc"),pvrtcSupported:await t.hasFeatureAsync("texture-compression-pvrtc")},this}detectSupport(t){return t.isWebGPURenderer===!0?this.workerConfig={astcSupported:t.hasFeature("texture-compression-astc"),etc1Supported:t.hasFeature("texture-compression-etc1"),etc2Supported:t.hasFeature("texture-compression-etc2"),dxtSupported:t.hasFeature("texture-compression-bc"),bptcSupported:t.hasFeature("texture-compression-bptc"),pvrtcSupported:t.hasFeature("texture-compression-pvrtc")}:(this.workerConfig={astcSupported:t.extensions.has("WEBGL_compressed_texture_astc"),etc1Supported:t.extensions.has("WEBGL_compressed_texture_etc1"),etc2Supported:t.extensions.has("WEBGL_compressed_texture_etc"),dxtSupported:t.extensions.has("WEBGL_compressed_texture_s3tc"),bptcSupported:t.extensions.has("EXT_texture_compression_bptc"),pvrtcSupported:t.extensions.has("WEBGL_compressed_texture_pvrtc")||t.extensions.has("WEBKIT_WEBGL_compressed_texture_pvrtc")},t.capabilities.isWebGL2&&(this.workerConfig.etc1Supported=!1)),this}init(){if(!this.transcoderPending){const t=new Zr(this.manager);t.setPath(this.transcoderPath),t.setWithCredentials(this.withCredentials);const e=t.loadAsync("basis_transcoder.js"),i=new Zr(this.manager);i.setPath(this.transcoderPath),i.setResponseType("arraybuffer"),i.setWithCredentials(this.withCredentials);const s=i.loadAsync("basis_transcoder.wasm");this.transcoderPending=Promise.all([e,s]).then(([r,o])=>{const a=Jr.BasisWorker.toString(),l=["/* constants */","let _EngineFormat = "+JSON.stringify(Jr.EngineFormat),"let _TranscoderFormat = "+JSON.stringify(Jr.TranscoderFormat),"let _BasisFormat = "+JSON.stringify(Jr.BasisFormat),"/* basis_transcoder.js */",r,"/* worker */",a.substring(a.indexOf("{")+1,a.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([l])),this.transcoderBinary=o,this.workerPool.setWorkerCreator(()=>{const h=new Worker(this.workerSourceURL),u=this.transcoderBinary.slice(0);return h.postMessage({type:"init",config:this.workerConfig,transcoderBinary:u},[u]),h})}),Z0>0&&console.warn("THREE.KTX2Loader: Multiple active KTX2 loaders may cause performance issues. Use a single KTX2Loader instance, or call .dispose() on old instances."),Z0++}return this.transcoderPending}load(t,e,i,s){if(this.workerConfig===null)throw new Error("THREE.KTX2Loader: Missing initialization with `.detectSupport( renderer )`.");const r=new Zr(this.manager);r.setResponseType("arraybuffer"),r.setWithCredentials(this.withCredentials),r.load(t,o=>{if(J0.has(o))return J0.get(o).promise.then(e).catch(s);this._createTexture(o).then(a=>e?e(a):null).catch(s)},i,s)}_createTextureFrom(t,e){const{faces:i,width:s,height:r,format:o,type:a,error:l,dfdFlags:h}=t;if(a==="error")return Promise.reject(l);let u;if(e.faceCount===6)u=new NO(i,o,oi);else{const d=i[0].mipmaps;u=e.layerCount>1?new QO(d,s,r,e.layerCount,o,oi):new fd(d,s,r,o,oi)}return u.minFilter=i[0].mipmaps.length===1?Tt:Bg,u.magFilter=Tt,u.generateMipmaps=!1,u.needsUpdate=!0,u.colorSpace=LP(e),u.premultiplyAlpha=!!(h&qN),u}async _createTexture(t,e={}){const i=$N(new Uint8Array(t));if(i.vkFormat!==JN)return i4(i);const s=e,r=this.init().then(()=>this.workerPool.postMessage({type:"transcode",buffer:t,taskConfig:s},[t])).then(o=>this._createTextureFrom(o.data,i));return J0.set(t,{promise:r}),r}dispose(){return this.workerPool.dispose(),this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),Z0--,this}}Jr.BasisFormat={ETC1S:0,UASTC_4x4:1};Jr.TranscoderFormat={ETC1:0,ETC2:1,BC1:2,BC3:3,BC4:4,BC5:5,BC7_M6_OPAQUE_ONLY:6,BC7_M5:7,PVRTC1_4_RGB:8,PVRTC1_4_RGBA:9,ASTC_4x4:10,ATC_RGB:11,ATC_RGBA_INTERPOLATED_ALPHA:12,RGBA32:13,RGB565:14,BGR565:15,RGBA4444:16};Jr.EngineFormat={RGBAFormat:kn,RGBA_ASTC_4x4_Format:zO,RGBA_BPTC_Format:jO,RGBA_ETC2_EAC_Format:GO,RGBA_PVRTC_4BPPV1_Format:HO,RGBA_S3TC_DXT5_Format:VO,RGB_ETC1_Format:WO,RGB_ETC2_Format:qO,RGB_PVRTC_4BPPV1_Format:XO,RGB_S3TC_DXT1_Format:YO};Jr.BasisWorker=function(){let n,t,e;const i=_EngineFormat,s=_TranscoderFormat,r=_BasisFormat;self.addEventListener("message",function(g){const m=g.data;switch(m.type){case"init":n=m.config,o(m.transcoderBinary);break;case"transcode":t.then(()=>{try{const{faces:v,buffers:y,width:b,height:_,hasAlpha:x,format:S,dfdFlags:T}=a(m.buffer);self.postMessage({type:"transcode",id:m.id,faces:v,width:b,height:_,hasAlpha:x,format:S,dfdFlags:T},y)}catch(v){console.error(v),self.postMessage({type:"error",id:m.id,error:v.message})}});break}});function o(g){t=new Promise(m=>{e={wasmBinary:g,onRuntimeInitialized:m},BASIS(e)}).then(()=>{e.initializeBasis(),e.KTX2File===void 0&&console.warn("THREE.KTX2Loader: Please update Basis Universal transcoder.")})}function a(g){const m=new e.KTX2File(new Uint8Array(g));function v(){m.close(),m.delete()}if(!m.isValid())throw v(),new Error("THREE.KTX2Loader:	Invalid or unsupported .ktx2 file");const y=m.isUASTC()?r.UASTC_4x4:r.ETC1S,b=m.getWidth(),_=m.getHeight(),x=m.getLayers()||1,S=m.getLevels(),T=m.getFaces(),L=m.getHasAlpha(),I=m.getDFDFlags(),{transcoderFormat:P,engineFormat:R}=d(y,b,_,L);if(!b||!_||!S)throw v(),new Error("THREE.KTX2Loader:	Invalid texture");if(!m.startTranscoding())throw v(),new Error("THREE.KTX2Loader: .startTranscoding failed");const B=[],Q=[];for(let G=0;G<T;G++){const V=[];for(let X=0;X<S;X++){const k=[];let M,H;for(let Y=0;Y<x;Y++){const he=m.getImageLevelInfo(X,Y,G);G===0&&X===0&&Y===0&&(he.origWidth%4!==0||he.origHeight%4!==0)&&console.warn("THREE.KTX2Loader: ETC1S and UASTC textures should use multiple-of-four dimensions."),S>1?(M=he.origWidth,H=he.origHeight):(M=he.width,H=he.height);const de=new Uint8Array(m.getImageTranscodedSizeInBytes(X,Y,0,P));if(!m.transcodeImage(de,X,Y,G,P,0,-1,-1))throw v(),new Error("THREE.KTX2Loader: .transcodeImage failed.");k.push(de)}const ee=p(k);V.push({data:ee,width:M,height:H}),Q.push(ee.buffer)}B.push({mipmaps:V,width:b,height:_,format:R})}return v(),{faces:B,buffers:Q,width:b,height:_,hasAlpha:L,format:R,dfdFlags:I}}const l=[{if:"astcSupported",basisFormat:[r.UASTC_4x4],transcoderFormat:[s.ASTC_4x4,s.ASTC_4x4],engineFormat:[i.RGBA_ASTC_4x4_Format,i.RGBA_ASTC_4x4_Format],priorityETC1S:1/0,priorityUASTC:1,needsPowerOfTwo:!1},{if:"bptcSupported",basisFormat:[r.ETC1S,r.UASTC_4x4],transcoderFormat:[s.BC7_M5,s.BC7_M5],engineFormat:[i.RGBA_BPTC_Format,i.RGBA_BPTC_Format],priorityETC1S:3,priorityUASTC:2,needsPowerOfTwo:!1},{if:"dxtSupported",basisFormat:[r.ETC1S,r.UASTC_4x4],transcoderFormat:[s.BC1,s.BC3],engineFormat:[i.RGB_S3TC_DXT1_Format,i.RGBA_S3TC_DXT5_Format],priorityETC1S:4,priorityUASTC:5,needsPowerOfTwo:!1},{if:"etc2Supported",basisFormat:[r.ETC1S,r.UASTC_4x4],transcoderFormat:[s.ETC1,s.ETC2],engineFormat:[i.RGB_ETC2_Format,i.RGBA_ETC2_EAC_Format],priorityETC1S:1,priorityUASTC:3,needsPowerOfTwo:!1},{if:"etc1Supported",basisFormat:[r.ETC1S,r.UASTC_4x4],transcoderFormat:[s.ETC1],engineFormat:[i.RGB_ETC1_Format],priorityETC1S:2,priorityUASTC:4,needsPowerOfTwo:!1},{if:"pvrtcSupported",basisFormat:[r.ETC1S,r.UASTC_4x4],transcoderFormat:[s.PVRTC1_4_RGB,s.PVRTC1_4_RGBA],engineFormat:[i.RGB_PVRTC_4BPPV1_Format,i.RGBA_PVRTC_4BPPV1_Format],priorityETC1S:5,priorityUASTC:6,needsPowerOfTwo:!0}],h=l.sort(function(g,m){return g.priorityETC1S-m.priorityETC1S}),u=l.sort(function(g,m){return g.priorityUASTC-m.priorityUASTC});function d(g,m,v,y){let b,_;const x=g===r.ETC1S?h:u;for(let S=0;S<x.length;S++){const T=x[S];if(n[T.if]&&T.basisFormat.includes(g)&&!(y&&T.transcoderFormat.length<2)&&!(T.needsPowerOfTwo&&!(f(m)&&f(v))))return b=T.transcoderFormat[y?1:0],_=T.engineFormat[y?1:0],{transcoderFormat:b,engineFormat:_}}return console.warn("THREE.KTX2Loader: No suitable compressed texture format found. Decoding to RGBA32."),b=s.RGBA32,_=i.RGBAFormat,{transcoderFormat:b,engineFormat:_}}function f(g){return g<=2?!0:(g&g-1)===0&&g!==0}function p(g){if(g.length===1)return g[0];let m=0;for(let b=0;b<g.length;b++){const _=g[b];m+=_.byteLength}const v=new Uint8Array(m);let y=0;for(let b=0;b<g.length;b++){const _=g[b];v.set(_,y),y+=_.byteLength}return v}};const t4=new Set([kn,zu,mc]),eb={[DP]:kn,[BP]:kn,[EP]:kn,[IP]:kn,[MP]:zu,[RP]:zu,[CP]:zu,[SP]:zu,[PP]:mc,[TP]:mc,[xP]:mc,[wP]:mc,[OP]:jS,[kP]:jS},tb={[DP]:eo,[BP]:On,[EP]:oi,[IP]:oi,[MP]:eo,[RP]:On,[CP]:oi,[SP]:oi,[PP]:eo,[TP]:On,[xP]:oi,[wP]:oi,[OP]:oi,[kP]:oi};async function i4(n){const{vkFormat:t}=n;if(eb[t]===void 0)throw new Error("THREE.KTX2Loader: Unsupported vkFormat.");let e;n.supercompressionScheme===wE&&($0||($0=new Promise(async r=>{const o=new e4;await o.init(),r(o)})),e=await $0);const i=[];for(let r=0;r<n.levels.length;r++){const o=Math.max(1,n.pixelWidth>>r),a=Math.max(1,n.pixelHeight>>r),l=n.pixelDepth?Math.max(1,n.pixelDepth>>r):0,h=n.levels[r];let u;if(n.supercompressionScheme===WN)u=h.levelData;else if(n.supercompressionScheme===wE)u=e.decode(h.levelData,h.uncompressedByteLength);else throw new Error("THREE.KTX2Loader: Unsupported supercompressionScheme.");let d;tb[t]===eo?d=new Float32Array(u.buffer,u.byteOffset,u.byteLength/Float32Array.BYTES_PER_ELEMENT):tb[t]===On?d=new Uint16Array(u.buffer,u.byteOffset,u.byteLength/Uint16Array.BYTES_PER_ELEMENT):d=u,i.push({data:d,width:o,height:a,depth:l})}let s;if(t4.has(eb[t]))s=n.pixelDepth===0?new zd(i[0].data,n.pixelWidth,n.pixelHeight):new KO(i[0].data,n.pixelWidth,n.pixelHeight,n.pixelDepth);else{if(n.pixelDepth>0)throw new Error("THREE.KTX2Loader: Unsupported pixelDepth.");s=new fd(i,n.pixelWidth,n.pixelHeight)}return s.mipmaps=i,s.type=tb[t],s.format=eb[t],s.colorSpace=LP(n),s.needsUpdate=!0,Promise.resolve(s)}function LP(n){const t=n.dataFormatDescriptor[0];return t.colorPrimaries===YN?t.transferFunction===xE?Ue:Di:t.colorPrimaries===KN?t.transferFunction===xE?JO:ZO:t.colorPrimaries===XN?Fh:(console.warn(`THREE.KTX2Loader: Unsupported color primaries, "${t.colorPrimaries}"`),Fh)}let cv="https://www.gstatic.com/draco/versioned/decoders/1.4.1/",Wx="https://www.gstatic.com/basis-universal/versioned/2021-04-15-ba1c3e4/";fetch(cv+"draco_decoder.js",{method:"head"}).catch(n=>{cv="./include/draco/",Wx="./include/ktx2/"});function n4(n){cv=n}function s4(n){Wx=n}let Kf,z_,Jf;function FP(n){Kf||(Kf=new by,Kf.setDecoderPath(cv),Kf.setDecoderConfig({type:"js"})),Jf||(Jf=new Jr,Jf.setTranscoderPath(Wx)),z_||(z_=_P),n?Jf.detectSupport(n):console.warn("No renderer provided to detect ktx2 support - loading KTX2 textures will probably fail")}function UP(n){n.dracoLoader||n.setDRACOLoader(Kf),n.ktx2Loader||n.setKTX2Loader(Jf),n.meshoptDecoder||n.setMeshoptDecoder(z_)}function r4(n,t=1e-4){t=Math.max(t,Number.EPSILON);const e={},i=n.getIndex(),s=n.getAttribute("position"),r=i?i.count:s.count;let o=0;const a=Object.keys(n.attributes),l={},h={},u=[],d=["getX","getY","getZ","getW"],f=["setX","setY","setZ","setW"];for(let b=0,_=a.length;b<_;b++){const x=a[b],S=n.attributes[x];l[x]=new Ve(new S.array.constructor(S.count*S.itemSize),S.itemSize,S.normalized);const T=n.morphAttributes[x];T&&(h[x]=new Ve(new T.array.constructor(T.count*T.itemSize),T.itemSize,T.normalized))}const p=t*.5,g=Math.log10(1/t),m=Math.pow(10,g),v=p*m;for(let b=0;b<r;b++){const _=i?i.getX(b):b;let x="";for(let S=0,T=a.length;S<T;S++){const L=a[S],I=n.getAttribute(L),P=I.itemSize;for(let R=0;R<P;R++)x+=`${~~(I[d[R]](_)*m+v)},`}if(x in e)u.push(e[x]);else{for(let S=0,T=a.length;S<T;S++){const L=a[S],I=n.getAttribute(L),P=n.morphAttributes[L],R=I.itemSize,B=l[L],Q=h[L];for(let G=0;G<R;G++){const V=d[G],X=f[G];if(B[X](o,I[V](_)),P)for(let k=0,M=P.length;k<M;k++)Q[k][X](o,P[k][V](_))}}e[x]=o,u.push(o),o++}}const y=n.clone();for(const b in n.attributes){const _=l[b];if(y.setAttribute(b,new Ve(_.array.slice(0,o*_.itemSize),_.itemSize,_.normalized)),b in h)for(let x=0;x<h[b].length;x++){const S=h[b][x];y.morphAttributes[b][x]=new Ve(S.array.slice(0,o*S.itemSize),S.itemSize,S.normalized)}}return y.setIndex(u),y}function EE(n,t){if(t===$O)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),n;if(t===b_||t===RR){let e=n.getIndex();if(e===null){const o=[],a=n.getAttribute("position");if(a!==void 0){for(let l=0;l<a.count;l++)o.push(l);n.setIndex(o),e=n.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),n}const i=e.count-2,s=[];if(t===b_)for(let o=1;o<=i;o++)s.push(e.getX(0)),s.push(e.getX(o)),s.push(e.getX(o+1));else for(let o=0;o<i;o++)o%2===0?(s.push(e.getX(o)),s.push(e.getX(o+1)),s.push(e.getX(o+2))):(s.push(e.getX(o+2)),s.push(e.getX(o+1)),s.push(e.getX(o)));s.length/3!==i&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const r=n.clone();return r.setIndex(s),r.clearGroups(),r}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",t),n}class Fc extends Lh{constructor(t){super(t),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(e){return new h4(e)}),this.register(function(e){return new y4(e)}),this.register(function(e){return new b4(e)}),this.register(function(e){return new _4(e)}),this.register(function(e){return new d4(e)}),this.register(function(e){return new f4(e)}),this.register(function(e){return new p4(e)}),this.register(function(e){return new g4(e)}),this.register(function(e){return new c4(e)}),this.register(function(e){return new m4(e)}),this.register(function(e){return new u4(e)}),this.register(function(e){return new v4(e)}),this.register(function(e){return new A4(e)}),this.register(function(e){return new a4(e)}),this.register(function(e){return new w4(e)}),this.register(function(e){return new x4(e)})}load(t,e,i,s){const r=this;let o;if(this.resourcePath!=="")o=this.resourcePath;else if(this.path!==""){const h=pd.extractUrlBase(t);o=pd.resolveURL(h,this.path)}else o=pd.extractUrlBase(t);this.manager.itemStart(t);const a=function(h){s?s(h):console.error(h),r.manager.itemError(t),r.manager.itemEnd(t)},l=new Zr(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setWithCredentials(this.withCredentials),l.load(t,function(h){try{r.parse(h,o,function(u){e(u),r.manager.itemEnd(t)},a)}catch(u){a(u)}},i,a)}setDRACOLoader(t){return this.dracoLoader=t,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(t){return this.ktx2Loader=t,this}setMeshoptDecoder(t){return this.meshoptDecoder=t,this}register(t){return this.pluginCallbacks.indexOf(t)===-1&&this.pluginCallbacks.push(t),this}unregister(t){return this.pluginCallbacks.indexOf(t)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(t),1),this}parse(t,e,i,s){let r;const o={},a={},l=new TextDecoder;if(typeof t=="string")r=JSON.parse(t);else if(t instanceof ArrayBuffer)if(l.decode(new Uint8Array(t,0,4))===NP){try{o[lt.KHR_BINARY_GLTF]=new C4(t)}catch(d){s&&s(d);return}r=JSON.parse(o[lt.KHR_BINARY_GLTF].content)}else r=JSON.parse(l.decode(t));else r=t;if(r.asset===void 0||r.asset.version[0]<2){s&&s(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const h=new F4(r,{path:e||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});h.fileLoader.setRequestHeader(this.requestHeader);for(let u=0;u<this.pluginCallbacks.length;u++){const d=this.pluginCallbacks[u](h);d.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),a[d.name]=d,o[d.name]=!0}if(r.extensionsUsed)for(let u=0;u<r.extensionsUsed.length;++u){const d=r.extensionsUsed[u],f=r.extensionsRequired||[];switch(d){case lt.KHR_MATERIALS_UNLIT:o[d]=new l4;break;case lt.KHR_DRACO_MESH_COMPRESSION:o[d]=new S4(r,this.dracoLoader);break;case lt.KHR_TEXTURE_TRANSFORM:o[d]=new E4;break;case lt.KHR_MESH_QUANTIZATION:o[d]=new I4;break;default:f.indexOf(d)>=0&&a[d]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+d+'".')}}h.setExtensions(o),h.setPlugins(a),h.parse(i,s)}parseAsync(t,e){const i=this;return new Promise(function(s,r){i.parse(t,e,s,r)})}}function o4(){let n={};return{get:function(t){return n[t]},add:function(t,e){n[t]=e},remove:function(t){delete n[t]},removeAll:function(){n={}}}}const lt={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class a4{constructor(t){this.parser=t,this.name=lt.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const t=this.parser,e=this.parser.json.nodes||[];for(let i=0,s=e.length;i<s;i++){const r=e[i];r.extensions&&r.extensions[this.name]&&r.extensions[this.name].light!==void 0&&t._addNodeRef(this.cache,r.extensions[this.name].light)}}_loadLight(t){const e=this.parser,i="light:"+t;let s=e.cache.get(i);if(s)return s;const r=e.json,l=((r.extensions&&r.extensions[this.name]||{}).lights||[])[t];let h;const u=new we(16777215);l.color!==void 0&&u.setRGB(l.color[0],l.color[1],l.color[2],Di);const d=l.range!==void 0?l.range:0;switch(l.type){case"directional":h=new eg(u),h.target.position.set(0,0,-1),h.add(h.target);break;case"point":h=new $p(u),h.distance=d;break;case"spot":h=new hx(u),h.distance=d,l.spot=l.spot||{},l.spot.innerConeAngle=l.spot.innerConeAngle!==void 0?l.spot.innerConeAngle:0,l.spot.outerConeAngle=l.spot.outerConeAngle!==void 0?l.spot.outerConeAngle:Math.PI/4,h.angle=l.spot.outerConeAngle,h.penumbra=1-l.spot.innerConeAngle/l.spot.outerConeAngle,h.target.position.set(0,0,-1),h.add(h.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+l.type)}return h.position.set(0,0,0),h.decay=2,nc(h,l),l.intensity!==void 0&&(h.intensity=l.intensity),h.name=e.createUniqueName(l.name||"light_"+t),s=Promise.resolve(h),e.cache.add(i,s),s}getDependency(t,e){if(t==="light")return this._loadLight(e)}createNodeAttachment(t){const e=this,i=this.parser,r=i.json.nodes[t],a=(r.extensions&&r.extensions[this.name]||{}).light;return a===void 0?null:this._loadLight(a).then(function(l){return i._getNodeRef(e.cache,a,l)})}}let l4=class{constructor(){this.name=lt.KHR_MATERIALS_UNLIT}getMaterialType(){return St}extendParams(t,e,i){const s=[];t.color=new we(1,1,1),t.opacity=1;const r=e.pbrMetallicRoughness;if(r){if(Array.isArray(r.baseColorFactor)){const o=r.baseColorFactor;t.color.setRGB(o[0],o[1],o[2],Di),t.opacity=o[3]}r.baseColorTexture!==void 0&&s.push(i.assignTexture(t,"map",r.baseColorTexture,Ue))}return Promise.all(s)}},c4=class{constructor(t){this.parser=t,this.name=lt.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(t,e){const s=this.parser.json.materials[t];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=s.extensions[this.name].emissiveStrength;return r!==void 0&&(e.emissiveIntensity=r),Promise.resolve()}},h4=class{constructor(t){this.parser=t,this.name=lt.KHR_MATERIALS_CLEARCOAT}getMaterialType(t){const i=this.parser.json.materials[t];return!i.extensions||!i.extensions[this.name]?null:io}extendMaterialParams(t,e){const i=this.parser,s=i.json.materials[t];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],o=s.extensions[this.name];if(o.clearcoatFactor!==void 0&&(e.clearcoat=o.clearcoatFactor),o.clearcoatTexture!==void 0&&r.push(i.assignTexture(e,"clearcoatMap",o.clearcoatTexture)),o.clearcoatRoughnessFactor!==void 0&&(e.clearcoatRoughness=o.clearcoatRoughnessFactor),o.clearcoatRoughnessTexture!==void 0&&r.push(i.assignTexture(e,"clearcoatRoughnessMap",o.clearcoatRoughnessTexture)),o.clearcoatNormalTexture!==void 0&&(r.push(i.assignTexture(e,"clearcoatNormalMap",o.clearcoatNormalTexture)),o.clearcoatNormalTexture.scale!==void 0)){const a=o.clearcoatNormalTexture.scale;e.clearcoatNormalScale=new ae(a,a)}return Promise.all(r)}},u4=class{constructor(t){this.parser=t,this.name=lt.KHR_MATERIALS_IRIDESCENCE}getMaterialType(t){const i=this.parser.json.materials[t];return!i.extensions||!i.extensions[this.name]?null:io}extendMaterialParams(t,e){const i=this.parser,s=i.json.materials[t];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],o=s.extensions[this.name];return o.iridescenceFactor!==void 0&&(e.iridescence=o.iridescenceFactor),o.iridescenceTexture!==void 0&&r.push(i.assignTexture(e,"iridescenceMap",o.iridescenceTexture)),o.iridescenceIor!==void 0&&(e.iridescenceIOR=o.iridescenceIor),e.iridescenceThicknessRange===void 0&&(e.iridescenceThicknessRange=[100,400]),o.iridescenceThicknessMinimum!==void 0&&(e.iridescenceThicknessRange[0]=o.iridescenceThicknessMinimum),o.iridescenceThicknessMaximum!==void 0&&(e.iridescenceThicknessRange[1]=o.iridescenceThicknessMaximum),o.iridescenceThicknessTexture!==void 0&&r.push(i.assignTexture(e,"iridescenceThicknessMap",o.iridescenceThicknessTexture)),Promise.all(r)}},d4=class{constructor(t){this.parser=t,this.name=lt.KHR_MATERIALS_SHEEN}getMaterialType(t){const i=this.parser.json.materials[t];return!i.extensions||!i.extensions[this.name]?null:io}extendMaterialParams(t,e){const i=this.parser,s=i.json.materials[t];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[];e.sheenColor=new we(0,0,0),e.sheenRoughness=0,e.sheen=1;const o=s.extensions[this.name];if(o.sheenColorFactor!==void 0){const a=o.sheenColorFactor;e.sheenColor.setRGB(a[0],a[1],a[2],Di)}return o.sheenRoughnessFactor!==void 0&&(e.sheenRoughness=o.sheenRoughnessFactor),o.sheenColorTexture!==void 0&&r.push(i.assignTexture(e,"sheenColorMap",o.sheenColorTexture,Ue)),o.sheenRoughnessTexture!==void 0&&r.push(i.assignTexture(e,"sheenRoughnessMap",o.sheenRoughnessTexture)),Promise.all(r)}},f4=class{constructor(t){this.parser=t,this.name=lt.KHR_MATERIALS_TRANSMISSION}getMaterialType(t){const i=this.parser.json.materials[t];return!i.extensions||!i.extensions[this.name]?null:io}extendMaterialParams(t,e){const i=this.parser,s=i.json.materials[t];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],o=s.extensions[this.name];return o.transmissionFactor!==void 0&&(e.transmission=o.transmissionFactor),o.transmissionTexture!==void 0&&r.push(i.assignTexture(e,"transmissionMap",o.transmissionTexture)),Promise.all(r)}},p4=class{constructor(t){this.parser=t,this.name=lt.KHR_MATERIALS_VOLUME}getMaterialType(t){const i=this.parser.json.materials[t];return!i.extensions||!i.extensions[this.name]?null:io}extendMaterialParams(t,e){const i=this.parser,s=i.json.materials[t];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],o=s.extensions[this.name];e.thickness=o.thicknessFactor!==void 0?o.thicknessFactor:0,o.thicknessTexture!==void 0&&r.push(i.assignTexture(e,"thicknessMap",o.thicknessTexture)),e.attenuationDistance=o.attenuationDistance||1/0;const a=o.attenuationColor||[1,1,1];return e.attenuationColor=new we().setRGB(a[0],a[1],a[2],Di),Promise.all(r)}},g4=class{constructor(t){this.parser=t,this.name=lt.KHR_MATERIALS_IOR}getMaterialType(t){const i=this.parser.json.materials[t];return!i.extensions||!i.extensions[this.name]?null:io}extendMaterialParams(t,e){const s=this.parser.json.materials[t];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=s.extensions[this.name];return e.ior=r.ior!==void 0?r.ior:1.5,Promise.resolve()}},m4=class{constructor(t){this.parser=t,this.name=lt.KHR_MATERIALS_SPECULAR}getMaterialType(t){const i=this.parser.json.materials[t];return!i.extensions||!i.extensions[this.name]?null:io}extendMaterialParams(t,e){const i=this.parser,s=i.json.materials[t];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],o=s.extensions[this.name];e.specularIntensity=o.specularFactor!==void 0?o.specularFactor:1,o.specularTexture!==void 0&&r.push(i.assignTexture(e,"specularIntensityMap",o.specularTexture));const a=o.specularColorFactor||[1,1,1];return e.specularColor=new we().setRGB(a[0],a[1],a[2],Di),o.specularColorTexture!==void 0&&r.push(i.assignTexture(e,"specularColorMap",o.specularColorTexture,Ue)),Promise.all(r)}},A4=class{constructor(t){this.parser=t,this.name=lt.EXT_MATERIALS_BUMP}getMaterialType(t){const i=this.parser.json.materials[t];return!i.extensions||!i.extensions[this.name]?null:io}extendMaterialParams(t,e){const i=this.parser,s=i.json.materials[t];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],o=s.extensions[this.name];return e.bumpScale=o.bumpFactor!==void 0?o.bumpFactor:1,o.bumpTexture!==void 0&&r.push(i.assignTexture(e,"bumpMap",o.bumpTexture)),Promise.all(r)}},v4=class{constructor(t){this.parser=t,this.name=lt.KHR_MATERIALS_ANISOTROPY}getMaterialType(t){const i=this.parser.json.materials[t];return!i.extensions||!i.extensions[this.name]?null:io}extendMaterialParams(t,e){const i=this.parser,s=i.json.materials[t];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],o=s.extensions[this.name];return o.anisotropyStrength!==void 0&&(e.anisotropy=o.anisotropyStrength),o.anisotropyRotation!==void 0&&(e.anisotropyRotation=o.anisotropyRotation),o.anisotropyTexture!==void 0&&r.push(i.assignTexture(e,"anisotropyMap",o.anisotropyTexture)),Promise.all(r)}};class y4{constructor(t){this.parser=t,this.name=lt.KHR_TEXTURE_BASISU}loadTexture(t){const e=this.parser,i=e.json,s=i.textures[t];if(!s.extensions||!s.extensions[this.name])return null;const r=s.extensions[this.name],o=e.options.ktx2Loader;if(!o){if(i.extensionsRequired&&i.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return e.loadTextureImage(t,r.source,o)}}class b4{constructor(t){this.parser=t,this.name=lt.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(t){const e=this.name,i=this.parser,s=i.json,r=s.textures[t];if(!r.extensions||!r.extensions[e])return null;const o=r.extensions[e],a=s.images[o.source];let l=i.textureLoader;if(a.uri){const h=i.options.manager.getHandler(a.uri);h!==null&&(l=h)}return this.detectSupport().then(function(h){if(h)return i.loadTextureImage(t,o.source,l);if(s.extensionsRequired&&s.extensionsRequired.indexOf(e)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return i.loadTexture(t)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(t){const e=new Image;e.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",e.onload=e.onerror=function(){t(e.height===1)}})),this.isSupported}}class _4{constructor(t){this.parser=t,this.name=lt.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(t){const e=this.name,i=this.parser,s=i.json,r=s.textures[t];if(!r.extensions||!r.extensions[e])return null;const o=r.extensions[e],a=s.images[o.source];let l=i.textureLoader;if(a.uri){const h=i.options.manager.getHandler(a.uri);h!==null&&(l=h)}return this.detectSupport().then(function(h){if(h)return i.loadTextureImage(t,o.source,l);if(s.extensionsRequired&&s.extensionsRequired.indexOf(e)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return i.loadTexture(t)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(t){const e=new Image;e.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",e.onload=e.onerror=function(){t(e.height===1)}})),this.isSupported}}class w4{constructor(t){this.name=lt.EXT_MESHOPT_COMPRESSION,this.parser=t}loadBufferView(t){const e=this.parser.json,i=e.bufferViews[t];if(i.extensions&&i.extensions[this.name]){const s=i.extensions[this.name],r=this.parser.getDependency("buffer",s.buffer),o=this.parser.options.meshoptDecoder;if(!o||!o.supported){if(e.extensionsRequired&&e.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return r.then(function(a){const l=s.byteOffset||0,h=s.byteLength||0,u=s.count,d=s.byteStride,f=new Uint8Array(a,l,h);return o.decodeGltfBufferAsync?o.decodeGltfBufferAsync(u,d,f,s.mode,s.filter).then(function(p){return p.buffer}):o.ready.then(function(){const p=new ArrayBuffer(u*d);return o.decodeGltfBuffer(new Uint8Array(p),u,d,f,s.mode,s.filter),p})})}else return null}}let x4=class{constructor(t){this.name=lt.EXT_MESH_GPU_INSTANCING,this.parser=t}createNodeMesh(t){const e=this.parser.json,i=e.nodes[t];if(!i.extensions||!i.extensions[this.name]||i.mesh===void 0)return null;const s=e.meshes[i.mesh];for(const h of s.primitives)if(h.mode!==Nr.TRIANGLES&&h.mode!==Nr.TRIANGLE_STRIP&&h.mode!==Nr.TRIANGLE_FAN&&h.mode!==void 0)return null;const o=i.extensions[this.name].attributes,a=[],l={};for(const h in o)a.push(this.parser.getDependency("accessor",o[h]).then(u=>(l[h]=u,l[h])));return a.length<1?null:(a.push(this.parser.createNodeMesh(t)),Promise.all(a).then(h=>{const u=h.pop(),d=u.isGroup?u.children:[u],f=h[0].count,p=[];for(const g of d){const m=new ce,v=new C,y=new ne,b=new C(1,1,1),_=new e2(g.geometry,g.material,f);for(let x=0;x<f;x++)l.TRANSLATION&&v.fromBufferAttribute(l.TRANSLATION,x),l.ROTATION&&y.fromBufferAttribute(l.ROTATION,x),l.SCALE&&b.fromBufferAttribute(l.SCALE,x),_.setMatrixAt(x,m.compose(v,y,b));for(const x in l)if(x==="_COLOR_0"){const S=l[x];_.instanceColor=new ec(S.array,S.itemSize,S.normalized)}else x!=="TRANSLATION"&&x!=="ROTATION"&&x!=="SCALE"&&g.geometry.setAttribute(x,l[x]);re.prototype.copy.call(_,g),this.parser.assignFinalMaterial(_),p.push(_)}return u.isGroup?(u.clear(),u.add(...p),u):p[0]}))}};const NP="glTF",Sf=12,IE={JSON:1313821514,BIN:5130562};class C4{constructor(t){this.name=lt.KHR_BINARY_GLTF,this.content=null,this.body=null;const e=new DataView(t,0,Sf),i=new TextDecoder;if(this.header={magic:i.decode(new Uint8Array(t.slice(0,4))),version:e.getUint32(4,!0),length:e.getUint32(8,!0)},this.header.magic!==NP)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const s=this.header.length-Sf,r=new DataView(t,Sf);let o=0;for(;o<s;){const a=r.getUint32(o,!0);o+=4;const l=r.getUint32(o,!0);if(o+=4,l===IE.JSON){const h=new Uint8Array(t,Sf+o,a);this.content=i.decode(h)}else if(l===IE.BIN){const h=Sf+o;this.body=t.slice(h,h+a)}o+=a}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class S4{constructor(t,e){if(!e)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=lt.KHR_DRACO_MESH_COMPRESSION,this.json=t,this.dracoLoader=e,this.dracoLoader.preload()}decodePrimitive(t,e){const i=this.json,s=this.dracoLoader,r=t.extensions[this.name].bufferView,o=t.extensions[this.name].attributes,a={},l={},h={};for(const u in o){const d=j_[u]||u.toLowerCase();a[d]=o[u]}for(const u in t.attributes){const d=j_[u]||u.toLowerCase();if(o[u]!==void 0){const f=i.accessors[t.attributes[u]],p=Ad[f.componentType];h[d]=p.name,l[d]=f.normalized===!0}}return e.getDependency("bufferView",r).then(function(u){return new Promise(function(d,f){s.decodeDracoFile(u,function(p){for(const g in p.attributes){const m=p.attributes[g],v=l[g];v!==void 0&&(m.normalized=v)}d(p)},a,h,Di,f)})})}}class E4{constructor(){this.name=lt.KHR_TEXTURE_TRANSFORM}extendTexture(t,e){return(e.texCoord===void 0||e.texCoord===t.channel)&&e.offset===void 0&&e.rotation===void 0&&e.scale===void 0||(t=t.clone(),e.texCoord!==void 0&&(t.channel=e.texCoord),e.offset!==void 0&&t.offset.fromArray(e.offset),e.rotation!==void 0&&(t.rotation=e.rotation),e.scale!==void 0&&t.repeat.fromArray(e.scale),t.needsUpdate=!0),t}}class I4{constructor(){this.name=lt.KHR_MESH_QUANTIZATION}}class QP extends s2{constructor(t,e,i,s){super(t,e,i,s)}copySampleValue_(t){const e=this.resultBuffer,i=this.sampleValues,s=this.valueSize,r=t*s*3+s;for(let o=0;o!==s;o++)e[o]=i[r+o];return e}interpolate_(t,e,i,s){const r=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=a*2,h=a*3,u=s-e,d=(i-e)/u,f=d*d,p=f*d,g=t*h,m=g-h,v=-2*p+3*f,y=p-f,b=1-v,_=y-f+d;for(let x=0;x!==a;x++){const S=o[m+x+a],T=o[m+x+l]*u,L=o[g+x+a],I=o[g+x]*u;r[x]=b*S+_*T+v*L+y*I}return r}}const T4=new ne;class R4 extends QP{interpolate_(t,e,i,s){const r=super.interpolate_(t,e,i,s);return T4.fromArray(r).normalize().toArray(r),r}}const Nr={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},Ad={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},TE={9728:Wt,9729:Tt,9984:BR,9985:PR,9986:MR,9987:Bg},RE={33071:ZA,33648:DR,10497:Sl},ib={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},j_={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},jl={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},B4={CUBICSPLINE:void 0,LINEAR:dx,STEP:kR},nb={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function P4(n){return n.DefaultMaterial===void 0&&(n.DefaultMaterial=new mr({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:Oa})),n.DefaultMaterial}function Yc(n,t,e){for(const i in e.extensions)n[i]===void 0&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[i]=e.extensions[i])}function nc(n,t){t.extras!==void 0&&(typeof t.extras=="object"?Object.assign(n.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function M4(n,t,e){let i=!1,s=!1,r=!1;for(let h=0,u=t.length;h<u;h++){const d=t[h];if(d.POSITION!==void 0&&(i=!0),d.NORMAL!==void 0&&(s=!0),d.COLOR_0!==void 0&&(r=!0),i&&s&&r)break}if(!i&&!s&&!r)return Promise.resolve(n);const o=[],a=[],l=[];for(let h=0,u=t.length;h<u;h++){const d=t[h];if(i){const f=d.POSITION!==void 0?e.getDependency("accessor",d.POSITION):n.attributes.position;o.push(f)}if(s){const f=d.NORMAL!==void 0?e.getDependency("accessor",d.NORMAL):n.attributes.normal;a.push(f)}if(r){const f=d.COLOR_0!==void 0?e.getDependency("accessor",d.COLOR_0):n.attributes.color;l.push(f)}}return Promise.all([Promise.all(o),Promise.all(a),Promise.all(l)]).then(function(h){const u=h[0],d=h[1],f=h[2];return i&&(n.morphAttributes.position=u),s&&(n.morphAttributes.normal=d),r&&(n.morphAttributes.color=f),n.morphTargetsRelative=!0,n})}function D4(n,t){if(n.updateMorphTargets(),t.weights!==void 0)for(let e=0,i=t.weights.length;e<i;e++)n.morphTargetInfluences[e]=t.weights[e];if(t.extras&&Array.isArray(t.extras.targetNames)){const e=t.extras.targetNames;if(n.morphTargetInfluences.length===e.length){n.morphTargetDictionary={};for(let i=0,s=e.length;i<s;i++)n.morphTargetDictionary[e[i]]=i}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function k4(n){let t;const e=n.extensions&&n.extensions[lt.KHR_DRACO_MESH_COMPRESSION];if(e?t="draco:"+e.bufferView+":"+e.indices+":"+sb(e.attributes):t=n.indices+":"+sb(n.attributes)+":"+n.mode,n.targets!==void 0)for(let i=0,s=n.targets.length;i<s;i++)t+=":"+sb(n.targets[i]);return t}function sb(n){let t="";const e=Object.keys(n).sort();for(let i=0,s=e.length;i<s;i++)t+=e[i]+":"+n[e[i]]+";";return t}function G_(n){switch(n){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function O4(n){return n.search(/\.jpe?g($|\?)/i)>0||n.search(/^data\:image\/jpeg/)===0?"image/jpeg":n.search(/\.webp($|\?)/i)>0||n.search(/^data\:image\/webp/)===0?"image/webp":"image/png"}const L4=new ce;class F4{constructor(t={},e={}){this.json=t,this.extensions={},this.plugins={},this.options=e,this.cache=new o4,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let i=!1,s=!1,r=-1;typeof navigator<"u"&&(i=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!0,s=navigator.userAgent.indexOf("Firefox")>-1,r=s?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),typeof createImageBitmap>"u"||i||s&&r<98?this.textureLoader=new Ra(this.options.manager):this.textureLoader=new t2(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new Zr(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(t){this.extensions=t}setPlugins(t){this.plugins=t}parse(t,e){const i=this,s=this.json,r=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(o){return o._markDefs&&o._markDefs()}),Promise.all(this._invokeAll(function(o){return o.beforeRoot&&o.beforeRoot()})).then(function(){return Promise.all([i.getDependencies("scene"),i.getDependencies("animation"),i.getDependencies("camera")])}).then(function(o){const a={scene:o[0][s.scene||0],scenes:o[0],animations:o[1],cameras:o[2],asset:s.asset,parser:i,userData:{}};return Yc(r,a,s),nc(a,s),Promise.all(i._invokeAll(function(l){return l.afterRoot&&l.afterRoot(a)})).then(function(){t(a)})}).catch(e)}_markDefs(){const t=this.json.nodes||[],e=this.json.skins||[],i=this.json.meshes||[];for(let s=0,r=e.length;s<r;s++){const o=e[s].joints;for(let a=0,l=o.length;a<l;a++)t[o[a]].isBone=!0}for(let s=0,r=t.length;s<r;s++){const o=t[s];o.mesh!==void 0&&(this._addNodeRef(this.meshCache,o.mesh),o.skin!==void 0&&(i[o.mesh].isSkinnedMesh=!0)),o.camera!==void 0&&this._addNodeRef(this.cameraCache,o.camera)}}_addNodeRef(t,e){e!==void 0&&(t.refs[e]===void 0&&(t.refs[e]=t.uses[e]=0),t.refs[e]++)}_getNodeRef(t,e,i){if(t.refs[e]<=1)return i;const s=i.clone(),r=(o,a)=>{const l=this.associations.get(o);l!=null&&this.associations.set(a,l);for(const[h,u]of o.children.entries())r(u,a.children[h])};return r(i,s),s.name+="_instance_"+t.uses[e]++,s}_invokeOne(t){const e=Object.values(this.plugins);e.push(this);for(let i=0;i<e.length;i++){const s=t(e[i]);if(s)return s}return null}_invokeAll(t){const e=Object.values(this.plugins);e.unshift(this);const i=[];for(let s=0;s<e.length;s++){const r=t(e[s]);r&&i.push(r)}return i}getDependency(t,e){const i=t+":"+e;let s=this.cache.get(i);if(!s){switch(t){case"scene":s=this.loadScene(e);break;case"node":s=this._invokeOne(function(r){return r.loadNode&&r.loadNode(e)});break;case"mesh":s=this._invokeOne(function(r){return r.loadMesh&&r.loadMesh(e)});break;case"accessor":s=this.loadAccessor(e);break;case"bufferView":s=this._invokeOne(function(r){return r.loadBufferView&&r.loadBufferView(e)});break;case"buffer":s=this.loadBuffer(e);break;case"material":s=this._invokeOne(function(r){return r.loadMaterial&&r.loadMaterial(e)});break;case"texture":s=this._invokeOne(function(r){return r.loadTexture&&r.loadTexture(e)});break;case"skin":s=this.loadSkin(e);break;case"animation":s=this._invokeOne(function(r){return r.loadAnimation&&r.loadAnimation(e)});break;case"camera":s=this.loadCamera(e);break;default:if(s=this._invokeOne(function(r){return r!=this&&r.getDependency&&r.getDependency(t,e)}),!s)throw new Error("Unknown type: "+t);break}this.cache.add(i,s)}return s}getDependencies(t){let e=this.cache.get(t);if(!e){const i=this,s=this.json[t+(t==="mesh"?"es":"s")]||[];e=Promise.all(s.map(function(r,o){return i.getDependency(t,o)})),this.cache.add(t,e)}return e}loadBuffer(t){const e=this.json.buffers[t],i=this.fileLoader;if(e.type&&e.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+e.type+" buffer type is not supported.");if(e.uri===void 0&&t===0)return Promise.resolve(this.extensions[lt.KHR_BINARY_GLTF].body);const s=this.options;return new Promise(function(r,o){i.load(pd.resolveURL(e.uri,s.path),r,void 0,function(){o(new Error('THREE.GLTFLoader: Failed to load buffer "'+e.uri+'".'))})})}loadBufferView(t){const e=this.json.bufferViews[t];return this.getDependency("buffer",e.buffer).then(function(i){const s=e.byteLength||0,r=e.byteOffset||0;return i.slice(r,r+s)})}loadAccessor(t){const e=this,i=this.json,s=this.json.accessors[t];if(s.bufferView===void 0&&s.sparse===void 0){const o=ib[s.type],a=Ad[s.componentType],l=s.normalized===!0,h=new a(s.count*o);return Promise.resolve(new Ve(h,o,l))}const r=[];return s.bufferView!==void 0?r.push(this.getDependency("bufferView",s.bufferView)):r.push(null),s.sparse!==void 0&&(r.push(this.getDependency("bufferView",s.sparse.indices.bufferView)),r.push(this.getDependency("bufferView",s.sparse.values.bufferView))),Promise.all(r).then(function(o){const a=o[0],l=ib[s.type],h=Ad[s.componentType],u=h.BYTES_PER_ELEMENT,d=u*l,f=s.byteOffset||0,p=s.bufferView!==void 0?i.bufferViews[s.bufferView].byteStride:void 0,g=s.normalized===!0;let m,v;if(p&&p!==d){const y=Math.floor(f/p),b="InterleavedBuffer:"+s.bufferView+":"+s.componentType+":"+y+":"+s.count;let _=e.cache.get(b);_||(m=new h(a,y*p,s.count*p/u),_=new i2(m,p/u),e.cache.add(b,_)),v=new Ac(_,l,f%p/u,g)}else a===null?m=new h(s.count*l):m=new h(a,f,s.count*l),v=new Ve(m,l,g);if(s.sparse!==void 0){const y=ib.SCALAR,b=Ad[s.sparse.indices.componentType],_=s.sparse.indices.byteOffset||0,x=s.sparse.values.byteOffset||0,S=new b(o[1],_,s.sparse.count*y),T=new h(o[2],x,s.sparse.count*l);a!==null&&(v=new Ve(v.array.slice(),v.itemSize,v.normalized));for(let L=0,I=S.length;L<I;L++){const P=S[L];if(v.setX(P,T[L*l]),l>=2&&v.setY(P,T[L*l+1]),l>=3&&v.setZ(P,T[L*l+2]),l>=4&&v.setW(P,T[L*l+3]),l>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return v})}loadTexture(t){const e=this.json,i=this.options,r=e.textures[t].source,o=e.images[r];let a=this.textureLoader;if(o.uri){const l=i.manager.getHandler(o.uri);l!==null&&(a=l)}return this.loadTextureImage(t,r,a)}loadTextureImage(t,e,i){const s=this,r=this.json,o=r.textures[t],a=r.images[e],l=(a.uri||a.bufferView)+":"+o.sampler;if(this.textureCache[l])return this.textureCache[l];const h=this.loadImageSource(e,i).then(function(u){u.flipY=!1,u.name=o.name||a.name||"",u.name===""&&typeof a.uri=="string"&&a.uri.startsWith("data:image/")===!1&&(u.name=a.uri);const f=(r.samplers||{})[o.sampler]||{};return u.magFilter=TE[f.magFilter]||Tt,u.minFilter=TE[f.minFilter]||Bg,u.wrapS=RE[f.wrapS]||Sl,u.wrapT=RE[f.wrapT]||Sl,u.anisotropy=4,s.associations.set(u,{textures:t}),u}).catch(function(){return null});return this.textureCache[l]=h,h}loadImageSource(t,e){const i=this,s=this.json,r=this.options;if(this.sourceCache[t]!==void 0)return this.sourceCache[t].then(d=>d.clone());const o=s.images[t],a=self.URL||self.webkitURL;let l=o.uri||"",h=!1;if(o.bufferView!==void 0)l=i.getDependency("bufferView",o.bufferView).then(function(d){h=!0;const f=new Blob([d],{type:o.mimeType});return l=a.createObjectURL(f),l});else if(o.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+t+" is missing URI and bufferView");const u=Promise.resolve(l).then(function(d){return new Promise(function(f,p){let g=f;e.isImageBitmapLoader===!0&&(g=function(m){const v=new pt(m);v.needsUpdate=!0,f(v)}),e.load(pd.resolveURL(d,r.path),g,void 0,p)})}).then(function(d){return h===!0&&a.revokeObjectURL(l),d.userData.mimeType=o.mimeType||O4(o.uri),d}).catch(function(d){throw console.error("THREE.GLTFLoader: Couldn't load texture",l),d});return this.sourceCache[t]=u,u}assignTexture(t,e,i,s){const r=this;return this.getDependency("texture",i.index).then(function(o){if(!o)return null;if(i.texCoord!==void 0&&i.texCoord>0&&(o=o.clone(),o.channel=i.texCoord),r.extensions[lt.KHR_TEXTURE_TRANSFORM]){const a=i.extensions!==void 0?i.extensions[lt.KHR_TEXTURE_TRANSFORM]:void 0;if(a){const l=r.associations.get(o);o=r.extensions[lt.KHR_TEXTURE_TRANSFORM].extendTexture(o,a),r.associations.set(o,l)}}return s!==void 0&&(o.colorSpace=s),t[e]=o,o})}assignFinalMaterial(t){const e=t.geometry;let i=t.material;const s=e.attributes.tangent===void 0,r=e.attributes.color!==void 0,o=e.attributes.normal===void 0;if(t.isPoints){const a="PointsMaterial:"+i.uuid;let l=this.cache.get(a);l||(l=new qf,ft.prototype.copy.call(l,i),l.color.copy(i.color),l.map=i.map,l.sizeAttenuation=!1,this.cache.add(a,l)),i=l}else if(t.isLine){const a="LineBasicMaterial:"+i.uuid;let l=this.cache.get(a);l||(l=new Ba,ft.prototype.copy.call(l,i),l.color.copy(i.color),l.map=i.map,this.cache.add(a,l)),i=l}if(s||r||o){let a="ClonedMaterial:"+i.uuid+":";s&&(a+="derivative-tangents:"),r&&(a+="vertex-colors:"),o&&(a+="flat-shading:");let l=this.cache.get(a);l||(l=i.clone(),r&&(l.vertexColors=!0),o&&(l.flatShading=!0),s&&(l.normalScale&&(l.normalScale.y*=-1),l.clearcoatNormalScale&&(l.clearcoatNormalScale.y*=-1)),this.cache.add(a,l),this.associations.set(l,this.associations.get(i))),i=l}t.material=i}getMaterialType(){return mr}loadMaterial(t){const e=this,i=this.json,s=this.extensions,r=i.materials[t];let o;const a={},l=r.extensions||{},h=[];if(l[lt.KHR_MATERIALS_UNLIT]){const d=s[lt.KHR_MATERIALS_UNLIT];o=d.getMaterialType(),h.push(d.extendParams(a,r,e))}else{const d=r.pbrMetallicRoughness||{};if(a.color=new we(1,1,1),a.opacity=1,Array.isArray(d.baseColorFactor)){const f=d.baseColorFactor;a.color.setRGB(f[0],f[1],f[2],Di),a.opacity=f[3]}d.baseColorTexture!==void 0&&h.push(e.assignTexture(a,"map",d.baseColorTexture,Ue)),a.metalness=d.metallicFactor!==void 0?d.metallicFactor:1,a.roughness=d.roughnessFactor!==void 0?d.roughnessFactor:1,d.metallicRoughnessTexture!==void 0&&(h.push(e.assignTexture(a,"metalnessMap",d.metallicRoughnessTexture)),h.push(e.assignTexture(a,"roughnessMap",d.metallicRoughnessTexture))),o=this._invokeOne(function(f){return f.getMaterialType&&f.getMaterialType(t)}),h.push(Promise.all(this._invokeAll(function(f){return f.extendMaterialParams&&f.extendMaterialParams(t,a)})))}r.doubleSided===!0&&(a.side=pi);const u=r.alphaMode||nb.OPAQUE;if(u===nb.BLEND?(a.transparent=!0,a.depthWrite=!1):(a.transparent=!1,u===nb.MASK&&(a.alphaTest=r.alphaCutoff!==void 0?r.alphaCutoff:.5)),r.normalTexture!==void 0&&o!==St&&(h.push(e.assignTexture(a,"normalMap",r.normalTexture)),a.normalScale=new ae(1,1),r.normalTexture.scale!==void 0)){const d=r.normalTexture.scale;a.normalScale.set(d,d)}if(r.occlusionTexture!==void 0&&o!==St&&(h.push(e.assignTexture(a,"aoMap",r.occlusionTexture)),r.occlusionTexture.strength!==void 0&&(a.aoMapIntensity=r.occlusionTexture.strength)),r.emissiveFactor!==void 0&&o!==St){const d=r.emissiveFactor;a.emissive=new we().setRGB(d[0],d[1],d[2],Di)}return r.emissiveTexture!==void 0&&o!==St&&h.push(e.assignTexture(a,"emissiveMap",r.emissiveTexture,Ue)),Promise.all(h).then(function(){const d=new o(a);return r.name&&(d.name=r.name),nc(d,r),e.associations.set(d,{materials:t}),r.extensions&&Yc(s,d,r),d})}createUniqueName(t){const e=vr.sanitizeNodeName(t||"");return e in this.nodeNamesUsed?e+"_"+ ++this.nodeNamesUsed[e]:(this.nodeNamesUsed[e]=0,e)}loadGeometries(t){const e=this,i=this.extensions,s=this.primitiveCache;function r(a){return i[lt.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(a,e).then(function(l){return BE(l,a,e)})}const o=[];for(let a=0,l=t.length;a<l;a++){const h=t[a],u=k4(h),d=s[u];if(d)o.push(d.promise);else{let f;h.extensions&&h.extensions[lt.KHR_DRACO_MESH_COMPRESSION]?f=r(h):f=BE(new jt,h,e),s[u]={primitive:h,promise:f},o.push(f)}}return Promise.all(o)}loadMesh(t){const e=this,i=this.json,s=this.extensions,r=i.meshes[t],o=r.primitives,a=[];for(let l=0,h=o.length;l<h;l++){const u=o[l].material===void 0?P4(this.cache):this.getDependency("material",o[l].material);a.push(u)}return a.push(e.loadGeometries(o)),Promise.all(a).then(function(l){const h=l.slice(0,l.length-1),u=l[l.length-1],d=[];for(let p=0,g=u.length;p<g;p++){const m=u[p],v=o[p];let y;const b=h[p];if(v.mode===Nr.TRIANGLES||v.mode===Nr.TRIANGLE_STRIP||v.mode===Nr.TRIANGLE_FAN||v.mode===void 0)y=r.isSkinnedMesh===!0?new Io(m,b):new J(m,b),y.isSkinnedMesh===!0&&y.normalizeSkinWeights(),v.mode===Nr.TRIANGLE_STRIP?y.geometry=EE(y.geometry,RR):v.mode===Nr.TRIANGLE_FAN&&(y.geometry=EE(y.geometry,b_));else if(v.mode===Nr.LINES)y=new tg(m,b);else if(v.mode===Nr.LINE_STRIP)y=new Hs(m,b);else if(v.mode===Nr.LINE_LOOP)y=new n2(m,b);else if(v.mode===Nr.POINTS)y=new CA(m,b);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+v.mode);Object.keys(y.geometry.morphAttributes).length>0&&D4(y,r),y.name=e.createUniqueName(r.name||"mesh_"+t),nc(y,r),v.extensions&&Yc(s,y,v),e.assignFinalMaterial(y),d.push(y)}for(let p=0,g=d.length;p<g;p++)e.associations.set(d[p],{meshes:t,primitives:p});if(d.length===1)return r.extensions&&Yc(s,d[0],r),d[0];const f=new To;r.extensions&&Yc(s,f,r),e.associations.set(f,{meshes:t});for(let p=0,g=d.length;p<g;p++)f.add(d[p]);return f})}loadCamera(t){let e;const i=this.json.cameras[t],s=i[i.type];if(!s){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return i.type==="perspective"?e=new xt(vt.radToDeg(s.yfov),s.aspectRatio||1,s.znear||1,s.zfar||2e6):i.type==="orthographic"&&(e=new Vh(-s.xmag,s.xmag,s.ymag,-s.ymag,s.znear,s.zfar)),i.name&&(e.name=this.createUniqueName(i.name)),nc(e,i),Promise.resolve(e)}loadSkin(t){const e=this.json.skins[t],i=[];for(let s=0,r=e.joints.length;s<r;s++)i.push(this._loadNodeShallow(e.joints[s]));return e.inverseBindMatrices!==void 0?i.push(this.getDependency("accessor",e.inverseBindMatrices)):i.push(null),Promise.all(i).then(function(s){const r=s.pop(),o=s,a=[],l=[];for(let h=0,u=o.length;h<u;h++){const d=o[h];if(d){a.push(d);const f=new ce;r!==null&&f.fromArray(r.array,h*16),l.push(f)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',e.joints[h])}return new ux(a,l)})}loadAnimation(t){const e=this.json,i=this,s=e.animations[t],r=s.name?s.name:"animation_"+t,o=[],a=[],l=[],h=[],u=[];let d=0,f=s.channels.length;for(d=0,f=s.channels.length;d<f;d++){const p=s.channels[d],g=s.samplers[p.sampler],m=p.target,v=m.node,y=s.parameters!==void 0?s.parameters[g.input]:g.input,b=s.parameters!==void 0?s.parameters[g.output]:g.output;m.node!==void 0&&(o.push(this.getDependency("node",v)),a.push(this.getDependency("accessor",y)),l.push(this.getDependency("accessor",b)),h.push(g),u.push(m))}return Promise.all([Promise.all(o),Promise.all(a),Promise.all(l),Promise.all(h),Promise.all(u)]).then(function(p){const g=p[0],m=p[1],v=p[2],y=p[3],b=p[4],_=[];for(d=0,f=g.length;d<f;d++){const x=g[d],S=m[d],T=v[d],L=y[d],I=b[d];if(x===void 0)continue;x.updateMatrix&&x.updateMatrix();const P=i._createAnimationTracks(x,S,T,L,I);if(P)for(let R=0;R<P.length;R++)_.push(P[R])}return new Pa(r,void 0,_)})}createNodeMesh(t){const e=this.json,i=this,s=e.nodes[t];return s.mesh===void 0?null:i.getDependency("mesh",s.mesh).then(function(r){const o=i._getNodeRef(i.meshCache,s.mesh,r);return s.weights!==void 0&&o.traverse(function(a){if(a.isMesh)for(let l=0,h=s.weights.length;l<h;l++)a.morphTargetInfluences[l]=s.weights[l]}),o})}loadNode(t){const e=this.json,i=this,s=e.nodes[t],r=i._loadNodeShallow(t),o=[],a=s.children||[];for(let h=0,u=a.length;h<u;h++)o.push(i.getDependency("node",a[h]));const l=s.skin===void 0?Promise.resolve(null):i.getDependency("skin",s.skin);return Promise.all([r,Promise.all(o),l]).then(function(h){const u=h[0],d=h[1],f=h[2];f!==null&&u.traverse(function(p){p.isSkinnedMesh&&p.bind(f,L4)});for(let p=0,g=d.length;p<g;p++)u.add(d[p]);return u})}_loadNodeShallow(t){const e=this.json,i=this.extensions,s=this;if(this.nodeCache[t]!==void 0)return this.nodeCache[t];const r=e.nodes[t],o=r.name?s.createUniqueName(r.name):"",a=[],l=s._invokeOne(function(h){return h.createNodeMesh&&h.createNodeMesh(t)});return l&&a.push(l),r.camera!==void 0&&a.push(s.getDependency("camera",r.camera).then(function(h){return s._getNodeRef(s.cameraCache,r.camera,h)})),s._invokeAll(function(h){return h.createNodeAttachment&&h.createNodeAttachment(t)}).forEach(function(h){a.push(h)}),this.nodeCache[t]=Promise.all(a).then(function(h){let u;if(r.isBone===!0?u=new JA:h.length>1?u=new To:h.length===1?u=h[0]:u=new re,u!==h[0])for(let d=0,f=h.length;d<f;d++)u.add(h[d]);if(r.name&&(u.userData.name=r.name,u.name=o),nc(u,r),r.extensions&&Yc(i,u,r),r.matrix!==void 0){const d=new ce;d.fromArray(r.matrix),u.applyMatrix4(d)}else r.translation!==void 0&&u.position.fromArray(r.translation),r.rotation!==void 0&&u.quaternion.fromArray(r.rotation),r.scale!==void 0&&u.scale.fromArray(r.scale);return s.associations.has(u)||s.associations.set(u,{}),s.associations.get(u).nodes=t,u}),this.nodeCache[t]}loadScene(t){const e=this.extensions,i=this.json.scenes[t],s=this,r=new To;i.name&&(r.name=s.createUniqueName(i.name)),nc(r,i),i.extensions&&Yc(e,r,i);const o=i.nodes||[],a=[];for(let l=0,h=o.length;l<h;l++)a.push(s.getDependency("node",o[l]));return Promise.all(a).then(function(l){for(let u=0,d=l.length;u<d;u++)r.add(l[u]);const h=u=>{const d=new Map;for(const[f,p]of s.associations)(f instanceof ft||f instanceof pt)&&d.set(f,p);return u.traverse(f=>{const p=s.associations.get(f);p!=null&&d.set(f,p)}),d};return s.associations=h(r),r})}_createAnimationTracks(t,e,i,s,r){const o=[],a=t.name?t.name:t.uuid,l=[];jl[r.path]===jl.weights?t.traverse(function(f){f.morphTargetInfluences&&l.push(f.name?f.name:f.uuid)}):l.push(a);let h;switch(jl[r.path]){case jl.weights:h=__;break;case jl.rotation:h=ig;break;case jl.position:case jl.scale:h=$A;break;default:switch(i.itemSize){case 1:h=__;break;case 2:case 3:default:h=$A;break}break}const u=s.interpolation!==void 0?B4[s.interpolation]:dx,d=this._getArrayFromAccessor(i);for(let f=0,p=l.length;f<p;f++){const g=new h(l[f]+"."+jl[r.path],e.array,d,u);s.interpolation==="CUBICSPLINE"&&this._createCubicSplineTrackInterpolant(g),o.push(g)}return o}_getArrayFromAccessor(t){let e=t.array;if(t.normalized){const i=G_(e.constructor),s=new Float32Array(e.length);for(let r=0,o=e.length;r<o;r++)s[r]=e[r]*i;e=s}return e}_createCubicSplineTrackInterpolant(t){t.createInterpolant=function(i){const s=this instanceof ig?R4:QP;return new s(this.times,this.values,this.getValueSize()/3,i)},t.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function U4(n,t,e){const i=t.attributes,s=new Nn;if(i.POSITION!==void 0){const a=e.json.accessors[i.POSITION],l=a.min,h=a.max;if(l!==void 0&&h!==void 0){if(s.set(new C(l[0],l[1],l[2]),new C(h[0],h[1],h[2])),a.normalized){const u=G_(Ad[a.componentType]);s.min.multiplyScalar(u),s.max.multiplyScalar(u)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const r=t.targets;if(r!==void 0){const a=new C,l=new C;for(let h=0,u=r.length;h<u;h++){const d=r[h];if(d.POSITION!==void 0){const f=e.json.accessors[d.POSITION],p=f.min,g=f.max;if(p!==void 0&&g!==void 0){if(l.setX(Math.max(Math.abs(p[0]),Math.abs(g[0]))),l.setY(Math.max(Math.abs(p[1]),Math.abs(g[1]))),l.setZ(Math.max(Math.abs(p[2]),Math.abs(g[2]))),f.normalized){const m=G_(Ad[f.componentType]);l.multiplyScalar(m)}a.max(l)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}s.expandByVector(a)}n.boundingBox=s;const o=new Wh;s.getCenter(o.center),o.radius=s.min.distanceTo(s.max)/2,n.boundingSphere=o}function BE(n,t,e){const i=t.attributes,s=[];function r(o,a){return e.getDependency("accessor",o).then(function(l){n.setAttribute(a,l)})}for(const o in i){const a=j_[o]||o.toLowerCase();a in n.attributes||s.push(r(i[o],a))}if(t.indices!==void 0&&!n.index){const o=e.getDependency("accessor",t.indices).then(function(a){n.setIndex(a)});s.push(o)}return GS.workingColorSpace!==Di&&"COLOR_0"in i&&console.warn(`THREE.GLTFLoader: Converting vertex colors from "srgb-linear" to "${GS.workingColorSpace}" not supported.`),nc(n,t),U4(n,t,e),Promise.all(s).then(function(){return t.targets!==void 0?M4(n,t.targets,e):n})}function _y(n){const e=new URL(window.location.href).searchParams.get(n);return e==null||e==="0"||e==="false"?!1:e===""?!0:e}function N4(n,t){if(t===void 0||t.startsWith("./")||t.startsWith("http")||n===void 0)return t;const e=n.lastIndexOf("/");if(e>=0){const i=n.substring(0,e+1);for(;i.endsWith("/")&&t.startsWith("/");)t=t.substring(1);return i+t}return t}let Ef;function Q4(){return Ef!==void 0||(Ef=/iPhone|iPad|iPod|Android|IEMobile/i.test(navigator.userAgent),_y("debugprogressive")&&console.log("isMobileDevice",Ef)),Ef}function Dg(n){var t;return((t=n==null?void 0:n.userData)==null?void 0:t["needle:raycast-mesh"])instanceof jt?n.userData["needle:raycast-mesh"]:null}function z4(n,t){if((n.type==="Mesh"||n.type==="SkinnedMesh")&&!Dg(n)){const i=j4(t);i.userData={isRaycastMesh:!0},n.userData||(n.userData={}),n.userData["needle:raycast-mesh"]=i}}function Fq(n=!0){if(n){if(If)return;const t=If=J.prototype.raycast;J.prototype.raycast=function(e,i){const s=this,r=Dg(s);let o;r&&s.isMesh&&(o=s.geometry,s.geometry=r),t.call(this,e,i),o&&(s.geometry=o)}}else{if(!If)return;J.prototype.raycast=If,If=null}}let If=null;function j4(n){const t=new jt;for(const e in n.attributes)t.setAttribute(e,n.getAttribute(e));return t.setIndex(n.getIndex()),t}const sc=new Array,ll="NEEDLE_progressive",di=_y("debugprogressive"),rb=Symbol("needle-progressive-texture"),gp=new Map,H_=new Set;if(di){let i=function(){n+=1,console.log("Toggle LOD level",n,gp),gp.forEach((s,r)=>{for(const o of s.keys){const a=r[o];if(a.isBufferGeometry===!0){const l=ct.getMeshLODInformation(a),h=l?Math.min(n,l.lods.length):0;r["DEBUG:LOD"]=n,ct.assignMeshLOD(r,h),l&&(t=Math.max(t,l.lods.length-1))}else if(r.isMaterial===!0){r["DEBUG:LOD"]=n,ct.assignTextureLOD(r,n);break}}}),n>=t&&(n=-1)},n=-1,t=2,e=!1;window.addEventListener("keyup",s=>{s.key==="p"&&i(),s.key==="w"&&(e=!e,H_&&H_.forEach(r=>{r.name!="BackgroundCubeMaterial"&&"wireframe"in r&&(r.wireframe=e)}))})}function PE(n,t,e){var s;if(!di)return;gp.has(n)||gp.set(n,{keys:[],sourceId:e});const i=gp.get(n);((s=i==null?void 0:i.keys)==null?void 0:s.includes(t))==!1&&i.keys.push(t)}const Wi=class{constructor(t,e){c(this,"parser");c(this,"url");c(this,"_isLoadingMesh");c(this,"loadMesh",t=>{var i,s;if(this._isLoadingMesh)return null;const e=(s=(i=this.parser.json.meshes[t])==null?void 0:i.extensions)==null?void 0:s[ll];return e?(this._isLoadingMesh=!0,this.parser.getDependency("mesh",t).then(r=>(this._isLoadingMesh=!1,r&&Wi.registerMesh(this.url,e.guid,r,e.lods.length,void 0,e),r))):null});di&&console.log("Progressive extension registered for",e),this.parser=t,this.url=e}get name(){return ll}static getMeshLODInformation(t){const e=this.getAssignedLODInformation(t);return e!=null&&e.key?this.lodInfos.get(e.key):null}static getMaterialMinMaxLODsCount(t,e){const i=this,s="LODS:minmax",r=t[s];if(r!=null)return r;if(e||(e={min_count:1/0,max_count:0,lods:[]}),Array.isArray(t)){for(const a of t)this.getMaterialMinMaxLODsCount(a,e);return t[s]=e,e}if(di==="verbose"&&console.log("getMaterialMinMaxLODsCount",t),t.type==="ShaderMaterial"||t.type==="RawShaderMaterial"){const a=t;for(const l of Object.keys(a.uniforms)){const h=a.uniforms[l].value;(h==null?void 0:h.isTexture)===!0&&o(h,e)}}else if(t.isMaterial)for(const a of Object.keys(t)){const l=t[a];(l==null?void 0:l.isTexture)===!0&&o(l,e)}return t[s]=e,e;function o(a,l){const h=i.getAssignedLODInformation(a);if(h){const u=i.lodInfos.get(h.key);if(u&&u.lods){l.min_count=Math.min(l.min_count,u.lods.length),l.max_count=Math.max(l.max_count,u.lods.length);for(let d=0;d<u.lods.length;d++){const f=u.lods[d];f.width&&(l.lods[d]=l.lods[d]||{min_height:1/0,max_height:0},l.lods[d].min_height=Math.min(l.lods[d].min_height,f.height),l.lods[d].max_height=Math.max(l.lods[d].max_height,f.height))}}}}}static hasLODLevelAvailable(t,e){var r;if(Array.isArray(t)){for(const o of t)if(this.hasLODLevelAvailable(o,e))return!0;return!1}if(t.isMaterial===!0){for(const o of Object.keys(t)){const a=t[o];if(a&&a.isTexture&&this.hasLODLevelAvailable(a,e))return!0}return!1}else if(t.isGroup===!0){for(const o of t.children)if(o.isMesh===!0&&this.hasLODLevelAvailable(o,e))return!0}let i,s;if(t.isMesh?i=t.geometry:(t.isBufferGeometry||t.isTexture)&&(i=t),i&&(r=i==null?void 0:i.userData)!=null&&r.LODS){const o=i.userData.LODS;if(s=this.lodInfos.get(o.key),e===void 0)return s!=null;if(s)return Array.isArray(s.lods)?e<s.lods.length:e===0}return!1}static assignMeshLOD(t,e){var i;if(!t)return Promise.resolve(null);if(t instanceof J||t.isMesh===!0){const s=t.geometry,r=this.getAssignedLODInformation(s);if(!r)return Promise.resolve(null);for(const o of sc)(i=o.onBeforeGetLODMesh)==null||i.call(o,t,e);return t["LOD:requested level"]=e,Wi.getOrLoadLOD(s,e).then(o=>{if(t["LOD:requested level"]===e){if(delete t["LOD:requested level"],Array.isArray(o)){const a=r.index||0;o=o[a]}o&&s!=o&&o instanceof jt&&(t.geometry=o,di&&PE(t,"geometry",r.url))}return o}).catch(o=>(console.error("Error loading mesh LOD",t,o),null))}else di&&console.error("Invalid call to assignMeshLOD: Request mesh LOD but the object is not a mesh",t);return Promise.resolve(null)}static assignTextureLOD(t,e=0){if(!t)return Promise.resolve(null);if(t instanceof ft||t.isMaterial===!0){const i=t,s=[],r=new Array;if(di&&H_.add(i),i.uniforms&&i.isRawShaderMaterial||i.isShaderMaterial===!0){const o=i;for(const a of Object.keys(o.uniforms)){const l=o.uniforms[a].value;if((l==null?void 0:l.isTexture)===!0){const h=this.assignTextureLODForSlot(l,e,i,a);s.push(h),r.push(a)}}}else for(const o of Object.keys(i)){const a=i[o];if((a==null?void 0:a.isTexture)===!0){const l=this.assignTextureLODForSlot(a,e,i,o);s.push(l),r.push(o)}}return Promise.all(s).then(o=>{const a=new Array;for(let l=0;l<o.length;l++){const h=o[l],u=r[l];h&&h.isTexture===!0?a.push({material:i,slot:u,texture:h,level:e}):a.push({material:i,slot:u,texture:null,level:e})}return a})}if(t instanceof pt||t.isTexture===!0){const i=t;return this.assignTextureLODForSlot(i,e,null,null)}return Promise.resolve(null)}static assignTextureLODForSlot(t,e,i,s){return(t==null?void 0:t.isTexture)!==!0?Promise.resolve(null):s==="glyphMap"?Promise.resolve(t):Wi.getOrLoadLOD(t,e).then(r=>{if(Array.isArray(r))return null;if((r==null?void 0:r.isTexture)===!0){if(r!=t){if(i&&s){const o=i[s];if(o){const a=this.getAssignedLODInformation(o);if(a&&(a==null?void 0:a.level)<e)return di==="verbose"&&console.warn("Assigned texture level is already higher: ",a.level,e,i,o,r),null}i[s]=r}if(di&&s&&i){const o=this.getAssignedLODInformation(t);o&&PE(i,s,o.url)}}return r}else di=="verbose"&&console.warn("No LOD found for",t,e);return null}).catch(r=>(console.error("Error loading LOD",t,r),null))}afterRoot(t){var e,i;return di&&console.log("AFTER",this.url,t),(e=this.parser.json.textures)==null||e.forEach((s,r)=>{if(s!=null&&s.extensions){const o=s==null?void 0:s.extensions[ll];if(o){if(!o.lods){di&&console.warn("Texture has no LODs",o);return}let a=!1;for(const l of this.parser.associations.keys())l.isTexture===!0&&this.parser.associations.get(l).textures===r&&(a=!0,Wi.registerTexture(this.url,l,o.lods.length,r,o));a||this.parser.getDependency("texture",r).then(l=>{l&&Wi.registerTexture(this.url,l,o.lods.length,r,o)})}}}),(i=this.parser.json.meshes)==null||i.forEach((s,r)=>{if(s!=null&&s.extensions){const o=s==null?void 0:s.extensions[ll];if(o&&o.lods){for(const a of this.parser.associations.keys())if(a.isMesh){const l=this.parser.associations.get(a);l.meshes===r&&Wi.registerMesh(this.url,o.guid,a,o.lods.length,l.primitives,o)}}}}),null}static async getOrLoadLOD(t,e){var a,l,h,u;const i=di=="verbose",s=t.userData.LODS;if(!s)return null;const r=s==null?void 0:s.key;let o;if(t.isTexture===!0){const d=t;d.source&&d.source[rb]&&(o=d.source[rb])}if(o||(o=Wi.lodInfos.get(r)),o){if(e>0){let p=!1;const g=Array.isArray(o.lods);if(g&&e>=o.lods.length?p=!0:g||(p=!0),p)return this.lowresCache.get(r)}const d=Array.isArray(o.lods)?(a=o.lods[e])==null?void 0:a.path:o.lods;if(!d)return di&&!o["missing:uri"]&&(o["missing:uri"]=!0,console.warn("Missing uri for progressive asset for LOD "+e,o)),null;const f=N4(s.url,d);if(f.endsWith(".glb")||f.endsWith(".gltf")){if(!o.guid)return console.warn("missing pointer for glb/gltf texture",o),null;const p=f+"_"+o.guid,g=this.previouslyLoaded.get(p);if(g!==void 0){i&&console.log(`LOD ${e} was already loading/loaded: ${p}`);let b=await g.catch(x=>(console.error(`Error loading LOD ${e} from ${f}
`,x),null)),_=!1;if(b==null||(b instanceof pt&&t instanceof pt?(l=b.image)!=null&&l.data||(h=b.source)!=null&&h.data?b=this.copySettings(t,b):(_=!0,this.previouslyLoaded.delete(p)):b instanceof jt&&t instanceof jt&&((u=b.attributes.position)!=null&&u.array||(_=!0,this.previouslyLoaded.delete(p)))),!_)return b}const m=o,v=new Promise(async(b,_)=>{const x=new Fc;UP(x),di&&(await new Promise(P=>setTimeout(P,1e3)),i&&console.warn("Start loading (delayed) "+f,m.guid));let S=f;if(m&&Array.isArray(m.lods)){const P=m.lods[e];P.hash&&(S+="?v="+P.hash)}const T=await x.loadAsync(S).catch(P=>(console.error(`Error loading LOD ${e} from ${f}
`,P),null));if(!T)return null;const L=T.parser;i&&console.log("Loading finished "+f,m.guid);let I=0;if(T.parser.json.textures){let P=!1;for(const R of T.parser.json.textures){if(R!=null&&R.extensions){const B=R==null?void 0:R.extensions[ll];if(B!=null&&B.guid&&B.guid===m.guid){P=!0;break}}I++}if(P){let R=await L.getDependency("texture",I);return R&&Wi.assignLODInformation(s.url,R,r,e,void 0,void 0),i&&console.log('change "'+t.name+'" â†’ "'+R.name+'"',f,I,R,p),t instanceof pt&&(R=this.copySettings(t,R)),R&&(R.guid=m.guid),b(R)}else di&&console.warn("Could not find texture with guid",m.guid)}if(I=0,T.parser.json.meshes){let P=!1;for(const R of T.parser.json.meshes){if(R!=null&&R.extensions){const B=R==null?void 0:R.extensions[ll];if(B!=null&&B.guid&&B.guid===m.guid){P=!0;break}}I++}if(P){const R=await L.getDependency("mesh",I),B=m;if(i&&console.log(`Loaded Mesh "${R.name}"`,f,I,R,p),R.isMesh===!0){const Q=R.geometry;return Wi.assignLODInformation(s.url,Q,r,e,void 0,B.density),b(Q)}else{const Q=new Array;for(let G=0;G<R.children.length;G++){const V=R.children[G];if(V instanceof J){const X=V.geometry;Wi.assignLODInformation(s.url,X,r,e,G,B.density),Q.push(X)}}return b(Q)}}}return b(null)});return this.previouslyLoaded.set(p,v),await v}else if(t instanceof pt){i&&console.log("Load texture from uri: "+f);const g=await new Ra().loadAsync(f);return g?(g.guid=o.guid,g.flipY=!1,g.needsUpdate=!0,g.colorSpace=t.colorSpace,i&&console.log(o,g)):di&&console.warn("failed loading",f),g}}else di&&console.warn(`Can not load LOD ${e}: no LOD info found for "${r}" ${t.name}`,t.type);return null}static assignLODInformation(t,e,i,s,r,o){if(!e)return;e.userData||(e.userData={});const a=new G4(t,i,s,r,o);e.userData.LODS=a,e.userData.LOD=s}static getAssignedLODInformation(t){var e;return((e=t==null?void 0:t.userData)==null?void 0:e.LODS)||null}static copySettings(t,e){return e=e.clone(),di&&console.warn(`Copying texture settings
`,t.uuid,`
`,e.uuid),e.offset=t.offset,e.repeat=t.repeat,e.colorSpace=t.colorSpace,e.magFilter=t.magFilter,e.minFilter=t.minFilter,e.wrapS=t.wrapS,e.wrapT=t.wrapT,e.flipY=t.flipY,e.anisotropy=t.anisotropy,e.mipmaps||(e.generateMipmaps=t.generateMipmaps),e}};let ct=Wi;c(ct,"registerTexture",(t,e,i,s,r)=>{if(di&&console.log("> Progressive: register texture",s,e.name,e.uuid,e,r),!e){di&&console.error("gltf-progressive: Register texture without texture");return}e.source&&(e.source[rb]=r);const o=r.guid;Wi.assignLODInformation(t,e,o,i,s,void 0),Wi.lodInfos.set(o,r),Wi.lowresCache.set(o,e)}),c(ct,"registerMesh",(t,e,i,s,r,o)=>{var h;di&&console.log("> Progressive: register mesh",r,i.name,o,i.uuid,i);const a=i.geometry;if(!a){di&&console.warn("gltf-progressive: Register mesh without geometry");return}a.userData||(a.userData={}),Wi.assignLODInformation(t,a,e,s,r,o.density),Wi.lodInfos.set(e,o);let l=Wi.lowresCache.get(e);l?l.push(i.geometry):l=[i.geometry],Wi.lowresCache.set(e,l),s>0&&!Dg(i)&&z4(i,a);for(const u of sc)(h=u.onRegisteredNewMesh)==null||h.call(u,i,o)}),c(ct,"lodInfos",new Map),c(ct,"previouslyLoaded",new Map),c(ct,"lowresCache",new Map);class G4{constructor(t,e,i,s,r){c(this,"url");c(this,"key");c(this,"level");c(this,"index");c(this,"density");this.url=t,this.key=e,this.level=i,s!=null&&(this.index=s),r!=null&&(this.density=r)}}const mu=_y("debugprogressive"),H4=_y("noprogressive"),ME=Symbol("Needle:LODSManager"),fo={mesh_lod:-1,texture_lod:-1};var Bi;let cc=(Bi=class{constructor(t){c(this,"renderer");c(this,"projectionScreenMatrix",new ce);c(this,"cameraFrustrum",new w_);c(this,"targetTriangleDensity",2e5);c(this,"updateInterval",0);c(this,"pause",!1);c(this,"_frame",0);c(this,"_originalRender");c(this,"_sphere",new Wh);c(this,"_tempBox",new Nn);c(this,"_tempBox2",new Nn);c(this,"tempMatrix",new ce);c(this,"_tempWorldPosition",new C);c(this,"_tempBoxSize",new C);c(this,"_tempBox2Size",new C);this.renderer=t}static getObjectLODState(t){var e;return(e=t.userData)==null?void 0:e.LOD_state}static addPlugin(t){sc.push(t)}static removePlugin(t){const e=sc.indexOf(t);e>=0&&sc.splice(e,1)}static get(t){return t[ME]?t[ME]:new Bi(t)}get plugins(){return sc}enable(){if(this._originalRender)return;let t=0;this._originalRender=this.renderer.render;const e=this;FP(this.renderer),this.renderer.render=function(i,s){e.renderer.getRenderTarget()==null&&(t=0,e._frame+=1);const o=e._frame,a=t++;e.onBeforeRender(i,s,a,o),e._originalRender.call(this,i,s),e.onAfterRender(i,s,a,o)}}disable(){this._originalRender&&(this.renderer.render=this._originalRender,this._originalRender=void 0)}onBeforeRender(t,e,i,s){}onAfterRender(t,e,i,s){var l,h;if(this.pause)return;const r=this.renderer.renderLists.get(t,0),o=r.opaque;let a=!0;if(o.length===1){const u=o[0].material;(u.name==="EffectMaterial"||u.name==="CopyShader")&&(a=!1)}if(e.parent&&e.parent.type==="CubeCamera"&&(a=!1),a){if(H4||this.updateInterval>0&&s%this.updateInterval!=0)return;this.projectionScreenMatrix.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this.cameraFrustrum.setFromProjectionMatrix(this.projectionScreenMatrix,this.renderer.coordinateSystem);const u=this.targetTriangleDensity;for(const f of o){if(f.material&&(((l=f.geometry)==null?void 0:l.type)==="BoxGeometry"||((h=f.geometry)==null?void 0:h.type)==="BufferGeometry")&&(f.material.name==="SphericalGaussianBlur"||f.material.name=="BackgroundCubeMaterial"||f.material.name==="CubemapFromEquirect"||f.material.name==="EquirectangularToCubeUV")){mu&&(f.material["NEEDLE_PROGRESSIVE:IGNORE-WARNING"]||(f.material["NEEDLE_PROGRESSIVE:IGNORE-WARNING"]=!0,console.warn("Ignoring skybox or BLIT object",f,f.material.name,f.material.type)));continue}switch(f.material.type){case"LineBasicMaterial":case"LineDashedMaterial":case"PointsMaterial":case"ShadowMaterial":case"MeshDistanceMaterial":case"MeshDepthMaterial":continue}const p=f.object;(p instanceof J||p.isMesh)&&this.updateLODs(t,e,p,u,s)}const d=r.transparent;for(const f of d){const p=f.object;(p instanceof J||p.isMesh)&&this.updateLODs(t,e,p,u,s)}}}updateLODs(t,e,i,s,r){var l,h;i.userData||(i.userData={});let o=i.userData.LOD_state;if(o||(o=new V4,i.userData.LOD_state=o),o.frames++<2)return;for(const u of sc)(l=u.onBeforeUpdateLOD)==null||l.call(u,this.renderer,t,e,i);this.calculateLodLevel(e,i,o,s,fo),fo.mesh_lod=Math.round(fo.mesh_lod),fo.texture_lod=Math.round(fo.texture_lod),fo.mesh_lod>=0&&this.loadProgressiveMeshes(i,fo.mesh_lod);let a=fo.texture_lod;if(i.material&&a>=0){const u=i["DEBUG:LOD"];u!=null&&(a=u),this.loadProgressiveTextures(i.material,a)}for(const u of sc)(h=u.onAfterUpdatedLOD)==null||h.call(u,this.renderer,t,e,i,fo);o.lastLodLevel_Mesh=fo.mesh_lod,o.lastLodLevel_Texture=fo.texture_lod}loadProgressiveTextures(t,e){if(!t)return;if(Array.isArray(t)){for(const r of t)this.loadProgressiveTextures(r,e);return}const i=t;let s=!1;(i.NEEDLE_LOD==null||e<i.NEEDLE_LOD)&&(s=!0),s&&(i.NEEDLE_LOD=e,ct.assignTextureLOD(t,e))}loadProgressiveMeshes(t,e){if(!t)return Promise.resolve(null);if(t.userData||(t.userData={}),t.userData.LOD!==e){t.userData.LOD=e;const i=t.geometry;return ct.assignMeshLOD(t,e).then(s=>(s&&t.userData.LOD==e&&i!=t.geometry,s))}return Promise.resolve(null)}static isInside(t,e){const i=t.min,s=t.max,r=(i.x+s.x)*.5,o=(i.y+s.y)*.5;return this._tempPtInside.set(r,o,i.z).applyMatrix4(e).z<0}calculateLodLevel(t,e,i,s,r){var g;if(!e){r.mesh_lod=-1,r.texture_lod=-1;return}if(!t){r.mesh_lod=-1,r.texture_lod=-1;return}let a=10+1;if(mu&&e["DEBUG:LOD"]!=null)return e["DEBUG:LOD"];const l=ct.getMeshLODInformation(e.geometry),h=l==null?void 0:l.lods,u=h&&h.length>0,d=ct.getMaterialMinMaxLODsCount(e.material),f=(d==null?void 0:d.min_count)!=1/0&&d.min_count>0&&d.max_count>0;if(!u&&!f){r.mesh_lod=0,r.texture_lod=0;return}if(u||(a=0),!((g=this.cameraFrustrum)!=null&&g.intersectsObject(e))){r.mesh_lod=99,r.texture_lod=99;return}const p=e.geometry.boundingBox;if(p&&t.isPerspectiveCamera){const m=t;if(e.geometry.attributes.color&&e.geometry.attributes.color.count<100&&e.geometry.boundingSphere){this._sphere.copy(e.geometry.boundingSphere),this._sphere.applyMatrix4(e.matrixWorld);const I=t.getWorldPosition(this._tempWorldPosition);if(this._sphere.containsPoint(I)){r.mesh_lod=0,r.texture_lod=0;return}}if(this._tempBox.copy(p),this._tempBox.applyMatrix4(e.matrixWorld),Bi.isInside(this._tempBox,this.projectionScreenMatrix)){r.mesh_lod=0,r.texture_lod=0;return}if(this._tempBox.applyMatrix4(this.projectionScreenMatrix),this.renderer.xr.enabled&&m.fov>70){const I=this._tempBox.min,P=this._tempBox.max;let R=I.x,B=I.y,Q=P.x,G=P.y;const V=2,X=1.5,k=(I.x+P.x)*.5,M=(I.y+P.y)*.5;R=(R-k)*V+k,B=(B-M)*V+M,Q=(Q-k)*V+k,G=(G-M)*V+M;const H=R<0&&Q>0?0:Math.min(Math.abs(I.x),Math.abs(P.x)),ee=B<0&&G>0?0:Math.min(Math.abs(I.y),Math.abs(P.y)),Y=Math.max(H,ee);i.lastCentrality=(X-Y)*(X-Y)*(X-Y)}else i.lastCentrality=1;const v=this._tempBox.getSize(this._tempBoxSize);v.multiplyScalar(.5),screen.availHeight>0&&v.multiplyScalar(this.renderer.domElement.clientHeight/screen.availHeight),v.x*=m.aspect;const y=t.matrixWorldInverse,b=this._tempBox2;b.copy(p),b.applyMatrix4(e.matrixWorld),b.applyMatrix4(y);const _=b.getSize(this._tempBox2Size),x=Math.max(_.x,_.y);if(Math.max(v.x,v.y)!=0&&x!=0&&(v.z=_.z/Math.max(_.x,_.y)*Math.max(v.x,v.y)),i.lastScreenCoverage=Math.max(v.x,v.y,v.z),i.lastScreenspaceVolume.copy(v),i.lastScreenCoverage*=i.lastCentrality,mu&&Bi.debugDrawLine){const I=this.tempMatrix.copy(this.projectionScreenMatrix);I.invert();const P=Bi.corner0,R=Bi.corner1,B=Bi.corner2,Q=Bi.corner3;P.copy(this._tempBox.min),R.copy(this._tempBox.max),R.x=P.x,B.copy(this._tempBox.max),B.y=P.y,Q.copy(this._tempBox.max);const G=(P.z+Q.z)*.5;P.z=R.z=B.z=Q.z=G,P.applyMatrix4(I),R.applyMatrix4(I),B.applyMatrix4(I),Q.applyMatrix4(I),Bi.debugDrawLine(P,R,255),Bi.debugDrawLine(P,B,255),Bi.debugDrawLine(R,Q,255),Bi.debugDrawLine(B,Q,255)}let T=999;if(h&&i.lastScreenCoverage>0){for(let I=0;I<h.length;I++)if(h[I].density/i.lastScreenCoverage<s){T=I;break}}T<a&&(a=T)}if(r.mesh_lod=a,f)if(i.lastLodLevel_Texture<0){if(r.texture_lod=d.max_count-1,mu){const m=d.lods[d.max_count-1];mu&&console.log(`First Texture LOD ${r.texture_lod} (${m.max_height}px) - ${e.name}`)}}else{const m=i.lastScreenCoverage*1.5,y=this.renderer.domElement.clientHeight/window.devicePixelRatio*m;for(let b=d.lods.length-1;b>=0;b--){const _=d.lods[b];if(!(Q4()&&_.max_height>4096)&&_.max_height>y){r.texture_lod=b,r.texture_lod<i.lastLodLevel_Texture&&mu&&console.log(`Texture LOD changed ${i.lastLodLevel_Texture} â†’ ${r.texture_lod} (${_.max_height}px: ${(100*i.lastScreenCoverage).toFixed(2)} % = ${y.toFixed(0)}px) - ${e.name}`);break}}}else r.texture_lod=0}},c(Bi,"debugDrawLine"),c(Bi,"corner0",new C),c(Bi,"corner1",new C),c(Bi,"corner2",new C),c(Bi,"corner3",new C),c(Bi,"_tempPtInside",new C),Bi);class V4{constructor(){c(this,"frames",0);c(this,"lastLodLevel_Mesh",-1);c(this,"lastLodLevel_Texture",-1);c(this,"lastScreenCoverage",0);c(this,"lastScreenspaceVolume",new C);c(this,"lastCentrality",0)}}const DE=Symbol("NEEDLE_mesh_lod"),xm=Symbol("NEEDLE_texture_lod");function W4(n){if(!n)return null;let t=null,e=null;for(let i=n;i!=null;i=Object.getPrototypeOf(i)){const s=Object.getOwnPropertySymbols(i),r=s.find(a=>a.toString()=="Symbol(renderer)"),o=s.find(a=>a.toString()=="Symbol(scene)");!t&&r!=null&&(t=n[r].threeRenderer),!e&&o!=null&&(e=n[o])}if(t){console.log("Adding Needle LODs to modelviewer");const i=cc.get(t);if(cc.addPlugin(new q4(n)),i.enable(),e){const s=e.camera||e.traverse(r=>r.type=="PerspectiveCamera")[0];s&&t.render(e,s)}return()=>{i.disable()}}return null}class q4{constructor(t){c(this,"modelviewer");c(this,"_didWarnAboutMissingUrl",!1);this.modelviewer=t}onBeforeUpdateLOD(t,e,i,s){this.tryParseMeshLOD(e,s),this.tryParseTextureLOD(e,s)}getUrl(){let t=this.modelviewer.getAttribute("src");return t||(t=this.modelviewer.src),t||(this._didWarnAboutMissingUrl||console.warn("No url found in modelviewer",this.modelviewer),this._didWarnAboutMissingUrl=!0),t}tryGetCurrentGLTF(t){return t._currentGLTF}tryParseTextureLOD(t,e){if(e[xm]==!0)return;e[xm]=!0;const i=this.tryGetCurrentGLTF(t),s=this.getUrl();if(s&&i&&e.material){let o=function(a){var h,u,d;if(a[xm]==!0)return;a[xm]=!0,a.userData&&(a.userData.LOD=-1);const l=Object.keys(a);for(let f=0;f<l.length;f++){const p=l[f],g=a[p];if((g==null?void 0:g.isTexture)===!0){const m=(u=(h=g.userData)==null?void 0:h.associations)==null?void 0:u.textures,v=i.parser.json.textures[m];if(!v){console.warn("Texture data not found for texture index "+m);continue}if((d=v==null?void 0:v.extensions)!=null&&d[ll]){const y=v.extensions[ll];y&&s&&ct.registerTexture(s,g,y.lods.length,m,y)}}}};const r=e.material;if(Array.isArray(r))for(const a of r)o(a);else o(r)}}tryParseMeshLOD(t,e){var r,o;if(e[DE]==!0)return;e[DE]=!0;const i=this.getUrl();if(!i)return;const s=(o=(r=e.userData)==null?void 0:r.gltfExtensions)==null?void 0:o[ll];if(s&&i){const a=e.uuid;ct.registerMesh(i,a,e,0,s.lods.length,s)}}}function Uq(n,t,e,i){FP(t),UP(e),e.register(r=>new ct(r,n));const s=cc.get(t);return(i==null?void 0:i.enableLODsManager)!==!1&&s.enable(),s}document.addEventListener("DOMContentLoaded",()=>{W4(document.querySelector("model-viewer"))});const vd=N("debugdecoders");let mp="https://www.gstatic.com/draco/versioned/decoders/1.4.1/",V_="https://www.gstatic.com/basis-universal/versioned/2021-04-15-ba1c3e4/";fetch(mp+"draco_decoder.js",{method:"head"}).catch(n=>{xe()&&console.warn('Failed to load draco decoder from "'+mp+`".
Falling back to local version at "./include/draco"`),mp="./include/draco/",V_="./include/ktx2/"});let xo,ob,hc;function kE(n){n!==void 0&&typeof n=="string"&&(xo||(xo=new by),vd&&console.log("Setting draco decoder path to",n),xo.setDecoderPath(n),n4(n))}function OE(n){n!==void 0&&typeof n=="string"&&(xo||(xo=new by),vd&&console.log("Setting draco decoder type to",n),xo.setDecoderConfig({type:n}))}function LE(n){n!==void 0&&typeof n=="string"&&(hc||(hc=new Jr),vd&&console.log("Setting ktx2 transcoder path to",n),hc.setTranscoderPath(n),s4(n))}function wy(n,t){return xo||(xo=new by,xo.setDecoderPath(mp),xo.setDecoderConfig({type:"js"}),vd&&console.log("Setting draco decoder path to",mp)),hc||(hc=new Jr,hc.setTranscoderPath(V_),vd&&console.log("Setting ktx2 transcoder path to",V_)),ob||(ob=_P,vd&&console.log("Using the default meshopt decoder")),t.renderer?hc.detectSupport(t.renderer):console.warn("No renderer provided to detect ktx2 support - loading KTX2 textures will probably fail"),n.dracoLoader||n.setDRACOLoader(xo),n.ktx2Loader||n.setKTX2Loader(hc),n.meshoptDecoder||n.setMeshoptDecoder(ob),n}/*!
fflate - fast JavaScript compression/decompression
<https://101arrowz.github.io/fflate>
Licensed under MIT. https://github.com/101arrowz/fflate/blob/master/LICENSE
version 0.6.9
*/var FE=function(n){return URL.createObjectURL(new Blob([n],{type:"text/javascript"}))};try{URL.revokeObjectURL(FE(""))}catch{FE=function(t){return"data:application/javascript;charset=UTF-8,"+encodeURI(t)}}var Fi=Uint8Array,Es=Uint16Array,Md=Uint32Array,xy=new Fi([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Cy=new Fi([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),W_=new Fi([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),zP=function(n,t){for(var e=new Es(31),i=0;i<31;++i)e[i]=t+=1<<n[i-1];for(var s=new Md(e[30]),i=1;i<30;++i)for(var r=e[i];r<e[i+1];++r)s[r]=r-e[i]<<5|i;return[e,s]},jP=zP(xy,2),GP=jP[0],q_=jP[1];GP[28]=258,q_[258]=28;var HP=zP(Cy,0),X4=HP[0],UE=HP[1],X_=new Es(32768);for(var Zt=0;Zt<32768;++Zt){var Gl=(Zt&43690)>>>1|(Zt&21845)<<1;Gl=(Gl&52428)>>>2|(Gl&13107)<<2,Gl=(Gl&61680)>>>4|(Gl&3855)<<4,X_[Zt]=((Gl&65280)>>>8|(Gl&255)<<8)>>>1}var Ma=function(n,t,e){for(var i=n.length,s=0,r=new Es(t);s<i;++s)++r[n[s]-1];var o=new Es(t);for(s=0;s<t;++s)o[s]=o[s-1]+r[s-1]<<1;var a;if(e){a=new Es(1<<t);var l=15-t;for(s=0;s<i;++s)if(n[s])for(var h=s<<4|n[s],u=t-n[s],d=o[n[s]-1]++<<u,f=d|(1<<u)-1;d<=f;++d)a[X_[d]>>>l]=h}else for(a=new Es(i),s=0;s<i;++s)n[s]&&(a[s]=X_[o[n[s]-1]++]>>>15-n[s]);return a},kc=new Fi(288);for(var Zt=0;Zt<144;++Zt)kc[Zt]=8;for(var Zt=144;Zt<256;++Zt)kc[Zt]=9;for(var Zt=256;Zt<280;++Zt)kc[Zt]=7;for(var Zt=280;Zt<288;++Zt)kc[Zt]=8;var fg=new Fi(32);for(var Zt=0;Zt<32;++Zt)fg[Zt]=5;var Y4=Ma(kc,9,0),K4=Ma(kc,9,1),J4=Ma(fg,5,0),Z4=Ma(fg,5,1),ab=function(n){for(var t=n[0],e=1;e<n.length;++e)n[e]>t&&(t=n[e]);return t},po=function(n,t,e){var i=t/8|0;return(n[i]|n[i+1]<<8)>>(t&7)&e},lb=function(n,t){var e=t/8|0;return(n[e]|n[e+1]<<8|n[e+2]<<16)>>(t&7)},qx=function(n){return(n/8|0)+(n&7&&1)},Xx=function(n,t,e){(t==null||t<0)&&(t=0),(e==null||e>n.length)&&(e=n.length);var i=new(n instanceof Es?Es:n instanceof Md?Md:Fi)(e-t);return i.set(n.subarray(t,e)),i},$4=function(n,t,e){var i=n.length;if(!i||e&&!e.l&&i<5)return t||new Fi(0);var s=!t||e,r=!e||e.i;e||(e={}),t||(t=new Fi(i*3));var o=function(Te){var We=t.length;if(Te>We){var It=new Fi(Math.max(We*2,Te));It.set(t),t=It}},a=e.f||0,l=e.p||0,h=e.b||0,u=e.l,d=e.d,f=e.m,p=e.n,g=i*8;do{if(!u){e.f=a=po(n,l,1);var m=po(n,l+1,3);if(l+=3,m)if(m==1)u=K4,d=Z4,f=9,p=5;else if(m==2){var _=po(n,l,31)+257,x=po(n,l+10,15)+4,S=_+po(n,l+5,31)+1;l+=14;for(var T=new Fi(S),L=new Fi(19),I=0;I<x;++I)L[W_[I]]=po(n,l+I*3,7);l+=x*3;for(var P=ab(L),R=(1<<P)-1,B=Ma(L,P,1),I=0;I<S;){var Q=B[po(n,l,R)];l+=Q&15;var v=Q>>>4;if(v<16)T[I++]=v;else{var G=0,V=0;for(v==16?(V=3+po(n,l,3),l+=2,G=T[I-1]):v==17?(V=3+po(n,l,7),l+=3):v==18&&(V=11+po(n,l,127),l+=7);V--;)T[I++]=G}}var X=T.subarray(0,_),k=T.subarray(_);f=ab(X),p=ab(k),u=Ma(X,f,1),d=Ma(k,p,1)}else throw"invalid block type";else{var v=qx(l)+4,y=n[v-4]|n[v-3]<<8,b=v+y;if(b>i){if(r)throw"unexpected EOF";break}s&&o(h+y),t.set(n.subarray(v,b),h),e.b=h+=y,e.p=l=b*8;continue}if(l>g){if(r)throw"unexpected EOF";break}}s&&o(h+131072);for(var M=(1<<f)-1,H=(1<<p)-1,ee=l;;ee=l){var G=u[lb(n,l)&M],Y=G>>>4;if(l+=G&15,l>g){if(r)throw"unexpected EOF";break}if(!G)throw"invalid length/literal";if(Y<256)t[h++]=Y;else if(Y==256){ee=l,u=null;break}else{var he=Y-254;if(Y>264){var I=Y-257,de=xy[I];he=po(n,l,(1<<de)-1)+GP[I],l+=de}var ve=d[lb(n,l)&H],_e=ve>>>4;if(!ve)throw"invalid distance";l+=ve&15;var k=X4[_e];if(_e>3){var de=Cy[_e];k+=lb(n,l)&(1<<de)-1,l+=de}if(l>g){if(r)throw"unexpected EOF";break}s&&o(h+131072);for(var Ge=h+he;h<Ge;h+=4)t[h]=t[h-k],t[h+1]=t[h+1-k],t[h+2]=t[h+2-k],t[h+3]=t[h+3-k];h=Ge}}e.l=u,e.p=ee,e.b=h,u&&(a=1,e.m=f,e.d=d,e.n=p)}while(!a);return h==t.length?t:Xx(t,0,h)},Ka=function(n,t,e){e<<=t&7;var i=t/8|0;n[i]|=e,n[i+1]|=e>>>8},Tf=function(n,t,e){e<<=t&7;var i=t/8|0;n[i]|=e,n[i+1]|=e>>>8,n[i+2]|=e>>>16},cb=function(n,t){for(var e=[],i=0;i<n.length;++i)n[i]&&e.push({s:i,f:n[i]});var s=e.length,r=e.slice();if(!s)return[Yx,0];if(s==1){var o=new Fi(e[0].s+1);return o[e[0].s]=1,[o,1]}e.sort(function(S,T){return S.f-T.f}),e.push({s:-1,f:25001});var a=e[0],l=e[1],h=0,u=1,d=2;for(e[0]={s:-1,f:a.f+l.f,l:a,r:l};u!=s-1;)a=e[e[h].f<e[d].f?h++:d++],l=e[h!=u&&e[h].f<e[d].f?h++:d++],e[u++]={s:-1,f:a.f+l.f,l:a,r:l};for(var f=r[0].s,i=1;i<s;++i)r[i].s>f&&(f=r[i].s);var p=new Es(f+1),g=Y_(e[u-1],p,0);if(g>t){var i=0,m=0,v=g-t,y=1<<v;for(r.sort(function(T,L){return p[L.s]-p[T.s]||T.f-L.f});i<s;++i){var b=r[i].s;if(p[b]>t)m+=y-(1<<g-p[b]),p[b]=t;else break}for(m>>>=v;m>0;){var _=r[i].s;p[_]<t?m-=1<<t-p[_]++-1:++i}for(;i>=0&&m;--i){var x=r[i].s;p[x]==t&&(--p[x],++m)}g=t}return[new Fi(p),g]},Y_=function(n,t,e){return n.s==-1?Math.max(Y_(n.l,t,e+1),Y_(n.r,t,e+1)):t[n.s]=e},NE=function(n){for(var t=n.length;t&&!n[--t];);for(var e=new Es(++t),i=0,s=n[0],r=1,o=function(l){e[i++]=l},a=1;a<=t;++a)if(n[a]==s&&a!=t)++r;else{if(!s&&r>2){for(;r>138;r-=138)o(32754);r>2&&(o(r>10?r-11<<5|28690:r-3<<5|12305),r=0)}else if(r>3){for(o(s),--r;r>6;r-=6)o(8304);r>2&&(o(r-3<<5|8208),r=0)}for(;r--;)o(s);r=1,s=n[a]}return[e.subarray(0,i),t]},Rf=function(n,t){for(var e=0,i=0;i<t.length;++i)e+=n[i]*t[i];return e},BA=function(n,t,e){var i=e.length,s=qx(t+2);n[s]=i&255,n[s+1]=i>>>8,n[s+2]=n[s]^255,n[s+3]=n[s+1]^255;for(var r=0;r<i;++r)n[s+r+4]=e[r];return(s+4+i)*8},QE=function(n,t,e,i,s,r,o,a,l,h,u){Ka(t,u++,e),++s[256];for(var d=cb(s,15),f=d[0],p=d[1],g=cb(r,15),m=g[0],v=g[1],y=NE(f),b=y[0],_=y[1],x=NE(m),S=x[0],T=x[1],L=new Es(19),I=0;I<b.length;++I)L[b[I]&31]++;for(var I=0;I<S.length;++I)L[S[I]&31]++;for(var P=cb(L,7),R=P[0],B=P[1],Q=19;Q>4&&!R[W_[Q-1]];--Q);var G=h+5<<3,V=Rf(s,kc)+Rf(r,fg)+o,X=Rf(s,f)+Rf(r,m)+o+14+3*Q+Rf(L,R)+(2*L[16]+3*L[17]+7*L[18]);if(G<=V&&G<=X)return BA(t,u,n.subarray(l,l+h));var k,M,H,ee;if(Ka(t,u,1+(X<V)),u+=2,X<V){k=Ma(f,p,0),M=f,H=Ma(m,v,0),ee=m;var Y=Ma(R,B,0);Ka(t,u,_-257),Ka(t,u+5,T-1),Ka(t,u+10,Q-4),u+=14;for(var I=0;I<Q;++I)Ka(t,u+3*I,R[W_[I]]);u+=3*Q;for(var he=[b,S],de=0;de<2;++de)for(var ve=he[de],I=0;I<ve.length;++I){var _e=ve[I]&31;Ka(t,u,Y[_e]),u+=R[_e],_e>15&&(Ka(t,u,ve[I]>>>5&127),u+=ve[I]>>>12)}}else k=Y4,M=kc,H=J4,ee=fg;for(var I=0;I<a;++I)if(i[I]>255){var _e=i[I]>>>18&31;Tf(t,u,k[_e+257]),u+=M[_e+257],_e>7&&(Ka(t,u,i[I]>>>23&31),u+=xy[_e]);var Ge=i[I]&31;Tf(t,u,H[Ge]),u+=ee[Ge],Ge>3&&(Tf(t,u,i[I]>>>5&8191),u+=Cy[Ge])}else Tf(t,u,k[i[I]]),u+=M[i[I]];return Tf(t,u,k[256]),u+M[256]},eQ=new Md([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),Yx=new Fi(0),tQ=function(n,t,e,i,s,r){var o=n.length,a=new Fi(i+o+5*(1+Math.ceil(o/7e3))+s),l=a.subarray(i,a.length-s),h=0;if(!t||o<8)for(var u=0;u<=o;u+=65535){var d=u+65535;d<o?h=BA(l,h,n.subarray(u,d)):(l[u]=r,h=BA(l,h,n.subarray(u,o)))}else{for(var f=eQ[t-1],p=f>>>13,g=f&8191,m=(1<<e)-1,v=new Es(32768),y=new Es(m+1),b=Math.ceil(e/3),_=2*b,x=function(Wn){return(n[Wn]^n[Wn+1]<<b^n[Wn+2]<<_)&m},S=new Md(25e3),T=new Es(288),L=new Es(32),I=0,P=0,u=0,R=0,B=0,Q=0;u<o;++u){var G=x(u),V=u&32767,X=y[G];if(v[V]=X,y[G]=V,B<=u){var k=o-u;if((I>7e3||R>24576)&&k>423){h=QE(n,l,0,S,T,L,P,R,Q,u-Q,h),R=I=P=0,Q=u;for(var M=0;M<286;++M)T[M]=0;for(var M=0;M<30;++M)L[M]=0}var H=2,ee=0,Y=g,he=V-X&32767;if(k>2&&G==x(u-he))for(var de=Math.min(p,k)-1,ve=Math.min(32767,u),_e=Math.min(258,k);he<=ve&&--Y&&V!=X;){if(n[u+H]==n[u+H-he]){for(var Ge=0;Ge<_e&&n[u+Ge]==n[u+Ge-he];++Ge);if(Ge>H){if(H=Ge,ee=he,Ge>de)break;for(var Te=Math.min(he,Ge-2),We=0,M=0;M<Te;++M){var It=u-he+M+32768&32767,_t=v[It],$t=It-_t+32768&32767;$t>We&&(We=$t,X=It)}}}V=X,X=v[V],he+=V-X+32768&32767}if(ee){S[R++]=268435456|q_[H]<<18|UE[ee];var yi=q_[H]&31,ds=UE[ee]&31;P+=xy[yi]+Cy[ds],++T[257+yi],++L[ds],B=u+H,++I}else S[R++]=n[u],++T[n[u]]}}h=QE(n,l,r,S,T,L,P,R,Q,u-Q,h),!r&&h&7&&(h=BA(l,h+1,Yx))}return Xx(a,0,i+qx(h)+s)},iQ=function(){for(var n=new Md(256),t=0;t<256;++t){for(var e=t,i=9;--i;)e=(e&1&&3988292384)^e>>>1;n[t]=e}return n}(),nQ=function(){var n=-1;return{p:function(t){for(var e=n,i=0;i<t.length;++i)e=iQ[e&255^t[i]]^e>>>8;n=e},d:function(){return~n}}},sQ=function(n,t,e,i,s){return tQ(n,t.level==null?6:t.level,t.mem==null?Math.ceil(Math.max(8,Math.min(13,Math.log(n.length)))*1.5):12+t.mem,e,i,!s)},VP=function(n,t){var e={};for(var i in n)e[i]=n[i];for(var i in t)e[i]=t[i];return e},Tn=function(n,t,e){for(;e;++t)n[t]=e,e>>>=8},rQ=function(n){if((n[0]&15)!=8||n[0]>>>4>7||(n[0]<<8|n[1])%31)throw"invalid zlib data";if(n[1]&32)throw"invalid zlib data: preset dictionaries not supported"};function oQ(n,t){return sQ(n,t||{},0,0)}function Zf(n,t){return $4((rQ(n),n.subarray(2,-4)),t)}var WP=function(n,t,e,i){for(var s in n){var r=n[s],o=t+s;r instanceof Fi?e[o]=[r,i]:Array.isArray(r)?e[o]=[r[0],VP(i,r[1])]:WP(r,o+"/",e,i)}},zE=typeof TextEncoder<"u"&&new TextEncoder,aQ=typeof TextDecoder<"u"&&new TextDecoder,lQ=0;try{aQ.decode(Yx,{stream:!0}),lQ=1}catch{}function hv(n,t){if(t){for(var e=new Fi(n.length),i=0;i<n.length;++i)e[i]=n.charCodeAt(i);return e}if(zE)return zE.encode(n);for(var s=n.length,r=new Fi(n.length+(n.length>>1)),o=0,a=function(u){r[o++]=u},i=0;i<s;++i){if(o+5>r.length){var l=new Fi(o+8+(s-i<<1));l.set(r),r=l}var h=n.charCodeAt(i);h<128||t?a(h):h<2048?(a(192|h>>6),a(128|h&63)):h>55295&&h<57344?(h=65536+(h&1047552)|n.charCodeAt(++i)&1023,a(240|h>>18),a(128|h>>12&63),a(128|h>>6&63),a(128|h&63)):(a(224|h>>12),a(128|h>>6&63),a(128|h&63))}return Xx(r,0,o)}var K_=function(n){var t=0;if(n)for(var e in n){var i=n[e].length;if(i>65535)throw"extra field too long";t+=i+4}return t},jE=function(n,t,e,i,s,r,o,a){var l=i.length,h=e.extra,u=a&&a.length,d=K_(h);Tn(n,t,o!=null?33639248:67324752),t+=4,o!=null&&(n[t++]=20,n[t++]=e.os),n[t]=20,t+=2,n[t++]=e.flag<<1|(r==null&&8),n[t++]=s&&8,n[t++]=e.compression&255,n[t++]=e.compression>>8;var f=new Date(e.mtime==null?Date.now():e.mtime),p=f.getFullYear()-1980;if(p<0||p>119)throw"date not in range 1980-2099";if(Tn(n,t,p<<25|f.getMonth()+1<<21|f.getDate()<<16|f.getHours()<<11|f.getMinutes()<<5|f.getSeconds()>>>1),t+=4,r!=null&&(Tn(n,t,e.crc),Tn(n,t+4,r),Tn(n,t+8,e.size)),Tn(n,t+12,l),Tn(n,t+14,d),t+=16,o!=null&&(Tn(n,t,u),Tn(n,t+6,e.attrs),Tn(n,t+10,o),t+=14),n.set(i,t),t+=l,d)for(var g in h){var m=h[g],v=m.length;Tn(n,t,+g),Tn(n,t+2,v),n.set(m,t+4),t+=4+v}return u&&(n.set(a,t),t+=u),t},cQ=function(n,t,e,i,s){Tn(n,t,101010256),Tn(n,t+8,e),Tn(n,t+10,e),Tn(n,t+12,i),Tn(n,t+16,s)};function hQ(n,t){t||(t={});var e={},i=[];WP(n,"",e,t);var s=0,r=0;for(var o in e){var a=e[o],l=a[0],h=a[1],u=h.level==0?0:8,d=hv(o),f=d.length,p=h.comment,g=p&&hv(p),m=g&&g.length,v=K_(h.extra);if(f>65535)throw"filename too long";var y=u?oQ(l,h):l,b=y.length,_=nQ();_.p(l),i.push(VP(h,{size:l.length,crc:_.d(),c:y,f:d,m:g,u:f!=o.length||g&&p.length!=m,o:s,compression:u})),s+=30+f+v+b,r+=76+2*(f+v)+(m||0)+b}for(var x=new Fi(r+22),S=s,T=r-s,L=0;L<i.length;++L){var d=i[L];jE(x,d.o,d,d.f,d.u,d.c.length);var I=30+d.f.length+K_(d.extra);x.set(d.c,d.o+I),jE(x,s,d,d.f,d.u,d.c.length,d.o,d.m),s+=16+I+(d.m?d.m.length:0)}return cQ(x,s,i.length,T,S),x}function qP(n,t,e){const i=e.length-n-1;if(t>=e[i])return i-1;if(t<=e[n])return n;let s=n,r=i,o=Math.floor((s+r)/2);for(;t<e[o]||t>=e[o+1];)t<e[o]?r=o:s=o,o=Math.floor((s+r)/2);return o}function uQ(n,t,e,i){const s=[],r=[],o=[];s[0]=1;for(let a=1;a<=e;++a){r[a]=t-i[n+1-a],o[a]=i[n+a]-t;let l=0;for(let h=0;h<a;++h){const u=o[h+1],d=r[a-h],f=s[h]/(u+d);s[h]=l+u*f,l=d*f}s[a]=l}return s}function dQ(n,t,e,i){const s=qP(n,i,t),r=uQ(s,i,n,t),o=new ke(0,0,0,0);for(let a=0;a<=n;++a){const l=e[s-n+a],h=r[a],u=l.w*h;o.x+=l.x*u,o.y+=l.y*u,o.z+=l.z*u,o.w+=l.w*h}return o}function fQ(n,t,e,i,s){const r=[];for(let d=0;d<=e;++d)r[d]=0;const o=[];for(let d=0;d<=i;++d)o[d]=r.slice(0);const a=[];for(let d=0;d<=e;++d)a[d]=r.slice(0);a[0][0]=1;const l=r.slice(0),h=r.slice(0);for(let d=1;d<=e;++d){l[d]=t-s[n+1-d],h[d]=s[n+d]-t;let f=0;for(let p=0;p<d;++p){const g=h[p+1],m=l[d-p];a[d][p]=g+m;const v=a[p][d-1]/a[d][p];a[p][d]=f+g*v,f=m*v}a[d][d]=f}for(let d=0;d<=e;++d)o[0][d]=a[d][e];for(let d=0;d<=e;++d){let f=0,p=1;const g=[];for(let m=0;m<=e;++m)g[m]=r.slice(0);g[0][0]=1;for(let m=1;m<=i;++m){let v=0;const y=d-m,b=e-m;d>=m&&(g[p][0]=g[f][0]/a[b+1][y],v=g[p][0]*a[y][b]);const _=y>=-1?1:-y,x=d-1<=b?m-1:e-d;for(let T=_;T<=x;++T)g[p][T]=(g[f][T]-g[f][T-1])/a[b+1][y+T],v+=g[p][T]*a[y+T][b];d<=b&&(g[p][m]=-g[f][m-1]/a[b+1][d],v+=g[p][m]*a[d][b]),o[m][d]=v;const S=f;f=p,p=S}}let u=e;for(let d=1;d<=i;++d){for(let f=0;f<=e;++f)o[d][f]*=u;u*=e-d}return o}function pQ(n,t,e,i,s){const r=s<n?s:n,o=[],a=qP(n,i,t),l=fQ(a,i,n,r,t),h=[];for(let u=0;u<e.length;++u){const d=e[u].clone(),f=d.w;d.x*=f,d.y*=f,d.z*=f,h[u]=d}for(let u=0;u<=r;++u){const d=h[a-n].clone().multiplyScalar(l[u][0]);for(let f=1;f<=n;++f)d.add(h[a-n+f].clone().multiplyScalar(l[u][f]));o[u]=d}for(let u=r+1;u<=s+1;++u)o[u]=new ke(0,0,0);return o}function gQ(n,t){let e=1;for(let s=2;s<=n;++s)e*=s;let i=1;for(let s=2;s<=t;++s)i*=s;for(let s=2;s<=n-t;++s)i*=s;return e/i}function mQ(n){const t=n.length,e=[],i=[];for(let r=0;r<t;++r){const o=n[r];e[r]=new C(o.x,o.y,o.z),i[r]=o.w}const s=[];for(let r=0;r<t;++r){const o=e[r].clone();for(let a=1;a<=r;++a)o.sub(s[r-a].clone().multiplyScalar(gQ(r,a)*i[a]));s[r]=o.divideScalar(i[0])}return s}function AQ(n,t,e,i,s){const r=pQ(n,t,e,i,s);return mQ(r)}class vQ extends r2{constructor(t,e,i,s,r){super(),this.degree=t,this.knots=e,this.controlPoints=[],this.startKnot=s||0,this.endKnot=r||this.knots.length-1;for(let o=0;o<i.length;++o){const a=i[o];this.controlPoints[o]=new ke(a.x,a.y,a.z,a.w)}}getPoint(t,e=new C){const i=e,s=this.knots[this.startKnot]+t*(this.knots[this.endKnot]-this.knots[this.startKnot]),r=dQ(this.degree,this.knots,this.controlPoints,s);return r.w!==1&&r.divideScalar(r.w),i.set(r.x,r.y,r.z)}getTangent(t,e=new C){const i=e,s=this.knots[0]+t*(this.knots[this.knots.length-1]-this.knots[0]),r=AQ(this.degree,this.knots,this.controlPoints,s,1);return i.copy(r[1]).normalize(),i}}let et,Ri,ws;class yQ extends Lh{constructor(t){super(t)}load(t,e,i,s){const r=this,o=r.path===""?pd.extractUrlBase(t):r.path,a=new Zr(this.manager);a.setPath(r.path),a.setResponseType("arraybuffer"),a.setRequestHeader(r.requestHeader),a.setWithCredentials(r.withCredentials),a.load(t,function(l){try{e(r.parse(l,o))}catch(h){s?s(h):console.error(h),r.manager.itemError(t)}},i,s)}parse(t,e){if(SQ(t))et=new CQ().parse(t);else{const s=JP(t);if(!EQ(s))throw new Error("THREE.FBXLoader: Unknown format.");if(HE(s)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+HE(s));et=new xQ().parse(s)}const i=new Ra(this.manager).setPath(this.resourcePath||e).setCrossOrigin(this.crossOrigin);return new bQ(i,this.manager).parse(et)}}class bQ{constructor(t,e){this.textureLoader=t,this.manager=e}parse(){Ri=this.parseConnections();const t=this.parseImages(),e=this.parseTextures(t),i=this.parseMaterials(e),s=this.parseDeformers(),r=new _Q().parse(s);return this.parseScene(s,r,i),ws}parseConnections(){const t=new Map;return"Connections"in et&&et.Connections.connections.forEach(function(i){const s=i[0],r=i[1],o=i[2];t.has(s)||t.set(s,{parents:[],children:[]});const a={ID:r,relationship:o};t.get(s).parents.push(a),t.has(r)||t.set(r,{parents:[],children:[]});const l={ID:s,relationship:o};t.get(r).children.push(l)}),t}parseImages(){const t={},e={};if("Video"in et.Objects){const i=et.Objects.Video;for(const s in i){const r=i[s],o=parseInt(s);if(t[o]=r.RelativeFilename||r.Filename,"Content"in r){const a=r.Content instanceof ArrayBuffer&&r.Content.byteLength>0,l=typeof r.Content=="string"&&r.Content!=="";if(a||l){const h=this.parseImage(i[s]);e[r.RelativeFilename||r.Filename]=h}}}}for(const i in t){const s=t[i];e[s]!==void 0?t[i]=e[s]:t[i]=t[i].split("\\").pop()}return t}parseImage(t){const e=t.Content,i=t.RelativeFilename||t.Filename,s=i.slice(i.lastIndexOf(".")+1).toLowerCase();let r;switch(s){case"bmp":r="image/bmp";break;case"jpg":case"jpeg":r="image/jpeg";break;case"png":r="image/png";break;case"tif":r="image/tiff";break;case"tga":this.manager.getHandler(".tga")===null&&console.warn("FBXLoader: TGA loader not found, skipping ",i),r="image/tga";break;default:console.warn('FBXLoader: Image type "'+s+'" is not supported.');return}if(typeof e=="string")return"data:"+r+";base64,"+e;{const o=new Uint8Array(e);return window.URL.createObjectURL(new Blob([o],{type:r}))}}parseTextures(t){const e=new Map;if("Texture"in et.Objects){const i=et.Objects.Texture;for(const s in i){const r=this.parseTexture(i[s],t);e.set(parseInt(s),r)}}return e}parseTexture(t,e){const i=this.loadTexture(t,e);i.ID=t.id,i.name=t.attrName;const s=t.WrapModeU,r=t.WrapModeV,o=s!==void 0?s.value:0,a=r!==void 0?r.value:0;if(i.wrapS=o===0?Sl:ZA,i.wrapT=a===0?Sl:ZA,"Scaling"in t){const l=t.Scaling.value;i.repeat.x=l[0],i.repeat.y=l[1]}if("Translation"in t){const l=t.Translation.value;i.offset.x=l[0],i.offset.y=l[1]}return i}loadTexture(t,e){let i;const s=this.textureLoader.path,r=Ri.get(t.id).children;r!==void 0&&r.length>0&&e[r[0].ID]!==void 0&&(i=e[r[0].ID],(i.indexOf("blob:")===0||i.indexOf("data:")===0)&&this.textureLoader.setPath(void 0));let o;const a=t.FileName.slice(-3).toLowerCase();if(a==="tga"){const l=this.manager.getHandler(".tga");l===null?(console.warn("FBXLoader: TGA loader not found, creating placeholder texture for",t.RelativeFilename),o=new pt):(l.setPath(this.textureLoader.path),o=l.load(i))}else if(a==="dds"){const l=this.manager.getHandler(".dds");l===null?(console.warn("FBXLoader: DDS loader not found, creating placeholder texture for",t.RelativeFilename),o=new pt):(l.setPath(this.textureLoader.path),o=l.load(i))}else a==="psd"?(console.warn("FBXLoader: PSD textures are not supported, creating placeholder texture for",t.RelativeFilename),o=new pt):o=this.textureLoader.load(i);return this.textureLoader.setPath(s),o}parseMaterials(t){const e=new Map;if("Material"in et.Objects){const i=et.Objects.Material;for(const s in i){const r=this.parseMaterial(i[s],t);r!==null&&e.set(parseInt(s),r)}}return e}parseMaterial(t,e){const i=t.id,s=t.attrName;let r=t.ShadingModel;if(typeof r=="object"&&(r=r.value),!Ri.has(i))return null;const o=this.parseParameters(t,e,i);let a;switch(r.toLowerCase()){case"phong":a=new up;break;case"lambert":a=new o2;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',r),a=new up;break}return a.setValues(o),a.name=s,a}parseParameters(t,e,i){const s={};t.BumpFactor&&(s.bumpScale=t.BumpFactor.value),t.Diffuse?s.color=new we().fromArray(t.Diffuse.value).convertSRGBToLinear():t.DiffuseColor&&(t.DiffuseColor.type==="Color"||t.DiffuseColor.type==="ColorRGB")&&(s.color=new we().fromArray(t.DiffuseColor.value).convertSRGBToLinear()),t.DisplacementFactor&&(s.displacementScale=t.DisplacementFactor.value),t.Emissive?s.emissive=new we().fromArray(t.Emissive.value).convertSRGBToLinear():t.EmissiveColor&&(t.EmissiveColor.type==="Color"||t.EmissiveColor.type==="ColorRGB")&&(s.emissive=new we().fromArray(t.EmissiveColor.value).convertSRGBToLinear()),t.EmissiveFactor&&(s.emissiveIntensity=parseFloat(t.EmissiveFactor.value)),t.Opacity&&(s.opacity=parseFloat(t.Opacity.value)),s.opacity<1&&(s.transparent=!0),t.ReflectionFactor&&(s.reflectivity=t.ReflectionFactor.value),t.Shininess&&(s.shininess=t.Shininess.value),t.Specular?s.specular=new we().fromArray(t.Specular.value).convertSRGBToLinear():t.SpecularColor&&t.SpecularColor.type==="Color"&&(s.specular=new we().fromArray(t.SpecularColor.value).convertSRGBToLinear());const r=this;return Ri.get(i).children.forEach(function(o){const a=o.relationship;switch(a){case"Bump":s.bumpMap=r.getTexture(e,o.ID);break;case"Maya|TEX_ao_map":s.aoMap=r.getTexture(e,o.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":s.map=r.getTexture(e,o.ID),s.map!==void 0&&(s.map.colorSpace=Ue);break;case"DisplacementColor":s.displacementMap=r.getTexture(e,o.ID);break;case"EmissiveColor":s.emissiveMap=r.getTexture(e,o.ID),s.emissiveMap!==void 0&&(s.emissiveMap.colorSpace=Ue);break;case"NormalMap":case"Maya|TEX_normal_map":s.normalMap=r.getTexture(e,o.ID);break;case"ReflectionColor":s.envMap=r.getTexture(e,o.ID),s.envMap!==void 0&&(s.envMap.mapping=wc,s.envMap.colorSpace=Ue);break;case"SpecularColor":s.specularMap=r.getTexture(e,o.ID),s.specularMap!==void 0&&(s.specularMap.colorSpace=Ue);break;case"TransparentColor":case"TransparencyFactor":s.alphaMap=r.getTexture(e,o.ID),s.transparent=!0;break;case"AmbientColor":case"ShininessExponent":case"SpecularFactor":case"VectorDisplacementColor":default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",a);break}}),s}getTexture(t,e){return"LayeredTexture"in et.Objects&&e in et.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),e=Ri.get(e).children[0].ID),t.get(e)}parseDeformers(){const t={},e={};if("Deformer"in et.Objects){const i=et.Objects.Deformer;for(const s in i){const r=i[s],o=Ri.get(parseInt(s));if(r.attrType==="Skin"){const a=this.parseSkeleton(o,i);a.ID=s,o.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),a.geometryID=o.parents[0].ID,t[s]=a}else if(r.attrType==="BlendShape"){const a={id:s};a.rawTargets=this.parseMorphTargets(o,i),a.id=s,o.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),e[s]=a}}}return{skeletons:t,morphTargets:e}}parseSkeleton(t,e){const i=[];return t.children.forEach(function(s){const r=e[s.ID];if(r.attrType!=="Cluster")return;const o={ID:s.ID,indices:[],weights:[],transformLink:new ce().fromArray(r.TransformLink.a)};"Indexes"in r&&(o.indices=r.Indexes.a,o.weights=r.Weights.a),i.push(o)}),{rawBones:i,bones:[]}}parseMorphTargets(t,e){const i=[];for(let s=0;s<t.children.length;s++){const r=t.children[s],o=e[r.ID],a={name:o.attrName,initialWeight:o.DeformPercent,id:o.id,fullWeights:o.FullWeights.a};if(o.attrType!=="BlendShapeChannel")return;a.geoID=Ri.get(parseInt(r.ID)).children.filter(function(l){return l.relationship===void 0})[0].ID,i.push(a)}return i}parseScene(t,e,i){ws=new To;const s=this.parseModels(t.skeletons,e,i),r=et.Objects.Model,o=this;s.forEach(function(l){const h=r[l.ID];o.setLookAtProperties(l,h),Ri.get(l.ID).parents.forEach(function(d){const f=s.get(d.ID);f!==void 0&&f.add(l)}),l.parent===null&&ws.add(l)}),this.bindSkeleton(t.skeletons,e,s),this.addGlobalSceneSettings(),ws.traverse(function(l){if(l.userData.transformData){l.parent&&(l.userData.transformData.parentMatrix=l.parent.matrix,l.userData.transformData.parentMatrixWorld=l.parent.matrixWorld);const h=YP(l.userData.transformData);l.applyMatrix4(h),l.updateWorldMatrix()}});const a=new wQ().parse();ws.children.length===1&&ws.children[0].isGroup&&(ws.children[0].animations=a,ws=ws.children[0]),ws.animations=a}parseModels(t,e,i){const s=new Map,r=et.Objects.Model;for(const o in r){const a=parseInt(o),l=r[o],h=Ri.get(a);let u=this.buildSkeleton(h,t,a,l.attrName);if(!u){switch(l.attrType){case"Camera":u=this.createCamera(h);break;case"Light":u=this.createLight(h);break;case"Mesh":u=this.createMesh(h,e,i);break;case"NurbsCurve":u=this.createCurve(h,e);break;case"LimbNode":case"Root":u=new JA;break;case"Null":default:u=new To;break}u.name=l.attrName?vr.sanitizeNodeName(l.attrName):"",u.userData.originalName=l.attrName,u.ID=a}this.getTransformData(u,l),s.set(a,u)}return s}buildSkeleton(t,e,i,s){let r=null;return t.parents.forEach(function(o){for(const a in e){const l=e[a];l.rawBones.forEach(function(h,u){if(h.ID===o.ID){const d=r;r=new JA,r.matrixWorld.copy(h.transformLink),r.name=s?vr.sanitizeNodeName(s):"",r.userData.originalName=s,r.ID=i,l.bones[u]=r,d!==null&&r.add(d)}})}}),r}createCamera(t){let e,i;if(t.children.forEach(function(s){const r=et.Objects.NodeAttribute[s.ID];r!==void 0&&(i=r)}),i===void 0)e=new re;else{let s=0;i.CameraProjectionType!==void 0&&i.CameraProjectionType.value===1&&(s=1);let r=1;i.NearPlane!==void 0&&(r=i.NearPlane.value/1e3);let o=1e3;i.FarPlane!==void 0&&(o=i.FarPlane.value/1e3);let a=window.innerWidth,l=window.innerHeight;i.AspectWidth!==void 0&&i.AspectHeight!==void 0&&(a=i.AspectWidth.value,l=i.AspectHeight.value);const h=a/l;let u=45;i.FieldOfView!==void 0&&(u=i.FieldOfView.value);const d=i.FocalLength?i.FocalLength.value:null;switch(s){case 0:e=new xt(u,h,r,o),d!==null&&e.setFocalLength(d);break;case 1:e=new Vh(-a/2,a/2,l/2,-l/2,r,o);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+s+"."),e=new re;break}}return e}createLight(t){let e,i;if(t.children.forEach(function(s){const r=et.Objects.NodeAttribute[s.ID];r!==void 0&&(i=r)}),i===void 0)e=new re;else{let s;i.LightType===void 0?s=0:s=i.LightType.value;let r=16777215;i.Color!==void 0&&(r=new we().fromArray(i.Color.value).convertSRGBToLinear());let o=i.Intensity===void 0?1:i.Intensity.value/100;i.CastLightOnObject!==void 0&&i.CastLightOnObject.value===0&&(o=0);let a=0;i.FarAttenuationEnd!==void 0&&(i.EnableFarAttenuation!==void 0&&i.EnableFarAttenuation.value===0?a=0:a=i.FarAttenuationEnd.value);const l=1;switch(s){case 0:e=new $p(r,o,a,l);break;case 1:e=new eg(r,o);break;case 2:let h=Math.PI/3;i.InnerAngle!==void 0&&(h=vt.degToRad(i.InnerAngle.value));let u=0;i.OuterAngle!==void 0&&(u=vt.degToRad(i.OuterAngle.value),u=Math.max(u,1)),e=new hx(r,o,a,h,u,l);break;default:console.warn("THREE.FBXLoader: Unknown light type "+i.LightType.value+", defaulting to a PointLight."),e=new $p(r,o);break}i.CastShadows!==void 0&&i.CastShadows.value===1&&(e.castShadow=!0)}return e}createMesh(t,e,i){let s,r=null,o=null;const a=[];return t.children.forEach(function(l){e.has(l.ID)&&(r=e.get(l.ID)),i.has(l.ID)&&a.push(i.get(l.ID))}),a.length>1?o=a:a.length>0?o=a[0]:(o=new up({name:Lh.DEFAULT_MATERIAL_NAME,color:13421772}),a.push(o)),"color"in r.attributes&&a.forEach(function(l){l.vertexColors=!0}),r.FBX_Deformer?(s=new Io(r,o),s.normalizeSkinWeights()):s=new J(r,o),s}createCurve(t,e){const i=t.children.reduce(function(r,o){return e.has(o.ID)&&(r=e.get(o.ID)),r},null),s=new Ba({name:Lh.DEFAULT_MATERIAL_NAME,color:3342591,linewidth:1});return new Hs(i,s)}getTransformData(t,e){const i={};"InheritType"in e&&(i.inheritType=parseInt(e.InheritType.value)),"RotationOrder"in e?i.eulerOrder=KP(e.RotationOrder.value):i.eulerOrder="ZYX","Lcl_Translation"in e&&(i.translation=e.Lcl_Translation.value),"PreRotation"in e&&(i.preRotation=e.PreRotation.value),"Lcl_Rotation"in e&&(i.rotation=e.Lcl_Rotation.value),"PostRotation"in e&&(i.postRotation=e.PostRotation.value),"Lcl_Scaling"in e&&(i.scale=e.Lcl_Scaling.value),"ScalingOffset"in e&&(i.scalingOffset=e.ScalingOffset.value),"ScalingPivot"in e&&(i.scalingPivot=e.ScalingPivot.value),"RotationOffset"in e&&(i.rotationOffset=e.RotationOffset.value),"RotationPivot"in e&&(i.rotationPivot=e.RotationPivot.value),t.userData.transformData=i}setLookAtProperties(t,e){"LookAtProperty"in e&&Ri.get(t.ID).children.forEach(function(s){if(s.relationship==="LookAtProperty"){const r=et.Objects.Model[s.ID];if("Lcl_Translation"in r){const o=r.Lcl_Translation.value;t.target!==void 0?(t.target.position.fromArray(o),ws.add(t.target)):t.lookAt(new C().fromArray(o))}}})}bindSkeleton(t,e,i){const s=this.parsePoseNodes();for(const r in t){const o=t[r];Ri.get(parseInt(o.ID)).parents.forEach(function(l){if(e.has(l.ID)){const h=l.ID;Ri.get(h).parents.forEach(function(d){i.has(d.ID)&&i.get(d.ID).bind(new ux(o.bones),s[d.ID])})}})}}parsePoseNodes(){const t={};if("Pose"in et.Objects){const e=et.Objects.Pose;for(const i in e)if(e[i].attrType==="BindPose"&&e[i].NbPoseNodes>0){const s=e[i].PoseNode;Array.isArray(s)?s.forEach(function(r){t[r.Node]=new ce().fromArray(r.Matrix.a)}):t[s.Node]=new ce().fromArray(s.Matrix.a)}}return t}addGlobalSceneSettings(){if("GlobalSettings"in et){if("AmbientColor"in et.GlobalSettings){const t=et.GlobalSettings.AmbientColor.value,e=t[0],i=t[1],s=t[2];if(e!==0||i!==0||s!==0){const r=new we(e,i,s).convertSRGBToLinear();ws.add(new OR(r,1))}}"UnitScaleFactor"in et.GlobalSettings&&(ws.userData.unitScaleFactor=et.GlobalSettings.UnitScaleFactor.value)}}}class _Q{constructor(){this.negativeMaterialIndices=!1}parse(t){const e=new Map;if("Geometry"in et.Objects){const i=et.Objects.Geometry;for(const s in i){const r=Ri.get(parseInt(s)),o=this.parseGeometry(r,i[s],t);e.set(parseInt(s),o)}}return this.negativeMaterialIndices===!0&&console.warn("THREE.FBXLoader: The FBX file contains invalid (negative) material indices. The asset might not render as expected."),e}parseGeometry(t,e,i){switch(e.attrType){case"Mesh":return this.parseMeshGeometry(t,e,i);case"NurbsCurve":return this.parseNurbsGeometry(e)}}parseMeshGeometry(t,e,i){const s=i.skeletons,r=[],o=t.parents.map(function(d){return et.Objects.Model[d.ID]});if(o.length===0)return;const a=t.children.reduce(function(d,f){return s[f.ID]!==void 0&&(d=s[f.ID]),d},null);t.children.forEach(function(d){i.morphTargets[d.ID]!==void 0&&r.push(i.morphTargets[d.ID])});const l=o[0],h={};"RotationOrder"in l&&(h.eulerOrder=KP(l.RotationOrder.value)),"InheritType"in l&&(h.inheritType=parseInt(l.InheritType.value)),"GeometricTranslation"in l&&(h.translation=l.GeometricTranslation.value),"GeometricRotation"in l&&(h.rotation=l.GeometricRotation.value),"GeometricScaling"in l&&(h.scale=l.GeometricScaling.value);const u=YP(h);return this.genGeometry(e,a,r,u)}genGeometry(t,e,i,s){const r=new jt;t.attrName&&(r.name=t.attrName);const o=this.parseGeoNode(t,e),a=this.genBuffers(o),l=new hn(a.vertex,3);if(l.applyMatrix4(s),r.setAttribute("position",l),a.colors.length>0&&r.setAttribute("color",new hn(a.colors,3)),e&&(r.setAttribute("skinIndex",new a2(a.weightsIndices,4)),r.setAttribute("skinWeight",new hn(a.vertexWeights,4)),r.FBX_Deformer=e),a.normal.length>0){const h=new gc().getNormalMatrix(s),u=new hn(a.normal,3);u.applyNormalMatrix(h),r.setAttribute("normal",u)}if(a.uvs.forEach(function(h,u){const d=u===0?"uv":`uv${u}`;r.setAttribute(d,new hn(a.uvs[u],2))}),o.material&&o.material.mappingType!=="AllSame"){let h=a.materialIndex[0],u=0;if(a.materialIndex.forEach(function(d,f){d!==h&&(r.addGroup(u,f-u,h),h=d,u=f)}),r.groups.length>0){const d=r.groups[r.groups.length-1],f=d.start+d.count;f!==a.materialIndex.length&&r.addGroup(f,a.materialIndex.length-f,h)}r.groups.length===0&&r.addGroup(0,a.materialIndex.length,a.materialIndex[0])}return this.addMorphTargets(r,t,i,s),r}parseGeoNode(t,e){const i={};if(i.vertexPositions=t.Vertices!==void 0?t.Vertices.a:[],i.vertexIndices=t.PolygonVertexIndex!==void 0?t.PolygonVertexIndex.a:[],t.LayerElementColor&&(i.color=this.parseVertexColors(t.LayerElementColor[0])),t.LayerElementMaterial&&(i.material=this.parseMaterialIndices(t.LayerElementMaterial[0])),t.LayerElementNormal&&(i.normal=this.parseNormals(t.LayerElementNormal[0])),t.LayerElementUV){i.uv=[];let s=0;for(;t.LayerElementUV[s];)t.LayerElementUV[s].UV&&i.uv.push(this.parseUVs(t.LayerElementUV[s])),s++}return i.weightTable={},e!==null&&(i.skeleton=e,e.rawBones.forEach(function(s,r){s.indices.forEach(function(o,a){i.weightTable[o]===void 0&&(i.weightTable[o]=[]),i.weightTable[o].push({id:r,weight:s.weights[a]})})})),i}genBuffers(t){const e={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]};let i=0,s=0,r=!1,o=[],a=[],l=[],h=[],u=[],d=[];const f=this;return t.vertexIndices.forEach(function(p,g){let m,v=!1;p<0&&(p=p^-1,v=!0);let y=[],b=[];if(o.push(p*3,p*3+1,p*3+2),t.color){const _=Cm(g,i,p,t.color);l.push(_[0],_[1],_[2])}if(t.skeleton){if(t.weightTable[p]!==void 0&&t.weightTable[p].forEach(function(_){b.push(_.weight),y.push(_.id)}),b.length>4){r||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),r=!0);const _=[0,0,0,0],x=[0,0,0,0];b.forEach(function(S,T){let L=S,I=y[T];x.forEach(function(P,R,B){if(L>P){B[R]=L,L=P;const Q=_[R];_[R]=I,I=Q}})}),y=_,b=x}for(;b.length<4;)b.push(0),y.push(0);for(let _=0;_<4;++_)u.push(b[_]),d.push(y[_])}if(t.normal){const _=Cm(g,i,p,t.normal);a.push(_[0],_[1],_[2])}t.material&&t.material.mappingType!=="AllSame"&&(m=Cm(g,i,p,t.material)[0],m<0&&(f.negativeMaterialIndices=!0,m=0)),t.uv&&t.uv.forEach(function(_,x){const S=Cm(g,i,p,_);h[x]===void 0&&(h[x]=[]),h[x].push(S[0]),h[x].push(S[1])}),s++,v&&(f.genFace(e,t,o,m,a,l,h,u,d,s),i++,s=0,o=[],a=[],l=[],h=[],u=[],d=[])}),e}getNormalNewell(t){const e=new C(0,0,0);for(let i=0;i<t.length;i++){const s=t[i],r=t[(i+1)%t.length];e.x+=(s.y-r.y)*(s.z+r.z),e.y+=(s.z-r.z)*(s.x+r.x),e.z+=(s.x-r.x)*(s.y+r.y)}return e.normalize(),e}getNormalTangentAndBitangent(t){const e=this.getNormalNewell(t),s=(Math.abs(e.z)>.5?new C(0,1,0):new C(0,0,1)).cross(e).normalize(),r=e.clone().cross(s).normalize();return{normal:e,tangent:s,bitangent:r}}flattenVertex(t,e,i){return new ae(t.dot(e),t.dot(i))}genFace(t,e,i,s,r,o,a,l,h,u){let d;if(u>3){const f=[];for(let v=0;v<i.length;v+=3)f.push(new C(e.vertexPositions[i[v]],e.vertexPositions[i[v+1]],e.vertexPositions[i[v+2]]));const{tangent:p,bitangent:g}=this.getNormalTangentAndBitangent(f),m=[];for(const v of f)m.push(this.flattenVertex(v,p,g));d=l2.triangulateShape(m,[])}else d=[[0,1,2]];for(const[f,p,g]of d)t.vertex.push(e.vertexPositions[i[f*3]]),t.vertex.push(e.vertexPositions[i[f*3+1]]),t.vertex.push(e.vertexPositions[i[f*3+2]]),t.vertex.push(e.vertexPositions[i[p*3]]),t.vertex.push(e.vertexPositions[i[p*3+1]]),t.vertex.push(e.vertexPositions[i[p*3+2]]),t.vertex.push(e.vertexPositions[i[g*3]]),t.vertex.push(e.vertexPositions[i[g*3+1]]),t.vertex.push(e.vertexPositions[i[g*3+2]]),e.skeleton&&(t.vertexWeights.push(l[f*4]),t.vertexWeights.push(l[f*4+1]),t.vertexWeights.push(l[f*4+2]),t.vertexWeights.push(l[f*4+3]),t.vertexWeights.push(l[p*4]),t.vertexWeights.push(l[p*4+1]),t.vertexWeights.push(l[p*4+2]),t.vertexWeights.push(l[p*4+3]),t.vertexWeights.push(l[g*4]),t.vertexWeights.push(l[g*4+1]),t.vertexWeights.push(l[g*4+2]),t.vertexWeights.push(l[g*4+3]),t.weightsIndices.push(h[f*4]),t.weightsIndices.push(h[f*4+1]),t.weightsIndices.push(h[f*4+2]),t.weightsIndices.push(h[f*4+3]),t.weightsIndices.push(h[p*4]),t.weightsIndices.push(h[p*4+1]),t.weightsIndices.push(h[p*4+2]),t.weightsIndices.push(h[p*4+3]),t.weightsIndices.push(h[g*4]),t.weightsIndices.push(h[g*4+1]),t.weightsIndices.push(h[g*4+2]),t.weightsIndices.push(h[g*4+3])),e.color&&(t.colors.push(o[f*3]),t.colors.push(o[f*3+1]),t.colors.push(o[f*3+2]),t.colors.push(o[p*3]),t.colors.push(o[p*3+1]),t.colors.push(o[p*3+2]),t.colors.push(o[g*3]),t.colors.push(o[g*3+1]),t.colors.push(o[g*3+2])),e.material&&e.material.mappingType!=="AllSame"&&(t.materialIndex.push(s),t.materialIndex.push(s),t.materialIndex.push(s)),e.normal&&(t.normal.push(r[f*3]),t.normal.push(r[f*3+1]),t.normal.push(r[f*3+2]),t.normal.push(r[p*3]),t.normal.push(r[p*3+1]),t.normal.push(r[p*3+2]),t.normal.push(r[g*3]),t.normal.push(r[g*3+1]),t.normal.push(r[g*3+2])),e.uv&&e.uv.forEach(function(m,v){t.uvs[v]===void 0&&(t.uvs[v]=[]),t.uvs[v].push(a[v][f*2]),t.uvs[v].push(a[v][f*2+1]),t.uvs[v].push(a[v][p*2]),t.uvs[v].push(a[v][p*2+1]),t.uvs[v].push(a[v][g*2]),t.uvs[v].push(a[v][g*2+1])})}addMorphTargets(t,e,i,s){if(i.length===0)return;t.morphTargetsRelative=!0,t.morphAttributes.position=[];const r=this;i.forEach(function(o){o.rawTargets.forEach(function(a){const l=et.Objects.Geometry[a.geoID];l!==void 0&&r.genMorphGeometry(t,e,l,s,a.name)})})}genMorphGeometry(t,e,i,s,r){const o=e.PolygonVertexIndex!==void 0?e.PolygonVertexIndex.a:[],a=i.Vertices!==void 0?i.Vertices.a:[],l=i.Indexes!==void 0?i.Indexes.a:[],h=t.attributes.position.count*3,u=new Float32Array(h);for(let g=0;g<l.length;g++){const m=l[g]*3;u[m]=a[g*3],u[m+1]=a[g*3+1],u[m+2]=a[g*3+2]}const d={vertexIndices:o,vertexPositions:u},f=this.genBuffers(d),p=new hn(f.vertex,3);p.name=r||i.attrName,p.applyMatrix4(s),t.morphAttributes.position.push(p)}parseNormals(t){const e=t.MappingInformationType,i=t.ReferenceInformationType,s=t.Normals.a;let r=[];return i==="IndexToDirect"&&("NormalIndex"in t?r=t.NormalIndex.a:"NormalsIndex"in t&&(r=t.NormalsIndex.a)),{dataSize:3,buffer:s,indices:r,mappingType:e,referenceType:i}}parseUVs(t){const e=t.MappingInformationType,i=t.ReferenceInformationType,s=t.UV.a;let r=[];return i==="IndexToDirect"&&(r=t.UVIndex.a),{dataSize:2,buffer:s,indices:r,mappingType:e,referenceType:i}}parseVertexColors(t){const e=t.MappingInformationType,i=t.ReferenceInformationType,s=t.Colors.a;let r=[];i==="IndexToDirect"&&(r=t.ColorIndex.a);for(let o=0,a=new we;o<s.length;o+=4)a.fromArray(s,o).convertSRGBToLinear().toArray(s,o);return{dataSize:4,buffer:s,indices:r,mappingType:e,referenceType:i}}parseMaterialIndices(t){const e=t.MappingInformationType,i=t.ReferenceInformationType;if(e==="NoMappingInformation")return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:i};const s=t.Materials.a,r=[];for(let o=0;o<s.length;++o)r.push(o);return{dataSize:1,buffer:s,indices:r,mappingType:e,referenceType:i}}parseNurbsGeometry(t){const e=parseInt(t.Order);if(isNaN(e))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",t.Order,t.id),new jt;const i=e-1,s=t.KnotVector.a,r=[],o=t.Points.a;for(let d=0,f=o.length;d<f;d+=4)r.push(new ke().fromArray(o,d));let a,l;if(t.Form==="Closed")r.push(r[0]);else if(t.Form==="Periodic"){a=i,l=s.length-1-a;for(let d=0;d<i;++d)r.push(r[d])}const u=new vQ(i,s,r,a,l).getPoints(r.length*12);return new jt().setFromPoints(u)}}class wQ{parse(){const t=[],e=this.parseClips();if(e!==void 0)for(const i in e){const s=e[i],r=this.addClip(s);t.push(r)}return t}parseClips(){if(et.Objects.AnimationCurve===void 0)return;const t=this.parseAnimationCurveNodes();this.parseAnimationCurves(t);const e=this.parseAnimationLayers(t);return this.parseAnimStacks(e)}parseAnimationCurveNodes(){const t=et.Objects.AnimationCurveNode,e=new Map;for(const i in t){const s=t[i];if(s.attrName.match(/S|R|T|DeformPercent/)!==null){const r={id:s.id,attr:s.attrName,curves:{}};e.set(r.id,r)}}return e}parseAnimationCurves(t){const e=et.Objects.AnimationCurve;for(const i in e){const s={id:e[i].id,times:e[i].KeyTime.a.map(IQ),values:e[i].KeyValueFloat.a},r=Ri.get(s.id);if(r!==void 0){const o=r.parents[0].ID,a=r.parents[0].relationship;a.match(/X/)?t.get(o).curves.x=s:a.match(/Y/)?t.get(o).curves.y=s:a.match(/Z/)?t.get(o).curves.z=s:a.match(/DeformPercent/)&&t.has(o)&&(t.get(o).curves.morph=s)}}}parseAnimationLayers(t){const e=et.Objects.AnimationLayer,i=new Map;for(const s in e){const r=[],o=Ri.get(parseInt(s));o!==void 0&&(o.children.forEach(function(l,h){if(t.has(l.ID)){const u=t.get(l.ID);if(u.curves.x!==void 0||u.curves.y!==void 0||u.curves.z!==void 0){if(r[h]===void 0){const d=Ri.get(l.ID).parents.filter(function(f){return f.relationship!==void 0})[0].ID;if(d!==void 0){const f=et.Objects.Model[d.toString()];if(f===void 0){console.warn("THREE.FBXLoader: Encountered a unused curve.",l);return}const p={modelName:f.attrName?vr.sanitizeNodeName(f.attrName):"",ID:f.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};ws.traverse(function(g){g.ID===f.id&&(p.transform=g.matrix,g.userData.transformData&&(p.eulerOrder=g.userData.transformData.eulerOrder))}),p.transform||(p.transform=new ce),"PreRotation"in f&&(p.preRotation=f.PreRotation.value),"PostRotation"in f&&(p.postRotation=f.PostRotation.value),r[h]=p}}r[h]&&(r[h][u.attr]=u)}else if(u.curves.morph!==void 0){if(r[h]===void 0){const d=Ri.get(l.ID).parents.filter(function(y){return y.relationship!==void 0})[0].ID,f=Ri.get(d).parents[0].ID,p=Ri.get(f).parents[0].ID,g=Ri.get(p).parents[0].ID,m=et.Objects.Model[g],v={modelName:m.attrName?vr.sanitizeNodeName(m.attrName):"",morphName:et.Objects.Deformer[d].attrName};r[h]=v}r[h][u.attr]=u}}}),i.set(parseInt(s),r))}return i}parseAnimStacks(t){const e=et.Objects.AnimationStack,i={};for(const s in e){const r=Ri.get(parseInt(s)).children;r.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");const o=t.get(r[0].ID);i[s]={name:e[s].attrName,layer:o}}return i}addClip(t){let e=[];const i=this;return t.layer.forEach(function(s){e=e.concat(i.generateTracks(s))}),new Pa(t.name,-1,e)}generateTracks(t){const e=[];let i=new C,s=new C;if(t.transform&&t.transform.decompose(i,new ne,s),i=i.toArray(),s=s.toArray(),t.T!==void 0&&Object.keys(t.T.curves).length>0){const r=this.generateVectorTrack(t.modelName,t.T.curves,i,"position");r!==void 0&&e.push(r)}if(t.R!==void 0&&Object.keys(t.R.curves).length>0){const r=this.generateRotationTrack(t.modelName,t.R.curves,t.preRotation,t.postRotation,t.eulerOrder);r!==void 0&&e.push(r)}if(t.S!==void 0&&Object.keys(t.S.curves).length>0){const r=this.generateVectorTrack(t.modelName,t.S.curves,s,"scale");r!==void 0&&e.push(r)}if(t.DeformPercent!==void 0){const r=this.generateMorphTrack(t);r!==void 0&&e.push(r)}return e}generateVectorTrack(t,e,i,s){const r=this.getTimesForAllAxes(e),o=this.getKeyframeTrackValues(r,e,i);return new $A(t+"."+s,r,o)}generateRotationTrack(t,e,i,s,r){let o,a;if(e.x!==void 0&&e.y!==void 0&&e.z!==void 0){const d=this.interpolateRotations(e.x,e.y,e.z,r);o=d[0],a=d[1]}i!==void 0&&(i=i.map(vt.degToRad),i.push(r),i=new fi().fromArray(i),i=new ne().setFromEuler(i)),s!==void 0&&(s=s.map(vt.degToRad),s.push(r),s=new fi().fromArray(s),s=new ne().setFromEuler(s).invert());const l=new ne,h=new fi,u=[];if(!a||!o)return new ig(t+".quaternion",[],[]);for(let d=0;d<a.length;d+=3)h.set(a[d],a[d+1],a[d+2],r),l.setFromEuler(h),i!==void 0&&l.premultiply(i),s!==void 0&&l.multiply(s),d>2&&new ne().fromArray(u,(d-3)/3*4).dot(l)<0&&l.set(-l.x,-l.y,-l.z,-l.w),l.toArray(u,d/3*4);return new ig(t+".quaternion",o,u)}generateMorphTrack(t){const e=t.DeformPercent.curves.morph,i=e.values.map(function(r){return r/100}),s=ws.getObjectByName(t.modelName).morphTargetDictionary[t.morphName];return new __(t.modelName+".morphTargetInfluences["+s+"]",e.times,i)}getTimesForAllAxes(t){let e=[];if(t.x!==void 0&&(e=e.concat(t.x.times)),t.y!==void 0&&(e=e.concat(t.y.times)),t.z!==void 0&&(e=e.concat(t.z.times)),e=e.sort(function(i,s){return i-s}),e.length>1){let i=1,s=e[0];for(let r=1;r<e.length;r++){const o=e[r];o!==s&&(e[i]=o,s=o,i++)}e=e.slice(0,i)}return e}getKeyframeTrackValues(t,e,i){const s=i,r=[];let o=-1,a=-1,l=-1;return t.forEach(function(h){if(e.x&&(o=e.x.times.indexOf(h)),e.y&&(a=e.y.times.indexOf(h)),e.z&&(l=e.z.times.indexOf(h)),o!==-1){const u=e.x.values[o];r.push(u),s[0]=u}else r.push(s[0]);if(a!==-1){const u=e.y.values[a];r.push(u),s[1]=u}else r.push(s[1]);if(l!==-1){const u=e.z.values[l];r.push(u),s[2]=u}else r.push(s[2])}),r}interpolateRotations(t,e,i,s){const r=[],o=[];r.push(t.times[0]),o.push(vt.degToRad(t.values[0])),o.push(vt.degToRad(e.values[0])),o.push(vt.degToRad(i.values[0]));for(let a=1;a<t.values.length;a++){const l=[t.values[a-1],e.values[a-1],i.values[a-1]];if(isNaN(l[0])||isNaN(l[1])||isNaN(l[2]))continue;const h=l.map(vt.degToRad),u=[t.values[a],e.values[a],i.values[a]];if(isNaN(u[0])||isNaN(u[1])||isNaN(u[2]))continue;const d=u.map(vt.degToRad),f=[u[0]-l[0],u[1]-l[1],u[2]-l[2]],p=[Math.abs(f[0]),Math.abs(f[1]),Math.abs(f[2])];if(p[0]>=180||p[1]>=180||p[2]>=180){const m=Math.max(...p)/180,v=new fi(...h,s),y=new fi(...d,s),b=new ne().setFromEuler(v),_=new ne().setFromEuler(y);b.dot(_)&&_.set(-_.x,-_.y,-_.z,-_.w);const x=t.times[a-1],S=t.times[a]-x,T=new ne,L=new fi;for(let I=0;I<1;I+=1/m)T.copy(b.clone().slerp(_.clone(),I)),r.push(x+I*S),L.setFromQuaternion(T,s),o.push(L.x),o.push(L.y),o.push(L.z)}else r.push(t.times[a]),o.push(vt.degToRad(t.values[a])),o.push(vt.degToRad(e.values[a])),o.push(vt.degToRad(i.values[a]))}return[r,o]}}class xQ{getPrevNode(){return this.nodeStack[this.currentIndent-2]}getCurrentNode(){return this.nodeStack[this.currentIndent-1]}getCurrentProp(){return this.currentProp}pushStack(t){this.nodeStack.push(t),this.currentIndent+=1}popStack(){this.nodeStack.pop(),this.currentIndent-=1}setCurrentProp(t,e){this.currentProp=t,this.currentPropName=e}parse(t){this.currentIndent=0,this.allNodes=new XP,this.nodeStack=[],this.currentProp=[],this.currentPropName="";const e=this,i=t.split(/[\r\n]+/);return i.forEach(function(s,r){const o=s.match(/^[\s\t]*;/),a=s.match(/^[\s\t]*$/);if(o||a)return;const l=s.match("^\\t{"+e.currentIndent+"}(\\w+):(.*){",""),h=s.match("^\\t{"+e.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),u=s.match("^\\t{"+(e.currentIndent-1)+"}}");l?e.parseNodeBegin(s,l):h?e.parseNodeProperty(s,h,i[++r]):u?e.popStack():s.match(/^[^\s\t}]/)&&e.parseNodePropertyContinued(s)}),this.allNodes}parseNodeBegin(t,e){const i=e[1].trim().replace(/^"/,"").replace(/"$/,""),s=e[2].split(",").map(function(l){return l.trim().replace(/^"/,"").replace(/"$/,"")}),r={name:i},o=this.parseNodeAttr(s),a=this.getCurrentNode();this.currentIndent===0?this.allNodes.add(i,r):i in a?(i==="PoseNode"?a.PoseNode.push(r):a[i].id!==void 0&&(a[i]={},a[i][a[i].id]=a[i]),o.id!==""&&(a[i][o.id]=r)):typeof o.id=="number"?(a[i]={},a[i][o.id]=r):i!=="Properties70"&&(i==="PoseNode"?a[i]=[r]:a[i]=r),typeof o.id=="number"&&(r.id=o.id),o.name!==""&&(r.attrName=o.name),o.type!==""&&(r.attrType=o.type),this.pushStack(r)}parseNodeAttr(t){let e=t[0];t[0]!==""&&(e=parseInt(t[0]),isNaN(e)&&(e=t[0]));let i="",s="";return t.length>1&&(i=t[1].replace(/^(\w+)::/,""),s=t[2]),{id:e,name:i,type:s}}parseNodeProperty(t,e,i){let s=e[1].replace(/^"/,"").replace(/"$/,"").trim(),r=e[2].replace(/^"/,"").replace(/"$/,"").trim();s==="Content"&&r===","&&(r=i.replace(/"/g,"").replace(/,$/,"").trim());const o=this.getCurrentNode();if(o.name==="Properties70"){this.parseNodeSpecialProperty(t,s,r);return}if(s==="C"){const l=r.split(",").slice(1),h=parseInt(l[0]),u=parseInt(l[1]);let d=r.split(",").slice(3);d=d.map(function(f){return f.trim().replace(/^"/,"")}),s="connections",r=[h,u],RQ(r,d),o[s]===void 0&&(o[s]=[])}s==="Node"&&(o.id=r),s in o&&Array.isArray(o[s])?o[s].push(r):s!=="a"?o[s]=r:o.a=r,this.setCurrentProp(o,s),s==="a"&&r.slice(-1)!==","&&(o.a=ub(r))}parseNodePropertyContinued(t){const e=this.getCurrentNode();e.a+=t,t.slice(-1)!==","&&(e.a=ub(e.a))}parseNodeSpecialProperty(t,e,i){const s=i.split('",').map(function(u){return u.trim().replace(/^\"/,"").replace(/\s/,"_")}),r=s[0],o=s[1],a=s[2],l=s[3];let h=s[4];switch(o){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":h=parseFloat(h);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":h=ub(h);break}this.getPrevNode()[r]={type:o,type2:a,flag:l,value:h},this.setCurrentProp(this.getPrevNode(),r)}}class CQ{parse(t){const e=new GE(t);e.skip(23);const i=e.getUint32();if(i<6400)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+i);const s=new XP;for(;!this.endOfContent(e);){const r=this.parseNode(e,i);r!==null&&s.add(r.name,r)}return s}endOfContent(t){return t.size()%16===0?(t.getOffset()+160+16&-16)>=t.size():t.getOffset()+160+16>=t.size()}parseNode(t,e){const i={},s=e>=7500?t.getUint64():t.getUint32(),r=e>=7500?t.getUint64():t.getUint32();e>=7500?t.getUint64():t.getUint32();const o=t.getUint8(),a=t.getString(o);if(s===0)return null;const l=[];for(let f=0;f<r;f++)l.push(this.parseProperty(t));const h=l.length>0?l[0]:"",u=l.length>1?l[1]:"",d=l.length>2?l[2]:"";for(i.singleProperty=r===1&&t.getOffset()===s;s>t.getOffset();){const f=this.parseNode(t,e);f!==null&&this.parseSubNode(a,i,f)}return i.propertyList=l,typeof h=="number"&&(i.id=h),u!==""&&(i.attrName=u),d!==""&&(i.attrType=d),a!==""&&(i.name=a),i}parseSubNode(t,e,i){if(i.singleProperty===!0){const s=i.propertyList[0];Array.isArray(s)?(e[i.name]=i,i.a=s):e[i.name]=s}else if(t==="Connections"&&i.name==="C"){const s=[];i.propertyList.forEach(function(r,o){o!==0&&s.push(r)}),e.connections===void 0&&(e.connections=[]),e.connections.push(s)}else if(i.name==="Properties70")Object.keys(i).forEach(function(r){e[r]=i[r]});else if(t==="Properties70"&&i.name==="P"){let s=i.propertyList[0],r=i.propertyList[1];const o=i.propertyList[2],a=i.propertyList[3];let l;s.indexOf("Lcl ")===0&&(s=s.replace("Lcl ","Lcl_")),r.indexOf("Lcl ")===0&&(r=r.replace("Lcl ","Lcl_")),r==="Color"||r==="ColorRGB"||r==="Vector"||r==="Vector3D"||r.indexOf("Lcl_")===0?l=[i.propertyList[4],i.propertyList[5],i.propertyList[6]]:l=i.propertyList[4],e[s]={type:r,type2:o,flag:a,value:l}}else e[i.name]===void 0?typeof i.id=="number"?(e[i.name]={},e[i.name][i.id]=i):e[i.name]=i:i.name==="PoseNode"?(Array.isArray(e[i.name])||(e[i.name]=[e[i.name]]),e[i.name].push(i)):e[i.name][i.id]===void 0&&(e[i.name][i.id]=i)}parseProperty(t){const e=t.getString(1);let i;switch(e){case"C":return t.getBoolean();case"D":return t.getFloat64();case"F":return t.getFloat32();case"I":return t.getInt32();case"L":return t.getInt64();case"R":return i=t.getUint32(),t.getArrayBuffer(i);case"S":return i=t.getUint32(),t.getString(i);case"Y":return t.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":const s=t.getUint32(),r=t.getUint32(),o=t.getUint32();if(r===0)switch(e){case"b":case"c":return t.getBooleanArray(s);case"d":return t.getFloat64Array(s);case"f":return t.getFloat32Array(s);case"i":return t.getInt32Array(s);case"l":return t.getInt64Array(s)}const a=Zf(new Uint8Array(t.getArrayBuffer(o))),l=new GE(a.buffer);switch(e){case"b":case"c":return l.getBooleanArray(s);case"d":return l.getFloat64Array(s);case"f":return l.getFloat32Array(s);case"i":return l.getInt32Array(s);case"l":return l.getInt64Array(s)}break;default:throw new Error("THREE.FBXLoader: Unknown property type "+e)}}}class GE{constructor(t,e){this.dv=new DataView(t),this.offset=0,this.littleEndian=e!==void 0?e:!0,this._textDecoder=new TextDecoder}getOffset(){return this.offset}size(){return this.dv.buffer.byteLength}skip(t){this.offset+=t}getBoolean(){return(this.getUint8()&1)===1}getBooleanArray(t){const e=[];for(let i=0;i<t;i++)e.push(this.getBoolean());return e}getUint8(){const t=this.dv.getUint8(this.offset);return this.offset+=1,t}getInt16(){const t=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,t}getInt32(){const t=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,t}getInt32Array(t){const e=[];for(let i=0;i<t;i++)e.push(this.getInt32());return e}getUint32(){const t=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,t}getInt64(){let t,e;return this.littleEndian?(t=this.getUint32(),e=this.getUint32()):(e=this.getUint32(),t=this.getUint32()),e&2147483648?(e=~e&4294967295,t=~t&4294967295,t===4294967295&&(e=e+1&4294967295),t=t+1&4294967295,-(e*4294967296+t)):e*4294967296+t}getInt64Array(t){const e=[];for(let i=0;i<t;i++)e.push(this.getInt64());return e}getUint64(){let t,e;return this.littleEndian?(t=this.getUint32(),e=this.getUint32()):(e=this.getUint32(),t=this.getUint32()),e*4294967296+t}getFloat32(){const t=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,t}getFloat32Array(t){const e=[];for(let i=0;i<t;i++)e.push(this.getFloat32());return e}getFloat64(){const t=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,t}getFloat64Array(t){const e=[];for(let i=0;i<t;i++)e.push(this.getFloat64());return e}getArrayBuffer(t){const e=this.dv.buffer.slice(this.offset,this.offset+t);return this.offset+=t,e}getString(t){const e=this.offset;let i=new Uint8Array(this.dv.buffer,e,t);this.skip(t);const s=i.indexOf(0);return s>=0&&(i=new Uint8Array(this.dv.buffer,e,s)),this._textDecoder.decode(i)}}class XP{add(t,e){this[t]=e}}function SQ(n){const t="Kaydara FBX Binary  \0";return n.byteLength>=t.length&&t===JP(n,0,t.length)}function EQ(n){const t=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"];let e=0;function i(s){const r=n[s-1];return n=n.slice(e+s),e++,r}for(let s=0;s<t.length;++s)if(i(1)===t[s])return!1;return!0}function HE(n){const t=/FBXVersion: (\d+)/,e=n.match(t);if(e)return parseInt(e[1]);throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function IQ(n){return n/46186158e3}const TQ=[];function Cm(n,t,e,i){let s;switch(i.mappingType){case"ByPolygonVertex":s=n;break;case"ByPolygon":s=t;break;case"ByVertice":s=e;break;case"AllSame":s=i.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+i.mappingType)}i.referenceType==="IndexToDirect"&&(s=i.indices[s]);const r=s*i.dataSize,o=r+i.dataSize;return BQ(TQ,i.buffer,r,o)}const hb=new fi,Au=new C;function YP(n){const t=new ce,e=new ce,i=new ce,s=new ce,r=new ce,o=new ce,a=new ce,l=new ce,h=new ce,u=new ce,d=new ce,f=new ce,p=n.inheritType?n.inheritType:0;if(n.translation&&t.setPosition(Au.fromArray(n.translation)),n.preRotation){const R=n.preRotation.map(vt.degToRad);R.push(n.eulerOrder||fi.DEFAULT_ORDER),e.makeRotationFromEuler(hb.fromArray(R))}if(n.rotation){const R=n.rotation.map(vt.degToRad);R.push(n.eulerOrder||fi.DEFAULT_ORDER),i.makeRotationFromEuler(hb.fromArray(R))}if(n.postRotation){const R=n.postRotation.map(vt.degToRad);R.push(n.eulerOrder||fi.DEFAULT_ORDER),s.makeRotationFromEuler(hb.fromArray(R)),s.invert()}n.scale&&r.scale(Au.fromArray(n.scale)),n.scalingOffset&&a.setPosition(Au.fromArray(n.scalingOffset)),n.scalingPivot&&o.setPosition(Au.fromArray(n.scalingPivot)),n.rotationOffset&&l.setPosition(Au.fromArray(n.rotationOffset)),n.rotationPivot&&h.setPosition(Au.fromArray(n.rotationPivot)),n.parentMatrixWorld&&(d.copy(n.parentMatrix),u.copy(n.parentMatrixWorld));const g=e.clone().multiply(i).multiply(s),m=new ce;m.extractRotation(u);const v=new ce;v.copyPosition(u);const y=v.clone().invert().multiply(u),b=m.clone().invert().multiply(y),_=r,x=new ce;if(p===0)x.copy(m).multiply(g).multiply(b).multiply(_);else if(p===1)x.copy(m).multiply(b).multiply(g).multiply(_);else{const B=new ce().scale(new C().setFromMatrixScale(d)).clone().invert(),Q=b.clone().multiply(B);x.copy(m).multiply(g).multiply(Q).multiply(_)}const S=h.clone().invert(),T=o.clone().invert();let L=t.clone().multiply(l).multiply(h).multiply(e).multiply(i).multiply(s).multiply(S).multiply(a).multiply(o).multiply(r).multiply(T);const I=new ce().copyPosition(L),P=u.clone().multiply(I);return f.copyPosition(P),L=f.clone().multiply(x),L.premultiply(u.invert()),L}function KP(n){n=n||0;const t=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return n===6?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),t[0]):t[n]}function ub(n){return n.split(",").map(function(e){return parseFloat(e)})}function JP(n,t,e){return t===void 0&&(t=0),e===void 0&&(e=n.byteLength),new TextDecoder().decode(new Uint8Array(n,t,e))}function RQ(n,t){for(let e=0,i=n.length,s=t.length;e<s;e++,i++)n[i]=t[e]}function BQ(n,t,e,i){for(let s=e,r=0;s<i;s++,r++)n[r]=t[s];return n}const PQ=/^[og]\s*(.+)?/,MQ=/^mtllib /,DQ=/^usemtl /,kQ=/^usemap /,VE=/\s+/,WE=new C,db=new C,qE=new C,XE=new C,Br=new C,Sm=new we;function OQ(){const n={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materials:{},materialLibraries:[],startObject:function(t,e){if(this.object&&this.object.fromDeclaration===!1){this.object.name=t,this.object.fromDeclaration=e!==!1;return}const i=this.object&&typeof this.object.currentMaterial=="function"?this.object.currentMaterial():void 0;if(this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0),this.object={name:t||"",fromDeclaration:e!==!1,geometry:{vertices:[],normals:[],colors:[],uvs:[],hasUVIndices:!1},materials:[],smooth:!0,startMaterial:function(s,r){const o=this._finalize(!1);o&&(o.inherited||o.groupCount<=0)&&this.materials.splice(o.index,1);const a={index:this.materials.length,name:s||"",mtllib:Array.isArray(r)&&r.length>0?r[r.length-1]:"",smooth:o!==void 0?o.smooth:this.smooth,groupStart:o!==void 0?o.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(l){const h={index:typeof l=="number"?l:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return h.clone=this.clone.bind(h),h}};return this.materials.push(a),a},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(s){const r=this.currentMaterial();if(r&&r.groupEnd===-1&&(r.groupEnd=this.geometry.vertices.length/3,r.groupCount=r.groupEnd-r.groupStart,r.inherited=!1),s&&this.materials.length>1)for(let o=this.materials.length-1;o>=0;o--)this.materials[o].groupCount<=0&&this.materials.splice(o,1);return s&&this.materials.length===0&&this.materials.push({name:"",smooth:this.smooth}),r}},i&&i.name&&typeof i.clone=="function"){const s=i.clone(0);s.inherited=!0,this.object.materials.push(s)}this.objects.push(this.object)},finalize:function(){this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0)},parseVertexIndex:function(t,e){const i=parseInt(t,10);return(i>=0?i-1:i+e/3)*3},parseNormalIndex:function(t,e){const i=parseInt(t,10);return(i>=0?i-1:i+e/3)*3},parseUVIndex:function(t,e){const i=parseInt(t,10);return(i>=0?i-1:i+e/2)*2},addVertex:function(t,e,i){const s=this.vertices,r=this.object.geometry.vertices;r.push(s[t+0],s[t+1],s[t+2]),r.push(s[e+0],s[e+1],s[e+2]),r.push(s[i+0],s[i+1],s[i+2])},addVertexPoint:function(t){const e=this.vertices;this.object.geometry.vertices.push(e[t+0],e[t+1],e[t+2])},addVertexLine:function(t){const e=this.vertices;this.object.geometry.vertices.push(e[t+0],e[t+1],e[t+2])},addNormal:function(t,e,i){const s=this.normals,r=this.object.geometry.normals;r.push(s[t+0],s[t+1],s[t+2]),r.push(s[e+0],s[e+1],s[e+2]),r.push(s[i+0],s[i+1],s[i+2])},addFaceNormal:function(t,e,i){const s=this.vertices,r=this.object.geometry.normals;WE.fromArray(s,t),db.fromArray(s,e),qE.fromArray(s,i),Br.subVectors(qE,db),XE.subVectors(WE,db),Br.cross(XE),Br.normalize(),r.push(Br.x,Br.y,Br.z),r.push(Br.x,Br.y,Br.z),r.push(Br.x,Br.y,Br.z)},addColor:function(t,e,i){const s=this.colors,r=this.object.geometry.colors;s[t]!==void 0&&r.push(s[t+0],s[t+1],s[t+2]),s[e]!==void 0&&r.push(s[e+0],s[e+1],s[e+2]),s[i]!==void 0&&r.push(s[i+0],s[i+1],s[i+2])},addUV:function(t,e,i){const s=this.uvs,r=this.object.geometry.uvs;r.push(s[t+0],s[t+1]),r.push(s[e+0],s[e+1]),r.push(s[i+0],s[i+1])},addDefaultUV:function(){const t=this.object.geometry.uvs;t.push(0,0),t.push(0,0),t.push(0,0)},addUVLine:function(t){const e=this.uvs;this.object.geometry.uvs.push(e[t+0],e[t+1])},addFace:function(t,e,i,s,r,o,a,l,h){const u=this.vertices.length;let d=this.parseVertexIndex(t,u),f=this.parseVertexIndex(e,u),p=this.parseVertexIndex(i,u);if(this.addVertex(d,f,p),this.addColor(d,f,p),a!==void 0&&a!==""){const g=this.normals.length;d=this.parseNormalIndex(a,g),f=this.parseNormalIndex(l,g),p=this.parseNormalIndex(h,g),this.addNormal(d,f,p)}else this.addFaceNormal(d,f,p);if(s!==void 0&&s!==""){const g=this.uvs.length;d=this.parseUVIndex(s,g),f=this.parseUVIndex(r,g),p=this.parseUVIndex(o,g),this.addUV(d,f,p),this.object.geometry.hasUVIndices=!0}else this.addDefaultUV()},addPointGeometry:function(t){this.object.geometry.type="Points";const e=this.vertices.length;for(let i=0,s=t.length;i<s;i++){const r=this.parseVertexIndex(t[i],e);this.addVertexPoint(r),this.addColor(r)}},addLineGeometry:function(t,e){this.object.geometry.type="Line";const i=this.vertices.length,s=this.uvs.length;for(let r=0,o=t.length;r<o;r++)this.addVertexLine(this.parseVertexIndex(t[r],i));for(let r=0,o=e.length;r<o;r++)this.addUVLine(this.parseUVIndex(e[r],s))}};return n.startObject("",!1),n}class LQ extends Lh{constructor(t){super(t),this.materials=null}load(t,e,i,s){const r=this,o=new Zr(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(t,function(a){try{e(r.parse(a))}catch(l){s?s(l):console.error(l),r.manager.itemError(t)}},i,s)}setMaterials(t){return this.materials=t,this}parse(t){const e=new OQ;t.indexOf(`\r
`)!==-1&&(t=t.replace(/\r\n/g,`
`)),t.indexOf(`\\
`)!==-1&&(t=t.replace(/\\\n/g,""));const i=t.split(`
`);let s=[];for(let a=0,l=i.length;a<l;a++){const h=i[a].trimStart();if(h.length===0)continue;const u=h.charAt(0);if(u!=="#")if(u==="v"){const d=h.split(VE);switch(d[0]){case"v":e.vertices.push(parseFloat(d[1]),parseFloat(d[2]),parseFloat(d[3])),d.length>=7?(Sm.setRGB(parseFloat(d[4]),parseFloat(d[5]),parseFloat(d[6])).convertSRGBToLinear(),e.colors.push(Sm.r,Sm.g,Sm.b)):e.colors.push(void 0,void 0,void 0);break;case"vn":e.normals.push(parseFloat(d[1]),parseFloat(d[2]),parseFloat(d[3]));break;case"vt":e.uvs.push(parseFloat(d[1]),parseFloat(d[2]));break}}else if(u==="f"){const f=h.slice(1).trim().split(VE),p=[];for(let m=0,v=f.length;m<v;m++){const y=f[m];if(y.length>0){const b=y.split("/");p.push(b)}}const g=p[0];for(let m=1,v=p.length-1;m<v;m++){const y=p[m],b=p[m+1];e.addFace(g[0],y[0],b[0],g[1],y[1],b[1],g[2],y[2],b[2])}}else if(u==="l"){const d=h.substring(1).trim().split(" ");let f=[];const p=[];if(h.indexOf("/")===-1)f=d;else for(let g=0,m=d.length;g<m;g++){const v=d[g].split("/");v[0]!==""&&f.push(v[0]),v[1]!==""&&p.push(v[1])}e.addLineGeometry(f,p)}else if(u==="p"){const f=h.slice(1).trim().split(" ");e.addPointGeometry(f)}else if((s=PQ.exec(h))!==null){const d=(" "+s[0].slice(1).trim()).slice(1);e.startObject(d)}else if(DQ.test(h))e.object.startMaterial(h.substring(7).trim(),e.materialLibraries);else if(MQ.test(h))e.materialLibraries.push(h.substring(7).trim());else if(kQ.test(h))console.warn('THREE.OBJLoader: Rendering identifier "usemap" not supported. Textures must be defined in MTL files.');else if(u==="s"){if(s=h.split(" "),s.length>1){const f=s[1].trim().toLowerCase();e.object.smooth=f!=="0"&&f!=="off"}else e.object.smooth=!0;const d=e.object.currentMaterial();d&&(d.smooth=e.object.smooth)}else{if(h==="\0")continue;console.warn('THREE.OBJLoader: Unexpected line: "'+h+'"')}}e.finalize();const r=new To;if(r.materialLibraries=[].concat(e.materialLibraries),!(e.objects.length===1&&e.objects[0].geometry.vertices.length===0)===!0)for(let a=0,l=e.objects.length;a<l;a++){const h=e.objects[a],u=h.geometry,d=h.materials,f=u.type==="Line",p=u.type==="Points";let g=!1;if(u.vertices.length===0)continue;const m=new jt;m.setAttribute("position",new hn(u.vertices,3)),u.normals.length>0&&m.setAttribute("normal",new hn(u.normals,3)),u.colors.length>0&&(g=!0,m.setAttribute("color",new hn(u.colors,3))),u.hasUVIndices===!0&&m.setAttribute("uv",new hn(u.uvs,2));const v=[];for(let b=0,_=d.length;b<_;b++){const x=d[b],S=x.name+"_"+x.smooth+"_"+g;let T=e.materials[S];if(this.materials!==null){if(T=this.materials.create(x.name),f&&T&&!(T instanceof Ba)){const L=new Ba;ft.prototype.copy.call(L,T),L.color.copy(T.color),T=L}else if(p&&T&&!(T instanceof qf)){const L=new qf({size:10,sizeAttenuation:!1});ft.prototype.copy.call(L,T),L.color.copy(T.color),L.map=T.map,T=L}}T===void 0&&(f?T=new Ba:p?T=new qf({size:1,sizeAttenuation:!1}):T=new up,T.name=x.name,T.flatShading=!x.smooth,T.vertexColors=g,e.materials[S]=T),v.push(T)}let y;if(v.length>1){for(let b=0,_=d.length;b<_;b++){const x=d[b];m.addGroup(x.groupStart,x.groupCount,b)}f?y=new tg(m,v):p?y=new CA(m,v):y=new J(m,v)}else f?y=new tg(m,v[0]):p?y=new CA(m,v[0]):y=new J(m,v[0]);y.name=h.name,r.add(y)}else if(e.vertices.length>0){const a=new qf({size:1,sizeAttenuation:!1}),l=new jt;l.setAttribute("position",new hn(e.vertices,3)),e.colors.length>0&&e.colors[0]!==void 0&&(l.setAttribute("color",new hn(e.colors,3)),a.vertexColors=!0);const h=new CA(l,a);r.add(h)}return r}}const fb=N("debugtypes");class FQ{constructor(){c(this,"_types",{});fb&&console.warn("TypeStore: Created",this)}add(t,e){fb&&console.warn("ADD TYPE",t);const i=this._types[t];i===void 0?this._types[t]=e:fb&&i!==e&&console.warn("Type name exists multiple times in your project and may lead to runtime errors:",t)}get(t){return this._types[t]}}const UQ=Symbol("BuiltInType"),D=new FQ,Nq=function(n){D.get(n.name)||D.add(n.name,n)};typeof globalThis!==void 0&&!("OffscreenCanvas"in globalThis)&&(globalThis.OffscreenCanvas=class{constructor(t,e){c(this,"canvas");return this.canvas=document.createElement("canvas"),this.canvas.width=t,this.canvas.height=e,this.canvas.convertToBlob=(i,s)=>new Promise(r=>{this.canvas.toBlob(r,i,s)}),this.canvas}});const NQ=N("debugprogress");function QQ(n){n=n||new Date;const t=n.getMonth()+1,e=n.getDate(),i=n.getHours(),s=n.getMinutes(),r=n.getSeconds(),o=(t<10?"0":"")+t,a=(e<10?"0":"")+e,l=(i<10?"0":"")+i,h=(s<10?"0":"")+s,u=(r<10?"0":"")+r;return n.getFullYear()+o+a+"-"+l+h+u}class st{static start(t,e){typeof e=="string"&&(e={parentScope:e});const i=new zQ(t,e);$f.set(t,i)}static report(t,e){const i=$f.get(t);if(!i){console.warn("Reporting progress for non-existing scope",t);return}typeof e=="string"&&(e={message:e,autoStep:!0}),i.report(e)}static end(t){const e=$f.get(t);e&&(e.end(),$f.delete(t))}}const $f=new Map;class zQ{constructor(t,e){c(this,"scopeLabel");c(this,"parentScope");c(this,"childScopes",[]);c(this,"parentDepth",0);c(this,"lastStep",0);c(this,"lastAutoStepWeight",1);c(this,"lastTotalSteps",0);c(this,"onProgress");c(this,"showLogs",!1);c(this,"selfProgress",0);c(this,"totalProgress",0);c(this,"selfReports",0);c(this,"totalReports",0);this.parentScope=e!=null&&e.parentScope?$f.get(e.parentScope):void 0,this.parentScope&&(this.parentScope.childScopes.push(this),this.parentDepth=this.parentScope.parentDepth+1),this.scopeLabel=" ".repeat(this.parentDepth*2)+t,this.showLogs=(e==null?void 0:e.logTimings)??!!NQ,this.showLogs&&console.time(this.scopeLabel),this.onProgress=e==null?void 0:e.onProgress}report(t,e=!1){if(t){if(t.totalSteps!==void 0&&(this.lastTotalSteps=t.totalSteps),t.currentStep!==void 0&&(this.lastStep=t.currentStep),t.autoStep!==void 0){if(t.currentStep===void 0){this.lastStep===void 0&&(this.lastStep=0);const s=typeof t.autoStep=="number"?t.autoStep:1;this.lastStep+=this.lastAutoStepWeight,this.lastAutoStepWeight=s,t.currentStep=this.lastStep}t.totalSteps=this.lastTotalSteps}t.progress!==void 0?this.selfProgress=t.progress:t.currentStep!==void 0&&t.totalSteps!==void 0&&(this.selfProgress=t.currentStep/t.totalSteps)}if(this.childScopes.length>0){let s=0,r=0;for(const a of this.childScopes)s+=a.selfProgress,r+=1;r>0&&(s/=r);const o=this.lastAutoStepWeight/(this.lastTotalSteps??1);this.totalProgress=this.selfProgress+s*o}else this.totalProgress=this.selfProgress;this.selfProgress=Math.min(1,this.selfProgress),this.totalProgress=Math.min(1,this.totalProgress);let i=(this.totalProgress*100).toFixed(3)+"%";this.childScopes.length>0&&(i+=" ("+(this.selfProgress*100).toFixed(3)+"% self)"),t!=null&&t.message&&(i=t.message+" â€“ "+i),this.lastStep!==void 0&&this.lastTotalSteps!==void 0&&(i="Step "+(this.lastStep+(this.lastAutoStepWeight!=1?"â€“"+(this.lastStep+this.lastAutoStepWeight):"")+"/"+this.lastTotalSteps)+" "+i),e?this.totalReports++:(this.selfReports++,this.totalReports++),this.showLogs&&console.timeLog(this.scopeLabel,i),this.onProgress&&this.onProgress(this.totalProgress),this.parentScope&&this.parentScope.report(void 0,!0)}end(){this.report({progress:1,autoStep:!0},!0),this.showLogs&&(console.timeLog(this.scopeLabel,"Total reports: "+this.totalReports,"Self reports: "+this.selfReports),console.timeEnd(this.scopeLabel));let t=!1;for(const e of this.childScopes)if(!(e.selfProgress>=1)){t=!0;break}t&&console.warn("Progress end with child scopes that are still running",this),this.onProgress=void 0}}function Fa(n){return n=n.replace(/[^a-zA-Z0-9_]/g,""),n.match(/^[a-zA-Z_]/)||(n="_"+n),n}function ZP(n){if(n.length===0)return null;const t=n.map(i=>{const s=new Array;for(;i.parent;)s.unshift(i.parent),i=i.parent;return s});return t[0].findLast(i=>t.every(s=>s.includes(i)))||null}function $P(n){const t=ZP(n),e=new Set;for(const i of n){let s=i.parent;for(;s&&s!==t;)n.includes(s)||e.add(s),s=s.parent}return e}const uh=class{constructor(t,e,i,s=null,r=null,o=null,a=null,l=null){c(this,"uuid");c(this,"name");c(this,"type");c(this,"extraSchemas",[]);c(this,"displayName");c(this,"visibility");c(this,"matrix");c(this,"_isDynamic");c(this,"geometry");c(this,"material");c(this,"camera");c(this,"parent");c(this,"skinnedMesh");c(this,"children",[]);c(this,"animations");c(this,"_eventListeners");this.uuid=t,this.name=Fa(e),this.displayName=e,this.matrix=i.clone(),this.geometry=s,this.material=r,this.camera=o,this.parent=null,this.children=[],this._eventListeners={},this._isDynamic=!1,this.skinnedMesh=a,this.animations=l}get isDynamic(){return this._isDynamic}set isDynamic(t){this._isDynamic=t}static createEmptyParent(t){const e=new uh(vt.generateUUID(),t.name+"_empty_"+uh.USDObject_export_id++,t.matrix),i=t.parent;return i&&i.add(e),e.add(t),e.isDynamic=!0,t.matrix=new ce().identity(),e}static createEmpty(){const t=new uh(vt.generateUUID(),"Empty_"+uh.USDObject_export_id++,new ce);return t.isDynamic=!0,t}is(t){return t?this.uuid===t.uuid:!1}isEmpty(){return!this.geometry}clone(){const t=new uh(vt.generateUUID(),this.name,this.matrix,this.geometry,this.material);return t.isDynamic=this.isDynamic,t}deepClone(){const t=this.clone();for(const e of this.children)e&&t.add(e.deepClone());return t}getPath(){let t=this.parent,e=this.name;for(;t;)e=(t.parent?t.name:t.name+"/Scenes/Scene")+"/"+e,t=t.parent;return"</"+e+">"}add(t){t.parent&&t.parent.remove(t),t.parent=this,this.children.push(t)}remove(t){const e=this.children.indexOf(t);e>=0&&(t.parent===this&&(t.parent=null),this.children.splice(e,1))}addEventListener(t,e){this._eventListeners[t]||(this._eventListeners[t]=[]),this._eventListeners[t].push(e)}removeEventListener(t,e){if(!this._eventListeners[t])return;const i=this._eventListeners[t].indexOf(e);i>=0&&this._eventListeners[t].splice(i,1)}onSerialize(t,e){const i=this._eventListeners.serialize;i&&i.forEach(s=>s(t,e))}};let rs=uh;c(rs,"USDObject_export_id",0);class eM extends rs{constructor(){super(void 0,"StageRoot",new ce,null,null,null);c(this,"stageLength");this.children=[],this.stageLength=200}get isDocumentRoot(){return!0}get isDynamic(){return!1}add(e){e.parent=this,this.children.push(e)}remove(e){const i=this.children.indexOf(e);i>=0&&(e.parent===this&&(e.parent=null),this.children.splice(i,1))}traverse(e,i=null){if(i!==null?e(i):i=this,i.children)for(const s of i.children)this.traverse(e,s)}findById(e){let i=!1;function s(r){if(!i){if(r.uuid===e)return i=!0,r;if(r.children)for(const o of r.children){if(!o)continue;const a=s(o);if(a)return a}}}return s(this)}buildHeader(e){var a,l;const i=(a=e.extensions)==null?void 0:a.find(h=>(h==null?void 0:h.extensionName)==="animation"),s=(l=e.extensions)==null?void 0:l.find(h=>(h==null?void 0:h.extensionName)==="Behaviour"),r=(i==null?void 0:i.getStartTimeCode())??0,o=(i==null?void 0:i.getEndTimeCode())??0;return`#usda 1.0
(
	customLayerData = {
		string creator = "Needle Engine ${Eo}"
		dictionary Needle = {
			bool animations = ${i?1:0}
			bool interactive = ${s?1:0}
			bool quickLookCompatible = ${e.quickLookCompatible?1:0}
		}
	}
	defaultPrim = "${Fa(this.name)}"
	metersPerUnit = 1
	upAxis = "Y"
	startTimeCode = ${r}
	endTimeCode = ${o}
	timeCodesPerSecond = 60
	framesPerSecond = 60
	doc = """Generated by Needle Engine USDZ Exporter ${Eo}"""
)
`}}const vu=`
`,Ns="</StageRoot/Materials";class jQ{constructor(){c(this,"str");c(this,"indent");this.str="",this.indent=0}clear(){this.str="",this.indent=0}beginBlock(t=void 0,e="{",i=!0){t!==void 0?(t=this.applyIndent(t),this.str+=t,i?(this.str+=vu,this.str+=this.applyIndent(e)):this.str+=" "+e):this.str+=this.applyIndent(e),this.str+=vu,this.indent+=1}closeBlock(t="}"){this.indent-=1,this.str+=this.applyIndent(t)+vu}beginArray(t){t=this.applyIndent(t+" = ["),this.str+=t,this.str+=vu,this.indent+=1}closeArray(){this.indent-=1,this.str+=this.applyIndent("]")+vu}appendLine(t=""){t=this.applyIndent(t),this.str+=t,this.str+=vu}toString(){return this.str}applyIndent(t){let e="";for(let i=0;i<this.indent;i++)e+="	";return e+t}}class GQ{constructor(t,e,i){c(this,"root");c(this,"exporter");c(this,"extensions",[]);c(this,"quickLookCompatible");c(this,"exportInvisible");c(this,"materials");c(this,"textures");c(this,"files");c(this,"document");c(this,"output");c(this,"animations");this.root=t,this.exporter=e,this.quickLookCompatible=i.quickLookCompatible,this.exportInvisible=i.exportInvisible,i.extensions&&(this.extensions=i.extensions),this.materials=new Map,this.textures={},this.files={},this.document=new eM,this.output="",this.animations=[]}}class pb{constructor(){c(this,"ar",{anchoring:{type:"plane"},planeAnchoring:{alignment:"horizontal"}});c(this,"quickLookCompatible",!1);c(this,"extensions",[]);c(this,"maxTextureSize",4096);c(this,"exportInvisible",!1)}}let HQ=class{constructor(){c(this,"debug");c(this,"sceneAnchoringOptions",new pb);c(this,"extensions",[]);c(this,"keepObject");this.debug=!1}async parse(t,e=new pb){e=Object.assign(new pb,e),this.sceneAnchoringOptions=e;const i=new GQ(t,this,e);this.extensions=i.extensions;const s=i.files,r="model.usda";s[r]=null;const o=i.materials,a=i.textures;st.report("export-usdz","Invoking onBeforeBuildDocument"),await PA(i,"onBeforeBuildDocument"),st.report("export-usdz","Done onBeforeBuildDocument"),st.report("export-usdz","Reparent bones to common ancestor");const l=[];t==null||t.traverse(m=>{if(!(!e.exportInvisible&&!m.visible)&&m instanceof Io){const v=m.skeleton.bones,y=ZP(v);y&&l.push({object:m,originalParent:m.parent,newParent:y})}});for(const m of l){const{object:v,originalParent:y,newParent:b}=m;b.add(v)}st.report("export-usdz","Traversing hierarchy"),t&&tM(t,i.document,i,this.keepObject),st.report("export-usdz","Invoking onAfterBuildDocument"),await PA(i,"onAfterBuildDocument"),st.report("export-usdz",{message:"Parsing document",autoStep:10}),await VQ(i,()=>(st.report("export-usdz","Building materials"),ez(o,a,e.quickLookCompatible))),st.report("export-usdz","Invoking onAfterSerialize"),await PA(i,"onAfterSerialize");for(const m of l){const{object:v,originalParent:y,newParent:b}=m;y&&y.add(v)}const u=i.document.buildHeader(i)+`
`+i.output;this.debug&&console.log(u),s[r]=hv(u),i.output="",st.report("export-usdz",{message:"Exporting textures",autoStep:10}),st.start("export-usdz-textures","export-usdz");const d=new Hh({antialias:!1,alpha:!0,premultipliedAlpha:!1,preserveDrawingBuffer:!0}),f=Object.keys(a).length;st.report("export-usdz-textures",{totalSteps:f*3,currentStep:0});const p=async m=>{const v=a[m],y=v.texture,b=sM.includes(y.format);let _={imageData:y.image};st.report("export-usdz-textures",{message:"read back texture",autoStep:!0});const x=v.scale!==void 0&&v.scale.x!==1&&v.scale.y!==1&&v.scale.z!==1&&v.scale.w!==1;(y.isCompressedTexture||y.isRenderTargetTexture||x)&&(_=await WQ(y,e.maxTextureSize,d,v.scale)),st.report("export-usdz-textures",{message:"convert texture to canvas",autoStep:!0});const S=await XQ(_.imageBitmap||_.imageData,e.maxTextureSize).catch(T=>{console.error("Error converting texture to canvas",y,T)});if(S){st.report("export-usdz-textures",{message:"convert canvas to blob",autoStep:!0});const T=await S.convertToBlob({type:b?"image/png":"image/jpeg",quality:.95});s[`textures/${m}.${b?"png":"jpg"}`]=new Uint8Array(await T.arrayBuffer())}else console.warn("Can`t export texture: ",y)};for(const m in a)await p(m);d.dispose(),st.end("export-usdz-textures");let g=0;for(const m in s){const v=s[m],y=34+m.length;g+=y;const b=g&63;if(b!==4){const _=64-b,x=new Uint8Array(_);s[m]=[v,{extra:{12345:x}}]}g=v.length}return st.report("export-usdz","zip archive"),hQ(s,{level:0})}};function tM(n,t,e,i){if(!e.exportInvisible&&!n.visible)return;let s,r,o;if((n instanceof J||n instanceof Io)&&(r=n.geometry,o=n.material),i&&!i(n)&&(r=void 0,o=void 0),(n instanceof J||n instanceof Io)&&o&&(o instanceof mr||o instanceof St)){const a=Tm(n),l=n instanceof Io?n:null;s=new rs(n.uuid,a,n.matrix,r,o,void 0,l,n.animations)}else if(n instanceof xt||n instanceof Vh){const a=Tm(n);s=new rs(n.uuid,a,n.matrix,void 0,void 0,n)}else{const a=Tm(n);s=new rs(n.uuid,a,n.matrix,void 0,void 0,void 0,void 0,n.animations)}if(s){if(s.displayName=n.name,s.visibility=n.visible?void 0:"invisible",t&&t.add(s),t=s,e.extensions)for(const a of e.extensions)a.onExportObject&&a.onExportObject.call(a,n,s,e)}else{const a=Tm(n),l=new rs(n.uuid,a,n.matrix);t&&t.add(l),t=l}for(const a of n.children)tM(a,t,e,i)}async function VQ(n,t){st.start("export-usdz-resources","export-usdz");const e=[];for(const l of n.document.children)iM(l,n,e);const i=e.length;for(let l=0;l<i;l++)st.report("export-usdz-resources",{totalSteps:i,currentStep:l}),await new Promise((h,u)=>{e[l](),h()});st.end("export-usdz-resources");const s=new jQ,r=n.exporter.sceneAnchoringOptions.ar;s.beginBlock(`def Xform "${n.document.name}"`),s.beginBlock(`def Scope "Scenes" (
		kind = "sceneLibrary"
	)`),s.beginBlock('def Xform "Scene"',"(",!1),s.appendLine('apiSchemas = ["Preliminary_AnchoringAPI"]'),s.appendLine("customData = {"),s.appendLine("	bool preliminary_collidesWithEnvironment = 0"),s.appendLine('	string sceneName = "Scene"'),s.appendLine("}"),s.appendLine('sceneName = "Scene"'),s.closeBlock(")"),s.beginBlock(),s.appendLine(`token preliminary:anchoring:type = "${r.anchoring.type}"`),r.anchoring.type==="plane"&&s.appendLine(`token preliminary:planeAnchoring:alignment = "${r.planeAnchoring.alignment}"`),r.anchoring.type==="image"&&s.appendLine(`rel preliminary:imageAnchoring:referenceImage = </${n.document.name}/Scenes/Scene/AnchoringReferenceImage>`),s.appendLine();const o=l=>{if(!l)return 0;let h=1;for(const u of l.children)h+=o(u);return h},a=o(n.document);st.start("export-usdz-xforms","export-usdz"),st.report("export-usdz-xforms",{totalSteps:a,currentStep:1});for(const l of n.document.children)nM(l,s,n);st.end("export-usdz-xforms"),st.report("export-usdz","invoke onAfterHierarchy"),PA(n,"onAfterHierarchy",s),s.closeBlock(),s.closeBlock(),s.appendLine(t()),s.closeBlock(),st.report("export-usdz","write to string"),n.output+=s.toString()}function iM(n,t,e){if(!n)return;const i=n.geometry,s=n.material;if(i)if(s&&("isMeshStandardMaterial"in s&&s.isMeshStandardMaterial||"isMeshBasicMaterial"in s&&s.isMeshBasicMaterial)){const r="geometries/"+J_(i,n.name)+".usda";if(!(r in t.files)){const o=()=>{var l,h;const a=ZQ(i,(h=(l=n.skinnedMesh)==null?void 0:l.skeleton)==null?void 0:h.bones,t.quickLookCompatible);t.files[r]=JQ(a)};e.push(o)}}else console.warn("NeedleUSDZExporter: Unsupported material type (USDZ only supports MeshStandardMaterial)",name);s&&(s.uuid in t.materials||(t.materials[s.uuid]=s));for(const r of n.children)iM(r,t,e)}async function PA(n,t,e=null){if(n.extensions){for(const i of n.extensions)if(i&&typeof i[t]=="function"){const r=i[t].call(i,n,e);r instanceof Promise&&await r}}}let Em=null,As=null,gb,yu,Im;async function WQ(n,t=1/0,e=null,i=void 0){gb||(gb=new Ys(2,2,1,1)),yu||(yu=new $e({uniforms:{blitTexture:new $(n),flipY:new $(!1),scale:new $(new ke(1,1,1,1))},vertexShader:`
            varying vec2 vUv;
			uniform bool flipY;
            void main(){
                vUv = uv;
				if (flipY)
					vUv.y = 1. - vUv.y;
                gl_Position = vec4(position.xy * 1.0,0.,.999999);
            }`,fragmentShader:`
            uniform sampler2D blitTexture;
			uniform vec4 scale; 
            varying vec2 vUv;

            void main(){ 
                gl_FragColor = vec4(vUv.xy, 0, 1);
                
                #ifdef IS_SRGB
                gl_FragColor = LinearTosRGB( texture2D( blitTexture, vUv) );
                #else
                gl_FragColor = texture2D( blitTexture, vUv);
                #endif
				
				gl_FragColor.rgba *= scale.rgba;
            }`}));const s=yu.uniforms;s.blitTexture.value=n,s.flipY.value=!1,s.scale.value=new ke(1,1,1,1),i!==void 0&&s.scale.value.copy(i),yu.defines.IS_SRGB=n.colorSpace==Ue,yu.needsUpdate=!0,Im||(Im=new J(gb,yu),Im.frustumCulled=!1);const r=new xt,o=new Ws;o.add(Im),e||(e=Em=new Hh({antialias:!1,alpha:!0,premultipliedAlpha:!1,preserveDrawingBuffer:!0}));const a=Math.min(n.image.width,t),l=Math.min(n.image.height,t);As&&(As.width!==a||As.height!==l)&&(As.dispose(),As=null),As||(As=new Ct(a,l,{format:kn,type:oi,minFilter:Tt,magFilter:Tt})),e.setRenderTarget(As),e.setSize(a,l),e.clear(),e.render(o,r),Em&&(Em.dispose(),Em=null);const h=new Uint8ClampedArray(As.width*As.height*4);e.readRenderTargetPixels(As,0,0,As.width,As.height,h);const u=new ImageData(h,As.width,As.height,void 0),d=await createImageBitmap(u,{premultiplyAlpha:"none"});return{imageData:u,imageBitmap:d}}function qQ(n){return typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&n instanceof OffscreenCanvas||typeof ImageBitmap<"u"&&n instanceof ImageBitmap}async function XQ(n,t=4096){const e=t/Math.max(n.width,n.height),i=n.width*Math.min(1,e),s=n.height*Math.min(1,e),r=new OffscreenCanvas(i,s),o={premultiplyAlpha:"none"};n.width!==i&&(o.resizeWidth=i),n.height!==s&&(o.resizeHeight=s);const a=await createImageBitmap(n,o),l=r.getContext("bitmaprenderer");return l&&l.transferFromImageBitmap(a),r}async function YQ(n,t=void 0,e=!1,i=4096){if(qQ(n)){const s=i/Math.max(n.width,n.height),r=new OffscreenCanvas(n.width*Math.min(1,s),n.height*Math.min(1,s)),o=r.getContext("2d",{alpha:!0,premultipliedAlpha:!1});if(!o)throw new Error("Could not get canvas 2D context");if(e===!0&&(o.translate(0,r.height),o.scale(1,-1)),o.drawImage(n,0,0,r.width,r.height),t!==void 0){const a=t.x,l=t.y,h=t.z,u=t.w,d=o.getImageData(0,0,r.width,r.height),f=d.data;for(let p=0;p<f.length;p+=4)f[p+0]=f[p+0]*a,f[p+1]=f[p+1]*l,f[p+2]=f[p+2]*h,f[p+3]=f[p+3]*u;o.putImageData(d,0,0)}return r}else throw new Error("NeedleUSDZExporter: No valid image data found. Unable to process texture.")}const Mi=7;function KQ(){return`#usda 1.0
(
    customLayerData = {
        string creator = "Needle Engine USDZExporter"
    }
    metersPerUnit = 1
    upAxis = "Y"
)
`}function JQ(n,t){let e=KQ();return e+=n,hv(e)}function Tm(n){return n.name.replace(/[-<>\(\)\[\]Â§$%&\/\\\=\?\,\;]/g,"")+"_"+n.id}function YE(n){return Fa(n.name||"bone_"+n.uuid)}function J_(n,t){return Fa(n.name||"Geometry")+"_"+n.id}function Kx(n){return Fa(n.name||"Material")+"_"+n.id}function yd(n,t){let e=YE(n),i=n.parent;for(;i&&i!==t;)e=YE(i)+"/"+e,i=i.parent;return e}function nM(n,t,e){var f;if(n==null)return;st.report("export-usdz-xforms",{message:"buildXform "+n.displayName||n.name,autoStep:!0});const i=n.matrix,s=n.geometry,r=n.material,o=n.camera,a=n.name;if(n.animations)for(const p of n.animations)e.animations.push(p);const l=Hu(i);i.determinant()<0&&console.warn("NeedleUSDZExporter: USDZ does not support negative scales",a);const h=s&&s.isBufferGeometry&&s.attributes.skinIndex!==void 0&&s.attributes.skinIndex.count>0,u=h?"SkelRoot":"Xform",d=new Array;if(t.appendLine(),s?(t.beginBlock(`def ${u} "${a}"`,"(",!1),e.quickLookCompatible&&r&&r.side===pi&&!h?t.appendLine(`prepend references = @./geometries/${J_(s)}.usda@</Geometry_doubleSided>`):t.appendLine(`prepend references = @./geometries/${J_(s)}.usda@</Geometry>`),d.push("MaterialBindingAPI"),h&&d.push("SkelBindingAPI")):o?t.beginBlock(`def Camera "${a}"`,"(",!1):n.type!==void 0?t.beginBlock(`def ${n.type} "${a}"`):t.beginBlock(`def Xform "${a}"`,"(",!1),n.displayName&&t.appendLine(`displayName = "${n.displayName}"`),n.type===void 0&&((f=n.extraSchemas)!=null&&f.length&&d.push(...n.extraSchemas),d.length&&t.appendLine(`prepend apiSchemas = [${d.map(p=>`"${p}"`).join(", ")}]`),t.closeBlock(")"),t.beginBlock()),s&&r){const p=Kx(r);t.appendLine(`rel material:binding = </StageRoot/Materials/${p}>`),!e.quickLookCompatible&&r.side===pi&&(t.beginBlock('over "Geometry" '),t.appendLine("uniform bool doubleSided = 1"),t.closeBlock())}if(h?(t.appendLine("rel skel:skeleton = <Rig>"),t.appendLine("rel skel:animationSource = <Rig/_anim>"),t.appendLine(`matrix4d xformOp:transform = ${Hu(new ce)}`)):n.type===void 0&&t.appendLine(`matrix4d xformOp:transform = ${l}`),n.type===void 0&&t.appendLine('uniform token[] xformOpOrder = ["xformOp:transform"]'),n.visibility!==void 0&&t.appendLine(`token visibility = "${n.visibility}"`),o&&("isOrthographicCamera"in o&&o.isOrthographicCamera?(t.appendLine(`float2 clippingRange = (${o.near}, ${o.far})`),t.appendLine(`float horizontalAperture = ${((Math.abs(o.left)+Math.abs(o.right))*10).toPrecision(Mi)}`),t.appendLine(`float verticalAperture = ${((Math.abs(o.top)+Math.abs(o.bottom))*10).toPrecision(Mi)}`),t.appendLine('token projection = "orthographic"')):"isPerspectiveCamera"in o&&o.isPerspectiveCamera&&(t.appendLine(`float2 clippingRange = (${o.near.toPrecision(Mi)}, ${o.far.toPrecision(Mi)})`),t.appendLine(`float focalLength = ${o.getFocalLength().toPrecision(Mi)}`),t.appendLine(`float focusDistance = ${o.focus.toPrecision(Mi)}`),t.appendLine(`float horizontalAperture = ${o.getFilmWidth().toPrecision(Mi)}`),t.appendLine('token projection = "perspective"'),t.appendLine(`float verticalAperture = ${o.getFilmHeight().toPrecision(Mi)}`))),n.onSerialize&&n.onSerialize(t,e),n.children){t.appendLine();for(const p of n.children)nM(p,t,e)}t.closeBlock()}function an(n){return Number.isInteger(n)?n.toString():n.toFixed(10)}function Hu(n){const t=n.elements;return`( ${Rm(t,0)}, ${Rm(t,4)}, ${Rm(t,8)}, ${Rm(t,12)} )`}function Rm(n,t){return`(${an(n[t+0])}, ${an(n[t+1])}, ${an(n[t+2])}, ${an(n[t+3])})`}function ZQ(n,t=[],e=!0){return`
def "Geometry"
${$Q(n,t,e)}
`}function $Q(n,t=[],e=!0){const i="Geometry",s=n.attributes,r=s.position.count,o=t&&t.length>0,a=[],l=[];let h=new Array,u=s.skinIndex;if(o){const f=[];for(const m of t)m.parent.type!=="Bone"&&(a.push({bone:m,index:t.indexOf(m)}),f.push(m.uuid));for(;f.length<t.length;)for(const m of a){const v=m.bone.children;for(const y of v)f.indexOf(y.uuid)===-1&&t.indexOf(y)!==-1&&(a.push({bone:y,index:t.indexOf(y)}),f.push(y.uuid))}for(const m of $P(t))a.push({bone:m,index:a.length});const p=a[0].bone.parent;a.sort((m,v)=>yd(m.bone,p)>yd(v.bone,p)?1:-1),a.map(m=>'"'+yd(m.bone,p)+'"').join(", ");for(const m in a)l[a[m].index]=parseInt(m);const g=s.skinIndex;h=new Array;for(let m=0;m<g.count;m++){const v=g.getX(m),y=g.getY(m),b=g.getZ(m),_=g.getW(m);h.push(l[v],l[y],l[b],l[_])}u=new Ve(new Uint16Array(h),4)}const d=s.skinWeight&&s.skinIndex;return`
{	
    def Mesh "${i}" ${d?`(
        prepend apiSchemas = ["SkelBindingAPI"]
    )`:""}
    {
        int[] faceVertexCounts = [${mb(n)}]
        int[] faceVertexIndices = [${Ab(n)}]
		${s.normal||e?`normal3f[] normals = [${KE(s.normal,r)}] (
            interpolation = "vertex"
        )`:""}
        point3f[] points = [${KE(s.position,r)}]
        ${s.uv?`texCoord2f[] primvars:st = [${ZE(s.uv,r)}] (
            interpolation = "vertex"
        )`:""}
		${s.uv2?`texCoord2f[] primvars:st2 = [${ZE(s.uv2,r)}] (
            interpolation = "vertex"
        )`:""}
		${d?`matrix4d primvars:skel:geomBindTransform = ( (1, 0, 0, 0), (0, 1, 0, 0), (0, 0, 1, 0), (0, 0, 0, 1) ) (
				elementSize = 1
				interpolation = "constant"
			)`:""}
		${s.skinIndex?`int[] primvars:skel:jointIndices = [${JE(u,!0)}] (
			elementSize = 4
			interpolation = "vertex"
		)`:""}
		${s.skinWeight?`float[] primvars:skel:jointWeights = [${JE(s.skinWeight)}] (
			elementSize = 4
			interpolation = "vertex"
		)`:""}
        uniform token subdivisionScheme = "none"
    }
}
${e?`
# This is a workaround for QuickLook/RealityKit not supporting the doubleSided attribute. We're adding a second
# geometry definition here, that uses the same mesh data but appends extra faces with reversed winding order.
def "${i}_doubleSided" (
	prepend references = </Geometry>
)
{
	over "Geometry"
	{
		int[] faceVertexCounts = [${mb(n)+", "+mb(n)}]
		int[] faceVertexIndices = [${Ab(n)+", "+Ab(n,!0)}]
	}
}
`:""}
`}function mb(n){const t=n.index!==null?n.index.count:n.attributes.position.count;return Array(t/3).fill(3).join(", ")}function Ab(n,t=!1){const e=n.index,i=[];if(e!==null)for(let s=0;s<e.count;s++){let r=s;t&&(r=s%3===0?s+2:s%3===2?s-2:s),i.push(e.getX(r))}else{const s=n.attributes.position.count;for(let r=0;r<s;r++){let o=r;t&&(o=r%3===0?r+2:r%3===2?r-2:r),i.push(o)}}return i.join(", ")}function KE(n,t){if(n===void 0)return console.warn("USDZExporter: Attribute is missing. Results may be undefined."),Array(t).fill("(0, 0, 1)").join(", ");const e=[];for(let i=0;i<n.count;i++){const s=n.getX(i),r=n.getY(i),o=n.getZ(i);e.push(`(${s.toPrecision(Mi)}, ${r.toPrecision(Mi)}, ${o.toPrecision(Mi)})`)}return e.join(", ")}function JE(n,t=!1){const e=[];for(let i=0;i<n.count;i++){const s=n.getX(i),r=n.getY(i),o=n.getZ(i),a=n.getW(i);e.push(`${t?s:s.toPrecision(Mi)}`),e.push(`${t?r:r.toPrecision(Mi)}`),e.push(`${t?o:o.toPrecision(Mi)}`),e.push(`${t?a:a.toPrecision(Mi)}`)}return e.join(", ")}function ZE(n,t){if(n===void 0)return console.warn("USDZExporter: UVs missing."),Array(t).fill("(0, 0)").join(", ");const e=[];for(let i=0;i<n.count;i++){const s=n.getX(i),r=n.getY(i);e.push(`(${s.toPrecision(Mi)}, ${1-r.toPrecision(Mi)})`)}return e.join(", ")}function ez(n,t,e=!1){const i=[];for(const s in n){const r=n[s];i.push(tz(r,t,e))}return`
	def "Materials"
    {
${i.join("")}
    }`}function tz(n,t,e=!1){var p;const i="                ",s=[],r=[],o=Kx(n),a=new Set;function l(g){var m;return Fa(g.name)+"_"+(((m=g.source)==null?void 0:m.id)??g.id)}function h(g,m,v=void 0,y=void 0){const b=l(g),_=b+(y!==void 0&&y!==1?"_"+y:""),x=e&&y!==void 0&&y!==1,S=x?new ke(1,1,1,y):void 0;y===void 0&&(y=1),x&&(y=1),S&&S.w<=.05&&(S.w=.05),t[_]={texture:g,scale:S};const T=g.channel>0?"st"+g.channel:"st";a.add(g.channel);const L=sM.includes(g.format),I={1e3:"repeat",1001:"clamp",1002:"mirror"},P=g.repeat.clone(),R=g.offset.clone(),B=g.rotation,Q=Math.sin(B),G=Math.cos(B);R.y=1-R.y-P.y,e?(P.x===0&&(P.x=1e-4),P.y===0&&(P.y=1e-4),R.x=R.x/P.x,R.y=R.y/P.y,R.x+=Q/P.x,R.y+=G-1):(R.x+=Q*P.x,R.y+=(1-G)*P.y);const V=P.x!=1||P.y!=1||R.x!=0||R.y!=0||B!=0,X=`${Ns}/${o}/${"uvReader_"+T}.outputs:result>`,k=`${Ns}/${o}/Transform2d_${m}.outputs:result>`,M=m!=="normal"&&v&&(v.r!==1||v.g!==1||v.b!==1||y!==1)||!1,H=m==="normal",ee=n instanceof mr&&n.normalScale?n.normalScale.x*2:2,Y=ee.toFixed(Mi),he=(-1*(ee/2)).toFixed(Mi),de=(1-ee).toFixed(Mi);return`
			${V?`def Shader "Transform2d_${m}" (
				sdrMetadata = {
					string role = "math"
				}
			)
			{
				uniform token info:id = "UsdTransform2d"
				float2 inputs:in.connect = ${X}
				float2 inputs:scale = ${e1(P)}
				float2 inputs:translation = ${e1(R)}
				float inputs:rotation = ${(B/Math.PI*180).toFixed(Mi)}
				float2 outputs:result
			}
			`:""}
			def Shader "${b}_${m}"
			{
				uniform token info:id = "UsdUVTexture"
				asset inputs:file = @textures/${_}.${L?"png":"jpg"}@
				token inputs:sourceColorSpace = "${g.colorSpace==="srgb"?"sRGB":"raw"}"
				float2 inputs:st.connect = ${V?k:X}
				${M?`
				float4 inputs:scale = (${v?v.r+", "+v.g+", "+v.b:"1, 1, 1"}, ${y})
				`:""}
				${H?`
				float4 inputs:scale = (${Y}, ${Y}, ${Y}, 1)
				float4 inputs:bias = (${he}, ${he}, ${de}, 0)
				`:""}
				token inputs:wrapS = "${I[g.wrapS]}"
				token inputs:wrapT = "${I[g.wrapT]}"
				float outputs:r
				float outputs:g
				float outputs:b
				float3 outputs:rgb
				${n.transparent||n.alphaTest>0?"float outputs:a":""}
			}`}let u=n.transparent||n.alphaTest?n.opacity:1,d=!1,f=!1;if(n instanceof io&&n.transmission!==void 0&&(u*=1-n.transmission*(1-n.roughness*.5)),n.map?(s.push(`${i}color3f inputs:diffuseColor.connect = ${Ns}/${o}/${l(n.map)}_diffuse.outputs:rgb>`),n instanceof St&&n.transparent&&n.alphaTest==0&&e?(s.push(`${i}float inputs:opacity.connect = ${Ns}/${o}/${l(n.map)}_diffuse.outputs:a>`),d=!0,s.push(`${i}float inputs:opacityThreshold = ${1e-10}`),f=!0):n.transparent?(s.push(`${i}float inputs:opacity.connect = ${Ns}/${o}/${l(n.map)}_diffuse.outputs:a>`),d=!0):n.alphaTest>0&&(s.push(`${i}float inputs:opacity.connect = ${Ns}/${o}/${l(n.map)}_diffuse.outputs:a>`),d=!0,s.push(`${i}float inputs:opacityThreshold = ${n.alphaTest}`),f=!0),r.push(h(n.map,"diffuse",n.color,u))):s.push(`${i}color3f inputs:diffuseColor = ${$E(n.color)}`),n.alphaHash&&e&&(f?console.warn("Opacity threshold for "+n.name+" was already connected. Skipping alphaHash opacity threshold."):(s.push(`${i}float inputs:opacityThreshold = 0.0000000001`),f=!0)),n.aoMap&&(s.push(`${i}float inputs:occlusion.connect = ${Ns}/${o}/${l(n.aoMap)}_occlusion.outputs:r>`),r.push(h(n.aoMap,"occlusion"))),n.alphaMap?(s.push(`${i}float inputs:opacity.connect = ${Ns}/${o}/${l(n.alphaMap)}_opacity.outputs:r>`),s.push(`${i}float inputs:opacityThreshold = 0.0000000001`),d=!0,f=!0,r.push(h(n.alphaMap,"opacity",new we(1,1,1),u))):(d?console.warn("Opacity for "+n.name+" was already connected. Skipping default opacity."):(s.push(`${i}float inputs:opacity = ${u}`),d=!0),n.alphaTest>0&&(f?console.warn("Opacity threshold for "+n.name+" was already connected. Skipping default opacity threshold."):(s.push(`${i}float inputs:opacityThreshold = ${n.alphaTest}`),f=!0))),n instanceof mr){if(n.emissiveMap){s.push(`${i}color3f inputs:emissiveColor.connect = ${Ns}/${o}/${l(n.emissiveMap)}_emissive.outputs:rgb>`);const g=n.emissive.clone();g.multiplyScalar(n.emissiveIntensity),r.push(h(n.emissiveMap,"emissive",g))}else if(((p=n.emissive)==null?void 0:p.getHex())>0){const g=n.emissive.clone();g.multiplyScalar(n.emissiveIntensity),s.push(`${i}color3f inputs:emissiveColor = ${$E(g)}`)}n.normalMap&&(s.push(`${i}normal3f inputs:normal.connect = ${Ns}/${o}/${l(n.normalMap)}_normal.outputs:rgb>`),r.push(h(n.normalMap,"normal"))),n.roughnessMap&&n.roughness===1?(s.push(`${i}float inputs:roughness.connect = ${Ns}/${o}/${l(n.roughnessMap)}_roughness.outputs:g>`),r.push(h(n.roughnessMap,"roughness"))):s.push(`${i}float inputs:roughness = ${n.roughness!==void 0?n.roughness:1}`),n.metalnessMap&&n.metalness===1?(s.push(`${i}float inputs:metallic.connect = ${Ns}/${o}/${l(n.metalnessMap)}_metallic.outputs:b>`),r.push(h(n.metalnessMap,"metallic"))):s.push(`${i}float inputs:metallic = ${n.metalness!==void 0?n.metalness:0}`)}return n instanceof io&&(s.push(`${i}float inputs:clearcoat = ${n.clearcoat}`),s.push(`${i}float inputs:clearcoatRoughness = ${n.clearcoatRoughness}`),s.push(`${i}float inputs:ior = ${n.ior}`),!n.transparent&&!(n.alphaTest>0)&&n.transmissionMap&&(s.push(`${i}float inputs:opacity.connect = ${Ns}/${o}/${l(n.transmissionMap)}_transmission.outputs:r>`),r.push(h(n.transmissionMap,"transmission")))),a.size>2?console.warn("USDZExporter: Material "+n.name+" uses more than 2 UV channels. Currently, only UV0 and UV1 are supported."):a.size===2&&(!a.has(0)||!a.has(1))&&console.warn("USDZExporter: Material "+n.name+" uses UV channels other than 0 and 1. Currently, only UV0 and UV1 are supported."),`

		def Material "${o}" ${n.name?`(
			displayName = "${n.name}"
		)`:""}
		{
			token outputs:surface.connect = ${Ns}/${o}/PreviewSurface.outputs:surface>

			def Shader "PreviewSurface"
			{
				uniform token info:id = "UsdPreviewSurface"
${s.join(`
`)}
				int inputs:useSpecularWorkflow = ${n instanceof St?"1":"0"}
				token outputs:surface
			}
${r.length>0?`
${a.has(0)?`
			def Shader "uvReader_st"
			{
				uniform token info:id = "UsdPrimvarReader_float2"
				token inputs:varname = "st"
				float2 inputs:fallback = (0.0, 0.0)
				float2 outputs:result
			}
`:""}
${a.has(1)?`
			def Shader "uvReader_st2"
			{
				uniform token info:id = "UsdPrimvarReader_float2"
				token inputs:varname = "st2"
				float2 inputs:fallback = (0.0, 0.0)
				float2 outputs:result
			}
`:""}
${r.join(`
`)}`:""}
		}`}function $E(n){return`(${n.r}, ${n.g}, ${n.b})`}function e1(n){return`(${n.x}, ${n.y})`}const sM=[1023,33777,33778,33779,35842,35843,37496,37808,37809,37810,37811,37812,37813,37814,37815,37816,37817,37818,37819,37820,37821,36492];N("debugusdz");const ES=class{constructor(t,e,i){c(this,"id");c(this,"trigger");c(this,"action");c(this,"exclusive",!1);this.id="Behavior_"+Fa(t)+"_"+ES.global_id++,this.trigger=e,this.action=i}makeExclusive(t){return this.exclusive=t,this}writeTo(t,e,i){if(!this.trigger||!this.action)return;i.beginBlock(`def Preliminary_Behavior "${this.id}"`);let s="";if(Array.isArray(this.trigger)){s="[";for(let r=0;r<this.trigger.length;r++){const o=this.trigger[r];s+="<"+o.id+">",r+1<this.trigger.length&&(s+=", ")}s+="]"}else s=`<${this.trigger.id}>`;if(i.appendLine(`rel triggers = ${s}`),i.appendLine(`rel actions = <${this.action.id}>`),i.appendLine(`uniform bool exclusive = ${this.exclusive?1:0}`),i.appendLine(),Array.isArray(this.trigger))for(const r of this.trigger)r.writeTo(e,i),i.appendLine();else this.trigger.writeTo(e,i);i.appendLine(),this.action.writeTo(e,i),i.closeBlock()}};let Ki=ES;c(Ki,"global_id",0);const bu=new Set;function Z_(n,t){var i,s;let e="";if(Array.isArray(n)){bu.clear();let r="[ ";for(let o=0;o<n.length;o++){let a=n[o];if(!a){console.warn("Invalid target object in behavior",n+". Is the object exported?");continue}if(typeof a=="string"){if(bu.has(a))continue;r+=a,bu.add(a)}else if(typeof a=="object"){if(a.isObject3D&&(a=t.findById(a.uuid),!a)){console.warn("Invalid target object in behavior",n+". Is the object exported?");continue}const l=(i=a.getPath)==null?void 0:i.call(a);if(bu.has(l))continue;r+=l,bu.add(l)}o+1<n.length&&(r+=", ")}r+=" ]",e=r,bu.clear()}else typeof n=="object"&&(n.isObject3D&&(n=t.findById(n.uuid)),e=(s=n.getPath)==null?void 0:s.call(n));return e}const IS=class{constructor(t,e){c(this,"id");c(this,"targetId");c(this,"tokenId");c(this,"type");c(this,"distance");t&&(this.targetId=t),e?this.id=e:this.id="Trigger_"+IS.global_id++}writeTo(t,e){e.beginBlock(`def Preliminary_Trigger "${this.id}"`),this.targetId&&(typeof this.targetId!="string"&&(this.targetId=Z_(this.targetId,t)),e.appendLine("rel affectedObjects = "+this.targetId)),this.tokenId&&e.appendLine(`token info:id = "${this.tokenId}"`),this.type&&e.appendLine(`token type = "${this.type}"`),typeof this.distance=="number"&&e.appendLine(`double distance = ${this.distance}`),e.closeBlock()}};let Ic=IS;c(Ic,"global_id",0);function t1(n,t={direct:!0,indirect:!0}){const e=rs.createEmpty();e.name="InputTarget_"+e.name,e.displayName=void 0,e.type="RealityKitComponent",e.onSerialize=i=>{i.appendLine("bool allowsDirectInput = "+(t.direct?1:0)),i.appendLine("bool allowsIndirectInput = "+(t.indirect?1:0)),i.appendLine('uniform token info:id = "RealityKit.InputTarget"')},n.add(e)}class Ln{static sceneStartTrigger(){const t=new Ic;return t.targetId=void 0,t.tokenId="SceneTransition",t.type="enter",t}static tapTrigger(t,e={direct:!0,indirect:!0}){const i=new Ic(t);if(Array.isArray(t)&&t.length>1)for(const s of t)s instanceof rs&&t1(s,e);else t instanceof rs&&t1(t,e);return i.tokenId="TapGesture",i}static isTapTrigger(t){return(t==null?void 0:t.tokenId)==="TapGesture"}static proximityToCameraTrigger(t,e){const i=new Ic(t);return i.tokenId="ProximityToCamera",i.distance=e,i}}class ph{constructor(t,e){c(this,"id");c(this,"actions");c(this,"loops",0);c(this,"performCount",1);c(this,"type","serial");c(this,"multiplePerformOperation");this.id=t,this.actions=e}static getId(){return this.global_id++}addAction(t){return this.actions.push(t),this}makeParallel(){return this.type="parallel",this}makeSequence(){return this.type="serial",this}makeLooping(){return this.loops=1,this.performCount=0,this}makeRepeat(t){return this.performCount=t,this}writeTo(t,e){e.beginBlock(`def Preliminary_Action "${this.id}"`),e.beginArray("rel actions");for(const i of this.actions){if(!i)continue;const s=i===this.actions[this.actions.length-1];e.appendLine("<"+i.id+">"+(s?"":", "))}e.closeArray(),e.appendLine(),e.appendLine('token info:id = "Group"'),e.appendLine(`bool loops = ${this.loops}`),e.appendLine(`int performCount = ${this.loops>0?0:Math.max(0,this.performCount)}`),e.appendLine(`token type = "${this.type}"`),typeof this.multiplePerformOperation=="string"&&e.appendLine(`token multiplePerformOperation = "${this.multiplePerformOperation}"`),e.appendLine();for(const i of this.actions)i&&(i.writeTo(t,e),e.appendLine());e.closeBlock()}}c(ph,"global_id",0);const Zv=class{constructor(t,e){c(this,"id");c(this,"tokenId");c(this,"affectedObjects");c(this,"easeType");c(this,"motionType");c(this,"duration");c(this,"moveDistance");c(this,"style");c(this,"type");c(this,"front");c(this,"up");c(this,"start");c(this,"animationSpeed");c(this,"reversed");c(this,"pingPong");c(this,"xFormTarget");c(this,"audio");c(this,"gain");c(this,"auralMode");c(this,"multiplePerformOperation");c(this,"velocity");t&&(this.affectedObjects=t),e?this.id=e:this.id="Action",this.id+="_"+Zv.global_id++}clone(){const t=new Zv,e=t.id;return Object.assign(t,this),t.id=e,t}writeTo(t,e){e.beginBlock(`def Preliminary_Action "${this.id}"`),this.affectedObjects&&(typeof this.affectedObjects!="string"&&(this.affectedObjects=Z_(this.affectedObjects,t)),e.appendLine("rel affectedObjects = "+this.affectedObjects)),typeof this.duration=="number"&&(typeof this.animationSpeed=="number"&&this.animationSpeed!==1?e.appendLine(`double duration = ${this.duration/this.animationSpeed} `):e.appendLine(`double duration = ${this.duration} `)),this.easeType&&e.appendLine(`token easeType = "${this.easeType}"`),this.tokenId&&e.appendLine(`token info:id = "${this.tokenId}"`),this.tokenId==="ChangeScene"&&e.appendLine("rel scene = </StageRoot/Scenes/Scene>"),this.motionType!==void 0&&e.appendLine(`token motionType = "${this.motionType}"`),typeof this.moveDistance=="number"&&e.appendLine(`double moveDistance = ${this.moveDistance} `),this.style&&e.appendLine(`token style = "${this.style}"`),this.type&&e.appendLine(`token type = "${this.type}"`),this.front&&e.appendLine(`vector3d front = (${this.front.x}, ${this.front.y}, ${this.front.z})`),this.up&&e.appendLine(`vector3d upVector = (${this.up.x}, ${this.up.y}, ${this.up.z})`),typeof this.start=="number"&&e.appendLine(`double start = ${this.start} `),typeof this.animationSpeed=="number"&&e.appendLine(`double animationSpeed = ${this.animationSpeed.toFixed(2)} `),typeof this.reversed=="boolean"&&e.appendLine(`bool reversed = ${this.reversed}`),typeof this.pingPong=="boolean"&&e.appendLine(`bool reverses = ${this.pingPong}`),this.xFormTarget&&(typeof this.xFormTarget!="string"&&(this.xFormTarget=Z_(this.xFormTarget,t)),e.appendLine(`rel xformTarget = ${this.xFormTarget}`)),typeof this.audio=="string"&&e.appendLine(`asset audio = @${this.audio}@`),typeof this.gain=="number"&&e.appendLine(`double gain = ${this.gain}`),typeof this.auralMode=="string"&&e.appendLine(`token auralMode = "${this.auralMode}"`),typeof this.multiplePerformOperation=="string"&&e.appendLine(`token multiplePerformOperation = "${this.multiplePerformOperation}"`),typeof this.velocity=="object"&&e.appendLine(`vector3d velocity = (${this.velocity.x}, ${this.velocity.y}, ${this.velocity.z})`),e.closeBlock()}};let ur=Zv;c(ur,"global_id",0);let Vu=class ku{constructor(t,e,i){c(this,"x",0);c(this,"y",0);c(this,"z",0);this.x=t,this.y=e,this.z=i}static get up(){return new ku(0,1,0)}static get right(){return new ku(1,0,0)}static get forward(){return new ku(0,0,1)}static get back(){return new ku(0,0,-1)}static get zero(){return new ku(0,0,0)}};class At{static sequence(...t){return new ph("Group_"+ph.getId(),t).makeSequence()}static parallel(...t){return new ph("Group_"+ph.getId(),t).makeParallel()}static fadeAction(t,e,i){const s=new ur(t);return s.tokenId="Visibility",s.type=i?"show":"hide",s.duration=e,s.style="basic",s.motionType="none",s.moveDistance=0,s.easeType="none",s}static startAnimationAction(t,e,i=0,s=1,r=!1,o=!1){const a=new ur(t);if(a.tokenId="StartAnimation",a.start=e,a.duration=i,a.animationSpeed=s,a.reversed=r,a.pingPong=o,a.multiplePerformOperation="allow",r&&(a.start-=i),o){a.pingPong=!1;const l=a.clone();return l.reversed=!r,l.start=a.start,l.reversed&&(l.start-=i),At.sequence(a,l)}return a}static waitAction(t){const e=new ur;return e.tokenId="Wait",e.duration=t,e.motionType=void 0,e}static lookAtCameraAction(t,e,i,s){const r=new ur(t);return r.tokenId="LookAtCamera",r.duration=e===void 0?9999999999999:e,r.front=i??Vu.forward,r.up=s??Vu.up,r}static emphasize(t,e,i="bounce",s=1,r="basic"){const o=new ur(t);return o.tokenId="Emphasize",o.duration=e,o.style=r??"basic",o.motionType=i,o.moveDistance=s,o}static transformAction(t,e,i,s,r="inout"){const o=new ur(t);return o.tokenId="Transform",o.duration=i,o.duration=Math.max(1e-6,i),o.type=s,o.easeType=i>0?r:"none",Array.isArray(e)&&console.error("Transform target must not be an array",e),o.xFormTarget=e,o}static playAudioAction(t,e,i="play",s=1,r="spatial"){const o=new ur(t);return o.tokenId="Audio",o.type=i,o.audio=e,o.gain=s,o.auralMode=r,o.multiplePerformOperation="allow",o}static impulseAction(t,e){const i=new ur(t);return i.tokenId="Impulse",i.velocity=e,i}}class iz{constructor(t){c(this,"object");c(this,"model");this.object=t}get id(){return this.object.uuid}apply(t){if(!this.model&&(this.model=t.findById(this.object.uuid),!this.model)){console.error("could not find model with id "+this.object.uuid);return}this.onApply(t)}}class rM extends iz{constructor(e,i,s,r){super(e);c(this,"matrix");c(this,"material");c(this,"geometry");c(this,"_enableAction");c(this,"_disableAction");this.matrix=i,this.material=s,this.geometry=r}onApply(e){var r,o;const i=this.model;if(!i)return;(r=i.parent)!=null&&r.isDynamic||rs.createEmptyParent(i);const s=i.clone();this.matrix&&(s.matrix=this.matrix),this.material&&(s.material=this.material),this.geometry&&(s.geometry=this.geometry),(o=i.parent)==null||o.add(s)}enable(){return this._enableAction?this._enableAction:(this._enableAction=At.fadeAction(this.object,0,!0),this._enableAction)}disable(){return this._disableAction?this._disableAction:(this._disableAction=At.fadeAction(this.object,0,!1),this._disableAction)}}class oM{constructor(t){c(this,"actions");c(this,"sortedActions");this.actions=[...t]}organize(){this.sortedActions={};for(const t of this.actions){const e=t.id;this.sortedActions[e]||(this.sortedActions[e]=[]),this.sortedActions[e].push(t)}}getActions(t){return this.sortedActions||this.organize(),this.sortedActions[t.uuid]}}const kg=function(n){return A(n)},A=function(n){if(n===void 0&&(n=null),!Array.isArray(n))n=i1(n);else for(let t=0;t<n.length;t++){const e=n[t];n[t]=i1(e)}return function(t,e){typeof e!="string"&&(e=e.name),Object.getOwnPropertyDescriptor(t,"$serializedTypes")||(t.$serializedTypes={});const i=t.$serializedTypes=t.$serializedTypes||{};i[e]=n}};function i1(n){var t,e;switch((e=(t=n==null?void 0:n.prototype)==null?void 0:t.constructor)==null?void 0:e.name){case"Number":case"String":case"Boolean":return null}return n}const Kc=new jd,es=new C,Hl=new C,si=new ne,n1={X:new C(1,0,0),Y:new C(0,1,0),Z:new C(0,0,1)},vb={type:"change"},s1={type:"mouseDown"},r1={type:"mouseUp",mode:null},o1={type:"objectChange"};class nz extends re{constructor(t,e){super(),e===void 0&&(console.warn('THREE.TransformControls: The second parameter "domElement" is now mandatory.'),e=document),this.isTransformControls=!0,this.visible=!1,this.domElement=e,this.domElement.style.touchAction="none";const i=new Jx;this._gizmo=i,this.add(i);const s=new cz;this._plane=s,this.add(s);const r=this;function o(b,_){let x=_;Object.defineProperty(r,b,{get:function(){return x!==void 0?x:_},set:function(S){x!==S&&(x=S,s[b]=S,i[b]=S,r.dispatchEvent({type:b+"-changed",value:S}),r.dispatchEvent(vb))}}),r[b]=_,s[b]=_,i[b]=_}o("camera",t),o("object",void 0),o("enabled",!0),o("axis",null),o("mode","translate"),o("translationSnap",null),o("rotationSnap",null),o("scaleSnap",null),o("space","world"),o("size",1),o("dragging",!1),o("showX",!0),o("showY",!0),o("showZ",!0);const a=new C,l=new C,h=new ne,u=new ne,d=new C,f=new ne,p=new C,g=new C,m=new C,v=0,y=new C;o("worldPosition",a),o("worldPositionStart",l),o("worldQuaternion",h),o("worldQuaternionStart",u),o("cameraPosition",d),o("cameraQuaternion",f),o("pointStart",p),o("pointEnd",g),o("rotationAxis",m),o("rotationAngle",v),o("eye",y),this._offset=new C,this._startNorm=new C,this._endNorm=new C,this._cameraScale=new C,this._parentPosition=new C,this._parentQuaternion=new ne,this._parentQuaternionInv=new ne,this._parentScale=new C,this._worldScaleStart=new C,this._worldQuaternionInv=new ne,this._worldScale=new C,this._positionStart=new C,this._quaternionStart=new ne,this._scaleStart=new C,this._getPointer=sz.bind(this),this._onPointerDown=oz.bind(this),this._onPointerHover=rz.bind(this),this._onPointerMove=az.bind(this),this._onPointerUp=lz.bind(this),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointermove",this._onPointerHover),this.domElement.addEventListener("pointerup",this._onPointerUp)}updateMatrixWorld(){this.object!==void 0&&(this.object.updateMatrixWorld(),this.object.parent===null?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):this.object.parent.matrixWorld.decompose(this._parentPosition,this._parentQuaternion,this._parentScale),this.object.matrixWorld.decompose(this.worldPosition,this.worldQuaternion,this._worldScale),this._parentQuaternionInv.copy(this._parentQuaternion).invert(),this._worldQuaternionInv.copy(this.worldQuaternion).invert()),this.camera.updateMatrixWorld(),this.camera.matrixWorld.decompose(this.cameraPosition,this.cameraQuaternion,this._cameraScale),this.camera.isOrthographicCamera?this.camera.getWorldDirection(this.eye).negate():this.eye.copy(this.cameraPosition).sub(this.worldPosition).normalize(),super.updateMatrixWorld(this)}pointerHover(t){if(this.object===void 0||this.dragging===!0)return;t!==null&&Kc.setFromCamera(t,this.camera);const e=yb(this._gizmo.picker[this.mode],Kc);e?this.axis=e.object.name:this.axis=null}pointerDown(t){if(!(this.object===void 0||this.dragging===!0||t!=null&&t.button!==0)&&this.axis!==null){t!==null&&Kc.setFromCamera(t,this.camera);const e=yb(this._plane,Kc,!0);e&&(this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),this._positionStart.copy(this.object.position),this._quaternionStart.copy(this.object.quaternion),this._scaleStart.copy(this.object.scale),this.object.matrixWorld.decompose(this.worldPositionStart,this.worldQuaternionStart,this._worldScaleStart),this.pointStart.copy(e.point).sub(this.worldPositionStart)),this.dragging=!0,s1.mode=this.mode,this.dispatchEvent(s1)}}pointerMove(t){const e=this.axis,i=this.mode,s=this.object;let r=this.space;if(i==="scale"?r="local":(e==="E"||e==="XYZE"||e==="XYZ")&&(r="world"),s===void 0||e===null||this.dragging===!1||t!==null&&t.button!==-1)return;t!==null&&Kc.setFromCamera(t,this.camera);const o=yb(this._plane,Kc,!0);if(o){if(this.pointEnd.copy(o.point).sub(this.worldPositionStart),i==="translate")this._offset.copy(this.pointEnd).sub(this.pointStart),r==="local"&&e!=="XYZ"&&this._offset.applyQuaternion(this._worldQuaternionInv),e.indexOf("X")===-1&&(this._offset.x=0),e.indexOf("Y")===-1&&(this._offset.y=0),e.indexOf("Z")===-1&&(this._offset.z=0),r==="local"&&e!=="XYZ"?this._offset.applyQuaternion(this._quaternionStart).divide(this._parentScale):this._offset.applyQuaternion(this._parentQuaternionInv).divide(this._parentScale),s.position.copy(this._offset).add(this._positionStart),this.translationSnap&&(r==="local"&&(s.position.applyQuaternion(si.copy(this._quaternionStart).invert()),e.search("X")!==-1&&(s.position.x=Math.round(s.position.x/this.translationSnap)*this.translationSnap),e.search("Y")!==-1&&(s.position.y=Math.round(s.position.y/this.translationSnap)*this.translationSnap),e.search("Z")!==-1&&(s.position.z=Math.round(s.position.z/this.translationSnap)*this.translationSnap),s.position.applyQuaternion(this._quaternionStart)),r==="world"&&(s.parent&&s.position.add(es.setFromMatrixPosition(s.parent.matrixWorld)),e.search("X")!==-1&&(s.position.x=Math.round(s.position.x/this.translationSnap)*this.translationSnap),e.search("Y")!==-1&&(s.position.y=Math.round(s.position.y/this.translationSnap)*this.translationSnap),e.search("Z")!==-1&&(s.position.z=Math.round(s.position.z/this.translationSnap)*this.translationSnap),s.parent&&s.position.sub(es.setFromMatrixPosition(s.parent.matrixWorld))));else if(i==="scale"){if(e.search("XYZ")!==-1){let a=this.pointEnd.length()/this.pointStart.length();this.pointEnd.dot(this.pointStart)<0&&(a*=-1),Hl.set(a,a,a)}else es.copy(this.pointStart),Hl.copy(this.pointEnd),es.applyQuaternion(this._worldQuaternionInv),Hl.applyQuaternion(this._worldQuaternionInv),Hl.divide(es),e.search("X")===-1&&(Hl.x=1),e.search("Y")===-1&&(Hl.y=1),e.search("Z")===-1&&(Hl.z=1);s.scale.copy(this._scaleStart).multiply(Hl),this.scaleSnap&&(e.search("X")!==-1&&(s.scale.x=Math.round(s.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),e.search("Y")!==-1&&(s.scale.y=Math.round(s.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),e.search("Z")!==-1&&(s.scale.z=Math.round(s.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if(i==="rotate"){this._offset.copy(this.pointEnd).sub(this.pointStart);const a=20/this.worldPosition.distanceTo(es.setFromMatrixPosition(this.camera.matrixWorld));let l=!1;e==="XYZE"?(this.rotationAxis.copy(this._offset).cross(this.eye).normalize(),this.rotationAngle=this._offset.dot(es.copy(this.rotationAxis).cross(this.eye))*a):(e==="X"||e==="Y"||e==="Z")&&(this.rotationAxis.copy(n1[e]),es.copy(n1[e]),r==="local"&&es.applyQuaternion(this.worldQuaternion),es.cross(this.eye),es.length()===0?l=!0:this.rotationAngle=this._offset.dot(es.normalize())*a),(e==="E"||l)&&(this.rotationAxis.copy(this.eye),this.rotationAngle=this.pointEnd.angleTo(this.pointStart),this._startNorm.copy(this.pointStart).normalize(),this._endNorm.copy(this.pointEnd).normalize(),this.rotationAngle*=this._endNorm.cross(this._startNorm).dot(this.eye)<0?1:-1),this.rotationSnap&&(this.rotationAngle=Math.round(this.rotationAngle/this.rotationSnap)*this.rotationSnap),r==="local"&&e!=="E"&&e!=="XYZE"?(s.quaternion.copy(this._quaternionStart),s.quaternion.multiply(si.setFromAxisAngle(this.rotationAxis,this.rotationAngle)).normalize()):(this.rotationAxis.applyQuaternion(this._parentQuaternionInv),s.quaternion.copy(si.setFromAxisAngle(this.rotationAxis,this.rotationAngle)),s.quaternion.multiply(this._quaternionStart).normalize())}this.dispatchEvent(vb),this.dispatchEvent(o1)}}pointerUp(t){t!==null&&t.button!==0||(this.dragging&&this.axis!==null&&(r1.mode=this.mode,this.dispatchEvent(r1)),this.dragging=!1,this.axis=null)}dispose(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerHover),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.traverse(function(t){t.geometry&&t.geometry.dispose(),t.material&&t.material.dispose()})}attach(t){return this.object=t,this.visible=!0,this}detach(){return this.object=void 0,this.visible=!1,this.axis=null,this}reset(){this.enabled&&this.dragging&&(this.object.position.copy(this._positionStart),this.object.quaternion.copy(this._quaternionStart),this.object.scale.copy(this._scaleStart),this.dispatchEvent(vb),this.dispatchEvent(o1),this.pointStart.copy(this.pointEnd))}getRaycaster(){return Kc}getMode(){return this.mode}setMode(t){this.mode=t}setTranslationSnap(t){this.translationSnap=t}setRotationSnap(t){this.rotationSnap=t}setScaleSnap(t){this.scaleSnap=t}setSize(t){this.size=t}setSpace(t){this.space=t}}function sz(n){if(this.domElement.ownerDocument.pointerLockElement)return{x:0,y:0,button:n.button};{const t=this.domElement.getBoundingClientRect();return{x:(n.clientX-t.left)/t.width*2-1,y:-(n.clientY-t.top)/t.height*2+1,button:n.button}}}function rz(n){if(this.enabled)switch(n.pointerType){case"mouse":case"pen":this.pointerHover(this._getPointer(n));break}}function oz(n){this.enabled&&(document.pointerLockElement||this.domElement.setPointerCapture(n.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.pointerHover(this._getPointer(n)),this.pointerDown(this._getPointer(n)))}function az(n){this.enabled&&this.pointerMove(this._getPointer(n))}function lz(n){this.enabled&&(this.domElement.releasePointerCapture(n.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.pointerUp(this._getPointer(n)))}function yb(n,t,e){const i=t.intersectObject(n,!0);for(let s=0;s<i.length;s++)if(i[s].object.visible||e)return i[s];return!1}const Bm=new fi,Qt=new C(0,1,0),a1=new C(0,0,0),l1=new ce,Pm=new ne,MA=new ne,qo=new C,c1=new ce,ep=new C(1,0,0),rh=new C(0,1,0),tp=new C(0,0,1),Mm=new C,Bf=new C,Pf=new C;class Jx extends re{constructor(){super(),this.isTransformControlsGizmo=!0,this.type="TransformControlsGizmo";const t=new St({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),e=new Ba({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),i=t.clone();i.opacity=.15;const s=e.clone();s.opacity=.5;const r=t.clone();r.color.setHex(16711680);const o=t.clone();o.color.setHex(65280);const a=t.clone();a.color.setHex(255);const l=t.clone();l.color.setHex(16711680),l.opacity=.5;const h=t.clone();h.color.setHex(65280),h.opacity=.5;const u=t.clone();u.color.setHex(255),u.opacity=.5;const d=t.clone();d.opacity=.25;const f=t.clone();f.color.setHex(16776960),f.opacity=.25,t.clone().color.setHex(16776960);const g=t.clone();g.color.setHex(7895160);const m=new _s(0,.04,.1,12);m.translate(0,.05,0);const v=new Xi(.08,.08,.08);v.translate(0,.04,0);const y=new jt;y.setAttribute("position",new hn([0,0,0,1,0,0],3));const b=new _s(.0075,.0075,.5,3);b.translate(0,.25,0);function _(X,k){const M=new yf(X,.0075,3,64,k*Math.PI*2);return M.rotateY(Math.PI/2),M.rotateX(Math.PI/2),M}function x(){const X=new jt;return X.setAttribute("position",new hn([0,0,0,1,1,1],3)),X}const S={X:[[new J(m,r),[.5,0,0],[0,0,-Math.PI/2]],[new J(m,r),[-.5,0,0],[0,0,Math.PI/2]],[new J(b,r),[0,0,0],[0,0,-Math.PI/2]]],Y:[[new J(m,o),[0,.5,0]],[new J(m,o),[0,-.5,0],[Math.PI,0,0]],[new J(b,o)]],Z:[[new J(m,a),[0,0,.5],[Math.PI/2,0,0]],[new J(m,a),[0,0,-.5],[-Math.PI/2,0,0]],[new J(b,a),null,[Math.PI/2,0,0]]],XYZ:[[new J(new gm(.1,0),d.clone()),[0,0,0]]],XY:[[new J(new Xi(.15,.15,.01),u.clone()),[.15,.15,0]]],YZ:[[new J(new Xi(.15,.15,.01),l.clone()),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new J(new Xi(.15,.15,.01),h.clone()),[.15,0,.15],[-Math.PI/2,0,0]]]},T={X:[[new J(new _s(.2,0,.6,4),i),[.3,0,0],[0,0,-Math.PI/2]],[new J(new _s(.2,0,.6,4),i),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new J(new _s(.2,0,.6,4),i),[0,.3,0]],[new J(new _s(.2,0,.6,4),i),[0,-.3,0],[0,0,Math.PI]]],Z:[[new J(new _s(.2,0,.6,4),i),[0,0,.3],[Math.PI/2,0,0]],[new J(new _s(.2,0,.6,4),i),[0,0,-.3],[-Math.PI/2,0,0]]],XYZ:[[new J(new gm(.2,0),i)]],XY:[[new J(new Xi(.2,.2,.01),i),[.15,.15,0]]],YZ:[[new J(new Xi(.2,.2,.01),i),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new J(new Xi(.2,.2,.01),i),[.15,0,.15],[-Math.PI/2,0,0]]]},L={START:[[new J(new gm(.01,2),s),null,null,null,"helper"]],END:[[new J(new gm(.01,2),s),null,null,null,"helper"]],DELTA:[[new Hs(x(),s),null,null,null,"helper"]],X:[[new Hs(y,s.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new Hs(y,s.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new Hs(y,s.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},I={XYZE:[[new J(_(.5,1),g),null,[0,Math.PI/2,0]]],X:[[new J(_(.5,.5),r)]],Y:[[new J(_(.5,.5),o),null,[0,0,-Math.PI/2]]],Z:[[new J(_(.5,.5),a),null,[0,Math.PI/2,0]]],E:[[new J(_(.75,1),f),null,[0,Math.PI/2,0]]]},P={AXIS:[[new Hs(y,s.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},R={XYZE:[[new J(new Qd(.25,10,8),i)]],X:[[new J(new yf(.5,.1,4,24),i),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new J(new yf(.5,.1,4,24),i),[0,0,0],[Math.PI/2,0,0]]],Z:[[new J(new yf(.5,.1,4,24),i),[0,0,0],[0,0,-Math.PI/2]]],E:[[new J(new yf(.75,.1,2,24),i)]]},B={X:[[new J(v,r),[.5,0,0],[0,0,-Math.PI/2]],[new J(b,r),[0,0,0],[0,0,-Math.PI/2]],[new J(v,r),[-.5,0,0],[0,0,Math.PI/2]]],Y:[[new J(v,o),[0,.5,0]],[new J(b,o)],[new J(v,o),[0,-.5,0],[0,0,Math.PI]]],Z:[[new J(v,a),[0,0,.5],[Math.PI/2,0,0]],[new J(b,a),[0,0,0],[Math.PI/2,0,0]],[new J(v,a),[0,0,-.5],[-Math.PI/2,0,0]]],XY:[[new J(new Xi(.15,.15,.01),u),[.15,.15,0]]],YZ:[[new J(new Xi(.15,.15,.01),l),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new J(new Xi(.15,.15,.01),h),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new J(new Xi(.1,.1,.1),d.clone())]]},Q={X:[[new J(new _s(.2,0,.6,4),i),[.3,0,0],[0,0,-Math.PI/2]],[new J(new _s(.2,0,.6,4),i),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new J(new _s(.2,0,.6,4),i),[0,.3,0]],[new J(new _s(.2,0,.6,4),i),[0,-.3,0],[0,0,Math.PI]]],Z:[[new J(new _s(.2,0,.6,4),i),[0,0,.3],[Math.PI/2,0,0]],[new J(new _s(.2,0,.6,4),i),[0,0,-.3],[-Math.PI/2,0,0]]],XY:[[new J(new Xi(.2,.2,.01),i),[.15,.15,0]]],YZ:[[new J(new Xi(.2,.2,.01),i),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new J(new Xi(.2,.2,.01),i),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new J(new Xi(.2,.2,.2),i),[0,0,0]]]},G={X:[[new Hs(y,s.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new Hs(y,s.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new Hs(y,s.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]};function V(X){const k=new re;for(const M in X)for(let H=X[M].length;H--;){const ee=X[M][H][0].clone(),Y=X[M][H][1],he=X[M][H][2],de=X[M][H][3],ve=X[M][H][4];ee.name=M,ee.tag=ve,Y&&ee.position.set(Y[0],Y[1],Y[2]),he&&ee.rotation.set(he[0],he[1],he[2]),de&&ee.scale.set(de[0],de[1],de[2]),ee.updateMatrix();const _e=ee.geometry.clone();_e.applyMatrix4(ee.matrix),ee.geometry=_e,ee.renderOrder=1/0,ee.position.set(0,0,0),ee.rotation.set(0,0,0),ee.scale.set(1,1,1),k.add(ee)}return k}this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=V(S)),this.add(this.gizmo.rotate=V(I)),this.add(this.gizmo.scale=V(B)),this.add(this.picker.translate=V(T)),this.add(this.picker.rotate=V(R)),this.add(this.picker.scale=V(Q)),this.add(this.helper.translate=V(L)),this.add(this.helper.rotate=V(P)),this.add(this.helper.scale=V(G)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1}updateMatrixWorld(t){const i=(this.mode==="scale"?"local":this.space)==="local"?this.worldQuaternion:MA;this.gizmo.translate.visible=this.mode==="translate",this.gizmo.rotate.visible=this.mode==="rotate",this.gizmo.scale.visible=this.mode==="scale",this.helper.translate.visible=this.mode==="translate",this.helper.rotate.visible=this.mode==="rotate",this.helper.scale.visible=this.mode==="scale";let s=[];s=s.concat(this.picker[this.mode].children),s=s.concat(this.gizmo[this.mode].children),s=s.concat(this.helper[this.mode].children);for(let r=0;r<s.length;r++){const o=s[r];o.visible=!0,o.rotation.set(0,0,0),o.position.copy(this.worldPosition);let a;if(this.camera.isOrthographicCamera?a=(this.camera.top-this.camera.bottom)/this.camera.zoom:a=this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),o.scale.set(1,1,1).multiplyScalar(a*this.size/4),o.tag==="helper"){o.visible=!1,o.name==="AXIS"?(o.visible=!!this.axis,this.axis==="X"&&(si.setFromEuler(Bm.set(0,0,0)),o.quaternion.copy(i).multiply(si),Math.abs(Qt.copy(ep).applyQuaternion(i).dot(this.eye))>.9&&(o.visible=!1)),this.axis==="Y"&&(si.setFromEuler(Bm.set(0,0,Math.PI/2)),o.quaternion.copy(i).multiply(si),Math.abs(Qt.copy(rh).applyQuaternion(i).dot(this.eye))>.9&&(o.visible=!1)),this.axis==="Z"&&(si.setFromEuler(Bm.set(0,Math.PI/2,0)),o.quaternion.copy(i).multiply(si),Math.abs(Qt.copy(tp).applyQuaternion(i).dot(this.eye))>.9&&(o.visible=!1)),this.axis==="XYZE"&&(si.setFromEuler(Bm.set(0,Math.PI/2,0)),Qt.copy(this.rotationAxis),o.quaternion.setFromRotationMatrix(l1.lookAt(a1,Qt,rh)),o.quaternion.multiply(si),o.visible=this.dragging),this.axis==="E"&&(o.visible=!1)):o.name==="START"?(o.position.copy(this.worldPositionStart),o.visible=this.dragging):o.name==="END"?(o.position.copy(this.worldPosition),o.visible=this.dragging):o.name==="DELTA"?(o.position.copy(this.worldPositionStart),o.quaternion.copy(this.worldQuaternionStart),es.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),es.applyQuaternion(this.worldQuaternionStart.clone().invert()),o.scale.copy(es),o.visible=this.dragging):(o.quaternion.copy(i),this.dragging?o.position.copy(this.worldPositionStart):o.position.copy(this.worldPosition),this.axis&&(o.visible=this.axis.search(o.name)!==-1));continue}o.quaternion.copy(i),this.mode==="translate"||this.mode==="scale"?(o.name==="X"&&Math.abs(Qt.copy(ep).applyQuaternion(i).dot(this.eye))>.99&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name==="Y"&&Math.abs(Qt.copy(rh).applyQuaternion(i).dot(this.eye))>.99&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name==="Z"&&Math.abs(Qt.copy(tp).applyQuaternion(i).dot(this.eye))>.99&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name==="XY"&&Math.abs(Qt.copy(tp).applyQuaternion(i).dot(this.eye))<.2&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name==="YZ"&&Math.abs(Qt.copy(ep).applyQuaternion(i).dot(this.eye))<.2&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name==="XZ"&&Math.abs(Qt.copy(rh).applyQuaternion(i).dot(this.eye))<.2&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1)):this.mode==="rotate"&&(Pm.copy(i),Qt.copy(this.eye).applyQuaternion(si.copy(i).invert()),o.name.search("E")!==-1&&o.quaternion.setFromRotationMatrix(l1.lookAt(this.eye,a1,rh)),o.name==="X"&&(si.setFromAxisAngle(ep,Math.atan2(-Qt.y,Qt.z)),si.multiplyQuaternions(Pm,si),o.quaternion.copy(si)),o.name==="Y"&&(si.setFromAxisAngle(rh,Math.atan2(Qt.x,Qt.z)),si.multiplyQuaternions(Pm,si),o.quaternion.copy(si)),o.name==="Z"&&(si.setFromAxisAngle(tp,Math.atan2(Qt.y,Qt.x)),si.multiplyQuaternions(Pm,si),o.quaternion.copy(si))),o.visible=o.visible&&(o.name.indexOf("X")===-1||this.showX),o.visible=o.visible&&(o.name.indexOf("Y")===-1||this.showY),o.visible=o.visible&&(o.name.indexOf("Z")===-1||this.showZ),o.visible=o.visible&&(o.name.indexOf("E")===-1||this.showX&&this.showY&&this.showZ),o.material._color=o.material._color||o.material.color.clone(),o.material._opacity=o.material._opacity||o.material.opacity,o.material.color.copy(o.material._color),o.material.opacity=o.material._opacity,this.enabled&&this.axis&&(o.name===this.axis||this.axis.split("").some(function(l){return o.name===l}))&&(o.material.color.setHex(16776960),o.material.opacity=1)}super.updateMatrixWorld(t)}}class cz extends J{constructor(){super(new Ys(1e5,1e5,2,2),new St({visible:!1,wireframe:!0,side:pi,transparent:!0,opacity:.1,toneMapped:!1})),this.isTransformControlsPlane=!0,this.type="TransformControlsPlane"}updateMatrixWorld(t){let e=this.space;switch(this.position.copy(this.worldPosition),this.mode==="scale"&&(e="local"),Mm.copy(ep).applyQuaternion(e==="local"?this.worldQuaternion:MA),Bf.copy(rh).applyQuaternion(e==="local"?this.worldQuaternion:MA),Pf.copy(tp).applyQuaternion(e==="local"?this.worldQuaternion:MA),Qt.copy(Bf),this.mode){case"translate":case"scale":switch(this.axis){case"X":Qt.copy(this.eye).cross(Mm),qo.copy(Mm).cross(Qt);break;case"Y":Qt.copy(this.eye).cross(Bf),qo.copy(Bf).cross(Qt);break;case"Z":Qt.copy(this.eye).cross(Pf),qo.copy(Pf).cross(Qt);break;case"XY":qo.copy(Pf);break;case"YZ":qo.copy(Mm);break;case"XZ":Qt.copy(Pf),qo.copy(Bf);break;case"XYZ":case"E":qo.set(0,0,0);break}break;case"rotate":default:qo.set(0,0,0)}qo.length()===0?this.quaternion.copy(this.cameraQuaternion):(c1.lookAt(es.set(0,0,0),qo,Qt),this.quaternion.setFromRotationMatrix(c1)),super.updateMatrixWorld(t)}}const hz=N("debugpatch");function Zx(n,t,e,i){const s=hz===t;if(!e&&!i)return;const r=t+"___needle";uz(n,t,e,i);const o=Object.getOwnPropertyDescriptor(n,t),a=n[t];s&&console.log("Patch",n.constructor.name,t,o,a),o?(s&&console.log("Apply patch with existing descriptor",n.constructor.name,t,o),typeof o.value=="function"&&(n[t]=u1(o.value,n,t))):(s&&console.log("Create patch with new property",n.constructor.name,t,o),Object.defineProperty(n,t,{set:function(l){if(typeof l=="function")this[r]=u1(l,n,t);else{const h=this[r];aM(n,t,this,h,l),this[r]=l,lM(n,t,this,h,l)}},get:function(){const l=this[r];return typeof l=="function"&&l[r]?l[r]:l}}))}function jq(n,t,e){const i=$x(n,t);if(i)for(let s=i.length-1;s>=0;s--){const r=i[s];r.prefix===e&&(r.prefix=null),r.postfix===e&&(r.postfix=null),!r.prefix&&!r.postfix&&i.splice(s,1)}}const h1=Symbol("Needle:Patches:WrappedFunction");function u1(n,t,e){if(n[h1])return n;const i=function(...s){aM(t,e,this,...s);const r=n.apply(this,s);return lM(t,e,this,r,...s),r};return i[h1]=!0,i}const bb="Needle:Patches";function $_(){return globalThis[bb]||(globalThis[bb]=new WeakMap),globalThis[bb]}function $x(n,t){const e=$_().get(n);return e?e.get(t):null}function uz(n,t,e,i){let s=$_().get(n);s||(s=new Map,$_().set(n,s));let r=s.get(t);r||(r=[],s.set(t,r)),r.push({prefix:e,postfix:i})}function aM(n,t,e,...i){var r;if(!e)return;const s=$x(n,t);if(s)for(const o of s)(r=o.prefix)==null||r.call(e,...i)}function lM(n,t,e,i,...s){var o;if(!e)return;const r=$x(n,t);if(r)for(const a of r)(o=a.postfix)==null||o.call(e,i,...s)}const d1=Symbol("gltf-loader-internal-usage-tracker"),dz=N("debugusers"),qp=class{constructor(t){c(this,"parser");c(this,"_getDependency");c(this,"_loadingId");c(this,"_loadedObjects",new Set);this.parser=t,this._getDependency=this.parser.getDependency,this._loadingId=Date.now().toString()}get name(){return"NEEDLE_internal_usage_tracker"}static isLoading(t){return qp._loadingProcesses>0}beforeRoot(){qp._loadingProcesses++;const t=this,e=this._getDependency;return this.parser.getDependency=function(i,s){const r=e.call(this,i,s);return r.then(o=>(o&&(t._loadedObjects.add(o),o[d1]=t._loadingId),o)),r},null}afterRoot(t){qp._loadingProcesses--,this.parser.getDependency=this._getDependency;for(const e of this._loadedObjects)delete e[d1],e instanceof re&&(e.parent||e instanceof J&&setTimeout(()=>{dz&&console.warn("> GLTF LOADER: Mesh not used in scene!",e),e.material=null,e.geometry=null},1e3));return null}};let Ap=qp;c(Ap,"_loadingProcesses",0);class fz{constructor(){window.addEventListener("unhandledrejection",t=>{var i;if(t.defaultPrevented)return;const e=(i=t==null?void 0:t.reason)==null?void 0:i.path;if(e){const s=e[0];s&&s.tagName==="IMG"&&(console.warn(`Could not load image:
`+s.src),t.preventDefault())}})}}const Sy=N("trackresources");function cM(){return Sy==="dispose"}let Yh=!0;Sy===0&&(Yh=!1);function Gq(n){Yh=n}function pz(){return Yh}const hM=Symbol("disposable");function uM(n,t){n&&(n[hM]=t,wh&&console.warn("Set disposable",t,n))}const dM=Symbol("disposed");function Hq(n){return n[dM]===!0}function Jt(n){var t;if(n){if(n[hM]===!1){wh&&console.warn("Object is marked as not disposable",n);return}if(n[dM]=!0,n instanceof Ws)Jt(n.environment),Jt(n.background),Jt(n.customDepthMaterial),Jt(n.customDistanceMaterial);else if(n instanceof Io)Jt(n.geometry),Jt(n.material),Jt(n.skeleton),Jt(n.bindMatrix),Jt(n.bindMatrixInverse),Jt(n.customDepthMaterial),Jt(n.customDistanceMaterial),n.geometry=null,n.material=null;else if(n instanceof J)Jt(n.geometry),Jt(n.material),Jt(n.customDepthMaterial),Jt(n.customDistanceMaterial),n.geometry=null,n.material=null;else if(n instanceof jt){_u(n);for(const e of Object.keys(n.attributes)){const i=n.attributes[e];Jt(i)}}else if(n instanceof Ve||n instanceof Ac)wh&&console.warn("BufferAttribute dispose not supported",n.count);else if(n instanceof Array)for(const e of n)e instanceof ft&&Jt(e);else if(n instanceof ft){_u(n);for(const i of Object.keys(n)){const s=n[i];s instanceof pt&&(Jt(s),n[i]=null)}const e=n.uniforms;if(e)for(const i of Object.keys(e)){const s=e[i];s instanceof pt?(Jt(s),e[i]=null):s instanceof $&&(Jt(s.value),s.value=null)}}else n instanceof pt?(_u(n),_u(n.source),((t=n.source)==null?void 0:t.data)instanceof ImageBitmap&&_u(n.source.data)):n instanceof ux?(_u(n.boneTexture),n.boneTexture=null):n instanceof JA||!(n instanceof re)&&wh&&console.warn("Unknown object type",n)}}function _u(n){n&&((wh||cM()||Sy)&&console.warn("ðŸ§¨ FREE",n),n instanceof ImageBitmap?n.close():n instanceof LR?n.data=null:n.dispose())}function gz(n){(n instanceof J||n instanceof Io)&&(n.material=null,n.geometry=null)}const mz=new Set;function fM(n,t,e=null,i){if(i||(i=mz,i.clear()),!n)return i;const s=n[pg];if(s)for(const r of s)i.has(r)||(e==null?void 0:e.call(null,r))!==!1&&(i.add(r),t&&fM(r,!0,e,i));return i}function Vq(n){return n[ip]}const wh=N("debugresourceusers")||N("debugmemory"),pg=Symbol("needle-resource-users"),ip=Symbol("needle-resource-users-count");function vs(n,t){Zx(n,t,function(e,i){Yh&&(uv(pg,this,e,!1),uv(pg,this,i,!0))})}Yh&&(vs(J.prototype,"material"),vs(J.prototype,"geometry"),vs(ft.prototype,"map"),vs(ft.prototype,"bumpMap"),vs(ft.prototype,"alphaMap"),vs(ft.prototype,"normalMap"),vs(ft.prototype,"displacementMap"),vs(ft.prototype,"roughnessMap"),vs(ft.prototype,"metalnessMap"),vs(ft.prototype,"emissiveMap"),vs(ft.prototype,"specularMap"),vs(ft.prototype,"envMap"),vs(ft.prototype,"lightMap"),vs(ft.prototype,"aoMap"),vs(ft.prototype,"gradientMap"));function Az(n){if(Yh===!1)return;const t=n[pg];if(t)for(const e of t)uv(pg,e,n,!1)}Yh&&Zx(ft.prototype,"dispose",function(){Az(this)});let ew=0;function uv(n,t,e,i){if(ew>0)return;if(Array.isArray(e)){for(const r of e)uv(n,t,r,i);return}if(!e)return;let s=e[n];if(s||(s=new Set),i){if(t&&!s.has(t)){s.add(t);let r=e[ip]||0;r+=1,e[ip]=r,wh&&console.warn(`ðŸŸ¢ Added user of "${e.type}"`,t,e,r,"users:",s)}}else if(t&&s.has(t)){s.delete(t);let r=e[ip]||0;r>0&&(r-=1,e[ip]=r),wh&&console.warn(`ðŸ”´ Removed user of "${e.type}"`,t,e,r,"users:",s),r<=0&&(Ap.isLoading(e)||(Sy&&console.warn(`ðŸ”´ Removed all user of "${e.type}"`,e),cM()&&Jt(e)))}e[n]=s}try{Zx(Hh.prototype,"render",function(){ew++},function(){ew--})}catch(n){console.warn("Could not wrap WebGLRenderer.render",n)}var gg;(function(n){n.Added="component-added",n.Removing="removing-component"})(gg||(gg={}));const f1=N("debugcomponentevents");class Ey{static addComponentLifecylceEventListener(t,e){this.eventListeners.has(t)&&this.eventListeners.set(t,[]);let i=this.eventListeners.get(t);i||(i=[]),i.push(e),this.eventListeners.set(t,i),f1&&console.log("Added event listener for "+t,this.eventListeners)}static removeComponentLifecylceEventListener(t,e){const i=this.eventListeners.get(t);if(!i)return;const s=i.indexOf(e);s<0||i.splice(s,1)}static dispatchComponentLifecycleEvent(t,e){const i=this.eventListeners.get(t);if(f1&&console.log("Dispatching event "+t,i),!!i)for(const s of i)s(e)}}c(Ey,"eventListeners",new Map);const mg=Symbol("NEEDLE_NEED_UPDATE_INSTANCE"),pM=Symbol("isUsingInstancing"),gM=Symbol("instancingRenderer"),np=Symbol("instancingAutoUpdateBounds");class Bo{static isUsingInstancing(t){return t[pM]===!0}static getRenderer(t){return t[gM]||null}setAutoUpdateBounds(t,e){const i=Bo.getRenderer(t);i&&(i[np]=e)}static markDirty(t,e=!0){if(t&&(this.isUsingInstancing(t)&&(t[mg]=!0,t.matrixWorldNeedsUpdate=!0),e))for(const i of t.children)Bo.markDirty(i,!0)}}function xh(n,t){try{t?n(t):n()}catch(e){return console.error(e),!1}return!0}const tw=N("debugnewscripts"),vz=N("debughierarchy"),ei=[];function yz(){return ei.length>0}function dv(n){if(!(n.new_scripts.length<=0)){if(tw&&console.log("Register new components",n.new_scripts.length,[...n.new_scripts],n.alias?"element: "+n.alias:n.hash,n),n.new_scripts_pre_setup_callbacks.length>0){for(const t of n.new_scripts_pre_setup_callbacks)t&&t();n.new_scripts_pre_setup_callbacks.length=0}ei.length=0,n.new_scripts.length>0&&ei.push(...n.new_scripts),n.new_scripts.length=0;for(let t=0;t<ei.length;t++)try{const e=ei[t];if(e.isComponent!==!0){(xe()||tw)&&console.error(`Registered script is not a Needle Engine component. 
The script will be ignored. Please make sure your component extends "Behaviour" imported from "@needle-tools/engine"
`,e),ei.splice(t,1),t--;continue}if(e.destroyed)continue;if(!e.gameObject){console.warn(`Component can not be initialized: no GameObject assigned.
Did you add and remove a component in the same frame?`),ei.splice(t,1),t--;continue}e.context=n,vp(e.gameObject),eC(e,n)}catch(e){console.error(e),cl(ei[t],n),ei.splice(t,1),t--}for(let t=0;t<ei.length;t++)try{const e=ei[t];if(e.destroyed){cl(ei[t],n),ei.splice(t,1),t--;continue}if(e.registering)try{e.registering()}catch(i){console.error(i)}e.__internalAwake!==void 0&&(e.gameObject||console.error("Calling awake for a component without a GameObject",e,e.gameObject),vp(e.gameObject),e.activeAndEnabled&&xh(e.__internalAwake.bind(e)))}catch(e){console.error(e),cl(ei[t],n),ei.splice(t,1),t--}for(let t=0;t<ei.length;t++)try{const e=ei[t];if(e.destroyed||e.enabled===!1||(vp(e.gameObject),e.activeAndEnabled===!1))continue;e.__internalEnable!==void 0&&(e.enabled=!0,xh(e.__internalEnable.bind(e)))}catch(e){console.error(e),cl(ei[t],n),ei.splice(t,1),t--}for(let t=0;t<ei.length;t++)try{const e=ei[t];if(e.destroyed||!e.gameObject)continue;n.new_script_start.push(e)}catch(e){console.error(e),cl(ei[t],n),ei.splice(t,1),t--}ei.length=0;for(const t of n.new_scripts_post_setup_callbacks)t&&t();n.new_scripts_post_setup_callbacks.length=0}}function bz(n){n&&(n.__internalDisable(!0),cl(n,n.context))}function mM(n,t){for(let e=0;e<n.new_script_start.length;e++)try{const i=n.new_script_start[e];if(t!==void 0&&i.gameObject!==t||i.destroyed||i.activeAndEnabled===!1)continue;xh(i.__internalAwake.bind(i)),i.enabled&&(xh(i.__internalEnable.bind(i)),xh(i.__internalStart.bind(i)),n.new_script_start.splice(e,1),e--)}catch(i){console.error(i),cl(n.new_script_start[e],n),n.new_script_start.splice(e,1),e--}}function eC(n,t){t.scripts.indexOf(n)===-1&&(t.scripts.push(n),n.earlyUpdate&&t.scripts_earlyUpdate.push(n),n.update&&t.scripts_update.push(n),n.lateUpdate&&t.scripts_lateUpdate.push(n),n.onBeforeRender&&t.scripts_onBeforeRender.push(n),n.onAfterRender&&t.scripts_onAfterRender.push(n),n.onPausedChanged&&t.scripts_pausedChanged.push(n),_b(n,null)&&t.new_scripts_xr.push(n),_b(n,"immersive-vr")&&t.scripts_immersive_vr.push(n),_b(n,"immersive-ar")&&t.scripts_immersive_ar.push(n))}function cl(n,t){Pr(n,t.new_scripts),Pr(n,t.new_script_start),Pr(n,t.scripts),Pr(n,t.scripts_earlyUpdate),Pr(n,t.scripts_update),Pr(n,t.scripts_lateUpdate),Pr(n,t.scripts_onBeforeRender),Pr(n,t.scripts_onAfterRender),Pr(n,t.scripts_pausedChanged),Pr(n,t.new_scripts_xr),Pr(n,t.scripts_immersive_vr),Pr(n,t.scripts_immersive_ar),t.stopAllCoroutinesFrom(n)}function Pr(n,t){const e=t.indexOf(n);e>=0&&t.splice(e,1)}function _b(n,t){var e;if(n){const i=n;if(i.onBeforeXR||i.onEnterXR||i.onUpdateXR||i.onLeaveXR||i.onXRControllerAdded||i.onXRControllerRemoved)return!(t!=null&&((e=i.supportsXR)==null?void 0:e.call(i,t))===!1)}return!1}function DA(n){if(n||(n=mt.Current.scene),!n){console.trace("Invalid call - no current context.");return}const t=Ng(n);AM(n,t,!0)||(tw||xe()?console.error(`Error updating hierarchy
Do you have circular references in your project? <a target="_blank" href="https://docs.needle.tools/circular-reference"> Click here for more information.`,n):console.error('Failed to update active state in hierarchy of "'+n.name+'"',n),console.warn(" â†‘ this error might be caused by circular references. Please make sure you don't have files with circular references (e.g. one GLB 1 is loading GLB 2 which is then loading GLB 1 again)."))}function AM(n,t,e,i=0){if(i>1e3)return console.warn("Hierarchy is too deep (> 1000 level) - will abort updating active state"),!1;const s=Ng(n);if(t&&(t=s,t&&n.parent)){const l=n.parent;t=l[Cc],t===void 0&&(l instanceof Ws||(t=!0))}const o=n[Cc]!==t;n[Cc]=t,o&&(vz&&console.warn("ACTIVE CHANGE",n.name,s,n.visible,t,"changed?"+o,n),e&&_z(n,l=>{t?l.enabled&&(xh(l.__internalAwake.bind(l)),l.enabled&&(l.__didEnable=!0,l.onEnable())):l.__didAwake&&l.enabled&&(l.__didEnable=!1,l.onDisable())}));let a=!0;if(n.children){const l=i+1;for(const h of n.children)AM(h,t,e,l)===!1&&(a=!1)}return a}function vp(n){let t=!0,e=n,i=!1;for(;e&&e;){if(e.type==="Scene"&&(i=!0),!Ng(e)){t=!1;break}e=e.parent}if(!n){console.error("GO is null");return}n[Cc]=t&&i}function _z(n,t){var e;if((e=n.userData)!=null&&e.components)for(const i of n.userData.components)t(i)}const kA=new Map,vM=Symbol("prewarmFlag"),iw=Symbol("waitingForPrewarm"),nw=N("debugprewarm");function wz(n,t){if(!n||n[vM]===!0||n[iw]===!0)return;kA.has(t)||kA.set(t,[]),n[iw]=!0,kA.get(t).push(n),nw&&console.debug("register prewarm",n.name)}let p1=null,g1=null;function xz(n){if(!n)return;const t=kA.get(n);if(!(t!=null&&t.length))return;const e=n.mainCamera;if(e){nw&&console.log("prewarm",t.length,"objects",[...t]);const i=n.renderer;if(i.compile){const s=n.scene;i.compile(s,e),p1??(p1=new c2(64)),g1??(g1=new h2(.001,9999999,p1)),g1.update(i,s);for(const r of t)r[vM]=!0,r[iw]=!1;t.length=0,nw&&console.log("prewarm done")}}}const Cz=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function Sz(n){return typeof n=="string"&&Cz.test(n)}const Sn=[];for(let n=0;n<256;++n)Sn.push((n+256).toString(16).slice(1));function Ez(n,t=0){return Sn[n[t+0]]+Sn[n[t+1]]+Sn[n[t+2]]+Sn[n[t+3]]+"-"+Sn[n[t+4]]+Sn[n[t+5]]+"-"+Sn[n[t+6]]+Sn[n[t+7]]+"-"+Sn[n[t+8]]+Sn[n[t+9]]+"-"+Sn[n[t+10]]+Sn[n[t+11]]+Sn[n[t+12]]+Sn[n[t+13]]+Sn[n[t+14]]+Sn[n[t+15]]}function Iz(n){if(!Sz(n))throw TypeError("Invalid UUID");let t;const e=new Uint8Array(16);return e[0]=(t=parseInt(n.slice(0,8),16))>>>24,e[1]=t>>>16&255,e[2]=t>>>8&255,e[3]=t&255,e[4]=(t=parseInt(n.slice(9,13),16))>>>8,e[5]=t&255,e[6]=(t=parseInt(n.slice(14,18),16))>>>8,e[7]=t&255,e[8]=(t=parseInt(n.slice(19,23),16))>>>8,e[9]=t&255,e[10]=(t=parseInt(n.slice(24,36),16))/1099511627776&255,e[11]=t/4294967296&255,e[12]=t>>>24&255,e[13]=t>>>16&255,e[14]=t>>>8&255,e[15]=t&255,e}function Tz(n){n=unescape(encodeURIComponent(n));const t=[];for(let e=0;e<n.length;++e)t.push(n.charCodeAt(e));return t}const Rz="6ba7b810-9dad-11d1-80b4-00c04fd430c8",Bz="6ba7b811-9dad-11d1-80b4-00c04fd430c8";function Pz(n,t,e){function i(s,r,o,a){var l;if(typeof s=="string"&&(s=Tz(s)),typeof r=="string"&&(r=Iz(r)),((l=r)===null||l===void 0?void 0:l.length)!==16)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");let h=new Uint8Array(16+s.length);if(h.set(r),h.set(s,r.length),h=e(h),h[6]=h[6]&15|t,h[8]=h[8]&63|128,o){a=a||0;for(let u=0;u<16;++u)o[a+u]=h[u];return o}return Ez(h)}try{i.name=n}catch{}return i.DNS=Rz,i.URL=Bz,i}function Mz(n,t,e,i){switch(n){case 0:return t&e^~t&i;case 1:return t^e^i;case 2:return t&e^t&i^e&i;case 3:return t^e^i}}function wb(n,t){return n<<t|n>>>32-t}function Dz(n){const t=[1518500249,1859775393,2400959708,3395469782],e=[1732584193,4023233417,2562383102,271733878,3285377520];if(typeof n=="string"){const o=unescape(encodeURIComponent(n));n=[];for(let a=0;a<o.length;++a)n.push(o.charCodeAt(a))}else Array.isArray(n)||(n=Array.prototype.slice.call(n));n.push(128);const i=n.length/4+2,s=Math.ceil(i/16),r=new Array(s);for(let o=0;o<s;++o){const a=new Uint32Array(16);for(let l=0;l<16;++l)a[l]=n[o*64+l*4]<<24|n[o*64+l*4+1]<<16|n[o*64+l*4+2]<<8|n[o*64+l*4+3];r[o]=a}r[s-1][14]=(n.length-1)*8/Math.pow(2,32),r[s-1][14]=Math.floor(r[s-1][14]),r[s-1][15]=(n.length-1)*8&4294967295;for(let o=0;o<s;++o){const a=new Uint32Array(80);for(let p=0;p<16;++p)a[p]=r[o][p];for(let p=16;p<80;++p)a[p]=wb(a[p-3]^a[p-8]^a[p-14]^a[p-16],1);let l=e[0],h=e[1],u=e[2],d=e[3],f=e[4];for(let p=0;p<80;++p){const g=Math.floor(p/20),m=wb(l,5)+Mz(g,h,u,d)+f+t[g]+a[p]>>>0;f=d,d=u,u=wb(h,30)>>>0,h=l,l=m}e[0]=e[0]+l>>>0,e[1]=e[1]+h>>>0,e[2]=e[2]+u>>>0,e[3]=e[3]+d>>>0,e[4]=e[4]+f>>>0}return[e[0]>>24&255,e[0]>>16&255,e[0]>>8&255,e[0]&255,e[1]>>24&255,e[1]>>16&255,e[1]>>8&255,e[1]&255,e[2]>>24&255,e[2]>>16&255,e[2]>>8&255,e[2]&255,e[3]>>24&255,e[3]>>16&255,e[3]>>8&255,e[3]&255,e[4]>>24&255,e[4]>>16&255,e[4]>>8&255,e[4]&255]}const kz=Pz("v5",80,Dz),m1=kz;var jr;(function(n){n[n.OnConnection=0]="OnConnection",n[n.OnRoomJoin=1]="OnRoomJoin",n[n.Queued=2]="Queued",n[n.Immediate=3]="Immediate"})(jr||(jr={}));/**
 * postprocessing v6.35.5 build Sat Jun 01 2024
 * https://github.com/pmndrs/postprocessing
 * Copyright 2015-2024 Raoul van RÃ¼schen
 * @license Zlib
 */var xb=1/1e3,Oz=1e3,Lz=class{constructor(){this.startTime=performance.now(),this.previousTime=0,this.currentTime=0,this._delta=0,this._elapsed=0,this._fixedDelta=1e3/60,this.timescale=1,this.useFixedDelta=!1,this._autoReset=!1}get autoReset(){return this._autoReset}set autoReset(n){typeof document<"u"&&document.hidden!==void 0&&(n?document.addEventListener("visibilitychange",this):document.removeEventListener("visibilitychange",this),this._autoReset=n)}get delta(){return this._delta*xb}get fixedDelta(){return this._fixedDelta*xb}set fixedDelta(n){this._fixedDelta=n*Oz}get elapsed(){return this._elapsed*xb}update(n){this.useFixedDelta?this._delta=this.fixedDelta:(this.previousTime=this.currentTime,this.currentTime=(n!==void 0?n:performance.now())-this.startTime,this._delta=this.currentTime-this.previousTime),this._delta*=this.timescale,this._elapsed+=this._delta}reset(){this._delta=0,this._elapsed=0,this.currentTime=performance.now()-this.startTime}getDelta(){return this.delta}getElapsed(){return this.elapsed}handleEvent(n){document.hidden||(this.currentTime=performance.now()-this.startTime)}dispose(){this.autoReset=!1}},Fz=new p2,Vl=null;function Uz(){if(Vl===null){const n=new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),t=new Float32Array([0,0,2,0,0,2]);Vl=new jt,Vl.setAttribute!==void 0?(Vl.setAttribute("position",new Ve(n,3)),Vl.setAttribute("uv",new Ve(t,2))):(Vl.addAttribute("position",new Ve(n,3)),Vl.addAttribute("uv",new Ve(t,2)))}return Vl}var Gn=class yM{constructor(t="Pass",e=new Ws,i=Fz){this.name=t,this.renderer=null,this.scene=e,this.camera=i,this.screen=null,this.rtt=!0,this.needsSwap=!0,this.needsDepthTexture=!1,this.enabled=!0}get renderToScreen(){return!this.rtt}set renderToScreen(t){if(this.rtt===t){const e=this.fullscreenMaterial;e!==null&&(e.needsUpdate=!0),this.rtt=!t}}set mainScene(t){}set mainCamera(t){}setRenderer(t){this.renderer=t}isEnabled(){return this.enabled}setEnabled(t){this.enabled=t}get fullscreenMaterial(){return this.screen!==null?this.screen.material:null}set fullscreenMaterial(t){let e=this.screen;e!==null?e.material=t:(e=new J(Uz(),t),e.frustumCulled=!1,this.scene===null&&(this.scene=new Ws),this.scene.add(e),this.screen=e)}getFullscreenMaterial(){return this.fullscreenMaterial}setFullscreenMaterial(t){this.fullscreenMaterial=t}getDepthTexture(){return null}setDepthTexture(t,e=Rs){}render(t,e,i,s,r){throw new Error("Render method not implemented!")}setSize(t,e){}initialize(t,e,i){}dispose(){for(const t of Object.keys(this)){const e=this[t];(e instanceof Ct||e instanceof ft||e instanceof pt||e instanceof yM)&&this[t].dispose()}}},Nz=class extends Gn{constructor(){super("ClearMaskPass",null,null),this.needsSwap=!1}render(n,t,e,i,s){const r=n.state.buffers.stencil;r.setLocked(!1),r.setTest(!1)}},Qz=Number(ay.replace(/\D+/g,""));function Hd(n){return Qz<154?n.replace("colorspace_fragment","encodings_fragment"):n}var zz=`#include <common>
#include <dithering_pars_fragment>
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
uniform float opacity;varying vec2 vUv;void main(){vec4 texel=texture2D(inputBuffer,vUv);gl_FragColor=opacity*texel;
#include <colorspace_fragment>
#include <dithering_fragment>
}`,Kh="varying vec2 vUv;void main(){vUv=position.xy*0.5+0.5;gl_Position=vec4(position.xy,1.0,1.0);}",bM=class extends $e{constructor(){super({name:"CopyMaterial",uniforms:{inputBuffer:new $(null),opacity:new $(1)},blending:Ms,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:zz,vertexShader:Kh}),this.fragmentShader=Hd(this.fragmentShader)}set inputBuffer(n){this.uniforms.inputBuffer.value=n}setInputBuffer(n){this.uniforms.inputBuffer.value=n}getOpacity(n){return this.uniforms.opacity.value}setOpacity(n){this.uniforms.opacity.value=n}},_M=class extends Gn{constructor(n,t=!0){super("CopyPass"),this.fullscreenMaterial=new bM,this.needsSwap=!1,this.renderTarget=n,n===void 0&&(this.renderTarget=new Ct(1,1,{minFilter:Tt,magFilter:Tt,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="CopyPass.Target"),this.autoResize=t}get resize(){return this.autoResize}set resize(n){this.autoResize=n}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}setAutoResizeEnabled(n){this.autoResize=n}render(n,t,e,i,s){this.fullscreenMaterial.inputBuffer=t.texture,n.setRenderTarget(this.renderToScreen?null:this.renderTarget),n.render(this.scene,this.camera)}setSize(n,t){this.autoResize&&this.renderTarget.setSize(n,t)}initialize(n,t,e){e!==void 0&&(this.renderTarget.texture.type=e,e!==oi?this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1":n!==null&&n.outputColorSpace===Ue&&(this.renderTarget.texture.colorSpace=Ue))}},A1=new we,Iy=class extends Gn{constructor(n=!0,t=!0,e=!1){super("ClearPass",null,null),this.needsSwap=!1,this.color=n,this.depth=t,this.stencil=e,this.overrideClearColor=null,this.overrideClearAlpha=-1}setClearFlags(n,t,e){this.color=n,this.depth=t,this.stencil=e}getOverrideClearColor(){return this.overrideClearColor}setOverrideClearColor(n){this.overrideClearColor=n}getOverrideClearAlpha(){return this.overrideClearAlpha}setOverrideClearAlpha(n){this.overrideClearAlpha=n}render(n,t,e,i,s){const r=this.overrideClearColor,o=this.overrideClearAlpha,a=n.getClearAlpha(),l=r!==null,h=o>=0;l?(n.getClearColor(A1),n.setClearColor(r,h?o:a)):h&&n.setClearAlpha(o),n.setRenderTarget(this.renderToScreen?null:t),n.clear(this.color,this.depth,this.stencil),l?n.setClearColor(A1,a):h&&n.setClearAlpha(a)}},jz=class extends Gn{constructor(n,t){super("MaskPass",n,t),this.needsSwap=!1,this.clearPass=new Iy(!1,!1,!0),this.inverse=!1}set mainScene(n){this.scene=n}set mainCamera(n){this.camera=n}get inverted(){return this.inverse}set inverted(n){this.inverse=n}get clear(){return this.clearPass.enabled}set clear(n){this.clearPass.enabled=n}getClearPass(){return this.clearPass}isInverted(){return this.inverted}setInverted(n){this.inverted=n}render(n,t,e,i,s){const r=n.getContext(),o=n.state.buffers,a=this.scene,l=this.camera,h=this.clearPass,u=this.inverted?0:1,d=1-u;o.color.setMask(!1),o.depth.setMask(!1),o.color.setLocked(!0),o.depth.setLocked(!0),o.stencil.setTest(!0),o.stencil.setOp(r.REPLACE,r.REPLACE,r.REPLACE),o.stencil.setFunc(r.ALWAYS,u,4294967295),o.stencil.setClear(d),o.stencil.setLocked(!0),this.clearPass.enabled&&(this.renderToScreen?h.render(n,null):(h.render(n,t),h.render(n,e))),this.renderToScreen?(n.setRenderTarget(null),n.render(a,l)):(n.setRenderTarget(t),n.render(a,l),n.setRenderTarget(e),n.render(a,l)),o.color.setLocked(!1),o.depth.setLocked(!1),o.stencil.setLocked(!1),o.stencil.setFunc(r.EQUAL,1,4294967295),o.stencil.setOp(r.KEEP,r.KEEP,r.KEEP),o.stencil.setLocked(!0)}},tC=class{constructor(n=null,{depthBuffer:t=!0,stencilBuffer:e=!1,multisampling:i=0,frameBufferType:s}={}){this.renderer=null,this.inputBuffer=this.createBuffer(t,e,s,i),this.outputBuffer=this.inputBuffer.clone(),this.copyPass=new _M,this.depthTexture=null,this.passes=[],this.timer=new Lz,this.autoRenderToScreen=!0,this.setRenderer(n)}get multisampling(){return this.inputBuffer.samples||0}set multisampling(n){const t=this.inputBuffer,e=this.multisampling;e>0&&n>0?(this.inputBuffer.samples=n,this.outputBuffer.samples=n,this.inputBuffer.dispose(),this.outputBuffer.dispose()):e!==n&&(this.inputBuffer.dispose(),this.outputBuffer.dispose(),this.inputBuffer=this.createBuffer(t.depthBuffer,t.stencilBuffer,t.texture.type,n),this.inputBuffer.depthTexture=this.depthTexture,this.outputBuffer=this.inputBuffer.clone())}getTimer(){return this.timer}getRenderer(){return this.renderer}setRenderer(n){if(this.renderer=n,n!==null){const t=n.getSize(new ae),e=n.getContext().getContextAttributes().alpha,i=this.inputBuffer.texture.type;i===oi&&n.outputColorSpace===Ue&&(this.inputBuffer.texture.colorSpace=Ue,this.outputBuffer.texture.colorSpace=Ue,this.inputBuffer.dispose(),this.outputBuffer.dispose()),n.autoClear=!1,this.setSize(t.width,t.height);for(const s of this.passes)s.initialize(n,e,i)}}replaceRenderer(n,t=!0){const e=this.renderer,i=e.domElement.parentNode;return this.setRenderer(n),t&&i!==null&&(i.removeChild(e.domElement),i.appendChild(n.domElement)),e}createDepthTexture(){const n=this.depthTexture=new fx;return this.inputBuffer.depthTexture=n,this.inputBuffer.dispose(),this.inputBuffer.stencilBuffer?(n.format=u2,n.type=d2):n.type=FR,n}deleteDepthTexture(){if(this.depthTexture!==null){this.depthTexture.dispose(),this.depthTexture=null,this.inputBuffer.depthTexture=null,this.inputBuffer.dispose();for(const n of this.passes)n.setDepthTexture(null)}}createBuffer(n,t,e,i){const s=this.renderer,r=s===null?new ae:s.getDrawingBufferSize(new ae),o={minFilter:Tt,magFilter:Tt,stencilBuffer:t,depthBuffer:n,type:e},a=new Ct(r.width,r.height,o);return i>0&&(a.ignoreDepthForMultisampleCopy=!1,a.samples=i),e===oi&&s!==null&&s.outputColorSpace===Ue&&(a.texture.colorSpace=Ue),a.texture.name="EffectComposer.Buffer",a.texture.generateMipmaps=!1,a}setMainScene(n){for(const t of this.passes)t.mainScene=n}setMainCamera(n){for(const t of this.passes)t.mainCamera=n}addPass(n,t){const e=this.passes,i=this.renderer,s=i.getDrawingBufferSize(new ae),r=i.getContext().getContextAttributes().alpha,o=this.inputBuffer.texture.type;if(n.setRenderer(i),n.setSize(s.width,s.height),n.initialize(i,r,o),this.autoRenderToScreen&&(e.length>0&&(e[e.length-1].renderToScreen=!1),n.renderToScreen&&(this.autoRenderToScreen=!1)),t!==void 0?e.splice(t,0,n):e.push(n),this.autoRenderToScreen&&(e[e.length-1].renderToScreen=!0),n.needsDepthTexture||this.depthTexture!==null)if(this.depthTexture===null){const a=this.createDepthTexture();for(n of e)n.setDepthTexture(a)}else n.setDepthTexture(this.depthTexture)}removePass(n){const t=this.passes,e=t.indexOf(n);if(e!==-1&&t.splice(e,1).length>0){if(this.depthTexture!==null){const r=(a,l)=>a||l.needsDepthTexture;t.reduce(r,!1)||(n.getDepthTexture()===this.depthTexture&&n.setDepthTexture(null),this.deleteDepthTexture())}this.autoRenderToScreen&&e===t.length&&(n.renderToScreen=!1,t.length>0&&(t[t.length-1].renderToScreen=!0))}}removeAllPasses(){const n=this.passes;this.deleteDepthTexture(),n.length>0&&(this.autoRenderToScreen&&(n[n.length-1].renderToScreen=!1),this.passes=[])}render(n){const t=this.renderer,e=this.copyPass;let i=this.inputBuffer,s=this.outputBuffer,r=!1,o,a,l;n===void 0&&(this.timer.update(),n=this.timer.getDelta());for(const h of this.passes)h.enabled&&(h.render(t,i,s,n,r),h.needsSwap&&(r&&(e.renderToScreen=h.renderToScreen,o=t.getContext(),a=t.state.buffers.stencil,a.setFunc(o.NOTEQUAL,1,4294967295),e.render(t,i,s,n,r),a.setFunc(o.EQUAL,1,4294967295)),l=i,i=s,s=l),h instanceof jz?r=!0:h instanceof Nz&&(r=!1))}setSize(n,t,e){const i=this.renderer,s=i.getSize(new ae);(n===void 0||t===void 0)&&(n=s.width,t=s.height),(s.width!==n||s.height!==t)&&i.setSize(n,t,e);const r=i.getDrawingBufferSize(new ae);this.inputBuffer.setSize(r.width,r.height),this.outputBuffer.setSize(r.width,r.height);for(const o of this.passes)o.setSize(r.width,r.height)}reset(){this.dispose(),this.autoRenderToScreen=!0}dispose(){for(const n of this.passes)n.dispose();this.passes=[],this.inputBuffer!==null&&this.inputBuffer.dispose(),this.outputBuffer!==null&&this.outputBuffer.dispose(),this.deleteDepthTexture(),this.copyPass.dispose(),this.timer.dispose()}},Ar={NONE:0,DEPTH:1,CONVOLUTION:2},bt={FRAGMENT_HEAD:"FRAGMENT_HEAD",FRAGMENT_MAIN_UV:"FRAGMENT_MAIN_UV",FRAGMENT_MAIN_IMAGE:"FRAGMENT_MAIN_IMAGE",VERTEX_HEAD:"VERTEX_HEAD",VERTEX_MAIN_SUPPORT:"VERTEX_MAIN_SUPPORT"},Gz=class{constructor(){this.shaderParts=new Map([[bt.FRAGMENT_HEAD,null],[bt.FRAGMENT_MAIN_UV,null],[bt.FRAGMENT_MAIN_IMAGE,null],[bt.VERTEX_HEAD,null],[bt.VERTEX_MAIN_SUPPORT,null]]),this.defines=new Map,this.uniforms=new Map,this.blendModes=new Map,this.extensions=new Set,this.attributes=Ar.NONE,this.varyings=new Set,this.uvTransformation=!1,this.readDepth=!1,this.colorSpace=Di}},Cb=!1,v1=class{constructor(n=null){this.originalMaterials=new Map,this.material=null,this.materials=null,this.materialsBackSide=null,this.materialsDoubleSide=null,this.materialsFlatShaded=null,this.materialsFlatShadedBackSide=null,this.materialsFlatShadedDoubleSide=null,this.setMaterial(n),this.meshCount=0,this.replaceMaterial=t=>{if(t.isMesh){let e;if(t.material.flatShading)switch(t.material.side){case pi:e=this.materialsFlatShadedDoubleSide;break;case pc:e=this.materialsFlatShadedBackSide;break;default:e=this.materialsFlatShaded;break}else switch(t.material.side){case pi:e=this.materialsDoubleSide;break;case pc:e=this.materialsBackSide;break;default:e=this.materials;break}this.originalMaterials.set(t,t.material),t.isSkinnedMesh?t.material=e[2]:t.isInstancedMesh?t.material=e[1]:t.material=e[0],++this.meshCount}}}cloneMaterial(n){if(!(n instanceof $e))return n.clone();const t=n.uniforms,e=new Map;for(const s in t){const r=t[s].value;r.isRenderTargetTexture&&(t[s].value=null,e.set(s,r))}const i=n.clone();for(const s of e)t[s[0]].value=s[1],i.uniforms[s[0]].value=s[1];return i}setMaterial(n){if(this.disposeMaterials(),this.material=n,n!==null){const t=this.materials=[this.cloneMaterial(n),this.cloneMaterial(n),this.cloneMaterial(n)];for(const e of t)e.uniforms=Object.assign({},n.uniforms),e.side=Oa;t[2].skinning=!0,this.materialsBackSide=t.map(e=>{const i=this.cloneMaterial(e);return i.uniforms=Object.assign({},n.uniforms),i.side=pc,i}),this.materialsDoubleSide=t.map(e=>{const i=this.cloneMaterial(e);return i.uniforms=Object.assign({},n.uniforms),i.side=pi,i}),this.materialsFlatShaded=t.map(e=>{const i=this.cloneMaterial(e);return i.uniforms=Object.assign({},n.uniforms),i.flatShading=!0,i}),this.materialsFlatShadedBackSide=t.map(e=>{const i=this.cloneMaterial(e);return i.uniforms=Object.assign({},n.uniforms),i.flatShading=!0,i.side=pc,i}),this.materialsFlatShadedDoubleSide=t.map(e=>{const i=this.cloneMaterial(e);return i.uniforms=Object.assign({},n.uniforms),i.flatShading=!0,i.side=pi,i})}}render(n,t,e){const i=n.shadowMap.enabled;if(n.shadowMap.enabled=!1,Cb){const s=this.originalMaterials;this.meshCount=0,t.traverse(this.replaceMaterial),n.render(t,e);for(const r of s)r[0].material=r[1];this.meshCount!==s.size&&s.clear()}else{const s=t.overrideMaterial;t.overrideMaterial=this.material,n.render(t,e),t.overrideMaterial=s}n.shadowMap.enabled=i}disposeMaterials(){if(this.material!==null){const n=this.materials.concat(this.materialsBackSide).concat(this.materialsDoubleSide).concat(this.materialsFlatShaded).concat(this.materialsFlatShadedBackSide).concat(this.materialsFlatShadedDoubleSide);for(const t of n)t.dispose()}}dispose(){this.originalMaterials.clear(),this.disposeMaterials()}static get workaroundEnabled(){return Cb}static set workaroundEnabled(n){Cb=n}},Wl=-1,Rt=class extends Ml{constructor(n,t=Wl,e=Wl,i=1){super(),this.resizable=n,this.baseSize=new ae(1,1),this.preferredSize=new ae(t,e),this.target=this.preferredSize,this.s=i,this.effectiveSize=new ae,this.addEventListener("change",()=>this.updateEffectiveSize()),this.updateEffectiveSize()}updateEffectiveSize(){const n=this.baseSize,t=this.preferredSize,e=this.effectiveSize,i=this.scale;t.width!==Wl?e.width=t.width:t.height!==Wl?e.width=Math.round(t.height*(n.width/Math.max(n.height,1))):e.width=Math.round(n.width*i),t.height!==Wl?e.height=t.height:t.width!==Wl?e.height=Math.round(t.width/Math.max(n.width/Math.max(n.height,1),1)):e.height=Math.round(n.height*i)}get width(){return this.effectiveSize.width}set width(n){this.preferredWidth=n}get height(){return this.effectiveSize.height}set height(n){this.preferredHeight=n}getWidth(){return this.width}getHeight(){return this.height}get scale(){return this.s}set scale(n){this.s!==n&&(this.s=n,this.preferredSize.setScalar(Wl),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getScale(){return this.scale}setScale(n){this.scale=n}get baseWidth(){return this.baseSize.width}set baseWidth(n){this.baseSize.width!==n&&(this.baseSize.width=n,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getBaseWidth(){return this.baseWidth}setBaseWidth(n){this.baseWidth=n}get baseHeight(){return this.baseSize.height}set baseHeight(n){this.baseSize.height!==n&&(this.baseSize.height=n,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getBaseHeight(){return this.baseHeight}setBaseHeight(n){this.baseHeight=n}setBaseSize(n,t){(this.baseSize.width!==n||this.baseSize.height!==t)&&(this.baseSize.set(n,t),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}get preferredWidth(){return this.preferredSize.width}set preferredWidth(n){this.preferredSize.width!==n&&(this.preferredSize.width=n,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getPreferredWidth(){return this.preferredWidth}setPreferredWidth(n){this.preferredWidth=n}get preferredHeight(){return this.preferredSize.height}set preferredHeight(n){this.preferredSize.height!==n&&(this.preferredSize.height=n,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getPreferredHeight(){return this.preferredHeight}setPreferredHeight(n){this.preferredHeight=n}setPreferredSize(n,t){(this.preferredSize.width!==n||this.preferredSize.height!==t)&&(this.preferredSize.set(n,t),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}copy(n){this.s=n.scale,this.baseSize.set(n.baseWidth,n.baseHeight),this.preferredSize.set(n.preferredWidth,n.preferredHeight),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height)}static get AUTO_SIZE(){return Wl}},Hz=class extends Set{constructor(n,t=10){super(),this.l=t,this.exclusive=!1,n!==void 0&&this.set(n)}get layer(){return this.l}set layer(n){const t=this.l;for(const e of this)e.layers.disable(t),e.layers.enable(n);this.l=n}getLayer(){return this.layer}setLayer(n){this.layer=n}isExclusive(){return this.exclusive}setExclusive(n){this.exclusive=n}clear(){const n=this.layer;for(const t of this)t.layers.disable(n);return super.clear()}set(n){this.clear();for(const t of n)this.add(t);return this}indexOf(n){return this.has(n)?0:-1}add(n){return this.exclusive?n.layers.set(this.layer):n.layers.enable(this.layer),super.add(n)}delete(n){return this.has(n)&&n.layers.disable(this.layer),super.delete(n)}toggle(n){let t;return this.has(n)?(this.delete(n),t=!1):(this.add(n),t=!0),t}setVisible(n){for(const t of this)n?t.layers.enable(0):t.layers.disable(0);return this}},Xe={SKIP:9,SET:30,ADD:0,ALPHA:1,AVERAGE:2,COLOR:3,COLOR_BURN:4,COLOR_DODGE:5,DARKEN:6,DIFFERENCE:7,DIVIDE:8,DST:9,EXCLUSION:10,HARD_LIGHT:11,HARD_MIX:12,HUE:13,INVERT:14,INVERT_RGB:15,LIGHTEN:16,LINEAR_BURN:17,LINEAR_DODGE:18,LINEAR_LIGHT:19,LUMINOSITY:20,MULTIPLY:21,NEGATION:22,NORMAL:23,OVERLAY:24,PIN_LIGHT:25,REFLECT:26,SATURATION:27,SCREEN:28,SOFT_LIGHT:29,SRC:30,SUBTRACT:31,VIVID_LIGHT:32},Vz="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x+y,opacity);}",Wz="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,y,min(y.a,opacity));}",qz="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,(x+y)*0.5,opacity);}",Xz="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(yHSL.rg,xHSL.b));return vec4(mix(x.rgb,z,opacity),y.a);}",Yz="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(step(0.0,y)*(1.0-min(vec4(1.0),(1.0-x)/y)),vec4(1.0),step(1.0,x));return mix(x,z,opacity);}",Kz="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=step(0.0,x)*mix(min(vec4(1.0),x/max(1.0-y,1e-9)),vec4(1.0),step(1.0,y));return mix(x,z,opacity);}",Jz="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,min(x,y),opacity);}",Zz="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,abs(x-y),opacity);}",$z="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x/max(y,1e-12),opacity);}",ej="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,(x+y-2.0*x*y),opacity);}",tj="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 a=min(x,1.0),b=min(y,1.0);vec4 z=mix(2.0*a*b,1.0-2.0*(1.0-a)*(1.0-b),step(0.5,y));return mix(x,z,opacity);}",ij="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,step(1.0,x+y),opacity);}",nj="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(yHSL.r,xHSL.gb));return vec4(mix(x.rgb,z,opacity),y.a);}",sj="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,1.0-y,opacity);}",rj="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,y*(1.0-x),opacity);}",oj="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,max(x,y),opacity);}",aj="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,clamp(y+x-1.0,0.0,1.0),opacity);}",lj="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,min(x+y,1.0),opacity);}",cj="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,clamp(2.0*y+x-1.0,0.0,1.0),opacity);}",hj="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(xHSL.rg,yHSL.b));return vec4(mix(x.rgb,z,opacity),y.a);}",uj="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x*y,opacity);}",dj="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,1.0-abs(1.0-x-y),opacity);}",fj="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,y,opacity);}",pj="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(2.0*y*x,1.0-2.0*(1.0-y)*(1.0-x),step(0.5,x));return mix(x,z,opacity);}",gj="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 y2=2.0*y;vec4 z=mix(mix(y2,x,step(0.5*x,y)),max(vec4(0.0),y2-1.0),step(x,(y2-1.0)));return mix(x,z,opacity);}",mj="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(min(x*x/max(1.0-y,1e-12),1.0),y,step(1.0,y));return mix(x,z,opacity);}",Aj="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(xHSL.r,yHSL.g,xHSL.b));return vec4(mix(x.rgb,z,opacity),y.a);}",vj="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x+y-min(x*y,1.0),opacity);}",yj="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 y2=2.0*y;vec4 w=step(0.5,y);vec4 z=mix(x-(1.0-y2)*x*(1.0-x),mix(x+(y2-1.0)*(sqrt(x)-x),x+(y2-1.0)*x*((16.0*x-12.0)*x+3.0),w*(1.0-step(0.25,x))),w);return mix(x,z,opacity);}",bj="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return y;}",_j="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,max(x+y-1.0,0.0),opacity);}",wj="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(max(1.0-min((1.0-x)/(2.0*y),1.0),0.0),min(x/(2.0*(1.0-y)),1.0),step(0.5,y));return mix(x,z,opacity);}",xj=new Map([[Xe.ADD,Vz],[Xe.ALPHA,Wz],[Xe.AVERAGE,qz],[Xe.COLOR,Xz],[Xe.COLOR_BURN,Yz],[Xe.COLOR_DODGE,Kz],[Xe.DARKEN,Jz],[Xe.DIFFERENCE,Zz],[Xe.DIVIDE,$z],[Xe.DST,null],[Xe.EXCLUSION,ej],[Xe.HARD_LIGHT,tj],[Xe.HARD_MIX,ij],[Xe.HUE,nj],[Xe.INVERT,sj],[Xe.INVERT_RGB,rj],[Xe.LIGHTEN,oj],[Xe.LINEAR_BURN,aj],[Xe.LINEAR_DODGE,lj],[Xe.LINEAR_LIGHT,cj],[Xe.LUMINOSITY,hj],[Xe.MULTIPLY,uj],[Xe.NEGATION,dj],[Xe.NORMAL,fj],[Xe.OVERLAY,pj],[Xe.PIN_LIGHT,gj],[Xe.REFLECT,mj],[Xe.SATURATION,Aj],[Xe.SCREEN,vj],[Xe.SOFT_LIGHT,yj],[Xe.SRC,bj],[Xe.SUBTRACT,_j],[Xe.VIVID_LIGHT,wj]]),Cj=class extends Ml{constructor(n,t=1){super(),this._blendFunction=n,this.opacity=new $(t)}getOpacity(){return this.opacity.value}setOpacity(n){this.opacity.value=n}get blendFunction(){return this._blendFunction}set blendFunction(n){this._blendFunction=n,this.dispatchEvent({type:"change"})}getBlendFunction(){return this.blendFunction}setBlendFunction(n){this.blendFunction=n}getShaderCode(){return xj.get(this.blendFunction)}},Il={VERY_SMALL:0,SMALL:1,MEDIUM:2,LARGE:3,VERY_LARGE:4,HUGE:5},Sj=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec4 sum=texture2D(inputBuffer,vUv0);sum+=texture2D(inputBuffer,vUv1);sum+=texture2D(inputBuffer,vUv2);sum+=texture2D(inputBuffer,vUv3);gl_FragColor=sum*0.25;
#include <colorspace_fragment>
}`,Ej="uniform vec4 texelSize;uniform float kernel;uniform float scale;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec2 uv=position.xy*0.5+0.5;vec2 dUv=(texelSize.xy*vec2(kernel)+texelSize.zw)*scale;vUv0=vec2(uv.x-dUv.x,uv.y+dUv.y);vUv1=vec2(uv.x+dUv.x,uv.y+dUv.y);vUv2=vec2(uv.x+dUv.x,uv.y-dUv.y);vUv3=vec2(uv.x-dUv.x,uv.y-dUv.y);gl_Position=vec4(position.xy,1.0,1.0);}",Ij=[new Float32Array([0,0]),new Float32Array([0,1,1]),new Float32Array([0,1,1,2]),new Float32Array([0,1,2,2,3]),new Float32Array([0,1,2,3,4,4,5]),new Float32Array([0,1,2,3,4,5,7,8,9,10])],wM=class extends $e{constructor(n=new ke){super({name:"KawaseBlurMaterial",uniforms:{inputBuffer:new $(null),texelSize:new $(new ke),scale:new $(1),kernel:new $(0)},blending:Ms,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:Sj,vertexShader:Ej}),this.fragmentShader=Hd(this.fragmentShader),this.setTexelSize(n.x,n.y),this.kernelSize=Il.MEDIUM}set inputBuffer(n){this.uniforms.inputBuffer.value=n}setInputBuffer(n){this.inputBuffer=n}get kernelSequence(){return Ij[this.kernelSize]}get scale(){return this.uniforms.scale.value}set scale(n){this.uniforms.scale.value=n}getScale(){return this.uniforms.scale.value}setScale(n){this.uniforms.scale.value=n}getKernel(){return null}get kernel(){return this.uniforms.kernel.value}set kernel(n){this.uniforms.kernel.value=n}setKernel(n){this.kernel=n}setTexelSize(n,t){this.uniforms.texelSize.value.set(n,t,n*.5,t*.5)}setSize(n,t){const e=1/n,i=1/t;this.uniforms.texelSize.value.set(e,i,e*.5,i*.5)}},iC=class extends Gn{constructor({kernelSize:n=Il.MEDIUM,resolutionScale:t=.5,width:e=Rt.AUTO_SIZE,height:i=Rt.AUTO_SIZE,resolutionX:s=e,resolutionY:r=i}={}){super("KawaseBlurPass"),this.renderTargetA=new Ct(1,1,{depthBuffer:!1}),this.renderTargetA.texture.name="Blur.Target.A",this.renderTargetB=this.renderTargetA.clone(),this.renderTargetB.texture.name="Blur.Target.B";const o=this.resolution=new Rt(this,s,r,t);o.addEventListener("change",a=>this.setSize(o.baseWidth,o.baseHeight)),this._blurMaterial=new wM,this._blurMaterial.kernelSize=n,this.copyMaterial=new bM}getResolution(){return this.resolution}get blurMaterial(){return this._blurMaterial}set blurMaterial(n){this._blurMaterial=n}get dithering(){return this.copyMaterial.dithering}set dithering(n){this.copyMaterial.dithering=n}get kernelSize(){return this.blurMaterial.kernelSize}set kernelSize(n){this.blurMaterial.kernelSize=n}get width(){return this.resolution.width}set width(n){this.resolution.preferredWidth=n}get height(){return this.resolution.height}set height(n){this.resolution.preferredHeight=n}get scale(){return this.blurMaterial.scale}set scale(n){this.blurMaterial.scale=n}getScale(){return this.blurMaterial.scale}setScale(n){this.blurMaterial.scale=n}getKernelSize(){return this.kernelSize}setKernelSize(n){this.kernelSize=n}getResolutionScale(){return this.resolution.scale}setResolutionScale(n){this.resolution.scale=n}render(n,t,e,i,s){const r=this.scene,o=this.camera,a=this.renderTargetA,l=this.renderTargetB,h=this.blurMaterial,u=h.kernelSequence;let d=t;this.fullscreenMaterial=h;for(let f=0,p=u.length;f<p;++f){const g=f&1?l:a;h.kernel=u[f],h.inputBuffer=d.texture,n.setRenderTarget(g),n.render(r,o),d=g}this.fullscreenMaterial=this.copyMaterial,this.copyMaterial.inputBuffer=d.texture,n.setRenderTarget(this.renderToScreen?null:e),n.render(r,o)}setSize(n,t){const e=this.resolution;e.setBaseSize(n,t);const i=e.width,s=e.height;this.renderTargetA.setSize(i,s),this.renderTargetB.setSize(i,s),this.blurMaterial.setSize(n,t)}initialize(n,t,e){e!==void 0&&(this.renderTargetA.texture.type=e,this.renderTargetB.texture.type=e,e!==oi?(this.blurMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1",this.copyMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1"):n!==null&&n.outputColorSpace===Ue&&(this.renderTargetA.texture.colorSpace=Ue,this.renderTargetB.texture.colorSpace=Ue))}static get AUTO_SIZE(){return Rt.AUTO_SIZE}},Tj=`#include <common>
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#ifdef RANGE
uniform vec2 range;
#elif defined(THRESHOLD)
uniform float threshold;uniform float smoothing;
#endif
varying vec2 vUv;void main(){vec4 texel=texture2D(inputBuffer,vUv);float l=luminance(texel.rgb);
#ifdef RANGE
float low=step(range.x,l);float high=step(l,range.y);l*=low*high;
#elif defined(THRESHOLD)
l=smoothstep(threshold,threshold+smoothing,l)*l;
#endif
#ifdef COLOR
gl_FragColor=vec4(texel.rgb*clamp(l,0.0,1.0),l);
#else
gl_FragColor=vec4(l);
#endif
}`,Rj=class extends $e{constructor(n=!1,t=null){super({name:"LuminanceMaterial",defines:{THREE_REVISION:ay.replace(/\D+/g,"")},uniforms:{inputBuffer:new $(null),threshold:new $(0),smoothing:new $(1),range:new $(null)},blending:Ms,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:Tj,vertexShader:Kh}),this.colorOutput=n,this.luminanceRange=t}set inputBuffer(n){this.uniforms.inputBuffer.value=n}setInputBuffer(n){this.uniforms.inputBuffer.value=n}get threshold(){return this.uniforms.threshold.value}set threshold(n){this.smoothing>0||n>0?this.defines.THRESHOLD="1":delete this.defines.THRESHOLD,this.uniforms.threshold.value=n}getThreshold(){return this.threshold}setThreshold(n){this.threshold=n}get smoothing(){return this.uniforms.smoothing.value}set smoothing(n){this.threshold>0||n>0?this.defines.THRESHOLD="1":delete this.defines.THRESHOLD,this.uniforms.smoothing.value=n}getSmoothingFactor(){return this.smoothing}setSmoothingFactor(n){this.smoothing=n}get useThreshold(){return this.threshold>0||this.smoothing>0}set useThreshold(n){}get colorOutput(){return this.defines.COLOR!==void 0}set colorOutput(n){n?this.defines.COLOR="1":delete this.defines.COLOR,this.needsUpdate=!0}isColorOutputEnabled(n){return this.colorOutput}setColorOutputEnabled(n){this.colorOutput=n}get useRange(){return this.luminanceRange!==null}set useRange(n){this.luminanceRange=null}get luminanceRange(){return this.uniforms.range.value}set luminanceRange(n){n!==null?this.defines.RANGE="1":delete this.defines.RANGE,this.uniforms.range.value=n,this.needsUpdate=!0}getLuminanceRange(){return this.luminanceRange}setLuminanceRange(n){this.luminanceRange=n}},xM=class extends Gn{constructor({renderTarget:n,luminanceRange:t,colorOutput:e,resolutionScale:i=1,width:s=Rt.AUTO_SIZE,height:r=Rt.AUTO_SIZE,resolutionX:o=s,resolutionY:a=r}={}){super("LuminancePass"),this.fullscreenMaterial=new Rj(e,t),this.needsSwap=!1,this.renderTarget=n,this.renderTarget===void 0&&(this.renderTarget=new Ct(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="LuminancePass.Target");const l=this.resolution=new Rt(this,o,a,i);l.addEventListener("change",h=>this.setSize(l.baseWidth,l.baseHeight))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}render(n,t,e,i,s){const r=this.fullscreenMaterial;r.inputBuffer=t.texture,n.setRenderTarget(this.renderToScreen?null:this.renderTarget),n.render(this.scene,this.camera)}setSize(n,t){const e=this.resolution;e.setBaseSize(n,t),this.renderTarget.setSize(e.width,e.height)}initialize(n,t,e){e!==void 0&&e!==oi&&(this.renderTarget.texture.type=e,this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}},Bj=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#define WEIGHT_INNER 0.125
#define WEIGHT_OUTER 0.0555555
varying vec2 vUv;varying vec2 vUv00;varying vec2 vUv01;varying vec2 vUv02;varying vec2 vUv03;varying vec2 vUv04;varying vec2 vUv05;varying vec2 vUv06;varying vec2 vUv07;varying vec2 vUv08;varying vec2 vUv09;varying vec2 vUv10;varying vec2 vUv11;float clampToBorder(const in vec2 uv){return float(uv.s>=0.0&&uv.s<=1.0&&uv.t>=0.0&&uv.t<=1.0);}void main(){vec4 c=vec4(0.0);vec4 w=WEIGHT_INNER*vec4(clampToBorder(vUv00),clampToBorder(vUv01),clampToBorder(vUv02),clampToBorder(vUv03));c+=w.x*texture2D(inputBuffer,vUv00);c+=w.y*texture2D(inputBuffer,vUv01);c+=w.z*texture2D(inputBuffer,vUv02);c+=w.w*texture2D(inputBuffer,vUv03);w=WEIGHT_OUTER*vec4(clampToBorder(vUv04),clampToBorder(vUv05),clampToBorder(vUv06),clampToBorder(vUv07));c+=w.x*texture2D(inputBuffer,vUv04);c+=w.y*texture2D(inputBuffer,vUv05);c+=w.z*texture2D(inputBuffer,vUv06);c+=w.w*texture2D(inputBuffer,vUv07);w=WEIGHT_OUTER*vec4(clampToBorder(vUv08),clampToBorder(vUv09),clampToBorder(vUv10),clampToBorder(vUv11));c+=w.x*texture2D(inputBuffer,vUv08);c+=w.y*texture2D(inputBuffer,vUv09);c+=w.z*texture2D(inputBuffer,vUv10);c+=w.w*texture2D(inputBuffer,vUv11);c+=WEIGHT_OUTER*texture2D(inputBuffer,vUv);gl_FragColor=c;
#include <colorspace_fragment>
}`,Pj="uniform vec2 texelSize;varying vec2 vUv;varying vec2 vUv00;varying vec2 vUv01;varying vec2 vUv02;varying vec2 vUv03;varying vec2 vUv04;varying vec2 vUv05;varying vec2 vUv06;varying vec2 vUv07;varying vec2 vUv08;varying vec2 vUv09;varying vec2 vUv10;varying vec2 vUv11;void main(){vUv=position.xy*0.5+0.5;vUv00=vUv+texelSize*vec2(-1.0,1.0);vUv01=vUv+texelSize*vec2(1.0,1.0);vUv02=vUv+texelSize*vec2(-1.0,-1.0);vUv03=vUv+texelSize*vec2(1.0,-1.0);vUv04=vUv+texelSize*vec2(-2.0,2.0);vUv05=vUv+texelSize*vec2(0.0,2.0);vUv06=vUv+texelSize*vec2(2.0,2.0);vUv07=vUv+texelSize*vec2(-2.0,0.0);vUv08=vUv+texelSize*vec2(2.0,0.0);vUv09=vUv+texelSize*vec2(-2.0,-2.0);vUv10=vUv+texelSize*vec2(0.0,-2.0);vUv11=vUv+texelSize*vec2(2.0,-2.0);gl_Position=vec4(position.xy,1.0,1.0);}",Mj=class extends $e{constructor(){super({name:"DownsamplingMaterial",uniforms:{inputBuffer:new $(null),texelSize:new $(new ae)},blending:Ms,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:Bj,vertexShader:Pj}),this.fragmentShader=Hd(this.fragmentShader)}set inputBuffer(n){this.uniforms.inputBuffer.value=n}setSize(n,t){this.uniforms.texelSize.value.set(1/n,1/t)}},Dj=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;uniform mediump sampler2D supportBuffer;
#else
uniform lowp sampler2D inputBuffer;uniform lowp sampler2D supportBuffer;
#endif
uniform float radius;varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;varying vec2 vUv6;varying vec2 vUv7;void main(){vec4 c=vec4(0.0);c+=texture2D(inputBuffer,vUv0)*0.0625;c+=texture2D(inputBuffer,vUv1)*0.125;c+=texture2D(inputBuffer,vUv2)*0.0625;c+=texture2D(inputBuffer,vUv3)*0.125;c+=texture2D(inputBuffer,vUv)*0.25;c+=texture2D(inputBuffer,vUv4)*0.125;c+=texture2D(inputBuffer,vUv5)*0.0625;c+=texture2D(inputBuffer,vUv6)*0.125;c+=texture2D(inputBuffer,vUv7)*0.0625;vec4 baseColor=texture2D(supportBuffer,vUv);gl_FragColor=mix(baseColor,c,radius);
#include <colorspace_fragment>
}`,kj="uniform vec2 texelSize;varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;varying vec2 vUv6;varying vec2 vUv7;void main(){vUv=position.xy*0.5+0.5;vUv0=vUv+texelSize*vec2(-1.0,1.0);vUv1=vUv+texelSize*vec2(0.0,1.0);vUv2=vUv+texelSize*vec2(1.0,1.0);vUv3=vUv+texelSize*vec2(-1.0,0.0);vUv4=vUv+texelSize*vec2(1.0,0.0);vUv5=vUv+texelSize*vec2(-1.0,-1.0);vUv6=vUv+texelSize*vec2(0.0,-1.0);vUv7=vUv+texelSize*vec2(1.0,-1.0);gl_Position=vec4(position.xy,1.0,1.0);}",Oj=class extends $e{constructor(){super({name:"UpsamplingMaterial",uniforms:{inputBuffer:new $(null),supportBuffer:new $(null),texelSize:new $(new ae),radius:new $(.85)},blending:Ms,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:Dj,vertexShader:kj}),this.fragmentShader=Hd(this.fragmentShader)}set inputBuffer(n){this.uniforms.inputBuffer.value=n}set supportBuffer(n){this.uniforms.supportBuffer.value=n}get radius(){return this.uniforms.radius.value}set radius(n){this.uniforms.radius.value=n}setSize(n,t){this.uniforms.texelSize.value.set(1/n,1/t)}},Lj=class extends Gn{constructor(){super("MipmapBlurPass"),this.needsSwap=!1,this.renderTarget=new Ct(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="Upsampling.Mipmap0",this.downsamplingMipmaps=[],this.upsamplingMipmaps=[],this.downsamplingMaterial=new Mj,this.upsamplingMaterial=new Oj,this.resolution=new ae}get texture(){return this.renderTarget.texture}get levels(){return this.downsamplingMipmaps.length}set levels(n){if(this.levels!==n){const t=this.renderTarget;this.dispose(),this.downsamplingMipmaps=[],this.upsamplingMipmaps=[];for(let e=0;e<n;++e){const i=t.clone();i.texture.name="Downsampling.Mipmap"+e,this.downsamplingMipmaps.push(i)}this.upsamplingMipmaps.push(t);for(let e=1,i=n-1;e<i;++e){const s=t.clone();s.texture.name="Upsampling.Mipmap"+e,this.upsamplingMipmaps.push(s)}this.setSize(this.resolution.x,this.resolution.y)}}get radius(){return this.upsamplingMaterial.radius}set radius(n){this.upsamplingMaterial.radius=n}render(n,t,e,i,s){const{scene:r,camera:o}=this,{downsamplingMaterial:a,upsamplingMaterial:l}=this,{downsamplingMipmaps:h,upsamplingMipmaps:u}=this;let d=t;this.fullscreenMaterial=a;for(let f=0,p=h.length;f<p;++f){const g=h[f];a.setSize(d.width,d.height),a.inputBuffer=d.texture,n.setRenderTarget(g),n.render(r,o),d=g}this.fullscreenMaterial=l;for(let f=u.length-1;f>=0;--f){const p=u[f];l.setSize(d.width,d.height),l.inputBuffer=d.texture,l.supportBuffer=h[f].texture,n.setRenderTarget(p),n.render(r,o),d=p}}setSize(n,t){const e=this.resolution;e.set(n,t);let i=e.width,s=e.height;for(let r=0,o=this.downsamplingMipmaps.length;r<o;++r)i=Math.round(i*.5),s=Math.round(s*.5),this.downsamplingMipmaps[r].setSize(i,s),r<this.upsamplingMipmaps.length&&this.upsamplingMipmaps[r].setSize(i,s)}initialize(n,t,e){if(e!==void 0){const i=this.downsamplingMipmaps.concat(this.upsamplingMipmaps);for(const s of i)s.texture.type=e;if(e!==oi)this.downsamplingMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1",this.upsamplingMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1";else if(n!==null&&n.outputColorSpace===Ue)for(const s of i)s.texture.colorSpace=Ue}}dispose(){super.dispose();for(const n of this.downsamplingMipmaps.concat(this.upsamplingMipmaps))n.dispose()}},so=class extends Ml{constructor(n,t,{attributes:e=Ar.NONE,blendFunction:i=Xe.NORMAL,defines:s=new Map,uniforms:r=new Map,extensions:o=null,vertexShader:a=null}={}){super(),this.name=n,this.renderer=null,this.attributes=e,this.fragmentShader=t,this.vertexShader=a,this.defines=s,this.uniforms=r,this.extensions=o,this.blendMode=new Cj(i),this.blendMode.addEventListener("change",l=>this.setChanged()),this._inputColorSpace=Di,this._outputColorSpace=Fh}get inputColorSpace(){return this._inputColorSpace}set inputColorSpace(n){this._inputColorSpace=n,this.setChanged()}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(n){this._outputColorSpace=n,this.setChanged()}set mainScene(n){}set mainCamera(n){}getName(){return this.name}setRenderer(n){this.renderer=n}getDefines(){return this.defines}getUniforms(){return this.uniforms}getExtensions(){return this.extensions}getBlendMode(){return this.blendMode}getAttributes(){return this.attributes}setAttributes(n){this.attributes=n,this.setChanged()}getFragmentShader(){return this.fragmentShader}setFragmentShader(n){this.fragmentShader=n,this.setChanged()}getVertexShader(){return this.vertexShader}setVertexShader(n){this.vertexShader=n,this.setChanged()}setChanged(){this.dispatchEvent({type:"change"})}setDepthTexture(n,t=Rs){}update(n,t,e){}setSize(n,t){}initialize(n,t,e){}dispose(){for(const n of Object.keys(this)){const t=this[n];(t instanceof Ct||t instanceof ft||t instanceof pt||t instanceof Gn)&&this[n].dispose()}}},Fj=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D map;
#else
uniform lowp sampler2D map;
#endif
uniform float intensity;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec4 texel=texture2D(map,uv);outputColor=vec4(texel.rgb*intensity,texel.a);}`,nC=class extends so{constructor({blendFunction:n=Xe.SCREEN,luminanceThreshold:t=.9,luminanceSmoothing:e=.025,mipmapBlur:i=!1,intensity:s=1,radius:r=.85,levels:o=8,kernelSize:a=Il.LARGE,resolutionScale:l=.5,width:h=Rt.AUTO_SIZE,height:u=Rt.AUTO_SIZE,resolutionX:d=h,resolutionY:f=u}={}){super("BloomEffect",Fj,{blendFunction:n,uniforms:new Map([["map",new $(null)],["intensity",new $(s)]])}),this.renderTarget=new Ct(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="Bloom.Target",this.blurPass=new iC({kernelSize:a}),this.luminancePass=new xM({colorOutput:!0}),this.luminanceMaterial.threshold=t,this.luminanceMaterial.smoothing=e,this.mipmapBlurPass=new Lj,this.mipmapBlurPass.enabled=i,this.mipmapBlurPass.radius=r,this.mipmapBlurPass.levels=o,this.uniforms.get("map").value=i?this.mipmapBlurPass.texture:this.renderTarget.texture;const p=this.resolution=new Rt(this,d,f,l);p.addEventListener("change",g=>this.setSize(p.baseWidth,p.baseHeight))}get texture(){return this.mipmapBlurPass.enabled?this.mipmapBlurPass.texture:this.renderTarget.texture}getTexture(){return this.texture}getResolution(){return this.resolution}getBlurPass(){return this.blurPass}getLuminancePass(){return this.luminancePass}get luminanceMaterial(){return this.luminancePass.fullscreenMaterial}getLuminanceMaterial(){return this.luminancePass.fullscreenMaterial}get width(){return this.resolution.width}set width(n){this.resolution.preferredWidth=n}get height(){return this.resolution.height}set height(n){this.resolution.preferredHeight=n}get dithering(){return this.blurPass.dithering}set dithering(n){this.blurPass.dithering=n}get kernelSize(){return this.blurPass.kernelSize}set kernelSize(n){this.blurPass.kernelSize=n}get distinction(){return console.warn(this.name,"distinction was removed"),1}set distinction(n){console.warn(this.name,"distinction was removed")}get intensity(){return this.uniforms.get("intensity").value}set intensity(n){this.uniforms.get("intensity").value=n}getIntensity(){return this.intensity}setIntensity(n){this.intensity=n}getResolutionScale(){return this.resolution.scale}setResolutionScale(n){this.resolution.scale=n}update(n,t,e){const i=this.renderTarget,s=this.luminancePass;s.enabled?(s.render(n,t),this.mipmapBlurPass.enabled?this.mipmapBlurPass.render(n,s.renderTarget):this.blurPass.render(n,s.renderTarget,i)):this.mipmapBlurPass.enabled?this.mipmapBlurPass.render(n,t):this.blurPass.render(n,t,i)}setSize(n,t){const e=this.resolution;e.setBaseSize(n,t),this.renderTarget.setSize(e.width,e.height),this.blurPass.resolution.copy(e),this.luminancePass.setSize(n,t),this.mipmapBlurPass.setSize(n,t)}initialize(n,t,e){this.blurPass.initialize(n,t,e),this.luminancePass.initialize(n,t,e),this.mipmapBlurPass.initialize(n,t,e),e!==void 0&&(this.renderTarget.texture.type=e,n!==null&&n.outputColorSpace===Ue&&(this.renderTarget.texture.colorSpace=Ue))}},Uj="uniform float brightness;uniform float contrast;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec3 color=inputColor.rgb+vec3(brightness-0.5);if(contrast>0.0){color/=vec3(1.0-contrast);}else{color*=vec3(1.0+contrast);}outputColor=vec4(color+vec3(0.5),inputColor.a);}",CM=class extends so{constructor({blendFunction:n=Xe.SRC,brightness:t=0,contrast:e=0}={}){super("BrightnessContrastEffect",Uj,{blendFunction:n,uniforms:new Map([["brightness",new $(t)],["contrast",new $(e)]])}),this.inputColorSpace=Ue}get brightness(){return this.uniforms.get("brightness").value}set brightness(n){this.uniforms.get("brightness").value=n}getBrightness(){return this.brightness}setBrightness(n){this.brightness=n}get contrast(){return this.uniforms.get("contrast").value}set contrast(n){this.uniforms.get("contrast").value=n}getContrast(){return this.contrast}setContrast(n){this.contrast=n}},Nj=`#ifdef RADIAL_MODULATION
uniform float modulationOffset;
#endif
varying float vActive;varying vec2 vUvR;varying vec2 vUvB;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec2 ra=inputColor.ra;vec2 ba=inputColor.ba;
#ifdef RADIAL_MODULATION
const vec2 center=vec2(0.5);float d=distance(uv,center)*2.0;d=max(d-modulationOffset,0.0);if(vActive>0.0&&d>0.0){ra=texture2D(inputBuffer,mix(uv,vUvR,d)).ra;ba=texture2D(inputBuffer,mix(uv,vUvB,d)).ba;}
#else
if(vActive>0.0){ra=texture2D(inputBuffer,vUvR).ra;ba=texture2D(inputBuffer,vUvB).ba;}
#endif
outputColor=vec4(ra.x,inputColor.g,ba.x,max(max(ra.y,ba.y),inputColor.a));}`,Qj="uniform vec2 offset;varying float vActive;varying vec2 vUvR;varying vec2 vUvB;void mainSupport(const in vec2 uv){vec2 shift=offset*vec2(1.0,aspect);vActive=(shift.x!=0.0||shift.y!=0.0)?1.0:0.0;vUvR=uv+shift;vUvB=uv-shift;}",SM=class extends so{constructor({offset:n=new ae(.001,5e-4),radialModulation:t=!1,modulationOffset:e=.15}={}){super("ChromaticAberrationEffect",Nj,{vertexShader:Qj,attributes:Ar.CONVOLUTION,uniforms:new Map([["offset",new $(n)],["modulationOffset",new $(e)]])}),this.radialModulation=t}get offset(){return this.uniforms.get("offset").value}set offset(n){this.uniforms.get("offset").value=n}get radialModulation(){return this.defines.has("RADIAL_MODULATION")}set radialModulation(n){n?this.defines.set("RADIAL_MODULATION","1"):this.defines.delete("RADIAL_MODULATION"),this.setChanged()}get modulationOffset(){return this.uniforms.get("modulationOffset").value}set modulationOffset(n){this.uniforms.get("modulationOffset").value=n}getOffset(){return this.offset}setOffset(n){this.offset=n}},EM={RED:0,GREEN:1,BLUE:2,ALPHA:3},IM={DISCARD:0,MULTIPLY:1,MULTIPLY_RGB_SET_ALPHA:2,MULTIPLY_RGB:3},zj=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#if PASS == 1
uniform vec4 kernel64[32];
#else
uniform vec4 kernel16[8];
#endif
uniform lowp sampler2D cocBuffer;uniform vec2 texelSize;uniform float scale;varying vec2 vUv;void main(){
#ifdef FOREGROUND
vec2 cocNearFar=texture2D(cocBuffer,vUv).rg*scale;float coc=cocNearFar.x;
#else
float coc=texture2D(cocBuffer,vUv).g*scale;
#endif
if(coc==0.0){gl_FragColor=texture2D(inputBuffer,vUv);}else{
#ifdef FOREGROUND
vec2 step=texelSize*max(cocNearFar.x,cocNearFar.y);
#else
vec2 step=texelSize*coc;
#endif
#if PASS == 1
vec4 acc=vec4(0.0);for(int i=0;i<32;++i){vec4 kernel=kernel64[i];vec2 uv=step*kernel.xy+vUv;acc+=texture2D(inputBuffer,uv);uv=step*kernel.zw+vUv;acc+=texture2D(inputBuffer,uv);}gl_FragColor=acc/64.0;
#else
vec4 maxValue=texture2D(inputBuffer,vUv);for(int i=0;i<8;++i){vec4 kernel=kernel16[i];vec2 uv=step*kernel.xy+vUv;maxValue=max(texture2D(inputBuffer,uv),maxValue);uv=step*kernel.zw+vUv;maxValue=max(texture2D(inputBuffer,uv),maxValue);}gl_FragColor=maxValue;
#endif
}}`,Dm=class extends $e{constructor(n=!1,t=!1){super({name:"BokehMaterial",defines:{PASS:n?"2":"1"},uniforms:{inputBuffer:new $(null),cocBuffer:new $(null),texelSize:new $(new ae),kernel64:new $(null),kernel16:new $(null),scale:new $(1)},blending:Ms,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:zj,vertexShader:Kh}),t&&(this.defines.FOREGROUND="1"),this.generateKernel()}set inputBuffer(n){this.uniforms.inputBuffer.value=n}setInputBuffer(n){this.uniforms.inputBuffer.value=n}set cocBuffer(n){this.uniforms.cocBuffer.value=n}setCoCBuffer(n){this.uniforms.cocBuffer.value=n}get scale(){return this.uniforms.scale.value}set scale(n){this.uniforms.scale.value=n}getScale(n){return this.scale}setScale(n){this.scale=n}generateKernel(){const n=2.39996323,t=new Float64Array(128),e=new Float64Array(32);let i=0,s=0;for(let r=0,o=Math.sqrt(80);r<80;++r){const a=r*n,l=Math.sqrt(r)/o,h=l*Math.cos(a),u=l*Math.sin(a);r%5===0?(e[s++]=h,e[s++]=u):(t[i++]=h,t[i++]=u)}this.uniforms.kernel64.value=t,this.uniforms.kernel16.value=e}setTexelSize(n,t){this.uniforms.texelSize.value.set(n,t)}setSize(n,t){this.uniforms.texelSize.value.set(1/n,1/t)}};function Wu(n,t,e){return n*(t-e)-t}function gh(n,t,e){return Math.min(Math.max((n+t)/(t-e),0),1)}var jj=`#include <common>
#include <packing>
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
uniform float focusDistance;uniform float focusRange;uniform float cameraNear;uniform float cameraFar;varying vec2 vUv;float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
float depth=unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
float depth=texture2D(depthBuffer,uv).r;
#endif
#ifdef LOG_DEPTH
float d=pow(2.0,depth*log2(cameraFar+1.0))-1.0;float a=cameraFar/(cameraFar-cameraNear);float b=cameraFar*cameraNear/(cameraNear-cameraFar);depth=a+b/d;
#endif
return depth;}void main(){float depth=readDepth(vUv);
#ifdef PERSPECTIVE_CAMERA
float viewZ=perspectiveDepthToViewZ(depth,cameraNear,cameraFar);float linearDepth=viewZToOrthographicDepth(viewZ,cameraNear,cameraFar);
#else
float linearDepth=depth;
#endif
float signedDistance=linearDepth-focusDistance;float magnitude=smoothstep(0.0,focusRange,abs(signedDistance));gl_FragColor.rg=magnitude*vec2(step(signedDistance,0.0),step(0.0,signedDistance));}`,Gj=class extends $e{constructor(n){super({name:"CircleOfConfusionMaterial",defines:{DEPTH_PACKING:"0"},uniforms:{depthBuffer:new $(null),focusDistance:new $(0),focusRange:new $(0),cameraNear:new $(.3),cameraFar:new $(1e3)},blending:Ms,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:jj,vertexShader:Kh}),this.uniforms.focalLength=this.uniforms.focusRange,this.copyCameraSettings(n)}get near(){return this.uniforms.cameraNear.value}get far(){return this.uniforms.cameraFar.value}set depthBuffer(n){this.uniforms.depthBuffer.value=n}set depthPacking(n){this.defines.DEPTH_PACKING=n.toFixed(0),this.needsUpdate=!0}setDepthBuffer(n,t=Rs){this.depthBuffer=n,this.depthPacking=t}get focusDistance(){return this.uniforms.focusDistance.value}set focusDistance(n){this.uniforms.focusDistance.value=n}get worldFocusDistance(){return-Wu(this.focusDistance,this.near,this.far)}set worldFocusDistance(n){this.focusDistance=gh(-n,this.near,this.far)}getFocusDistance(n){this.uniforms.focusDistance.value=n}setFocusDistance(n){this.uniforms.focusDistance.value=n}get focalLength(){return this.focusRange}set focalLength(n){this.focusRange=n}get focusRange(){return this.uniforms.focusRange.value}set focusRange(n){this.uniforms.focusRange.value=n}get worldFocusRange(){return-Wu(this.focusRange,this.near,this.far)}set worldFocusRange(n){this.focusRange=gh(-n,this.near,this.far)}getFocalLength(n){return this.focusRange}setFocalLength(n){this.focusRange=n}adoptCameraSettings(n){this.copyCameraSettings(n)}copyCameraSettings(n){n&&(this.uniforms.cameraNear.value=n.near,this.uniforms.cameraFar.value=n.far,n instanceof xt?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}},Hj=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#ifdef MASK_PRECISION_HIGH
uniform mediump sampler2D maskTexture;
#else
uniform lowp sampler2D maskTexture;
#endif
#if MASK_FUNCTION != 0
uniform float strength;
#endif
varying vec2 vUv;void main(){
#if COLOR_CHANNEL == 0
float mask=texture2D(maskTexture,vUv).r;
#elif COLOR_CHANNEL == 1
float mask=texture2D(maskTexture,vUv).g;
#elif COLOR_CHANNEL == 2
float mask=texture2D(maskTexture,vUv).b;
#else
float mask=texture2D(maskTexture,vUv).a;
#endif
#if MASK_FUNCTION == 0
#ifdef INVERTED
mask=step(mask,0.0);
#else
mask=1.0-step(mask,0.0);
#endif
#else
mask=clamp(mask*strength,0.0,1.0);
#ifdef INVERTED
mask=1.0-mask;
#endif
#endif
#if MASK_FUNCTION == 3
vec4 texel=texture2D(inputBuffer,vUv);gl_FragColor=vec4(mask*texel.rgb,texel.a);
#elif MASK_FUNCTION == 2
gl_FragColor=vec4(mask*texture2D(inputBuffer,vUv).rgb,mask);
#else
gl_FragColor=mask*texture2D(inputBuffer,vUv);
#endif
}`,Vj=class extends $e{constructor(n=null){super({name:"MaskMaterial",uniforms:{maskTexture:new $(n),inputBuffer:new $(null),strength:new $(1)},blending:Ms,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:Hj,vertexShader:Kh}),this.colorChannel=EM.RED,this.maskFunction=IM.DISCARD}set inputBuffer(n){this.uniforms.inputBuffer.value=n}setInputBuffer(n){this.uniforms.inputBuffer.value=n}set maskTexture(n){this.uniforms.maskTexture.value=n,delete this.defines.MASK_PRECISION_HIGH,n.type!==oi&&(this.defines.MASK_PRECISION_HIGH="1"),this.needsUpdate=!0}setMaskTexture(n){this.maskTexture=n}set colorChannel(n){this.defines.COLOR_CHANNEL=n.toFixed(0),this.needsUpdate=!0}setColorChannel(n){this.colorChannel=n}set maskFunction(n){this.defines.MASK_FUNCTION=n.toFixed(0),this.needsUpdate=!0}setMaskFunction(n){this.maskFunction=n}get inverted(){return this.defines.INVERTED!==void 0}set inverted(n){this.inverted&&!n?delete this.defines.INVERTED:n&&(this.defines.INVERTED="1"),this.needsUpdate=!0}isInverted(){return this.inverted}setInverted(n){this.inverted=n}get strength(){return this.uniforms.strength.value}set strength(n){this.uniforms.strength.value=n}getStrength(){return this.strength}setStrength(n){this.strength=n}},da=class extends Gn{constructor(n,t="inputBuffer"){super("ShaderPass"),this.fullscreenMaterial=n,this.input=t}setInput(n){this.input=n}render(n,t,e,i,s){const r=this.fullscreenMaterial.uniforms;t!==null&&r!==void 0&&r[this.input]!==void 0&&(r[this.input].value=t.texture),n.setRenderTarget(this.renderToScreen?null:e),n.render(this.scene,this.camera)}initialize(n,t,e){e!==void 0&&e!==oi&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}},Wj=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D nearColorBuffer;uniform mediump sampler2D farColorBuffer;
#else
uniform lowp sampler2D nearColorBuffer;uniform lowp sampler2D farColorBuffer;
#endif
uniform lowp sampler2D nearCoCBuffer;uniform lowp sampler2D farCoCBuffer;uniform float scale;void mainImage(const in vec4 inputColor,const in vec2 uv,const in float depth,out vec4 outputColor){vec4 colorNear=texture2D(nearColorBuffer,uv);vec4 colorFar=texture2D(farColorBuffer,uv);
#if MASK_FUNCTION == 1
vec2 cocNearFar=vec2(texture2D(nearCoCBuffer,uv).r,colorFar.a);cocNearFar.x=min(cocNearFar.x*scale,1.0);
#else
vec2 cocNearFar=vec2(texture2D(nearCoCBuffer,uv).r,texture2D(farCoCBuffer,uv).g);cocNearFar=min(cocNearFar*scale,1.0);
#endif
vec4 result=inputColor*(1.0-cocNearFar.y)+colorFar;result=mix(result,colorNear,cocNearFar.x);outputColor=result;}`,TM=class extends so{constructor(n,{blendFunction:t,worldFocusDistance:e,worldFocusRange:i,focusDistance:s=0,focalLength:r=.1,focusRange:o=r,bokehScale:a=1,resolutionScale:l=1,width:h=Rt.AUTO_SIZE,height:u=Rt.AUTO_SIZE,resolutionX:d=h,resolutionY:f=u}={}){super("DepthOfFieldEffect",Wj,{blendFunction:t,attributes:Ar.DEPTH,uniforms:new Map([["nearColorBuffer",new $(null)],["farColorBuffer",new $(null)],["nearCoCBuffer",new $(null)],["farCoCBuffer",new $(null)],["scale",new $(1)]])}),this.camera=n,this.renderTarget=new Ct(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="DoF.Intermediate",this.renderTargetMasked=this.renderTarget.clone(),this.renderTargetMasked.texture.name="DoF.Masked.Far",this.renderTargetNear=this.renderTarget.clone(),this.renderTargetNear.texture.name="DoF.Bokeh.Near",this.uniforms.get("nearColorBuffer").value=this.renderTargetNear.texture,this.renderTargetFar=this.renderTarget.clone(),this.renderTargetFar.texture.name="DoF.Bokeh.Far",this.uniforms.get("farColorBuffer").value=this.renderTargetFar.texture,this.renderTargetCoC=this.renderTarget.clone(),this.renderTargetCoC.texture.name="DoF.CoC",this.uniforms.get("farCoCBuffer").value=this.renderTargetCoC.texture,this.renderTargetCoCBlurred=this.renderTargetCoC.clone(),this.renderTargetCoCBlurred.texture.name="DoF.CoC.Blurred",this.uniforms.get("nearCoCBuffer").value=this.renderTargetCoCBlurred.texture,this.cocPass=new da(new Gj(n));const p=this.cocMaterial;p.focusDistance=s,p.focusRange=o,e!==void 0&&(p.worldFocusDistance=e),i!==void 0&&(p.worldFocusRange=i),this.blurPass=new iC({resolutionScale:l,resolutionX:d,resolutionY:f,kernelSize:Il.MEDIUM}),this.maskPass=new da(new Vj(this.renderTargetCoC.texture));const g=this.maskPass.fullscreenMaterial;g.colorChannel=EM.GREEN,this.maskFunction=IM.MULTIPLY_RGB,this.bokehNearBasePass=new da(new Dm(!1,!0)),this.bokehNearBasePass.fullscreenMaterial.cocBuffer=this.renderTargetCoCBlurred.texture,this.bokehNearFillPass=new da(new Dm(!0,!0)),this.bokehNearFillPass.fullscreenMaterial.cocBuffer=this.renderTargetCoCBlurred.texture,this.bokehFarBasePass=new da(new Dm(!1,!1)),this.bokehFarBasePass.fullscreenMaterial.cocBuffer=this.renderTargetCoC.texture,this.bokehFarFillPass=new da(new Dm(!0,!1)),this.bokehFarFillPass.fullscreenMaterial.cocBuffer=this.renderTargetCoC.texture,this.target=null;const m=this.resolution=new Rt(this,d,f,l);m.addEventListener("change",v=>this.setSize(m.baseWidth,m.baseHeight)),this.bokehScale=a}set mainCamera(n){this.camera=n,this.cocMaterial.copyCameraSettings(n)}get cocTexture(){return this.renderTargetCoC.texture}get maskFunction(){return this.maskPass.fullscreenMaterial.maskFunction}set maskFunction(n){this.maskFunction!==n&&(this.defines.set("MASK_FUNCTION",n.toFixed(0)),this.maskPass.fullscreenMaterial.maskFunction=n,this.setChanged())}get cocMaterial(){return this.cocPass.fullscreenMaterial}get circleOfConfusionMaterial(){return this.cocMaterial}getCircleOfConfusionMaterial(){return this.cocMaterial}getBlurPass(){return this.blurPass}getResolution(){return this.resolution}get bokehScale(){return this.uniforms.get("scale").value}set bokehScale(n){this.bokehNearBasePass.fullscreenMaterial.scale=n,this.bokehNearFillPass.fullscreenMaterial.scale=n,this.bokehFarBasePass.fullscreenMaterial.scale=n,this.bokehFarFillPass.fullscreenMaterial.scale=n,this.maskPass.fullscreenMaterial.strength=n,this.uniforms.get("scale").value=n}getBokehScale(){return this.bokehScale}setBokehScale(n){this.bokehScale=n}getTarget(){return this.target}setTarget(n){this.target=n}calculateFocusDistance(n){const t=this.camera,e=t.position.distanceTo(n);return gh(-e,t.near,t.far)}setDepthTexture(n,t=Rs){this.cocMaterial.depthBuffer=n,this.cocMaterial.depthPacking=t}update(n,t,e){const i=this.renderTarget,s=this.renderTargetCoC,r=this.renderTargetCoCBlurred,o=this.renderTargetMasked;if(this.target!==null){const a=this.calculateFocusDistance(this.target);this.cocMaterial.focusDistance=a}this.cocPass.render(n,null,s),this.blurPass.render(n,s,r),this.maskPass.render(n,t,o),this.bokehFarBasePass.render(n,o,i),this.bokehFarFillPass.render(n,i,this.renderTargetFar),this.bokehNearBasePass.render(n,t,i),this.bokehNearFillPass.render(n,i,this.renderTargetNear)}setSize(n,t){const e=this.resolution;e.setBaseSize(n,t);const i=e.width,s=e.height;this.cocPass.setSize(n,t),this.blurPass.setSize(n,t),this.maskPass.setSize(n,t),this.renderTargetFar.setSize(n,t),this.renderTargetCoC.setSize(n,t),this.renderTargetMasked.setSize(n,t),this.renderTarget.setSize(i,s),this.renderTargetNear.setSize(i,s),this.renderTargetCoCBlurred.setSize(i,s),this.bokehNearBasePass.fullscreenMaterial.setSize(n,t),this.bokehNearFillPass.fullscreenMaterial.setSize(n,t),this.bokehFarBasePass.fullscreenMaterial.setSize(n,t),this.bokehFarFillPass.fullscreenMaterial.setSize(n,t)}initialize(n,t,e){this.cocPass.initialize(n,t,e),this.maskPass.initialize(n,t,e),this.bokehNearBasePass.initialize(n,t,e),this.bokehNearFillPass.initialize(n,t,e),this.bokehFarBasePass.initialize(n,t,e),this.bokehFarFillPass.initialize(n,t,e),this.blurPass.initialize(n,t,oi),n.capabilities.logarithmicDepthBuffer&&(this.cocPass.fullscreenMaterial.defines.LOG_DEPTH="1"),e!==void 0&&(this.renderTarget.texture.type=e,this.renderTargetNear.texture.type=e,this.renderTargetFar.texture.type=e,this.renderTargetMasked.texture.type=e,n!==null&&n.outputColorSpace===Ue&&(this.renderTarget.texture.colorSpace=Ue,this.renderTargetNear.texture.colorSpace=Ue,this.renderTargetFar.texture.colorSpace=Ue,this.renderTargetMasked.texture.colorSpace=Ue))}};function qj(n,t,e){const i=new Map([[QR,1],[mc,1],[zu,2],[kn,4]]);let s;if(i.has(t)||console.error("Invalid noise texture format"),e===oi){s=new Uint8Array(n*i.get(t));for(let r=0,o=s.length;r<o;++r)s[r]=Math.random()*255+.5}else{s=new Float32Array(n*i.get(t));for(let r=0,o=s.length;r<o;++r)s[r]=Math.random()}return s}var Xj=class extends zd{constructor(n,t,e=QR,i=oi){super(qj(n*t,e,i),n,t,e,i),this.needsUpdate=!0}},yp={DEFAULT:0,KEEP_MAX_DEPTH:1,DISCARD_MAX_DEPTH:2},Yj=`#include <common>
#include <packing>
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer0;uniform highp sampler2D depthBuffer1;
#else
uniform mediump sampler2D depthBuffer0;uniform mediump sampler2D depthBuffer1;
#endif
uniform sampler2D inputBuffer;uniform vec2 cameraNearFar;float getViewZ(const in float depth){
#ifdef PERSPECTIVE_CAMERA
return perspectiveDepthToViewZ(depth,cameraNearFar.x,cameraNearFar.y);
#else
return orthographicDepthToViewZ(depth,cameraNearFar.x,cameraNearFar.y);
#endif
}varying vec2 vUv;void main(){vec2 depth;
#if DEPTH_PACKING_0 == 3201
depth.x=unpackRGBAToDepth(texture2D(depthBuffer0,vUv));
#else
depth.x=texture2D(depthBuffer0,vUv).r;
#ifdef LOG_DEPTH
float d=pow(2.0,depth.x*log2(cameraNearFar.y+1.0))-1.0;float a=cameraNearFar.y/(cameraNearFar.y-cameraNearFar.x);float b=cameraNearFar.y*cameraNearFar.x/(cameraNearFar.x-cameraNearFar.y);depth.x=a+b/d;
#endif
#endif
#if DEPTH_PACKING_1 == 3201
depth.y=unpackRGBAToDepth(texture2D(depthBuffer1,vUv));
#else
depth.y=texture2D(depthBuffer1,vUv).r;
#ifdef LOG_DEPTH
float d=pow(2.0,depth.y*log2(cameraNearFar.y+1.0))-1.0;float a=cameraNearFar.y/(cameraNearFar.y-cameraNearFar.x);float b=cameraNearFar.y*cameraNearFar.x/(cameraNearFar.x-cameraNearFar.y);depth.y=a+b/d;
#endif
#endif
bool isMaxDepth=(depth.x==1.0);
#ifdef PERSPECTIVE_CAMERA
depth.x=viewZToOrthographicDepth(getViewZ(depth.x),cameraNearFar.x,cameraNearFar.y);depth.y=viewZToOrthographicDepth(getViewZ(depth.y),cameraNearFar.x,cameraNearFar.y);
#endif
#if DEPTH_TEST_STRATEGY == 0
bool keep=depthTest(depth.x,depth.y);
#elif DEPTH_TEST_STRATEGY == 1
bool keep=isMaxDepth||depthTest(depth.x,depth.y);
#else
bool keep=!isMaxDepth&&depthTest(depth.x,depth.y);
#endif
if(keep){gl_FragColor=texture2D(inputBuffer,vUv);}else{discard;}}`,Kj=class extends $e{constructor(){super({name:"DepthMaskMaterial",defines:{DEPTH_EPSILON:"0.0001",DEPTH_PACKING_0:"0",DEPTH_PACKING_1:"0",DEPTH_TEST_STRATEGY:yp.KEEP_MAX_DEPTH},uniforms:{inputBuffer:new $(null),depthBuffer0:new $(null),depthBuffer1:new $(null),cameraNearFar:new $(new ae(1,1))},blending:Ms,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:Yj,vertexShader:Kh}),this.depthMode=x_}set depthBuffer0(n){this.uniforms.depthBuffer0.value=n}set depthPacking0(n){this.defines.DEPTH_PACKING_0=n.toFixed(0),this.needsUpdate=!0}setDepthBuffer0(n,t=Rs){this.depthBuffer0=n,this.depthPacking0=t}set depthBuffer1(n){this.uniforms.depthBuffer1.value=n}set depthPacking1(n){this.defines.DEPTH_PACKING_1=n.toFixed(0),this.needsUpdate=!0}setDepthBuffer1(n,t=Rs){this.depthBuffer1=n,this.depthPacking1=t}get maxDepthStrategy(){return Number(this.defines.DEPTH_TEST_STRATEGY)}set maxDepthStrategy(n){this.defines.DEPTH_TEST_STRATEGY=n.toFixed(0),this.needsUpdate=!0}get keepFar(){return this.maxDepthStrategy}set keepFar(n){this.maxDepthStrategy=n?yp.KEEP_MAX_DEPTH:yp.DISCARD_MAX_DEPTH}getMaxDepthStrategy(){return this.maxDepthStrategy}setMaxDepthStrategy(n){this.maxDepthStrategy=n}get epsilon(){return Number(this.defines.DEPTH_EPSILON)}set epsilon(n){this.defines.DEPTH_EPSILON=n.toFixed(16),this.needsUpdate=!0}getEpsilon(){return this.epsilon}setEpsilon(n){this.epsilon=n}get depthMode(){return Number(this.defines.DEPTH_MODE)}set depthMode(n){let t;switch(n){case g2:t="false";break;case VR:t="true";break;case ev:t="abs(d1 - d0) <= DEPTH_EPSILON";break;case px:t="abs(d1 - d0) > DEPTH_EPSILON";break;case x_:t="d0 > d1";break;case HR:t="d0 >= d1";break;case GR:t="d0 <= d1";break;case jR:default:t="d0 < d1";break}this.defines.DEPTH_MODE=n.toFixed(0),this.defines["depthTest(d0, d1)"]=t,this.needsUpdate=!0}getDepthMode(){return this.depthMode}setDepthMode(n){this.depthMode=n}adoptCameraSettings(n){this.copyCameraSettings(n)}copyCameraSettings(n){n&&(this.uniforms.cameraNearFar.value.set(n.near,n.far),n instanceof xt?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}},Ty=class extends Gn{constructor(n,t,e=null){super("RenderPass",n,t),this.needsSwap=!1,this.clearPass=new Iy,this.overrideMaterialManager=e===null?null:new v1(e),this.ignoreBackground=!1,this.skipShadowMapUpdate=!1,this.selection=null}set mainScene(n){this.scene=n}set mainCamera(n){this.camera=n}get renderToScreen(){return super.renderToScreen}set renderToScreen(n){super.renderToScreen=n,this.clearPass.renderToScreen=n}get overrideMaterial(){const n=this.overrideMaterialManager;return n!==null?n.material:null}set overrideMaterial(n){const t=this.overrideMaterialManager;n!==null?t!==null?t.setMaterial(n):this.overrideMaterialManager=new v1(n):t!==null&&(t.dispose(),this.overrideMaterialManager=null)}getOverrideMaterial(){return this.overrideMaterial}setOverrideMaterial(n){this.overrideMaterial=n}get clear(){return this.clearPass.enabled}set clear(n){this.clearPass.enabled=n}getSelection(){return this.selection}setSelection(n){this.selection=n}isBackgroundDisabled(){return this.ignoreBackground}setBackgroundDisabled(n){this.ignoreBackground=n}isShadowMapDisabled(){return this.skipShadowMapUpdate}setShadowMapDisabled(n){this.skipShadowMapUpdate=n}getClearPass(){return this.clearPass}render(n,t,e,i,s){const r=this.scene,o=this.camera,a=this.selection,l=o.layers.mask,h=r.background,u=n.shadowMap.autoUpdate,d=this.renderToScreen?null:t;a!==null&&o.layers.set(a.getLayer()),this.skipShadowMapUpdate&&(n.shadowMap.autoUpdate=!1),(this.ignoreBackground||this.clearPass.overrideClearColor!==null)&&(r.background=null),this.clearPass.enabled&&this.clearPass.render(n,t),n.setRenderTarget(d),this.overrideMaterialManager!==null?this.overrideMaterialManager.render(n,r,o):n.render(r,o),o.layers.mask=l,r.background=h,n.shadowMap.autoUpdate=u}},Jj="uniform vec3 hue;uniform float saturation;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec3 color=vec3(dot(inputColor.rgb,hue.xyz),dot(inputColor.rgb,hue.zxy),dot(inputColor.rgb,hue.yzx));float average=(color.r+color.g+color.b)/3.0;vec3 diff=average-color;if(saturation>0.0){color+=diff*(1.0-1.0/(1.001-saturation));}else{color+=diff*-saturation;}outputColor=vec4(min(color,1.0),inputColor.a);}",RM=class extends so{constructor({blendFunction:n=Xe.SRC,hue:t=0,saturation:e=0}={}){super("HueSaturationEffect",Jj,{blendFunction:n,uniforms:new Map([["hue",new $(new C)],["saturation",new $(e)]])}),this.hue=t}get saturation(){return this.uniforms.get("saturation").value}set saturation(n){this.uniforms.get("saturation").value=n}getSaturation(){return this.saturation}setSaturation(n){this.saturation=n}get hue(){const n=this.uniforms.get("hue").value;return Math.acos((n.x*3-1)/2)}set hue(n){const t=Math.sin(n),e=Math.cos(n);this.uniforms.get("hue").value.set((2*e+1)/3,(-Math.sqrt(3)*t-e+1)/3,(Math.sqrt(3)*t-e+1)/3)}getHue(){return this.hue}setHue(n){this.hue=n}},sC={DEPTH:0,LUMA:1,COLOR:2},Zj={DISABLED:0,DEPTH:1,CUSTOM:2},Ou={LOW:0,MEDIUM:1,HIGH:2,ULTRA:3},Rn={LINEAR:0,REINHARD:1,REINHARD2:2,REINHARD2_ADAPTIVE:3,UNCHARTED2:4,OPTIMIZED_CINEON:5,ACES_FILMIC:6,AGX:7,NEUTRAL:8},Mf={DEFAULT:0,ESKIL:1},$j=class extends Gn{constructor(n,t,{renderTarget:e,resolutionScale:i=1,width:s=Rt.AUTO_SIZE,height:r=Rt.AUTO_SIZE,resolutionX:o=s,resolutionY:a=r}={}){super("DepthPass"),this.needsSwap=!1,this.renderPass=new Ty(n,t,new zR({depthPacking:UR}));const l=this.renderPass;l.skipShadowMapUpdate=!0,l.ignoreBackground=!0;const h=l.clearPass;h.overrideClearColor=new we(16777215),h.overrideClearAlpha=1,this.renderTarget=e,this.renderTarget===void 0&&(this.renderTarget=new Ct(1,1,{minFilter:Wt,magFilter:Wt}),this.renderTarget.texture.name="DepthPass.Target");const u=this.resolution=new Rt(this,o,a,i);u.addEventListener("change",d=>this.setSize(u.baseWidth,u.baseHeight))}set mainScene(n){this.renderPass.mainScene=n}set mainCamera(n){this.renderPass.mainCamera=n}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}getResolutionScale(){return this.resolution.scale}setResolutionScale(n){this.resolution.scale=n}render(n,t,e,i,s){const r=this.renderToScreen?null:this.renderTarget;this.renderPass.render(n,r)}setSize(n,t){const e=this.resolution;e.setBaseSize(n,t),this.renderTarget.setSize(e.width,e.height)}},e8="uniform bool active;uniform vec4 d;void mainUv(inout vec2 uv){if(active){uv=d.xy*(floor(uv*d.zw)+0.5);}}",BM=class extends so{constructor(t=30){super("PixelationEffect",e8,{uniforms:new Map([["active",new $(!1)],["d",new $(new ke)]])}),this.resolution=new ae,this._granularity=0,this.granularity=t}get granularity(){return this._granularity}set granularity(t){let e=Math.floor(t);e%2>0&&(e+=1),this._granularity=e,this.uniforms.get("active").value=e>0,this.setSize(this.resolution.width,this.resolution.height)}getGranularity(){return this.granularity}setGranularity(t){this.granularity=t}setSize(t,e){const i=this.resolution;i.set(t,e);const s=this.granularity,r=s/i.x,o=s/i.y;this.uniforms.get("d").value.set(r,o,1/r,1/o)}},PM=class extends nC{constructor(n,t,e){super(e),this.setAttributes(this.getAttributes()|Ar.DEPTH),this.camera=t,this.depthPass=new $j(n,t),this.clearPass=new Iy(!0,!1,!1),this.clearPass.overrideClearColor=new we(0),this.depthMaskPass=new da(new Kj);const i=this.depthMaskMaterial;i.copyCameraSettings(t),i.depthBuffer1=this.depthPass.texture,i.depthPacking1=UR,i.depthMode=ev,this.renderTargetMasked=new Ct(1,1,{depthBuffer:!1}),this.renderTargetMasked.texture.name="Bloom.Masked",this.selection=new Hz,this.selection.layer=11,this._inverted=!1,this._ignoreBackground=!1}set mainScene(n){this.depthPass.mainScene=n}set mainCamera(n){this.camera=n,this.depthPass.mainCamera=n,this.depthMaskMaterial.copyCameraSettings(n)}getSelection(){return this.selection}get depthMaskMaterial(){return this.depthMaskPass.fullscreenMaterial}get inverted(){return this._inverted}set inverted(n){this._inverted=n,this.depthMaskMaterial.depthMode=n?px:ev}isInverted(){return this.inverted}setInverted(n){this.inverted=n}get ignoreBackground(){return this._ignoreBackground}set ignoreBackground(n){this._ignoreBackground=n,this.depthMaskMaterial.maxDepthStrategy=n?yp.DISCARD_MAX_DEPTH:yp.KEEP_MAX_DEPTH}isBackgroundDisabled(){return this.ignoreBackground}setBackgroundDisabled(n){this.ignoreBackground=n}setDepthTexture(n,t=Rs){this.depthMaskMaterial.depthBuffer0=n,this.depthMaskMaterial.depthPacking0=t}update(n,t,e){const i=this.camera,s=this.selection,r=this.inverted;let o=t;if(this.ignoreBackground||!r||s.size>0){const a=i.layers.mask;i.layers.set(s.layer),this.depthPass.render(n),i.layers.mask=a,o=this.renderTargetMasked,this.clearPass.render(n,o),this.depthMaskPass.render(n,t,o)}super.update(n,o,e)}setSize(n,t){super.setSize(n,t),this.renderTargetMasked.setSize(n,t),this.depthPass.setSize(n,t)}initialize(n,t,e){super.initialize(n,t,e),this.clearPass.initialize(n,t,e),this.depthPass.initialize(n,t,e),this.depthMaskPass.initialize(n,t,e),n!==null&&n.capabilities.logarithmicDepthBuffer&&(this.depthMaskPass.fullscreenMaterial.defines.LOG_DEPTH="1"),e!==void 0&&(this.renderTargetMasked.texture.type=e,n!==null&&n.outputColorSpace===Ue&&(this.renderTargetMasked.texture.colorSpace=Ue))}},t8=`varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;
#if EDGE_DETECTION_MODE != 0
varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;
#endif
#if EDGE_DETECTION_MODE == 1
#include <common>
#endif
#if EDGE_DETECTION_MODE == 0 || PREDICATION_MODE == 1
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}vec3 gatherNeighbors(){float p=readDepth(vUv);float pLeft=readDepth(vUv0);float pTop=readDepth(vUv1);return vec3(p,pLeft,pTop);}
#elif PREDICATION_MODE == 2
uniform sampler2D predicationBuffer;vec3 gatherNeighbors(){float p=texture2D(predicationBuffer,vUv).r;float pLeft=texture2D(predicationBuffer,vUv0).r;float pTop=texture2D(predicationBuffer,vUv1).r;return vec3(p,pLeft,pTop);}
#endif
#if PREDICATION_MODE != 0
vec2 calculatePredicatedThreshold(){vec3 neighbours=gatherNeighbors();vec2 delta=abs(neighbours.xx-neighbours.yz);vec2 edges=step(PREDICATION_THRESHOLD,delta);return PREDICATION_SCALE*EDGE_THRESHOLD*(1.0-PREDICATION_STRENGTH*edges);}
#endif
#if EDGE_DETECTION_MODE != 0
uniform sampler2D inputBuffer;
#endif
void main(){
#if EDGE_DETECTION_MODE == 0
const vec2 threshold=vec2(DEPTH_THRESHOLD);
#elif PREDICATION_MODE != 0
vec2 threshold=calculatePredicatedThreshold();
#else
const vec2 threshold=vec2(EDGE_THRESHOLD);
#endif
#if EDGE_DETECTION_MODE == 0
vec3 neighbors=gatherNeighbors();vec2 delta=abs(neighbors.xx-vec2(neighbors.y,neighbors.z));vec2 edges=step(threshold,delta);if(dot(edges,vec2(1.0))==0.0){discard;}gl_FragColor=vec4(edges,0.0,1.0);
#elif EDGE_DETECTION_MODE == 1
float l=luminance(texture2D(inputBuffer,vUv).rgb);float lLeft=luminance(texture2D(inputBuffer,vUv0).rgb);float lTop=luminance(texture2D(inputBuffer,vUv1).rgb);vec4 delta;delta.xy=abs(l-vec2(lLeft,lTop));vec2 edges=step(threshold,delta.xy);if(dot(edges,vec2(1.0))==0.0){discard;}float lRight=luminance(texture2D(inputBuffer,vUv2).rgb);float lBottom=luminance(texture2D(inputBuffer,vUv3).rgb);delta.zw=abs(l-vec2(lRight,lBottom));vec2 maxDelta=max(delta.xy,delta.zw);float lLeftLeft=luminance(texture2D(inputBuffer,vUv4).rgb);float lTopTop=luminance(texture2D(inputBuffer,vUv5).rgb);delta.zw=abs(vec2(lLeft,lTop)-vec2(lLeftLeft,lTopTop));maxDelta=max(maxDelta.xy,delta.zw);float finalDelta=max(maxDelta.x,maxDelta.y);edges.xy*=step(finalDelta,LOCAL_CONTRAST_ADAPTATION_FACTOR*delta.xy);gl_FragColor=vec4(edges,0.0,1.0);
#elif EDGE_DETECTION_MODE == 2
vec4 delta;vec3 c=texture2D(inputBuffer,vUv).rgb;vec3 cLeft=texture2D(inputBuffer,vUv0).rgb;vec3 t=abs(c-cLeft);delta.x=max(max(t.r,t.g),t.b);vec3 cTop=texture2D(inputBuffer,vUv1).rgb;t=abs(c-cTop);delta.y=max(max(t.r,t.g),t.b);vec2 edges=step(threshold,delta.xy);if(dot(edges,vec2(1.0))==0.0){discard;}vec3 cRight=texture2D(inputBuffer,vUv2).rgb;t=abs(c-cRight);delta.z=max(max(t.r,t.g),t.b);vec3 cBottom=texture2D(inputBuffer,vUv3).rgb;t=abs(c-cBottom);delta.w=max(max(t.r,t.g),t.b);vec2 maxDelta=max(delta.xy,delta.zw);vec3 cLeftLeft=texture2D(inputBuffer,vUv4).rgb;t=abs(c-cLeftLeft);delta.z=max(max(t.r,t.g),t.b);vec3 cTopTop=texture2D(inputBuffer,vUv5).rgb;t=abs(c-cTopTop);delta.w=max(max(t.r,t.g),t.b);maxDelta=max(maxDelta.xy,delta.zw);float finalDelta=max(maxDelta.x,maxDelta.y);edges*=step(finalDelta,LOCAL_CONTRAST_ADAPTATION_FACTOR*delta.xy);gl_FragColor=vec4(edges,0.0,1.0);
#endif
}`,i8=`uniform vec2 texelSize;varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;
#if EDGE_DETECTION_MODE != 0
varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;
#endif
void main(){vUv=position.xy*0.5+0.5;vUv0=vUv+texelSize*vec2(-1.0,0.0);vUv1=vUv+texelSize*vec2(0.0,-1.0);
#if EDGE_DETECTION_MODE != 0
vUv2=vUv+texelSize*vec2(1.0,0.0);vUv3=vUv+texelSize*vec2(0.0,1.0);vUv4=vUv+texelSize*vec2(-2.0,0.0);vUv5=vUv+texelSize*vec2(0.0,-2.0);
#endif
gl_Position=vec4(position.xy,1.0,1.0);}`,n8=class extends $e{constructor(n=new ae,t=sC.COLOR){super({name:"EdgeDetectionMaterial",defines:{THREE_REVISION:ay.replace(/\D+/g,""),LOCAL_CONTRAST_ADAPTATION_FACTOR:"2.0",EDGE_THRESHOLD:"0.1",DEPTH_THRESHOLD:"0.01",PREDICATION_MODE:"0",PREDICATION_THRESHOLD:"0.01",PREDICATION_SCALE:"2.0",PREDICATION_STRENGTH:"1.0",DEPTH_PACKING:"0"},uniforms:{inputBuffer:new $(null),depthBuffer:new $(null),predicationBuffer:new $(null),texelSize:new $(n)},blending:Ms,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:t8,vertexShader:i8}),this.edgeDetectionMode=t}set depthBuffer(n){this.uniforms.depthBuffer.value=n}set depthPacking(n){this.defines.DEPTH_PACKING=n.toFixed(0),this.needsUpdate=!0}setDepthBuffer(n,t=Rs){this.depthBuffer=n,this.depthPacking=t}get edgeDetectionMode(){return Number(this.defines.EDGE_DETECTION_MODE)}set edgeDetectionMode(n){this.defines.EDGE_DETECTION_MODE=n.toFixed(0),this.needsUpdate=!0}getEdgeDetectionMode(){return this.edgeDetectionMode}setEdgeDetectionMode(n){this.edgeDetectionMode=n}get localContrastAdaptationFactor(){return Number(this.defines.LOCAL_CONTRAST_ADAPTATION_FACTOR)}set localContrastAdaptationFactor(n){this.defines.LOCAL_CONTRAST_ADAPTATION_FACTOR=n.toFixed("6"),this.needsUpdate=!0}getLocalContrastAdaptationFactor(){return this.localContrastAdaptationFactor}setLocalContrastAdaptationFactor(n){this.localContrastAdaptationFactor=n}get edgeDetectionThreshold(){return Number(this.defines.EDGE_THRESHOLD)}set edgeDetectionThreshold(n){this.defines.EDGE_THRESHOLD=n.toFixed("6"),this.defines.DEPTH_THRESHOLD=(n*.1).toFixed("6"),this.needsUpdate=!0}getEdgeDetectionThreshold(){return this.edgeDetectionThreshold}setEdgeDetectionThreshold(n){this.edgeDetectionThreshold=n}get predicationMode(){return Number(this.defines.PREDICATION_MODE)}set predicationMode(n){this.defines.PREDICATION_MODE=n.toFixed(0),this.needsUpdate=!0}getPredicationMode(){return this.predicationMode}setPredicationMode(n){this.predicationMode=n}set predicationBuffer(n){this.uniforms.predicationBuffer.value=n}setPredicationBuffer(n){this.uniforms.predicationBuffer.value=n}get predicationThreshold(){return Number(this.defines.PREDICATION_THRESHOLD)}set predicationThreshold(n){this.defines.PREDICATION_THRESHOLD=n.toFixed("6"),this.needsUpdate=!0}getPredicationThreshold(){return this.predicationThreshold}setPredicationThreshold(n){this.predicationThreshold=n}get predicationScale(){return Number(this.defines.PREDICATION_SCALE)}set predicationScale(n){this.defines.PREDICATION_SCALE=n.toFixed("6"),this.needsUpdate=!0}getPredicationScale(){return this.predicationScale}setPredicationScale(n){this.predicationScale=n}get predicationStrength(){return Number(this.defines.PREDICATION_STRENGTH)}set predicationStrength(n){this.defines.PREDICATION_STRENGTH=n.toFixed("6"),this.needsUpdate=!0}getPredicationStrength(){return this.predicationStrength}setPredicationStrength(n){this.predicationStrength=n}setSize(n,t){this.uniforms.texelSize.value.set(1/n,1/t)}},s8=`#define sampleLevelZeroOffset(t, coord, offset) texture2D(t, coord + offset * texelSize)
#if __VERSION__ < 300
#define round(v) floor(v + 0.5)
#endif
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
uniform lowp sampler2D areaTexture;uniform lowp sampler2D searchTexture;uniform vec2 texelSize;uniform vec2 resolution;varying vec2 vUv;varying vec4 vOffset[3];varying vec2 vPixCoord;void movec(const in bvec2 c,inout vec2 variable,const in vec2 value){if(c.x){variable.x=value.x;}if(c.y){variable.y=value.y;}}void movec(const in bvec4 c,inout vec4 variable,const in vec4 value){movec(c.xy,variable.xy,value.xy);movec(c.zw,variable.zw,value.zw);}vec2 decodeDiagBilinearAccess(in vec2 e){e.r=e.r*abs(5.0*e.r-5.0*0.75);return round(e);}vec4 decodeDiagBilinearAccess(in vec4 e){e.rb=e.rb*abs(5.0*e.rb-5.0*0.75);return round(e);}vec2 searchDiag1(const in vec2 texCoord,const in vec2 dir,out vec2 e){vec4 coord=vec4(texCoord,-1.0,1.0);vec3 t=vec3(texelSize,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(coord.z<float(MAX_SEARCH_STEPS_DIAG_INT-1)&&coord.w>0.9)){break;}coord.xyz=t*vec3(dir,1.0)+coord.xyz;e=texture2D(inputBuffer,coord.xy).rg;coord.w=dot(e,vec2(0.5));}return coord.zw;}vec2 searchDiag2(const in vec2 texCoord,const in vec2 dir,out vec2 e){vec4 coord=vec4(texCoord,-1.0,1.0);coord.x+=0.25*texelSize.x;vec3 t=vec3(texelSize,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(coord.z<float(MAX_SEARCH_STEPS_DIAG_INT-1)&&coord.w>0.9)){break;}coord.xyz=t*vec3(dir,1.0)+coord.xyz;e=texture2D(inputBuffer,coord.xy).rg;e=decodeDiagBilinearAccess(e);coord.w=dot(e,vec2(0.5));}return coord.zw;}vec2 areaDiag(const in vec2 dist,const in vec2 e,const in float offset){vec2 texCoord=vec2(AREATEX_MAX_DISTANCE_DIAG,AREATEX_MAX_DISTANCE_DIAG)*e+dist;texCoord=AREATEX_PIXEL_SIZE*texCoord+0.5*AREATEX_PIXEL_SIZE;texCoord.x+=0.5;texCoord.y+=AREATEX_SUBTEX_SIZE*offset;return texture2D(areaTexture,texCoord).rg;}vec2 calculateDiagWeights(const in vec2 texCoord,const in vec2 e,const in vec4 subsampleIndices){vec2 weights=vec2(0.0);vec4 d;vec2 end;if(e.r>0.0){d.xz=searchDiag1(texCoord,vec2(-1.0,1.0),end);d.x+=float(end.y>0.9);}else{d.xz=vec2(0.0);}d.yw=searchDiag1(texCoord,vec2(1.0,-1.0),end);if(d.x+d.y>2.0){vec4 coords=vec4(-d.x+0.25,d.x,d.y,-d.y-0.25)*texelSize.xyxy+texCoord.xyxy;vec4 c;c.xy=sampleLevelZeroOffset(inputBuffer,coords.xy,vec2(-1,0)).rg;c.zw=sampleLevelZeroOffset(inputBuffer,coords.zw,vec2(1,0)).rg;c.yxwz=decodeDiagBilinearAccess(c.xyzw);vec2 cc=vec2(2.0)*c.xz+c.yw;movec(bvec2(step(0.9,d.zw)),cc,vec2(0.0));weights+=areaDiag(d.xy,cc,subsampleIndices.z);}d.xz=searchDiag2(texCoord,vec2(-1.0,-1.0),end);if(sampleLevelZeroOffset(inputBuffer,texCoord,vec2(1,0)).r>0.0){d.yw=searchDiag2(texCoord,vec2(1.0),end);d.y+=float(end.y>0.9);}else{d.yw=vec2(0.0);}if(d.x+d.y>2.0){vec4 coords=vec4(-d.x,-d.x,d.y,d.y)*texelSize.xyxy+texCoord.xyxy;vec4 c;c.x=sampleLevelZeroOffset(inputBuffer,coords.xy,vec2(-1,0)).g;c.y=sampleLevelZeroOffset(inputBuffer,coords.xy,vec2(0,-1)).r;c.zw=sampleLevelZeroOffset(inputBuffer,coords.zw,vec2(1,0)).gr;vec2 cc=vec2(2.0)*c.xz+c.yw;movec(bvec2(step(0.9,d.zw)),cc,vec2(0.0));weights+=areaDiag(d.xy,cc,subsampleIndices.w).gr;}return weights;}float searchLength(const in vec2 e,const in float offset){vec2 scale=SEARCHTEX_SIZE*vec2(0.5,-1.0);vec2 bias=SEARCHTEX_SIZE*vec2(offset,1.0);scale+=vec2(-1.0,1.0);bias+=vec2(0.5,-0.5);scale*=1.0/SEARCHTEX_PACKED_SIZE;bias*=1.0/SEARCHTEX_PACKED_SIZE;return texture2D(searchTexture,scale*e+bias).r;}float searchXLeft(in vec2 texCoord,const in float end){vec2 e=vec2(0.0,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(texCoord.x>end&&e.g>0.8281&&e.r==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=vec2(-2.0,0.0)*texelSize+texCoord;}float offset=-(255.0/127.0)*searchLength(e,0.0)+3.25;return texelSize.x*offset+texCoord.x;}float searchXRight(vec2 texCoord,const in float end){vec2 e=vec2(0.0,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(texCoord.x<end&&e.g>0.8281&&e.r==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=vec2(2.0,0.0)*texelSize.xy+texCoord;}float offset=-(255.0/127.0)*searchLength(e,0.5)+3.25;return-texelSize.x*offset+texCoord.x;}float searchYUp(vec2 texCoord,const in float end){vec2 e=vec2(1.0,0.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(texCoord.y>end&&e.r>0.8281&&e.g==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=-vec2(0.0,2.0)*texelSize.xy+texCoord;}float offset=-(255.0/127.0)*searchLength(e.gr,0.0)+3.25;return texelSize.y*offset+texCoord.y;}float searchYDown(vec2 texCoord,const in float end){vec2 e=vec2(1.0,0.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;i++){if(!(texCoord.y<end&&e.r>0.8281&&e.g==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=vec2(0.0,2.0)*texelSize.xy+texCoord;}float offset=-(255.0/127.0)*searchLength(e.gr,0.5)+3.25;return-texelSize.y*offset+texCoord.y;}vec2 area(const in vec2 dist,const in float e1,const in float e2,const in float offset){vec2 texCoord=vec2(AREATEX_MAX_DISTANCE)*round(4.0*vec2(e1,e2))+dist;texCoord=AREATEX_PIXEL_SIZE*texCoord+0.5*AREATEX_PIXEL_SIZE;texCoord.y=AREATEX_SUBTEX_SIZE*offset+texCoord.y;return texture2D(areaTexture,texCoord).rg;}void detectHorizontalCornerPattern(inout vec2 weights,const in vec4 texCoord,const in vec2 d){
#if !defined(DISABLE_CORNER_DETECTION)
vec2 leftRight=step(d.xy,d.yx);vec2 rounding=(1.0-CORNER_ROUNDING_NORM)*leftRight;rounding/=leftRight.x+leftRight.y;vec2 factor=vec2(1.0);factor.x-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(0,1)).r;factor.x-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(1,1)).r;factor.y-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(0,-2)).r;factor.y-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(1,-2)).r;weights*=clamp(factor,0.0,1.0);
#endif
}void detectVerticalCornerPattern(inout vec2 weights,const in vec4 texCoord,const in vec2 d){
#if !defined(DISABLE_CORNER_DETECTION)
vec2 leftRight=step(d.xy,d.yx);vec2 rounding=(1.0-CORNER_ROUNDING_NORM)*leftRight;rounding/=leftRight.x+leftRight.y;vec2 factor=vec2(1.0);factor.x-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(1,0)).g;factor.x-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(1,1)).g;factor.y-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(-2,0)).g;factor.y-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(-2,1)).g;weights*=clamp(factor,0.0,1.0);
#endif
}void main(){vec4 weights=vec4(0.0);vec4 subsampleIndices=vec4(0.0);vec2 e=texture2D(inputBuffer,vUv).rg;if(e.g>0.0){
#if !defined(DISABLE_DIAG_DETECTION)
weights.rg=calculateDiagWeights(vUv,e,subsampleIndices);if(weights.r==-weights.g){
#endif
vec2 d;vec3 coords;coords.x=searchXLeft(vOffset[0].xy,vOffset[2].x);coords.y=vOffset[1].y;d.x=coords.x;float e1=texture2D(inputBuffer,coords.xy).r;coords.z=searchXRight(vOffset[0].zw,vOffset[2].y);d.y=coords.z;d=round(resolution.xx*d+-vPixCoord.xx);vec2 sqrtD=sqrt(abs(d));float e2=sampleLevelZeroOffset(inputBuffer,coords.zy,vec2(1,0)).r;weights.rg=area(sqrtD,e1,e2,subsampleIndices.y);coords.y=vUv.y;detectHorizontalCornerPattern(weights.rg,coords.xyzy,d);
#if !defined(DISABLE_DIAG_DETECTION)
}else{e.r=0.0;}
#endif
}if(e.r>0.0){vec2 d;vec3 coords;coords.y=searchYUp(vOffset[1].xy,vOffset[2].z);coords.x=vOffset[0].x;d.x=coords.y;float e1=texture2D(inputBuffer,coords.xy).g;coords.z=searchYDown(vOffset[1].zw,vOffset[2].w);d.y=coords.z;d=round(resolution.yy*d-vPixCoord.yy);vec2 sqrtD=sqrt(abs(d));float e2=sampleLevelZeroOffset(inputBuffer,coords.xz,vec2(0,1)).g;weights.ba=area(sqrtD,e1,e2,subsampleIndices.x);coords.x=vUv.x;detectVerticalCornerPattern(weights.ba,coords.xyxz,d);}gl_FragColor=weights;}`,r8="uniform vec2 texelSize;uniform vec2 resolution;varying vec2 vUv;varying vec4 vOffset[3];varying vec2 vPixCoord;void main(){vUv=position.xy*0.5+0.5;vPixCoord=vUv*resolution;vOffset[0]=vUv.xyxy+texelSize.xyxy*vec4(-0.25,-0.125,1.25,-0.125);vOffset[1]=vUv.xyxy+texelSize.xyxy*vec4(-0.125,-0.25,-0.125,1.25);vOffset[2]=vec4(vOffset[0].xz,vOffset[1].yw)+vec4(-2.0,2.0,-2.0,2.0)*texelSize.xxyy*MAX_SEARCH_STEPS_FLOAT;gl_Position=vec4(position.xy,1.0,1.0);}",o8=class extends $e{constructor(n=new ae,t=new ae){super({name:"SMAAWeightsMaterial",defines:{MAX_SEARCH_STEPS_INT:"16",MAX_SEARCH_STEPS_FLOAT:"16.0",MAX_SEARCH_STEPS_DIAG_INT:"8",MAX_SEARCH_STEPS_DIAG_FLOAT:"8.0",CORNER_ROUNDING:"25",CORNER_ROUNDING_NORM:"0.25",AREATEX_MAX_DISTANCE:"16.0",AREATEX_MAX_DISTANCE_DIAG:"20.0",AREATEX_PIXEL_SIZE:"(1.0 / vec2(160.0, 560.0))",AREATEX_SUBTEX_SIZE:"(1.0 / 7.0)",SEARCHTEX_SIZE:"vec2(66.0, 33.0)",SEARCHTEX_PACKED_SIZE:"vec2(64.0, 16.0)"},uniforms:{inputBuffer:new $(null),searchTexture:new $(null),areaTexture:new $(null),resolution:new $(t),texelSize:new $(n)},blending:Ms,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:s8,vertexShader:r8})}set inputBuffer(n){this.uniforms.inputBuffer.value=n}setInputBuffer(n){this.uniforms.inputBuffer.value=n}get searchTexture(){return this.uniforms.searchTexture.value}set searchTexture(n){this.uniforms.searchTexture.value=n}get areaTexture(){return this.uniforms.areaTexture.value}set areaTexture(n){this.uniforms.areaTexture.value=n}setLookupTextures(n,t){this.searchTexture=n,this.areaTexture=t}get orthogonalSearchSteps(){return Number(this.defines.MAX_SEARCH_STEPS_INT)}set orthogonalSearchSteps(n){const t=Math.min(Math.max(n,0),112);this.defines.MAX_SEARCH_STEPS_INT=t.toFixed("0"),this.defines.MAX_SEARCH_STEPS_FLOAT=t.toFixed("1"),this.needsUpdate=!0}setOrthogonalSearchSteps(n){this.orthogonalSearchSteps=n}get diagonalSearchSteps(){return Number(this.defines.MAX_SEARCH_STEPS_DIAG_INT)}set diagonalSearchSteps(n){const t=Math.min(Math.max(n,0),20);this.defines.MAX_SEARCH_STEPS_DIAG_INT=t.toFixed("0"),this.defines.MAX_SEARCH_STEPS_DIAG_FLOAT=t.toFixed("1"),this.needsUpdate=!0}setDiagonalSearchSteps(n){this.diagonalSearchSteps=n}get diagonalDetection(){return this.defines.DISABLE_DIAG_DETECTION===void 0}set diagonalDetection(n){n?delete this.defines.DISABLE_DIAG_DETECTION:this.defines.DISABLE_DIAG_DETECTION="1",this.needsUpdate=!0}isDiagonalDetectionEnabled(){return this.diagonalDetection}setDiagonalDetectionEnabled(n){this.diagonalDetection=n}get cornerRounding(){return Number(this.defines.CORNER_ROUNDING)}set cornerRounding(n){const t=Math.min(Math.max(n,0),100);this.defines.CORNER_ROUNDING=t.toFixed("4"),this.defines.CORNER_ROUNDING_NORM=(t/100).toFixed("4"),this.needsUpdate=!0}setCornerRounding(n){this.cornerRounding=n}get cornerDetection(){return this.defines.DISABLE_CORNER_DETECTION===void 0}set cornerDetection(n){n?delete this.defines.DISABLE_CORNER_DETECTION:this.defines.DISABLE_CORNER_DETECTION="1",this.needsUpdate=!0}isCornerRoundingEnabled(){return this.cornerDetection}setCornerRoundingEnabled(n){this.cornerDetection=n}setSize(n,t){const e=this.uniforms;e.texelSize.value.set(1/n,1/t),e.resolution.value.set(n,t)}},y1="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAAQCAYAAACm53kpAAAAeElEQVRYR+2XSwqAMAxEJ168ePEqwRSKhIIiuHjJqiU0gWE+1CQdApcVAMUAuARaMGCX1MIL/Ow13++9lW2s3mW9MWvsnWc/2fvGygwPAN4E8QzAA4CXAB6AHjG4JTHYI1ey3pcx6FHnEfhLDOIBKAmUBK6/ANUDTlROXAHd9EC1AAAAAElFTkSuQmCC",b1="data:image/png;base64,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",a8="uniform sampler2D weightMap;varying vec2 vOffset0;varying vec2 vOffset1;void movec(const in bvec2 c,inout vec2 variable,const in vec2 value){if(c.x){variable.x=value.x;}if(c.y){variable.y=value.y;}}void movec(const in bvec4 c,inout vec4 variable,const in vec4 value){movec(c.xy,variable.xy,value.xy);movec(c.zw,variable.zw,value.zw);}void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec4 a;a.x=texture2D(weightMap,vOffset0).a;a.y=texture2D(weightMap,vOffset1).g;a.wz=texture2D(weightMap,uv).rb;vec4 color=inputColor;if(dot(a,vec4(1.0))>=1e-5){bool h=max(a.x,a.z)>max(a.y,a.w);vec4 blendingOffset=vec4(0.0,a.y,0.0,a.w);vec2 blendingWeight=a.yw;movec(bvec4(h),blendingOffset,vec4(a.x,0.0,a.z,0.0));movec(bvec2(h),blendingWeight,a.xz);blendingWeight/=dot(blendingWeight,vec2(1.0));vec4 blendingCoord=blendingOffset*vec4(texelSize,-texelSize)+uv.xyxy;color=blendingWeight.x*texture2D(inputBuffer,blendingCoord.xy);color+=blendingWeight.y*texture2D(inputBuffer,blendingCoord.zw);}outputColor=color;}",l8="varying vec2 vOffset0;varying vec2 vOffset1;void mainSupport(const in vec2 uv){vOffset0=uv+texelSize*vec2(1.0,0.0);vOffset1=uv+texelSize*vec2(0.0,1.0);}",MM=class extends so{constructor({blendFunction:n=Xe.SRC,preset:t=Ou.MEDIUM,edgeDetectionMode:e=sC.COLOR,predicationMode:i=Zj.DISABLED}={}){super("SMAAEffect",a8,{vertexShader:l8,blendFunction:n,attributes:Ar.CONVOLUTION|Ar.DEPTH,uniforms:new Map([["weightMap",new $(null)]])});let s,r;arguments.length>1&&(s=arguments[0],r=arguments[1],arguments.length>2&&(t=arguments[2]),arguments.length>3&&(e=arguments[3])),this.renderTargetEdges=new Ct(1,1,{depthBuffer:!1}),this.renderTargetEdges.texture.name="SMAA.Edges",this.renderTargetWeights=this.renderTargetEdges.clone(),this.renderTargetWeights.texture.name="SMAA.Weights",this.uniforms.get("weightMap").value=this.renderTargetWeights.texture,this.clearPass=new Iy(!0,!1,!1),this.clearPass.overrideClearColor=new we(0),this.clearPass.overrideClearAlpha=1,this.edgeDetectionPass=new da(new n8),this.edgeDetectionMaterial.edgeDetectionMode=e,this.edgeDetectionMaterial.predicationMode=i,this.weightsPass=new da(new o8);const o=new f2;o.onLoad=()=>{const a=new pt(s);a.name="SMAA.Search",a.magFilter=Wt,a.minFilter=Wt,a.generateMipmaps=!1,a.needsUpdate=!0,a.flipY=!0,this.weightsMaterial.searchTexture=a;const l=new pt(r);l.name="SMAA.Area",l.magFilter=Tt,l.minFilter=Tt,l.generateMipmaps=!1,l.needsUpdate=!0,l.flipY=!1,this.weightsMaterial.areaTexture=l,this.dispatchEvent({type:"load"})},o.itemStart("search"),o.itemStart("area"),s!==void 0&&r!==void 0?(o.itemEnd("search"),o.itemEnd("area")):typeof Image<"u"&&(s=new Image,r=new Image,s.addEventListener("load",()=>o.itemEnd("search")),r.addEventListener("load",()=>o.itemEnd("area")),s.src=y1,r.src=b1),this.applyPreset(t)}get edgesTexture(){return this.renderTargetEdges.texture}getEdgesTexture(){return this.edgesTexture}get weightsTexture(){return this.renderTargetWeights.texture}getWeightsTexture(){return this.weightsTexture}get edgeDetectionMaterial(){return this.edgeDetectionPass.fullscreenMaterial}get colorEdgesMaterial(){return this.edgeDetectionMaterial}getEdgeDetectionMaterial(){return this.edgeDetectionMaterial}get weightsMaterial(){return this.weightsPass.fullscreenMaterial}getWeightsMaterial(){return this.weightsMaterial}setEdgeDetectionThreshold(n){this.edgeDetectionMaterial.edgeDetectionThreshold=n}setOrthogonalSearchSteps(n){this.weightsMaterial.orthogonalSearchSteps=n}applyPreset(n){const t=this.edgeDetectionMaterial,e=this.weightsMaterial;switch(n){case Ou.LOW:t.edgeDetectionThreshold=.15,e.orthogonalSearchSteps=4,e.diagonalDetection=!1,e.cornerDetection=!1;break;case Ou.MEDIUM:t.edgeDetectionThreshold=.1,e.orthogonalSearchSteps=8,e.diagonalDetection=!1,e.cornerDetection=!1;break;case Ou.HIGH:t.edgeDetectionThreshold=.1,e.orthogonalSearchSteps=16,e.diagonalSearchSteps=8,e.cornerRounding=25,e.diagonalDetection=!0,e.cornerDetection=!0;break;case Ou.ULTRA:t.edgeDetectionThreshold=.05,e.orthogonalSearchSteps=32,e.diagonalSearchSteps=16,e.cornerRounding=25,e.diagonalDetection=!0,e.cornerDetection=!0;break}}setDepthTexture(n,t=Rs){this.edgeDetectionMaterial.depthBuffer=n,this.edgeDetectionMaterial.depthPacking=t}update(n,t,e){this.clearPass.render(n,this.renderTargetEdges),this.edgeDetectionPass.render(n,t,this.renderTargetEdges),this.weightsPass.render(n,this.renderTargetEdges,this.renderTargetWeights)}setSize(n,t){this.edgeDetectionMaterial.setSize(n,t),this.weightsMaterial.setSize(n,t),this.renderTargetEdges.setSize(n,t),this.renderTargetWeights.setSize(n,t)}dispose(){const{searchTexture:n,areaTexture:t}=this.weightsMaterial;n!==null&&t!==null&&(n.dispose(),t.dispose()),super.dispose()}static get searchImageDataURL(){return y1}static get areaImageDataURL(){return b1}},c8=`#include <common>
#include <packing>
#ifdef NORMAL_DEPTH
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D normalDepthBuffer;
#else
uniform mediump sampler2D normalDepthBuffer;
#endif
float readDepth(const in vec2 uv){return texture2D(normalDepthBuffer,uv).a;}
#else
uniform lowp sampler2D normalBuffer;
#if DEPTH_PACKING == 3201
uniform lowp sampler2D depthBuffer;
#elif defined(GL_FRAGMENT_PRECISION_HIGH)
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}
#endif
uniform lowp sampler2D noiseTexture;uniform mat4 inverseProjectionMatrix;uniform mat4 projectionMatrix;uniform vec2 texelSize;uniform vec2 cameraNearFar;uniform float intensity;uniform float minRadiusScale;uniform float fade;uniform float bias;uniform vec2 distanceCutoff;uniform vec2 proximityCutoff;varying vec2 vUv;varying vec2 vUv2;float getViewZ(const in float depth){
#ifdef PERSPECTIVE_CAMERA
return perspectiveDepthToViewZ(depth,cameraNearFar.x,cameraNearFar.y);
#else
return orthographicDepthToViewZ(depth,cameraNearFar.x,cameraNearFar.y);
#endif
}vec3 getViewPosition(const in vec2 screenPosition,const in float depth,const in float viewZ){vec4 clipPosition=vec4(vec3(screenPosition,depth)*2.0-1.0,1.0);float clipW=projectionMatrix[2][3]*viewZ+projectionMatrix[3][3];clipPosition*=clipW;return(inverseProjectionMatrix*clipPosition).xyz;}float getAmbientOcclusion(const in vec3 p,const in vec3 n,const in float depth,const in vec2 uv){float radiusScale=1.0-smoothstep(0.0,distanceCutoff.y,depth);radiusScale=radiusScale*(1.0-minRadiusScale)+minRadiusScale;float radius=RADIUS*radiusScale;float noise=texture2D(noiseTexture,vUv2).r;float baseAngle=noise*PI2;float rings=SPIRAL_TURNS*PI2;float occlusion=0.0;int taps=0;for(int i=0;i<SAMPLES_INT;++i){float alpha=(float(i)+0.5)*INV_SAMPLES_FLOAT;float angle=alpha*rings+baseAngle;vec2 rotation=vec2(cos(angle),sin(angle));vec2 coords=alpha*radius*rotation*texelSize+uv;if(coords.s<0.0||coords.s>1.0||coords.t<0.0||coords.t>1.0){continue;}float sampleDepth=readDepth(coords);float viewZ=getViewZ(sampleDepth);
#ifdef PERSPECTIVE_CAMERA
float linearSampleDepth=viewZToOrthographicDepth(viewZ,cameraNearFar.x,cameraNearFar.y);
#else
float linearSampleDepth=sampleDepth;
#endif
float proximity=abs(depth-linearSampleDepth);if(proximity<proximityCutoff.y){float falloff=1.0-smoothstep(proximityCutoff.x,proximityCutoff.y,proximity);vec3 Q=getViewPosition(coords,sampleDepth,viewZ);vec3 v=Q-p;float vv=dot(v,v);float vn=dot(v,n)-bias;float f=max(RADIUS_SQ-vv,0.0)/RADIUS_SQ;occlusion+=(f*f*f*max(vn/(fade+vv),0.0))*falloff;}++taps;}return occlusion/(4.0*max(float(taps),1.0));}void main(){
#ifdef NORMAL_DEPTH
vec4 normalDepth=texture2D(normalDepthBuffer,vUv);
#else
vec4 normalDepth=vec4(texture2D(normalBuffer,vUv).xyz,readDepth(vUv));
#endif
float ao=0.0;float depth=normalDepth.a;float viewZ=getViewZ(depth);
#ifdef PERSPECTIVE_CAMERA
float linearDepth=viewZToOrthographicDepth(viewZ,cameraNearFar.x,cameraNearFar.y);
#else
float linearDepth=depth;
#endif
if(linearDepth<distanceCutoff.y){vec3 viewPosition=getViewPosition(vUv,depth,viewZ);vec3 viewNormal=unpackRGBToNormal(normalDepth.rgb);ao+=getAmbientOcclusion(viewPosition,viewNormal,linearDepth,vUv);float d=smoothstep(distanceCutoff.x,distanceCutoff.y,linearDepth);ao=mix(ao,0.0,d);
#ifdef LEGACY_INTENSITY
ao=clamp(1.0-pow(1.0-ao,abs(intensity)),0.0,1.0);
#endif
}gl_FragColor.r=ao;}`,h8="uniform vec2 noiseScale;varying vec2 vUv;varying vec2 vUv2;void main(){vUv=position.xy*0.5+0.5;vUv2=vUv*noiseScale;gl_Position=vec4(position.xy,1.0,1.0);}",u8=class extends $e{constructor(n){super({name:"SSAOMaterial",defines:{SAMPLES_INT:"0",INV_SAMPLES_FLOAT:"0.0",SPIRAL_TURNS:"0.0",RADIUS:"1.0",RADIUS_SQ:"1.0",DISTANCE_SCALING:"1",DEPTH_PACKING:"0"},uniforms:{depthBuffer:new $(null),normalBuffer:new $(null),normalDepthBuffer:new $(null),noiseTexture:new $(null),inverseProjectionMatrix:new $(new ce),projectionMatrix:new $(new ce),texelSize:new $(new ae),cameraNearFar:new $(new ae),distanceCutoff:new $(new ae),proximityCutoff:new $(new ae),noiseScale:new $(new ae),minRadiusScale:new $(.33),intensity:new $(1),fade:new $(.01),bias:new $(0)},blending:Ms,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:c8,vertexShader:h8}),this.copyCameraSettings(n),this.resolution=new ae,this.r=1}get near(){return this.uniforms.cameraNearFar.value.x}get far(){return this.uniforms.cameraNearFar.value.y}set normalDepthBuffer(n){this.uniforms.normalDepthBuffer.value=n,n!==null?this.defines.NORMAL_DEPTH="1":delete this.defines.NORMAL_DEPTH,this.needsUpdate=!0}setNormalDepthBuffer(n){this.normalDepthBuffer=n}set normalBuffer(n){this.uniforms.normalBuffer.value=n}setNormalBuffer(n){this.uniforms.normalBuffer.value=n}set depthBuffer(n){this.uniforms.depthBuffer.value=n}set depthPacking(n){this.defines.DEPTH_PACKING=n.toFixed(0),this.needsUpdate=!0}setDepthBuffer(n,t=Rs){this.depthBuffer=n,this.depthPacking=t}set noiseTexture(n){this.uniforms.noiseTexture.value=n}setNoiseTexture(n){this.uniforms.noiseTexture.value=n}get samples(){return Number(this.defines.SAMPLES_INT)}set samples(n){this.defines.SAMPLES_INT=n.toFixed(0),this.defines.INV_SAMPLES_FLOAT=(1/n).toFixed(9),this.needsUpdate=!0}getSamples(){return this.samples}setSamples(n){this.samples=n}get rings(){return Number(this.defines.SPIRAL_TURNS)}set rings(n){this.defines.SPIRAL_TURNS=n.toFixed(1),this.needsUpdate=!0}getRings(){return this.rings}setRings(n){this.rings=n}get intensity(){return this.uniforms.intensity.value}set intensity(n){this.uniforms.intensity.value=n,this.defines.LEGACY_INTENSITY===void 0&&(this.defines.LEGACY_INTENSITY="1",this.needsUpdate=!0)}getIntensity(){return this.uniforms.intensity.value}setIntensity(n){this.uniforms.intensity.value=n}get fade(){return this.uniforms.fade.value}set fade(n){this.uniforms.fade.value=n}getFade(){return this.uniforms.fade.value}setFade(n){this.uniforms.fade.value=n}get bias(){return this.uniforms.bias.value}set bias(n){this.uniforms.bias.value=n}getBias(){return this.uniforms.bias.value}setBias(n){this.uniforms.bias.value=n}get minRadiusScale(){return this.uniforms.minRadiusScale.value}set minRadiusScale(n){this.uniforms.minRadiusScale.value=n}getMinRadiusScale(){return this.uniforms.minRadiusScale.value}setMinRadiusScale(n){this.uniforms.minRadiusScale.value=n}updateRadius(){const n=this.r*this.resolution.height;this.defines.RADIUS=n.toFixed(11),this.defines.RADIUS_SQ=(n*n).toFixed(11),this.needsUpdate=!0}get radius(){return this.r}set radius(n){this.r=Math.min(Math.max(n,1e-6),1),this.updateRadius()}getRadius(){return this.radius}setRadius(n){this.radius=n}get distanceScaling(){return!0}set distanceScaling(n){}isDistanceScalingEnabled(){return this.distanceScaling}setDistanceScalingEnabled(n){this.distanceScaling=n}get distanceThreshold(){return this.uniforms.distanceCutoff.value.x}set distanceThreshold(n){this.uniforms.distanceCutoff.value.set(Math.min(Math.max(n,0),1),Math.min(Math.max(n+this.distanceFalloff,0),1))}get worldDistanceThreshold(){return-Wu(this.distanceThreshold,this.near,this.far)}set worldDistanceThreshold(n){this.distanceThreshold=gh(-n,this.near,this.far)}get distanceFalloff(){return this.uniforms.distanceCutoff.value.y-this.distanceThreshold}set distanceFalloff(n){this.uniforms.distanceCutoff.value.y=Math.min(Math.max(this.distanceThreshold+n,0),1)}get worldDistanceFalloff(){return-Wu(this.distanceFalloff,this.near,this.far)}set worldDistanceFalloff(n){this.distanceFalloff=gh(-n,this.near,this.far)}setDistanceCutoff(n,t){this.uniforms.distanceCutoff.value.set(Math.min(Math.max(n,0),1),Math.min(Math.max(n+t,0),1))}get proximityThreshold(){return this.uniforms.proximityCutoff.value.x}set proximityThreshold(n){this.uniforms.proximityCutoff.value.set(Math.min(Math.max(n,0),1),Math.min(Math.max(n+this.proximityFalloff,0),1))}get worldProximityThreshold(){return-Wu(this.proximityThreshold,this.near,this.far)}set worldProximityThreshold(n){this.proximityThreshold=gh(-n,this.near,this.far)}get proximityFalloff(){return this.uniforms.proximityCutoff.value.y-this.proximityThreshold}set proximityFalloff(n){this.uniforms.proximityCutoff.value.y=Math.min(Math.max(this.proximityThreshold+n,0),1)}get worldProximityFalloff(){return-Wu(this.proximityFalloff,this.near,this.far)}set worldProximityFalloff(n){this.proximityFalloff=gh(-n,this.near,this.far)}setProximityCutoff(n,t){this.uniforms.proximityCutoff.value.set(Math.min(Math.max(n,0),1),Math.min(Math.max(n+t,0),1))}setTexelSize(n,t){this.uniforms.texelSize.value.set(n,t)}adoptCameraSettings(n){this.copyCameraSettings(n)}copyCameraSettings(n){n&&(this.uniforms.cameraNearFar.value.set(n.near,n.far),this.uniforms.projectionMatrix.value.copy(n.projectionMatrix),this.uniforms.inverseProjectionMatrix.value.copy(n.projectionMatrix).invert(),n instanceof xt?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}setSize(n,t){const e=this.uniforms,i=e.noiseTexture.value;i!==null&&e.noiseScale.value.set(n/i.image.width,t/i.image.height),e.texelSize.value.set(1/n,1/t),this.resolution.set(n,t),this.updateRadius()}},d8=`#include <packing>
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
#ifdef DOWNSAMPLE_NORMALS
uniform lowp sampler2D normalBuffer;
#endif
varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}int findBestDepth(const in float samples[4]){float c=(samples[0]+samples[1]+samples[2]+samples[3])*0.25;float distances[4];distances[0]=abs(c-samples[0]);distances[1]=abs(c-samples[1]);distances[2]=abs(c-samples[2]);distances[3]=abs(c-samples[3]);float maxDistance=max(max(distances[0],distances[1]),max(distances[2],distances[3]));int remaining[3];int rejected[3];int i,j,k;for(i=0,j=0,k=0;i<4;++i){if(distances[i]<maxDistance){remaining[j++]=i;}else{rejected[k++]=i;}}for(;j<3;++j){remaining[j]=rejected[--k];}vec3 s=vec3(samples[remaining[0]],samples[remaining[1]],samples[remaining[2]]);c=(s.x+s.y+s.z)/3.0;distances[0]=abs(c-s.x);distances[1]=abs(c-s.y);distances[2]=abs(c-s.z);float minDistance=min(distances[0],min(distances[1],distances[2]));for(i=0;i<3;++i){if(distances[i]==minDistance){break;}}return remaining[i];}void main(){float d[4];d[0]=readDepth(vUv0);d[1]=readDepth(vUv1);d[2]=readDepth(vUv2);d[3]=readDepth(vUv3);int index=findBestDepth(d);
#ifdef DOWNSAMPLE_NORMALS
vec3 n[4];n[0]=texture2D(normalBuffer,vUv0).rgb;n[1]=texture2D(normalBuffer,vUv1).rgb;n[2]=texture2D(normalBuffer,vUv2).rgb;n[3]=texture2D(normalBuffer,vUv3).rgb;
#else
vec3 n[4];n[0]=vec3(0.0);n[1]=vec3(0.0);n[2]=vec3(0.0);n[3]=vec3(0.0);
#endif
gl_FragColor=vec4(n[index],d[index]);}`,f8="uniform vec2 texelSize;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec2 uv=position.xy*0.5+0.5;vUv0=uv;vUv1=vec2(uv.x,uv.y+texelSize.y);vUv2=vec2(uv.x+texelSize.x,uv.y);vUv3=uv+texelSize;gl_Position=vec4(position.xy,1.0,1.0);}",p8=class extends $e{constructor(){super({name:"DepthDownsamplingMaterial",defines:{DEPTH_PACKING:"0"},uniforms:{depthBuffer:new $(null),normalBuffer:new $(null),texelSize:new $(new ae)},blending:Ms,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:d8,vertexShader:f8})}set depthBuffer(n){this.uniforms.depthBuffer.value=n}set depthPacking(n){this.defines.DEPTH_PACKING=n.toFixed(0),this.needsUpdate=!0}setDepthBuffer(n,t=Rs){this.depthBuffer=n,this.depthPacking=t}set normalBuffer(n){this.uniforms.normalBuffer.value=n,n!==null?this.defines.DOWNSAMPLE_NORMALS="1":delete this.defines.DOWNSAMPLE_NORMALS,this.needsUpdate=!0}setNormalBuffer(n){this.normalBuffer=n}setTexelSize(n,t){this.uniforms.texelSize.value.set(n,t)}setSize(n,t){this.uniforms.texelSize.value.set(1/n,1/t)}},rC=class extends Gn{constructor({normalBuffer:n=null,resolutionScale:t=.5,width:e=Rt.AUTO_SIZE,height:i=Rt.AUTO_SIZE,resolutionX:s=e,resolutionY:r=i}={}){super("DepthDownsamplingPass");const o=new p8;o.normalBuffer=n,this.fullscreenMaterial=o,this.needsDepthTexture=!0,this.needsSwap=!1,this.renderTarget=new Ct(1,1,{minFilter:Wt,magFilter:Wt,depthBuffer:!1,type:eo}),this.renderTarget.texture.name="DepthDownsamplingPass.Target",this.renderTarget.texture.generateMipmaps=!1;const a=this.resolution=new Rt(this,s,r,t);a.addEventListener("change",l=>this.setSize(a.baseWidth,a.baseHeight))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}setDepthTexture(n,t=Rs){this.fullscreenMaterial.depthBuffer=n,this.fullscreenMaterial.depthPacking=t}render(n,t,e,i,s){n.setRenderTarget(this.renderToScreen?null:this.renderTarget),n.render(this.scene,this.camera)}setSize(n,t){const e=this.resolution;e.setBaseSize(n,t),this.renderTarget.setSize(e.width,e.height),this.fullscreenMaterial.setSize(n,t)}initialize(n,t,e){const i=n.getContext();if(!(i.getExtension("EXT_color_buffer_float")||i.getExtension("EXT_color_buffer_half_float")))throw new Error("Rendering to float texture is not supported.")}},g8=`uniform lowp sampler2D aoBuffer;uniform float luminanceInfluence;uniform float intensity;
#if defined(DEPTH_AWARE_UPSAMPLING) && defined(NORMAL_DEPTH)
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D normalDepthBuffer;
#else
uniform mediump sampler2D normalDepthBuffer;
#endif
#endif
#ifdef COLORIZE
uniform vec3 color;
#endif
void mainImage(const in vec4 inputColor,const in vec2 uv,const in float depth,out vec4 outputColor){float aoLinear=texture2D(aoBuffer,uv).r;
#if defined(DEPTH_AWARE_UPSAMPLING) && defined(NORMAL_DEPTH) && __VERSION__ == 300
vec4 normalDepth[4];normalDepth[0]=textureOffset(normalDepthBuffer,uv,ivec2(0,0));normalDepth[1]=textureOffset(normalDepthBuffer,uv,ivec2(0,1));normalDepth[2]=textureOffset(normalDepthBuffer,uv,ivec2(1,0));normalDepth[3]=textureOffset(normalDepthBuffer,uv,ivec2(1,1));float dot01=dot(normalDepth[0].rgb,normalDepth[1].rgb);float dot02=dot(normalDepth[0].rgb,normalDepth[2].rgb);float dot03=dot(normalDepth[0].rgb,normalDepth[3].rgb);float minDot=min(dot01,min(dot02,dot03));float s=step(THRESHOLD,minDot);float smallestDistance=1.0;int index;for(int i=0;i<4;++i){float distance=abs(depth-normalDepth[i].a);if(distance<smallestDistance){smallestDistance=distance;index=i;}}ivec2 offsets[4];offsets[0]=ivec2(0,0);offsets[1]=ivec2(0,1);offsets[2]=ivec2(1,0);offsets[3]=ivec2(1,1);ivec2 coord=ivec2(uv*vec2(textureSize(aoBuffer,0)))+offsets[index];float aoNearest=texelFetch(aoBuffer,coord,0).r;float ao=mix(aoNearest,aoLinear,s);
#else
float ao=aoLinear;
#endif
float l=luminance(inputColor.rgb);ao=mix(ao,0.0,l*luminanceInfluence);ao=clamp(ao*intensity,0.0,1.0);
#ifdef COLORIZE
outputColor=vec4(1.0-ao*(1.0-color),inputColor.a);
#else
outputColor=vec4(vec3(1.0-ao),inputColor.a);
#endif
}`,_1=64,DM=class extends so{constructor(n,t,{blendFunction:e=Xe.MULTIPLY,samples:i=9,rings:s=7,normalDepthBuffer:r=null,depthAwareUpsampling:o=!0,worldDistanceThreshold:a,worldDistanceFalloff:l,worldProximityThreshold:h,worldProximityFalloff:u,distanceThreshold:d=.97,distanceFalloff:f=.03,rangeThreshold:p=5e-4,rangeFalloff:g=.001,minRadiusScale:m=.1,luminanceInfluence:v=.7,radius:y=.1825,intensity:b=1,bias:_=.025,fade:x=.01,color:S=null,resolutionScale:T=1,width:L=Rt.AUTO_SIZE,height:I=Rt.AUTO_SIZE,resolutionX:P=L,resolutionY:R=I}={}){super("SSAOEffect",g8,{blendFunction:e,attributes:Ar.DEPTH,defines:new Map([["THRESHOLD","0.997"]]),uniforms:new Map([["aoBuffer",new $(null)],["normalDepthBuffer",new $(r)],["luminanceInfluence",new $(v)],["color",new $(null)],["intensity",new $(b)],["scale",new $(0)]])}),this.renderTarget=new Ct(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="AO.Target",this.uniforms.get("aoBuffer").value=this.renderTarget.texture;const B=this.resolution=new Rt(this,P,R,T);B.addEventListener("change",V=>this.setSize(B.baseWidth,B.baseHeight)),this.camera=n,this.depthDownsamplingPass=new rC({normalBuffer:t,resolutionScale:T}),this.depthDownsamplingPass.enabled=r===null,this.ssaoPass=new da(new u8(n));const Q=new Xj(_1,_1,kn);Q.wrapS=Q.wrapT=Sl;const G=this.ssaoMaterial;G.normalBuffer=t,G.noiseTexture=Q,G.minRadiusScale=m,G.samples=i,G.radius=y,G.rings=s,G.fade=x,G.bias=_,G.distanceThreshold=d,G.distanceFalloff=f,G.proximityThreshold=p,G.proximityFalloff=g,a!==void 0&&(G.worldDistanceThreshold=a),l!==void 0&&(G.worldDistanceFalloff=l),h!==void 0&&(G.worldProximityThreshold=h),u!==void 0&&(G.worldProximityFalloff=u),r!==null&&(this.ssaoMaterial.normalDepthBuffer=r,this.defines.set("NORMAL_DEPTH","1")),this.depthAwareUpsampling=o,this.color=S}set mainCamera(n){this.camera=n,this.ssaoMaterial.copyCameraSettings(n)}get normalBuffer(){return this.ssaoMaterial.normalBuffer}set normalBuffer(n){this.ssaoMaterial.normalBuffer=n,this.depthDownsamplingPass.fullscreenMaterial.normalBuffer=n}getResolution(){return this.resolution}get ssaoMaterial(){return this.ssaoPass.fullscreenMaterial}getSSAOMaterial(){return this.ssaoMaterial}get samples(){return this.ssaoMaterial.samples}set samples(n){this.ssaoMaterial.samples=n}get rings(){return this.ssaoMaterial.rings}set rings(n){this.ssaoMaterial.rings=n}get radius(){return this.ssaoMaterial.radius}set radius(n){this.ssaoMaterial.radius=n}get depthAwareUpsampling(){return this.defines.has("DEPTH_AWARE_UPSAMPLING")}set depthAwareUpsampling(n){this.depthAwareUpsampling!==n&&(n?this.defines.set("DEPTH_AWARE_UPSAMPLING","1"):this.defines.delete("DEPTH_AWARE_UPSAMPLING"),this.setChanged())}isDepthAwareUpsamplingEnabled(){return this.depthAwareUpsampling}setDepthAwareUpsamplingEnabled(n){this.depthAwareUpsampling=n}get distanceScaling(){return!0}set distanceScaling(n){}get color(){return this.uniforms.get("color").value}set color(n){const t=this.uniforms,e=this.defines;n!==null?e.has("COLORIZE")?t.get("color").value.set(n):(e.set("COLORIZE","1"),t.get("color").value=new we(n),this.setChanged()):e.has("COLORIZE")&&(e.delete("COLORIZE"),t.get("color").value=null,this.setChanged())}get luminanceInfluence(){return this.uniforms.get("luminanceInfluence").value}set luminanceInfluence(n){this.uniforms.get("luminanceInfluence").value=n}get intensity(){return this.uniforms.get("intensity").value}set intensity(n){this.uniforms.get("intensity").value=n}getColor(){return this.color}setColor(n){this.color=n}setDistanceCutoff(n,t){this.ssaoMaterial.distanceThreshold=n,this.ssaoMaterial.distanceFalloff=t}setProximityCutoff(n,t){this.ssaoMaterial.proximityThreshold=n,this.ssaoMaterial.proximityFalloff=t}setDepthTexture(n,t=Rs){this.depthDownsamplingPass.setDepthTexture(n,t),this.ssaoMaterial.depthBuffer=n,this.ssaoMaterial.depthPacking=t}update(n,t,e){const i=this.renderTarget;this.depthDownsamplingPass.enabled&&this.depthDownsamplingPass.render(n),this.ssaoPass.render(n,null,i)}setSize(n,t){const e=this.resolution;e.setBaseSize(n,t);const i=e.width,s=e.height;this.ssaoMaterial.copyCameraSettings(this.camera),this.ssaoMaterial.setSize(i,s),this.renderTarget.setSize(i,s),this.depthDownsamplingPass.resolution.scale=e.scale,this.depthDownsamplingPass.setSize(n,t)}initialize(n,t,e){try{let i=this.uniforms.get("normalDepthBuffer").value;i===null&&(this.depthDownsamplingPass.initialize(n,t,e),i=this.depthDownsamplingPass.texture,this.uniforms.get("normalDepthBuffer").value=i,this.ssaoMaterial.normalDepthBuffer=i,this.defines.set("NORMAL_DEPTH","1"))}catch{this.depthDownsamplingPass.enabled=!1}}},m8=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
uniform vec4 maskParams;varying vec2 vUv;varying vec2 vUv2;varying vec2 vOffset;float linearGradientMask(const in float x){return smoothstep(maskParams.x,maskParams.y,x)-smoothstep(maskParams.w,maskParams.z,x);}void main(){vec2 dUv=vOffset*(1.0-linearGradientMask(vUv2.y));vec4 sum=texture2D(inputBuffer,vec2(vUv.x-dUv.x,vUv.y+dUv.y));sum+=texture2D(inputBuffer,vec2(vUv.x+dUv.x,vUv.y+dUv.y));sum+=texture2D(inputBuffer,vec2(vUv.x+dUv.x,vUv.y-dUv.y));sum+=texture2D(inputBuffer,vec2(vUv.x-dUv.x,vUv.y-dUv.y));gl_FragColor=sum*0.25;
#include <colorspace_fragment>
}`,A8="uniform vec4 texelSize;uniform float kernel;uniform float scale;uniform float aspect;uniform vec2 rotation;varying vec2 vUv;varying vec2 vUv2;varying vec2 vOffset;void main(){vec2 uv=position.xy*0.5+0.5;vUv=uv;vUv2=(uv-0.5)*2.0*vec2(aspect,1.0);vUv2=vec2(dot(rotation,vUv2),dot(rotation,vec2(vUv2.y,-vUv2.x)));vOffset=(texelSize.xy*vec2(kernel)+texelSize.zw)*scale;gl_Position=vec4(position.xy,1.0,1.0);}",v8=class extends wM{constructor({kernelSize:n=Il.MEDIUM,offset:t=0,rotation:e=0,focusArea:i=.4,feather:s=.3}={}){super(),this.fragmentShader=m8,this.vertexShader=A8,this.kernelSize=n,this.fragmentShader=Hd(this.fragmentShader),this.uniforms.aspect=new $(1),this.uniforms.rotation=new $(new ae),this.uniforms.maskParams=new $(new ke),this._offset=t,this._focusArea=i,this._feather=s,this.rotation=e,this.updateParams()}updateParams(){const n=this.uniforms.maskParams.value,t=Math.max(this.focusArea,0),e=Math.max(t-this.feather,0);n.set(this.offset-t,this.offset-e,this.offset+t,this.offset+e)}get rotation(){return Math.acos(this.uniforms.rotation.value.x)}set rotation(n){this.uniforms.rotation.value.set(Math.cos(n),Math.sin(n))}get offset(){return this._offset}set offset(n){this._offset=n,this.updateParams()}get focusArea(){return this._focusArea}set focusArea(n){this._focusArea=n,this.updateParams()}get feather(){return this._feather}set feather(n){this._feather=n,this.updateParams()}setSize(n,t){super.setSize(n,t),this.uniforms.aspect.value=n/t}},y8=class extends iC{constructor({offset:n=0,rotation:t=0,focusArea:e=.4,feather:i=.3,kernelSize:s=Il.MEDIUM,resolutionScale:r=.5,resolutionX:o=Rt.AUTO_SIZE,resolutionY:a=Rt.AUTO_SIZE}={}){super({kernelSize:s,resolutionScale:r,resolutionX:o,resolutionY:a}),this.blurMaterial=new v8({kernelSize:s,offset:n,rotation:t,focusArea:e,feather:i})}},b8=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D map;
#else
uniform lowp sampler2D map;
#endif
uniform vec2 maskParams;varying vec2 vUv2;float linearGradientMask(const in float x){return step(maskParams.x,x)-step(maskParams.y,x);}void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){float mask=linearGradientMask(vUv2.y);vec4 texel=texture2D(map,uv);outputColor=mix(texel,inputColor,mask);}`,_8="uniform vec2 rotation;varying vec2 vUv2;void mainSupport(const in vec2 uv){vUv2=(uv-0.5)*2.0*vec2(aspect,1.0);vUv2=vec2(dot(rotation,vUv2),dot(rotation,vec2(vUv2.y,-vUv2.x)));}",w8=class extends so{constructor({blendFunction:t,offset:e=0,rotation:i=0,focusArea:s=.4,feather:r=.3,kernelSize:o=Il.MEDIUM,resolutionScale:a=.5,resolutionX:l=Rt.AUTO_SIZE,resolutionY:h=Rt.AUTO_SIZE}={}){super("TiltShiftEffect",b8,{vertexShader:_8,blendFunction:t,uniforms:new Map([["rotation",new $(new ae)],["maskParams",new $(new ae)],["map",new $(null)]])}),this._offset=e,this._focusArea=s,this._feather=r,this.renderTarget=new Ct(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="TiltShift.Target",this.uniforms.get("map").value=this.renderTarget.texture,this.blurPass=new y8({kernelSize:o,resolutionScale:a,resolutionX:l,resolutionY:h,offset:e,rotation:i,focusArea:s,feather:r});const u=this.resolution=new Rt(this,l,h,a);u.addEventListener("change",d=>this.setSize(u.baseWidth,u.baseHeight)),this.rotation=i,this.updateParams()}updateParams(){const t=this.uniforms.get("maskParams").value,e=Math.max(this.focusArea-this.feather,0);t.set(this.offset-e,this.offset+e)}get rotation(){return Math.acos(this.uniforms.get("rotation").value.x)}set rotation(t){this.uniforms.get("rotation").value.set(Math.cos(t),Math.sin(t)),this.blurPass.blurMaterial.rotation=t}get offset(){return this._offset}set offset(t){this._offset=t,this.blurPass.blurMaterial.offset=t,this.updateParams()}get focusArea(){return this._focusArea}set focusArea(t){this._focusArea=t,this.blurPass.blurMaterial.focusArea=t,this.updateParams()}get feather(){return this._feather}set feather(t){this._feather=t,this.blurPass.blurMaterial.feather=t,this.updateParams()}get bias(){return 0}set bias(t){}update(t,e,i){this.blurPass.render(t,e,this.renderTarget)}setSize(t,e){const i=this.resolution;i.setBaseSize(t,e),this.renderTarget.setSize(i.width,i.height),this.blurPass.resolution.copy(i)}initialize(t,e,i){this.blurPass.initialize(t,e,i),i!==void 0&&(this.renderTarget.texture.type=i,t!==null&&t.outputColorSpace===Ue&&(this.renderTarget.texture.colorSpace=Ue))}},x8=`#include <packing>
#define packFloatToRGBA(v) packDepthToRGBA(v)
#define unpackRGBAToFloat(v) unpackRGBAToDepth(v)
uniform lowp sampler2D luminanceBuffer0;uniform lowp sampler2D luminanceBuffer1;uniform float minLuminance;uniform float deltaTime;uniform float tau;varying vec2 vUv;void main(){float l0=unpackRGBAToFloat(texture2D(luminanceBuffer0,vUv));
#if __VERSION__ < 300
float l1=texture2DLodEXT(luminanceBuffer1,vUv,MIP_LEVEL_1X1).r;
#else
float l1=textureLod(luminanceBuffer1,vUv,MIP_LEVEL_1X1).r;
#endif
l0=max(minLuminance,l0);l1=max(minLuminance,l1);float adaptedLum=l0+(l1-l0)*(1.0-exp(-deltaTime*tau));gl_FragColor=(adaptedLum==1.0)?vec4(1.0):packFloatToRGBA(adaptedLum);}`,C8=class extends $e{constructor(){super({name:"AdaptiveLuminanceMaterial",defines:{MIP_LEVEL_1X1:"0.0"},uniforms:{luminanceBuffer0:new $(null),luminanceBuffer1:new $(null),minLuminance:new $(.01),deltaTime:new $(0),tau:new $(1)},extensions:{shaderTextureLOD:!0},blending:Ms,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:x8,vertexShader:Kh})}set luminanceBuffer0(n){this.uniforms.luminanceBuffer0.value=n}setLuminanceBuffer0(n){this.uniforms.luminanceBuffer0.value=n}set luminanceBuffer1(n){this.uniforms.luminanceBuffer1.value=n}setLuminanceBuffer1(n){this.uniforms.luminanceBuffer1.value=n}set mipLevel1x1(n){this.defines.MIP_LEVEL_1X1=n.toFixed(1),this.needsUpdate=!0}setMipLevel1x1(n){this.mipLevel1x1=n}set deltaTime(n){this.uniforms.deltaTime.value=n}setDeltaTime(n){this.uniforms.deltaTime.value=n}get minLuminance(){return this.uniforms.minLuminance.value}set minLuminance(n){this.uniforms.minLuminance.value=n}getMinLuminance(){return this.uniforms.minLuminance.value}setMinLuminance(n){this.uniforms.minLuminance.value=n}get adaptationRate(){return this.uniforms.tau.value}set adaptationRate(n){this.uniforms.tau.value=n}getAdaptationRate(){return this.uniforms.tau.value}setAdaptationRate(n){this.uniforms.tau.value=n}},S8=class extends Gn{constructor(n,{minLuminance:t=.01,adaptationRate:e=1}={}){super("AdaptiveLuminancePass"),this.fullscreenMaterial=new C8,this.needsSwap=!1,this.renderTargetPrevious=new Ct(1,1,{minFilter:Wt,magFilter:Wt,depthBuffer:!1}),this.renderTargetPrevious.texture.name="Luminance.Previous";const i=this.fullscreenMaterial;i.luminanceBuffer0=this.renderTargetPrevious.texture,i.luminanceBuffer1=n,i.minLuminance=t,i.adaptationRate=e,this.renderTargetAdapted=this.renderTargetPrevious.clone(),this.renderTargetAdapted.texture.name="Luminance.Adapted",this.copyPass=new _M(this.renderTargetPrevious,!1)}get texture(){return this.renderTargetAdapted.texture}getTexture(){return this.renderTargetAdapted.texture}set mipLevel1x1(n){this.fullscreenMaterial.mipLevel1x1=n}get adaptationRate(){return this.fullscreenMaterial.adaptationRate}set adaptationRate(n){this.fullscreenMaterial.adaptationRate=n}render(n,t,e,i,s){this.fullscreenMaterial.deltaTime=i,n.setRenderTarget(this.renderToScreen?null:this.renderTargetAdapted),n.render(this.scene,this.camera),this.copyPass.render(n,this.renderTargetAdapted)}},E8=`#include <tonemapping_pars_fragment>
uniform float whitePoint;
#if TONE_MAPPING_MODE == 2 || TONE_MAPPING_MODE == 3
uniform float middleGrey;
#if TONE_MAPPING_MODE == 3
uniform lowp sampler2D luminanceBuffer;
#else
uniform float averageLuminance;
#endif
vec3 Reinhard2ToneMapping(vec3 color){color*=toneMappingExposure;float l=luminance(color);
#if TONE_MAPPING_MODE == 3
float lumAvg=unpackRGBAToFloat(texture2D(luminanceBuffer,vec2(0.5)));
#else
float lumAvg=averageLuminance;
#endif
float lumScaled=(l*middleGrey)/max(lumAvg,1e-6);float lumCompressed=lumScaled*(1.0+lumScaled/(whitePoint*whitePoint));lumCompressed/=(1.0+lumScaled);return clamp(lumCompressed*color,0.0,1.0);}
#elif TONE_MAPPING_MODE == 4
#define A 0.15
#define B 0.50
#define C 0.10
#define D 0.20
#define E 0.02
#define F 0.30
vec3 Uncharted2Helper(const in vec3 x){return((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}vec3 Uncharted2ToneMapping(vec3 color){color*=toneMappingExposure;return clamp(Uncharted2Helper(color)/Uncharted2Helper(vec3(whitePoint)),0.0,1.0);}
#endif
void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){
#if TONE_MAPPING_MODE == 2 || TONE_MAPPING_MODE == 3
outputColor=vec4(Reinhard2ToneMapping(inputColor.rgb),inputColor.a);
#elif TONE_MAPPING_MODE == 4
outputColor=vec4(Uncharted2ToneMapping(inputColor.rgb),inputColor.a);
#else
outputColor=vec4(toneMapping(inputColor.rgb),inputColor.a);
#endif
}`,kM=class extends so{constructor({blendFunction:n=Xe.SRC,adaptive:t=!1,mode:e=t?Rn.REINHARD2_ADAPTIVE:Rn.AGX,resolution:i=256,maxLuminance:s=4,whitePoint:r=s,middleGrey:o=.6,minLuminance:a=.01,averageLuminance:l=1,adaptationRate:h=1}={}){super("ToneMappingEffect",E8,{blendFunction:n,uniforms:new Map([["luminanceBuffer",new $(null)],["maxLuminance",new $(s)],["whitePoint",new $(r)],["middleGrey",new $(o)],["averageLuminance",new $(l)]])}),this.renderTargetLuminance=new Ct(1,1,{minFilter:Bg,depthBuffer:!1}),this.renderTargetLuminance.texture.generateMipmaps=!0,this.renderTargetLuminance.texture.name="Luminance",this.luminancePass=new xM({renderTarget:this.renderTargetLuminance}),this.adaptiveLuminancePass=new S8(this.luminancePass.texture,{minLuminance:a,adaptationRate:h}),this.uniforms.get("luminanceBuffer").value=this.adaptiveLuminancePass.texture,this.resolution=i,this.mode=e}get mode(){return Number(this.defines.get("TONE_MAPPING_MODE"))}set mode(n){if(this.mode!==n){switch(this.defines.clear(),this.defines.set("TONE_MAPPING_MODE",n.toFixed(0)),n){case Rn.LINEAR:this.defines.set("toneMapping(texel)","LinearToneMapping(texel)");break;case Rn.REINHARD:this.defines.set("toneMapping(texel)","ReinhardToneMapping(texel)");break;case Rn.OPTIMIZED_CINEON:this.defines.set("toneMapping(texel)","OptimizedCineonToneMapping(texel)");break;case Rn.ACES_FILMIC:this.defines.set("toneMapping(texel)","ACESFilmicToneMapping(texel)");break;case Rn.AGX:this.defines.set("toneMapping(texel)","AgXToneMapping(texel)");break;case Rn.NEUTRAL:this.defines.set("toneMapping(texel)","NeutralToneMapping(texel)");break;default:this.defines.set("toneMapping(texel)","texel");break}this.adaptiveLuminancePass.enabled=n===Rn.REINHARD2_ADAPTIVE,this.setChanged()}}getMode(){return this.mode}setMode(n){this.mode=n}get whitePoint(){return this.uniforms.get("whitePoint").value}set whitePoint(n){this.uniforms.get("whitePoint").value=n}get middleGrey(){return this.uniforms.get("middleGrey").value}set middleGrey(n){this.uniforms.get("middleGrey").value=n}get averageLuminance(){return this.uniforms.get("averageLuminance").value}set averageLuminance(n){this.uniforms.get("averageLuminance").value=n}get adaptiveLuminanceMaterial(){return this.adaptiveLuminancePass.fullscreenMaterial}getAdaptiveLuminanceMaterial(){return this.adaptiveLuminanceMaterial}get resolution(){return this.luminancePass.resolution.width}set resolution(n){const t=Math.max(0,Math.ceil(Math.log2(n))),e=Math.pow(2,t);this.luminancePass.resolution.setPreferredSize(e,e),this.adaptiveLuminanceMaterial.mipLevel1x1=t}getResolution(){return this.resolution}setResolution(n){this.resolution=n}get adaptive(){return this.mode===Rn.REINHARD2_ADAPTIVE}set adaptive(n){this.mode=n?Rn.REINHARD2_ADAPTIVE:Rn.REINHARD2}get adaptationRate(){return this.adaptiveLuminanceMaterial.adaptationRate}set adaptationRate(n){this.adaptiveLuminanceMaterial.adaptationRate=n}get distinction(){return console.warn(this.name,"distinction was removed."),1}set distinction(n){console.warn(this.name,"distinction was removed.")}update(n,t,e){this.adaptiveLuminancePass.enabled&&(this.luminancePass.render(n,t),this.adaptiveLuminancePass.render(n,null,null,e))}initialize(n,t,e){this.adaptiveLuminancePass.initialize(n,t,e)}},I8=`uniform float offset;uniform float darkness;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){const vec2 center=vec2(0.5);vec3 color=inputColor.rgb;
#if VIGNETTE_TECHNIQUE == 0
float d=distance(uv,center);color*=smoothstep(0.8,offset*0.799,d*(darkness+offset));
#else
vec2 coord=(uv-center)*vec2(offset);color=mix(color,vec3(1.0-darkness),dot(coord,coord));
#endif
outputColor=vec4(color,inputColor.a);}`,OM=class extends so{constructor({blendFunction:n,eskil:t=!1,technique:e=t?Mf.ESKIL:Mf.DEFAULT,offset:i=.5,darkness:s=.5}={}){super("VignetteEffect",I8,{blendFunction:n,defines:new Map([["VIGNETTE_TECHNIQUE",e.toFixed(0)]]),uniforms:new Map([["offset",new $(i)],["darkness",new $(s)]])})}get technique(){return Number(this.defines.get("VIGNETTE_TECHNIQUE"))}set technique(n){this.technique!==n&&(this.defines.set("VIGNETTE_TECHNIQUE",n.toFixed(0)),this.setChanged())}get eskil(){return this.technique===Mf.ESKIL}set eskil(n){this.technique=n?Mf.ESKIL:Mf.DEFAULT}getTechnique(){return this.technique}setTechnique(n){this.technique=n}get offset(){return this.uniforms.get("offset").value}set offset(n){this.uniforms.get("offset").value=n}getOffset(){return this.offset}setOffset(n){this.offset=n}get darkness(){return this.uniforms.get("darkness").value}set darkness(n){this.uniforms.get("darkness").value=n}getDarkness(){return this.darkness}setDarkness(n){this.darkness=n}},T8=`#include <common>
#include <packing>
#include <dithering_pars_fragment>
#define packFloatToRGBA(v) packDepthToRGBA(v)
#define unpackRGBAToFloat(v) unpackRGBAToDepth(v)
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#if DEPTH_PACKING == 3201
uniform lowp sampler2D depthBuffer;
#elif defined(GL_FRAGMENT_PRECISION_HIGH)
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;
#if THREE_REVISION < 143
#define luminance(v) linearToRelativeLuminance(v)
#endif
#if THREE_REVISION >= 137
vec4 sRGBToLinear(const in vec4 value){return vec4(mix(pow(value.rgb*0.9478672986+vec3(0.0521327014),vec3(2.4)),value.rgb*0.0773993808,vec3(lessThanEqual(value.rgb,vec3(0.04045)))),value.a);}
#endif
float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}float getViewZ(const in float depth){
#ifdef PERSPECTIVE_CAMERA
return perspectiveDepthToViewZ(depth,cameraNear,cameraFar);
#else
return orthographicDepthToViewZ(depth,cameraNear,cameraFar);
#endif
}vec3 RGBToHCV(const in vec3 RGB){vec4 P=mix(vec4(RGB.bg,-1.0,2.0/3.0),vec4(RGB.gb,0.0,-1.0/3.0),step(RGB.b,RGB.g));vec4 Q=mix(vec4(P.xyw,RGB.r),vec4(RGB.r,P.yzx),step(P.x,RGB.r));float C=Q.x-min(Q.w,Q.y);float H=abs((Q.w-Q.y)/(6.0*C+EPSILON)+Q.z);return vec3(H,C,Q.x);}vec3 RGBToHSL(const in vec3 RGB){vec3 HCV=RGBToHCV(RGB);float L=HCV.z-HCV.y*0.5;float S=HCV.y/(1.0-abs(L*2.0-1.0)+EPSILON);return vec3(HCV.x,S,L);}vec3 HueToRGB(const in float H){float R=abs(H*6.0-3.0)-1.0;float G=2.0-abs(H*6.0-2.0);float B=2.0-abs(H*6.0-4.0);return clamp(vec3(R,G,B),0.0,1.0);}vec3 HSLToRGB(const in vec3 HSL){vec3 RGB=HueToRGB(HSL.x);float C=(1.0-abs(2.0*HSL.z-1.0))*HSL.y;return(RGB-0.5)*C+HSL.z;}FRAGMENT_HEAD void main(){FRAGMENT_MAIN_UV vec4 color0=texture2D(inputBuffer,UV);vec4 color1=vec4(0.0);FRAGMENT_MAIN_IMAGE color0.a=clamp(color0.a,0.0,1.0);gl_FragColor=color0;
#ifdef ENCODE_OUTPUT
#include <colorspace_fragment>
#endif
#include <dithering_fragment>
}`,R8="uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;VERTEX_HEAD void main(){vUv=position.xy*0.5+0.5;VERTEX_MAIN_SUPPORT gl_Position=vec4(position.xy,1.0,1.0);}",B8=class extends $e{constructor(n,t,e,i,s=!1){super({name:"EffectMaterial",defines:{THREE_REVISION:ay.replace(/\D+/g,""),DEPTH_PACKING:"0",ENCODE_OUTPUT:"1"},uniforms:{inputBuffer:new $(null),depthBuffer:new $(null),resolution:new $(new ae),texelSize:new $(new ae),cameraNear:new $(.3),cameraFar:new $(1e3),aspect:new $(1),time:new $(0)},blending:Ms,toneMapped:!1,depthWrite:!1,depthTest:!1,dithering:s}),n&&this.setShaderParts(n),t&&this.setDefines(t),e&&this.setUniforms(e),this.copyCameraSettings(i)}set inputBuffer(n){this.uniforms.inputBuffer.value=n}setInputBuffer(n){this.uniforms.inputBuffer.value=n}get depthBuffer(){return this.uniforms.depthBuffer.value}set depthBuffer(n){this.uniforms.depthBuffer.value=n}get depthPacking(){return Number(this.defines.DEPTH_PACKING)}set depthPacking(n){this.defines.DEPTH_PACKING=n.toFixed(0),this.needsUpdate=!0}setDepthBuffer(n,t=Rs){this.depthBuffer=n,this.depthPacking=t}setShaderData(n){this.setShaderParts(n.shaderParts),this.setDefines(n.defines),this.setUniforms(n.uniforms),this.setExtensions(n.extensions)}setShaderParts(n){return this.fragmentShader=T8.replace(bt.FRAGMENT_HEAD,n.get(bt.FRAGMENT_HEAD)||"").replace(bt.FRAGMENT_MAIN_UV,n.get(bt.FRAGMENT_MAIN_UV)||"").replace(bt.FRAGMENT_MAIN_IMAGE,n.get(bt.FRAGMENT_MAIN_IMAGE)||""),this.vertexShader=R8.replace(bt.VERTEX_HEAD,n.get(bt.VERTEX_HEAD)||"").replace(bt.VERTEX_MAIN_SUPPORT,n.get(bt.VERTEX_MAIN_SUPPORT)||""),this.fragmentShader=Hd(this.fragmentShader),this.needsUpdate=!0,this}setDefines(n){for(const t of n.entries())this.defines[t[0]]=t[1];return this.needsUpdate=!0,this}setUniforms(n){for(const t of n.entries())this.uniforms[t[0]]=t[1];return this}setExtensions(n){this.extensions={};for(const t of n)this.extensions[t]=!0;return this}get encodeOutput(){return this.defines.ENCODE_OUTPUT!==void 0}set encodeOutput(n){this.encodeOutput!==n&&(n?this.defines.ENCODE_OUTPUT="1":delete this.defines.ENCODE_OUTPUT,this.needsUpdate=!0)}isOutputEncodingEnabled(n){return this.encodeOutput}setOutputEncodingEnabled(n){this.encodeOutput=n}get time(){return this.uniforms.time.value}set time(n){this.uniforms.time.value=n}setDeltaTime(n){this.uniforms.time.value+=n}adoptCameraSettings(n){this.copyCameraSettings(n)}copyCameraSettings(n){n&&(this.uniforms.cameraNear.value=n.near,this.uniforms.cameraFar.value=n.far,n instanceof xt?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}setSize(n,t){const e=this.uniforms;e.resolution.value.set(n,t),e.texelSize.value.set(1/n,1/t),e.aspect.value=n/t}static get Section(){return bt}};function w1(n,t,e){for(const i of t){const s="$1"+n+i.charAt(0).toUpperCase()+i.slice(1),r=new RegExp("([^\\.])(\\b"+i+"\\b)","g");for(const o of e.entries())o[1]!==null&&e.set(o[0],o[1].replace(r,s))}}function P8(n,t,e){let i=t.getFragmentShader(),s=t.getVertexShader();const r=i!==void 0&&/mainImage/.test(i),o=i!==void 0&&/mainUv/.test(i);if(e.attributes|=t.getAttributes(),i===void 0)throw new Error(`Missing fragment shader (${t.name})`);if(o&&e.attributes&Ar.CONVOLUTION)throw new Error(`Effects that transform UVs are incompatible with convolution effects (${t.name})`);if(!r&&!o)throw new Error(`Could not find mainImage or mainUv function (${t.name})`);{const a=/\w+\s+(\w+)\([\w\s,]*\)\s*{/g,l=e.shaderParts;let h=l.get(bt.FRAGMENT_HEAD)||"",u=l.get(bt.FRAGMENT_MAIN_UV)||"",d=l.get(bt.FRAGMENT_MAIN_IMAGE)||"",f=l.get(bt.VERTEX_HEAD)||"",p=l.get(bt.VERTEX_MAIN_SUPPORT)||"";const g=new Set,m=new Set;if(o&&(u+=`	${n}MainUv(UV);
`,e.uvTransformation=!0),s!==null&&/mainSupport/.test(s)){const b=/mainSupport *\([\w\s]*?uv\s*?\)/.test(s);p+=`	${n}MainSupport(`,p+=b?`vUv);
`:`);
`;for(const _ of s.matchAll(/(?:varying\s+\w+\s+([\S\s]*?);)/g))for(const x of _[1].split(/\s*,\s*/))e.varyings.add(x),g.add(x),m.add(x);for(const _ of s.matchAll(a))m.add(_[1])}for(const b of i.matchAll(a))m.add(b[1]);for(const b of t.defines.keys())m.add(b.replace(/\([\w\s,]*\)/g,""));for(const b of t.uniforms.keys())m.add(b);m.delete("while"),m.delete("for"),m.delete("if"),t.uniforms.forEach((b,_)=>e.uniforms.set(n+_.charAt(0).toUpperCase()+_.slice(1),b)),t.defines.forEach((b,_)=>e.defines.set(n+_.charAt(0).toUpperCase()+_.slice(1),b));const v=new Map([["fragment",i],["vertex",s]]);w1(n,m,e.defines),w1(n,m,v),i=v.get("fragment"),s=v.get("vertex");const y=t.blendMode;if(e.blendModes.set(y.blendFunction,y),r){t.inputColorSpace!==null&&t.inputColorSpace!==e.colorSpace&&(d+=t.inputColorSpace===Ue?`color0 = LinearTosRGB(color0);
	`:`color0 = sRGBToLinear(color0);
	`),t.outputColorSpace!==Fh?e.colorSpace=t.outputColorSpace:t.inputColorSpace!==null&&(e.colorSpace=t.inputColorSpace);const b=/MainImage *\([\w\s,]*?depth[\w\s,]*?\)/;d+=`${n}MainImage(color0, UV, `,e.attributes&Ar.DEPTH&&b.test(i)&&(d+="depth, ",e.readDepth=!0),d+=`color1);
	`;const _=n+"BlendOpacity";e.uniforms.set(_,y.opacity),d+=`color0 = blend${y.blendFunction}(color0, color1, ${_});

	`,h+=`uniform float ${_};

`}if(h+=i+`
`,s!==null&&(f+=s+`
`),l.set(bt.FRAGMENT_HEAD,h),l.set(bt.FRAGMENT_MAIN_UV,u),l.set(bt.FRAGMENT_MAIN_IMAGE,d),l.set(bt.VERTEX_HEAD,f),l.set(bt.VERTEX_MAIN_SUPPORT,p),t.extensions!==null)for(const b of t.extensions)e.extensions.add(b)}}var x1=class extends Gn{constructor(n,...t){super("EffectPass"),this.fullscreenMaterial=new B8(null,null,null,n),this.listener=e=>this.handleEvent(e),this.effects=[],this.setEffects(t),this.skipRendering=!1,this.minTime=1,this.maxTime=Number.POSITIVE_INFINITY,this.timeScale=1}set mainScene(n){for(const t of this.effects)t.mainScene=n}set mainCamera(n){this.fullscreenMaterial.copyCameraSettings(n);for(const t of this.effects)t.mainCamera=n}get encodeOutput(){return this.fullscreenMaterial.encodeOutput}set encodeOutput(n){this.fullscreenMaterial.encodeOutput=n}get dithering(){return this.fullscreenMaterial.dithering}set dithering(n){const t=this.fullscreenMaterial;t.dithering=n,t.needsUpdate=!0}setEffects(n){for(const t of this.effects)t.removeEventListener("change",this.listener);this.effects=n.sort((t,e)=>e.attributes-t.attributes);for(const t of this.effects)t.addEventListener("change",this.listener)}updateMaterial(){const n=new Gz;let t=0;for(const o of this.effects)if(o.blendMode.blendFunction===Xe.DST)n.attributes|=o.getAttributes()&Ar.DEPTH;else{if(n.attributes&o.getAttributes()&Ar.CONVOLUTION)throw new Error(`Convolution effects cannot be merged (${o.name})`);P8("e"+t++,o,n)}let e=n.shaderParts.get(bt.FRAGMENT_HEAD),i=n.shaderParts.get(bt.FRAGMENT_MAIN_IMAGE),s=n.shaderParts.get(bt.FRAGMENT_MAIN_UV);const r=/\bblend\b/g;for(const o of n.blendModes.values())e+=o.getShaderCode().replace(r,`blend${o.blendFunction}`)+`
`;n.attributes&Ar.DEPTH?(n.readDepth&&(i=`float depth = readDepth(UV);

	`+i),this.needsDepthTexture=this.getDepthTexture()===null):this.needsDepthTexture=!1,n.colorSpace===Ue&&(i+=`color0 = sRGBToLinear(color0);
	`),n.uvTransformation?(s=`vec2 transformedUv = vUv;
`+s,n.defines.set("UV","transformedUv")):n.defines.set("UV","vUv"),n.shaderParts.set(bt.FRAGMENT_HEAD,e),n.shaderParts.set(bt.FRAGMENT_MAIN_IMAGE,i),n.shaderParts.set(bt.FRAGMENT_MAIN_UV,s);for(const[o,a]of n.shaderParts)a!==null&&n.shaderParts.set(o,a.trim().replace(/^#/,`
#`));this.skipRendering=t===0,this.needsSwap=!this.skipRendering,this.fullscreenMaterial.setShaderData(n)}recompile(){this.updateMaterial()}getDepthTexture(){return this.fullscreenMaterial.depthBuffer}setDepthTexture(n,t=Rs){this.fullscreenMaterial.depthBuffer=n,this.fullscreenMaterial.depthPacking=t;for(const e of this.effects)e.setDepthTexture(n,t)}render(n,t,e,i,s){for(const r of this.effects)r.update(n,t,i);if(!this.skipRendering||this.renderToScreen){const r=this.fullscreenMaterial;r.inputBuffer=t.texture,r.time+=i*this.timeScale,n.setRenderTarget(this.renderToScreen?null:e),n.render(this.scene,this.camera)}}setSize(n,t){this.fullscreenMaterial.setSize(n,t);for(const e of this.effects)e.setSize(n,t)}initialize(n,t,e){this.renderer=n;for(const i of this.effects)i.initialize(n,t,e);this.updateMaterial(),e!==void 0&&e!==oi&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}dispose(){super.dispose();for(const n of this.effects)n.removeEventListener("change",this.listener),n.dispose()}handleEvent(n){switch(n.type){case"change":this.recompile();break}}},LM=class extends Gn{constructor(n,t,{renderTarget:e,resolutionScale:i=1,width:s=Rt.AUTO_SIZE,height:r=Rt.AUTO_SIZE,resolutionX:o=s,resolutionY:a=r}={}){super("NormalPass"),this.needsSwap=!1,this.renderPass=new Ty(n,t,new NR);const l=this.renderPass;l.ignoreBackground=!0,l.skipShadowMapUpdate=!0;const h=l.getClearPass();h.overrideClearColor=new we(7829503),h.overrideClearAlpha=1,this.renderTarget=e,this.renderTarget===void 0&&(this.renderTarget=new Ct(1,1,{minFilter:Wt,magFilter:Wt}),this.renderTarget.texture.name="NormalPass.Target");const u=this.resolution=new Rt(this,o,a,i);u.addEventListener("change",d=>this.setSize(u.baseWidth,u.baseHeight))}set mainScene(n){this.renderPass.mainScene=n}set mainCamera(n){this.renderPass.mainCamera=n}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}getResolutionScale(){return this.resolution.scale}setResolutionScale(n){this.resolution.scale=n}render(n,t,e,i,s){const r=this.renderToScreen?null:this.renderTarget;this.renderPass.render(n,r,r)}setSize(n,t){const e=this.resolution;e.setBaseSize(n,t),this.renderTarget.setSize(e.width,e.height)}},bp=function(){var n=0,t=document.createElement("div");t.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",t.addEventListener("click",function(u){u.preventDefault(),i(++n%t.children.length)},!1);function e(u){return t.appendChild(u.dom),u}function i(u){for(var d=0;d<t.children.length;d++)t.children[d].style.display=d===u?"block":"none";n=u}var s=(performance||Date).now(),r=s,o=0,a=e(new bp.Panel("FPS","#0ff","#002")),l=e(new bp.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var h=e(new bp.Panel("MB","#f08","#201"));return i(0),{REVISION:16,dom:t,addPanel:e,showPanel:i,begin:function(){s=(performance||Date).now()},end:function(){o++;var u=(performance||Date).now();if(l.update(u-s,200),u>=r+1e3&&(a.update(o*1e3/(u-r),100),r=u,o=0,h)){var d=performance.memory;h.update(d.usedJSHeapSize/1048576,d.jsHeapSizeLimit/1048576)}return u},update:function(){s=this.end()},domElement:t,setMode:i}};bp.Panel=function(n,t,e){var i=1/0,s=0,r=Math.round,o=r(window.devicePixelRatio||1),a=80*o,l=48*o,h=3*o,u=2*o,d=3*o,f=15*o,p=74*o,g=30*o,m=document.createElement("canvas");m.width=a,m.height=l,m.style.cssText="width:80px;height:48px";var v=m.getContext("2d");return v.font="bold "+9*o+"px Helvetica,Arial,sans-serif",v.textBaseline="top",v.fillStyle=e,v.fillRect(0,0,a,l),v.fillStyle=t,v.fillText(n,h,u),v.fillRect(d,f,p,g),v.fillStyle=e,v.globalAlpha=.9,v.fillRect(d,f,p,g),{dom:m,update:function(y,b){i=Math.min(i,y),s=Math.max(s,y),v.fillStyle=e,v.globalAlpha=1,v.fillRect(0,0,a,f),v.fillStyle=t,v.fillText(r(y)+" "+n+" ("+r(i)+"-"+r(s)+")",h,u),v.drawImage(m,d+o,f,p-o,g,d,f,p-o,g),v.fillRect(d+p-o,f,o,g),v.fillStyle=e,v.globalAlpha=.9,v.fillRect(d+p-o,f,o,r((1-y/b)*g))}}};const Og=N("gizmos"),Fn=N("debugextension"),fv=N("debugresolvedependencies"),M8=["/extensions/","extensions/"],D8=[{prefix:"/nodes/",dependencyName:"node"},{prefix:"/meshes/",dependencyName:"mesh"},{prefix:"/materials/",dependencyName:"material"},{prefix:"/textures/",dependencyName:"texture"},{prefix:"/animations/",dependencyName:"animation"},{prefix:"nodes/",dependencyName:"node"},{prefix:"meshes/",dependencyName:"mesh"},{prefix:"materials/",dependencyName:"material"},{prefix:"textures/",dependencyName:"texture"},{prefix:"animations/",dependencyName:"animation"}];async function oC(n,t){fv&&console.log(n,t);const e=[];sw(D8,n,t,e);const i=await Promise.all(e);return typeof t=="string"&&i.length===1?i[0]:i}function sw(n,t,e,i){if(typeof e=="object"&&e!==void 0&&e!==null)for(const s of Object.keys(e)){const r=e[s];if(typeof r=="string"){const o=C1(t,r);if(o!=null)typeof o.then=="function"?i.push(o.then(a=>e[s]=a)):e[s]=o;else for(const a of n){const l=rw(a.prefix,r);if(l>=0){fv&&console.log(a,l,a.dependencyName),i.push(t==null?void 0:t.getDependency(a.dependencyName,l).then(h=>(e[s]=h,h)));break}}}else if(Array.isArray(r))for(let o=0;o<r.length;o++){const a=r[o],l=C1(t,a);if(l!==null){typeof l.then=="function"?i.push(l.then(h=>r[o]=h)):r[o]=l;continue}for(const h of n){const u=rw(h.prefix,a);if(u>=0){fv&&console.log(h,u,h.dependencyName),i.push(t==null?void 0:t.getDependency(h.dependencyName,u).then(d=>r[o]=d));break}}typeof a=="object"&&sw(n,t,a,i)}else typeof r=="object"&&sw(n,t,r,i)}else typeof e=="string"&&k8(n,t,e,i)}function C1(n,t){if(n&&n.plugins&&typeof t=="string"){for(const e of M8)if(t.startsWith(e)){let i=t.substring(e.length);const s=i.indexOf("/");s>=0&&(i=i.substring(0,s));const r=n.plugins[i];if(Fn&&console.log(i,r),typeof(r==null?void 0:r.resolve)=="function"){const o=t.substring(e.length+i.length+1);return r.resolve(n,o)}break}}return null}function k8(n,t,e,i){for(const s of n){const r=rw(s.prefix,e);if(r>=0)return fv&&console.log(s,r,s.dependencyName),i.push(t==null?void 0:t.getDependency(s.dependencyName,r).then(o=>o)),!0}return!1}function rw(n,t){if(typeof t=="string"&&t.startsWith(n)){const e=t.substring(n.length),i=Number.parseInt(e);if(i>=0)return i}return-1}const Sb="NEEDLE_persistent_assets";function O8(n){return(n==null?void 0:n.___persistentAsset)===!0}class L8{constructor(t){c(this,"parser");this.parser=t}get name(){return Sb}async afterRoot(t){var s,r;if(!((r=(s=this.parser)==null?void 0:s.json)!=null&&r.extensions))return;const e=this.parser.json.extensions[Sb];if(!e)return;Fn&&console.log(e);const i=new Array;for(const o of e==null?void 0:e.assets){const a=oC(this.parser,o);a&&i.push(a)}await Promise.all(i)}resolve(t,e){const i=Number.parseInt(e);if(i>=0){Fn&&console.log(e);const s=t.json.extensions[Sb];if(s){const r=s==null?void 0:s.assets[i];if(r&&typeof r=="object"){r.___persistentAsset=!0;const o=r.__type;o&&D.get(o)}return r}}return null}}const hl=N("debugserializer");class F8{constructor(){c(this,"typeMap",new Map)}register(t,e){if(this.typeMap.has(t)){const i=this.typeMap.get(t);if(i===e)return;console.warn("Type "+t+" is already registered",e,i)}hl&&console.log("Register type serializer",e.name,e,t),this.typeMap.set(t,e)}getSerializer(t){if(t)return this.typeMap.get(t)}getSerializerForConstructor(t,e=0){if(e>20)return;if(!t||!t.constructor){hl&&console.log("invalid type");return}const i=t.name,s=this.getSerializer(t);if(s!==void 0)return hl&&console.log("FOUND SERIALIZER",s==null?void 0:s.name,t.name,t.constructor.name,"for type: "+i,s,t,this.typeMap),s;const r=Object.getPrototypeOf(t);if(r&&r!==t){const o=this.getSerializerForConstructor(r,++e);if(o){const a=r.constructor||r.prototype;hl&&console.log("FOUND SERIALIZER(in constructor) "+a.constructor.name,a.name,a,o),this.register(a,o)}return o}hl&&console.warn("No serializer found for "+i,t,t.name,t.constructor.name)}}const pv=new F8;class Na{constructor(t,e){c(this,"name");if(this.name=e,Array.isArray(t))for(const i of t)pv.register(i,this);else pv.register(t,this)}}class U8{constructor(){c(this,"isDevMode",qs());c(this,"cache",{})}registerDefinedKeys(t,e){if(this.isDevMode&&this.cache[t]===void 0){this.cache[t]=Object.keys(e);const i=e;i.$serializedTypes&&Object.keys(i.$serializedTypes)&&this.cache[t].push(...Object.keys(i.$serializedTypes)),hl&&console.log("registerDefinedKeys for "+t,this.cache[t],e)}}getDefinedKey(t,e){return this.cache[t]===void 0?!1:this.cache[t].includes(e)}}class FM{constructor(t){c(this,"root");c(this,"gltf");c(this,"gltfId");c(this,"object");c(this,"target");c(this,"nodeId");c(this,"nodeToObject");c(this,"objectToNode");c(this,"context");c(this,"path");c(this,"type");c(this,"serializable");c(this,"implementationInformation");this.root=t}}function N8(n,t){const e=n.$serializedTypes;if(e===void 0)return null;const i={};for(const s in e){const r=n[s];if(r!=null&&typeof r=="object"){const o=pv.getSerializerForConstructor(r);if(o){i[s]=o.onSerialize(r,t);continue}}i[s]=r}return i.name=n.constructor.name,typeof n.guid=="string"&&(i.guid=n.guid),i}const OA=[];function UM(n,t){if(!n)return t;typeof n.$serializedTypes=="object"&&(t||(t={}),Object.assign(t,n.$serializedTypes));const e=Object.getPrototypeOf(n);return UM(e,t)}function ow(n,t,e){if(!n)return!1;if(e.target=n,n.onBeforeDeserialize!==void 0){const s=n.onBeforeDeserialize(t,e);if(typeof s=="boolean")return s}const i=UM(n);if(t){if(typeof t.guid=="string"&&(n.guid=t.guid),i)for(const s in i){let a=function(l){const u=l.type;return u?aw(o,u,e,void 0,n[s]):aw(o,l,e,void 0,n[s])};const r=i[s],o=t[s];if(hl&&console.log(s,o,n,r),!(n[s]!==void 0&&o===void 0)&&(e.type=void 0,e.path=s,e.serializable=r,!(n.onBeforeDeserializeMember!==void 0&&n.onBeforeDeserializeMember(s,o,e)===!0))){if(r===null)n[s]=o;else{if(Array.isArray(r))for(let l=0;l<r.length;l++){const h=r[l],u=a(h);if(u!==void 0||l===r.length-1){n[s]=u;break}}else n[s]=a(r);OA.length=0}n.onAfterDeserializeMember!==void 0&&n.onAfterDeserializeMember(s,o,e)}}j8(n,t)}return z8(n,t,e.implementationInformation),n.onAfterDeserialize!==void 0&&n.onAfterDeserialize(t,e),!0}const Q8=N("noerrors");function z8(n,t,e){var r,o;if(Q8||!t||!qs()||!n||n.constructor&&n.constructor[UQ]===!0)return;const i=(r=n.constructor)==null?void 0:r.name,s=Object.getOwnPropertyNames(t);for(const a of s){if(a==="sourceId")continue;const l=n[a];if(l==null)continue;const h=t[a];if((e==null?void 0:e.getDefinedKey(i,a))===!1){const u=a.charAt(0).toUpperCase()+a.slice(1);e.getDefinedKey(i,u)&&(xa(Ui.Warn,'<strong>Please rename</strong> "'+u+'" to "'+a+'" in '+i),console.warn('Please use lowercase for field: "'+u+'" in '+i,h,n));continue}if(h!=null){if(typeof h=="object"&&(l===void 0||!l.isObject3D)){if(typeof h.node=="number"||typeof h.guid=="string"){if(h.could_not_resolve)continue;if(!(l!==void 0&&Object.keys(l).length>1)){xa(Ui.Warn,`<strong>Missing serialization for object reference!</strong>

Please change to: 
@serializable(Object3D)
${a}? : Object3D;

in script ${i}.ts
<a href="https://docs.needle.tools/serializable" target="_blank">documentation</a>`),console.warn(i,a,n[a],n);continue}}else if(!Array.isArray(l)){const u=(o=l.constructor)==null?void 0:o.name;if(u==="Object"&&!l.constructor["did_warn:missing_serializable"]){l.constructor["did_warn:missing_serializable"]=!0;const d='You might be missing a @serializable(Type) decorator for field "'+a+'" in '+i+".ts";console.warn(d+`
${a}:`,h,u),xa(Ui.Warn,"Dev Warning: Are you missing a type in @serializable? Please check the browser console for details")}}}if(typeof l=="string"&&(h.endsWith(".gltf")||h.endsWith(".glb"))){xa(Ui.Warn,`<strong>Missing serialization for object reference!</strong>

Please change to: 
@serializable(AssetReference)
${a}? : AssetReference;

in script ${i}.ts
<a href="https://docs.needle.tools/serializable" target="_blank">documentation</a>`),console.warn(i,a,n[a],n);continue}}}}function j8(n,t){for(const e of Object.keys(t)){const i=t[e];if(typeof i=="object"&&i!==null&&i!==void 0){const s=n[e];if(!s){hl&&console.log(e,"is undefined on",n);continue}for(const r of Object.keys(i))if(s[r]===void 0&&S1(i[r])&&!S1(s)){const a=G8(s,r);if(a&&((a==null?void 0:a.writable)===void 0||(a==null?void 0:a.writable)===!1)&&a.set===void 0){hl&&console.warn('Property is not writable "'+r+'"',s,a,i[r],s[r]);continue}s[r]=i[r]}}}}function G8(n,t){for(;n;){const e=Object.getOwnPropertyDescriptor(n,t);if(e)return e;n=Object.getPrototypeOf(n)}}function S1(n){switch(typeof n){case"number":case"string":case"boolean":return!0}return!1}function aw(n,t,e,i,s){let r=typeof t=="function"&&t.prototype===void 0,o=t;if(r)try{if(o=t==null?void 0:t.call(t,s),r=!1,o==null)return}catch(u){console.error("Error in callback",u,n)}if(e.type=o,!r&&s instanceof o)return s;if(i||(i={serializer:pv.getSerializerForConstructor(o)}),s&&typeof s=="object"&&O8(s)){if(s.__concreteInstance)return s.__concreteInstance;const u=s;if(!u.$serializedTypes&&o.prototype.$serializedTypes&&(u.$serializedTypes=o.prototype.$serializedTypes),u.$serializedTypes&&ow(u,n,e),s&&o!==void 0)try{let d=null;i.serializer&&(d=i.serializer.onDeserialize(n,e)),d||(d=new o,Fn&&console.log("Create concrete instance for persistent asset",s,"instance:",d),Dd(d,s)),s.__concreteInstance=d,s=d}catch(d){console.error("Error creating instance or creating values on instance",d,s,o)}return s}if(Array.isArray(n)){const u=[];for(let d=0;d<n.length;d++){const f=n[d],p=aw(f,t,e,i,f);u.push(p)}return u}const a=i==null?void 0:i.serializer;if(a)return a.onDeserialize(n,e);let l;if(n&&(n.isMaterial||n.isTexture||n.isObject3D||n instanceof Pa))l=n;else{if(n===void 0)return;if(n===null&&(o===ft||o===pt||o===J||o===Pa))return null;try{l=new o(...H8(n))}catch(u){console.error("Error creating "+e.path,e.target,u);return}}const h=l;return h.$serializedTypes&&ow(h,n,e),l}function H8(n){if(OA.length=0,typeof n=="object"&&n!==null&&n!==void 0)for(const t of Object.keys(n))OA.push(n[t]);return OA}const lw=Symbol("assigned component properties");function Dd(n,t,e){var s;if(t==null||n==null)return;n[lw]=!0;const i=((s=n.constructor)==null?void 0:s.name)??"unknown";e==null||e.registerDefinedKeys(i,n);for(const r of Object.keys(t)){const o=V8(n,r);typeof(o==null?void 0:o.value)!="function"&&(!o||o.writable===!0||(o==null?void 0:o.set)!==void 0)&&(n[r]=t[r])}delete n[lw]}function V8(n,t){let e;do e=Object.getOwnPropertyDescriptor(n,t);while(!e&&(n=Object.getPrototypeOf(n)));return e}function Ry(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var NM={exports:{}},QM={exports:{}};(function(){var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",t={rotl:function(e,i){return e<<i|e>>>32-i},rotr:function(e,i){return e<<32-i|e>>>i},endian:function(e){if(e.constructor==Number)return t.rotl(e,8)&16711935|t.rotl(e,24)&4278255360;for(var i=0;i<e.length;i++)e[i]=t.endian(e[i]);return e},randomBytes:function(e){for(var i=[];e>0;e--)i.push(Math.floor(Math.random()*256));return i},bytesToWords:function(e){for(var i=[],s=0,r=0;s<e.length;s++,r+=8)i[r>>>5]|=e[s]<<24-r%32;return i},wordsToBytes:function(e){for(var i=[],s=0;s<e.length*32;s+=8)i.push(e[s>>>5]>>>24-s%32&255);return i},bytesToHex:function(e){for(var i=[],s=0;s<e.length;s++)i.push((e[s]>>>4).toString(16)),i.push((e[s]&15).toString(16));return i.join("")},hexToBytes:function(e){for(var i=[],s=0;s<e.length;s+=2)i.push(parseInt(e.substr(s,2),16));return i},bytesToBase64:function(e){for(var i=[],s=0;s<e.length;s+=3)for(var r=e[s]<<16|e[s+1]<<8|e[s+2],o=0;o<4;o++)s*8+o*6<=e.length*8?i.push(n.charAt(r>>>6*(3-o)&63)):i.push("=");return i.join("")},base64ToBytes:function(e){e=e.replace(/[^A-Z0-9+\/]/ig,"");for(var i=[],s=0,r=0;s<e.length;r=++s%4)r!=0&&i.push((n.indexOf(e.charAt(s-1))&Math.pow(2,-2*r+8)-1)<<r*2|n.indexOf(e.charAt(s))>>>6-r*2);return i}};QM.exports=t})();var W8=QM.exports,cw={utf8:{stringToBytes:function(n){return cw.bin.stringToBytes(unescape(encodeURIComponent(n)))},bytesToString:function(n){return decodeURIComponent(escape(cw.bin.bytesToString(n)))}},bin:{stringToBytes:function(n){for(var t=[],e=0;e<n.length;e++)t.push(n.charCodeAt(e)&255);return t},bytesToString:function(n){for(var t=[],e=0;e<n.length;e++)t.push(String.fromCharCode(n[e]));return t.join("")}}},E1=cw;/*!
 * Determine if an object is a Buffer
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */var q8=function(n){return n!=null&&(zM(n)||X8(n)||!!n._isBuffer)};function zM(n){return!!n.constructor&&typeof n.constructor.isBuffer=="function"&&n.constructor.isBuffer(n)}function X8(n){return typeof n.readFloatLE=="function"&&typeof n.slice=="function"&&zM(n.slice(0,0))}(function(){var n=W8,t=E1.utf8,e=q8,i=E1.bin,s=function(r,o){r.constructor==String?o&&o.encoding==="binary"?r=i.stringToBytes(r):r=t.stringToBytes(r):e(r)?r=Array.prototype.slice.call(r,0):!Array.isArray(r)&&r.constructor!==Uint8Array&&(r=r.toString());for(var a=n.bytesToWords(r),l=r.length*8,h=1732584193,u=-271733879,d=-1732584194,f=271733878,p=0;p<a.length;p++)a[p]=(a[p]<<8|a[p]>>>24)&16711935|(a[p]<<24|a[p]>>>8)&4278255360;a[l>>>5]|=128<<l%32,a[(l+64>>>9<<4)+14]=l;for(var g=s._ff,m=s._gg,v=s._hh,y=s._ii,p=0;p<a.length;p+=16){var b=h,_=u,x=d,S=f;h=g(h,u,d,f,a[p+0],7,-680876936),f=g(f,h,u,d,a[p+1],12,-389564586),d=g(d,f,h,u,a[p+2],17,606105819),u=g(u,d,f,h,a[p+3],22,-1044525330),h=g(h,u,d,f,a[p+4],7,-176418897),f=g(f,h,u,d,a[p+5],12,1200080426),d=g(d,f,h,u,a[p+6],17,-1473231341),u=g(u,d,f,h,a[p+7],22,-45705983),h=g(h,u,d,f,a[p+8],7,1770035416),f=g(f,h,u,d,a[p+9],12,-1958414417),d=g(d,f,h,u,a[p+10],17,-42063),u=g(u,d,f,h,a[p+11],22,-1990404162),h=g(h,u,d,f,a[p+12],7,1804603682),f=g(f,h,u,d,a[p+13],12,-40341101),d=g(d,f,h,u,a[p+14],17,-1502002290),u=g(u,d,f,h,a[p+15],22,1236535329),h=m(h,u,d,f,a[p+1],5,-165796510),f=m(f,h,u,d,a[p+6],9,-1069501632),d=m(d,f,h,u,a[p+11],14,643717713),u=m(u,d,f,h,a[p+0],20,-373897302),h=m(h,u,d,f,a[p+5],5,-701558691),f=m(f,h,u,d,a[p+10],9,38016083),d=m(d,f,h,u,a[p+15],14,-660478335),u=m(u,d,f,h,a[p+4],20,-405537848),h=m(h,u,d,f,a[p+9],5,568446438),f=m(f,h,u,d,a[p+14],9,-1019803690),d=m(d,f,h,u,a[p+3],14,-187363961),u=m(u,d,f,h,a[p+8],20,1163531501),h=m(h,u,d,f,a[p+13],5,-1444681467),f=m(f,h,u,d,a[p+2],9,-51403784),d=m(d,f,h,u,a[p+7],14,1735328473),u=m(u,d,f,h,a[p+12],20,-1926607734),h=v(h,u,d,f,a[p+5],4,-378558),f=v(f,h,u,d,a[p+8],11,-2022574463),d=v(d,f,h,u,a[p+11],16,1839030562),u=v(u,d,f,h,a[p+14],23,-35309556),h=v(h,u,d,f,a[p+1],4,-1530992060),f=v(f,h,u,d,a[p+4],11,1272893353),d=v(d,f,h,u,a[p+7],16,-155497632),u=v(u,d,f,h,a[p+10],23,-1094730640),h=v(h,u,d,f,a[p+13],4,681279174),f=v(f,h,u,d,a[p+0],11,-358537222),d=v(d,f,h,u,a[p+3],16,-722521979),u=v(u,d,f,h,a[p+6],23,76029189),h=v(h,u,d,f,a[p+9],4,-640364487),f=v(f,h,u,d,a[p+12],11,-421815835),d=v(d,f,h,u,a[p+15],16,530742520),u=v(u,d,f,h,a[p+2],23,-995338651),h=y(h,u,d,f,a[p+0],6,-198630844),f=y(f,h,u,d,a[p+7],10,1126891415),d=y(d,f,h,u,a[p+14],15,-1416354905),u=y(u,d,f,h,a[p+5],21,-57434055),h=y(h,u,d,f,a[p+12],6,1700485571),f=y(f,h,u,d,a[p+3],10,-1894986606),d=y(d,f,h,u,a[p+10],15,-1051523),u=y(u,d,f,h,a[p+1],21,-2054922799),h=y(h,u,d,f,a[p+8],6,1873313359),f=y(f,h,u,d,a[p+15],10,-30611744),d=y(d,f,h,u,a[p+6],15,-1560198380),u=y(u,d,f,h,a[p+13],21,1309151649),h=y(h,u,d,f,a[p+4],6,-145523070),f=y(f,h,u,d,a[p+11],10,-1120210379),d=y(d,f,h,u,a[p+2],15,718787259),u=y(u,d,f,h,a[p+9],21,-343485551),h=h+b>>>0,u=u+_>>>0,d=d+x>>>0,f=f+S>>>0}return n.endian([h,u,d,f])};s._ff=function(r,o,a,l,h,u,d){var f=r+(o&a|~o&l)+(h>>>0)+d;return(f<<u|f>>>32-u)+o},s._gg=function(r,o,a,l,h,u,d){var f=r+(o&l|a&~l)+(h>>>0)+d;return(f<<u|f>>>32-u)+o},s._hh=function(r,o,a,l,h,u,d){var f=r+(o^a^l)+(h>>>0)+d;return(f<<u|f>>>32-u)+o},s._ii=function(r,o,a,l,h,u,d){var f=r+(a^(o|~l))+(h>>>0)+d;return(f<<u|f>>>32-u)+o},s._blocksize=16,s._digestsize=16,NM.exports=function(r,o){if(r==null)throw new Error("Illegal argument "+r);var a=n.wordsToBytes(s(r,o));return o&&o.asBytes?a:o&&o.asString?i.bytesToString(a):n.bytesToHex(a)}})();var Y8=NM.exports;const K8=Ry(Y8);class I1{constructor(t,e,i,s){c(this,"success");c(this,"filename");c(this,"hash");c(this,"size");c(this,"url");this.success=t,this.filename=e,this.hash=i,this.size=s}}async function J8(n,t){const e=await n.arrayBuffer(),i=jM(e),s=n.name.split(".").pop(),r=i+"."+s,o=n.name.split(".").shift();console.assert(o!==void 0);const a={alias:o,filename:r},h=await(await fetch(t+"/exists",{method:"POST",body:JSON.stringify(a)})).json();if(h.success||console.warn("exists check did fail"),h.exists)return console.log("file already exists",i),new I1(!0,r,i,n.size);console.log("begin uploading file",o,n.size);const u=new FormData;u.append("file",n);const d={};d.filesize=n.size,o&&(d.alias=o);const p=await(await fetch(t+"/upload/file",{method:"POST",body:u,headers:d})).json();if((p==null?void 0:p.success)===!1)return p.message!==void 0?console.error("Upload failed:",p.message):console.error("Upload failed"),null;console.assert(p.hash_sum===i,"hash sum did not match","received:",p.hash_sum,"expected:",i),p.success&&console.log("successfully uploaded",i,p.id);const g=new I1(p.success,r,i,n.size);return g.url=t,g}function jM(n){return K8(new Uint8Array(n))}async function GM(n,t,e,i,s=!1){try{const r=await fetch(i+"/download/file",{method:"POST",body:n});if(r.status!==200)return console.error("download failed",r),null;const o=await r.blob(),a=await o.arrayBuffer();s||console.assert(o.size===e,"size mismatch","expected:",e,"got:",o.size);const l=jM(a);return s||console.assert(l===t,"hash mismatch, downloaded file is invalid"),o.arrayBuffer()}catch(r){console.error(r)}return null}async function Z8(n,t){var u;const e=await fetch(n),i=(u=e.body)==null?void 0:u.getReader(),s=e.headers.get("Content-Length"),r=s?parseInt(s):0;if(!i)return null;let o=0;const a=[];for(;;){const{done:d,value:f}=await i.read();if(f&&(a.push(f),o+=f.length,t.call(null,new ProgressEvent("progress",{loaded:o,total:r}))),d)break}const l=new Uint8Array(o);let h=0;for(const d of a)l.set(d,h),h+=d.length;return l}const ql=N("debugaddressables");class $8{constructor(t){c(this,"_context");c(this,"_assetReferences",{});c(this,"preUpdate",()=>{});this._context=t,this._context.pre_update_callbacks.push(this.preUpdate)}dispose(){const t=this._context.pre_update_callbacks.indexOf(this.preUpdate);t>=0&&this._context.pre_update_callbacks.splice(t,1);for(const e in this._assetReferences){const i=this._assetReferences[e];i==null||i.unload()}this._assetReferences={}}findAssetReference(t){return this._assetReferences[t]||null}registerAssetReference(t){return t.uri&&(this._assetReferences[t.uri]?console.warn("Asset reference already registered",t):this._assetReferences[t.uri]=t),t}unregisterAssetReference(t){t.uri&&delete this._assetReferences[t.uri]}}const Eb=Symbol("assetReference"),dh=class{constructor(t,e,i=null){c(this,"_loading");c(this,"_asset");c(this,"_glbRoot");c(this,"_url");c(this,"_progressListeners",[]);c(this,"_hash");c(this,"_hashedUri");c(this,"_isLoadingRawBinary",!1);c(this,"_rawBinary");this._url=t,this._hash=e,t.includes("?v=")?this._hashedUri=t:this._hashedUri=e?t+"?v="+e:t,i!==null&&(this.asset=i),Y6(this._url,this.onResolvePrefab.bind(this))}static getOrCreateFromUrl(t,e){if(!e&&(e=Ne.Current,!e))throw new Error('Context is required when sourceId is a string. When you call this method from a component you can call it with "getOrCreate(this, url)" where "this" is the component.');const i=e.addressables,s=i.findAssetReference(t);if(s)return s;const r=new dh(t,e.hash);return i.registerAssetReference(r),r}static getOrCreate(t,e,i){if(typeof t=="string"){if(!i&&(i=Ne.Current,!i))throw new Error('Context is required when sourceId is a string. When you call this method from a component you can call it with "getOrCreate(this, url)" where "this" is the component.')}else i=t.context,t=t.sourceId;const s=qh(t,e);ql&&console.log("GetOrCreate Addressable from",t,e,"FinalPath=",s);const r=i.addressables,o=r.findAssetReference(s);if(o)return o;const a=new dh(s,i.hash);return r.registerAssetReference(a),a}get asset(){return this._glbRoot??this._asset}set asset(t){this._asset=t}get uri(){return this._url}get rawAsset(){return this._asset}async onResolvePrefab(t){return t===this.uri&&(this.mustLoad&&await this.loadAssetAsync(),this.asset)?this.asset:null}get mustLoad(){return!this.asset||this.asset.__destroyed===!0||Ld(this.asset)===!0}isLoaded(){return this._rawBinary||this.asset!==void 0}unload(){this.asset&&(ql&&console.log("Unload",this.asset),this.asset.scene&&Ua(this.asset.scene,!0,!0),Ua(this.asset,!0,!0)),this.asset=null,this._rawBinary=void 0,this._glbRoot=null,this._loading=void 0,Ne.Current&&Ne.Current.addressables.unregisterAssetReference(this)}async preload(){if(!this.mustLoad||this._isLoadingRawBinary)return null;if(this._rawBinary!==void 0)return this._rawBinary;this._isLoadingRawBinary=!0,ql&&console.log("Preload",this._hashedUri);const t=await Z8(this._hashedUri,e=>{this.raiseProgressEvent(e)});return this._rawBinary=(t==null?void 0:t.buffer)??null,this._isLoadingRawBinary=!1,this._rawBinary}async loadAssetAsync(t){if(ql&&console.log("loadAssetAsync",this.uri),!this.mustLoad)return this.asset;if(t&&this._progressListeners.push(t),this._loading!==void 0)return this._loading.then(s=>this.asset);const e=Ne.Current;this._rawBinary?(this._loading=La().parseSync(e,this._rawBinary,this.uri,null),this.raiseProgressEvent(new ProgressEvent("progress",{loaded:this._rawBinary.byteLength,total:this._rawBinary.byteLength}))):(ql&&console.log("Load async",this.uri),this._loading=La().loadSync(e,this._hashedUri,this.uri,null,s=>{this.raiseProgressEvent(s)}));const i=await this._loading;if(this._progressListeners.length=0,this._glbRoot=this.tryGetActualGameObjectRoot(i),this._loading=void 0,i)return i[Eb]=this,this._glbRoot&&(this._glbRoot[Eb]=this),this.asset&&(this.asset[Eb]=this),dv(e),i.scene!==void 0&&(this.asset=i),this.asset}async instantiate(t){return this.onInstantiate(t,!1)}async instantiateSynced(t,e=!0){return this.onInstantiate(t,!0,e)}beginListenDownload(t){this._progressListeners.indexOf(t)<0&&this._progressListeners.push(t)}endListenDownload(t){const e=this._progressListeners.indexOf(t);e>=0&&this._progressListeners.splice(e,1)}raiseProgressEvent(t){for(const e of this._progressListeners)e(this,t)}async onInstantiate(t,e=!1,i){const s=Ne.Current,r=new za;if(t instanceof re?r.parent=t:t&&r.cloneAssign(t),r.parent||(r.parent=s.scene),this.mustLoad&&await this.loadAssetAsync(),ql&&console.log("Instantiate",this.uri,"parent:",t),this.asset){ql&&console.log("Add to scene",this.asset);let o=dh.currentlyInstantiating.get(this.uri);if(o!==void 0&&o>=1e4)return console.error("Recursive or too many instantiations of "+this.uri+" in the same frame ("+o+")"),null;try{if(o===void 0&&(o=0),o+=1,dh.currentlyInstantiating.set(this.uri,o),e){r.context=s;const a=this.asset;a.guid=this.uri;const l=HD(a,r,void 0,i);if(l)return l}else{const a=Qg(this.asset,r);if(a)return a}}finally{s.post_render_callbacks.push(()=>{o===void 0||o<0?o=0:o-=1,dh.currentlyInstantiating.set(this.uri,o)})}}else ql&&console.warn("Failed to load asset",this.uri);return null}tryGetActualGameObjectRoot(t){if(t&&t.scene){const e=t.scene;return e.isGroup&&e.children.length===1&&e.children[0].name+"glb"===e.name?e.children[0]:e}return null}};let it=dh;c(it,"currentlyInstantiating",new Map);class eG extends Na{constructor(){super([it],"AssetReferenceSerializer")}onSerialize(t,e){if(t&&t.uri!==void 0&&typeof t.uri=="string")return t.uri}onDeserialize(t,e){if(typeof t=="string")return e.context?e.gltfId?it.getOrCreate(e.gltfId,t,e.context):(console.error("Missing source id"),null):(console.error("Missing context"),null);if(t instanceof re){if(!e.context)return console.error("Missing context"),null;if(!e.gltfId)return console.error("Missing source id"),null;const i=t,s=e.context,r=i.guid??i.uuid,o=s.addressables.findAssetReference(r);if(o)return o;const a=new it(r,void 0,i);return s.addressables.registerAssetReference(a),a}return null}}new eG;const tG=Promise.resolve(null),Xp=class{constructor(t){c(this,"url");c(this,"_bitmap");c(this,"_bitmapObject");c(this,"loader",null);this.url=t}static getOrCreate(t){let e=Xp.imageReferences.get(t);return e||(e=new Xp(t),Xp.imageReferences.set(t,e)),e}dispose(){this._bitmapObject&&this._bitmapObject.close(),this._bitmap=void 0}createHTMLImage(){const t=new Image;return t.src=this.url,t}createTexture(){return this.url?(this.loader||(this.loader=new Ra),this.loader.setCrossOrigin("anonymous"),this.loader.loadAsync(this.url)):tG}getBitmap(){return this._bitmap?this._bitmap:(this._bitmap=new Promise((t,e)=>{const i=document.createElement("img");i.addEventListener("load",()=>{this._bitmap=createImageBitmap(i).then(s=>(this._bitmapObject=s,t(s),s))}),i.addEventListener("error",s=>{console.error("Failed to load image:"+this.url,s),t(null)}),i.src=this.url}),this._bitmap)}};let _p=Xp;c(_p,"imageReferences",new Map);class iG extends Na{constructor(){super([_p],"ImageReferenceSerializer")}onSerialize(t,e){return null}onDeserialize(t,e){if(typeof t=="string"){const i=qh(e.gltfId,t);return _p.getOrCreate(i)}}}new iG;const Yp=class{constructor(t){c(this,"url");c(this,"res");this.url=t}static getOrCreate(t){let e=Yp.cache.get(t);return e||(e=new Yp(t),Yp.cache.set(t,e)),e}async loadRaw(){return this.res||(this.res=fetch(this.url)),this.res.then(t=>t.blob())}async loadText(){return this.res||(this.res=fetch(this.url)),this.res.then(t=>t.text())}};let wp=Yp;c(wp,"cache",new Map);class nG extends Na{constructor(){super([wp],"FileReferenceSerializer")}onSerialize(t,e){return null}onDeserialize(t,e){if(typeof t=="string"){const i=qh(e.gltfId,t);return wp.getOrCreate(i)}}}new nG;const kd=[];function aC(n){kd.indexOf(n)===-1&&kd.push(n)}function Xq(n){const t=kd.indexOf(n);t!==-1&&kd.splice(t,1)}const Od=[];function HM(n){Od.indexOf(n)===-1&&Od.push(n)}function Yq(n){const t=Od.indexOf(n);t!==-1&&Od.splice(t,1)}function sG(n){globalThis.dispatchEvent(new CustomEvent("needle-xrsession-start",{detail:n}));for(let t=0;t<kd.length;t++)kd[t](n)}function rG(n){globalThis.dispatchEvent(new CustomEvent("needle-xrsession-end",{detail:n}));for(let t=0;t<Od.length;t++)Od[t](n)}const ln={Handedness:Object.freeze({NONE:"none",LEFT:"left",RIGHT:"right"}),ComponentState:Object.freeze({DEFAULT:"default",TOUCHED:"touched",PRESSED:"pressed"}),ComponentProperty:Object.freeze({BUTTON:"button",X_AXIS:"xAxis",Y_AXIS:"yAxis",STATE:"state"}),ComponentType:Object.freeze({TRIGGER:"trigger",SQUEEZE:"squeeze",TOUCHPAD:"touchpad",THUMBSTICK:"thumbstick",BUTTON:"button"}),ButtonTouchThreshold:.05,AxisTouchThreshold:.1,VisualResponseProperty:Object.freeze({TRANSFORM:"transform",VISIBILITY:"visibility"})};async function VM(n){const t=await fetch(n);if(t.ok)return t.json();throw new Error(t.statusText)}async function oG(n){if(!n)throw new Error("No basePath supplied");return await VM(`${n}/profilesList.json`)}async function aG(n,t,e=null,i=!0){if(!n)throw new Error("No xrInputSource supplied");if(!t)throw new Error("No basePath supplied");const s=await oG(t);let r;if(n.profiles.some(l=>{const h=s[l];return h&&(r={profileId:l,profilePath:`${t}/${h.path}`,deprecated:!!h.deprecated}),!!r}),!r){if(!e)throw new Error("No matching profile name found");const l=s[e];if(!l)throw new Error(`No matching profile name found and default profile "${e}" missing.`);r={profileId:e,profilePath:`${t}/${l.path}`,deprecated:!!l.deprecated}}const o=await VM(r.profilePath);let a;if(i){let l;if(n.handedness==="any"?l=o.layouts[Object.keys(o.layouts)[0]]:l=o.layouts[n.handedness],!l)throw new Error(`No matching handedness, ${n.handedness}, in profile ${r.profileId}`);l.assetPath&&(a=r.profilePath.replace("profile.json",l.assetPath))}return{profile:o,assetPath:a}}const lG={xAxis:0,yAxis:0,button:0,state:ln.ComponentState.DEFAULT};function cG(n=0,t=0){let e=n,i=t;if(Math.sqrt(n*n+t*t)>1){const o=Math.atan2(t,n);e=Math.cos(o),i=Math.sin(o)}return{normalizedXAxis:e*.5+.5,normalizedYAxis:i*.5+.5}}let hG=class{constructor(t){this.componentProperty=t.componentProperty,this.states=t.states,this.valueNodeName=t.valueNodeName,this.valueNodeProperty=t.valueNodeProperty,this.valueNodeProperty===ln.VisualResponseProperty.TRANSFORM&&(this.minNodeName=t.minNodeName,this.maxNodeName=t.maxNodeName),this.value=0,this.updateFromComponent(lG)}updateFromComponent({xAxis:t,yAxis:e,button:i,state:s}){const{normalizedXAxis:r,normalizedYAxis:o}=cG(t,e);switch(this.componentProperty){case ln.ComponentProperty.X_AXIS:this.value=this.states.includes(s)?r:.5;break;case ln.ComponentProperty.Y_AXIS:this.value=this.states.includes(s)?o:.5;break;case ln.ComponentProperty.BUTTON:this.value=this.states.includes(s)?i:0;break;case ln.ComponentProperty.STATE:this.valueNodeProperty===ln.VisualResponseProperty.VISIBILITY?this.value=this.states.includes(s):this.value=this.states.includes(s)?1:0;break;default:throw new Error(`Unexpected visualResponse componentProperty ${this.componentProperty}`)}}},uG=class{constructor(t,e){if(!t||!e||!e.visualResponses||!e.gamepadIndices||Object.keys(e.gamepadIndices).length===0)throw new Error("Invalid arguments supplied");this.id=t,this.type=e.type,this.rootNodeName=e.rootNodeName,this.touchPointNodeName=e.touchPointNodeName,this.visualResponses={},Object.keys(e.visualResponses).forEach(i=>{const s=new hG(e.visualResponses[i]);this.visualResponses[i]=s}),this.gamepadIndices=Object.assign({},e.gamepadIndices),this.values={state:ln.ComponentState.DEFAULT,button:this.gamepadIndices.button!==void 0?0:void 0,xAxis:this.gamepadIndices.xAxis!==void 0?0:void 0,yAxis:this.gamepadIndices.yAxis!==void 0?0:void 0}}get data(){return{id:this.id,...this.values}}updateFromGamepad(t){if(this.values.state=ln.ComponentState.DEFAULT,this.gamepadIndices.button!==void 0&&t.buttons.length>this.gamepadIndices.button){const e=t.buttons[this.gamepadIndices.button];this.values.button=e.value,this.values.button=this.values.button<0?0:this.values.button,this.values.button=this.values.button>1?1:this.values.button,e.pressed||this.values.button===1?this.values.state=ln.ComponentState.PRESSED:(e.touched||this.values.button>ln.ButtonTouchThreshold)&&(this.values.state=ln.ComponentState.TOUCHED)}this.gamepadIndices.xAxis!==void 0&&t.axes.length>this.gamepadIndices.xAxis&&(this.values.xAxis=t.axes[this.gamepadIndices.xAxis],this.values.xAxis=this.values.xAxis<-1?-1:this.values.xAxis,this.values.xAxis=this.values.xAxis>1?1:this.values.xAxis,this.values.state===ln.ComponentState.DEFAULT&&Math.abs(this.values.xAxis)>ln.AxisTouchThreshold&&(this.values.state=ln.ComponentState.TOUCHED)),this.gamepadIndices.yAxis!==void 0&&t.axes.length>this.gamepadIndices.yAxis&&(this.values.yAxis=t.axes[this.gamepadIndices.yAxis],this.values.yAxis=this.values.yAxis<-1?-1:this.values.yAxis,this.values.yAxis=this.values.yAxis>1?1:this.values.yAxis,this.values.state===ln.ComponentState.DEFAULT&&Math.abs(this.values.yAxis)>ln.AxisTouchThreshold&&(this.values.state=ln.ComponentState.TOUCHED)),Object.values(this.visualResponses).forEach(e=>{e.updateFromComponent(this.values)})}},dG=class{constructor(t,e,i){if(!t)throw new Error("No xrInputSource supplied");if(!e)throw new Error("No profile supplied");this.xrInputSource=t,this.assetUrl=i,this.id=e.profileId,this.layoutDescription=e.layouts[t.handedness],this.components={},Object.keys(this.layoutDescription.components).forEach(s=>{const r=this.layoutDescription.components[s];this.components[s]=new uG(s,r)}),this.updateFromGamepad()}get gripSpace(){return this.xrInputSource.gripSpace}get targetRaySpace(){return this.xrInputSource.targetRaySpace}get data(){const t=[];return Object.values(this.components).forEach(e=>{t.push(e.data)}),t}updateFromGamepad(){Object.values(this.components).forEach(t=>{t.updateFromGamepad(this.xrInputSource.gamepad)})}};const ys=new C,T1=new C,R1=new ne,fG=N("debuggizmos"),Xo=8947848,vo=class{constructor(){}static isGizmo(t){return t[hw]!==void 0}static DrawLabel(t,e,i=.05,s=0,r,o,a){var u;if(!vo.enabled)return null;r||(r=Xo);const l=((u=Me.active)==null?void 0:u.rigScale)??1,h=_i.getTextLabel(s,e,i*l,r,o);return a instanceof re&&a.add(h),h.position.x=t.x,h.position.y=t.y,h.position.z=t.z,h}static DrawRay(t,e,i=Xo,s=0,r=!0){if(!vo.enabled)return;const o=_i.getLine(s),a=o.geometry.getAttribute("position");a.setXYZ(0,t.x,t.y,t.z),ys.set(e.x,e.y,e.z).multiplyScalar(999999999),a.setXYZ(1,t.x+ys.x,t.y+ys.y,t.z+ys.z),a.needsUpdate=!0,o.material.color.set(i),o.material.depthTest=r,o.material.depthWrite=!1}static DrawDirection(t,e,i=Xo,s=0,r=!0,o=1){if(!vo.enabled)return;const a=_i.getLine(s),l=a.geometry.getAttribute("position");l.setXYZ(0,t.x,t.y,t.z),e.w!==void 0?(ys.set(0,0,-o),R1.set(e.x,e.y,e.z,e.w),ys.applyQuaternion(R1)):(ys.set(e.x,e.y,e.z),ys.multiplyScalar(o)),l.setXYZ(1,t.x+ys.x,t.y+ys.y,t.z+ys.z),l.needsUpdate=!0,a.material.color.set(i),a.material.depthTest=r,a.material.depthWrite=!1}static DrawLine(t,e,i=Xo,s=0,r=!0){if(!vo.enabled)return;const o=_i.getLine(s),a=o.geometry.getAttribute("position");a.setXYZ(0,t.x,t.y,t.z),a.setXYZ(1,e.x,e.y,e.z),a.needsUpdate=!0,o.material.color.set(i),o.material.depthTest=r,o.material.depthWrite=!1,o.material.fog=!1}static DrawWireSphere(t,e,i=Xo,s=0,r=!0){if(!vo.enabled)return;const o=_i.getSphere(e,s,!0);Pd(o,t.x,t.y,t.z),o.material.color.set(i),o.material.depthTest=r,o.material.depthWrite=!1,o.material.fog=!1}static DrawSphere(t,e,i=Xo,s=0,r=!0){if(!vo.enabled)return;const o=_i.getSphere(e,s,!1);Pd(o,t.x,t.y,t.z),o.material.color.set(i),o.material.depthTest=r,o.material.depthWrite=!1}static DrawWireBox(t,e,i=Xo,s=0,r=!0){if(!vo.enabled)return;const o=_i.getBox(s);o.position.set(t.x,t.y,t.z),o.scale.set(e.x,e.y,e.z),o.material.color.set(i),o.material.depthTest=r,o.material.wireframe=!0,o.material.depthWrite=!1,o.material.fog=!1}static DrawWireBox3(t,e=Xo,i=0,s=!0){if(!vo.enabled)return;const r=_i.getBox(i);r.position.copy(t.getCenter(ys)),r.scale.copy(t.getSize(ys)),r.material.color.set(e),r.material.depthTest=s,r.material.wireframe=!0,r.material.depthWrite=!1,r.material.fog=!1}static DrawArrow(t,e,i=Xo,s=0,r=!0,o=!1){if(!vo.enabled)return;const a=_i.getArrowHead(s);a.position.set(e.x,e.y,e.z),a.quaternion.setFromUnitVectors(this._up.set(0,1,0),ys.set(e.x,e.y,e.z).sub(T1.set(t.x,t.y,t.z)).normalize());const h=ys.set(e.x,e.y,e.z).sub(T1.set(t.x,t.y,t.z)).length()*.1;a.scale.set(h,h,h),a.material.color.set(i),a.material.depthTest=r,a.material.wireframe=o,this.DrawLine(t,e,i,s,r)}static DrawWireMesh(t){const e=_i.getMesh(t.duration??0);"mesh"in t?(e.geometry=t.mesh.geometry,e.matrix.copy(t.mesh.matrixWorld)):(e.geometry=t.geometry,e.matrix.copy(t.matrix)),e.matrixAutoUpdate=!1,e.matrixWorldAutoUpdate=!1,e.material.color.set(t.color??Xo),e.material.depthTest=t.depthTest??!0,e.material.wireframe=!0}};let De=vo;c(De,"enabled",!0),c(De,"_up",new C(0,1,0));const pG=new Xi(1,1,1);function lC(n=null){const t=new we(n??14540253),e=new m2(pG);return new tg(e,new Ba({color:t}))}const hw=Symbol("GizmoCache");class _i{static ensureFont(){let t=zt.FontLibrary.getFontFamily(this.familyName);if(!t){t=zt.FontLibrary.addFontFamily(this.familyName);const e=t.addVariant("normal","normal","https://uploads.needle.tools/include/font-msdf.json","https://uploads.needle.tools/include/font.png");e==null||e.addEventListener("ready",()=>{zt.update()})}}static getTextLabel(t,e,i,s,r){this.ensureFont();let o=this.textLabelCache.pop(),a=1;r&&typeof r=="string"&&(r==null?void 0:r.length)>=8&&r.startsWith("#")?(a=parseInt(r.substring(7),16)/255,r=r.substring(0,7),fG&&console.log(r,a)):typeof r=="object"&&r.a!==void 0&&(a=r.a);const l={boxSizing:"border-box",fontFamily:this.familyName,width:"auto",fontSize:i,color:s,lineHeight:1,backgroundColor:r??void 0,backgroundOpacity:a,textContent:e,borderRadius:.5*i,padding:.8*i,whiteSpace:"pre"};if(o)o.set(l);else{o=new Gx(l);const h=this,u=o;u.setText=function(d){this.set({textContent:d}),h.tmuiNeedsUpdate=!0}}return this.tmuiNeedsUpdate=!0,this.registerTimedObject(Ne.Current,o,t,this.textLabelCache),o}static getBox(t){let e=this.boxesCache.pop();if(!e){const i=new Xi(1,1,1);e=new J(i)}return this.registerTimedObject(Ne.Current,e,t,this.boxesCache),e}static getLine(t){let e=this.linesCache.pop();if(!e){e=new Hs;let i=e.geometry.getAttribute("position");i||(i=new Ve(new Float32Array(2*3),3),e.geometry.setAttribute("position",i))}return e.frustumCulled=!1,this.registerTimedObject(Ne.Current,e,t,this.linesCache),e}static getSphere(t,e,i){let s=this.spheresCache.pop();return s||(s=new J(new Qd(1,8,8))),s.scale.set(t,t,t),s.material.wireframe=i,this.registerTimedObject(Ne.Current,s,e,this.spheresCache),s}static getArrowHead(t){let e=this.arrowHeadsCache.pop();return e||(e=new J(new _s(0,.5,1,8))),this.registerTimedObject(Ne.Current,e,t,this.arrowHeadsCache),e}static getMesh(t){let e=this.mesh.pop();return e||(e=new J,e.material=new St),this.registerTimedObject(Ne.Current,e,t,this.mesh),e}static registerTimedObject(t,e,i,s){const r=this.contextBeforeRenderCallbacks.get(t),o=this.contextPostRenderCallbacks.get(t);if(r){if(t.pre_render_callbacks[t.pre_render_callbacks.length-1]!==r){const a=t.pre_render_callbacks.indexOf(r);a>=0&&t.pre_render_callbacks.splice(a,1),t.pre_render_callbacks.push(r)}}else{const a=()=>{this.onBeforeRender(t,this.timedObjectsBuffer)};this.contextBeforeRenderCallbacks.set(t,a),t.pre_render_callbacks.push(a)}if(o){if(t.post_render_callbacks[t.post_render_callbacks.length-1]!==o){const a=t.post_render_callbacks.indexOf(o);a>=0&&t.post_render_callbacks.splice(a,1),t.post_render_callbacks.push(o)}}else{const a=()=>{this.onPostRender(t,this.timedObjectsBuffer,this.timesBuffer)};this.contextPostRenderCallbacks.set(t,a),t.post_render_callbacks.push(a)}e.traverse(a=>{a.layers.disableAll(),a.layers.enable(2)}),e.renderOrder=999999,e[hw]=s,this.timedObjectsBuffer.push(e),i<=0&&t.currentFrameEvent>=ze.OnBeforeRender?this.timesBuffer.push(0):this.timesBuffer.push(Ne.Current.time.realtimeSinceStartup+i),t.scene.add(e)}static onBeforeRender(t,e){this.tmuiNeedsUpdate&&zt.update();for(let i=0;i<e.length;i++){const s=e[i];if(t.mainCamera&&s instanceof zt.MeshUIBaseElement){if(Ld(s))continue;const r=t.isInVR,o=!1,a=!r;Ay(s,t.mainCamera,o,a)}}}static onPostRender(t,e,i){const s=t.time.realtimeSinceStartup;for(let r=e.length-1;r>=0;r--){const o=e[r];s>i[r]&&(e.splice(r,1),i.splice(r,1),o.removeFromParent(),Ld(o)!=!0&&o[hw].push(o))}}}c(_i,"familyName","needle-gizmos"),c(_i,"linesCache",[]),c(_i,"spheresCache",[]),c(_i,"boxesCache",[]),c(_i,"arrowHeadsCache",[]),c(_i,"mesh",[]),c(_i,"textLabelCache",[]),c(_i,"timedObjectsBuffer",new Array),c(_i,"timesBuffer",new Array),c(_i,"contextPostRenderCallbacks",new Map),c(_i,"contextBeforeRenderCallbacks",new Map),c(_i,"tmuiNeedsUpdate",!1);const Hi=N("debuginput");var yc;(function(n){n.Mouse="mouse",n.Touch="touch",n.Controller="controller",n.Hand="hand"})(yc||(yc={}));var B1;(function(n){n.PointerDown="pointerdown",n.PointerUp="pointerup",n.PointerMove="pointermove"})(B1||(B1={}));var P1;(function(n){n.KeyDown="keydown",n.KeyUp="keyup",n.KeyPressed="keypress"})(P1||(P1={}));var at;(function(n){n.PointerDown="pointerdown",n.PointerUp="pointerup",n.PointerMove="pointermove",n.KeyDown="keydown",n.KeyUp="keyup",n.KeyPressed="keypress"})(at||(at={}));class tc extends PointerEvent{constructor(e,i,s){super(e,s);c(this,"deviceIndex");c(this,"origin");c(this,"source");c(this,"mode");c(this,"_ray");c(this,"space");c(this,"isClick",!1);c(this,"isDoubleClick",!1);c(this,"_used",!1);c(this,"_pointerid");c(this,"_pointerType");c(this,"_type");c(this,"metadata",{});c(this,"intersections",new Array);c(this,"_immediatePropagationStopped",!1);c(this,"_propagationStopped",!1);this._pointerid=s.pointerId,this._pointerType=s.pointerType,this._type=e,this.deviceIndex=s.deviceIndex,this.origin=s.origin,this.source=i,this.mode=s.mode,this._ray=s.ray,this.space=s.device}get ray(){return this._ray||(this._ray=new Lc(this.space.worldPosition.clone(),this.space.worldForward.clone())),this._ray}set ray(e){this._ray=e}get hasRay(){return this._ray!==void 0}get used(){return this._used}use(){this._used=!0}get pointerId(){return this._pointerid}get pointerType(){return this._pointerType}get type(){return this._type}get immediatePropagationStopped(){return this._immediatePropagationStopped}get propagationStopped(){return this._immediatePropagationStopped||this._propagationStopped}stopImmediatePropagation(){var e;this._immediatePropagationStopped=!0,super.stopImmediatePropagation(),(e=this.source)==null||e.stopImmediatePropagation()}stopPropagation(){var e;this._propagationStopped=!0,super.stopPropagation(),(e=this.source)==null||e.stopPropagation(),Hi&&console.warn("Stop propagation...",this.pointerId,this.pointerType)}}class km extends KeyboardEvent{constructor(e,i,s){super(e,s);c(this,"source");this.source=i}stopImmediatePropagation(){var e;super.stopImmediatePropagation(),(e=this.source)==null||e.stopImmediatePropagation()}}class $q{constructor(t){c(this,"key");c(this,"keyType");c(this,"source");this.key=t.key,this.keyType=t.type,this.source=t}}var fa;(function(n){n[n.Early=-100]="Early",n[n.Default=0]="Default",n[n.Late=100]="Late"})(fa||(fa={}));class gG{constructor(t){c(this,"_eventListeners",{});c(this,"_doubleClickTimeThreshold",.2);c(this,"_longPressTimeThreshold",1);c(this,"_specialCursorTrigger",0);c(this,"context");c(this,"_pointerDown",[!1]);c(this,"_pointerUp",[!1]);c(this,"_pointerClick",[!1]);c(this,"_pointerDoubleClick",[!1]);c(this,"_pointerPressed",[!1]);c(this,"_pointerPositions",[new ae]);c(this,"_pointerPositionsLastFrame",[new ae]);c(this,"_pointerPositionsDelta",[new ae]);c(this,"_pointerPositionsRC",[new ae]);c(this,"_pointerPositionDown",[new ae]);c(this,"_pointerDownTime",[]);c(this,"_pointerUpTime",[]);c(this,"_pointerUpTimestamp",[]);c(this,"_pointerIds",[]);c(this,"_pointerTypes",[""]);c(this,"_mouseWheelChanged",[!1]);c(this,"_mouseWheelDeltaY",[0]);c(this,"_pointerEvent",[]);c(this,"_pointerUsed",[]);c(this,"_pointerSpace",[]);c(this,"_pressedStack",new Map);c(this,"_htmlEventSource");c(this,"onLostFocus",()=>{for(const t in this.keysPressed)this.keysPressed[t].pressed=!1});c(this,"onEndOfFrame",()=>{for(let t=0;t<this._pointerUp.length;t++)this._pointerUp[t]=!1;for(let t=0;t<this._pointerDown.length;t++)this._pointerDown[t]=!1;for(let t=0;t<this._pointerClick.length;t++)this._pointerClick[t]=!1;for(let t=0;t<this._pointerDoubleClick.length;t++)this._pointerDoubleClick[t]=!1;for(const t of this._pointerPositionsDelta)t.set(0,0);for(let t=0;t<this._mouseWheelChanged.length;t++)this._mouseWheelChanged[t]=!1;for(let t=0;t<this._mouseWheelDeltaY.length;t++)this._mouseWheelDeltaY[t]=0});c(this,"onContextMenu",t=>{this.canReceiveInput(t)!==!1&&t instanceof PointerEvent&&t.pointerType});c(this,"keysPressed",{});c(this,"onKeyDown",t=>{if(Hi&&console.log(`key down ${t.code}, ${this.context.application.hasFocus}`,t),!this.context.application.hasFocus)return;const e=this.keysPressed[t.code];if(e&&e.pressed)return;this.keysPressed[t.code]={pressed:!0,frame:this.context.time.frameCount+1,startFrame:this.context.time.frameCount+1,key:t.key,code:t.code};const i=new km(at.KeyDown,t,t);this.onDispatchEvent(i)});c(this,"onKeyPressed",t=>{if(!this.context.application.hasFocus)return;const e=this.keysPressed[t.code];if(!e)return;e.pressed=!0,e.frame=this.context.time.frameCount+1;const i=new km(at.KeyPressed,t,t);this.onDispatchEvent(i)});c(this,"onKeyUp",t=>{if(!this.context.application.hasFocus)return;const e=this.keysPressed[t.code];if(!e)return;e.pressed=!1,e.frame=this.context.time.frameCount+1;const i=new km(at.KeyUp,t,t);this.onDispatchEvent(i)});c(this,"onWheelWindow",t=>{document.pointerLockElement&&this.onMouseWheel(t)});c(this,"onMouseWheel",t=>{if(this.canReceiveInput(t)===!1)return;this._mouseWheelDeltaY.length<=0&&this._mouseWheelDeltaY.push(0),this._mouseWheelChanged.length<=0&&this._mouseWheelChanged.push(!1),this._mouseWheelChanged[0]=!0;const e=this._mouseWheelDeltaY[0];this._mouseWheelDeltaY[0]=e+t.deltaY});c(this,"onPointerDown",t=>{if(this.context.isInAR||this.canReceiveInput(t)===!1)return;const e=this.getPointerId(t);Hi&&Ci(`pointer down #${e}, identifier:${t.pointerId}`);const i=this.getAndUpdateSpatialObjectForScreenPosition(e,t.clientX,t.clientY),s=new tc(at.PointerDown,t,{origin:this,mode:"screen",deviceIndex:0,pointerId:e,button:t.button,clientX:t.clientX,clientY:t.clientY,pointerType:t.pointerType,buttonName:this.getButtonName(t),device:i,pressure:t.pressure});this.onDown(s)});c(this,"onPointerMove",t=>{if(this.context.isInAR||this.canReceiveInput(t)===!1)return;let e=t.button;t.pointerType==="mouse"&&(e=this.getFirstPressedButtonForPointer(0)??0);const i=this.getPointerId(t,e);e===-1&&(e=i);const s=this.getAndUpdateSpatialObjectForScreenPosition(i,t.clientX,t.clientY),r=new tc(at.PointerMove,t,{origin:this,mode:"screen",deviceIndex:0,pointerId:i,button:e,clientX:t.clientX,clientY:t.clientY,pointerType:t.pointerType,buttonName:this.getButtonName(t),device:s,pressure:t.pressure});this.onMove(r)});c(this,"onPointerUp",t=>{if(this.context.isInAR)return;const e=this.getPointerId(t),i=new tc(at.PointerUp,t,{origin:this,mode:"screen",deviceIndex:0,pointerId:e,button:t.button,clientX:t.clientX,clientY:t.clientY,pointerType:t.pointerType,buttonName:this.getButtonName(t),device:this.getAndUpdateSpatialObjectForScreenPosition(e,t.clientX,t.clientY),pressure:t.pressure});this.onUp(i),this._pointerIds[e]=-1,Hi&&console.log("ID="+e,"PointerId="+t.pointerId,"ALL:",[...this._pointerIds])});c(this,"onPointerCancel",t=>{this.context.isInAR||(Hi&&console.log("Pointer cancel",t),this.onPointerUp(t))});c(this,"onTouchStart",t=>{if(this.context.isInAR)for(let e=0;e<t.changedTouches.length;e++){const i=t.changedTouches[e],s=this.getPointerIndex(i.identifier),r=this.getAndUpdateSpatialObjectForScreenPosition(s,i.clientX,i.clientY),o=new tc(at.PointerDown,t,{origin:this,mode:"screen",deviceIndex:0,pointerId:s,button:0,clientX:i.clientX,clientY:i.clientY,pointerType:"touch",buttonName:"unknown",device:r,pressure:i.force});this.onDown(o)}});c(this,"onTouchMove",t=>{if(this.context.isInAR)for(let e=0;e<t.changedTouches.length;e++){const i=t.changedTouches[e],s=this.getPointerIndex(i.identifier),r=this.getAndUpdateSpatialObjectForScreenPosition(s,i.clientX,i.clientY),o=new tc(at.PointerMove,t,{origin:this,mode:"screen",deviceIndex:0,pointerId:s,button:0,clientX:i.clientX,clientY:i.clientY,pointerType:"touch",buttonName:"unknown",device:r,pressure:i.force});this.onMove(o)}});c(this,"onTouchEnd",t=>{if(this.context.isInAR)for(let e=0;e<t.changedTouches.length;e++){const i=t.changedTouches[e],s=this.getPointerIndex(i.identifier),r=new tc(at.PointerUp,t,{origin:this,mode:"screen",deviceIndex:0,pointerId:s,button:0,clientX:i.clientX,clientY:i.clientY,pointerType:"touch",buttonName:"unknown",device:this.getAndUpdateSpatialObjectForScreenPosition(s,i.clientX,i.clientY),pressure:i.force});this.onUp(r),this._pointerIds[s]=-1}});c(this,"tempNearPlaneVector",new C);c(this,"tempFarPlaneVector",new C);c(this,"tempLookMatrix",new ce);this.context=t,this.context.post_render_callbacks.push(this.onEndOfFrame)}addEventListener(t,e,i){if(this._eventListeners[t]||(this._eventListeners[t]=[]),!e||typeof e!="function"){console.error("Invalid call to addEventListener: callback is required and must be a function!");return}i?i={...i}:i={};let s=0;(i==null?void 0:i.queue)!=null&&(s=i.queue);const r=this._eventListeners[t],o=r.find(a=>a.priority===s);o?o.listeners.push({callback:e,options:i}):(r.push({priority:s,listeners:[{callback:e,options:i}]}),r.sort((a,l)=>a.priority-l.priority))}removeEventListener(t,e,i){if(!this._eventListeners[t]||!e)return;const s=this._eventListeners[t];if((i==null?void 0:i.queue)!=null){const r=s.find(a=>a.priority===i.queue);if(!r)return;const o=r.listeners.findIndex(a=>a.callback===e);o>=0&&r.listeners.splice(o,1)}else for(const r of s){const o=r.listeners.findIndex(a=>a.callback===e);o>=0&&r.listeners.splice(o,1)}}dispatchEvent(t){var i,s,r,o;let e=!1;if(t instanceof km){const a=this._eventListeners[t.type];if(a)for(const l of a)for(let h=0;h<l.listeners.length;h++){const u=l.listeners[h];if((s=(i=u.options)==null?void 0:i.signal)!=null&&s.aborted){l.listeners.splice(h,1),h--;continue}u.options.once&&(l.listeners.splice(h,1),h--),u.callback(t)}}if(t instanceof tc){const a=this._eventListeners[t.type];if(a)for(const l of a){if(e)break;for(let h=0;h<l.listeners.length;h++){const u=l.listeners[h];if((o=(r=u.options)==null?void 0:r.signal)!=null&&o.aborted){l.listeners.splice(h,1),h--;continue}if(t.immediatePropagationStopped){e=!0,Hi&&console.log("immediatePropagationStopped",t.type);break}else t.propagationStopped&&(e=!0,Hi&&console.log("propagationStopped",t.type));u.options.once&&(l.listeners.splice(h,1),h--),u.callback(t)}}}}get mousePosition(){return this._pointerPositions[0]}get mousePositionRC(){return this._pointerPositionsRC[0]}get mouseDown(){return this._pointerDown[0]}get mouseUp(){return this._pointerUp[0]}get mouseClick(){return this._pointerClick[0]}get mouseDoubleClick(){return this._pointerDoubleClick[0]}get mousePressed(){return this._pointerPressed[0]}get mouseWheelChanged(){return this.getMouseWheelChanged(0)}setCursorPointer(){this._specialCursorTrigger+=1,this.context.domElement.style.cursor="pointer"}setCursorNormal(){this._specialCursorTrigger-=1,this._specialCursorTrigger=Math.max(0,this._specialCursorTrigger),this._specialCursorTrigger===0&&(this.context.domElement.style.cursor="default")}setPointerUsed(t,e=!0){if(t>=this._pointerUsed.length){if(t>=this._pointerIds.length)return;for(;this._pointerUsed.length<=t;)this._pointerUsed.push(!1)}this._pointerUsed[t]=e}getPointerUsed(t){return t>=this._pointerUsed.length?!1:this._pointerUsed[t]}getPointerPressedCount(){let t=0;for(let e=0;e<this._pointerPressed.length;e++)this._pointerPressed[e]&&t++;return t}getPointerPosition(t){return t>=this._pointerPositions.length?null:this._pointerPositions[t]}getPointerPositionLastFrame(t){return t>=this._pointerPositionsLastFrame.length?null:this._pointerPositionsLastFrame[t]}getPointerPositionDelta(t){return t>=this._pointerPositionsDelta.length?null:this._pointerPositionsDelta[t]}getPointerPositionRC(t){return t>=this._pointerPositionsRC.length?null:this._pointerPositionsRC[t]}getPointerDown(t){return t>=this._pointerDown.length?!1:this._pointerDown[t]}getPointerUp(t){return t>=this._pointerUp.length?!1:this._pointerUp[t]}getPointerPressed(t){return t>=this._pointerPressed.length?!1:this._pointerPressed[t]}getPointerClicked(t){return t>=this._pointerClick.length?!1:this._pointerClick[t]}getPointerDoubleClicked(t){return t>=this._pointerDoubleClick.length?!1:this._pointerDoubleClick[t]}getPointerDownTime(t){return t>=this._pointerDownTime.length?-1:this._pointerDownTime[t]}getPointerUpTime(t){return t>=this._pointerUpTime.length?-1:this._pointerUpTime[t]}getPointerLongPress(t){return t>=this._pointerDownTime.length?!1:this.getPointerPressed(t)&&this.context.time.time-this._pointerDownTime[t]>this._longPressTimeThreshold}getIsMouse(t){return t<0||t>=this._pointerTypes.length?!1:this._pointerTypes[t]===yc.Mouse}getIsTouch(t){return t<0||t>=this._pointerTypes.length?!1:this._pointerTypes[t]===yc.Touch}getTouchesPressedCount(){let t=0;for(let e=0;e<this._pointerPressed.length;e++)this._pointerPressed[e]&&this.getIsTouch(e)&&t++;return t}getMouseWheelChanged(t=0){return t>=this._mouseWheelChanged.length?!1:this._mouseWheelChanged[t]}getMouseWheelDeltaY(t=0){return t>=this._mouseWheelDeltaY.length?0:this._mouseWheelDeltaY[t]}getPointerEvent(t){if(!(t>=this._pointerEvent.length))return this._pointerEvent[t]??void 0}*foreachPointerId(t){for(let e=0;e<this._pointerTypes.length;e++)if(this._pointerIsActive(e)){if(t!==void 0){const i=this._pointerTypes[e];if(Array.isArray(t)){let s=!1;for(const r of t)if(i===r){s=!0;break}if(!s)continue}else if(t!==i)continue}yield e}}*foreachTouchId(){for(let t=0;t<this._pointerTypes.length;t++)this._pointerTypes[t]===yc.Touch&&this._pointerIsActive[t]&&(yield t)}_pointerIsActive(t){return t<0?!1:this._pointerPressed[t]||this._pointerDown[t]||this._pointerUp[t]}onDownButton(t,e){let i=this._pressedStack.get(t);i||(i=[],this._pressedStack.set(t,i)),i.push(e)}onReleaseButton(t,e){const i=this._pressedStack.get(t);if(!i)return;const s=i.indexOf(e);s>=0&&i.splice(s,1)}getFirstPressedButtonForPointer(t){const e=this._pressedStack.get(t);if(e)return e[0]}getLatestPressedButtonForPointer(t){const e=this._pressedStack.get(t);if(e)return e[e.length-1]}getKeyDown(){for(const t in this.keysPressed){const e=this.keysPressed[t];if(e.startFrame===this.context.time.frameCount)return e.key}return null}getKeyPressed(){for(const t in this.keysPressed){const e=this.keysPressed[t];if(e.pressed)return e.key}return null}isKeyDown(t){var i;if(!this.context.application.isVisible||!this.context.application.hasFocus)return!1;const e=this.getCodeForCommonKeyName(t);if(e!==null){for(const s of e)if(this.isKeyDown(s))return!0;return!1}return((i=this.keysPressed[t])==null?void 0:i.startFrame)===this.context.time.frameCount&&this.keysPressed[t].pressed}isKeyUp(t){var i;if(!this.context.application.isVisible||!this.context.application.hasFocus)return!1;const e=this.getCodeForCommonKeyName(t);if(e!==null){for(const s of e)if(this.isKeyUp(s))return!0;return!1}return((i=this.keysPressed[t])==null?void 0:i.frame)===this.context.time.frameCount&&!this.keysPressed[t].pressed}isKeyPressed(t){var i;if(!this.context.application.isVisible||!this.context.application.hasFocus)return!1;const e=this.getCodeForCommonKeyName(t);if(e!==null){for(const s of e)if(this.isKeyPressed(s))return!0;return!1}return(i=this.keysPressed[t])==null?void 0:i.pressed}getCodeForCommonKeyName(t){if(t.length===1){if(t>="0"&&t<="9")return["Digit"+t];if(t>="a"&&t<="z")return["Key"+t.toUpperCase()];if(t==" ")return["Space"]}switch(t){case"shift":case"Shift":return["ShiftLeft","ShiftRight"];case"control":case"Control":return["ControlLeft","ControlRight"];case"alt":case"Alt":return["AltLeft","AltRight"]}return null}createInputEvent(t){switch(t.type){case at.PointerDown:Hi&&Ci("Create Pointer down"),this.onDownButton(t.deviceIndex,t.button),this.onDown(t);break;case at.PointerMove:Hi&&Ci("Create Pointer move"),this.onMove(t);break;case at.PointerUp:Hi&&Ci("Create Pointer up"),this.onUp(t),this.onReleaseButton(t.deviceIndex,t.button);break}}convertScreenspaceToRaycastSpace(t){t.x=(t.x-this.context.domX)/this.context.domWidth*2-1,t.y=-((t.y-this.context.domY)/this.context.domHeight)*2+1}bindEvents(){this.unbindEvents(),this._htmlEventSource=this.context.renderer.domElement,window.addEventListener("contextmenu",this.onContextMenu),this._htmlEventSource.addEventListener("pointerdown",this.onPointerDown,{passive:!0}),window.addEventListener("pointermove",this.onPointerMove,{passive:!0,capture:!0}),window.addEventListener("pointerup",this.onPointerUp,{passive:!0}),window.addEventListener("pointercancel",this.onPointerCancel,{passive:!0}),window.addEventListener("touchstart",this.onTouchStart,{passive:!0}),window.addEventListener("touchmove",this.onTouchMove,{passive:!0}),window.addEventListener("touchend",this.onTouchEnd,{passive:!0}),this._htmlEventSource.addEventListener("wheel",this.onMouseWheel,{passive:!0}),window.addEventListener("wheel",this.onWheelWindow,{passive:!0}),window.addEventListener("keydown",this.onKeyDown,!1),window.addEventListener("keypress",this.onKeyPressed,!1),window.addEventListener("keyup",this.onKeyUp,!1),window.addEventListener("blur",this.onLostFocus)}unbindEvents(){var t,e;window.removeEventListener("contextmenu",this.onContextMenu),(t=this._htmlEventSource)==null||t.removeEventListener("pointerdown",this.onPointerDown),window.removeEventListener("pointermove",this.onPointerMove),window.removeEventListener("pointerup",this.onPointerUp),window.removeEventListener("pointercancel",this.onPointerCancel),(e=this._htmlEventSource)==null||e.removeEventListener("wheel",this.onMouseWheel,!1),window.removeEventListener("wheel",this.onWheelWindow,!1),window.removeEventListener("keydown",this.onKeyDown,!1),window.removeEventListener("keypress",this.onKeyPressed,!1),window.removeEventListener("keyup",this.onKeyUp,!1),window.removeEventListener("blur",this.onLostFocus)}dispose(){const t=this.context.post_render_callbacks.indexOf(this.onEndOfFrame);t>=0&&this.context.post_render_callbacks.splice(t,1),this.unbindEvents()}canReceiveInput(t){var e;return t.target===((e=this.context.renderer)==null?void 0:e.domElement)||t.target===this.context.domElement||this.context.isInAR||this.context.isInAR&&t.target===document.body&&md()?!0:(Hi&&console.warn("CanReceiveInput:False for",t.target),!1)}getPointerId(t,e){return t.pointerType==="mouse"?0+(e??t.button):this.getPointerIndex(t.pointerId)}getButtonName(t){const e=t.button;if(t.pointerType==="mouse")switch(e){case 0:return"left";case 1:return"middle";case 2:return"right"}return"unknown"}getAndUpdateSpatialObjectForScreenPosition(t,e,i){let s=this._pointerSpace[t];s||(s=new re,this._pointerSpace[t]=s),this._pointerSpace[t]=s;const r=this.context.mainCamera;if(r){const o=this.tempNearPlaneVector.set(e,i,-1);this.convertScreenspaceToRaycastSpace(o);const a=this.tempFarPlaneVector.set(o.x,o.y,1);o.unproject(r),a.unproject(r),this.tempLookMatrix.lookAt(a,o,r.worldUp),s.position.set(o.x,o.y,o.z),s.quaternion.setFromRotationMatrix(this.tempLookMatrix)}return s}isInRect(t){if(this.context.isInXR)return!0;const e=this.context.domElement.getBoundingClientRect(),i=t.clientX,s=t.clientY,r=i>=e.x&&i<=e.right&&s>=e.y&&s<=e.bottom;return Hi&&!r&&console.log("Not in rect",e,i,s),r}onDown(t){const e=t.pointerId;if(this.getPointerPressed(e)&&console.warn(`pointerId is already pressed: ${e}`,Hi?t:""),Hi&&console.log(t.pointerType,"DOWN",e),!!this.isInRect(t)){for(this.setPointerState(e,this._pointerPressed,!0),this.setPointerState(e,this._pointerDown,!0),this.setPointerStateT(e,this._pointerEvent,t.source);e>=this._pointerTypes.length;)this._pointerTypes.push(t.pointerType);for(this._pointerTypes[e]=t.pointerType;e>=this._pointerPositionDown.length;)this._pointerPositionDown.push(new ae);for(this._pointerPositionDown[e].set(t.clientX,t.clientY);e>=this._pointerPositions.length;)this._pointerPositions.push(new ae);this._pointerPositions[e].set(t.clientX,t.clientY),e>=this._pointerDownTime.length&&this._pointerDownTime.push(0),this._pointerDownTime[e]=this.context.time.time,this.updatePointerPosition(t),this.onDispatchEvent(t)}}onMove(t){const e=t.pointerId,i=this.getPointerPressed(e);i===!1&&!this.isInRect(t)||t.pointerType===yc.Touch&&!i||(this.updatePointerPosition(t),this.setPointerStateT(e,this._pointerEvent,t.source),this.onDispatchEvent(t))}onUp(t){const e=t.pointerId;if(!this.getPointerPressed(e)){Hi&&console.log(t.pointerType,"UP",e,"was not down");return}for(Hi&&console.log(t.pointerType,"UP",e),this.setPointerState(e,this._pointerPressed,!1),this.setPointerStateT(e,this._pointerEvent,t.source),this.setPointerState(e,this._pointerUp,!0);e>=this._pointerUsed.length;)this._pointerUsed.push(!1);if(this.setPointerState(e,this._pointerUsed,!1),this.updatePointerPosition(t),!this._pointerPositionDown[e]){Hi&&Yt("Received pointer up event without matching down event for button: "+e),console.warn("Received pointer up event without matching down event for button: "+e);return}const s=t.clientX-this._pointerPositionDown[e].x,r=t.clientY-this._pointerPositionDown[e].y;if(e>=this._pointerUpTime.length&&this._pointerUpTime.push(-99),Math.abs(s)<5&&Math.abs(r)<5){Hi&&console.log("CLICK",e),this.setPointerState(e,this._pointerClick,!0),t.isClick=!0;const o=this._pointerUpTime[e],a=this.context.time.time-o;a<this._doubleClickTimeThreshold&&a>0&&(this.setPointerState(e,this._pointerDoubleClick,!0),t.isDoubleClick=!0)}this._pointerUpTime[e]=this.context.time.time,this.onDispatchEvent(t)}updatePointerPosition(t){const e=t.pointerId;for(;e>=this._pointerPositions.length;)this._pointerPositions.push(new ae);for(;e>=this._pointerPositionsLastFrame.length;)this._pointerPositionsLastFrame.push(new ae);for(;e>=this._pointerPositionsDelta.length;)this._pointerPositionsDelta.push(new ae);const i=this._pointerPositionsLastFrame[e];i.copy(this._pointerPositions[e]);const s=this._pointerPositionsDelta[e];let r=t.clientX-i.x,o=t.clientY-i.y;if(t.source instanceof MouseEvent||t.source instanceof TouchEvent){const u=t.source;r===0&&u.movementX!==0&&(r=u.movementX||0),o===0&&u.movementY!==0&&(o=u.movementY||0)}s.x+=r,s.y+=o,this._pointerPositions[e].x=t.clientX,this._pointerPositions[e].y=t.clientY;const a=t.clientX,l=t.clientY;for(;e>=this._pointerPositionsRC.length;)this._pointerPositionsRC.push(new ae);const h=this._pointerPositionsRC[e];h.set(a,l),this.convertScreenspaceToRaycastSpace(h)}getPointerIndex(t){let e=-1;for(let i=0;i<this._pointerIds.length;i++){if(this._pointerIds[i]===t)return i;e===-1&&this._pointerIds[i]===-1&&(e=i)}return e!==-1?(this._pointerIds[e]=t,e):(Hi&&console.log("PUSH pointerId:",t),this._pointerIds.push(t),this._pointerIds.length-1)}setPointerState(t,e,i){e[t]=i}setPointerStateT(t,e,i){return e[t]=i,i}onDispatchEvent(t){const e=Ne.Current;try{Ne.Current=this.context,this.dispatchEvent(t)}finally{Ne.Current=e}}}const gv=new ce().makeRotationY(Math.PI),Qr=new ne().setFromAxisAngle(new C(0,1,0),Math.PI),mG=N("debugwebxr");class AG{constructor(){c(this,"priority",-1e5);c(this,"gameObject");if(this.gameObject=new re,this.gameObject.name="Implicit XR Rig",mG){const t=lC(16733661);t.position.y+=.5,this.gameObject.add(t)}}isXRRig(){return!0}get isActive(){return this.gameObject.visible}}const Xl=N("debugwebxr"),Om=N("debugcustomgesture"),vG="https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@1.0/dist/profiles",yG="generic-trigger";class WM{constructor(t,e,i){c(this,"xr");c(this,"inputSource");c(this,"index",0);c(this,"emitEvents",!0);c(this,"_connected",!0);c(this,"_isTracking",!1);c(this,"_hitTestSource");c(this,"_hasSelectEvent",!1);c(this,"_handJointPoses",new Map);c(this,"_gripPosition",new C);c(this,"_gripQuaternion",new ne);c(this,"_linearVelocity",new C);c(this,"_rayPosition",new C);c(this,"_rayQuaternion",new ne);c(this,"_gripWorldPosition",new C);c(this,"_gripWorldQuaternion",new ne);c(this,"_rayWorldPosition",new C);c(this,"_rayWorldQuaternion",new ne);c(this,"_ray");c(this,"_object");c(this,"_debugAxesHelper",new Do(.2));c(this,"_needleGamepadButtons",{});c(this,"_buttonMap",new Map);c(this,"_motioncontroller");c(this,"_layout");c(this,"getMotionController");c(this,"_selectButtonIndex");c(this,"_squeezeButtonIndex");c(this,"onSelectStart",t=>{var s,r,o,a;if(this.inputSource!==t.inputSource)return;this.onUpdateFrame(t.frame),this._hasSelectEvent=!0;const e=(s=this._layout)==null?void 0:s.selectComponentId,i=(a=(o=(r=this._layout)==null?void 0:r.components[e])==null?void 0:o.gamepadIndices)==null?void 0:a.button;i!==void 0&&(this._selectButtonIndex=i),!Om&&(Xl&&De.DrawDirection(this.rayWorldPosition,Pi(0,.01,1).applyQuaternion(this.rayWorldQuaternion),16711680,10),this.emitPointerEvent(at.PointerDown,this._selectButtonIndex||0,"xr-standard-trigger",!0,t))});c(this,"onSelectEnd",t=>{Om||this.inputSource===t.inputSource&&this.emitPointerEvent(at.PointerUp,this._selectButtonIndex||0,"xr-standard-trigger",!0,t)});c(this,"onSequeezeStart",t=>{var e,i,s;this.inputSource===t.inputSource&&(this._squeezeButtonIndex=(s=(i=(e=this._layout)==null?void 0:e.components["xr-standard-squeeze"])==null?void 0:i.gamepadIndices)==null?void 0:s.button,this._squeezeButtonIndex!==void 0&&(Xl&&De.DrawDirection(this.rayWorldPosition,Pi(0,.01,1).applyQuaternion(this.rayWorldQuaternion),255,10),this.emitPointerEvent(at.PointerDown,this._squeezeButtonIndex||0,"xr-standard-squeeze",!0,t)))});c(this,"onSequeezeEnd",t=>{this.inputSource===t.inputSource&&this._squeezeButtonIndex!==void 0&&this.emitPointerEvent(at.PointerUp,this._squeezeButtonIndex||0,"xr-standard-squeeze",!0,t)});c(this,"states",{});c(this,"_didMoveLastFrame",!1);c(this,"_lastPointerMovePosition",new C);c(this,"_lastPointerMoveQuaternion",new ne);c(this,"pointerInit");var s,r,o;this.xr=t,this.inputSource=e,this.index=i,this._object=new re,Xl&&this._object.add(this._debugAxesHelper),this.xr.context.scene.add(this._object),this._ray=new Lc,this.pointerInit={origin:this,pointerType:this.hand?"hand":"controller",deviceIndex:this.index,pointerId:-1,mode:this.inputSource.targetRayMode,ray:this._ray,device:this._object,buttonName:"none"},this.initialize(),this.subscribeEvents(),this.xr.mode==="immersive-ar"&&this.inputSource.targetRayMode==="tracked-pointer"&&((o=(r=(s=this.xr.session).requestHitTestSourceForTransientInput)==null?void 0:r.call(s,{profile:this.inputSource.profiles[0],offsetRay:new XRRay}))==null||o.then(a=>this._hitTestSource=a))}get context(){return this.xr.context}get connected(){return this._connected}get isTracking(){return this._isTracking}get gamepad(){return this.inputSource.gamepad}get isHand(){return this.inputSource.hand!=null}get hand(){return this.inputSource.hand}get handObject(){return this.context.renderer.xr.getHand(this.index)}get profiles(){return this.inputSource.profiles}get layout(){return this._layout}get targetRayMode(){return this.inputSource.targetRayMode}get targetRaySpace(){return this.inputSource.targetRaySpace}get gripSpace(){return this.inputSource.gripSpace}get side(){return this.inputSource.handedness}get isRight(){return this.side==="right"}get isLeft(){return this.side==="left"}get hitTestSource(){return this._hitTestSource}get hasSelectEvent(){return this._hasSelectEvent}getHitTest(){return this.xr.getHitTest(this)}getHandJointPose(t){var i,s;if(!this.hand||!((i=this.xr.frame)!=null&&i.getJointPose)||!this.xr.referenceSpace)return null;let e=(s=this._handJointPoses)==null?void 0:s.get(t);return e||(e=this.xr.frame.getJointPose(t,this.xr.referenceSpace),e&&this._handJointPoses.set(t,e),e)}get gripPosition(){return Pi(this._gripPosition).applyMatrix4(gv)}get gripQuaternion(){return Gu(this._gripQuaternion).premultiply(Qr)}get gripLinearVelocity(){return Pi(this._linearVelocity).applyQuaternion(Qr)}get rayPosition(){return Pi(this._rayPosition).applyMatrix4(gv)}get rayQuaternion(){return Gu(this._rayQuaternion).premultiply(Qr)}get gripWorldPosition(){return Pi(this._gripWorldPosition)}get gripWorldQuaternion(){return Gu(this._gripWorldQuaternion)}get rayWorldPosition(){return Pi(this._rayWorldPosition)}updateRayWorldPosition(){var e;const t=(e=this.xr.context.mainCamera)==null?void 0:e.parent;this._rayWorldPosition.copy(this._rayPosition),t&&this._rayWorldPosition.applyMatrix4(t.matrixWorld)}get rayWorldQuaternion(){return Gu(this._rayWorldQuaternion)}updateRayWorldQuaternion(){var i;const t=(i=this.xr.context.mainCamera)==null?void 0:i.parent,e=t?Nt(t):void 0;this._rayWorldQuaternion.copy(this._rayQuaternion).multiply(Qr),e&&this._rayWorldQuaternion.premultiply(e)}get ray(){return this._ray.origin.copy(this.rayWorldPosition),this._ray.direction.copy(Pi(0,0,1).applyQuaternion(this.rayWorldQuaternion)),this._ray}get object(){return this._object}async getModelUrl(){var t;return(t=this.getMotionController)==null?void 0:t.then(e=>(e==null?void 0:e.assetUrl)||null)}onUpdate(t){this.onUpdateFrame(t),this.updateInputEvents(),this.onUpdateMove()}onRenderDebug(){var s;De.DrawWireSphere(this.rayWorldPosition,.02),De.DrawDirection(this.rayWorldPosition,Pi(0,0,10).applyQuaternion(this.rayWorldQuaternion));const t=this.gripWorldPosition.sub(this.object.worldForward.multiplyScalar(.1)),e=this.inputSource.profiles.join(`
`);let i=`Controller[${this.index}] ${this.side}
C:${this.connected?"yes":"no"} T:${this.isTracking?"yes":"no"} Hand:${this.inputSource.hand?"yes":"no"}`;this.inputSource.hand&&(i+=`
Pinch: ${(s=this.getGesture("pinch"))==null?void 0:s.value.toFixed(3)}`),i+=`
`+e,De.DrawLabel(t,i,.01)}onUpdateFrame(t){var o,a,l;if(this._handJointPoses.clear(),!this.xr.referenceSpace){this._isTracking=!1;return}const e=t.getPose(this.inputSource.targetRaySpace,this.xr.referenceSpace);if(this._isTracking=e!=null,e){const h=e.transform;this._rayPosition.set(h.position.x,h.position.y,h.position.z),this._rayQuaternion.set(h.orientation.x,h.orientation.y,h.orientation.z,h.orientation.w)}if(this.inputSource.gripSpace){const h=t.getPose(this.inputSource.gripSpace,this.xr.referenceSpace);if(h){const u=h.transform;if(this._gripPosition.set(u.position.x,u.position.y,u.position.z),this._gripQuaternion.set(u.orientation.x,u.orientation.y,u.orientation.z,u.orientation.w),"linearVelocity"in h&&h.linearVelocity){const d=h.linearVelocity;this._linearVelocity.set(d.x,d.y,d.z)}}}(o=this.xr.context.mainCamera)!=null&&o.parent&&this._object.parent!==((a=this.xr.context.mainCamera)==null?void 0:a.parent)&&this.xr.context.mainCamera.parent.add(this._object);const i=this.hand;if(i){let h=!1;const u=i.get("wrist"),d=u&&this.getHandJointPose(u);if(d){h=!0;const g=d.transform.position,m=d.transform.orientation;this._object.position.set(g.x,g.y,g.z),this._object.quaternion.set(m.x,m.y,m.z,m.w).multiply(Qr)}h||(this._object.position.copy(this._rayPosition),this._object.quaternion.copy(this._rayQuaternion).multiply(Qr));const f=i.get("middle-finger-metacarpal"),p=f&&this.getHandJointPose(f);if(p){const g=p.transform.position,m=p.transform.orientation;this._gripPosition.set(g.x,g.y,g.z),this._gripQuaternion.set(m.x,m.y,m.z,m.w)}}else this.inputSource.gripSpace&&this.targetRayMode==="transient-pointer"?(this._object.position.copy(this._gripPosition),this._object.quaternion.copy(this._gripQuaternion).multiply(Qr)):(this._object.position.copy(this._rayPosition),this._object.quaternion.copy(this._rayQuaternion).multiply(Qr));const s=(l=this.xr.context.mainCamera)==null?void 0:l.parent,r=s?Nt(s):void 0;this._gripWorldPosition.copy(this._gripPosition),s&&this._gripWorldPosition.applyMatrix4(s.matrixWorld),this._gripWorldQuaternion.copy(this._gripQuaternion),this._gripWorldQuaternion.multiply(Qr),r&&this._gripWorldQuaternion.premultiply(r),this.updateRayWorldPosition(),this.updateRayWorldQuaternion()}onDisconnected(){this._connected=!1,Xl&&console.warn("Controller disconnected",this.index);for(const t of this._object.children)this.xr.context.scene.attach(t);this._object.removeFromParent(),this._debugAxesHelper.removeFromParent(),this.unsubscribeEvents()}getButton(t){var i;if(!this._layout)return;switch(t){case"primary-button":if(this.isLeft)t="x-button";else if(this.isRight)t="a-button";else return;break;case"primary":return this.toNeedleGamepadButton(0)}if(this._buttonMap.has(t))return this.toNeedleGamepadButton(this._buttonMap.get(t));const e=(i=this._layout)==null?void 0:i.components[t];if(e!=null&&e.gamepadIndices)switch(e.type){case"button":case"squeeze":if(this.inputSource.gamepad){const s=e.gamepadIndices.button;return this._buttonMap.set(t,s),this.toNeedleGamepadButton(s)}break;default:console.warn("Unsupported component type",e.type);break}this._buttonMap.set(t,void 0)}getGesture(t){const e=this.states[t];if(!e)return null;this.states[t]=e;const i=this._needleGamepadButtons[t]||new D1;return i.pressed=e.pressed,i.value=e.value,i.isDown=e.isDown,i.isUp=e.isUp,this._needleGamepadButtons[t]=i,i}toNeedleGamepadButton(t){var r,o;if(!((r=this.inputSource.gamepad)!=null&&r.buttons))return;const e=(o=this.inputSource.gamepad)==null?void 0:o.buttons[t],i=this.states[t],s=this._needleGamepadButtons[t]||new D1;return e&&(s.pressed=e.pressed,s.value=e.value,s.touched=e.touched),i&&(s.isDown=i.isDown,s.isUp=i.isUp),this._needleGamepadButtons[t]=s,s}getStick(t){var i,s,r,o,a,l,h;if(!this._layout)return{x:0,y:0,z:0};if(t==="primary"){const u=((i=this.inputSource.gamepad)==null?void 0:i.axes[0])||0,d=((s=this.inputSource.gamepad)==null?void 0:s.axes[1])||0,f=((r=this.inputSource.gamepad)==null?void 0:r.buttons[3].value)||0;return{x:u,y:d,z:f}}const e=(o=this._layout)==null?void 0:o.components[t];if(e!=null&&e.gamepadIndices)switch(e.type){case"thumbstick":if(this.inputSource.gamepad){const u=e.gamepadIndices.xAxis,d=e.gamepadIndices.yAxis;let f=(a=this.inputSource.gamepad)==null?void 0:a.axes[u],p=(l=this.inputSource.gamepad)==null?void 0:l.axes[d];f*=-1,p*=-1;const g=e.gamepadIndices.button,m=(h=this.inputSource.gamepad)==null?void 0:h.buttons[g].value;return{x:f,y:p,z:m}}}return{x:0,y:0,z:0}}initialize(){if(this._hasSelectEvent=this.profiles.includes("generic-hand-select")||this.profiles.some(t=>t.startsWith("generic-trigger")),!this._layout){if(this.inputSource.targetRayMode==="transient-pointer")return;const t=aG(this.inputSource,vG,yG);this.getMotionController=t.then(e=>{var r;if(!this.connected)return null;this._motioncontroller=new dG(this.inputSource,e.profile,e.assetPath||"");const s=e.profile.layouts[this.inputSource.handedness];if(this._layout=s,this._layout&&!((r=this._layout.gamepad)!=null&&r.length)){this._layout.gamepad=[];for(const o in this._layout.components){const a=this._layout.components[o];this._layout.gamepad[a.gamepadIndices.button]=o}}return this._motioncontroller}).catch(e=>(this.inputSource&&console.warn("Couldn't initialize motion controller profile for ",this.inputSource,e),null))}}subscribeEvents(){this.xr.session.addEventListener("selectstart",this.onSelectStart),this.xr.session.addEventListener("selectend",this.onSelectEnd),this.xr.session.addEventListener("squeezestart",this.onSequeezeStart),this.xr.session.addEventListener("squeezeend",this.onSequeezeEnd)}unsubscribeEvents(){this.xr.session.removeEventListener("selectstart",this.onSelectStart),this.xr.session.removeEventListener("selectend",this.onSelectEnd),this.xr.session.removeEventListener("squeezestart",this.onSequeezeStart),this.xr.session.removeEventListener("squeezeend",this.onSequeezeEnd)}updateInputEvents(){var t,e;if((t=this.gamepad)!=null&&t.buttons)for(let i=0;i<this.gamepad.buttons.length;i++){const s=this.gamepad.buttons[i],r=this.states[i]||new M1;let o=null;s.pressed&&!r.pressed?(o="pointerdown",r.isDown=!0,r.isUp=!1):!s.pressed&&r.pressed?(o="pointerup",r.isDown=!1,r.isUp=!0):(r.isDown=!1,r.isUp=!1),r.value=s.value,r.pressed=s.pressed,this.states[i]=r;const a=i!==this._selectButtonIndex&&i!==this._squeezeButtonIndex;if(o!=null&&a){const l=(e=this._layout)==null?void 0:e.gamepad[i];(Xl||Om)&&console.log("Emitting pointer event",o,i,l,s.value,this.gamepad,this._layout),this.emitPointerEvent(o,i,l??"none",!1,null,s.value)}}if(this.hand){const i=this.handObject;if(i){const s=i.joints["index-finger-tip"],r=i.joints["thumb-tip"];if(s&&r){const l=s.position.distanceTo(r.position),h=this.states.pinch||new M1;h.value=l;const u=l<.02-.01,d=l>.02+.01;u&&!h.pressed?(Om&&console.log("pinch start",l),h.isDown=!0,h.isUp=!1,h.pressed=!0):d&&h.pressed?(h.isDown=!1,h.isUp=!0,h.pressed=!1):(h.isDown=!1,h.isUp=!1),this.states.pinch=h}}}}onUpdateMove(){var i,s;let t=!1;if(this._lastPointerMovePosition.distanceTo(this.gripWorldPosition)>.02&&(t=!0),t||this._lastPointerMoveQuaternion.angleTo(this.gripWorldQuaternion)>.02&&(t=!0),t){this._didMoveLastFrame=!0,this._lastPointerMovePosition.copy(this.gripWorldPosition),this._lastPointerMoveQuaternion.copy(this.gripWorldQuaternion),Xl&&De.DrawLabel(this.rayWorldPosition.add(this.object.worldForward.multiplyScalar(.1)),"move",.01);let r=this.xr.context.input.getFirstPressedButtonForPointer(this.index);r===void 0&&(r=0);const o=(s=(i=this.gamepad)==null?void 0:i.buttons[r])==null?void 0:s.value;this.emitPointerEvent("pointermove",r,"none",!1,null,o)}else this._didMoveLastFrame=!1}emitPointerEvent(t,e,i,s,r=null,o){if(!this.emitEvents){Xl&&t!==at.PointerMove&&console.warn("Pointer events are disabled for this controller",this.index,t,e);return}if(this.xr.mode==="immersive-vr"||this.xr.isPassThrough){this.pointerInit.origin=this,this.pointerInit.pointerId=this.index*10+e,this.pointerInit.pointerType=this.hand?"hand":"controller",this.pointerInit.button=e,this.pointerInit.buttonName=i,this.pointerInit.isPrimary=s,this.pointerInit.mode=this.inputSource.targetRayMode,this.pointerInit.ray=this.ray,this.pointerInit.device=this.object,this.pointerInit.pressure=o;const a=Ne.Current;Ne.Current=this.xr.context,Xl&&t!=="pointermove"&&console.warn("Pointer event",t,e,i,{...this.pointerInit}),this.xr.context.input.createInputEvent(new tc(t,r,this.pointerInit)),Ne.Current=a}}}class M1{constructor(){c(this,"isDown",!1);c(this,"isUp",!1);c(this,"pressed",!1);c(this,"value",0)}}class D1{constructor(){c(this,"touched",!1);c(this,"pressed",!1);c(this,"value",0);c(this,"isDown",!1);c(this,"isUp",!1)}}const xp=new Map,k1=new WeakSet;function Uc(n,t){xp.has(t)||xp.set(t,new Array),xp.get(t).push(n)}function Nc(n,t){const e=xp.get(t);if(e){const i=e.indexOf(n);i>=0&&e.splice(i,1)}}function Yo(n,t){const e=xp.get(t);if(e&&e.length>0){const i=e;if(t===ze.Start){if(k1.has(n))return;k1.add(n)}bG(n,i)}}const Lm=new Array;function bG(n,t){Lm.length=0;for(let e=0;e<t.length;e++)Lm.push(t[e]);for(let e=0;e<Lm.length;e++){const i=Lm[e];xh(i,n)}}const Ib=2,va=4,ul=4,cC=4,rc=new Int32Array(2),O1=new Float32Array(rc.buffer),L1=new Float64Array(rc.buffer),Fm=new Uint16Array(new Uint8Array([1,0]).buffer)[0]===1;class Al{constructor(t,e){this.low=t|0,this.high=e|0}static create(t,e){return t==0&&e==0?Al.ZERO:new Al(t,e)}toFloat64(){return(this.low>>>0)+this.high*4294967296}equals(t){return this.low==t.low&&this.high==t.high}}Al.ZERO=new Al(0,0);var uw;(function(n){n[n.UTF8_BYTES=1]="UTF8_BYTES",n[n.UTF16_STRING=2]="UTF16_STRING"})(uw||(uw={}));class Ag{constructor(t){this.bytes_=t,this.position_=0}static allocate(t){return new Ag(new Uint8Array(t))}clear(){this.position_=0}bytes(){return this.bytes_}position(){return this.position_}setPosition(t){this.position_=t}capacity(){return this.bytes_.length}readInt8(t){return this.readUint8(t)<<24>>24}readUint8(t){return this.bytes_[t]}readInt16(t){return this.readUint16(t)<<16>>16}readUint16(t){return this.bytes_[t]|this.bytes_[t+1]<<8}readInt32(t){return this.bytes_[t]|this.bytes_[t+1]<<8|this.bytes_[t+2]<<16|this.bytes_[t+3]<<24}readUint32(t){return this.readInt32(t)>>>0}readInt64(t){return new Al(this.readInt32(t),this.readInt32(t+4))}readUint64(t){return new Al(this.readUint32(t),this.readUint32(t+4))}readFloat32(t){return rc[0]=this.readInt32(t),O1[0]}readFloat64(t){return rc[Fm?0:1]=this.readInt32(t),rc[Fm?1:0]=this.readInt32(t+4),L1[0]}writeInt8(t,e){this.bytes_[t]=e}writeUint8(t,e){this.bytes_[t]=e}writeInt16(t,e){this.bytes_[t]=e,this.bytes_[t+1]=e>>8}writeUint16(t,e){this.bytes_[t]=e,this.bytes_[t+1]=e>>8}writeInt32(t,e){this.bytes_[t]=e,this.bytes_[t+1]=e>>8,this.bytes_[t+2]=e>>16,this.bytes_[t+3]=e>>24}writeUint32(t,e){this.bytes_[t]=e,this.bytes_[t+1]=e>>8,this.bytes_[t+2]=e>>16,this.bytes_[t+3]=e>>24}writeInt64(t,e){this.writeInt32(t,e.low),this.writeInt32(t+4,e.high)}writeUint64(t,e){this.writeUint32(t,e.low),this.writeUint32(t+4,e.high)}writeFloat32(t,e){O1[0]=e,this.writeInt32(t,rc[0])}writeFloat64(t,e){L1[0]=e,this.writeInt32(t,rc[Fm?0:1]),this.writeInt32(t+4,rc[Fm?1:0])}getBufferIdentifier(){if(this.bytes_.length<this.position_+va+ul)throw new Error("FlatBuffers: ByteBuffer is too short to contain an identifier.");let t="";for(let e=0;e<ul;e++)t+=String.fromCharCode(this.readInt8(this.position_+va+e));return t}__offset(t,e){const i=t-this.readInt32(t);return e<this.readInt16(i)?this.readInt16(i+e):0}__union(t,e){return t.bb_pos=e+this.readInt32(e),t.bb=this,t}__string(t,e){t+=this.readInt32(t);const i=this.readInt32(t);let s="",r=0;if(t+=va,e===uw.UTF8_BYTES)return this.bytes_.subarray(t,t+i);for(;r<i;){let o;const a=this.readUint8(t+r++);if(a<192)o=a;else{const l=this.readUint8(t+r++);if(a<224)o=(a&31)<<6|l&63;else{const h=this.readUint8(t+r++);if(a<240)o=(a&15)<<12|(l&63)<<6|h&63;else{const u=this.readUint8(t+r++);o=(a&7)<<18|(l&63)<<12|(h&63)<<6|u&63}}}o<65536?s+=String.fromCharCode(o):(o-=65536,s+=String.fromCharCode((o>>10)+55296,(o&1024-1)+56320))}return s}__union_with_string(t,e){return typeof t=="string"?this.__string(e):this.__union(t,e)}__indirect(t){return t+this.readInt32(t)}__vector(t){return t+this.readInt32(t)+va}__vector_len(t){return this.readInt32(t+this.readInt32(t))}__has_identifier(t){if(t.length!=ul)throw new Error("FlatBuffers: file identifier must be length "+ul);for(let e=0;e<ul;e++)if(t.charCodeAt(e)!=this.readInt8(this.position()+va+e))return!1;return!0}createLong(t,e){return Al.create(t,e)}createScalarList(t,e){const i=[];for(let s=0;s<e;++s)t(s)!==null&&i.push(t(s));return i}createObjList(t,e){const i=[];for(let s=0;s<e;++s){const r=t(s);r!==null&&i.push(r.unpack())}return i}}class Lg{constructor(t){this.minalign=1,this.vtable=null,this.vtable_in_use=0,this.isNested=!1,this.object_start=0,this.vtables=[],this.vector_num_elems=0,this.force_defaults=!1,this.string_maps=null;let e;t?e=t:e=1024,this.bb=Ag.allocate(e),this.space=e}clear(){this.bb.clear(),this.space=this.bb.capacity(),this.minalign=1,this.vtable=null,this.vtable_in_use=0,this.isNested=!1,this.object_start=0,this.vtables=[],this.vector_num_elems=0,this.force_defaults=!1,this.string_maps=null}forceDefaults(t){this.force_defaults=t}dataBuffer(){return this.bb}asUint8Array(){return this.bb.bytes().subarray(this.bb.position(),this.bb.position()+this.offset())}prep(t,e){t>this.minalign&&(this.minalign=t);const i=~(this.bb.capacity()-this.space+e)+1&t-1;for(;this.space<i+t+e;){const s=this.bb.capacity();this.bb=Lg.growByteBuffer(this.bb),this.space+=this.bb.capacity()-s}this.pad(i)}pad(t){for(let e=0;e<t;e++)this.bb.writeInt8(--this.space,0)}writeInt8(t){this.bb.writeInt8(this.space-=1,t)}writeInt16(t){this.bb.writeInt16(this.space-=2,t)}writeInt32(t){this.bb.writeInt32(this.space-=4,t)}writeInt64(t){this.bb.writeInt64(this.space-=8,t)}writeFloat32(t){this.bb.writeFloat32(this.space-=4,t)}writeFloat64(t){this.bb.writeFloat64(this.space-=8,t)}addInt8(t){this.prep(1,0),this.writeInt8(t)}addInt16(t){this.prep(2,0),this.writeInt16(t)}addInt32(t){this.prep(4,0),this.writeInt32(t)}addInt64(t){this.prep(8,0),this.writeInt64(t)}addFloat32(t){this.prep(4,0),this.writeFloat32(t)}addFloat64(t){this.prep(8,0),this.writeFloat64(t)}addFieldInt8(t,e,i){(this.force_defaults||e!=i)&&(this.addInt8(e),this.slot(t))}addFieldInt16(t,e,i){(this.force_defaults||e!=i)&&(this.addInt16(e),this.slot(t))}addFieldInt32(t,e,i){(this.force_defaults||e!=i)&&(this.addInt32(e),this.slot(t))}addFieldInt64(t,e,i){(this.force_defaults||!e.equals(i))&&(this.addInt64(e),this.slot(t))}addFieldFloat32(t,e,i){(this.force_defaults||e!=i)&&(this.addFloat32(e),this.slot(t))}addFieldFloat64(t,e,i){(this.force_defaults||e!=i)&&(this.addFloat64(e),this.slot(t))}addFieldOffset(t,e,i){(this.force_defaults||e!=i)&&(this.addOffset(e),this.slot(t))}addFieldStruct(t,e,i){e!=i&&(this.nested(e),this.slot(t))}nested(t){if(t!=this.offset())throw new Error("FlatBuffers: struct must be serialized inline.")}notNested(){if(this.isNested)throw new Error("FlatBuffers: object serialization must not be nested.")}slot(t){this.vtable!==null&&(this.vtable[t]=this.offset())}offset(){return this.bb.capacity()-this.space}static growByteBuffer(t){const e=t.capacity();if(e&3221225472)throw new Error("FlatBuffers: cannot grow buffer beyond 2 gigabytes.");const i=e<<1,s=Ag.allocate(i);return s.setPosition(i-e),s.bytes().set(t.bytes(),i-e),s}addOffset(t){this.prep(va,0),this.writeInt32(this.offset()-t+va)}startObject(t){this.notNested(),this.vtable==null&&(this.vtable=[]),this.vtable_in_use=t;for(let e=0;e<t;e++)this.vtable[e]=0;this.isNested=!0,this.object_start=this.offset()}endObject(){if(this.vtable==null||!this.isNested)throw new Error("FlatBuffers: endObject called without startObject");this.addInt32(0);const t=this.offset();let e=this.vtable_in_use-1;for(;e>=0&&this.vtable[e]==0;e--);const i=e+1;for(;e>=0;e--)this.addInt16(this.vtable[e]!=0?t-this.vtable[e]:0);const s=2;this.addInt16(t-this.object_start);const r=(i+s)*Ib;this.addInt16(r);let o=0;const a=this.space;e:for(e=0;e<this.vtables.length;e++){const l=this.bb.capacity()-this.vtables[e];if(r==this.bb.readInt16(l)){for(let h=Ib;h<r;h+=Ib)if(this.bb.readInt16(a+h)!=this.bb.readInt16(l+h))continue e;o=this.vtables[e];break}}return o?(this.space=this.bb.capacity()-t,this.bb.writeInt32(this.space,o-t)):(this.vtables.push(this.offset()),this.bb.writeInt32(this.bb.capacity()-t,this.offset()-t)),this.isNested=!1,t}finish(t,e,i){const s=i?cC:0;if(e){const r=e;if(this.prep(this.minalign,va+ul+s),r.length!=ul)throw new Error("FlatBuffers: file identifier must be length "+ul);for(let o=ul-1;o>=0;o--)this.writeInt8(r.charCodeAt(o))}this.prep(this.minalign,va+s),this.addOffset(t),s&&this.addInt32(this.bb.capacity()-this.space),this.bb.setPosition(this.space)}finishSizePrefixed(t,e){this.finish(t,e,!0)}requiredField(t,e){const i=this.bb.capacity()-t,s=i-this.bb.readInt32(i);if(!(this.bb.readInt16(s+e)!=0))throw new Error("FlatBuffers: field "+e+" must be set")}startVector(t,e,i){this.notNested(),this.vector_num_elems=e,this.prep(va,t*e),this.prep(i,t*e)}endVector(){return this.writeInt32(this.vector_num_elems),this.offset()}createSharedString(t){if(!t)return 0;if(this.string_maps||(this.string_maps=new Map),this.string_maps.has(t))return this.string_maps.get(t);const e=this.createString(t);return this.string_maps.set(t,e),e}createString(t){if(!t)return 0;let e;if(t instanceof Uint8Array)e=t;else{e=[];let i=0;for(;i<t.length;){let s;const r=t.charCodeAt(i++);if(r<55296||r>=56320)s=r;else{const o=t.charCodeAt(i++);s=(r<<10)+o+(65536-56623104-56320)}s<128?e.push(s):(s<2048?e.push(s>>6&31|192):(s<65536?e.push(s>>12&15|224):e.push(s>>18&7|240,s>>12&63|128),e.push(s>>6&63|128)),e.push(s&63|128))}}this.addInt8(0),this.startVector(1,e.length,1),this.bb.setPosition(this.space-=e.length);for(let i=0,s=this.space,r=this.bb.bytes();i<e.length;i++)r[s++]=e[i];return this.endVector()}createLong(t,e){return Al.create(t,e)}createObjectOffset(t){return t===null?0:typeof t=="string"?this.createString(t):t.pack(this)}createObjectOffsetList(t){const e=[];for(let i=0;i<t.length;++i){const s=t[i];if(s!==null)e.push(this.createObjectOffset(s));else throw new Error("FlatBuffers: Argument for createObjectOffsetList cannot contain null.")}return e}createStructOffsetList(t,e){return e(this,t.length),this.createObjectOffsetList(t),this.endVector()}}const qM={};function XM(n,t){qM[n]=t}function _G(n){const t=n.getBufferIdentifier(),e=qM[t];return e(n)}function wG(n){return typeof n.guid=="function"?n.guid():null}var YM={exports:{}};(function(n){var t={};t.useBlobBuilder=function(){try{return new Blob([]),!1}catch{return!0}}(),t.useArrayBufferView=!t.useBlobBuilder&&function(){try{return new Blob([new Uint8Array([])]).size===0}catch{return!0}}(),n.exports.binaryFeatures=t;var e=n.exports.BlobBuilder;typeof window<"u"&&(e=n.exports.BlobBuilder=window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder||window.BlobBuilder);function i(){this._pieces=[],this._parts=[]}i.prototype.append=function(s){typeof s=="number"?this._pieces.push(s):(this.flush(),this._parts.push(s))},i.prototype.flush=function(){if(this._pieces.length>0){var s=new Uint8Array(this._pieces);t.useArrayBufferView||(s=s.buffer),this._parts.push(s),this._pieces=[]}},i.prototype.getBuffer=function(){if(this.flush(),t.useBlobBuilder){for(var s=new e,r=0,o=this._parts.length;r<o;r++)s.append(this._parts[r]);return s.getBlob()}else return new Blob(this._parts)},n.exports.BufferBuilder=i})(YM);var KM=YM.exports,xG=KM.BufferBuilder,F1=KM.binaryFeatures,CG={unpack:function(n){var t=new Hn(n);return t.unpack()},pack:function(n){var t=new Vn;t.pack(n);var e=t.getBuffer();return e}},SG=CG;function Hn(n){this.index=0,this.dataBuffer=n,this.dataView=new Uint8Array(this.dataBuffer),this.length=this.dataBuffer.byteLength}Hn.prototype.unpack=function(){var n=this.unpack_uint8();if(n<128)return n;if((n^224)<32)return(n^224)-32;var t;if((t=n^160)<=15)return this.unpack_raw(t);if((t=n^176)<=15)return this.unpack_string(t);if((t=n^144)<=15)return this.unpack_array(t);if((t=n^128)<=15)return this.unpack_map(t);switch(n){case 192:return null;case 193:return;case 194:return!1;case 195:return!0;case 202:return this.unpack_float();case 203:return this.unpack_double();case 204:return this.unpack_uint8();case 205:return this.unpack_uint16();case 206:return this.unpack_uint32();case 207:return this.unpack_uint64();case 208:return this.unpack_int8();case 209:return this.unpack_int16();case 210:return this.unpack_int32();case 211:return this.unpack_int64();case 212:return;case 213:return;case 214:return;case 215:return;case 216:return t=this.unpack_uint16(),this.unpack_string(t);case 217:return t=this.unpack_uint32(),this.unpack_string(t);case 218:return t=this.unpack_uint16(),this.unpack_raw(t);case 219:return t=this.unpack_uint32(),this.unpack_raw(t);case 220:return t=this.unpack_uint16(),this.unpack_array(t);case 221:return t=this.unpack_uint32(),this.unpack_array(t);case 222:return t=this.unpack_uint16(),this.unpack_map(t);case 223:return t=this.unpack_uint32(),this.unpack_map(t)}};Hn.prototype.unpack_uint8=function(){var n=this.dataView[this.index]&255;return this.index++,n};Hn.prototype.unpack_uint16=function(){var n=this.read(2),t=(n[0]&255)*256+(n[1]&255);return this.index+=2,t};Hn.prototype.unpack_uint32=function(){var n=this.read(4),t=((n[0]*256+n[1])*256+n[2])*256+n[3];return this.index+=4,t};Hn.prototype.unpack_uint64=function(){var n=this.read(8),t=((((((n[0]*256+n[1])*256+n[2])*256+n[3])*256+n[4])*256+n[5])*256+n[6])*256+n[7];return this.index+=8,t};Hn.prototype.unpack_int8=function(){var n=this.unpack_uint8();return n<128?n:n-256};Hn.prototype.unpack_int16=function(){var n=this.unpack_uint16();return n<32768?n:n-65536};Hn.prototype.unpack_int32=function(){var n=this.unpack_uint32();return n<Math.pow(2,31)?n:n-Math.pow(2,32)};Hn.prototype.unpack_int64=function(){var n=this.unpack_uint64();return n<Math.pow(2,63)?n:n-Math.pow(2,64)};Hn.prototype.unpack_raw=function(n){if(this.length<this.index+n)throw new Error("BinaryPackFailure: index is out of range "+this.index+" "+n+" "+this.length);var t=this.dataBuffer.slice(this.index,this.index+n);return this.index+=n,t};Hn.prototype.unpack_string=function(n){for(var t=this.read(n),e=0,i="",s,r;e<n;)s=t[e],s<128?(i+=String.fromCharCode(s),e++):(s^192)<32?(r=(s^192)<<6|t[e+1]&63,i+=String.fromCharCode(r),e+=2):(r=(s&15)<<12|(t[e+1]&63)<<6|t[e+2]&63,i+=String.fromCharCode(r),e+=3);return this.index+=n,i};Hn.prototype.unpack_array=function(n){for(var t=new Array(n),e=0;e<n;e++)t[e]=this.unpack();return t};Hn.prototype.unpack_map=function(n){for(var t={},e=0;e<n;e++){var i=this.unpack(),s=this.unpack();t[i]=s}return t};Hn.prototype.unpack_float=function(){var n=this.unpack_uint32(),t=n>>31,e=(n>>23&255)-127,i=n&8388607|8388608;return(t===0?1:-1)*i*Math.pow(2,e-23)};Hn.prototype.unpack_double=function(){var n=this.unpack_uint32(),t=this.unpack_uint32(),e=n>>31,i=(n>>20&2047)-1023,s=n&1048575|1048576,r=s*Math.pow(2,i-20)+t*Math.pow(2,i-52);return(e===0?1:-1)*r};Hn.prototype.read=function(n){var t=this.index;if(t+n<=this.length)return this.dataView.subarray(t,t+n);throw new Error("BinaryPackFailure: read index out of range")};function Vn(){this.bufferBuilder=new xG}Vn.prototype.getBuffer=function(){return this.bufferBuilder.getBuffer()};Vn.prototype.pack=function(n){var t=typeof n;if(t==="string")this.pack_string(n);else if(t==="number")Math.floor(n)===n?this.pack_integer(n):this.pack_double(n);else if(t==="boolean")n===!0?this.bufferBuilder.append(195):n===!1&&this.bufferBuilder.append(194);else if(t==="undefined")this.bufferBuilder.append(192);else if(t==="object")if(n===null)this.bufferBuilder.append(192);else{var e=n.constructor;if(e==Array)this.pack_array(n);else if(e==Blob||e==File||n instanceof Blob||n instanceof File)this.pack_bin(n);else if(e==ArrayBuffer)F1.useArrayBufferView?this.pack_bin(new Uint8Array(n)):this.pack_bin(n);else if("BYTES_PER_ELEMENT"in n)F1.useArrayBufferView?this.pack_bin(new Uint8Array(n.buffer)):this.pack_bin(n.buffer);else if(e==Object||e.toString().startsWith("class"))this.pack_object(n);else if(e==Date)this.pack_string(n.toString());else if(typeof n.toBinaryPack=="function")this.bufferBuilder.append(n.toBinaryPack());else throw new Error('Type "'+e.toString()+'" not yet supported')}else throw new Error('Type "'+t+'" not yet supported');this.bufferBuilder.flush()};Vn.prototype.pack_bin=function(n){var t=n.length||n.byteLength||n.size;if(t<=15)this.pack_uint8(160+t);else if(t<=65535)this.bufferBuilder.append(218),this.pack_uint16(t);else if(t<=4294967295)this.bufferBuilder.append(219),this.pack_uint32(t);else throw new Error("Invalid length");this.bufferBuilder.append(n)};Vn.prototype.pack_string=function(n){var t=IG(n);if(t<=15)this.pack_uint8(176+t);else if(t<=65535)this.bufferBuilder.append(216),this.pack_uint16(t);else if(t<=4294967295)this.bufferBuilder.append(217),this.pack_uint32(t);else throw new Error("Invalid length");this.bufferBuilder.append(n)};Vn.prototype.pack_array=function(n){var t=n.length;if(t<=15)this.pack_uint8(144+t);else if(t<=65535)this.bufferBuilder.append(220),this.pack_uint16(t);else if(t<=4294967295)this.bufferBuilder.append(221),this.pack_uint32(t);else throw new Error("Invalid length");for(var e=0;e<t;e++)this.pack(n[e])};Vn.prototype.pack_integer=function(n){if(n>=-32&&n<=127)this.bufferBuilder.append(n&255);else if(n>=0&&n<=255)this.bufferBuilder.append(204),this.pack_uint8(n);else if(n>=-128&&n<=127)this.bufferBuilder.append(208),this.pack_int8(n);else if(n>=0&&n<=65535)this.bufferBuilder.append(205),this.pack_uint16(n);else if(n>=-32768&&n<=32767)this.bufferBuilder.append(209),this.pack_int16(n);else if(n>=0&&n<=4294967295)this.bufferBuilder.append(206),this.pack_uint32(n);else if(n>=-2147483648&&n<=2147483647)this.bufferBuilder.append(210),this.pack_int32(n);else if(n>=-9223372036854776e3&&n<=9223372036854776e3)this.bufferBuilder.append(211),this.pack_int64(n);else if(n>=0&&n<=18446744073709552e3)this.bufferBuilder.append(207),this.pack_uint64(n);else throw new Error("Invalid integer")};Vn.prototype.pack_double=function(n){var t=0;n<0&&(t=1,n=-n);var e=Math.floor(Math.log(n)/Math.LN2),i=n/Math.pow(2,e)-1,s=Math.floor(i*Math.pow(2,52)),r=Math.pow(2,32),o=t<<31|e+1023<<20|s/r&1048575,a=s%r;this.bufferBuilder.append(203),this.pack_int32(o),this.pack_int32(a)};Vn.prototype.pack_object=function(n){var t=Object.keys(n),e=t.length;if(e<=15)this.pack_uint8(128+e);else if(e<=65535)this.bufferBuilder.append(222),this.pack_uint16(e);else if(e<=4294967295)this.bufferBuilder.append(223),this.pack_uint32(e);else throw new Error("Invalid length");for(var i in n)n.hasOwnProperty(i)&&(this.pack(i),this.pack(n[i]))};Vn.prototype.pack_uint8=function(n){this.bufferBuilder.append(n)};Vn.prototype.pack_uint16=function(n){this.bufferBuilder.append(n>>8),this.bufferBuilder.append(n&255)};Vn.prototype.pack_uint32=function(n){var t=n&4294967295;this.bufferBuilder.append((t&4278190080)>>>24),this.bufferBuilder.append((t&16711680)>>>16),this.bufferBuilder.append((t&65280)>>>8),this.bufferBuilder.append(t&255)};Vn.prototype.pack_uint64=function(n){var t=n/Math.pow(2,32),e=n%Math.pow(2,32);this.bufferBuilder.append((t&4278190080)>>>24),this.bufferBuilder.append((t&16711680)>>>16),this.bufferBuilder.append((t&65280)>>>8),this.bufferBuilder.append(t&255),this.bufferBuilder.append((e&4278190080)>>>24),this.bufferBuilder.append((e&16711680)>>>16),this.bufferBuilder.append((e&65280)>>>8),this.bufferBuilder.append(e&255)};Vn.prototype.pack_int8=function(n){this.bufferBuilder.append(n&255)};Vn.prototype.pack_int16=function(n){this.bufferBuilder.append((n&65280)>>8),this.bufferBuilder.append(n&255)};Vn.prototype.pack_int32=function(n){this.bufferBuilder.append(n>>>24&255),this.bufferBuilder.append((n&16711680)>>>16),this.bufferBuilder.append((n&65280)>>>8),this.bufferBuilder.append(n&255)};Vn.prototype.pack_int64=function(n){var t=Math.floor(n/Math.pow(2,32)),e=n%Math.pow(2,32);this.bufferBuilder.append((t&4278190080)>>>24),this.bufferBuilder.append((t&16711680)>>>16),this.bufferBuilder.append((t&65280)>>>8),this.bufferBuilder.append(t&255),this.bufferBuilder.append((e&4278190080)>>>24),this.bufferBuilder.append((e&16711680)>>>16),this.bufferBuilder.append((e&65280)>>>8),this.bufferBuilder.append(e&255)};function EG(n){var t=n.charCodeAt(0);return t<=2047?"00":t<=65535?"000":t<=2097151?"0000":t<=67108863?"00000":"000000"}function IG(n){return n.length>600?new Blob([n]).size:n.replace(/[^\u0000-\u007F]/g,EG).length}const U1=Ry(SG);let JM=!0,ZM=!0;function sp(n,t,e){const i=n.match(t);return i&&i.length>=e&&parseInt(i[e],10)}function Vd(n,t,e){if(!n.RTCPeerConnection)return;const i=n.RTCPeerConnection.prototype,s=i.addEventListener;i.addEventListener=function(o,a){if(o!==t)return s.apply(this,arguments);const l=h=>{const u=e(h);u&&(a.handleEvent?a.handleEvent(u):a(u))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(a,l),s.apply(this,[o,l])};const r=i.removeEventListener;i.removeEventListener=function(o,a){if(o!==t||!this._eventMap||!this._eventMap[t])return r.apply(this,arguments);if(!this._eventMap[t].has(a))return r.apply(this,arguments);const l=this._eventMap[t].get(a);return this._eventMap[t].delete(a),this._eventMap[t].size===0&&delete this._eventMap[t],Object.keys(this._eventMap).length===0&&delete this._eventMap,r.apply(this,[o,l])},Object.defineProperty(i,"on"+t,{get(){return this["_on"+t]},set(o){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),o&&this.addEventListener(t,this["_on"+t]=o)},enumerable:!0,configurable:!0})}function TG(n){return typeof n!="boolean"?new Error("Argument type: "+typeof n+". Please use a boolean."):(JM=n,n?"adapter.js logging disabled":"adapter.js logging enabled")}function RG(n){return typeof n!="boolean"?new Error("Argument type: "+typeof n+". Please use a boolean."):(ZM=!n,"adapter.js deprecation warnings "+(n?"disabled":"enabled"))}function hC(){if(typeof window=="object"){if(JM)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function By(n,t){ZM&&console.warn(n+" is deprecated, please use "+t+" instead.")}function BG(n){const t={browser:null,version:null};if(typeof n>"u"||!n.navigator)return t.browser="Not a browser.",t;const{navigator:e}=n;if(e.mozGetUserMedia)t.browser="firefox",t.version=sp(e.userAgent,/Firefox\/(\d+)\./,1);else if(e.webkitGetUserMedia||n.isSecureContext===!1&&n.webkitRTCPeerConnection&&!n.RTCIceGatherer)t.browser="chrome",t.version=sp(e.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(e.mediaDevices&&e.userAgent.match(/Edge\/(\d+).(\d+)$/))t.browser="edge",t.version=sp(e.userAgent,/Edge\/(\d+).(\d+)$/,2);else if(n.RTCPeerConnection&&e.userAgent.match(/AppleWebKit\/(\d+)\./))t.browser="safari",t.version=sp(e.userAgent,/AppleWebKit\/(\d+)\./,1),t.supportsUnifiedPlan=n.RTCRtpTransceiver&&"currentDirection"in n.RTCRtpTransceiver.prototype;else return t.browser="Not a supported browser.",t;return t}function N1(n){return Object.prototype.toString.call(n)==="[object Object]"}function $M(n){return N1(n)?Object.keys(n).reduce(function(t,e){const i=N1(n[e]),s=i?$M(n[e]):n[e],r=i&&!Object.keys(s).length;return s===void 0||r?t:Object.assign(t,{[e]:s})},{}):n}function dw(n,t,e){!t||e.has(t.id)||(e.set(t.id,t),Object.keys(t).forEach(i=>{i.endsWith("Id")?dw(n,n.get(t[i]),e):i.endsWith("Ids")&&t[i].forEach(s=>{dw(n,n.get(s),e)})}))}function Q1(n,t,e){const i=e?"outbound-rtp":"inbound-rtp",s=new Map;if(t===null)return s;const r=[];return n.forEach(o=>{o.type==="track"&&o.trackIdentifier===t.id&&r.push(o)}),r.forEach(o=>{n.forEach(a=>{a.type===i&&a.trackId===o.id&&dw(n,a,s)})}),s}const z1=hC;function eD(n,t){const e=n&&n.navigator;if(!e.mediaDevices)return;const i=function(a){if(typeof a!="object"||a.mandatory||a.optional)return a;const l={};return Object.keys(a).forEach(h=>{if(h==="require"||h==="advanced"||h==="mediaSource")return;const u=typeof a[h]=="object"?a[h]:{ideal:a[h]};u.exact!==void 0&&typeof u.exact=="number"&&(u.min=u.max=u.exact);const d=function(f,p){return f?f+p.charAt(0).toUpperCase()+p.slice(1):p==="deviceId"?"sourceId":p};if(u.ideal!==void 0){l.optional=l.optional||[];let f={};typeof u.ideal=="number"?(f[d("min",h)]=u.ideal,l.optional.push(f),f={},f[d("max",h)]=u.ideal,l.optional.push(f)):(f[d("",h)]=u.ideal,l.optional.push(f))}u.exact!==void 0&&typeof u.exact!="number"?(l.mandatory=l.mandatory||{},l.mandatory[d("",h)]=u.exact):["min","max"].forEach(f=>{u[f]!==void 0&&(l.mandatory=l.mandatory||{},l.mandatory[d(f,h)]=u[f])})}),a.advanced&&(l.optional=(l.optional||[]).concat(a.advanced)),l},s=function(a,l){if(t.version>=61)return l(a);if(a=JSON.parse(JSON.stringify(a)),a&&typeof a.audio=="object"){const h=function(u,d,f){d in u&&!(f in u)&&(u[f]=u[d],delete u[d])};a=JSON.parse(JSON.stringify(a)),h(a.audio,"autoGainControl","googAutoGainControl"),h(a.audio,"noiseSuppression","googNoiseSuppression"),a.audio=i(a.audio)}if(a&&typeof a.video=="object"){let h=a.video.facingMode;h=h&&(typeof h=="object"?h:{ideal:h});const u=t.version<66;if(h&&(h.exact==="user"||h.exact==="environment"||h.ideal==="user"||h.ideal==="environment")&&!(e.mediaDevices.getSupportedConstraints&&e.mediaDevices.getSupportedConstraints().facingMode&&!u)){delete a.video.facingMode;let d;if(h.exact==="environment"||h.ideal==="environment"?d=["back","rear"]:(h.exact==="user"||h.ideal==="user")&&(d=["front"]),d)return e.mediaDevices.enumerateDevices().then(f=>{f=f.filter(g=>g.kind==="videoinput");let p=f.find(g=>d.some(m=>g.label.toLowerCase().includes(m)));return!p&&f.length&&d.includes("back")&&(p=f[f.length-1]),p&&(a.video.deviceId=h.exact?{exact:p.deviceId}:{ideal:p.deviceId}),a.video=i(a.video),z1("chrome: "+JSON.stringify(a)),l(a)})}a.video=i(a.video)}return z1("chrome: "+JSON.stringify(a)),l(a)},r=function(a){return t.version>=64?a:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[a.name]||a.name,message:a.message,constraint:a.constraint||a.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},o=function(a,l,h){s(a,u=>{e.webkitGetUserMedia(u,l,d=>{h&&h(r(d))})})};if(e.getUserMedia=o.bind(e),e.mediaDevices.getUserMedia){const a=e.mediaDevices.getUserMedia.bind(e.mediaDevices);e.mediaDevices.getUserMedia=function(l){return s(l,h=>a(h).then(u=>{if(h.audio&&!u.getAudioTracks().length||h.video&&!u.getVideoTracks().length)throw u.getTracks().forEach(d=>{d.stop()}),new DOMException("","NotFoundError");return u},u=>Promise.reject(r(u))))}}}function PG(n,t){if(!(n.navigator.mediaDevices&&"getDisplayMedia"in n.navigator.mediaDevices)&&n.navigator.mediaDevices){if(typeof t!="function"){console.error("shimGetDisplayMedia: getSourceId argument is not a function");return}n.navigator.mediaDevices.getDisplayMedia=function(i){return t(i).then(s=>{const r=i.video&&i.video.width,o=i.video&&i.video.height,a=i.video&&i.video.frameRate;return i.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:s,maxFrameRate:a||3}},r&&(i.video.mandatory.maxWidth=r),o&&(i.video.mandatory.maxHeight=o),n.navigator.mediaDevices.getUserMedia(i)})}}}function tD(n){n.MediaStream=n.MediaStream||n.webkitMediaStream}function iD(n){if(typeof n=="object"&&n.RTCPeerConnection&&!("ontrack"in n.RTCPeerConnection.prototype)){Object.defineProperty(n.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});const t=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=i=>{i.stream.addEventListener("addtrack",s=>{let r;n.RTCPeerConnection.prototype.getReceivers?r=this.getReceivers().find(a=>a.track&&a.track.id===s.track.id):r={track:s.track};const o=new Event("track");o.track=s.track,o.receiver=r,o.transceiver={receiver:r},o.streams=[i.stream],this.dispatchEvent(o)}),i.stream.getTracks().forEach(s=>{let r;n.RTCPeerConnection.prototype.getReceivers?r=this.getReceivers().find(a=>a.track&&a.track.id===s.id):r={track:s};const o=new Event("track");o.track=s,o.receiver=r,o.transceiver={receiver:r},o.streams=[i.stream],this.dispatchEvent(o)})},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else Vd(n,"track",t=>(t.transceiver||Object.defineProperty(t,"transceiver",{value:{receiver:t.receiver}}),t))}function nD(n){if(typeof n=="object"&&n.RTCPeerConnection&&!("getSenders"in n.RTCPeerConnection.prototype)&&"createDTMFSender"in n.RTCPeerConnection.prototype){const t=function(s,r){return{track:r,get dtmf(){return this._dtmf===void 0&&(r.kind==="audio"?this._dtmf=s.createDTMFSender(r):this._dtmf=null),this._dtmf},_pc:s}};if(!n.RTCPeerConnection.prototype.getSenders){n.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const s=n.RTCPeerConnection.prototype.addTrack;n.RTCPeerConnection.prototype.addTrack=function(a,l){let h=s.apply(this,arguments);return h||(h=t(this,a),this._senders.push(h)),h};const r=n.RTCPeerConnection.prototype.removeTrack;n.RTCPeerConnection.prototype.removeTrack=function(a){r.apply(this,arguments);const l=this._senders.indexOf(a);l!==-1&&this._senders.splice(l,1)}}const e=n.RTCPeerConnection.prototype.addStream;n.RTCPeerConnection.prototype.addStream=function(r){this._senders=this._senders||[],e.apply(this,[r]),r.getTracks().forEach(o=>{this._senders.push(t(this,o))})};const i=n.RTCPeerConnection.prototype.removeStream;n.RTCPeerConnection.prototype.removeStream=function(r){this._senders=this._senders||[],i.apply(this,[r]),r.getTracks().forEach(o=>{const a=this._senders.find(l=>l.track===o);a&&this._senders.splice(this._senders.indexOf(a),1)})}}else if(typeof n=="object"&&n.RTCPeerConnection&&"getSenders"in n.RTCPeerConnection.prototype&&"createDTMFSender"in n.RTCPeerConnection.prototype&&n.RTCRtpSender&&!("dtmf"in n.RTCRtpSender.prototype)){const t=n.RTCPeerConnection.prototype.getSenders;n.RTCPeerConnection.prototype.getSenders=function(){const i=t.apply(this,[]);return i.forEach(s=>s._pc=this),i},Object.defineProperty(n.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function sD(n){if(!n.RTCPeerConnection)return;const t=n.RTCPeerConnection.prototype.getStats;n.RTCPeerConnection.prototype.getStats=function(){const[i,s,r]=arguments;if(arguments.length>0&&typeof i=="function")return t.apply(this,arguments);if(t.length===0&&(arguments.length===0||typeof i!="function"))return t.apply(this,[]);const o=function(l){const h={};return l.result().forEach(d=>{const f={id:d.id,timestamp:d.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[d.type]||d.type};d.names().forEach(p=>{f[p]=d.stat(p)}),h[f.id]=f}),h},a=function(l){return new Map(Object.keys(l).map(h=>[h,l[h]]))};if(arguments.length>=2){const l=function(h){s(a(o(h)))};return t.apply(this,[l,i])}return new Promise((l,h)=>{t.apply(this,[function(u){l(a(o(u)))},h])}).then(s,r)}}function rD(n){if(!(typeof n=="object"&&n.RTCPeerConnection&&n.RTCRtpSender&&n.RTCRtpReceiver))return;if(!("getStats"in n.RTCRtpSender.prototype)){const e=n.RTCPeerConnection.prototype.getSenders;e&&(n.RTCPeerConnection.prototype.getSenders=function(){const r=e.apply(this,[]);return r.forEach(o=>o._pc=this),r});const i=n.RTCPeerConnection.prototype.addTrack;i&&(n.RTCPeerConnection.prototype.addTrack=function(){const r=i.apply(this,arguments);return r._pc=this,r}),n.RTCRtpSender.prototype.getStats=function(){const r=this;return this._pc.getStats().then(o=>Q1(o,r.track,!0))}}if(!("getStats"in n.RTCRtpReceiver.prototype)){const e=n.RTCPeerConnection.prototype.getReceivers;e&&(n.RTCPeerConnection.prototype.getReceivers=function(){const s=e.apply(this,[]);return s.forEach(r=>r._pc=this),s}),Vd(n,"track",i=>(i.receiver._pc=i.srcElement,i)),n.RTCRtpReceiver.prototype.getStats=function(){const s=this;return this._pc.getStats().then(r=>Q1(r,s.track,!1))}}if(!("getStats"in n.RTCRtpSender.prototype&&"getStats"in n.RTCRtpReceiver.prototype))return;const t=n.RTCPeerConnection.prototype.getStats;n.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof n.MediaStreamTrack){const i=arguments[0];let s,r,o;return this.getSenders().forEach(a=>{a.track===i&&(s?o=!0:s=a)}),this.getReceivers().forEach(a=>(a.track===i&&(r?o=!0:r=a),a.track===i)),o||s&&r?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):s?s.getStats():r?r.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function oD(n){n.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(o=>this._shimmedLocalStreams[o][0])};const t=n.RTCPeerConnection.prototype.addTrack;n.RTCPeerConnection.prototype.addTrack=function(o,a){if(!a)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const l=t.apply(this,arguments);return this._shimmedLocalStreams[a.id]?this._shimmedLocalStreams[a.id].indexOf(l)===-1&&this._shimmedLocalStreams[a.id].push(l):this._shimmedLocalStreams[a.id]=[a,l],l};const e=n.RTCPeerConnection.prototype.addStream;n.RTCPeerConnection.prototype.addStream=function(o){this._shimmedLocalStreams=this._shimmedLocalStreams||{},o.getTracks().forEach(h=>{if(this.getSenders().find(d=>d.track===h))throw new DOMException("Track already exists.","InvalidAccessError")});const a=this.getSenders();e.apply(this,arguments);const l=this.getSenders().filter(h=>a.indexOf(h)===-1);this._shimmedLocalStreams[o.id]=[o].concat(l)};const i=n.RTCPeerConnection.prototype.removeStream;n.RTCPeerConnection.prototype.removeStream=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[o.id],i.apply(this,arguments)};const s=n.RTCPeerConnection.prototype.removeTrack;n.RTCPeerConnection.prototype.removeTrack=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},o&&Object.keys(this._shimmedLocalStreams).forEach(a=>{const l=this._shimmedLocalStreams[a].indexOf(o);l!==-1&&this._shimmedLocalStreams[a].splice(l,1),this._shimmedLocalStreams[a].length===1&&delete this._shimmedLocalStreams[a]}),s.apply(this,arguments)}}function aD(n,t){if(!n.RTCPeerConnection)return;if(n.RTCPeerConnection.prototype.addTrack&&t.version>=65)return oD(n);const e=n.RTCPeerConnection.prototype.getLocalStreams;n.RTCPeerConnection.prototype.getLocalStreams=function(){const u=e.apply(this);return this._reverseStreams=this._reverseStreams||{},u.map(d=>this._reverseStreams[d.id])};const i=n.RTCPeerConnection.prototype.addStream;n.RTCPeerConnection.prototype.addStream=function(u){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},u.getTracks().forEach(d=>{if(this.getSenders().find(p=>p.track===d))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[u.id]){const d=new n.MediaStream(u.getTracks());this._streams[u.id]=d,this._reverseStreams[d.id]=u,u=d}i.apply(this,[u])};const s=n.RTCPeerConnection.prototype.removeStream;n.RTCPeerConnection.prototype.removeStream=function(u){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},s.apply(this,[this._streams[u.id]||u]),delete this._reverseStreams[this._streams[u.id]?this._streams[u.id].id:u.id],delete this._streams[u.id]},n.RTCPeerConnection.prototype.addTrack=function(u,d){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const f=[].slice.call(arguments,1);if(f.length!==1||!f[0].getTracks().find(m=>m===u))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(m=>m.track===u))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const g=this._streams[d.id];if(g)g.addTrack(u),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const m=new n.MediaStream([u]);this._streams[d.id]=m,this._reverseStreams[m.id]=d,this.addStream(m)}return this.getSenders().find(m=>m.track===u)};function r(h,u){let d=u.sdp;return Object.keys(h._reverseStreams||[]).forEach(f=>{const p=h._reverseStreams[f],g=h._streams[p.id];d=d.replace(new RegExp(g.id,"g"),p.id)}),new RTCSessionDescription({type:u.type,sdp:d})}function o(h,u){let d=u.sdp;return Object.keys(h._reverseStreams||[]).forEach(f=>{const p=h._reverseStreams[f],g=h._streams[p.id];d=d.replace(new RegExp(p.id,"g"),g.id)}),new RTCSessionDescription({type:u.type,sdp:d})}["createOffer","createAnswer"].forEach(function(h){const u=n.RTCPeerConnection.prototype[h],d={[h](){const f=arguments;return arguments.length&&typeof arguments[0]=="function"?u.apply(this,[g=>{const m=r(this,g);f[0].apply(null,[m])},g=>{f[1]&&f[1].apply(null,g)},arguments[2]]):u.apply(this,arguments).then(g=>r(this,g))}};n.RTCPeerConnection.prototype[h]=d[h]});const a=n.RTCPeerConnection.prototype.setLocalDescription;n.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type?a.apply(this,arguments):(arguments[0]=o(this,arguments[0]),a.apply(this,arguments))};const l=Object.getOwnPropertyDescriptor(n.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(n.RTCPeerConnection.prototype,"localDescription",{get(){const h=l.get.apply(this);return h.type===""?h:r(this,h)}}),n.RTCPeerConnection.prototype.removeTrack=function(u){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!u._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(u._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let f;Object.keys(this._streams).forEach(p=>{this._streams[p].getTracks().find(m=>u.track===m)&&(f=this._streams[p])}),f&&(f.getTracks().length===1?this.removeStream(this._reverseStreams[f.id]):f.removeTrack(u.track),this.dispatchEvent(new Event("negotiationneeded")))}}function fw(n,t){!n.RTCPeerConnection&&n.webkitRTCPeerConnection&&(n.RTCPeerConnection=n.webkitRTCPeerConnection),n.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(e){const i=n.RTCPeerConnection.prototype[e],s={[e](){return arguments[0]=new(e==="addIceCandidate"?n.RTCIceCandidate:n.RTCSessionDescription)(arguments[0]),i.apply(this,arguments)}};n.RTCPeerConnection.prototype[e]=s[e]})}function lD(n,t){Vd(n,"negotiationneeded",e=>{const i=e.target;if(!((t.version<72||i.getConfiguration&&i.getConfiguration().sdpSemantics==="plan-b")&&i.signalingState!=="stable"))return e})}const j1=Object.freeze(Object.defineProperty({__proto__:null,fixNegotiationNeeded:lD,shimAddTrackRemoveTrack:aD,shimAddTrackRemoveTrackWithNative:oD,shimGetDisplayMedia:PG,shimGetSendersWithDtmf:nD,shimGetStats:sD,shimGetUserMedia:eD,shimMediaStream:tD,shimOnTrack:iD,shimPeerConnection:fw,shimSenderReceiverGetStats:rD},Symbol.toStringTag,{value:"Module"}));function MG(n,t){let e=!1;return n=JSON.parse(JSON.stringify(n)),n.filter(i=>{if(i&&(i.urls||i.url)){let s=i.urls||i.url;i.url&&!i.urls&&By("RTCIceServer.url","RTCIceServer.urls");const r=typeof s=="string";return r&&(s=[s]),s=s.filter(o=>{if(o.indexOf("stun:")===0)return!1;const a=o.startsWith("turn")&&!o.startsWith("turn:[")&&o.includes("transport=udp");return a&&!e?(e=!0,!0):a&&!e}),delete i.url,i.urls=r?s[0]:s,!!s.length}})}var cD={exports:{}};(function(n){var t={};t.generateIdentifier=function(){return Math.random().toString(36).substr(2,10)},t.localCName=t.generateIdentifier(),t.splitLines=function(e){return e.trim().split(`
`).map(function(i){return i.trim()})},t.splitSections=function(e){var i=e.split(`
m=`);return i.map(function(s,r){return(r>0?"m="+s:s).trim()+`\r
`})},t.getDescription=function(e){var i=t.splitSections(e);return i&&i[0]},t.getMediaSections=function(e){var i=t.splitSections(e);return i.shift(),i},t.matchPrefix=function(e,i){return t.splitLines(e).filter(function(s){return s.indexOf(i)===0})},t.parseCandidate=function(e){var i;e.indexOf("a=candidate:")===0?i=e.substring(12).split(" "):i=e.substring(10).split(" ");for(var s={foundation:i[0],component:parseInt(i[1],10),protocol:i[2].toLowerCase(),priority:parseInt(i[3],10),ip:i[4],address:i[4],port:parseInt(i[5],10),type:i[7]},r=8;r<i.length;r+=2)switch(i[r]){case"raddr":s.relatedAddress=i[r+1];break;case"rport":s.relatedPort=parseInt(i[r+1],10);break;case"tcptype":s.tcpType=i[r+1];break;case"ufrag":s.ufrag=i[r+1],s.usernameFragment=i[r+1];break;default:s[i[r]]=i[r+1];break}return s},t.writeCandidate=function(e){var i=[];i.push(e.foundation),i.push(e.component),i.push(e.protocol.toUpperCase()),i.push(e.priority),i.push(e.address||e.ip),i.push(e.port);var s=e.type;return i.push("typ"),i.push(s),s!=="host"&&e.relatedAddress&&e.relatedPort&&(i.push("raddr"),i.push(e.relatedAddress),i.push("rport"),i.push(e.relatedPort)),e.tcpType&&e.protocol.toLowerCase()==="tcp"&&(i.push("tcptype"),i.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(i.push("ufrag"),i.push(e.usernameFragment||e.ufrag)),"candidate:"+i.join(" ")},t.parseIceOptions=function(e){return e.substr(14).split(" ")},t.parseRtpMap=function(e){var i=e.substr(9).split(" "),s={payloadType:parseInt(i.shift(),10)};return i=i[0].split("/"),s.name=i[0],s.clockRate=parseInt(i[1],10),s.channels=i.length===3?parseInt(i[2],10):1,s.numChannels=s.channels,s},t.writeRtpMap=function(e){var i=e.payloadType;e.preferredPayloadType!==void 0&&(i=e.preferredPayloadType);var s=e.channels||e.numChannels||1;return"a=rtpmap:"+i+" "+e.name+"/"+e.clockRate+(s!==1?"/"+s:"")+`\r
`},t.parseExtmap=function(e){var i=e.substr(9).split(" ");return{id:parseInt(i[0],10),direction:i[0].indexOf("/")>0?i[0].split("/")[1]:"sendrecv",uri:i[1]}},t.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&e.direction!=="sendrecv"?"/"+e.direction:"")+" "+e.uri+`\r
`},t.parseFmtp=function(e){for(var i={},s,r=e.substr(e.indexOf(" ")+1).split(";"),o=0;o<r.length;o++)s=r[o].trim().split("="),i[s[0].trim()]=s[1];return i},t.writeFmtp=function(e){var i="",s=e.payloadType;if(e.preferredPayloadType!==void 0&&(s=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){var r=[];Object.keys(e.parameters).forEach(function(o){e.parameters[o]?r.push(o+"="+e.parameters[o]):r.push(o)}),i+="a=fmtp:"+s+" "+r.join(";")+`\r
`}return i},t.parseRtcpFb=function(e){var i=e.substr(e.indexOf(" ")+1).split(" ");return{type:i.shift(),parameter:i.join(" ")}},t.writeRtcpFb=function(e){var i="",s=e.payloadType;return e.preferredPayloadType!==void 0&&(s=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach(function(r){i+="a=rtcp-fb:"+s+" "+r.type+(r.parameter&&r.parameter.length?" "+r.parameter:"")+`\r
`}),i},t.parseSsrcMedia=function(e){var i=e.indexOf(" "),s={ssrc:parseInt(e.substr(7,i-7),10)},r=e.indexOf(":",i);return r>-1?(s.attribute=e.substr(i+1,r-i-1),s.value=e.substr(r+1)):s.attribute=e.substr(i+1),s},t.parseSsrcGroup=function(e){var i=e.substr(13).split(" ");return{semantics:i.shift(),ssrcs:i.map(function(s){return parseInt(s,10)})}},t.getMid=function(e){var i=t.matchPrefix(e,"a=mid:")[0];if(i)return i.substr(6)},t.parseFingerprint=function(e){var i=e.substr(14).split(" ");return{algorithm:i[0].toLowerCase(),value:i[1]}},t.getDtlsParameters=function(e,i){var s=t.matchPrefix(e+i,"a=fingerprint:");return{role:"auto",fingerprints:s.map(t.parseFingerprint)}},t.writeDtlsParameters=function(e,i){var s="a=setup:"+i+`\r
`;return e.fingerprints.forEach(function(r){s+="a=fingerprint:"+r.algorithm+" "+r.value+`\r
`}),s},t.parseCryptoLine=function(e){var i=e.substr(9).split(" ");return{tag:parseInt(i[0],10),cryptoSuite:i[1],keyParams:i[2],sessionParams:i.slice(3)}},t.writeCryptoLine=function(e){return"a=crypto:"+e.tag+" "+e.cryptoSuite+" "+(typeof e.keyParams=="object"?t.writeCryptoKeyParams(e.keyParams):e.keyParams)+(e.sessionParams?" "+e.sessionParams.join(" "):"")+`\r
`},t.parseCryptoKeyParams=function(e){if(e.indexOf("inline:")!==0)return null;var i=e.substr(7).split("|");return{keyMethod:"inline",keySalt:i[0],lifeTime:i[1],mkiValue:i[2]?i[2].split(":")[0]:void 0,mkiLength:i[2]?i[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(e){return e.keyMethod+":"+e.keySalt+(e.lifeTime?"|"+e.lifeTime:"")+(e.mkiValue&&e.mkiLength?"|"+e.mkiValue+":"+e.mkiLength:"")},t.getCryptoParameters=function(e,i){var s=t.matchPrefix(e+i,"a=crypto:");return s.map(t.parseCryptoLine)},t.getIceParameters=function(e,i){var s=t.matchPrefix(e+i,"a=ice-ufrag:")[0],r=t.matchPrefix(e+i,"a=ice-pwd:")[0];return s&&r?{usernameFragment:s.substr(12),password:r.substr(10)}:null},t.writeIceParameters=function(e){return"a=ice-ufrag:"+e.usernameFragment+`\r
a=ice-pwd:`+e.password+`\r
`},t.parseRtpParameters=function(e){for(var i={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},s=t.splitLines(e),r=s[0].split(" "),o=3;o<r.length;o++){var a=r[o],l=t.matchPrefix(e,"a=rtpmap:"+a+" ")[0];if(l){var h=t.parseRtpMap(l),u=t.matchPrefix(e,"a=fmtp:"+a+" ");switch(h.parameters=u.length?t.parseFmtp(u[0]):{},h.rtcpFeedback=t.matchPrefix(e,"a=rtcp-fb:"+a+" ").map(t.parseRtcpFb),i.codecs.push(h),h.name.toUpperCase()){case"RED":case"ULPFEC":i.fecMechanisms.push(h.name.toUpperCase());break}}}return t.matchPrefix(e,"a=extmap:").forEach(function(d){i.headerExtensions.push(t.parseExtmap(d))}),i},t.writeRtpDescription=function(e,i){var s="";s+="m="+e+" ",s+=i.codecs.length>0?"9":"0",s+=" UDP/TLS/RTP/SAVPF ",s+=i.codecs.map(function(o){return o.preferredPayloadType!==void 0?o.preferredPayloadType:o.payloadType}).join(" ")+`\r
`,s+=`c=IN IP4 0.0.0.0\r
`,s+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,i.codecs.forEach(function(o){s+=t.writeRtpMap(o),s+=t.writeFmtp(o),s+=t.writeRtcpFb(o)});var r=0;return i.codecs.forEach(function(o){o.maxptime>r&&(r=o.maxptime)}),r>0&&(s+="a=maxptime:"+r+`\r
`),s+=`a=rtcp-mux\r
`,i.headerExtensions&&i.headerExtensions.forEach(function(o){s+=t.writeExtmap(o)}),s},t.parseRtpEncodingParameters=function(e){var i=[],s=t.parseRtpParameters(e),r=s.fecMechanisms.indexOf("RED")!==-1,o=s.fecMechanisms.indexOf("ULPFEC")!==-1,a=t.matchPrefix(e,"a=ssrc:").map(function(f){return t.parseSsrcMedia(f)}).filter(function(f){return f.attribute==="cname"}),l=a.length>0&&a[0].ssrc,h,u=t.matchPrefix(e,"a=ssrc-group:FID").map(function(f){var p=f.substr(17).split(" ");return p.map(function(g){return parseInt(g,10)})});u.length>0&&u[0].length>1&&u[0][0]===l&&(h=u[0][1]),s.codecs.forEach(function(f){if(f.name.toUpperCase()==="RTX"&&f.parameters.apt){var p={ssrc:l,codecPayloadType:parseInt(f.parameters.apt,10)};l&&h&&(p.rtx={ssrc:h}),i.push(p),r&&(p=JSON.parse(JSON.stringify(p)),p.fec={ssrc:l,mechanism:o?"red+ulpfec":"red"},i.push(p))}}),i.length===0&&l&&i.push({ssrc:l});var d=t.matchPrefix(e,"b=");return d.length&&(d[0].indexOf("b=TIAS:")===0?d=parseInt(d[0].substr(7),10):d[0].indexOf("b=AS:")===0?d=parseInt(d[0].substr(5),10)*1e3*.95-50*40*8:d=void 0,i.forEach(function(f){f.maxBitrate=d})),i},t.parseRtcpParameters=function(e){var i={},s=t.matchPrefix(e,"a=ssrc:").map(function(a){return t.parseSsrcMedia(a)}).filter(function(a){return a.attribute==="cname"})[0];s&&(i.cname=s.value,i.ssrc=s.ssrc);var r=t.matchPrefix(e,"a=rtcp-rsize");i.reducedSize=r.length>0,i.compound=r.length===0;var o=t.matchPrefix(e,"a=rtcp-mux");return i.mux=o.length>0,i},t.parseMsid=function(e){var i,s=t.matchPrefix(e,"a=msid:");if(s.length===1)return i=s[0].substr(7).split(" "),{stream:i[0],track:i[1]};var r=t.matchPrefix(e,"a=ssrc:").map(function(o){return t.parseSsrcMedia(o)}).filter(function(o){return o.attribute==="msid"});if(r.length>0)return i=r[0].value.split(" "),{stream:i[0],track:i[1]}},t.parseSctpDescription=function(e){var i=t.parseMLine(e),s=t.matchPrefix(e,"a=max-message-size:"),r;s.length>0&&(r=parseInt(s[0].substr(19),10)),isNaN(r)&&(r=65536);var o=t.matchPrefix(e,"a=sctp-port:");if(o.length>0)return{port:parseInt(o[0].substr(12),10),protocol:i.fmt,maxMessageSize:r};var a=t.matchPrefix(e,"a=sctpmap:");if(a.length>0){var l=t.matchPrefix(e,"a=sctpmap:")[0].substr(10).split(" ");return{port:parseInt(l[0],10),protocol:l[1],maxMessageSize:r}}},t.writeSctpDescription=function(e,i){var s=[];return e.protocol!=="DTLS/SCTP"?s=["m="+e.kind+" 9 "+e.protocol+" "+i.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+i.port+`\r
`]:s=["m="+e.kind+" 9 "+e.protocol+" "+i.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+i.port+" "+i.protocol+` 65535\r
`],i.maxMessageSize!==void 0&&s.push("a=max-message-size:"+i.maxMessageSize+`\r
`),s.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,21)},t.writeSessionBoilerplate=function(e,i,s){var r,o=i!==void 0?i:2;e?r=e:r=t.generateSessionId();var a=s||"thisisadapterortc";return`v=0\r
o=`+a+" "+r+" "+o+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},t.writeMediaSection=function(e,i,s,r){var o=t.writeRtpDescription(e.kind,i);if(o+=t.writeIceParameters(e.iceGatherer.getLocalParameters()),o+=t.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),s==="offer"?"actpass":"active"),o+="a=mid:"+e.mid+`\r
`,e.direction?o+="a="+e.direction+`\r
`:e.rtpSender&&e.rtpReceiver?o+=`a=sendrecv\r
`:e.rtpSender?o+=`a=sendonly\r
`:e.rtpReceiver?o+=`a=recvonly\r
`:o+=`a=inactive\r
`,e.rtpSender){var a="msid:"+r.id+" "+e.rtpSender.track.id+`\r
`;o+="a="+a,o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+a,e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+a,o+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+`\r
`)}return o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+t.localCName+`\r
`,e.rtpSender&&e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+t.localCName+`\r
`),o},t.getDirection=function(e,i){for(var s=t.splitLines(e),r=0;r<s.length;r++)switch(s[r]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return s[r].substr(2)}return i?t.getDirection(i):"sendrecv"},t.getKind=function(e){var i=t.splitLines(e),s=i[0].split(" ");return s[0].substr(2)},t.isRejected=function(e){return e.split(" ",2)[1]==="0"},t.parseMLine=function(e){var i=t.splitLines(e),s=i[0].substr(2).split(" ");return{kind:s[0],port:parseInt(s[1],10),protocol:s[2],fmt:s.slice(3).join(" ")}},t.parseOLine=function(e){var i=t.matchPrefix(e,"o=")[0],s=i.substr(2).split(" ");return{username:s[0],sessionId:s[1],sessionVersion:parseInt(s[2],10),netType:s[3],addressType:s[4],address:s[5]}},t.isValidSDP=function(e){if(typeof e!="string"||e.length===0)return!1;for(var i=t.splitLines(e),s=0;s<i.length;s++)if(i[s].length<2||i[s].charAt(1)!=="=")return!1;return!0},n.exports=t})(cD);var hD=cD.exports;const LA=Ry(hD);var Qe=hD;function DG(n){return{inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[n.type]||n.type}function G1(n,t,e,i,s){var r=Qe.writeRtpDescription(n.kind,t);if(r+=Qe.writeIceParameters(n.iceGatherer.getLocalParameters()),r+=Qe.writeDtlsParameters(n.dtlsTransport.getLocalParameters(),e==="offer"?"actpass":s||"active"),r+="a=mid:"+n.mid+`\r
`,n.rtpSender&&n.rtpReceiver?r+=`a=sendrecv\r
`:n.rtpSender?r+=`a=sendonly\r
`:n.rtpReceiver?r+=`a=recvonly\r
`:r+=`a=inactive\r
`,n.rtpSender){var o=n.rtpSender._initialTrackId||n.rtpSender.track.id;n.rtpSender._initialTrackId=o;var a="msid:"+(i?i.id:"-")+" "+o+`\r
`;r+="a="+a,r+="a=ssrc:"+n.sendEncodingParameters[0].ssrc+" "+a,n.sendEncodingParameters[0].rtx&&(r+="a=ssrc:"+n.sendEncodingParameters[0].rtx.ssrc+" "+a,r+="a=ssrc-group:FID "+n.sendEncodingParameters[0].ssrc+" "+n.sendEncodingParameters[0].rtx.ssrc+`\r
`)}return r+="a=ssrc:"+n.sendEncodingParameters[0].ssrc+" cname:"+Qe.localCName+`\r
`,n.rtpSender&&n.sendEncodingParameters[0].rtx&&(r+="a=ssrc:"+n.sendEncodingParameters[0].rtx.ssrc+" cname:"+Qe.localCName+`\r
`),r}function kG(n,t){var e=!1;return n=JSON.parse(JSON.stringify(n)),n.filter(function(i){if(i&&(i.urls||i.url)){var s=i.urls||i.url;i.url&&!i.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var r=typeof s=="string";return r&&(s=[s]),s=s.filter(function(o){var a=o.indexOf("turn:")===0&&o.indexOf("transport=udp")!==-1&&o.indexOf("turn:[")===-1&&!e;return a?(e=!0,!0):o.indexOf("stun:")===0&&t>=14393&&o.indexOf("?transport=udp")===-1}),delete i.url,i.urls=r?s[0]:s,!!s.length}})}function Um(n,t){var e={codecs:[],headerExtensions:[],fecMechanisms:[]},i=function(r,o){r=parseInt(r,10);for(var a=0;a<o.length;a++)if(o[a].payloadType===r||o[a].preferredPayloadType===r)return o[a]},s=function(r,o,a,l){var h=i(r.parameters.apt,a),u=i(o.parameters.apt,l);return h&&u&&h.name.toLowerCase()===u.name.toLowerCase()};return n.codecs.forEach(function(r){for(var o=0;o<t.codecs.length;o++){var a=t.codecs[o];if(r.name.toLowerCase()===a.name.toLowerCase()&&r.clockRate===a.clockRate){if(r.name.toLowerCase()==="rtx"&&r.parameters&&a.parameters.apt&&!s(r,a,n.codecs,t.codecs))continue;a=JSON.parse(JSON.stringify(a)),a.numChannels=Math.min(r.numChannels,a.numChannels),e.codecs.push(a),a.rtcpFeedback=a.rtcpFeedback.filter(function(l){for(var h=0;h<r.rtcpFeedback.length;h++)if(r.rtcpFeedback[h].type===l.type&&r.rtcpFeedback[h].parameter===l.parameter)return!0;return!1});break}}}),n.headerExtensions.forEach(function(r){for(var o=0;o<t.headerExtensions.length;o++){var a=t.headerExtensions[o];if(r.uri===a.uri){e.headerExtensions.push(a);break}}}),e}function H1(n,t,e){return{offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[t][n].indexOf(e)!==-1}function Tb(n,t){var e=n.getRemoteCandidates().find(function(i){return t.foundation===i.foundation&&t.ip===i.ip&&t.port===i.port&&t.priority===i.priority&&t.protocol===i.protocol&&t.type===i.type});return e||n.addRemoteCandidate(t),!e}function Kn(n,t){var e=new Error(t);return e.name=n,e.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:void 0,OperationError:void 0}[n],e}var OG=function(n,t){function e(l,h){h.addTrack(l),h.dispatchEvent(new n.MediaStreamTrackEvent("addtrack",{track:l}))}function i(l,h){h.removeTrack(l),h.dispatchEvent(new n.MediaStreamTrackEvent("removetrack",{track:l}))}function s(l,h,u,d){var f=new Event("track");f.track=h,f.receiver=u,f.transceiver={receiver:u},f.streams=d,n.setTimeout(function(){l._dispatchEvent("track",f)})}var r=function(l){var h=this,u=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(f){h[f]=u[f].bind(u)}),this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this._localDescription=null,this._remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.connectionState="new",this.iceGatheringState="new",l=JSON.parse(JSON.stringify(l||{})),this.usingBundle=l.bundlePolicy==="max-bundle",l.rtcpMuxPolicy==="negotiate")throw Kn("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");switch(l.rtcpMuxPolicy||(l.rtcpMuxPolicy="require"),l.iceTransportPolicy){case"all":case"relay":break;default:l.iceTransportPolicy="all";break}switch(l.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:l.bundlePolicy="balanced";break}if(l.iceServers=kG(l.iceServers||[],t),this._iceGatherers=[],l.iceCandidatePoolSize)for(var d=l.iceCandidatePoolSize;d>0;d--)this._iceGatherers.push(new n.RTCIceGatherer({iceServers:l.iceServers,gatherPolicy:l.iceTransportPolicy}));else l.iceCandidatePoolSize=0;this._config=l,this.transceivers=[],this._sdpSessionId=Qe.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=void 0,this._isClosed=!1};Object.defineProperty(r.prototype,"localDescription",{configurable:!0,get:function(){return this._localDescription}}),Object.defineProperty(r.prototype,"remoteDescription",{configurable:!0,get:function(){return this._remoteDescription}}),r.prototype.onicecandidate=null,r.prototype.onaddstream=null,r.prototype.ontrack=null,r.prototype.onremovestream=null,r.prototype.onsignalingstatechange=null,r.prototype.oniceconnectionstatechange=null,r.prototype.onconnectionstatechange=null,r.prototype.onicegatheringstatechange=null,r.prototype.onnegotiationneeded=null,r.prototype.ondatachannel=null,r.prototype._dispatchEvent=function(l,h){this._isClosed||(this.dispatchEvent(h),typeof this["on"+l]=="function"&&this["on"+l](h))},r.prototype._emitGatheringStateChange=function(){var l=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",l)},r.prototype.getConfiguration=function(){return this._config},r.prototype.getLocalStreams=function(){return this.localStreams},r.prototype.getRemoteStreams=function(){return this.remoteStreams},r.prototype._createTransceiver=function(l,h){var u=this.transceivers.length>0,d={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:l,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};if(this.usingBundle&&u)d.iceTransport=this.transceivers[0].iceTransport,d.dtlsTransport=this.transceivers[0].dtlsTransport;else{var f=this._createIceAndDtlsTransports();d.iceTransport=f.iceTransport,d.dtlsTransport=f.dtlsTransport}return h||this.transceivers.push(d),d},r.prototype.addTrack=function(l,h){if(this._isClosed)throw Kn("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");var u=this.transceivers.find(function(p){return p.track===l});if(u)throw Kn("InvalidAccessError","Track already exists.");for(var d,f=0;f<this.transceivers.length;f++)!this.transceivers[f].track&&this.transceivers[f].kind===l.kind&&(d=this.transceivers[f]);return d||(d=this._createTransceiver(l.kind)),this._maybeFireNegotiationNeeded(),this.localStreams.indexOf(h)===-1&&this.localStreams.push(h),d.track=l,d.stream=h,d.rtpSender=new n.RTCRtpSender(l,d.dtlsTransport),d.rtpSender},r.prototype.addStream=function(l){var h=this;if(t>=15025)l.getTracks().forEach(function(d){h.addTrack(d,l)});else{var u=l.clone();l.getTracks().forEach(function(d,f){var p=u.getTracks()[f];d.addEventListener("enabled",function(g){p.enabled=g.enabled})}),u.getTracks().forEach(function(d){h.addTrack(d,u)})}},r.prototype.removeTrack=function(l){if(this._isClosed)throw Kn("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(l instanceof n.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var h=this.transceivers.find(function(f){return f.rtpSender===l});if(!h)throw Kn("InvalidAccessError","Sender was not created by this connection.");var u=h.stream;h.rtpSender.stop(),h.rtpSender=null,h.track=null,h.stream=null;var d=this.transceivers.map(function(f){return f.stream});d.indexOf(u)===-1&&this.localStreams.indexOf(u)>-1&&this.localStreams.splice(this.localStreams.indexOf(u),1),this._maybeFireNegotiationNeeded()},r.prototype.removeStream=function(l){var h=this;l.getTracks().forEach(function(u){var d=h.getSenders().find(function(f){return f.track===u});d&&h.removeTrack(d)})},r.prototype.getSenders=function(){return this.transceivers.filter(function(l){return!!l.rtpSender}).map(function(l){return l.rtpSender})},r.prototype.getReceivers=function(){return this.transceivers.filter(function(l){return!!l.rtpReceiver}).map(function(l){return l.rtpReceiver})},r.prototype._createIceGatherer=function(l,h){var u=this;if(h&&l>0)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var d=new n.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(d,"state",{value:"new",writable:!0}),this.transceivers[l].bufferedCandidateEvents=[],this.transceivers[l].bufferCandidates=function(f){var p=!f.candidate||Object.keys(f.candidate).length===0;d.state=p?"completed":"gathering",u.transceivers[l].bufferedCandidateEvents!==null&&u.transceivers[l].bufferedCandidateEvents.push(f)},d.addEventListener("localcandidate",this.transceivers[l].bufferCandidates),d},r.prototype._gather=function(l,h){var u=this,d=this.transceivers[h].iceGatherer;if(!d.onlocalcandidate){var f=this.transceivers[h].bufferedCandidateEvents;this.transceivers[h].bufferedCandidateEvents=null,d.removeEventListener("localcandidate",this.transceivers[h].bufferCandidates),d.onlocalcandidate=function(p){if(!(u.usingBundle&&h>0)){var g=new Event("icecandidate");g.candidate={sdpMid:l,sdpMLineIndex:h};var m=p.candidate,v=!m||Object.keys(m).length===0;if(v)(d.state==="new"||d.state==="gathering")&&(d.state="completed");else{d.state==="new"&&(d.state="gathering"),m.component=1,m.ufrag=d.getLocalParameters().usernameFragment;var y=Qe.writeCandidate(m);g.candidate=Object.assign(g.candidate,Qe.parseCandidate(y)),g.candidate.candidate=y,g.candidate.toJSON=function(){return{candidate:g.candidate.candidate,sdpMid:g.candidate.sdpMid,sdpMLineIndex:g.candidate.sdpMLineIndex,usernameFragment:g.candidate.usernameFragment}}}var b=Qe.getMediaSections(u._localDescription.sdp);v?b[g.candidate.sdpMLineIndex]+=`a=end-of-candidates\r
`:b[g.candidate.sdpMLineIndex]+="a="+g.candidate.candidate+`\r
`,u._localDescription.sdp=Qe.getDescription(u._localDescription.sdp)+b.join("");var _=u.transceivers.every(function(x){return x.iceGatherer&&x.iceGatherer.state==="completed"});u.iceGatheringState!=="gathering"&&(u.iceGatheringState="gathering",u._emitGatheringStateChange()),v||u._dispatchEvent("icecandidate",g),_&&(u._dispatchEvent("icecandidate",new Event("icecandidate")),u.iceGatheringState="complete",u._emitGatheringStateChange())}},n.setTimeout(function(){f.forEach(function(p){d.onlocalcandidate(p)})},0)}},r.prototype._createIceAndDtlsTransports=function(){var l=this,h=new n.RTCIceTransport(null);h.onicestatechange=function(){l._updateIceConnectionState(),l._updateConnectionState()};var u=new n.RTCDtlsTransport(h);return u.ondtlsstatechange=function(){l._updateConnectionState()},u.onerror=function(){Object.defineProperty(u,"state",{value:"failed",writable:!0}),l._updateConnectionState()},{iceTransport:h,dtlsTransport:u}},r.prototype._disposeIceAndDtlsTransports=function(l){var h=this.transceivers[l].iceGatherer;h&&(delete h.onlocalcandidate,delete this.transceivers[l].iceGatherer);var u=this.transceivers[l].iceTransport;u&&(delete u.onicestatechange,delete this.transceivers[l].iceTransport);var d=this.transceivers[l].dtlsTransport;d&&(delete d.ondtlsstatechange,delete d.onerror,delete this.transceivers[l].dtlsTransport)},r.prototype._transceive=function(l,h,u){var d=Um(l.localCapabilities,l.remoteCapabilities);h&&l.rtpSender&&(d.encodings=l.sendEncodingParameters,d.rtcp={cname:Qe.localCName,compound:l.rtcpParameters.compound},l.recvEncodingParameters.length&&(d.rtcp.ssrc=l.recvEncodingParameters[0].ssrc),l.rtpSender.send(d)),u&&l.rtpReceiver&&d.codecs.length>0&&(l.kind==="video"&&l.recvEncodingParameters&&t<15019&&l.recvEncodingParameters.forEach(function(f){delete f.rtx}),l.recvEncodingParameters.length?d.encodings=l.recvEncodingParameters:d.encodings=[{}],d.rtcp={compound:l.rtcpParameters.compound},l.rtcpParameters.cname&&(d.rtcp.cname=l.rtcpParameters.cname),l.sendEncodingParameters.length&&(d.rtcp.ssrc=l.sendEncodingParameters[0].ssrc),l.rtpReceiver.receive(d))},r.prototype.setLocalDescription=function(l){var h=this;if(["offer","answer"].indexOf(l.type)===-1)return Promise.reject(Kn("TypeError",'Unsupported type "'+l.type+'"'));if(!H1("setLocalDescription",l.type,h.signalingState)||h._isClosed)return Promise.reject(Kn("InvalidStateError","Can not set local "+l.type+" in state "+h.signalingState));var u,d;if(l.type==="offer")u=Qe.splitSections(l.sdp),d=u.shift(),u.forEach(function(p,g){var m=Qe.parseRtpParameters(p);h.transceivers[g].localCapabilities=m}),h.transceivers.forEach(function(p,g){h._gather(p.mid,g)});else if(l.type==="answer"){u=Qe.splitSections(h._remoteDescription.sdp),d=u.shift();var f=Qe.matchPrefix(d,"a=ice-lite").length>0;u.forEach(function(p,g){var m=h.transceivers[g],v=m.iceGatherer,y=m.iceTransport,b=m.dtlsTransport,_=m.localCapabilities,x=m.remoteCapabilities,S=Qe.isRejected(p)&&Qe.matchPrefix(p,"a=bundle-only").length===0;if(!S&&!m.rejected){var T=Qe.getIceParameters(p,d),L=Qe.getDtlsParameters(p,d);f&&(L.role="server"),(!h.usingBundle||g===0)&&(h._gather(m.mid,g),y.state==="new"&&y.start(v,T,f?"controlling":"controlled"),b.state==="new"&&b.start(L));var I=Um(_,x);h._transceive(m,I.codecs.length>0,!1)}})}return h._localDescription={type:l.type,sdp:l.sdp},l.type==="offer"?h._updateSignalingState("have-local-offer"):h._updateSignalingState("stable"),Promise.resolve()},r.prototype.setRemoteDescription=function(l){var h=this;if(["offer","answer"].indexOf(l.type)===-1)return Promise.reject(Kn("TypeError",'Unsupported type "'+l.type+'"'));if(!H1("setRemoteDescription",l.type,h.signalingState)||h._isClosed)return Promise.reject(Kn("InvalidStateError","Can not set remote "+l.type+" in state "+h.signalingState));var u={};h.remoteStreams.forEach(function(y){u[y.id]=y});var d=[],f=Qe.splitSections(l.sdp),p=f.shift(),g=Qe.matchPrefix(p,"a=ice-lite").length>0,m=Qe.matchPrefix(p,"a=group:BUNDLE ").length>0;h.usingBundle=m;var v=Qe.matchPrefix(p,"a=ice-options:")[0];return v?h.canTrickleIceCandidates=v.substr(14).split(" ").indexOf("trickle")>=0:h.canTrickleIceCandidates=!1,f.forEach(function(y,b){var _=Qe.splitLines(y),x=Qe.getKind(y),S=Qe.isRejected(y)&&Qe.matchPrefix(y,"a=bundle-only").length===0,T=_[0].substr(2).split(" ")[2],L=Qe.getDirection(y,p),I=Qe.parseMsid(y),P=Qe.getMid(y)||Qe.generateIdentifier();if(S||x==="application"&&(T==="DTLS/SCTP"||T==="UDP/DTLS/SCTP")){h.transceivers[b]={mid:P,kind:x,protocol:T,rejected:!0};return}!S&&h.transceivers[b]&&h.transceivers[b].rejected&&(h.transceivers[b]=h._createTransceiver(x,!0));var R,B,Q,G,V,X,k,M,H,ee=Qe.parseRtpParameters(y),Y,he;S||(Y=Qe.getIceParameters(y,p),he=Qe.getDtlsParameters(y,p),he.role="client"),k=Qe.parseRtpEncodingParameters(y);var de=Qe.parseRtcpParameters(y),ve=Qe.matchPrefix(y,"a=end-of-candidates",p).length>0,_e=Qe.matchPrefix(y,"a=candidate:").map(function(_t){return Qe.parseCandidate(_t)}).filter(function(_t){return _t.component===1});if((l.type==="offer"||l.type==="answer")&&!S&&m&&b>0&&h.transceivers[b]&&(h._disposeIceAndDtlsTransports(b),h.transceivers[b].iceGatherer=h.transceivers[0].iceGatherer,h.transceivers[b].iceTransport=h.transceivers[0].iceTransport,h.transceivers[b].dtlsTransport=h.transceivers[0].dtlsTransport,h.transceivers[b].rtpSender&&h.transceivers[b].rtpSender.setTransport(h.transceivers[0].dtlsTransport),h.transceivers[b].rtpReceiver&&h.transceivers[b].rtpReceiver.setTransport(h.transceivers[0].dtlsTransport)),l.type==="offer"&&!S){R=h.transceivers[b]||h._createTransceiver(x),R.mid=P,R.iceGatherer||(R.iceGatherer=h._createIceGatherer(b,m)),_e.length&&R.iceTransport.state==="new"&&(ve&&(!m||b===0)?R.iceTransport.setRemoteCandidates(_e):_e.forEach(function(_t){Tb(R.iceTransport,_t)})),M=n.RTCRtpReceiver.getCapabilities(x),t<15019&&(M.codecs=M.codecs.filter(function(_t){return _t.name!=="rtx"})),X=R.sendEncodingParameters||[{ssrc:(2*b+2)*1001}];var Ge=!1;if(L==="sendrecv"||L==="sendonly"){if(Ge=!R.rtpReceiver,V=R.rtpReceiver||new n.RTCRtpReceiver(R.dtlsTransport,x),Ge){var Te;H=V.track,I&&I.stream==="-"||(I?(u[I.stream]||(u[I.stream]=new n.MediaStream,Object.defineProperty(u[I.stream],"id",{get:function(){return I.stream}})),Object.defineProperty(H,"id",{get:function(){return I.track}}),Te=u[I.stream]):(u.default||(u.default=new n.MediaStream),Te=u.default)),Te&&(e(H,Te),R.associatedRemoteMediaStreams.push(Te)),d.push([H,V,Te])}}else R.rtpReceiver&&R.rtpReceiver.track&&(R.associatedRemoteMediaStreams.forEach(function(_t){var $t=_t.getTracks().find(function(yi){return yi.id===R.rtpReceiver.track.id});$t&&i($t,_t)}),R.associatedRemoteMediaStreams=[]);R.localCapabilities=M,R.remoteCapabilities=ee,R.rtpReceiver=V,R.rtcpParameters=de,R.sendEncodingParameters=X,R.recvEncodingParameters=k,h._transceive(h.transceivers[b],!1,Ge)}else if(l.type==="answer"&&!S){R=h.transceivers[b],B=R.iceGatherer,Q=R.iceTransport,G=R.dtlsTransport,V=R.rtpReceiver,X=R.sendEncodingParameters,M=R.localCapabilities,h.transceivers[b].recvEncodingParameters=k,h.transceivers[b].remoteCapabilities=ee,h.transceivers[b].rtcpParameters=de,_e.length&&Q.state==="new"&&((g||ve)&&(!m||b===0)?Q.setRemoteCandidates(_e):_e.forEach(function(_t){Tb(R.iceTransport,_t)})),(!m||b===0)&&(Q.state==="new"&&Q.start(B,Y,"controlling"),G.state==="new"&&G.start(he));var We=Um(R.localCapabilities,R.remoteCapabilities),It=We.codecs.filter(function(_t){return _t.name.toLowerCase()==="rtx"}).length;!It&&R.sendEncodingParameters[0].rtx&&delete R.sendEncodingParameters[0].rtx,h._transceive(R,L==="sendrecv"||L==="recvonly",L==="sendrecv"||L==="sendonly"),V&&(L==="sendrecv"||L==="sendonly")?(H=V.track,I?(u[I.stream]||(u[I.stream]=new n.MediaStream),e(H,u[I.stream]),d.push([H,V,u[I.stream]])):(u.default||(u.default=new n.MediaStream),e(H,u.default),d.push([H,V,u.default]))):delete R.rtpReceiver}}),h._dtlsRole===void 0&&(h._dtlsRole=l.type==="offer"?"active":"passive"),h._remoteDescription={type:l.type,sdp:l.sdp},l.type==="offer"?h._updateSignalingState("have-remote-offer"):h._updateSignalingState("stable"),Object.keys(u).forEach(function(y){var b=u[y];if(b.getTracks().length){if(h.remoteStreams.indexOf(b)===-1){h.remoteStreams.push(b);var _=new Event("addstream");_.stream=b,n.setTimeout(function(){h._dispatchEvent("addstream",_)})}d.forEach(function(x){var S=x[0],T=x[1];b.id===x[2].id&&s(h,S,T,[b])})}}),d.forEach(function(y){y[2]||s(h,y[0],y[1],[])}),n.setTimeout(function(){h&&h.transceivers&&h.transceivers.forEach(function(y){y.iceTransport&&y.iceTransport.state==="new"&&y.iceTransport.getRemoteCandidates().length>0&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),y.iceTransport.addRemoteCandidate({}))})},4e3),Promise.resolve()},r.prototype.close=function(){this.transceivers.forEach(function(l){l.iceTransport&&l.iceTransport.stop(),l.dtlsTransport&&l.dtlsTransport.stop(),l.rtpSender&&l.rtpSender.stop(),l.rtpReceiver&&l.rtpReceiver.stop()}),this._isClosed=!0,this._updateSignalingState("closed")},r.prototype._updateSignalingState=function(l){this.signalingState=l;var h=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",h)},r.prototype._maybeFireNegotiationNeeded=function(){var l=this;this.signalingState!=="stable"||this.needNegotiation===!0||(this.needNegotiation=!0,n.setTimeout(function(){if(l.needNegotiation){l.needNegotiation=!1;var h=new Event("negotiationneeded");l._dispatchEvent("negotiationneeded",h)}},0))},r.prototype._updateIceConnectionState=function(){var l,h={new:0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(d){d.iceTransport&&!d.rejected&&h[d.iceTransport.state]++}),l="new",h.failed>0?l="failed":h.checking>0?l="checking":h.disconnected>0?l="disconnected":h.new>0?l="new":h.connected>0?l="connected":h.completed>0&&(l="completed"),l!==this.iceConnectionState){this.iceConnectionState=l;var u=new Event("iceconnectionstatechange");this._dispatchEvent("iceconnectionstatechange",u)}},r.prototype._updateConnectionState=function(){var l,h={new:0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(d){d.iceTransport&&d.dtlsTransport&&!d.rejected&&(h[d.iceTransport.state]++,h[d.dtlsTransport.state]++)}),h.connected+=h.completed,l="new",h.failed>0?l="failed":h.connecting>0?l="connecting":h.disconnected>0?l="disconnected":h.new>0?l="new":h.connected>0&&(l="connected"),l!==this.connectionState){this.connectionState=l;var u=new Event("connectionstatechange");this._dispatchEvent("connectionstatechange",u)}},r.prototype.createOffer=function(){var l=this;if(l._isClosed)return Promise.reject(Kn("InvalidStateError","Can not call createOffer after close"));var h=l.transceivers.filter(function(g){return g.kind==="audio"}).length,u=l.transceivers.filter(function(g){return g.kind==="video"}).length,d=arguments[0];if(d){if(d.mandatory||d.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");d.offerToReceiveAudio!==void 0&&(d.offerToReceiveAudio===!0?h=1:d.offerToReceiveAudio===!1?h=0:h=d.offerToReceiveAudio),d.offerToReceiveVideo!==void 0&&(d.offerToReceiveVideo===!0?u=1:d.offerToReceiveVideo===!1?u=0:u=d.offerToReceiveVideo)}for(l.transceivers.forEach(function(g){g.kind==="audio"?(h--,h<0&&(g.wantReceive=!1)):g.kind==="video"&&(u--,u<0&&(g.wantReceive=!1))});h>0||u>0;)h>0&&(l._createTransceiver("audio"),h--),u>0&&(l._createTransceiver("video"),u--);var f=Qe.writeSessionBoilerplate(l._sdpSessionId,l._sdpSessionVersion++);l.transceivers.forEach(function(g,m){var v=g.track,y=g.kind,b=g.mid||Qe.generateIdentifier();g.mid=b,g.iceGatherer||(g.iceGatherer=l._createIceGatherer(m,l.usingBundle));var _=n.RTCRtpSender.getCapabilities(y);t<15019&&(_.codecs=_.codecs.filter(function(S){return S.name!=="rtx"})),_.codecs.forEach(function(S){S.name==="H264"&&S.parameters["level-asymmetry-allowed"]===void 0&&(S.parameters["level-asymmetry-allowed"]="1"),g.remoteCapabilities&&g.remoteCapabilities.codecs&&g.remoteCapabilities.codecs.forEach(function(T){S.name.toLowerCase()===T.name.toLowerCase()&&S.clockRate===T.clockRate&&(S.preferredPayloadType=T.payloadType)})}),_.headerExtensions.forEach(function(S){var T=g.remoteCapabilities&&g.remoteCapabilities.headerExtensions||[];T.forEach(function(L){S.uri===L.uri&&(S.id=L.id)})});var x=g.sendEncodingParameters||[{ssrc:(2*m+1)*1001}];v&&t>=15019&&y==="video"&&!x[0].rtx&&(x[0].rtx={ssrc:x[0].ssrc+1}),g.wantReceive&&(g.rtpReceiver=new n.RTCRtpReceiver(g.dtlsTransport,y)),g.localCapabilities=_,g.sendEncodingParameters=x}),l._config.bundlePolicy!=="max-compat"&&(f+="a=group:BUNDLE "+l.transceivers.map(function(g){return g.mid}).join(" ")+`\r
`),f+=`a=ice-options:trickle\r
`,l.transceivers.forEach(function(g,m){f+=G1(g,g.localCapabilities,"offer",g.stream,l._dtlsRole),f+=`a=rtcp-rsize\r
`,g.iceGatherer&&l.iceGatheringState!=="new"&&(m===0||!l.usingBundle)&&(g.iceGatherer.getLocalCandidates().forEach(function(v){v.component=1,f+="a="+Qe.writeCandidate(v)+`\r
`}),g.iceGatherer.state==="completed"&&(f+=`a=end-of-candidates\r
`))});var p=new n.RTCSessionDescription({type:"offer",sdp:f});return Promise.resolve(p)},r.prototype.createAnswer=function(){var l=this;if(l._isClosed)return Promise.reject(Kn("InvalidStateError","Can not call createAnswer after close"));if(!(l.signalingState==="have-remote-offer"||l.signalingState==="have-local-pranswer"))return Promise.reject(Kn("InvalidStateError","Can not call createAnswer in signalingState "+l.signalingState));var h=Qe.writeSessionBoilerplate(l._sdpSessionId,l._sdpSessionVersion++);l.usingBundle&&(h+="a=group:BUNDLE "+l.transceivers.map(function(f){return f.mid}).join(" ")+`\r
`),h+=`a=ice-options:trickle\r
`;var u=Qe.getMediaSections(l._remoteDescription.sdp).length;l.transceivers.forEach(function(f,p){if(!(p+1>u)){if(f.rejected){f.kind==="application"?f.protocol==="DTLS/SCTP"?h+=`m=application 0 DTLS/SCTP 5000\r
`:h+="m=application 0 "+f.protocol+` webrtc-datachannel\r
`:f.kind==="audio"?h+=`m=audio 0 UDP/TLS/RTP/SAVPF 0\r
a=rtpmap:0 PCMU/8000\r
`:f.kind==="video"&&(h+=`m=video 0 UDP/TLS/RTP/SAVPF 120\r
a=rtpmap:120 VP8/90000\r
`),h+=`c=IN IP4 0.0.0.0\r
a=inactive\r
a=mid:`+f.mid+`\r
`;return}if(f.stream){var g;f.kind==="audio"?g=f.stream.getAudioTracks()[0]:f.kind==="video"&&(g=f.stream.getVideoTracks()[0]),g&&t>=15019&&f.kind==="video"&&!f.sendEncodingParameters[0].rtx&&(f.sendEncodingParameters[0].rtx={ssrc:f.sendEncodingParameters[0].ssrc+1})}var m=Um(f.localCapabilities,f.remoteCapabilities),v=m.codecs.filter(function(y){return y.name.toLowerCase()==="rtx"}).length;!v&&f.sendEncodingParameters[0].rtx&&delete f.sendEncodingParameters[0].rtx,h+=G1(f,m,"answer",f.stream,l._dtlsRole),f.rtcpParameters&&f.rtcpParameters.reducedSize&&(h+=`a=rtcp-rsize\r
`)}});var d=new n.RTCSessionDescription({type:"answer",sdp:h});return Promise.resolve(d)},r.prototype.addIceCandidate=function(l){var h=this,u;return l&&!(l.sdpMLineIndex!==void 0||l.sdpMid)?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise(function(d,f){if(h._remoteDescription)if(!l||l.candidate==="")for(var p=0;p<h.transceivers.length&&!(!h.transceivers[p].rejected&&(h.transceivers[p].iceTransport.addRemoteCandidate({}),u=Qe.getMediaSections(h._remoteDescription.sdp),u[p]+=`a=end-of-candidates\r
`,h._remoteDescription.sdp=Qe.getDescription(h._remoteDescription.sdp)+u.join(""),h.usingBundle));p++);else{var g=l.sdpMLineIndex;if(l.sdpMid){for(var m=0;m<h.transceivers.length;m++)if(h.transceivers[m].mid===l.sdpMid){g=m;break}}var v=h.transceivers[g];if(v){if(v.rejected)return d();var y=Object.keys(l.candidate).length>0?Qe.parseCandidate(l.candidate):{};if(y.protocol==="tcp"&&(y.port===0||y.port===9)||y.component&&y.component!==1)return d();if((g===0||g>0&&v.iceTransport!==h.transceivers[0].iceTransport)&&!Tb(v.iceTransport,y))return f(Kn("OperationError","Can not add ICE candidate"));var b=l.candidate.trim();b.indexOf("a=")===0&&(b=b.substr(2)),u=Qe.getMediaSections(h._remoteDescription.sdp),u[g]+="a="+(y.type?b:"end-of-candidates")+`\r
`,h._remoteDescription.sdp=Qe.getDescription(h._remoteDescription.sdp)+u.join("")}else return f(Kn("OperationError","Can not add ICE candidate"))}else return f(Kn("InvalidStateError","Can not add ICE candidate without a remote description"));d()})},r.prototype.getStats=function(l){if(l&&l instanceof n.MediaStreamTrack){var h=null;if(this.transceivers.forEach(function(d){d.rtpSender&&d.rtpSender.track===l?h=d.rtpSender:d.rtpReceiver&&d.rtpReceiver.track===l&&(h=d.rtpReceiver)}),!h)throw Kn("InvalidAccessError","Invalid selector.");return h.getStats()}var u=[];return this.transceivers.forEach(function(d){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(f){d[f]&&u.push(d[f].getStats())})}),Promise.all(u).then(function(d){var f=new Map;return d.forEach(function(p){p.forEach(function(g){f.set(g.id,g)})}),f})};var o=["RTCRtpSender","RTCRtpReceiver","RTCIceGatherer","RTCIceTransport","RTCDtlsTransport"];o.forEach(function(l){var h=n[l];if(h&&h.prototype&&h.prototype.getStats){var u=h.prototype.getStats;h.prototype.getStats=function(){return u.apply(this).then(function(d){var f=new Map;return Object.keys(d).forEach(function(p){d[p].type=DG(d[p]),f.set(p,d[p])}),f})}}});var a=["createOffer","createAnswer"];return a.forEach(function(l){var h=r.prototype[l];r.prototype[l]=function(){var u=arguments;return typeof u[0]=="function"||typeof u[1]=="function"?h.apply(this,[arguments[2]]).then(function(d){typeof u[0]=="function"&&u[0].apply(null,[d])},function(d){typeof u[1]=="function"&&u[1].apply(null,[d])}):h.apply(this,arguments)}}),a=["setLocalDescription","setRemoteDescription","addIceCandidate"],a.forEach(function(l){var h=r.prototype[l];r.prototype[l]=function(){var u=arguments;return typeof u[1]=="function"||typeof u[2]=="function"?h.apply(this,arguments).then(function(){typeof u[1]=="function"&&u[1].apply(null)},function(d){typeof u[2]=="function"&&u[2].apply(null,[d])}):h.apply(this,arguments)}}),["getStats"].forEach(function(l){var h=r.prototype[l];r.prototype[l]=function(){var u=arguments;return typeof u[1]=="function"?h.apply(this,arguments).then(function(){typeof u[1]=="function"&&u[1].apply(null)}):h.apply(this,arguments)}}),r};const LG=Ry(OG);function uD(n){const t=n&&n.navigator,e=function(s){return{name:{PermissionDeniedError:"NotAllowedError"}[s.name]||s.name,message:s.message,constraint:s.constraint,toString(){return this.name}}},i=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(s){return i(s).catch(r=>Promise.reject(e(r)))}}function dD(n){"getDisplayMedia"in n.navigator&&n.navigator.mediaDevices&&(n.navigator.mediaDevices&&"getDisplayMedia"in n.navigator.mediaDevices||(n.navigator.mediaDevices.getDisplayMedia=n.navigator.getDisplayMedia.bind(n.navigator)))}function pw(n,t){if(n.RTCIceGatherer&&(n.RTCIceCandidate||(n.RTCIceCandidate=function(s){return s}),n.RTCSessionDescription||(n.RTCSessionDescription=function(s){return s}),t.version<15025)){const i=Object.getOwnPropertyDescriptor(n.MediaStreamTrack.prototype,"enabled");Object.defineProperty(n.MediaStreamTrack.prototype,"enabled",{set(s){i.set.call(this,s);const r=new Event("enabled");r.enabled=s,this.dispatchEvent(r)}})}n.RTCRtpSender&&!("dtmf"in n.RTCRtpSender.prototype)&&Object.defineProperty(n.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=new n.RTCDtmfSender(this):this.track.kind==="video"&&(this._dtmf=null)),this._dtmf}}),n.RTCDtmfSender&&!n.RTCDTMFSender&&(n.RTCDTMFSender=n.RTCDtmfSender);const e=LG(n,t.version);n.RTCPeerConnection=function(s){return s&&s.iceServers&&(s.iceServers=MG(s.iceServers,t.version),hC("ICE servers after filtering:",s.iceServers)),new e(s)},n.RTCPeerConnection.prototype=e.prototype}function fD(n){n.RTCRtpSender&&!("replaceTrack"in n.RTCRtpSender.prototype)&&(n.RTCRtpSender.prototype.replaceTrack=n.RTCRtpSender.prototype.setTrack)}const V1=Object.freeze(Object.defineProperty({__proto__:null,shimGetDisplayMedia:dD,shimGetUserMedia:uD,shimPeerConnection:pw,shimReplaceTrack:fD},Symbol.toStringTag,{value:"Module"}));function pD(n,t){const e=n&&n.navigator,i=n&&n.MediaStreamTrack;if(e.getUserMedia=function(s,r,o){By("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),e.mediaDevices.getUserMedia(s).then(r,o)},!(t.version>55&&"autoGainControl"in e.mediaDevices.getSupportedConstraints())){const s=function(o,a,l){a in o&&!(l in o)&&(o[l]=o[a],delete o[a])},r=e.mediaDevices.getUserMedia.bind(e.mediaDevices);if(e.mediaDevices.getUserMedia=function(o){return typeof o=="object"&&typeof o.audio=="object"&&(o=JSON.parse(JSON.stringify(o)),s(o.audio,"autoGainControl","mozAutoGainControl"),s(o.audio,"noiseSuppression","mozNoiseSuppression")),r(o)},i&&i.prototype.getSettings){const o=i.prototype.getSettings;i.prototype.getSettings=function(){const a=o.apply(this,arguments);return s(a,"mozAutoGainControl","autoGainControl"),s(a,"mozNoiseSuppression","noiseSuppression"),a}}if(i&&i.prototype.applyConstraints){const o=i.prototype.applyConstraints;i.prototype.applyConstraints=function(a){return this.kind==="audio"&&typeof a=="object"&&(a=JSON.parse(JSON.stringify(a)),s(a,"autoGainControl","mozAutoGainControl"),s(a,"noiseSuppression","mozNoiseSuppression")),o.apply(this,[a])}}}}function FG(n,t){n.navigator.mediaDevices&&"getDisplayMedia"in n.navigator.mediaDevices||n.navigator.mediaDevices&&(n.navigator.mediaDevices.getDisplayMedia=function(i){if(!(i&&i.video)){const s=new DOMException("getDisplayMedia without video constraints is undefined");return s.name="NotFoundError",s.code=8,Promise.reject(s)}return i.video===!0?i.video={mediaSource:t}:i.video.mediaSource=t,n.navigator.mediaDevices.getUserMedia(i)})}function gD(n){typeof n=="object"&&n.RTCTrackEvent&&"receiver"in n.RTCTrackEvent.prototype&&!("transceiver"in n.RTCTrackEvent.prototype)&&Object.defineProperty(n.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function gw(n,t){if(typeof n!="object"||!(n.RTCPeerConnection||n.mozRTCPeerConnection))return;!n.RTCPeerConnection&&n.mozRTCPeerConnection&&(n.RTCPeerConnection=n.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(s){const r=n.RTCPeerConnection.prototype[s],o={[s](){return arguments[0]=new(s==="addIceCandidate"?n.RTCIceCandidate:n.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}};n.RTCPeerConnection.prototype[s]=o[s]});const e={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},i=n.RTCPeerConnection.prototype.getStats;n.RTCPeerConnection.prototype.getStats=function(){const[r,o,a]=arguments;return i.apply(this,[r||null]).then(l=>{if(t.version<53&&!o)try{l.forEach(h=>{h.type=e[h.type]||h.type})}catch(h){if(h.name!=="TypeError")throw h;l.forEach((u,d)=>{l.set(d,Object.assign({},u,{type:e[u.type]||u.type}))})}return l}).then(o,a)}}function mD(n){if(!(typeof n=="object"&&n.RTCPeerConnection&&n.RTCRtpSender)||n.RTCRtpSender&&"getStats"in n.RTCRtpSender.prototype)return;const t=n.RTCPeerConnection.prototype.getSenders;t&&(n.RTCPeerConnection.prototype.getSenders=function(){const s=t.apply(this,[]);return s.forEach(r=>r._pc=this),s});const e=n.RTCPeerConnection.prototype.addTrack;e&&(n.RTCPeerConnection.prototype.addTrack=function(){const s=e.apply(this,arguments);return s._pc=this,s}),n.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function AD(n){if(!(typeof n=="object"&&n.RTCPeerConnection&&n.RTCRtpSender)||n.RTCRtpSender&&"getStats"in n.RTCRtpReceiver.prototype)return;const t=n.RTCPeerConnection.prototype.getReceivers;t&&(n.RTCPeerConnection.prototype.getReceivers=function(){const i=t.apply(this,[]);return i.forEach(s=>s._pc=this),i}),Vd(n,"track",e=>(e.receiver._pc=e.srcElement,e)),n.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function vD(n){!n.RTCPeerConnection||"removeStream"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.removeStream=function(e){By("removeStream","removeTrack"),this.getSenders().forEach(i=>{i.track&&e.getTracks().includes(i.track)&&this.removeTrack(i)})})}function yD(n){n.DataChannel&&!n.RTCDataChannel&&(n.RTCDataChannel=n.DataChannel)}function bD(n){if(!(typeof n=="object"&&n.RTCPeerConnection))return;const t=n.RTCPeerConnection.prototype.addTransceiver;t&&(n.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];const i=arguments[1],s=i&&"sendEncodings"in i;s&&i.sendEncodings.forEach(o=>{if("rid"in o&&!/^[a-z0-9]{0,16}$/i.test(o.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in o&&!(parseFloat(o.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in o&&!(parseFloat(o.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const r=t.apply(this,arguments);if(s){const{sender:o}=r,a=o.getParameters();(!("encodings"in a)||a.encodings.length===1&&Object.keys(a.encodings[0]).length===0)&&(a.encodings=i.sendEncodings,o.sendEncodings=i.sendEncodings,this.setParametersPromises.push(o.setParameters(a).then(()=>{delete o.sendEncodings}).catch(()=>{delete o.sendEncodings})))}return r})}function _D(n){if(!(typeof n=="object"&&n.RTCRtpSender))return;const t=n.RTCRtpSender.prototype.getParameters;t&&(n.RTCRtpSender.prototype.getParameters=function(){const i=t.apply(this,arguments);return"encodings"in i||(i.encodings=[].concat(this.sendEncodings||[{}])),i})}function wD(n){if(!(typeof n=="object"&&n.RTCPeerConnection))return;const t=n.RTCPeerConnection.prototype.createOffer;n.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}function xD(n){if(!(typeof n=="object"&&n.RTCPeerConnection))return;const t=n.RTCPeerConnection.prototype.createAnswer;n.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}const W1=Object.freeze(Object.defineProperty({__proto__:null,shimAddTransceiver:bD,shimCreateAnswer:xD,shimCreateOffer:wD,shimGetDisplayMedia:FG,shimGetParameters:_D,shimGetUserMedia:pD,shimOnTrack:gD,shimPeerConnection:gw,shimRTCDataChannel:yD,shimReceiverGetStats:AD,shimRemoveStream:vD,shimSenderGetStats:mD},Symbol.toStringTag,{value:"Module"}));function CD(n){if(!(typeof n!="object"||!n.RTCPeerConnection)){if("getLocalStreams"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in n.RTCPeerConnection.prototype)){const t=n.RTCPeerConnection.prototype.addTrack;n.RTCPeerConnection.prototype.addStream=function(i){this._localStreams||(this._localStreams=[]),this._localStreams.includes(i)||this._localStreams.push(i),i.getAudioTracks().forEach(s=>t.call(this,s,i)),i.getVideoTracks().forEach(s=>t.call(this,s,i))},n.RTCPeerConnection.prototype.addTrack=function(i,...s){return s&&s.forEach(r=>{this._localStreams?this._localStreams.includes(r)||this._localStreams.push(r):this._localStreams=[r]}),t.apply(this,arguments)}}"removeStream"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);const i=this._localStreams.indexOf(e);if(i===-1)return;this._localStreams.splice(i,1);const s=e.getTracks();this.getSenders().forEach(r=>{s.includes(r.track)&&this.removeTrack(r)})})}}function SD(n){if(!(typeof n!="object"||!n.RTCPeerConnection)&&("getRemoteStreams"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in n.RTCPeerConnection.prototype))){Object.defineProperty(n.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(e){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=i=>{i.streams.forEach(s=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(s))return;this._remoteStreams.push(s);const r=new Event("addstream");r.stream=s,this.dispatchEvent(r)})})}});const t=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(){const i=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(s){s.streams.forEach(r=>{if(i._remoteStreams||(i._remoteStreams=[]),i._remoteStreams.indexOf(r)>=0)return;i._remoteStreams.push(r);const o=new Event("addstream");o.stream=r,i.dispatchEvent(o)})}),t.apply(i,arguments)}}}function ED(n){if(typeof n!="object"||!n.RTCPeerConnection)return;const t=n.RTCPeerConnection.prototype,e=t.createOffer,i=t.createAnswer,s=t.setLocalDescription,r=t.setRemoteDescription,o=t.addIceCandidate;t.createOffer=function(h,u){const d=arguments.length>=2?arguments[2]:arguments[0],f=e.apply(this,[d]);return u?(f.then(h,u),Promise.resolve()):f},t.createAnswer=function(h,u){const d=arguments.length>=2?arguments[2]:arguments[0],f=i.apply(this,[d]);return u?(f.then(h,u),Promise.resolve()):f};let a=function(l,h,u){const d=s.apply(this,[l]);return u?(d.then(h,u),Promise.resolve()):d};t.setLocalDescription=a,a=function(l,h,u){const d=r.apply(this,[l]);return u?(d.then(h,u),Promise.resolve()):d},t.setRemoteDescription=a,a=function(l,h,u){const d=o.apply(this,[l]);return u?(d.then(h,u),Promise.resolve()):d},t.addIceCandidate=a}function ID(n){const t=n&&n.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){const e=t.mediaDevices,i=e.getUserMedia.bind(e);t.mediaDevices.getUserMedia=s=>i(TD(s))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(i,s,r){t.mediaDevices.getUserMedia(i).then(s,r)}.bind(t))}function TD(n){return n&&n.video!==void 0?Object.assign({},n,{video:$M(n.video)}):n}function RD(n){if(!n.RTCPeerConnection)return;const t=n.RTCPeerConnection;n.RTCPeerConnection=function(i,s){if(i&&i.iceServers){const r=[];for(let o=0;o<i.iceServers.length;o++){let a=i.iceServers[o];!a.hasOwnProperty("urls")&&a.hasOwnProperty("url")?(By("RTCIceServer.url","RTCIceServer.urls"),a=JSON.parse(JSON.stringify(a)),a.urls=a.url,delete a.url,r.push(a)):r.push(i.iceServers[o])}i.iceServers=r}return new t(i,s)},n.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(n.RTCPeerConnection,"generateCertificate",{get(){return t.generateCertificate}})}function BD(n){typeof n=="object"&&n.RTCTrackEvent&&"receiver"in n.RTCTrackEvent.prototype&&!("transceiver"in n.RTCTrackEvent.prototype)&&Object.defineProperty(n.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function PD(n){const t=n.RTCPeerConnection.prototype.createOffer;n.RTCPeerConnection.prototype.createOffer=function(i){if(i){typeof i.offerToReceiveAudio<"u"&&(i.offerToReceiveAudio=!!i.offerToReceiveAudio);const s=this.getTransceivers().find(o=>o.receiver.track.kind==="audio");i.offerToReceiveAudio===!1&&s?s.direction==="sendrecv"?s.setDirection?s.setDirection("sendonly"):s.direction="sendonly":s.direction==="recvonly"&&(s.setDirection?s.setDirection("inactive"):s.direction="inactive"):i.offerToReceiveAudio===!0&&!s&&this.addTransceiver("audio"),typeof i.offerToReceiveVideo<"u"&&(i.offerToReceiveVideo=!!i.offerToReceiveVideo);const r=this.getTransceivers().find(o=>o.receiver.track.kind==="video");i.offerToReceiveVideo===!1&&r?r.direction==="sendrecv"?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":r.direction==="recvonly"&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):i.offerToReceiveVideo===!0&&!r&&this.addTransceiver("video")}return t.apply(this,arguments)}}function MD(n){typeof n!="object"||n.AudioContext||(n.AudioContext=n.webkitAudioContext)}const q1=Object.freeze(Object.defineProperty({__proto__:null,shimAudioContext:MD,shimCallbacksAPI:ED,shimConstraints:TD,shimCreateOfferLegacy:PD,shimGetUserMedia:ID,shimLocalStreamsAPI:CD,shimRTCIceServerUrls:RD,shimRemoteStreamsAPI:SD,shimTrackEventTransceiver:BD},Symbol.toStringTag,{value:"Module"}));function FA(n){if(!n.RTCIceCandidate||n.RTCIceCandidate&&"foundation"in n.RTCIceCandidate.prototype)return;const t=n.RTCIceCandidate;n.RTCIceCandidate=function(i){if(typeof i=="object"&&i.candidate&&i.candidate.indexOf("a=")===0&&(i=JSON.parse(JSON.stringify(i)),i.candidate=i.candidate.substr(2)),i.candidate&&i.candidate.length){const s=new t(i),r=LA.parseCandidate(i.candidate),o=Object.assign(s,r);return o.toJSON=function(){return{candidate:o.candidate,sdpMid:o.sdpMid,sdpMLineIndex:o.sdpMLineIndex,usernameFragment:o.usernameFragment}},o}return new t(i)},n.RTCIceCandidate.prototype=t.prototype,Vd(n,"icecandidate",e=>(e.candidate&&Object.defineProperty(e,"candidate",{value:new n.RTCIceCandidate(e.candidate),writable:"false"}),e))}function rp(n,t){if(!n.RTCPeerConnection)return;"sctp"in n.RTCPeerConnection.prototype||Object.defineProperty(n.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});const e=function(a){if(!a||!a.sdp)return!1;const l=LA.splitSections(a.sdp);return l.shift(),l.some(h=>{const u=LA.parseMLine(h);return u&&u.kind==="application"&&u.protocol.indexOf("SCTP")!==-1})},i=function(a){const l=a.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(l===null||l.length<2)return-1;const h=parseInt(l[1],10);return h!==h?-1:h},s=function(a){let l=65536;return t.browser==="firefox"&&(t.version<57?a===-1?l=16384:l=2147483637:t.version<60?l=t.version===57?65535:65536:l=2147483637),l},r=function(a,l){let h=65536;t.browser==="firefox"&&t.version===57&&(h=65535);const u=LA.matchPrefix(a.sdp,"a=max-message-size:");return u.length>0?h=parseInt(u[0].substr(19),10):t.browser==="firefox"&&l!==-1&&(h=2147483637),h},o=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,t.browser==="chrome"&&t.version>=76){const{sdpSemantics:l}=this.getConfiguration();l==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(e(arguments[0])){const l=i(arguments[0]),h=s(l),u=r(arguments[0],l);let d;h===0&&u===0?d=Number.POSITIVE_INFINITY:h===0||u===0?d=Math.max(h,u):d=Math.min(h,u);const f={};Object.defineProperty(f,"maxMessageSize",{get(){return d}}),this._sctp=f}return o.apply(this,arguments)}}function op(n){if(!(n.RTCPeerConnection&&"createDataChannel"in n.RTCPeerConnection.prototype))return;function t(i,s){const r=i.send;i.send=function(){const a=arguments[0],l=a.length||a.size||a.byteLength;if(i.readyState==="open"&&s.sctp&&l>s.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+s.sctp.maxMessageSize+" bytes)");return r.apply(i,arguments)}}const e=n.RTCPeerConnection.prototype.createDataChannel;n.RTCPeerConnection.prototype.createDataChannel=function(){const s=e.apply(this,arguments);return t(s,this),s},Vd(n,"datachannel",i=>(t(i.channel,i.target),i))}function mw(n){if(!n.RTCPeerConnection||"connectionState"in n.RTCPeerConnection.prototype)return;const t=n.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(e){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),e&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=e)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(e=>{const i=t[e];t[e]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=s=>{const r=s.target;if(r._lastConnectionState!==r.connectionState){r._lastConnectionState=r.connectionState;const o=new Event("connectionstatechange",s);r.dispatchEvent(o)}return s},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),i.apply(this,arguments)}})}function Aw(n,t){if(!n.RTCPeerConnection||t.browser==="chrome"&&t.version>=71||t.browser==="safari"&&t.version>=605)return;const e=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(s){if(s&&s.sdp&&s.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const r=s.sdp.split(`
`).filter(o=>o.trim()!=="a=extmap-allow-mixed").join(`
`);n.RTCSessionDescription&&s instanceof n.RTCSessionDescription?arguments[0]=new n.RTCSessionDescription({type:s.type,sdp:r}):s.sdp=r}return e.apply(this,arguments)}}function UA(n,t){if(!(n.RTCPeerConnection&&n.RTCPeerConnection.prototype))return;const e=n.RTCPeerConnection.prototype.addIceCandidate;!e||e.length===0||(n.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(t.browser==="chrome"&&t.version<78||t.browser==="firefox"&&t.version<68||t.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():e.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}const UG=Object.freeze(Object.defineProperty({__proto__:null,removeExtmapAllowMixed:Aw,shimAddIceCandidateNullOrEmpty:UA,shimConnectionState:mw,shimMaxMessageSize:rp,shimRTCIceCandidate:FA,shimSendThrowTypeError:op},Symbol.toStringTag,{value:"Module"}));function NG({window:n}={},t={shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0}){const e=hC,i=BG(n),s={browserDetails:i,commonShim:UG,extractVersion:sp,disableLog:TG,disableWarnings:RG};switch(i.browser){case"chrome":if(!j1||!fw||!t.shimChrome)return e("Chrome shim is not included in this adapter release."),s;if(i.version===null)return e("Chrome shim can not determine version, not shimming."),s;e("adapter.js shimming chrome."),s.browserShim=j1,UA(n,i),eD(n,i),tD(n),fw(n,i),iD(n),aD(n,i),nD(n),sD(n),rD(n),lD(n,i),FA(n),mw(n),rp(n,i),op(n),Aw(n,i);break;case"firefox":if(!W1||!gw||!t.shimFirefox)return e("Firefox shim is not included in this adapter release."),s;e("adapter.js shimming firefox."),s.browserShim=W1,UA(n,i),pD(n,i),gw(n,i),gD(n),vD(n),mD(n),AD(n),yD(n),bD(n),_D(n),wD(n),xD(n),FA(n),mw(n),rp(n,i),op(n);break;case"edge":if(!V1||!pw||!t.shimEdge)return e("MS edge shim is not included in this adapter release."),s;e("adapter.js shimming edge."),s.browserShim=V1,uD(n),dD(n),pw(n,i),fD(n),rp(n,i),op(n);break;case"safari":if(!q1||!t.shimSafari)return e("Safari shim is not included in this adapter release."),s;e("adapter.js shimming safari."),s.browserShim=q1,UA(n,i),RD(n),PD(n),ED(n),CD(n),SD(n),BD(n),ID(n),MD(n),FA(n),rp(n,i),op(n),Aw(n,i);break;default:e("Unsupported browser!");break}return s}const X1=NG({window:typeof window>"u"?void 0:window});function Qa(n,t,e,i){Object.defineProperty(n,t,{get:e,set:i,enumerable:!0,configurable:!0})}var Rb=X1.default||X1,Df=new(function(){function n(){this.isIOS=["iPad","iPhone","iPod"].includes(navigator.platform),this.supportedBrowsers=["firefox","chrome","safari"],this.minFirefoxVersion=59,this.minChromeVersion=72,this.minSafariVersion=605}return n.prototype.isWebRTCSupported=function(){return typeof RTCPeerConnection<"u"},n.prototype.isBrowserSupported=function(){var t=this.getBrowser(),e=this.getVersion(),i=this.supportedBrowsers.includes(t);return i?t==="chrome"?e>=this.minChromeVersion:t==="firefox"?e>=this.minFirefoxVersion:t==="safari"?!this.isIOS&&e>=this.minSafariVersion:!1:!1},n.prototype.getBrowser=function(){return Rb.browserDetails.browser},n.prototype.getVersion=function(){return Rb.browserDetails.version||0},n.prototype.isUnifiedPlanSupported=function(){var t=this.getBrowser(),e=Rb.browserDetails.version||0;if(t==="chrome"&&e<this.minChromeVersion)return!1;if(t==="firefox"&&e>=this.minFirefoxVersion)return!0;if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;var i,s=!1;try{i=new RTCPeerConnection,i.addTransceiver("audio"),s=!0}catch{}finally{i&&i.close()}return s},n.prototype.toString=function(){return`Supports:
    browser:`.concat(this.getBrowser(),`
    version:`).concat(this.getVersion(),`
    isIOS:`).concat(this.isIOS,`
    isWebRTCSupported:`).concat(this.isWebRTCSupported(),`
    isBrowserSupported:`).concat(this.isBrowserSupported(),`
    isUnifiedPlanSupported:`).concat(this.isUnifiedPlanSupported())},n}()),Y1={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:["turn:eu-0.turn.peerjs.com:3478","turn:us-0.turn.peerjs.com:3478"],username:"peerjs",credential:"peerjsp"}],sdpSemantics:"unified-plan"},QG=function(){function n(){this.CLOUD_HOST="0.peerjs.com",this.CLOUD_PORT=443,this.chunkedBrowsers={Chrome:1,chrome:1},this.chunkedMTU=16300,this.defaultConfig=Y1,this.browser=Df.getBrowser(),this.browserVersion=Df.getVersion(),this.supports=function(){var t={browser:Df.isBrowserSupported(),webRTC:Df.isWebRTCSupported(),audioVideo:!1,data:!1,binaryBlob:!1,reliable:!1};if(!t.webRTC)return t;var e;try{e=new RTCPeerConnection(Y1),t.audioVideo=!0;var i=void 0;try{i=e.createDataChannel("_PEERJSTEST",{ordered:!0}),t.data=!0,t.reliable=!!i.ordered;try{i.binaryType="blob",t.binaryBlob=!Df.isIOS}catch{}}catch{}finally{i&&i.close()}}catch{}finally{e&&e.close()}return t}(),this.pack=U1.pack,this.unpack=U1.unpack,this._dataCount=1}return n.prototype.noop=function(){},n.prototype.validateId=function(t){return!t||/^[A-Za-z0-9]+(?:[ _-][A-Za-z0-9]+)*$/.test(t)},n.prototype.chunk=function(t){for(var e=[],i=t.size,s=Math.ceil(i/wt.chunkedMTU),r=0,o=0;o<i;){var a=Math.min(i,o+wt.chunkedMTU),l=t.slice(o,a),h={__peerData:this._dataCount,n:r,data:l,total:s};e.push(h),o=a,r++}return this._dataCount++,e},n.prototype.blobToArrayBuffer=function(t,e){var i=new FileReader;return i.onload=function(s){s.target&&e(s.target.result)},i.readAsArrayBuffer(t),i},n.prototype.binaryStringToArrayBuffer=function(t){for(var e=new Uint8Array(t.length),i=0;i<t.length;i++)e[i]=t.charCodeAt(i)&255;return e.buffer},n.prototype.randomToken=function(){return Math.random().toString(36).slice(2)},n.prototype.isSecure=function(){return location.protocol==="https:"},n}(),wt=new QG,DD={};Qa(DD,"Peer",()=>bw,n=>bw=n);var Fg={},zG=Object.prototype.hasOwnProperty,Bs="~";function vg(){}Object.create&&(vg.prototype=Object.create(null),new vg().__proto__||(Bs=!1));function jG(n,t,e){this.fn=n,this.context=t,this.once=e||!1}function kD(n,t,e,i,s){if(typeof e!="function")throw new TypeError("The listener must be a function");var r=new jG(e,i||n,s),o=Bs?Bs+t:t;return n._events[o]?n._events[o].fn?n._events[o]=[n._events[o],r]:n._events[o].push(r):(n._events[o]=r,n._eventsCount++),n}function NA(n,t){--n._eventsCount===0?n._events=new vg:delete n._events[t]}function os(){this._events=new vg,this._eventsCount=0}os.prototype.eventNames=function(){var t=[],e,i;if(this._eventsCount===0)return t;for(i in e=this._events)zG.call(e,i)&&t.push(Bs?i.slice(1):i);return Object.getOwnPropertySymbols?t.concat(Object.getOwnPropertySymbols(e)):t};os.prototype.listeners=function(t){var e=Bs?Bs+t:t,i=this._events[e];if(!i)return[];if(i.fn)return[i.fn];for(var s=0,r=i.length,o=new Array(r);s<r;s++)o[s]=i[s].fn;return o};os.prototype.listenerCount=function(t){var e=Bs?Bs+t:t,i=this._events[e];return i?i.fn?1:i.length:0};os.prototype.emit=function(t,e,i,s,r,o){var a=Bs?Bs+t:t;if(!this._events[a])return!1;var l=this._events[a],h=arguments.length,u,d;if(l.fn){switch(l.once&&this.removeListener(t,l.fn,void 0,!0),h){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,e),!0;case 3:return l.fn.call(l.context,e,i),!0;case 4:return l.fn.call(l.context,e,i,s),!0;case 5:return l.fn.call(l.context,e,i,s,r),!0;case 6:return l.fn.call(l.context,e,i,s,r,o),!0}for(d=1,u=new Array(h-1);d<h;d++)u[d-1]=arguments[d];l.fn.apply(l.context,u)}else{var f=l.length,p;for(d=0;d<f;d++)switch(l[d].once&&this.removeListener(t,l[d].fn,void 0,!0),h){case 1:l[d].fn.call(l[d].context);break;case 2:l[d].fn.call(l[d].context,e);break;case 3:l[d].fn.call(l[d].context,e,i);break;case 4:l[d].fn.call(l[d].context,e,i,s);break;default:if(!u)for(p=1,u=new Array(h-1);p<h;p++)u[p-1]=arguments[p];l[d].fn.apply(l[d].context,u)}}return!0};os.prototype.on=function(t,e,i){return kD(this,t,e,i,!1)};os.prototype.once=function(t,e,i){return kD(this,t,e,i,!0)};os.prototype.removeListener=function(t,e,i,s){var r=Bs?Bs+t:t;if(!this._events[r])return this;if(!e)return NA(this,r),this;var o=this._events[r];if(o.fn)o.fn===e&&(!s||o.once)&&(!i||o.context===i)&&NA(this,r);else{for(var a=0,l=[],h=o.length;a<h;a++)(o[a].fn!==e||s&&!o[a].once||i&&o[a].context!==i)&&l.push(o[a]);l.length?this._events[r]=l.length===1?l[0]:l:NA(this,r)}return this};os.prototype.removeAllListeners=function(t){var e;return t?(e=Bs?Bs+t:t,this._events[e]&&NA(this,e)):(this._events=new vg,this._eventsCount=0),this};os.prototype.off=os.prototype.removeListener;os.prototype.addListener=os.prototype.on;os.prefixed=Bs;os.EventEmitter=os;Fg=os;var Ce={};Qa(Ce,"LogLevel",()=>Gs,n=>Gs=n);Qa(Ce,"default",()=>K1,n=>K1=n);var Jc=function(n,t){var e=typeof Symbol=="function"&&n[Symbol.iterator];if(!e)return n;var i=e.call(n),s,r=[],o;try{for(;(t===void 0||t-- >0)&&!(s=i.next()).done;)r.push(s.value)}catch(a){o={error:a}}finally{try{s&&!s.done&&(e=i.return)&&e.call(i)}finally{if(o)throw o.error}}return r},Zc=function(n,t,e){if(e||arguments.length===2)for(var i=0,s=t.length,r;i<s;i++)(r||!(i in t))&&(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return n.concat(r||Array.prototype.slice.call(t))},GG="PeerJS: ",Gs;(function(n){n[n.Disabled=0]="Disabled",n[n.Errors=1]="Errors",n[n.Warnings=2]="Warnings",n[n.All=3]="All"})(Gs||(Gs={}));var HG=function(){function n(){this._logLevel=Gs.Disabled}return Object.defineProperty(n.prototype,"logLevel",{get:function(){return this._logLevel},set:function(t){this._logLevel=t},enumerable:!1,configurable:!0}),n.prototype.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logLevel>=Gs.All&&this._print.apply(this,Zc([Gs.All],Jc(t),!1))},n.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logLevel>=Gs.Warnings&&this._print.apply(this,Zc([Gs.Warnings],Jc(t),!1))},n.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logLevel>=Gs.Errors&&this._print.apply(this,Zc([Gs.Errors],Jc(t),!1))},n.prototype.setLogFunction=function(t){this._print=t},n.prototype._print=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];var s=Zc([GG],Jc(e),!1);for(var r in s)s[r]instanceof Error&&(s[r]="("+s[r].name+") "+s[r].message);t>=Gs.All?console.log.apply(console,Zc([],Jc(s),!1)):t>=Gs.Warnings?console.warn.apply(console,Zc(["WARNING"],Jc(s),!1)):t>=Gs.Errors&&console.error.apply(console,Zc(["ERROR"],Jc(s),!1))},n}(),K1=new HG,OD={};Qa(OD,"Socket",()=>J1,n=>J1=n);var Co;(function(n){n.Data="data",n.Media="media"})(Co||(Co={}));var Ti;(function(n){n.BrowserIncompatible="browser-incompatible",n.Disconnected="disconnected",n.InvalidID="invalid-id",n.InvalidKey="invalid-key",n.Network="network",n.PeerUnavailable="peer-unavailable",n.SslUnavailable="ssl-unavailable",n.ServerError="server-error",n.SocketError="socket-error",n.SocketClosed="socket-closed",n.UnavailableID="unavailable-id",n.WebRTC="webrtc"})(Ti||(Ti={}));var tl;(function(n){n.Binary="binary",n.BinaryUTF8="binary-utf8",n.JSON="json"})(tl||(tl={}));var fl;(function(n){n.Message="message",n.Disconnected="disconnected",n.Error="error",n.Close="close"})(fl||(fl={}));var Mn;(function(n){n.Heartbeat="HEARTBEAT",n.Candidate="CANDIDATE",n.Offer="OFFER",n.Answer="ANSWER",n.Open="OPEN",n.Error="ERROR",n.IdTaken="ID-TAKEN",n.InvalidKey="INVALID-KEY",n.Leave="LEAVE",n.Expire="EXPIRE"})(Mn||(Mn={}));var uC={};uC=JSON.parse('{"name":"peerjs","version":"1.4.7","keywords":["peerjs","webrtc","p2p","rtc"],"description":"PeerJS client","homepage":"https://peerjs.com","bugs":{"url":"https://github.com/peers/peerjs/issues"},"repository":{"type":"git","url":"https://github.com/peers/peerjs"},"license":"MIT","contributors":["Michelle Bu <michelle@michellebu.com>","afrokick <devbyru@gmail.com>","ericz <really.ez@gmail.com>","Jairo <kidandcat@gmail.com>","Jonas Gloning <34194370+jonasgloning@users.noreply.github.com>","Jairo Caro-Accino Viciana <jairo@galax.be>","Carlos Caballero <carlos.caballero.gonzalez@gmail.com>","hc <hheennrryy@gmail.com>","Muhammad Asif <capripio@gmail.com>","PrashoonB <prashoonbhattacharjee@gmail.com>","Harsh Bardhan Mishra <47351025+HarshCasper@users.noreply.github.com>","akotynski <aleksanderkotbury@gmail.com>","lmb <i@lmb.io>","Jairooo <jairocaro@msn.com>","Moritz StÃ¼ckler <moritz.stueckler@gmail.com>","Simon <crydotsnakegithub@gmail.com>","Denis Lukov <denismassters@gmail.com>","Philipp Hancke <fippo@andyet.net>","Hans Oksendahl <hansoksendahl@gmail.com>","Jess <jessachandler@gmail.com>","khankuan <khankuan@gmail.com>","DUODVK <kurmanov.work@gmail.com>","XiZhao <kwang1imsa@gmail.com>","Matthias Lohr <matthias@lohr.me>","=frank tree <=frnktrb@googlemail.com>","Andre Eckardt <aeckardt@outlook.com>","Chris Cowan <agentme49@gmail.com>","Alex Chuev <alex@chuev.com>","alxnull <alxnull@e.mail.de>","Yemel Jardi <angel.jardi@gmail.com>","Ben Parnell <benjaminparnell.94@gmail.com>","Benny Lichtner <bennlich@gmail.com>","fresheneesz <bitetrudpublic@gmail.com>","bob.barstead@exaptive.com <bob.barstead@exaptive.com>","chandika <chandika@gmail.com>","emersion <contact@emersion.fr>","Christopher Van <cvan@users.noreply.github.com>","eddieherm <edhermoso@gmail.com>","Eduardo Pinho <enet4mikeenet@gmail.com>","Evandro Zanatta <ezanatta@tray.net.br>","Gardner Bickford <gardner@users.noreply.github.com>","Gian Luca <gianluca.cecchi@cynny.com>","PatrickJS <github@gdi2290.com>","jonnyf <github@jonathanfoss.co.uk>","Hizkia Felix <hizkifw@gmail.com>","Hristo Oskov <hristo.oskov@gmail.com>","Isaac Madwed <i.madwed@gmail.com>","Ilya Konanykhin <ilya.konanykhin@gmail.com>","jasonbarry <jasbarry@me.com>","Jonathan Burke <jonathan.burke.1311@googlemail.com>","Josh Hamit <josh.hamit@gmail.com>","Jordan Austin <jrax86@gmail.com>","Joel Wetzell <jwetzell@yahoo.com>","xizhao <kevin.wang@cloudera.com>","Alberto Torres <kungfoobar@gmail.com>","Jonathan Mayol <mayoljonathan@gmail.com>","Jefferson Felix <me@jsfelix.dev>","Rolf Erik Lekang <me@rolflekang.com>","Kevin Mai-Husan Chia <mhchia@users.noreply.github.com>","Pepijn de Vos <pepijndevos@gmail.com>","JooYoung <qkdlql@naver.com>","Tobias Speicher <rootcommander@gmail.com>","Steve Blaurock <sblaurock@gmail.com>","Kyrylo Shegeda <shegeda@ualberta.ca>","Diwank Singh Tomer <singh@diwank.name>","SoÌˆren Balko <Soeren.Balko@gmail.com>","Arpit Solanki <solankiarpit1997@gmail.com>","Yuki Ito <yuki@gnnk.net>","Artur Zayats <zag2art@gmail.com>"],"funding":{"type":"opencollective","url":"https://opencollective.com/peer"},"collective":{"type":"opencollective","url":"https://opencollective.com/peer"},"files":["dist/*"],"sideEffects":["lib/global.ts","lib/supports.ts"],"main":"dist/bundler.cjs","module":"dist/bundler.mjs","browser-minified":"dist/peerjs.min.js","browser-unminified":"dist/peerjs.js","types":"dist/types.d.ts","engines":{"node":">= 10"},"targets":{"types":{"source":"lib/exports.ts"},"main":{"source":"lib/exports.ts","sourceMap":{"inlineSources":true}},"module":{"source":"lib/exports.ts","includeNodeModules":["eventemitter3"],"sourceMap":{"inlineSources":true}},"browser-minified":{"context":"browser","outputFormat":"global","optimize":true,"engines":{"browsers":"cover 99%, not dead"},"source":"lib/global.ts"},"browser-unminified":{"context":"browser","outputFormat":"global","optimize":false,"engines":{"browsers":"cover 99%, not dead"},"source":"lib/global.ts"}},"scripts":{"contributors":"git-authors-cli --print=false && prettier --write package.json && git add package.json package-lock.json && git commit -m \\"chore(contributors): update and sort contributors list\\"","check":"tsc --noEmit","watch":"parcel watch","build":"rm -rf dist && parcel build","prepublishOnly":"npm run build","test":"mocha -r ts-node/register -r jsdom-global/register test/**/*.ts","format":"prettier --write .","semantic-release":"semantic-release"},"devDependencies":{"@parcel/config-default":"^2.5.0","@parcel/packager-ts":"^2.5.0","@parcel/transformer-typescript-tsc":"^2.5.0","@parcel/transformer-typescript-types":"^2.5.0","@semantic-release/changelog":"^6.0.1","@semantic-release/git":"^10.0.1","@types/chai":"^4.3.0","@types/mocha":"^9.1.0","@types/node":"^17.0.18","chai":"^4.3.6","git-authors-cli":"^1.0.40","jsdom":"^19.0.0","jsdom-global":"^3.0.2","mocha":"^9.2.0","mock-socket":"8.0.5","parcel":"^2.5.0","parcel-transformer-tsc-sourcemaps":"^1.0.2","prettier":"^2.6.2","semantic-release":"^19.0.2","standard":"^16.0.4","ts-node":"^10.5.0","typescript":"^4.5.5"},"dependencies":{"@swc/helpers":"^0.3.13","eventemitter3":"^4.0.7","peerjs-js-binarypack":"1.0.1","webrtc-adapter":"^7.7.1"}}');var VG=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,s){i.__proto__=s}||function(i,s){for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&(i[r]=s[r])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}(),WG=function(n,t){var e=typeof Symbol=="function"&&n[Symbol.iterator];if(!e)return n;var i=e.call(n),s,r=[],o;try{for(;(t===void 0||t-- >0)&&!(s=i.next()).done;)r.push(s.value)}catch(a){o={error:a}}finally{try{s&&!s.done&&(e=i.return)&&e.call(i)}finally{if(o)throw o.error}}return r},qG=function(n,t,e){if(e||arguments.length===2)for(var i=0,s=t.length,r;i<s;i++)(r||!(i in t))&&(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return n.concat(r||Array.prototype.slice.call(t))},XG=function(n){var t=typeof Symbol=="function"&&Symbol.iterator,e=t&&n[t],i=0;if(e)return e.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&i>=n.length&&(n=void 0),{value:n&&n[i++],done:!n}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},J1=function(n){VG(t,n);function t(e,i,s,r,o,a){a===void 0&&(a=5e3);var l=n.call(this)||this;l.pingInterval=a,l._disconnected=!0,l._messagesQueue=[];var h=e?"wss://":"ws://";return l._baseUrl=h+i+":"+s+r+"peerjs?key="+o,l}return t.prototype.start=function(e,i){var s=this;this._id=e;var r="".concat(this._baseUrl,"&id=").concat(e,"&token=").concat(i);this._socket||!this._disconnected||(this._socket=new WebSocket(r+"&version="+uC.version),this._disconnected=!1,this._socket.onmessage=function(o){var a;try{a=JSON.parse(o.data),Ce.default.log("Server message received:",a)}catch{Ce.default.log("Invalid server message",o.data);return}s.emit(fl.Message,a)},this._socket.onclose=function(o){s._disconnected||(Ce.default.log("Socket closed.",o),s._cleanup(),s._disconnected=!0,s.emit(fl.Disconnected))},this._socket.onopen=function(){s._disconnected||(s._sendQueuedMessages(),Ce.default.log("Socket open"),s._scheduleHeartbeat())})},t.prototype._scheduleHeartbeat=function(){var e=this;this._wsPingTimer=setTimeout(function(){e._sendHeartbeat()},this.pingInterval)},t.prototype._sendHeartbeat=function(){if(!this._wsOpen()){Ce.default.log("Cannot send heartbeat, because socket closed");return}var e=JSON.stringify({type:Mn.Heartbeat});this._socket.send(e),this._scheduleHeartbeat()},t.prototype._wsOpen=function(){return!!this._socket&&this._socket.readyState===1},t.prototype._sendQueuedMessages=function(){var e,i,s=qG([],WG(this._messagesQueue),!1);this._messagesQueue=[];try{for(var r=XG(s),o=r.next();!o.done;o=r.next()){var a=o.value;this.send(a)}}catch(l){e={error:l}}finally{try{o&&!o.done&&(i=r.return)&&i.call(r)}finally{if(e)throw e.error}}},t.prototype.send=function(e){if(!this._disconnected){if(!this._id){this._messagesQueue.push(e);return}if(!e.type){this.emit(fl.Error,"Invalid message");return}if(this._wsOpen()){var i=JSON.stringify(e);this._socket.send(i)}}},t.prototype.close=function(){this._disconnected||(this._cleanup(),this._disconnected=!0)},t.prototype._cleanup=function(){this._socket&&(this._socket.onopen=this._socket.onmessage=this._socket.onclose=null,this._socket.close(),this._socket=void 0),clearTimeout(this._wsPingTimer)},t}(Fg.EventEmitter),vw={};Qa(vw,"MediaConnection",()=>eI,n=>eI=n);var dC={};Qa(dC,"Negotiator",()=>Z1,n=>Z1=n);var mv=function(){return mv=Object.assign||function(n){for(var t,e=1,i=arguments.length;e<i;e++){t=arguments[e];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(n[s]=t[s])}return n},mv.apply(this,arguments)},Nm=function(n,t,e,i){function s(r){return r instanceof e?r:new e(function(o){o(r)})}return new(e||(e=Promise))(function(r,o){function a(u){try{h(i.next(u))}catch(d){o(d)}}function l(u){try{h(i.throw(u))}catch(d){o(d)}}function h(u){u.done?r(u.value):s(u.value).then(a,l)}h((i=i.apply(n,t||[])).next())})},Qm=function(n,t){var e={label:0,sent:function(){if(r[0]&1)throw r[1];return r[1]},trys:[],ops:[]},i,s,r,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(h){return function(u){return l([h,u])}}function l(h){if(i)throw new TypeError("Generator is already executing.");for(;e;)try{if(i=1,s&&(r=h[0]&2?s.return:h[0]?s.throw||((r=s.return)&&r.call(s),0):s.next)&&!(r=r.call(s,h[1])).done)return r;switch(s=0,r&&(h=[h[0]&2,r.value]),h[0]){case 0:case 1:r=h;break;case 4:return e.label++,{value:h[1],done:!1};case 5:e.label++,s=h[1],h=[0];continue;case 7:h=e.ops.pop(),e.trys.pop();continue;default:if(r=e.trys,!(r=r.length>0&&r[r.length-1])&&(h[0]===6||h[0]===2)){e=0;continue}if(h[0]===3&&(!r||h[1]>r[0]&&h[1]<r[3])){e.label=h[1];break}if(h[0]===6&&e.label<r[1]){e.label=r[1],r=h;break}if(r&&e.label<r[2]){e.label=r[2],e.ops.push(h);break}r[2]&&e.ops.pop(),e.trys.pop();continue}h=t.call(n,e)}catch(u){h=[6,u],s=0}finally{i=r=0}if(h[0]&5)throw h[1];return{value:h[0]?h[1]:void 0,done:!0}}},Z1=function(){function n(t){this.connection=t}return n.prototype.startConnection=function(t){var e=this._startPeerConnection();if(this.connection.peerConnection=e,this.connection.type===Co.Media&&t._stream&&this._addTracksToConnection(t._stream,e),t.originator){if(this.connection.type===Co.Data){var i=this.connection,s={ordered:!!t.reliable},r=e.createDataChannel(i.label,s);i.initialize(r)}this._makeOffer()}else this.handleSDP("OFFER",t.sdp)},n.prototype._startPeerConnection=function(){Ce.default.log("Creating RTCPeerConnection.");var t=new RTCPeerConnection(this.connection.provider.options.config);return this._setupListeners(t),t},n.prototype._setupListeners=function(t){var e=this,i=this.connection.peer,s=this.connection.connectionId,r=this.connection.type,o=this.connection.provider;Ce.default.log("Listening for ICE candidates."),t.onicecandidate=function(a){!a.candidate||!a.candidate.candidate||(Ce.default.log("Received ICE candidates for ".concat(i,":"),a.candidate),o.socket.send({type:Mn.Candidate,payload:{candidate:a.candidate,type:r,connectionId:s},dst:i}))},t.oniceconnectionstatechange=function(){switch(t.iceConnectionState){case"failed":Ce.default.log("iceConnectionState is failed, closing connections to "+i),e.connection.emit("error",new Error("Negotiation of connection to "+i+" failed.")),e.connection.close();break;case"closed":Ce.default.log("iceConnectionState is closed, closing connections to "+i),e.connection.emit("error",new Error("Connection to "+i+" closed.")),e.connection.close();break;case"disconnected":Ce.default.log("iceConnectionState changed to disconnected on the connection with "+i);break;case"completed":t.onicecandidate=wt.noop;break}e.connection.emit("iceStateChanged",t.iceConnectionState)},Ce.default.log("Listening for data channel"),t.ondatachannel=function(a){Ce.default.log("Received data channel");var l=a.channel,h=o.getConnection(i,s);h.initialize(l)},Ce.default.log("Listening for remote stream"),t.ontrack=function(a){Ce.default.log("Received remote stream");var l=a.streams[0],h=o.getConnection(i,s);if(h.type===Co.Media){var u=h;e._addStreamToMediaConnection(l,u)}}},n.prototype.cleanup=function(){Ce.default.log("Cleaning up PeerConnection to "+this.connection.peer);var t=this.connection.peerConnection;if(t){this.connection.peerConnection=null,t.onicecandidate=t.oniceconnectionstatechange=t.ondatachannel=t.ontrack=function(){};var e=t.signalingState!=="closed",i=!1;if(this.connection.type===Co.Data){var s=this.connection,r=s.dataChannel;r&&(i=!!r.readyState&&r.readyState!=="closed")}(e||i)&&t.close()}},n.prototype._makeOffer=function(){return Nm(this,void 0,Promise,function(){var t,e,i,s,r,o,a;return Qm(this,function(l){switch(l.label){case 0:t=this.connection.peerConnection,e=this.connection.provider,l.label=1;case 1:return l.trys.push([1,7,,8]),[4,t.createOffer(this.connection.options.constraints)];case 2:i=l.sent(),Ce.default.log("Created offer."),this.connection.options.sdpTransform&&typeof this.connection.options.sdpTransform=="function"&&(i.sdp=this.connection.options.sdpTransform(i.sdp)||i.sdp),l.label=3;case 3:return l.trys.push([3,5,,6]),[4,t.setLocalDescription(i)];case 4:return l.sent(),Ce.default.log("Set localDescription:",i,"for:".concat(this.connection.peer)),s={sdp:i,type:this.connection.type,connectionId:this.connection.connectionId,metadata:this.connection.metadata,browser:wt.browser},this.connection.type===Co.Data&&(r=this.connection,s=mv(mv({},s),{label:r.label,reliable:r.reliable,serialization:r.serialization})),e.socket.send({type:Mn.Offer,payload:s,dst:this.connection.peer}),[3,6];case 5:return o=l.sent(),o!="OperationError: Failed to set local offer sdp: Called in wrong state: kHaveRemoteOffer"&&(e.emitError(Ti.WebRTC,o),Ce.default.log("Failed to setLocalDescription, ",o)),[3,6];case 6:return[3,8];case 7:return a=l.sent(),e.emitError(Ti.WebRTC,a),Ce.default.log("Failed to createOffer, ",a),[3,8];case 8:return[2]}})})},n.prototype._makeAnswer=function(){return Nm(this,void 0,Promise,function(){var t,e,i,s,r;return Qm(this,function(o){switch(o.label){case 0:t=this.connection.peerConnection,e=this.connection.provider,o.label=1;case 1:return o.trys.push([1,7,,8]),[4,t.createAnswer()];case 2:i=o.sent(),Ce.default.log("Created answer."),this.connection.options.sdpTransform&&typeof this.connection.options.sdpTransform=="function"&&(i.sdp=this.connection.options.sdpTransform(i.sdp)||i.sdp),o.label=3;case 3:return o.trys.push([3,5,,6]),[4,t.setLocalDescription(i)];case 4:return o.sent(),Ce.default.log("Set localDescription:",i,"for:".concat(this.connection.peer)),e.socket.send({type:Mn.Answer,payload:{sdp:i,type:this.connection.type,connectionId:this.connection.connectionId,browser:wt.browser},dst:this.connection.peer}),[3,6];case 5:return s=o.sent(),e.emitError(Ti.WebRTC,s),Ce.default.log("Failed to setLocalDescription, ",s),[3,6];case 6:return[3,8];case 7:return r=o.sent(),e.emitError(Ti.WebRTC,r),Ce.default.log("Failed to create answer, ",r),[3,8];case 8:return[2]}})})},n.prototype.handleSDP=function(t,e){return Nm(this,void 0,Promise,function(){var i,s,r,o;return Qm(this,function(a){switch(a.label){case 0:e=new RTCSessionDescription(e),i=this.connection.peerConnection,s=this.connection.provider,Ce.default.log("Setting remote description",e),r=this,a.label=1;case 1:return a.trys.push([1,5,,6]),[4,i.setRemoteDescription(e)];case 2:return a.sent(),Ce.default.log("Set remoteDescription:".concat(t," for:").concat(this.connection.peer)),t!=="OFFER"?[3,4]:[4,r._makeAnswer()];case 3:a.sent(),a.label=4;case 4:return[3,6];case 5:return o=a.sent(),s.emitError(Ti.WebRTC,o),Ce.default.log("Failed to setRemoteDescription, ",o),[3,6];case 6:return[2]}})})},n.prototype.handleCandidate=function(t){return Nm(this,void 0,Promise,function(){var e,i,s,r,o,a;return Qm(this,function(l){switch(l.label){case 0:Ce.default.log("handleCandidate:",t),e=t.candidate,i=t.sdpMLineIndex,s=t.sdpMid,r=this.connection.peerConnection,o=this.connection.provider,l.label=1;case 1:return l.trys.push([1,3,,4]),[4,r.addIceCandidate(new RTCIceCandidate({sdpMid:s,sdpMLineIndex:i,candidate:e}))];case 2:return l.sent(),Ce.default.log("Added ICE candidate for:".concat(this.connection.peer)),[3,4];case 3:return a=l.sent(),o.emitError(Ti.WebRTC,a),Ce.default.log("Failed to handleCandidate, ",a),[3,4];case 4:return[2]}})})},n.prototype._addTracksToConnection=function(t,e){if(Ce.default.log("add tracks from stream ".concat(t.id," to peer connection")),!e.addTrack)return Ce.default.error("Your browser does't support RTCPeerConnection#addTrack. Ignored.");t.getTracks().forEach(function(i){e.addTrack(i,t)})},n.prototype._addStreamToMediaConnection=function(t,e){Ce.default.log("add stream ".concat(t.id," to media connection ").concat(e.connectionId)),e.addStream(t)},n}(),fC={};Qa(fC,"BaseConnection",()=>$1,n=>$1=n);var YG=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,s){i.__proto__=s}||function(i,s){for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&(i[r]=s[r])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}(),$1=function(n){YG(t,n);function t(e,i,s){var r=n.call(this)||this;return r.peer=e,r.provider=i,r.options=s,r._open=!1,r.metadata=s.metadata,r}return Object.defineProperty(t.prototype,"open",{get:function(){return this._open},enumerable:!1,configurable:!0}),t}(Fg.EventEmitter),KG=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,s){i.__proto__=s}||function(i,s){for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&(i[r]=s[r])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}(),Av=function(){return Av=Object.assign||function(n){for(var t,e=1,i=arguments.length;e<i;e++){t=arguments[e];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(n[s]=t[s])}return n},Av.apply(this,arguments)},JG=function(n){var t=typeof Symbol=="function"&&Symbol.iterator,e=t&&n[t],i=0;if(e)return e.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&i>=n.length&&(n=void 0),{value:n&&n[i++],done:!n}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},eI=function(n){KG(t,n);function t(e,i,s){var r=n.call(this,e,i,s)||this;return r._localStream=r.options._stream,r.connectionId=r.options.connectionId||t.ID_PREFIX+wt.randomToken(),r._negotiator=new dC.Negotiator(r),r._localStream&&r._negotiator.startConnection({_stream:r._localStream,originator:!0}),r}return Object.defineProperty(t.prototype,"type",{get:function(){return Co.Media},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"localStream",{get:function(){return this._localStream},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"remoteStream",{get:function(){return this._remoteStream},enumerable:!1,configurable:!0}),t.prototype.addStream=function(e){Ce.default.log("Receiving stream",e),this._remoteStream=e,n.prototype.emit.call(this,"stream",e)},t.prototype.handleMessage=function(e){var i=e.type,s=e.payload;switch(e.type){case Mn.Answer:this._negotiator.handleSDP(i,s.sdp),this._open=!0;break;case Mn.Candidate:this._negotiator.handleCandidate(s.candidate);break;default:Ce.default.warn("Unrecognized message type:".concat(i," from peer:").concat(this.peer));break}},t.prototype.answer=function(e,i){var s,r;if(i===void 0&&(i={}),this._localStream){Ce.default.warn("Local stream already exists on this MediaConnection. Are you answering a call twice?");return}this._localStream=e,i&&i.sdpTransform&&(this.options.sdpTransform=i.sdpTransform),this._negotiator.startConnection(Av(Av({},this.options._payload),{_stream:e}));var o=this.provider._getMessages(this.connectionId);try{for(var a=JG(o),l=a.next();!l.done;l=a.next()){var h=l.value;this.handleMessage(h)}}catch(u){s={error:u}}finally{try{l&&!l.done&&(r=a.return)&&r.call(a)}finally{if(s)throw s.error}}this._open=!0},t.prototype.close=function(){this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this._localStream=null,this._remoteStream=null,this.provider&&(this.provider._removeConnection(this),this.provider=null),this.options&&this.options._stream&&(this.options._stream=null),this.open&&(this._open=!1,n.prototype.emit.call(this,"close"))},t.ID_PREFIX="mc_",t}(fC.BaseConnection),yw={};Qa(yw,"DataConnection",()=>iI,n=>iI=n);var LD={};Qa(LD,"EncodingQueue",()=>tI,n=>tI=n);var ZG=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,s){i.__proto__=s}||function(i,s){for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&(i[r]=s[r])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}(),tI=function(n){ZG(t,n);function t(){var e=n.call(this)||this;return e.fileReader=new FileReader,e._queue=[],e._processing=!1,e.fileReader.onload=function(i){e._processing=!1,i.target&&e.emit("done",i.target.result),e.doNextTask()},e.fileReader.onerror=function(i){Ce.default.error("EncodingQueue error:",i),e._processing=!1,e.destroy(),e.emit("error",i)},e}return Object.defineProperty(t.prototype,"queue",{get:function(){return this._queue},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this.queue.length},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"processing",{get:function(){return this._processing},enumerable:!1,configurable:!0}),t.prototype.enque=function(e){this.queue.push(e),!this.processing&&this.doNextTask()},t.prototype.destroy=function(){this.fileReader.abort(),this._queue=[]},t.prototype.doNextTask=function(){this.size!==0&&(this.processing||(this._processing=!0,this.fileReader.readAsArrayBuffer(this.queue.shift())))},t}(Fg.EventEmitter),$G=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,s){i.__proto__=s}||function(i,s){for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&(i[r]=s[r])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}(),e6=function(n){var t=typeof Symbol=="function"&&Symbol.iterator,e=t&&n[t],i=0;if(e)return e.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&i>=n.length&&(n=void 0),{value:n&&n[i++],done:!n}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},iI=function(n){$G(t,n);function t(e,i,s){var r=n.call(this,e,i,s)||this;return r.stringify=JSON.stringify,r.parse=JSON.parse,r._buffer=[],r._bufferSize=0,r._buffering=!1,r._chunkedData={},r._encodingQueue=new LD.EncodingQueue,r.connectionId=r.options.connectionId||t.ID_PREFIX+wt.randomToken(),r.label=r.options.label||r.connectionId,r.serialization=r.options.serialization||tl.Binary,r.reliable=!!r.options.reliable,r._encodingQueue.on("done",function(o){r._bufferedSend(o)}),r._encodingQueue.on("error",function(){Ce.default.error("DC#".concat(r.connectionId,": Error occured in encoding from blob to arraybuffer, close DC")),r.close()}),r._negotiator=new dC.Negotiator(r),r._negotiator.startConnection(r.options._payload||{originator:!0}),r}return Object.defineProperty(t.prototype,"type",{get:function(){return Co.Data},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dataChannel",{get:function(){return this._dc},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bufferSize",{get:function(){return this._bufferSize},enumerable:!1,configurable:!0}),t.prototype.initialize=function(e){this._dc=e,this._configureDataChannel()},t.prototype._configureDataChannel=function(){var e=this;(!wt.supports.binaryBlob||wt.supports.reliable)&&(this.dataChannel.binaryType="arraybuffer"),this.dataChannel.onopen=function(){Ce.default.log("DC#".concat(e.connectionId," dc connection success")),e._open=!0,e.emit("open")},this.dataChannel.onmessage=function(i){Ce.default.log("DC#".concat(e.connectionId," dc onmessage:"),i.data),e._handleDataMessage(i)},this.dataChannel.onclose=function(){Ce.default.log("DC#".concat(e.connectionId," dc closed for:"),e.peer),e.close()}},t.prototype._handleDataMessage=function(e){var i=this,s=e.data,r=s.constructor,o=this.serialization===tl.Binary||this.serialization===tl.BinaryUTF8,a=s;if(o){if(r===Blob){wt.blobToArrayBuffer(s,function(h){var u=wt.unpack(h);i.emit("data",u)});return}else if(r===ArrayBuffer)a=wt.unpack(s);else if(r===String){var l=wt.binaryStringToArrayBuffer(s);a=wt.unpack(l)}}else this.serialization===tl.JSON&&(a=this.parse(s));if(a.__peerData){this._handleChunk(a);return}n.prototype.emit.call(this,"data",a)},t.prototype._handleChunk=function(e){var i=e.__peerData,s=this._chunkedData[i]||{data:[],count:0,total:e.total};if(s.data[e.n]=e.data,s.count++,this._chunkedData[i]=s,s.total===s.count){delete this._chunkedData[i];var r=new Blob(s.data);this._handleDataMessage({data:r})}},t.prototype.close=function(){this._buffer=[],this._bufferSize=0,this._chunkedData={},this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this.provider&&(this.provider._removeConnection(this),this.provider=null),this.dataChannel&&(this.dataChannel.onopen=null,this.dataChannel.onmessage=null,this.dataChannel.onclose=null,this._dc=null),this._encodingQueue&&(this._encodingQueue.destroy(),this._encodingQueue.removeAllListeners(),this._encodingQueue=null),this.open&&(this._open=!1,n.prototype.emit.call(this,"close"))},t.prototype.send=function(e,i){if(!this.open){n.prototype.emit.call(this,"error",new Error("Connection is not open. You should listen for the `open` event before sending messages."));return}if(this.serialization===tl.JSON)this._bufferedSend(this.stringify(e));else if(this.serialization===tl.Binary||this.serialization===tl.BinaryUTF8){var s=wt.pack(e);if(!i&&s.size>wt.chunkedMTU){this._sendChunks(s);return}wt.supports.binaryBlob?this._bufferedSend(s):this._encodingQueue.enque(s)}else this._bufferedSend(e)},t.prototype._bufferedSend=function(e){(this._buffering||!this._trySend(e))&&(this._buffer.push(e),this._bufferSize=this._buffer.length)},t.prototype._trySend=function(e){var i=this;if(!this.open)return!1;if(this.dataChannel.bufferedAmount>t.MAX_BUFFERED_AMOUNT)return this._buffering=!0,setTimeout(function(){i._buffering=!1,i._tryBuffer()},50),!1;try{this.dataChannel.send(e)}catch(s){return Ce.default.error("DC#:".concat(this.connectionId," Error when sending:"),s),this._buffering=!0,this.close(),!1}return!0},t.prototype._tryBuffer=function(){if(this.open&&this._buffer.length!==0){var e=this._buffer[0];this._trySend(e)&&(this._buffer.shift(),this._bufferSize=this._buffer.length,this._tryBuffer())}},t.prototype._sendChunks=function(e){var i,s,r=wt.chunk(e);Ce.default.log("DC#".concat(this.connectionId," Try to send ").concat(r.length," chunks..."));try{for(var o=e6(r),a=o.next();!a.done;a=o.next()){var l=a.value;this.send(l,!0)}}catch(h){i={error:h}}finally{try{a&&!a.done&&(s=o.return)&&s.call(o)}finally{if(i)throw i.error}}},t.prototype.handleMessage=function(e){var i=e.payload;switch(e.type){case Mn.Answer:this._negotiator.handleSDP(e.type,i.sdp);break;case Mn.Candidate:this._negotiator.handleCandidate(i.candidate);break;default:Ce.default.warn("Unrecognized message type:",e.type,"from peer:",this.peer);break}},t.ID_PREFIX="dc_",t.MAX_BUFFERED_AMOUNT=8388608,t}(fC.BaseConnection),FD={};Qa(FD,"API",()=>rI,n=>rI=n);var nI=function(n,t,e,i){function s(r){return r instanceof e?r:new e(function(o){o(r)})}return new(e||(e=Promise))(function(r,o){function a(u){try{h(i.next(u))}catch(d){o(d)}}function l(u){try{h(i.throw(u))}catch(d){o(d)}}function h(u){u.done?r(u.value):s(u.value).then(a,l)}h((i=i.apply(n,t||[])).next())})},sI=function(n,t){var e={label:0,sent:function(){if(r[0]&1)throw r[1];return r[1]},trys:[],ops:[]},i,s,r,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(h){return function(u){return l([h,u])}}function l(h){if(i)throw new TypeError("Generator is already executing.");for(;e;)try{if(i=1,s&&(r=h[0]&2?s.return:h[0]?s.throw||((r=s.return)&&r.call(s),0):s.next)&&!(r=r.call(s,h[1])).done)return r;switch(s=0,r&&(h=[h[0]&2,r.value]),h[0]){case 0:case 1:r=h;break;case 4:return e.label++,{value:h[1],done:!1};case 5:e.label++,s=h[1],h=[0];continue;case 7:h=e.ops.pop(),e.trys.pop();continue;default:if(r=e.trys,!(r=r.length>0&&r[r.length-1])&&(h[0]===6||h[0]===2)){e=0;continue}if(h[0]===3&&(!r||h[1]>r[0]&&h[1]<r[3])){e.label=h[1];break}if(h[0]===6&&e.label<r[1]){e.label=r[1],r=h;break}if(r&&e.label<r[2]){e.label=r[2],e.ops.push(h);break}r[2]&&e.ops.pop(),e.trys.pop();continue}h=t.call(n,e)}catch(u){h=[6,u],s=0}finally{i=r=0}if(h[0]&5)throw h[1];return{value:h[0]?h[1]:void 0,done:!0}}},rI=function(){function n(t){this._options=t}return n.prototype._buildRequest=function(t){var e=this._options.secure?"https":"http",i=this._options,s=i.host,r=i.port,o=i.path,a=i.key,l=new URL("".concat(e,"://").concat(s,":").concat(r).concat(o).concat(a,"/").concat(t));return l.searchParams.set("ts","".concat(Date.now()).concat(Math.random())),l.searchParams.set("version",uC.version),fetch(l.href,{referrerPolicy:this._options.referrerPolicy})},n.prototype.retrieveId=function(){return nI(this,void 0,Promise,function(){var t,e,i;return sI(this,function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),[4,this._buildRequest("id")];case 1:if(t=s.sent(),t.status!==200)throw new Error("Error. Status:".concat(t.status));return[2,t.text()];case 2:throw e=s.sent(),Ce.default.error("Error retrieving ID",e),i="",this._options.path==="/"&&this._options.host!==wt.CLOUD_HOST&&(i=" If you passed in a `path` to your self-hosted PeerServer, you'll also need to pass in that same path when creating a new Peer."),new Error("Could not get an ID from the server."+i);case 3:return[2]}})})},n.prototype.listAllPeers=function(){return nI(this,void 0,Promise,function(){var t,e,i;return sI(this,function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),[4,this._buildRequest("peers")];case 1:if(t=s.sent(),t.status!==200)throw t.status===401?(e="",this._options.host===wt.CLOUD_HOST?e="It looks like you're using the cloud server. You can email team@peerjs.com to enable peer listing for your API key.":e="You need to enable `allow_discovery` on your self-hosted PeerServer to use this feature.",new Error("It doesn't look like you have permission to list peers IDs. "+e)):new Error("Error. Status:".concat(t.status));return[2,t.json()];case 2:throw i=s.sent(),Ce.default.error("Error retrieving list peers",i),new Error("Could not get list peers from the server."+i);case 3:return[2]}})})},n}(),t6=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,s){i.__proto__=s}||function(i,s){for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&(i[r]=s[r])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}(),Cp=function(){return Cp=Object.assign||function(n){for(var t,e=1,i=arguments.length;e<i;e++){t=arguments[e];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(n[s]=t[s])}return n},Cp.apply(this,arguments)},kf=function(n){var t=typeof Symbol=="function"&&Symbol.iterator,e=t&&n[t],i=0;if(e)return e.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&i>=n.length&&(n=void 0),{value:n&&n[i++],done:!n}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},i6=function(n,t){var e=typeof Symbol=="function"&&n[Symbol.iterator];if(!e)return n;var i=e.call(n),s,r=[],o;try{for(;(t===void 0||t-- >0)&&!(s=i.next()).done;)r.push(s.value)}catch(a){o={error:a}}finally{try{s&&!s.done&&(e=i.return)&&e.call(i)}finally{if(o)throw o.error}}return r},bw=function(n){t6(t,n);function t(e,i){var s=n.call(this)||this;s._id=null,s._lastServerId=null,s._destroyed=!1,s._disconnected=!1,s._open=!1,s._connections=new Map,s._lostMessages=new Map;var r;return e&&e.constructor==Object?i=e:e&&(r=e.toString()),i=Cp({debug:0,host:wt.CLOUD_HOST,port:wt.CLOUD_PORT,path:"/",key:t.DEFAULT_KEY,token:wt.randomToken(),config:wt.defaultConfig,referrerPolicy:"strict-origin-when-cross-origin"},i),s._options=i,s._options.host==="/"&&(s._options.host=window.location.hostname),s._options.path&&(s._options.path[0]!=="/"&&(s._options.path="/"+s._options.path),s._options.path[s._options.path.length-1]!=="/"&&(s._options.path+="/")),s._options.secure===void 0&&s._options.host!==wt.CLOUD_HOST?s._options.secure=wt.isSecure():s._options.host==wt.CLOUD_HOST&&(s._options.secure=!0),s._options.logFunction&&Ce.default.setLogFunction(s._options.logFunction),Ce.default.logLevel=s._options.debug||0,s._api=new FD.API(i),s._socket=s._createServerConnection(),!wt.supports.audioVideo&&!wt.supports.data?(s._delayedAbort(Ti.BrowserIncompatible,"The current browser does not support WebRTC"),s):r&&!wt.validateId(r)?(s._delayedAbort(Ti.InvalidID,'ID "'.concat(r,'" is invalid')),s):(r?s._initialize(r):s._api.retrieveId().then(function(o){return s._initialize(o)}).catch(function(o){return s._abort(Ti.ServerError,o)}),s)}return Object.defineProperty(t.prototype,"id",{get:function(){return this._id},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"options",{get:function(){return this._options},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"open",{get:function(){return this._open},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"socket",{get:function(){return this._socket},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"connections",{get:function(){var e,i,s=Object.create(null);try{for(var r=kf(this._connections),o=r.next();!o.done;o=r.next()){var a=i6(o.value,2),l=a[0],h=a[1];s[l]=h}}catch(u){e={error:u}}finally{try{o&&!o.done&&(i=r.return)&&i.call(r)}finally{if(e)throw e.error}}return s},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"destroyed",{get:function(){return this._destroyed},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"disconnected",{get:function(){return this._disconnected},enumerable:!1,configurable:!0}),t.prototype._createServerConnection=function(){var e=this,i=new OD.Socket(this._options.secure,this._options.host,this._options.port,this._options.path,this._options.key,this._options.pingInterval);return i.on(fl.Message,function(s){e._handleMessage(s)}),i.on(fl.Error,function(s){e._abort(Ti.SocketError,s)}),i.on(fl.Disconnected,function(){e.disconnected||(e.emitError(Ti.Network,"Lost connection to server."),e.disconnect())}),i.on(fl.Close,function(){e.disconnected||e._abort(Ti.SocketClosed,"Underlying socket is already closed.")}),i},t.prototype._initialize=function(e){this._id=e,this.socket.start(e,this._options.token)},t.prototype._handleMessage=function(e){var i,s,r=e.type,o=e.payload,a=e.src;switch(r){case Mn.Open:this._lastServerId=this.id,this._open=!0,this.emit("open",this.id);break;case Mn.Error:this._abort(Ti.ServerError,o.msg);break;case Mn.IdTaken:this._abort(Ti.UnavailableID,'ID "'.concat(this.id,'" is taken'));break;case Mn.InvalidKey:this._abort(Ti.InvalidKey,'API KEY "'.concat(this._options.key,'" is invalid'));break;case Mn.Leave:Ce.default.log("Received leave message from ".concat(a)),this._cleanupPeer(a),this._connections.delete(a);break;case Mn.Expire:this.emitError(Ti.PeerUnavailable,"Could not connect to peer ".concat(a));break;case Mn.Offer:var g=o.connectionId,m=this.getConnection(a,g);if(m&&(m.close(),Ce.default.warn("Offer received for existing Connection ID:".concat(g))),o.type===Co.Media){var l=new vw.MediaConnection(a,this,{connectionId:g,_payload:o,metadata:o.metadata});m=l,this._addConnection(a,m),this.emit("call",l)}else if(o.type===Co.Data){var h=new yw.DataConnection(a,this,{connectionId:g,_payload:o,metadata:o.metadata,label:o.label,serialization:o.serialization,reliable:o.reliable});m=h,this._addConnection(a,m),this.emit("connection",h)}else{Ce.default.warn("Received malformed connection type:".concat(o.type));return}var u=this._getMessages(g);try{for(var d=kf(u),f=d.next();!f.done;f=d.next()){var p=f.value;m.handleMessage(p)}}catch(v){i={error:v}}finally{try{f&&!f.done&&(s=d.return)&&s.call(d)}finally{if(i)throw i.error}}break;default:if(!o){Ce.default.warn("You received a malformed message from ".concat(a," of type ").concat(r));return}var g=o.connectionId,m=this.getConnection(a,g);m&&m.peerConnection?m.handleMessage(e):g?this._storeMessage(g,e):Ce.default.warn("You received an unrecognized message:",e);break}},t.prototype._storeMessage=function(e,i){this._lostMessages.has(e)||this._lostMessages.set(e,[]),this._lostMessages.get(e).push(i)},t.prototype._getMessages=function(e){var i=this._lostMessages.get(e);return i?(this._lostMessages.delete(e),i):[]},t.prototype.connect=function(e,i){if(i===void 0&&(i={}),this.disconnected){Ce.default.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect, or call reconnect on this peer if you believe its ID to still be available."),this.emitError(Ti.Disconnected,"Cannot connect to new Peer after disconnecting from server.");return}var s=new yw.DataConnection(e,this,i);return this._addConnection(e,s),s},t.prototype.call=function(e,i,s){if(s===void 0&&(s={}),this.disconnected){Ce.default.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect."),this.emitError(Ti.Disconnected,"Cannot connect to new Peer after disconnecting from server.");return}if(!i){Ce.default.error("To call a peer, you must provide a stream from your browser's `getUserMedia`.");return}var r=new vw.MediaConnection(e,this,Cp(Cp({},s),{_stream:i}));return this._addConnection(e,r),r},t.prototype._addConnection=function(e,i){Ce.default.log("add connection ".concat(i.type,":").concat(i.connectionId," to peerId:").concat(e)),this._connections.has(e)||this._connections.set(e,[]),this._connections.get(e).push(i)},t.prototype._removeConnection=function(e){var i=this._connections.get(e.peer);if(i){var s=i.indexOf(e);s!==-1&&i.splice(s,1)}this._lostMessages.delete(e.connectionId)},t.prototype.getConnection=function(e,i){var s,r,o=this._connections.get(e);if(!o)return null;try{for(var a=kf(o),l=a.next();!l.done;l=a.next()){var h=l.value;if(h.connectionId===i)return h}}catch(u){s={error:u}}finally{try{l&&!l.done&&(r=a.return)&&r.call(a)}finally{if(s)throw s.error}}return null},t.prototype._delayedAbort=function(e,i){var s=this;setTimeout(function(){s._abort(e,i)},0)},t.prototype._abort=function(e,i){Ce.default.error("Aborting!"),this.emitError(e,i),this._lastServerId?this.disconnect():this.destroy()},t.prototype.emitError=function(e,i){Ce.default.error("Error:",i);var s;typeof i=="string"?s=new Error(i):s=i,s.type=e,this.emit("error",s)},t.prototype.destroy=function(){this.destroyed||(Ce.default.log("Destroy peer with ID:".concat(this.id)),this.disconnect(),this._cleanup(),this._destroyed=!0,this.emit("close"))},t.prototype._cleanup=function(){var e,i;try{for(var s=kf(this._connections.keys()),r=s.next();!r.done;r=s.next()){var o=r.value;this._cleanupPeer(o),this._connections.delete(o)}}catch(a){e={error:a}}finally{try{r&&!r.done&&(i=s.return)&&i.call(s)}finally{if(e)throw e.error}}this.socket.removeAllListeners()},t.prototype._cleanupPeer=function(e){var i,s,r=this._connections.get(e);if(r)try{for(var o=kf(r),a=o.next();!a.done;a=o.next()){var l=a.value;l.close()}}catch(h){i={error:h}}finally{try{a&&!a.done&&(s=o.return)&&s.call(o)}finally{if(i)throw i.error}}},t.prototype.disconnect=function(){if(!this.disconnected){var e=this.id;Ce.default.log("Disconnect peer with ID:".concat(e)),this._disconnected=!0,this._open=!1,this.socket.close(),this._lastServerId=e,this._id=null,this.emit("disconnected",e)}},t.prototype.reconnect=function(){if(this.disconnected&&!this.destroyed)Ce.default.log("Attempting reconnection to server with ID ".concat(this._lastServerId)),this._disconnected=!1,this._initialize(this._lastServerId);else{if(this.destroyed)throw new Error("This peer cannot reconnect to the server. It has already been destroyed.");if(!this.disconnected&&!this.open)Ce.default.error("In a hurry? We're still trying to make the initial connection!");else throw new Error("Peer ".concat(this.id," cannot reconnect because it is not disconnected from the server!"))}},t.prototype.listAllPeers=function(e){var i=this;e===void 0&&(e=function(s){}),this._api.listAllPeers().then(function(s){return e(s)}).catch(function(s){return i._abort(Ti.ServerError,s)})},t.DEFAULT_KEY="peerjs",t}(Fg.EventEmitter),_w=DD.Peer;const n6=Object.freeze(Object.defineProperty({__proto__:null,get Peer(){return bw},default:_w,util:wt},Symbol.toStringTag,{value:"Module"}));let pC;function eX(){return pC}function tX(n){pC=n}function s6(n,t){return t||(t={}),t={...pC,...t},n?new _w(n,t):new _w(t)}async function oI(){const n=await hy(()=>Promise.resolve().then(()=>n6),void 0,import.meta.url);return console.log(n),n.default===void 0?n:n.default}var ww;(function(n){n.ConnectionList="connection-list"})(ww||(ww={}));class r6{constructor(){c(this,"_host");c(this,"_client");c(this,"_clientData");this.onEnable()}get isHost(){return this._host!==void 0}onEnable(){const t="HOST-5980e65c-8438-453e-8b35-f13c736dcd81";this.trySetupHost(t)}async trySetupHost(t){const e=await oI(),i=new e(t);i.on("error",s=>{console.error(s),this._host=void 0,this.trySetupClient(t)}),i.on("open",s=>{this._host=new a6(i)})}async trySetupClient(t){const e=await oI();this._client=new e,this._client.on("error",i=>{console.error("Client error",i)}),this._client.on("open",i=>{console.log("client connected",i),this._clientData=this._client.connect(t,{metadata:{id:i}}),this._clientData.on("open",()=>{console.log("Connected to host")}),this._clientData.on("data",s=>{console.log("<<",s)})})}}class o6{constructor(t){c(this,"_peer");this._peer=t}}class a6 extends o6{constructor(e){var i;super(e);c(this,"_connections",[]);console.log("I AM THE HOST"),(i=this._peer)==null||i.on("connection",this.onConnection.bind(this)),this._peer.on("close",()=>{this.broadcast("BYE")}),setInterval(()=>{this.broadcast("HELLO")},2e3)}get isHost(){return!0}onConnection(e){console.log("host connection",e),e.on("open",()=>{this._connections.push(e),this.broadcastConnection(e)})}broadcastConnection(e){const i=this._connections.map(s=>{var r;return(r=s.metadata)==null?void 0:r.id}).filter(s=>s!==void 0);this.broadcast({type:ww.ConnectionList,connections:i})}broadcast(e){if(e!=null){console.log(">>",e);for(const i in this._peer.connections){const s=this._peer.connections[i];if(s)if(Array.isArray(s))for(const r of s)r&&r.send(e);else console.warn(s)}}}}const aI="https://urls.needle.tools/default-networking-backend/index";let Yl="wss://needle-tiny-starter.glitch.me/socket";const Qs=!!N("debugnet"),zm=!!(Qs||N("debugowner")),lI=N("debugnetbin");var xw;(function(n){n.ConnectionInfo="connection-start-info"})(xw||(xw={}));var Ye;(function(n){n.Join="join-room",n.Leave="leave-room",n.JoinedRoom="joined-room",n.LeftRoom="left-room",n.UserJoinedRoom="user-joined-room",n.UserLeftRoom="user-left-room",n.RoomStateSent="room-state-sent"})(Ye||(Ye={}));class iX{constructor(){c(this,"room");c(this,"viewId");c(this,"allowEditing");c(this,"inRoom")}}class nX{constructor(){c(this,"room")}}class sX{constructor(){c(this,"userId")}}var Zn;(function(n){n.RequestHasOwner="request-has-owner",n.ResponseHasOwner="response-has-owner",n.RequestIsOwner="request-is-owner",n.ResponseIsOwner="response-is-owner",n.RequestOwnership="request-ownership",n.GainedOwnership="gained-ownership",n.RemoveOwnership="remove-ownership",n.LostOwnership="lost-ownership",n.GainedOwnershipBroadcast="gained-ownership-broadcast",n.LostOwnershipBroadcast="lost-ownership-broadcast"})(Zn||(Zn={}));class UD{constructor(t,e){c(this,"guid");c(this,"connection");c(this,"_hasOwnership",!1);c(this,"_isOwned");c(this,"_gainSubscription");c(this,"_lostSubscription");c(this,"_hasOwnerResponse");c(this,"_isWaitingForOwnershipResponseCallback",null);this.connection=t,this.guid=e,this._gainSubscription=this.onGainedOwnership.bind(this),this._lostSubscription=this.onLostOwnership.bind(this),t.beginListen(Zn.LostOwnership,this._lostSubscription),t.beginListen(Zn.GainedOwnershipBroadcast,this._gainSubscription),this._hasOwnerResponse=this.onHasOwnerResponse.bind(this),t.beginListen(Zn.ResponseHasOwner,this._hasOwnerResponse)}get hasOwnership(){return this._hasOwnership}get isOwned(){return this._isOwned}get isConnected(){return this.connection.isConnected}updateIsOwned(){this.connection.send(Zn.RequestHasOwner,{guid:this.guid})}onHasOwnerResponse(t){t.guid===this.guid&&(this._isOwned=t.value)}requestOwnershipIfNotOwned(){return this._isWaitingForOwnershipResponseCallback!==null?this:(this._isWaitingForOwnershipResponseCallback=this.waitForHasOwnershipRequestResponse.bind(this),this.connection.beginListen(Zn.ResponseHasOwner,this._isWaitingForOwnershipResponseCallback),this.connection.send(Zn.RequestHasOwner,{guid:this.guid}),this)}waitForHasOwnershipRequestResponse(t){t.guid===this.guid&&(this._isWaitingForOwnershipResponseCallback&&(this.connection.stopListen(Zn.ResponseHasOwner,this._isWaitingForOwnershipResponseCallback),this._isWaitingForOwnershipResponseCallback=null),this._isOwned=t.value,t.value||(zm&&console.log("request ownership",this.guid),this.requestOwnership()))}requestOwnershipAsync(){return new Promise((t,e)=>{this.requestOwnership();let i=0;const s=()=>{if(i++>10)return e("Timeout");setTimeout(()=>{this.hasOwnership?t(this):s()},100)};s()})}requestOwnership(){return zm&&console.log("Request ownership",this.guid),this.connection.send(Zn.RequestOwnership,{guid:this.guid}),this}freeOwnership(){return this.connection.send(Zn.RemoveOwnership,{guid:this.guid}),this._isWaitingForOwnershipResponseCallback&&(this.connection.stopListen(Zn.ResponseHasOwner,this._isWaitingForOwnershipResponseCallback),this._isWaitingForOwnershipResponseCallback=null),this}destroy(){this.connection.stopListen(Zn.GainedOwnership,this._gainSubscription),this.connection.stopListen(Zn.LostOwnership,this._lostSubscription),this.connection.stopListen(Zn.ResponseHasOwner,this._hasOwnerResponse),this._isWaitingForOwnershipResponseCallback&&(this.connection.stopListen(Zn.ResponseHasOwner,this._isWaitingForOwnershipResponseCallback),this._isWaitingForOwnershipResponseCallback=null)}onGainedOwnership(t){t.guid===this.guid&&(this._isOwned=!0,this.connection.connectionId===t.owner?(zm&&console.log("GAINED OWNERSHIP",this.guid),this._hasOwnership=!0):this._hasOwnership=!1)}onLostOwnership(t){t===this.guid&&(zm&&console.log("LOST OWNERSHIP",this.guid),this._hasOwnership=!1,this._isOwned=!1)}}class l6{constructor(t){c(this,"context");c(this,"_peer",null);c(this,"_usersInRoomCopy",[]);c(this,"_defaultMessagesBuffer",[]);c(this,"_defaultMessagesBufferArray",[]);c(this,"netWebSocketUrlProvider");c(this,"_listeners",{});c(this,"_listenersBinary",{});c(this,"connected",!1);c(this,"channelId");c(this,"_connectionId",null);c(this,"_ws");c(this,"_waitingForSocket",{});c(this,"_isInRoom",!1);c(this,"_currentRoomName",null);c(this,"_currentRoomViewId",null);c(this,"_currentRoomAllowEditing",!0);c(this,"_currentInRoom",[]);c(this,"_state",{});c(this,"_currentDelay",-1);c(this,"_connectingToWebsocketPromise",null);this.context=t}get peer(){return this._peer||(this._peer=new r6),this._peer}tryGetState(t){return t==="invalid"?null:this._state[t]}get connectionId(){return this._connectionId}get isDebugEnabled(){return Qs}get isConnected(){return this.connected}get currentRoomName(){return this._currentRoomName}get allowEditing(){return this._currentRoomAllowEditing}get currentRoomViewId(){return this._currentRoomViewId}getViewOnlyUrl(){if(this.currentRoomViewId===null)return null;const t=new URL(window.location.href);return t.searchParams.set("view",this.currentRoomViewId),t.href}get isInRoom(){return this._isInRoom}get currentLatency(){return this._currentDelay}get currentServerUrl(){var t;return((t=this._ws)==null?void 0:t.url)??null}sendPing(){this.send("ping",{time:this.context.time.time})}userIsInRoom(t){return this._currentInRoom.indexOf(t)!==-1}usersInRoom(t=null){t||(t=this._usersInRoomCopy),t.length=0;for(const e of this._currentInRoom)t.push(e);return t}joinRoom(t,e=!1){return t?t.length>1024?(console.error('Room name too long, can not join: "'+t+'". Max length is 1024 characters.'),!1):(this.connect(),Qs&&console.log("join: "+t),this.send(Ye.Join,{room:t,viewOnly:e},jr.OnConnection),!0):(console.error('Missing room name, can not join: "'+t+'"'),!1)}leaveRoom(t=null){return t||(t=this.currentRoomName),t?(this.send(Ye.Leave,{room:t}),!0):(console.error('Missing room name, can not join: "'+t+'"'),!1)}send(t,e=null,i=jr.Queued){if(e===null&&(e={}),i===jr.Queued){this._defaultMessagesBuffer.push({key:t,value:e});return}return this.sendWithWebsocket(t,e,i)}sendDeleteRemoteState(t){this.send("delete-state",{guid:t,dontSave:!0}),delete this._state[t]}sendDeleteRemoteStateAll(){this.send("delete-all-state"),this._state={}}sendBinary(t){var e;lI&&console.log("<< send binary",this.context.time.frame,t.length/1024+" KB"),(e=this._ws)==null||e.send(t)}sendBufferedMessagesNow(){var i;if(!this._ws)return;this._defaultMessagesBufferArray.length=0;const t=Object.keys(this._defaultMessagesBuffer).length;for(const s in this._defaultMessagesBuffer){const r=this._defaultMessagesBuffer[s];if(t<=1){this.sendWithWebsocket(r.key,r.value,jr.Immediate);break}const o=this.toMessage(r.key,r.value);this._defaultMessagesBufferArray.push(o)}if(this._defaultMessagesBuffer.length=0,this._defaultMessagesBufferArray.length>0&&Qs&&console.log("SEND BUFFERED",this._defaultMessagesBufferArray.length),this._defaultMessagesBufferArray.length<=0)return;const e=JSON.stringify(this._defaultMessagesBufferArray);(i=this._ws)==null||i.send(e)}beginListen(t,e){return this._listeners[t]||(this._listeners[t]=[]),this._listeners[t].push(e),e}stopListening(t,e){return this.stopListen(t,e)}stopListen(t,e){if(!e||!this._listeners[t])return;const i=this._listeners[t].indexOf(e);i>=0&&this._listeners[t].splice(i,1)}beginListenBinary(t,e){return this._listenersBinary[t]||(this._listenersBinary[t]=[]),this._listenersBinary[t].push(e),e}stopListenBinary(t,e){if(!this._listenersBinary[t])return;const i=this._listenersBinary[t].indexOf(e);i>=0&&this._listenersBinary[t].splice(i,1)}registerProvider(t){this.netWebSocketUrlProvider=t}async connect(){var e;if(this.connected)return Promise.resolve(!0);Qs&&console.log("connecting");const t=(e=this.netWebSocketUrlProvider)==null?void 0:e.getWebsocketUrl();return t?Yl=t:tL()&&(Yl="wss://"+window.location.host+"/socket"),this.connectWebsocket()}disconnect(){var t;(t=this._ws)==null||t.close(),this._ws=void 0}connectWebsocket(){return this._connectingToWebsocketPromise?this._connectingToWebsocketPromise:this._connectingToWebsocketPromise=new Promise(async(t,e)=>{var l;let i=!1;const s=h=>{i||(i=!0,t(h))};if(Yl===void 0&&(console.log("Fetch default backend url: "+aI),Yl=await(await fetch(aI)).text()),Yl===void 0){s(!1);return}console.log(`âŠ¡ Connecting to networking backend on
`+Yl);const r=await hy(()=>import("./index-d7be2e3b.js"),[],import.meta.url),o=((l=r.default)==null?void 0:l.WebsocketBuilder)??r.WebsocketBuilder,a=new o(Yl).onOpen(()=>{this._connectingToWebsocketPromise=null,this._ws=a,this.connected=!0,console.log(`âŠž Connected to networking backend
`+Yl),s(!0),this.onSendQueued(jr.OnConnection)}).onClose(h=>{this._connectingToWebsocketPromise=null,this.connected=!1,this._isInRoom=!1,s(!1)}).onError((h,u)=>{console.error("âŠ  Websocket error",h,u),s(!1)}).onRetry(()=>{console.log("Retry connecting to networking websocket")}).build();a.addEventListener(r.WebsocketEvent.message,(h,u)=>{this.onMessage(h,u)})})}onMessage(t,e){const i=e.data;try{if(typeof i!="string"){i.size&&this.handleIncomingBinaryMessage(i);return}const s=JSON.parse(i);if(Array.isArray(s))for(const r of s)this.handleIncomingStringMessage(r);else this.handleIncomingStringMessage(s);return}catch(s){Qs&&i==="pong"?console.log("<<",i):xe()&&console.error("Failed to parse message",s)}}async handleIncomingBinaryMessage(t){lI&&console.log("<< bin",this.context.time.frame);const e=await t.arrayBuffer();var i=new Uint8Array(e);const s=new Ag(i),r=s.getBufferIdentifier(),o=this._listenersBinary[r],a=_G(s),l=wG(a);if(l&&typeof l=="string"&&(this._state[l]=a),!o)return;const h=a??s;for(const u of o)u(h)}handleIncomingStringMessage(t){var s,r;if(Qs&&console.log("<<",t.key??t),t.key)switch(t.key){case xw.ConnectionInfo:if(t.data){const l=t.data;l&&(console.assert(l.id!==void 0&&l.id!==null&&l.id.length>0,"server did not send connection id",l.id),console.log("Your id is: "+l.id,this.context.alias??""),this._connectionId=l.id)}else console.warn("Expected connection id in "+t.key);break;case Ye.JoinedRoom:if(Qs&&console.log(t),t){this._isInRoom=!0;const l=t;this._currentRoomName=l.room,this._currentRoomViewId=l.viewId,this._currentRoomAllowEditing=l.allowEditing??!0,this._currentInRoom.length=0,this._currentInRoom.push(...l.inRoom),Qs&&console.log("joined room with",this._currentInRoom,this.context.alias??"");const h=new URL(window.location.href);h.searchParams.has("room")&&h.searchParams.delete("room"),h.searchParams.set("view",this._currentRoomViewId),console.log("Room view id: "+this._currentRoomViewId+`
`+h.href)}this.onSendQueued(jr.OnRoomJoin);break;case Ye.LeftRoom:t.room===this.currentRoomName&&(this._isInRoom=!1,this._currentRoomName=null,this._currentInRoom.length=0);break;case Ye.UserJoinedRoom:if(t.data){const l=t.data;this._currentInRoom.push(l.userId),Qs&&console.log(l.userId+" joined","now in room:",this._currentInRoom)}break;case Ye.UserLeftRoom:if(t.data){const l=t.data,h=this._currentInRoom.indexOf(l.userId);h>=0&&(Qs&&console.log(l.userId+" left","now in room:",this._currentInRoom),this._currentInRoom.splice(h,1)),l.userId===this.connectionId&&console.log("you left the room")}break;case"all-room-state-deleted":Qs&&console.log("RECEIVED all-room-state-deleted"),this._state={};break;case"ping":case"pong":const a=(s=t.data)==null?void 0:s.time;a&&(this._currentDelay=this.context.time.time-a),Qs&&console.log("Current latency: "+this._currentDelay.toFixed(1)+" sec","Clients in room: "+((r=this._currentInRoom)==null?void 0:r.length));break}let e=this._listeners[t.key];if(e){e=[...e];for(const o of e)try{o(t.data)}catch(a){console.error('Error invoking callback for "'+t.key+'"',a)}}const i=t.data;i&&(this._state[i.guid]=i)}toMessage(t,e){return{key:t,data:e}}sendWithWebsocket(t,e,i=jr.OnRoomJoin){if(!this._ws){const r=this._waitingForSocket[i]||[];r.push(()=>this.sendWithWebsocket(t,e,i)),this._waitingForSocket[i]=r;return}const s=JSON.stringify(this.toMessage(t,e));Qs&&console.log(">>",t),this._ws.send(s)}onSendQueued(t){const e=this._waitingForSocket[t];if(e){for(const i of e)i();e.length=0}}}const Sp=N("debugwebxr");class Bb{constructor(t,e){c(this,"controllerStates",[]);c(this,"userId");c(this,"context");c(this,"userStateEvtName");c(this,"onReceivedControllerState",t=>{Sp&&console.log(`XRSync: Received change for ${this.userId}: ${t.type} ${t.handedness}; tracked=${t.isTracking}`);let e=!1;for(let i=0;i<this.controllerStates.length;i++)if(this.controllerStates[i].index===t.index){this.controllerStates[i]=t,e=!0;break}e||this.controllerStates.push(t)});this.userId=t,this.context=e,this.userStateEvtName="xr-sync-user-state-"+t,this.context.connection.beginListen(this.userStateEvtName,this.onReceivedControllerState)}dispose(){this.context.connection.stopListen(this.userStateEvtName,this.onReceivedControllerState)}update(t){if(this.context.connection.isConnected!=!1){for(let e=this.controllerStates.length-1;e>=0;e--){const i=this.controllerStates[e];let s=!1;for(let r=0;r<t.controllers.length;r++)t.controllers[r].index===i.index&&(s=!0);s||(Sp&&console.log(`XRSync: ${i.type} ${i.handedness} removed`,i.index),this.controllerStates.splice(e,1),this.sendControllerRemoved(i))}for(const e of t.controllers)this.updateControllerStates(e)}}onExitXR(t){for(const e of this.controllerStates)this.sendControllerRemoved(e);this.controllerStates.length=0}sendControllerRemoved(t){t.isTracking=!1,t.guid="",this.context.connection.send(this.userStateEvtName,t),this.context.connection.sendDeleteRemoteState(t.guid)}updateControllerStates(t){const e=this.controllerStates.find(i=>i.index===t.index);if(e){let i=!1;i||(i=e.isTracking!=t.isTracking),i&&(e.isTracking=t.isTracking,this.context.connection.send(this.userStateEvtName,e))}else{const i={guid:this.userId+"-"+t.index,isTracking:t.isTracking,handedness:t.side,index:t.index,type:t.hand?"hand":"controller"};this.controllerStates.push(i),this.context.connection.send(this.userStateEvtName,i),Sp&&console.log(`XRSync: ${i.type} ${i.handedness} added`,i.index)}}}class c6{constructor(t){c(this,"context");c(this,"onJoinedRoom",()=>{if(this.context.connection.connectionId){this._states.has(this.context.connection.connectionId)||(Sp&&console.log("XRSync: Local user joined room",this.context.connection.connectionId),this._states.set(this.context.connection.connectionId,new Bb(this.context.connection.connectionId,this.context)));for(const t of this.context.connection.usersInRoom())this._states.has(t)||this._states.set(t,new Bb(t,this.context))}});c(this,"onLeftRoom",()=>{if(this.context.connection.connectionId&&!this._states.has(this.context.connection.connectionId)){const t=this._states.get(this.context.connection.connectionId);t==null||t.dispose(),this._states.delete(this.context.connection.connectionId)}});c(this,"onOtherUserJoinedRoom",t=>{const e=t.userId;this._states.has(e)||(Sp&&console.log("XRSync: Remote user joined room",e),this._states.set(e,new Bb(e,this.context)))});c(this,"onOtherUserLeftRoom",t=>{const e=t.userId;if(!this._states.has(e)){const i=this._states.get(e);i==null||i.dispose(),this._states.delete(e)}});c(this,"_states",new Map);this.context=t,this.context.connection.beginListen(Ye.JoinedRoom,this.onJoinedRoom),this.context.connection.beginListen(Ye.LeftRoom,this.onLeftRoom),this.context.connection.beginListen(Ye.UserJoinedRoom,this.onOtherUserJoinedRoom),this.context.connection.beginListen(Ye.UserLeftRoom,this.onOtherUserLeftRoom)}hasState(t){return t?this._states.has(t):!1}isTracking(t,e){if(!t)return;const i=this._states.get(t);if(!i)return;const s=i.controllerStates.find(r=>r.handedness===e);return(s==null?void 0:s.isTracking)||!1}getDeviceType(t,e){if(!t)return;const i=this._states.get(t);if(!i)return;const s=i.controllerStates.find(r=>r.handedness===e);return(s==null?void 0:s.type)||"unknown"}destroy(){this.context.connection.stopListen(Ye.JoinedRoom,this.onJoinedRoom),this.context.connection.stopListen(Ye.LeftRoom,this.onLeftRoom),this.context.connection.stopListen(Ye.UserJoinedRoom,this.onOtherUserJoinedRoom),this.context.connection.stopListen(Ye.UserLeftRoom,this.onOtherUserLeftRoom)}onUpdate(t){if(this.context.connection.isConnected&&this.context.connection.connectionId){const e=this._states.get(this.context.connection.connectionId);e==null||e.update(t)}}onExitXR(t){if(this.context.connection.isConnected&&this.context.connection.connectionId){const e=this._states.get(this.context.connection.connectionId);e==null||e.onExitXR(t)}}}class cI{constructor(){c(this,"_fadeToColorQuad");c(this,"_fadeToColorMaterial");c(this,"_requestedFadeValue",0);c(this,"_transitionPromise",null);c(this,"_transitionResolve",null);this._fadeToColorMaterial=new St({color:0,transparent:!0,depthTest:!1,fog:!1,side:pi}),this._fadeToColorQuad=new J(new Ys(10,10),this._fadeToColorMaterial)}dispose(){this._fadeToColorQuad.geometry.dispose(),this._fadeToColorMaterial.dispose()}update(t,e){const i=this._fadeToColorQuad,s=this._fadeToColorMaterial;i.parent!==t&&s.opacity>0?t.add(i):s.opacity===0&&i.removeFromParent(),i.layers.set(2),i.material=this._fadeToColorMaterial,i.position.z=-1,i.renderOrder=1/0;const r=this._requestedFadeValue;s.opacity=Ae.lerp(s.opacity,r,e/.03),Math.abs(s.opacity-r)<=.01&&this._transitionResolve&&(this._transitionResolve(),this._transitionResolve=null,this._transitionPromise=null,this._requestedFadeValue=0)}remove(){this._fadeToColorQuad.removeFromParent()}fadeTransition(){if(this._transitionPromise)return this._transitionPromise;this._requestedFadeValue=1;const t=new Promise(e=>{this._transitionResolve=e});return this._transitionPromise=t,t}}var Da;(function(n){n[n.Quad=0]="Quad",n[n.Cube=1]="Cube",n[n.Sphere=2]="Sphere"})(Da||(Da={}));class Py{static createPrimitive(t,e){let i;switch(t){case"Quad":case Da.Quad:{const r=new Ys(1,1,1,1),o=(e==null?void 0:e.material)??new mr({color:16777215});e!=null&&e.texture&&"map"in o&&(o.map=e.texture),i=new J(r,o)}break;case"Cube":case Da.Cube:{const r=new Xi(1,1,1),o=(e==null?void 0:e.material)??new mr({color:16777215});e!=null&&e.texture&&"map"in o&&(o.map=e.texture),i=new J(r,o)}break;case"Sphere":case Da.Sphere:{const r=new Qd(.5,16,16),o=(e==null?void 0:e.material)??new mr({color:16777215});e!=null&&e.texture&&"map"in o&&(o.map=e.texture),i=new J(r,o)}break}return this.applyDefaultObjectOptions(i,e),i}static createSprite(t){const i=new A2({color:16777215});t!=null&&t.texture&&"map"in i&&(i.map=t.texture);const s=new v2(i);return this.applyDefaultObjectOptions(s,t),s}static applyDefaultObjectOptions(t,e){e!=null&&e.name&&(t.name=e.name),e!=null&&e.position&&t.position.set(e.position.x,e.position.y,e.position.z),e!=null&&e.rotation&&t.rotation.set(e.rotation.x,e.rotation.y,e.rotation.z),e!=null&&e.scale&&t.scale.set(e.scale.x,e.scale.y,e.scale.z)}}const TS=class{constructor(t,e,i){c(this,"_session");c(this,"_mode");c(this,"_init");c(this,"_renderer");c(this,"_camera");c(this,"_scene");c(this,"onEnd",()=>{var t;(t=this._session)==null||t.removeEventListener("end",this.onEnd),this._renderer.setAnimationLoop(null),this._renderer.dispose(),this._scene.clear()});c(this,"_lastTime",0);c(this,"onFrame",(t,e)=>{const i=t-this._lastTime;this.update(t,i),this._camera.parent!==this._scene&&this._scene.add(this._camera),this._renderer.render(this._scene,this._camera)});c(this,"_objects",[]);this._mode=t,this._init=e,this._session=i,this._session.addEventListener("end",this.onEnd),this._renderer=new Hh({alpha:!0}),this._renderer.setAnimationLoop(this.onFrame),this._renderer.xr.setSession(i),this._renderer.xr.enabled=!0,this._camera=new xt,this._scene=new Ws,this._scene.fog=new WR(4473924,10,250),this._scene.add(this._camera),this.setupScene()}static get active(){return this._active}static async start(t,e){if(this._active)return console.error("Cannot start a new XR session while one is already active"),null;if(this._requestInFlight)return console.error("Cannot start a new XR session while a request is already in flight"),null;if("xr"in navigator&&navigator.xr){if(!e)return console.error("XRSessionInit must be provided"),null;this._requestInFlight=!0;const i=await navigator.xr.requestSession(t,e);return i.addEventListener("end",()=>{this._active=null}),this._requestInFlight?(this._requestInFlight=!1,this._active=new TS(t,e,i),this._active):(i.end(),null)}return null}static async handoff(){return this._active?this._active.handoff():null}static async stop(){this._requestInFlight=!1,this._active&&(await this._active.end(),await El(100)),this._active=null}get isAR(){return this._mode==="immersive-ar"}end(){return this._session?this._session.end():Promise.resolve()}async handoff(){if(!this._session)throw new Error("Cannot handoff a session that has already ended");const t={session:this._session,mode:this._mode,init:this._init};return await this.onBeforeHandoff(),this.onEnd(),this._session=null,t}async onBeforeHandoff(){await El(1e3),this._scene.clear()}setupScene(){this._scene.background=new we(0),this._scene.add(new cx(5,10,1118481,1118481));const t=new eg(16777215,1);t.position.set(0,20,0),t.castShadow=!1,this._scene.add(t);const e=new eg(16777215,1);e.position.set(0,-1,0),e.castShadow=!1,this._scene.add(e);const i=new $p(16777215,1,100,1);i.position.set(0,2,0),i.castShadow=!1,i.distance=200,this._scene.add(i);const s=50;for(let r=0;r<100;r++){const o=new mr({color:2236962,metalness:1,roughness:.8});this.isAR&&(o.emissive=new we(Math.random(),Math.random(),Math.random()),o.emissiveIntensity=Math.random());const a=Ae.random(0,1)>.5?Da.Sphere:Da.Cube,l=Py.createPrimitive(a,{material:o});l.position.x=Ae.random(-s,s),l.position.y=Ae.random(-2,s),l.position.z=Ae.random(-s,s),l.rotation.x=Ae.random(0,Math.PI*2),l.rotation.y=Ae.random(0,Math.PI*2),l.rotation.z=Ae.random(0,Math.PI*2),l.scale.multiplyScalar(.5+Math.random()*10);const h=l.position.distanceTo(this._camera.position)-l.scale.x;h<1&&l.position.multiplyScalar(1+1/h),this._objects.push(l),this._scene.add(l)}}update(t,e){const i=t*4e-4;for(let s=0;s<this._objects.length;s++){const r=this._objects[s];r.position.y+=Math.sin(i+s*.5)*.005,r.rotateY(.002)}}};let bc=TS;c(bc,"_active",null),c(bc,"_requestInFlight",!1);const en=N("debugwebxr"),h6=N("stats");function u6(n){let t=null;const e=n;return e.getAROverlayContainer?t=e.getAROverlayContainer():t=n,t}d6();async function d6(){var n;if(N("debugasap")){let t=globalThis["needle:XRSession"];if(t instanceof Promise){delete globalThis["needle:XRSession"],mt.addContextCreatedCallback(async e=>{if(!t)return;dg(!0);const i=await t;if(i){const s=Me.getDefaultSessionInit("immersive-vr");Me.setSession("immersive-vr",i,s,e.context)}else console.error("NeedleXRSession: ASAP session was rejected");t=void 0});return}}if("xr"in navigator){if(/WebXRViewer\//i.test(navigator.userAgent)){console.warn("WebXRViewer does not support addEventListener");return}(n=navigator.xr)==null||n.addEventListener("sessiongranted",async()=>{dg(!0),console.log("Received Session Granted..."),await El(100);const t=sessionStorage.getItem("needle_xr_session_mode"),e=sessionStorage.getItem("needle_xr_session_init")??null,i=e?JSON.parse(e):null;let s=null;if(ND()&&(await bc.start(t||"immersive-vr",i||Me.getDefaultSessionInit("immersive-vr")),await g6(),s=await bc.handoff()),s)Me.setSession(s.mode,s.session,s.init,Ne.Current);else if(t&&e){console.log("Session Granted: Restore last session");const r=JSON.parse(e);Me.start(t,r).catch(o=>console.warn(o))}else Me.start("immersive-vr").catch(r=>console.warn("Session Granted failed:",r))},{once:!0})}}function f6(n,t){sessionStorage.setItem("needle_xr_session_mode",n),sessionStorage.setItem("needle_xr_session_init",JSON.stringify(t))}function p6(){sessionStorage.removeItem("needle_xr_session_mode"),sessionStorage.removeItem("needle_xr_session_init")}const gC=new Set;mt.registerCallback(yt.ContextCreationStart,async n=>{gC.add(n.context)});mt.registerCallback(yt.ContextCreated,async n=>{gC.delete(n.context)});function ND(){return gC.size>0}function g6(){return new Promise(n=>{const t=Date.now(),e=setInterval(()=>{(!ND()||Date.now()-t>6e4)&&(clearInterval(e),n())},100)})}Id()&&xe()&&window.addEventListener("keydown",n=>{(n.key==="x"||n.key==="Escape")&&Me.active&&Me.stop()});const al=class{constructor(t,e,i,s){c(this,"context");c(this,"session");c(this,"mode");c(this,"controllers",[]);c(this,"_rigScale",1);c(this,"_lastRigScaleUpdate",-1);c(this,"_rigs",[]);c(this,"_viewerHitTestSource",null);c(this,"_defaultRig");c(this,"_xr_scripts");c(this,"_xr_update_scripts",[]);c(this,"_inactive_scripts",[]);c(this,"_controllerAdded");c(this,"_controllerRemoved");c(this,"_originalCameraWorldPosition");c(this,"_originalCameraWorldRotation");c(this,"_originalCameraWorldScale");c(this,"_originalCameraParent");c(this,"_mainCamera",null);c(this,"onRendererSessionSet",()=>{var t;this.running&&(this.context.renderer.xr.enabled=!0,this.context.renderer.xr.updateCamera(this.context.mainCamera),(t=this.context.mainCameraComponent)==null||t.applyClearFlags())});c(this,"onInputSourceAdded",t=>{if(t.targetRayMode==="screen")return;let e=0;for(let s=0;s<this.session.inputSources.length;s++)if(this.session.inputSources[s]===t){e=s;break}if(this.controllers.find(s=>s.inputSource===t)){console.warn("Controller already exists for input source",e);return}en&&console.log("Adding controller",e);const i=new WM(this,t,e);this._newControllers.push(i)});c(this,"_ended",!1);c(this,"_newControllers",[]);c(this,"onEnd",t=>{var s,r,o;if(this._ended)return;this._ended=!0,en&&console.log("XR Session ended"),p6(),this.onAfterRender(),this.revertCustomForward(),this._didStart=!1,this._previousCameraParent=null,Nc(this.onBefore,ze.LateUpdate);const e=this.context.pre_render_callbacks.indexOf(this.onBeforeRender);e>=0&&this.context.pre_render_callbacks.splice(e,1);const i=this.context.post_render_callbacks.indexOf(this.onAfterRender);i>=0&&this.context.post_render_callbacks.splice(i,1),this.context.xr=null,this.context.renderer.xr.enabled=!1,this.context.pre_update_oneshot_callbacks.push(()=>{var a;(a=this.context.mainCameraComponent)==null||a.applyClearFlags()}),rG({session:this});for(const a of al._xrEndListeners)a({xr:this});for(let a=0;a<this.controllers.length;a++)this.disconnectInputSource(this.controllers[a].inputSource);for(const a of this._xr_scripts)(s=a==null?void 0:a.onLeaveXR)==null||s.call(a,{xr:this});(r=this.sync)==null||r.onExitXR(this),this.context.mainCamera&&((o=this._originalCameraParent)==null||o.add(this.context.mainCamera),this._originalCameraWorldPosition&&Ts(this.context.mainCamera,this._originalCameraWorldPosition),this._originalCameraWorldRotation&&Oo(this.context.mainCamera,this._originalCameraWorldRotation),this._originalCameraWorldScale&&lv(this.context.mainCamera,this._originalCameraWorldScale)),this.context.requestSizeUpdate(),this._defaultRig.gameObject.removeFromParent(),dg(!1)});c(this,"_didStart",!1);c(this,"onBefore",t=>{var s,r,o,a,l,h,u,d;const e=t.xrFrame;if(!e)return;this.context.xr=this,this.context.mainCameraComponent&&this.context.mainCameraComponent!==this._mainCamera&&(this._mainCamera=this.context.mainCameraComponent),((s=this.rig)==null?void 0:s.isActive)==!1&&(en&&console.warn("Latest rig is not active - trying to activate a different rig",this.rig),this.updateActiveXRRig()),this.rig&&((r=this._mainCamera)!=null&&r.gameObject)&&((a=(o=this._mainCamera)==null?void 0:o.gameObject)==null?void 0:a.parent)!==this.rig.gameObject&&this.rig.gameObject.add((l=this._mainCamera)==null?void 0:l.gameObject),this.internalUpdateState(),this.applyCustomForward();const i={xr:this};if(this._didStart){if(this.context.new_scripts_xr.length>0){const f=[...this.context.new_scripts_xr];for(let p=0;p<f.length;p++){const g=this.context.new_scripts_xr[p];if(!g||g.destroyed||((h=g.supportsXR)==null?void 0:h.call(g,this.mode))==!1){this.context.new_scripts_xr.splice(p,1);continue}if(!g.activeAndEnabled){this.context.new_scripts_xr.splice(p,1),this.markInactive(g);continue}if(this.addScript(g)){this.invokeCallback_EnterXR(g);for(const m of this.controllers)this.invokeCallback_ControllerAdded(g,m)}}}}else{this._didStart=!0,sG({session:this});for(const p of al._xrStartListeners)p(i);const f=[...this._xr_scripts];en&&console.log("NeedleXRSession start, handle scripts:",f);for(const p of f){if(p.destroyed){this._script_to_remove.push(p);continue}if(!p.activeAndEnabled){this.markInactive(p);continue}this.invokeCallback_EnterXR(p);for(const g of this.controllers)this.invokeCallback_ControllerAdded(p,g)}}this.syncCameraCullingMask();for(const f of this.controllers)f.onUpdate(e);if(this._newControllers.length>0){const f=[...this._newControllers];this._newControllers.length=0;for(const p of f)if(p.connected){this.controllers.push(p);for(const g of this._xr_scripts){if(g.destroyed){this._script_to_remove.push(g);continue}g.activeAndEnabled!==!1&&this.invokeCallback_ControllerAdded(g,p)}}this.controllers.sort((p,g)=>p.index-g.index)}for(const f of this._xr_update_scripts){if(f.destroyed===!0){this._script_to_remove.push(f);continue}if(f.activeAndEnabled===!1){this.markInactive(f);continue}f.onUpdateXR&&f.onUpdateXR(i)}if(this.handleInactiveScripts(),this._script_to_remove.length>0){const f=[...new Set(this._script_to_remove)];this._script_to_remove.length=0;for(const p of f)!p.destroyed&&this.running&&((u=p.onLeaveXR)==null||u.call(p,i)),this.removeScript(p)}(d=this.sync)==null||d.onUpdate(this),this.onRenderDebug()});c(this,"onBeforeRender",()=>{this.context.mainCamera&&this.updateFade(this.context.mainCamera)});c(this,"onAfterRender",()=>{if(this.onUpdateFade_PostRender(),Id()){const t=this.context.renderer;if(t.xr.isPresenting&&this.context.mainCamera){const e=t.xr.enabled,i=t.getRenderTarget();t.xr.enabled=!1,t.setRenderTarget(null),t.render(this.context.scene,this.context.mainCamera),t.xr.enabled=e,t.setRenderTarget(i)}}});c(this,"_script_to_remove",[]);c(this,"_camera");c(this,"_cameraRenderParent",new re().rotateY(Math.PI));c(this,"_previousCameraParent");c(this,"_customforward",!0);c(this,"originalCameraNearPlane");c(this,"_viewerPose");c(this,"_transformOrientation",new ne);c(this,"_transformPosition",new C);c(this,"_transition");var r,o;f6(t,s.init),this.session=e,this.mode=t,this.context=i,(en||N("console"))&&dg(!0),this._xr_scripts=[...s.scripts],this._xr_update_scripts=this._xr_scripts.filter(a=>typeof a.onUpdateXR=="function"),this._controllerAdded=s.controller_added,this._controllerRemoved=s.controller_removed,Uc(this.onBefore,ze.LateUpdate),this.context.pre_render_callbacks.push(this.onBeforeRender),this.context.post_render_callbacks.push(this.onAfterRender),((r=s.init.optionalFeatures)!=null&&r.includes("hit-test")||(o=s.init.requiredFeatures)!=null&&o.includes("hit-test"))&&e.requestReferenceSpace("viewer").then(a=>{var l,h;return(h=(l=e.requestHitTestSource)==null?void 0:l.call(e,{space:a}))==null?void 0:h.then(u=>this._viewerHitTestSource=u)}).catch(a=>console.warn(a)),this.context.mainCamera&&(this._originalCameraWorldPosition=qe(this.context.mainCamera,new C),this._originalCameraWorldRotation=Nt(this.context.mainCamera,new ne),this._originalCameraWorldScale=ai(this.context.mainCamera,new C),this._originalCameraParent=this.context.mainCamera.parent),this._defaultRig=new AG,this.context.scene.add(this._defaultRig.gameObject),this.addRig(this._defaultRig);for(let a=0;a<e.inputSources.length;a++){const l=e.inputSources[a];if(!l.handedness){console.warn("Input source in xr session has no handedness - ignoring",a);continue}this.onInputSourceAdded(l)}this.session.addEventListener("end",this.onEnd),this.session.addEventListener("inputsourceschange",a=>{for(const l of a.removed)this.disconnectInputSource(l);for(const l of a.added)this.onInputSourceAdded(l)}),this.context.xr=this,this.context.renderer.xr.setSession(this.session).then(this.onRendererSessionSet)}static getXRSync(t){return this._sync||(this._sync=new c6(t)),this._sync}static get currentSessionRequest(){return this._currentSessionRequestMode}static get active(){return this._activeSession}static get activeMode(){var t;return((t=this._activeSession)==null?void 0:t.mode)??null}static get xrSystem(){return"xr"in navigator?navigator.xr:void 0}static isXRSupported(){return Promise.all([this.isVRSupported(),this.isARSupported()]).then(t=>t.some(e=>e)).catch(()=>!1)}static isVRSupported(){return this.isSessionSupported("immersive-vr")}static isARSupported(){return this.isSessionSupported("immersive-ar")}static isSessionSupported(t){var e;return((e=this.xrSystem)==null?void 0:e.isSessionSupported(t).catch(i=>(en&&console.error(i),!1)))??Promise.resolve(!1)}static onSessionRequestStart(t){this._sessionRequestStartListeners.push(t)}static offSessionRequestStart(t){const e=this._sessionRequestStartListeners.indexOf(t);e>=0&&this._sessionRequestStartListeners.splice(e,1)}static onSessionRequestEnd(t){this._sessionRequestEndListeners.push(t)}static offSessionRequestEnd(t){const e=this._sessionRequestEndListeners.indexOf(t);e>=0&&this._sessionRequestEndListeners.splice(e,1)}static onXRSessionStart(t){this._xrStartListeners.push(t)}static offXRSessionStart(t){const e=this._xrStartListeners.indexOf(t);e>=0&&this._xrStartListeners.splice(e,1)}static onXRSessionEnd(t){this._xrEndListeners.push(t)}static offXRSessionEnd(t){const e=this._xrEndListeners.indexOf(t);e>=0&&this._xrEndListeners.splice(e,1)}static onControllerAdded(t){this._controllerAddedListeners.push(t)}static offControllerAdded(t){const e=this._controllerAddedListeners.indexOf(t);e>=0&&this._controllerAddedListeners.splice(e,1)}static onControllerRemoved(t){this._controllerRemovedListeners.push(t)}static offControllerRemoved(t){const e=this._controllerRemovedListeners.indexOf(t);e>=0&&this._controllerRemovedListeners.splice(e,1)}static offerSession(t,e,i){return"xr"in navigator&&navigator.xr&&"offerSession"in navigator.xr?(typeof navigator.xr.offerSession=="function"&&(console.log("WebXR offerSession is available - requesting mode: "+t),e=="default"&&(e=this.getDefaultSessionInit(t)),navigator.xr.offerSession(t,{...e}).then(s=>al.setSession(t,s,e,i)).catch(s=>{console.log("XRSession offer rejected (perhaps because another call to offerSession was made or a call to requestSession was made)")})),!0):!1}static getDefaultSessionInit(t){switch(t){case"immersive-ar":return{optionalFeatures:["anchors","local-floor","hand-tracking","layers","dom-overlay","hit-test"]};case"immersive-vr":return{optionalFeatures:["local-floor","bounded-floor","hand-tracking","high-fixed-foveation-level","layers"]};default:return console.warn("No default session init for mode",t),{}}}static async start(t,e,i){var o,a,l,h;if(xe()&&N("debugxrpreroom"))return console.warn("Debug: Starting temporary XR session"),await bc.start(t,e||al.getDefaultSessionInit(t)),null;if(this._currentSessionRequest)return console.warn("A XRSession is already being requested"),(en||xe())&&Yt("A XRSession is already being requested"),this._currentSessionRequest.then(()=>this._activeSession);if(this._activeSession)return console.error("A XRSession is already running"),this._activeSession;if(i||(i=Ne.Current),i||(i=mt.All[0]),!i)throw new Error("No Needle Engine Context found");switch(e||(e={}),t){case"immersive-ar":{if(await((o=this.xrSystem)==null?void 0:o.isSessionSupported("immersive-ar"))!==!0)return console.error(t+" is not supported by this browser."),null;const d=this.getDefaultSessionInit(t),f=u6(i.domElement);f&&!Ax()&&(d.domOverlay={root:f},d.optionalFeatures.push("dom-overlay")),e={...d,...e}}break;case"immersive-vr":{if(await((a=this.xrSystem)==null?void 0:a.isSessionSupported("immersive-vr"))!==!0)return console.error(t+" is not supported by this browser."),null;e={...this.getDefaultSessionInit(t),...e}}break;default:console.warn("No default session init for mode",t);break}await bc.stop();const s=t=="immersive-ar"?i.scripts_immersive_ar:i.scripts_immersive_vr;en?console.log(`%cRequesting ${t} session`,"font-weight:bold;",e,s):console.log(`%cRequesting ${t} session`,"font-weight:bold;");for(const u of s)u.onBeforeXR&&u.onBeforeXR(t,e);for(const u of this._sessionRequestStartListeners)u({mode:t,init:e});en&&Ci("Requesting "+t+" session ("+Date.now()+")"),this._currentSessionRequest=(l=navigator.xr)==null?void 0:l.requestSession(t,e),this._currentSessionRequestMode=t;const r=await((h=this._currentSessionRequest)==null?void 0:h.catch(u=>{console.error(u,"Code: "+u.code),u.code===9&&Yt("Make sure your device has the required permissions (e.g. camera access)"),console.log("If the specified XR configuration is not supported (e.g. entering AR doesnt work) - make sure you access the website on a secure connection (HTTPS) and your device has the required permissions (e.g. camera access)"),location.protocol==="http:"&&Yt("XR requires a secure connection (HTTPS)")}));this._currentSessionRequest=void 0,this._currentSessionRequestMode=null;for(const u of this._sessionRequestEndListeners)u({mode:t,init:e,newSession:r||null});return r?this.setSession(t,r,e,i):(console.warn("XR Session request was rejected"),null)}static setSession(t,e,i,s){if(this._activeSession)return console.error("A XRSession is already running"),this._activeSession;const r=t=="immersive-ar"?s.scripts_immersive_ar:s.scripts_immersive_vr;return this._activeSession=new al(t,e,s,{scripts:r,controller_added:this._controllerAddedListeners,controller_removed:this._controllerRemovedListeners,init:i}),e.addEventListener("end",this.onEnd),en?console.log(`%cStarted ${t} session`,"font-weight:bold;",r):console.log(`%cStarted ${t} session`,"font-weight:bold;"),this._activeSession}static stop(){var t;(t=this._activeSession)==null||t.end()}get sync(){return al._sync}get running(){return!this._ended&&this.session!=null}get interactionMode(){return this.session.interactionMode}get visibilityState(){return this.session.visibilityState}get environmentBlendMode(){return this.session.environmentBlendMode}get frame(){return this.context.xrFrame}get leftController(){return this.controllers.find(t=>t.isLeft)}get rightController(){return this.controllers.find(t=>t.isRight)}getController(t){return typeof t=="number"?this.controllers[t]||null:this.controllers.find(e=>e.side===t)||null}get isPassThrough(){return!!(this.environmentBlendMode!=="opaque"&&this.interactionMode==="world-space"||this.mode==="immersive-ar"&&this.environmentBlendMode!=="opaque"&&this.controllers.some(t=>t.inputSource.targetRayMode==="tracked-pointer")||xe()&&Id()&&this.mode==="immersive-ar")}get isAR(){return this.mode==="immersive-ar"}get isVR(){return this.mode==="immersive-vr"}get isScreenBasedAR(){return this.isAR&&!this.isPassThrough}get posePosition(){return this._transformPosition}get poseOrientation(){return this._transformOrientation}get referenceSpace(){return this.context.renderer.xr.getReferenceSpace()}get viewerPose(){return this._viewerPose}get isTrackingImages(){if(this.frame&&"getImageTrackingResults"in this.frame&&typeof this.frame.getImageTrackingResults=="function")try{const t=this.frame.getImageTrackingResults();for(const e of t)if(e.trackingState==="tracked")return!0}catch{return!1}return!1}get rig(){const t=this._rigs[0]??null;return t!=null&&t.gameObject&&Ld(t.gameObject)||(t==null?void 0:t.isActive)===!1?(this.updateActiveXRRig(),this._rigs[0]??null):t}get rigScale(){return this._rigs[0]?(this._lastRigScaleUpdate!==this.context.time.frame&&(this._lastRigScaleUpdate=this.context.time.frame,this._rigScale=this._rigs[0].gameObject.worldScale.x),this._rigScale):1}addRig(t){this._rigs.indexOf(t)>=0||(t.priority===void 0&&(t.priority=0),this._rigs.push(t),this.updateActiveXRRig())}removeRig(t){const e=this._rigs.indexOf(t);e!==-1&&(this._rigs.splice(e,1),this.updateActiveXRRig())}setRigActive(t){const e=this._rigs.indexOf(t);this._rigs.splice(e,1),this._rigs.unshift(t),this.updateActiveXRRig()}updateActiveXRRig(){const t=this._rigs[0]??null;this._defaultRig.gameObject.parent!==this.context.scene&&this.context.scene.add(this._defaultRig.gameObject),this._defaultRig.gameObject.visible=!0,this._rigs.includes(this._defaultRig)||this._rigs.push(this._defaultRig);let e=this._rigs[0];e&&e.priority===void 0&&(e.priority=0);for(let i=1;i<this._rigs.length;i++){const s=this._rigs[i];if(s.isActive){if(Ld(s.gameObject)){this._rigs.splice(i,1),i--;continue}(!e||e.isActive===!1||s.priority!==void 0&&s.priority>e.priority)&&(e=s)}}if(t!==e){const i=this._rigs.indexOf(e);i>=0&&this._rigs.splice(i,1),this._rigs.unshift(e)}en&&(t===e?console.log("Updated Active XR Rig:",e,"prev:",t):console.log("Updated Active XRRig:",e," (the same as before)"))}getHitTest(t){if(t)return this.getControllerHitTest(t);if(!this._viewerHitTestSource)return null;const e=this._viewerHitTestSource,i=this.frame.getHitTestResults(e);if(i.length>0){const s=i[0];return this.convertHitTestResult(s)}return null}getControllerHitTest(t){const e=t.hitTestSource;if(!e)return null;const i=this.frame.getHitTestResultsForTransientInput(e);for(const s of i)if(s.inputSource===t.inputSource)for(const r of s.results)return this.convertHitTestResult(r);return null}convertHitTestResult(t){const e=this.context.renderer.xr.getReferenceSpace(),i=e&&t.getPose(e);if(i){const s=Pi(i.transform.position),r=Gu(i.transform.orientation),o=this.context.mainCamera;if((o==null?void 0:o.parent)!==this._cameraRenderParent&&s.applyMatrix4(gv),o!=null&&o.parent){s.applyMatrix4(o.parent.matrixWorld),r.multiply(Qr);const a=Nt(o.parent);a.premultiply(Qr),r.premultiply(a)}return{hit:t,position:s,quaternion:r}}return null}convertSpace(t){const e=Pi(t.position);e.applyMatrix4(gv);const i=Gu(t.orientation);return i.premultiply(Qr),{position:e,quaternion:i}}disconnectInputSource(t){const e=(i,s,r)=>{if(i.inputSource===t){en&&console.log("Disconnecting controller",i.index),this.controllers.splice(r,1),this.invokeControllerEvent(i,this._controllerRemoved,"removed");const o={xr:this,controller:i,change:"removed"};for(const a of this._xr_scripts)a.onXRControllerRemoved&&a.onXRControllerRemoved(o);i.onDisconnected()}};for(let i=this.controllers.length-1;i>=0;i--){const s=this.controllers[i];e(s,this.controllers,i)}for(let i=this._newControllers.length-1;i>=0;i--){const s=this._newControllers[i];e(s,this._newControllers,i)}}end(){this._ended||this.session.end().catch(t=>console.warn(t))}onRenderDebug(){if(en)for(const t of this.controllers)t.onRenderDebug();if((en||h6)&&this.rig){const t=this.rig.gameObject.worldPosition,e=this.rig.gameObject.worldForward;t.add(e.multiplyScalar(1.5));const i=this.rig.gameObject.worldUp;t.add(i.multiplyScalar(2.5));let s="";if(s+=this.context.time.smoothedFps.toFixed(1),en)for(const r of this.controllers)s+=`
${r.hand?"hand":"ctrl"} ${r.inputSource.handedness}[${r.index}] con:${r.connected} tr:${r.isTracking}`;De.DrawLabel(t,s)}}addScript(t){return this._xr_scripts.includes(t)?!1:(en&&console.log("Register new XRScript",t),this._xr_scripts.push(t),typeof t.onUpdateXR=="function"&&this._xr_update_scripts.push(t),!0)}markInactive(t){if(!(this._inactive_scripts.indexOf(t)>=0)){this.removeScript(t,!1),this._inactive_scripts.push(t);for(const e of this.controllers)this.invokeCallback_ControllerRemoved(t,e);this.invokeCallback_LeaveXR(t)}}handleInactiveScripts(){if(this._inactive_scripts.length>0)for(let t=this._inactive_scripts.length-1;t>=0;t--){const e=this._inactive_scripts[t];if(e.activeAndEnabled){this._inactive_scripts.splice(t,1),this.addScript(e),this.invokeCallback_EnterXR(e);for(const i of this.controllers)this.invokeCallback_ControllerAdded(e,i)}}}removeScript(t,e=!0){en&&console.log("Remove XRScript",t);const i=this._xr_scripts.indexOf(t);i>=0&&this._xr_scripts.splice(i,1);const s=this._xr_update_scripts.indexOf(t);if(s>=0&&this._xr_update_scripts.splice(s,1),e){const r=this._inactive_scripts.indexOf(t);r>=0&&this._inactive_scripts.splice(r,1)}}invokeCallback_EnterXR(t){t.onEnterXR&&t.onEnterXR({xr:this})}invokeCallback_ControllerAdded(t,e){t.onXRControllerAdded&&t.onXRControllerAdded({xr:this,controller:e,change:"added"})}invokeCallback_ControllerRemoved(t,e){t.onXRControllerRemoved&&t.onXRControllerRemoved({xr:this,controller:e,change:"removed"})}invokeCallback_LeaveXR(t){t.onLeaveXR&&!t.destroyed&&t.onLeaveXR({xr:this})}syncCameraCullingMask(){var i;const t=this.context.xrCamera,e=(i=this.context.mainCameraComponent)==null?void 0:i.cullingMask;if(t&&e!==void 0){for(const s of t.cameras)s.layers.mask=e;t.layers.mask=e}else if(t){for(const s of t.cameras)s.layers.enableAll();t.layers.enableAll()}}invokeControllerEvent(t,e,i){for(let s=e.length-1;s>=0;s--){const r=e[s];if(r)try{r({xr:this,controller:t,change:i})}catch(o){console.error(o)}}}applyCustomForward(){var t;if(this.context.mainCamera&&this._customforward){this._camera=this.context.mainCamera,this._camera.parent!==this._cameraRenderParent&&(this._previousCameraParent=this._camera.parent,(t=this._previousCameraParent)==null||t.add(this._cameraRenderParent)),this._cameraRenderParent.name="XR Camera Render Parent",this._cameraRenderParent.add(this._camera);let e=.02;if(this.rig){const i=ai(this.rig.gameObject);e*=i.x}this._camera instanceof xt&&this._camera.near>e&&(this.originalCameraNearPlane=this._camera.near,this._camera.near=e)}}revertCustomForward(){this._camera&&this._previousCameraParent&&this._previousCameraParent.add(this._camera),this._previousCameraParent=null,this._camera instanceof xt&&this.originalCameraNearPlane!=null&&(this._camera.near=this.originalCameraNearPlane)}internalUpdateState(){const t=this.context.renderer.xr.getReferenceSpace();if(!t){this._viewerPose=void 0;return}if(this._viewerPose=this.frame.getViewerPose(t),this._viewerPose){const e=this._viewerPose.transform;this._transformPosition.set(e.position.x,e.position.y,e.position.z),this._transformOrientation.set(e.orientation.x,e.orientation.y,e.orientation.z,e.orientation.w)}}get transition(){return this._transition||(this._transition=new cI),this._transition}fadeTransition(){return this._transition||(this._transition=new cI),this._transition.fadeTransition()}updateFade(t){this._transition&&t instanceof xt&&this._transition.update(t,this.context.time.deltaTime)}onUpdateFade_PostRender(){var t;(t=this._transition)==null||t.remove()}};let Me=al;c(Me,"_sync",null),c(Me,"_currentSessionRequestMode",null),c(Me,"_currentSessionRequest"),c(Me,"_activeSession"),c(Me,"_sessionRequestStartListeners",[]),c(Me,"_sessionRequestEndListeners",[]),c(Me,"_xrStartListeners",[]),c(Me,"_xrEndListeners",[]),c(Me,"_controllerAddedListeners",[]),c(Me,"_controllerRemovedListeners",[]),c(Me,"onEnd",()=>{en&&console.log("XR Session ended"),al._activeSession=null});const Pb=N("debugwebxr");class m6{static tryFindAvatarObjects(t,e,i){if(i.head&&i.leftHand&&i.rightHand)return;const s=t.name.toLocaleLowerCase();!i.head&&s.includes("head")&&(Pb&&console.log("FOUND AVATAR HEAD",t.name),i.head=new it("",e,t)),s.includes("hand")&&(!i.leftHand&&s.includes("left")&&(Pb&&console.log("FOUND AVATAR LEFT HAND",t.name),i.leftHand=new it("",e,t)),!i.rightHand&&s.includes("right")&&(Pb&&console.log("FOUND AVATAR RIGHT HAND",t.name),i.rightHand=new it("",e,t)));for(let r=0;r<t.children.length;r++){if(i.head&&i.leftHand&&i.rightHand)return;const o=t.children[r];this.tryFindAvatarObjects(o,e,i)}}}var Ch;(function(n){n.Visible="application-visible",n.Hidden="application-hidden",n.MuteChanged="application-mutechanged"})(Ch||(Ch={}));let vv=!1;const qu=[];function Wd(){if(vv)return;xe()&&console.debug("User interaction registered: audio can now be played"),vv=!0;const n=[...qu];qu.length=0,n.forEach(t=>t())}document.addEventListener("pointerdown",Wd);document.addEventListener("click",Wd);document.addEventListener("dragstart",Wd);document.addEventListener("touchstart",Wd);document.addEventListener("keydown",Wd);Me.onXRSessionStart(()=>{Wd()});const RS=class extends EventTarget{constructor(e){super();c(this,"_mute",!1);c(this,"context");c(this,"_isVisible",!0);this.context=e,window.addEventListener("visibilitychange",this.onVisiblityChanged.bind(this),!1)}static get userInteractionRegistered(){return vv}static registerWaitForInteraction(e){if(e!==null){if(vv){e();return}qu.indexOf(e)===-1&&qu.push(e)}}static unregisterWaitForInteraction(e){const i=qu.indexOf(e);i!==-1&&qu.splice(i,1)}get muted(){return this._mute}set muted(e){e!==this._mute&&(this._mute=e,this.dispatchEvent(new Event(Ch.MuteChanged)))}get hasFocus(){return document.hasFocus()}get isVisible(){return this._isVisible}onVisiblityChanged(e){switch(e.target.visibilityState){case"hidden":this._isVisible=!1,this.dispatchEvent(new Event(Ch.Hidden));break;case"visible":this._isVisible=!0,this.dispatchEvent(new Event(Ch.Visible));break}}};let vl=RS;c(vl,"registerWaitForAllowAudio",RS.registerWaitForInteraction);function*A6(n,t=null){const e=t?t.time:Ne.Current.time,i=e.time;for(;e.time-i<n;)yield}function*rX(n){for(let t=0;t<n;t++)yield}function*v6(n){let t=!0;for(n.then(()=>t=!1),n.catch(()=>t=!1);t;)yield}class yv extends qR{constructor(t){super(t),this.type=On}parse(t){const P=Math.pow(2.7182818,2.2);function R(w,E){let O=0;for(let te=0;te<65536;++te)(te==0||w[te>>3]&1<<(te&7))&&(E[O++]=te);const W=O-1;for(;O<65536;)E[O++]=0;return W}function B(w){for(let E=0;E<16384;E++)w[E]={},w[E].len=0,w[E].lit=0,w[E].p=null}const Q={l:0,c:0,lc:0};function G(w,E,O,W,te){for(;O<w;)E=E<<8|dt(W,te),O+=8;O-=w,Q.l=E>>O&(1<<w)-1,Q.c=E,Q.lc=O}const V=new Array(59);function X(w){for(let O=0;O<=58;++O)V[O]=0;for(let O=0;O<65537;++O)V[w[O]]+=1;let E=0;for(let O=58;O>0;--O){const W=E+V[O]>>1;V[O]=E,E=W}for(let O=0;O<65537;++O){const W=w[O];W>0&&(w[O]=W|V[W]++<<6)}}function k(w,E,O,W,te,Z){const ue=E;let ge=0,me=0;for(;W<=te;W++){if(ue.value-E.value>O)return!1;G(6,ge,me,w,ue);const le=Q.l;if(ge=Q.c,me=Q.lc,Z[W]=le,le==63){if(ue.value-E.value>O)throw new Error("Something wrong with hufUnpackEncTable");G(8,ge,me,w,ue);let pe=Q.l+6;if(ge=Q.c,me=Q.lc,W+pe>te+1)throw new Error("Something wrong with hufUnpackEncTable");for(;pe--;)Z[W++]=0;W--}else if(le>=59){let pe=le-59+2;if(W+pe>te+1)throw new Error("Something wrong with hufUnpackEncTable");for(;pe--;)Z[W++]=0;W--}}X(Z)}function M(w){return w&63}function H(w){return w>>6}function ee(w,E,O,W){for(;E<=O;E++){const te=H(w[E]),Z=M(w[E]);if(te>>Z)throw new Error("Invalid table entry");if(Z>14){const ue=W[te>>Z-14];if(ue.len)throw new Error("Invalid table entry");if(ue.lit++,ue.p){const ge=ue.p;ue.p=new Array(ue.lit);for(let me=0;me<ue.lit-1;++me)ue.p[me]=ge[me]}else ue.p=new Array(1);ue.p[ue.lit-1]=E}else if(Z){let ue=0;for(let ge=1<<14-Z;ge>0;ge--){const me=W[(te<<14-Z)+ue];if(me.len||me.p)throw new Error("Invalid table entry");me.len=Z,me.lit=E,ue++}}}return!0}const Y={c:0,lc:0};function he(w,E,O,W){w=w<<8|dt(O,W),E+=8,Y.c=w,Y.lc=E}const de={c:0,lc:0};function ve(w,E,O,W,te,Z,ue,ge,me){if(w==E){W<8&&(he(O,W,te,Z),O=Y.c,W=Y.lc),W-=8;let le=O>>W;if(le=new Uint8Array([le])[0],ge.value+le>me)return!1;const pe=ue[ge.value-1];for(;le-- >0;)ue[ge.value++]=pe}else if(ge.value<me)ue[ge.value++]=w;else return!1;de.c=O,de.lc=W}function _e(w){return w&65535}function Ge(w){const E=_e(w);return E>32767?E-65536:E}const Te={a:0,b:0};function We(w,E){const O=Ge(w),te=Ge(E),Z=O+(te&1)+(te>>1),ue=Z,ge=Z-te;Te.a=ue,Te.b=ge}function It(w,E){const O=_e(w),W=_e(E),te=O-(W>>1)&65535,Z=W+te-32768&65535;Te.a=Z,Te.b=te}function _t(w,E,O,W,te,Z,ue){const ge=ue<16384,me=O>te?te:O;let le=1,pe,Re;for(;le<=me;)le<<=1;for(le>>=1,pe=le,le>>=1;le>=1;){Re=0;const Ie=Re+Z*(te-pe),He=Z*le,Ze=Z*pe,Pe=W*le,Fe=W*pe;let nt,bi,Ei,nr;for(;Re<=Ie;Re+=Ze){let Kt=Re;const gt=Re+W*(O-pe);for(;Kt<=gt;Kt+=Fe){const Gi=Kt+Pe,Rr=Kt+He,$i=Rr+Pe;ge?(We(w[Kt+E],w[Rr+E]),nt=Te.a,Ei=Te.b,We(w[Gi+E],w[$i+E]),bi=Te.a,nr=Te.b,We(nt,bi),w[Kt+E]=Te.a,w[Gi+E]=Te.b,We(Ei,nr),w[Rr+E]=Te.a,w[$i+E]=Te.b):(It(w[Kt+E],w[Rr+E]),nt=Te.a,Ei=Te.b,It(w[Gi+E],w[$i+E]),bi=Te.a,nr=Te.b,It(nt,bi),w[Kt+E]=Te.a,w[Gi+E]=Te.b,It(Ei,nr),w[Rr+E]=Te.a,w[$i+E]=Te.b)}if(O&le){const Gi=Kt+He;ge?We(w[Kt+E],w[Gi+E]):It(w[Kt+E],w[Gi+E]),nt=Te.a,w[Gi+E]=Te.b,w[Kt+E]=nt}}if(te&le){let Kt=Re;const gt=Re+W*(O-pe);for(;Kt<=gt;Kt+=Fe){const Gi=Kt+Pe;ge?We(w[Kt+E],w[Gi+E]):It(w[Kt+E],w[Gi+E]),nt=Te.a,w[Gi+E]=Te.b,w[Kt+E]=nt}}pe=le,le>>=1}return Re}function $t(w,E,O,W,te,Z,ue,ge,me){let le=0,pe=0;const Re=ue,Ie=Math.trunc(W.value+(te+7)/8);for(;W.value<Ie;)for(he(le,pe,O,W),le=Y.c,pe=Y.lc;pe>=14;){const Ze=le>>pe-14&16383,Pe=E[Ze];if(Pe.len)pe-=Pe.len,ve(Pe.lit,Z,le,pe,O,W,ge,me,Re),le=de.c,pe=de.lc;else{if(!Pe.p)throw new Error("hufDecode issues");let Fe;for(Fe=0;Fe<Pe.lit;Fe++){const nt=M(w[Pe.p[Fe]]);for(;pe<nt&&W.value<Ie;)he(le,pe,O,W),le=Y.c,pe=Y.lc;if(pe>=nt&&H(w[Pe.p[Fe]])==(le>>pe-nt&(1<<nt)-1)){pe-=nt,ve(Pe.p[Fe],Z,le,pe,O,W,ge,me,Re),le=de.c,pe=de.lc;break}}if(Fe==Pe.lit)throw new Error("hufDecode issues")}}const He=8-te&7;for(le>>=He,pe-=He;pe>0;){const Ze=E[le<<14-pe&16383];if(Ze.len)pe-=Ze.len,ve(Ze.lit,Z,le,pe,O,W,ge,me,Re),le=de.c,pe=de.lc;else throw new Error("hufDecode issues")}return!0}function yi(w,E,O,W,te,Z){const ue={value:0},ge=O.value,me=Ft(E,O),le=Ft(E,O);O.value+=4;const pe=Ft(E,O);if(O.value+=4,me<0||me>=65537||le<0||le>=65537)throw new Error("Something wrong with HUF_ENCSIZE");const Re=new Array(65537),Ie=new Array(16384);B(Ie);const He=W-(O.value-ge);if(k(w,O,He,me,le,Re),pe>8*(W-(O.value-ge)))throw new Error("Something wrong with hufUncompress");ee(Re,me,le,Ie),$t(Re,Ie,w,O,pe,le,Z,te,ue)}function ds(w,E,O){for(let W=0;W<O;++W)E[W]=w[E[W]]}function Sr(w){for(let E=1;E<w.length;E++){const O=w[E-1]+w[E]-128;w[E]=O}}function Wn(w,E){let O=0,W=Math.floor((w.length+1)/2),te=0;const Z=w.length-1;for(;!(te>Z||(E[te++]=w[O++],te>Z));)E[te++]=w[W++]}function $s(w){let E=w.byteLength;const O=new Array;let W=0;const te=new DataView(w);for(;E>0;){const Z=te.getInt8(W++);if(Z<0){const ue=-Z;E-=ue+1;for(let ge=0;ge<ue;ge++)O.push(te.getUint8(W++))}else{const ue=Z;E-=2;const ge=te.getUint8(W++);for(let me=0;me<ue+1;me++)O.push(ge)}}return O}function Er(w,E,O,W,te,Z){let ue=new DataView(Z.buffer);const ge=O[w.idx[0]].width,me=O[w.idx[0]].height,le=3,pe=Math.floor(ge/8),Re=Math.ceil(ge/8),Ie=Math.ceil(me/8),He=ge-(Re-1)*8,Ze=me-(Ie-1)*8,Pe={value:0},Fe=new Array(le),nt=new Array(le),bi=new Array(le),Ei=new Array(le),nr=new Array(le);for(let gt=0;gt<le;++gt)nr[gt]=E[w.idx[gt]],Fe[gt]=gt<1?0:Fe[gt-1]+Re*Ie,nt[gt]=new Float32Array(64),bi[gt]=new Uint16Array(64),Ei[gt]=new Uint16Array(Re*64);for(let gt=0;gt<Ie;++gt){let Gi=8;gt==Ie-1&&(Gi=Ze);let Rr=8;for(let Dt=0;Dt<Re;++Dt){Dt==Re-1&&(Rr=He);for(let Gt=0;Gt<le;++Gt)bi[Gt].fill(0),bi[Gt][0]=te[Fe[Gt]++],Ir(Pe,W,bi[Gt]),ao(bi[Gt],nt[Gt]),lo(nt[Gt]);Tr(nt);for(let Gt=0;Gt<le;++Gt)er(nt[Gt],Ei[Gt],Dt*64)}let $i=0;for(let Dt=0;Dt<le;++Dt){const Gt=O[w.idx[Dt]].type;for(let Xa=8*gt;Xa<8*gt+Gi;++Xa){$i=nr[Dt][Xa];for(let vf=0;vf<pe;++vf){const Wo=vf*64+(Xa&7)*8;ue.setUint16($i+0*2*Gt,Ei[Dt][Wo+0],!0),ue.setUint16($i+1*2*Gt,Ei[Dt][Wo+1],!0),ue.setUint16($i+2*2*Gt,Ei[Dt][Wo+2],!0),ue.setUint16($i+3*2*Gt,Ei[Dt][Wo+3],!0),ue.setUint16($i+4*2*Gt,Ei[Dt][Wo+4],!0),ue.setUint16($i+5*2*Gt,Ei[Dt][Wo+5],!0),ue.setUint16($i+6*2*Gt,Ei[Dt][Wo+6],!0),ue.setUint16($i+7*2*Gt,Ei[Dt][Wo+7],!0),$i+=8*2*Gt}}if(pe!=Re)for(let Xa=8*gt;Xa<8*gt+Gi;++Xa){const vf=nr[Dt][Xa]+8*pe*2*Gt,Wo=pe*64+(Xa&7)*8;for(let pm=0;pm<Rr;++pm)ue.setUint16(vf+pm*2*Gt,Ei[Dt][Wo+pm],!0)}}}const Kt=new Uint16Array(ge);ue=new DataView(Z.buffer);for(let gt=0;gt<le;++gt){O[w.idx[gt]].decoded=!0;const Gi=O[w.idx[gt]].type;if(O[gt].type==2)for(let Rr=0;Rr<me;++Rr){const $i=nr[gt][Rr];for(let Dt=0;Dt<ge;++Dt)Kt[Dt]=ue.getUint16($i+Dt*2*Gi,!0);for(let Dt=0;Dt<ge;++Dt)ue.setFloat32($i+Dt*2*Gi,K(Kt[Dt]),!0)}}}function Ir(w,E,O){let W,te=1;for(;te<64;)W=E[w.value],W==65280?te=64:W>>8==255?te+=W&255:(O[te]=W,te++),w.value++}function ao(w,E){E[0]=K(w[0]),E[1]=K(w[1]),E[2]=K(w[5]),E[3]=K(w[6]),E[4]=K(w[14]),E[5]=K(w[15]),E[6]=K(w[27]),E[7]=K(w[28]),E[8]=K(w[2]),E[9]=K(w[4]),E[10]=K(w[7]),E[11]=K(w[13]),E[12]=K(w[16]),E[13]=K(w[26]),E[14]=K(w[29]),E[15]=K(w[42]),E[16]=K(w[3]),E[17]=K(w[8]),E[18]=K(w[12]),E[19]=K(w[17]),E[20]=K(w[25]),E[21]=K(w[30]),E[22]=K(w[41]),E[23]=K(w[43]),E[24]=K(w[9]),E[25]=K(w[11]),E[26]=K(w[18]),E[27]=K(w[24]),E[28]=K(w[31]),E[29]=K(w[40]),E[30]=K(w[44]),E[31]=K(w[53]),E[32]=K(w[10]),E[33]=K(w[19]),E[34]=K(w[23]),E[35]=K(w[32]),E[36]=K(w[39]),E[37]=K(w[45]),E[38]=K(w[52]),E[39]=K(w[54]),E[40]=K(w[20]),E[41]=K(w[22]),E[42]=K(w[33]),E[43]=K(w[38]),E[44]=K(w[46]),E[45]=K(w[51]),E[46]=K(w[55]),E[47]=K(w[60]),E[48]=K(w[21]),E[49]=K(w[34]),E[50]=K(w[37]),E[51]=K(w[47]),E[52]=K(w[50]),E[53]=K(w[56]),E[54]=K(w[59]),E[55]=K(w[61]),E[56]=K(w[35]),E[57]=K(w[36]),E[58]=K(w[48]),E[59]=K(w[49]),E[60]=K(w[57]),E[61]=K(w[58]),E[62]=K(w[62]),E[63]=K(w[63])}function lo(w){const E=.5*Math.cos(.7853975),O=.5*Math.cos(3.14159/16),W=.5*Math.cos(3.14159/8),te=.5*Math.cos(3*3.14159/16),Z=.5*Math.cos(5*3.14159/16),ue=.5*Math.cos(3*3.14159/8),ge=.5*Math.cos(7*3.14159/16),me=new Array(4),le=new Array(4),pe=new Array(4),Re=new Array(4);for(let Ie=0;Ie<8;++Ie){const He=Ie*8;me[0]=W*w[He+2],me[1]=ue*w[He+2],me[2]=W*w[He+6],me[3]=ue*w[He+6],le[0]=O*w[He+1]+te*w[He+3]+Z*w[He+5]+ge*w[He+7],le[1]=te*w[He+1]-ge*w[He+3]-O*w[He+5]-Z*w[He+7],le[2]=Z*w[He+1]-O*w[He+3]+ge*w[He+5]+te*w[He+7],le[3]=ge*w[He+1]-Z*w[He+3]+te*w[He+5]-O*w[He+7],pe[0]=E*(w[He+0]+w[He+4]),pe[3]=E*(w[He+0]-w[He+4]),pe[1]=me[0]+me[3],pe[2]=me[1]-me[2],Re[0]=pe[0]+pe[1],Re[1]=pe[3]+pe[2],Re[2]=pe[3]-pe[2],Re[3]=pe[0]-pe[1],w[He+0]=Re[0]+le[0],w[He+1]=Re[1]+le[1],w[He+2]=Re[2]+le[2],w[He+3]=Re[3]+le[3],w[He+4]=Re[3]-le[3],w[He+5]=Re[2]-le[2],w[He+6]=Re[1]-le[1],w[He+7]=Re[0]-le[0]}for(let Ie=0;Ie<8;++Ie)me[0]=W*w[16+Ie],me[1]=ue*w[16+Ie],me[2]=W*w[48+Ie],me[3]=ue*w[48+Ie],le[0]=O*w[8+Ie]+te*w[24+Ie]+Z*w[40+Ie]+ge*w[56+Ie],le[1]=te*w[8+Ie]-ge*w[24+Ie]-O*w[40+Ie]-Z*w[56+Ie],le[2]=Z*w[8+Ie]-O*w[24+Ie]+ge*w[40+Ie]+te*w[56+Ie],le[3]=ge*w[8+Ie]-Z*w[24+Ie]+te*w[40+Ie]-O*w[56+Ie],pe[0]=E*(w[Ie]+w[32+Ie]),pe[3]=E*(w[Ie]-w[32+Ie]),pe[1]=me[0]+me[3],pe[2]=me[1]-me[2],Re[0]=pe[0]+pe[1],Re[1]=pe[3]+pe[2],Re[2]=pe[3]-pe[2],Re[3]=pe[0]-pe[1],w[0+Ie]=Re[0]+le[0],w[8+Ie]=Re[1]+le[1],w[16+Ie]=Re[2]+le[2],w[24+Ie]=Re[3]+le[3],w[32+Ie]=Re[3]-le[3],w[40+Ie]=Re[2]-le[2],w[48+Ie]=Re[1]-le[1],w[56+Ie]=Re[0]-le[0]}function Tr(w){for(let E=0;E<64;++E){const O=w[0][E],W=w[1][E],te=w[2][E];w[0][E]=O+1.5747*te,w[1][E]=O-.1873*W-.4682*te,w[2][E]=O+1.8556*W}}function er(w,E,O){for(let W=0;W<64;++W)E[O+W]=ju.toHalfFloat(mn(w[W]))}function mn(w){return w<=1?Math.sign(w)*Math.pow(Math.abs(w),2.2):Math.sign(w)*Math.pow(P,Math.abs(w)-1)}function Ls(w){return new DataView(w.array.buffer,w.offset.value,w.size)}function tr(w){const E=w.viewer.buffer.slice(w.offset.value,w.offset.value+w.size),O=new Uint8Array($s(E)),W=new Uint8Array(O.length);return Sr(O),Wn(O,W),new DataView(W.buffer)}function qn(w){const E=w.array.slice(w.offset.value,w.offset.value+w.size),O=Zf(E),W=new Uint8Array(O.length);return Sr(O),Wn(O,W),new DataView(W.buffer)}function fs(w){const E=w.viewer,O={value:w.offset.value},W=new Uint16Array(w.width*w.scanlineBlockSize*(w.channels*w.type)),te=new Uint8Array(8192);let Z=0;const ue=new Array(w.channels);for(let Ze=0;Ze<w.channels;Ze++)ue[Ze]={},ue[Ze].start=Z,ue[Ze].end=ue[Ze].start,ue[Ze].nx=w.width,ue[Ze].ny=w.lines,ue[Ze].size=w.type,Z+=ue[Ze].nx*ue[Ze].ny*ue[Ze].size;const ge=Je(E,O),me=Je(E,O);if(me>=8192)throw new Error("Something is wrong with PIZ_COMPRESSION BITMAP_SIZE");if(ge<=me)for(let Ze=0;Ze<me-ge+1;Ze++)te[Ze+ge]=qa(E,O);const le=new Uint16Array(65536),pe=R(te,le),Re=Ft(E,O);yi(w.array,E,O,Re,W,Z);for(let Ze=0;Ze<w.channels;++Ze){const Pe=ue[Ze];for(let Fe=0;Fe<ue[Ze].size;++Fe)_t(W,Pe.start+Fe,Pe.nx,Pe.size,Pe.ny,Pe.nx*Pe.size,pe)}ds(le,W,Z);let Ie=0;const He=new Uint8Array(W.buffer.byteLength);for(let Ze=0;Ze<w.lines;Ze++)for(let Pe=0;Pe<w.channels;Pe++){const Fe=ue[Pe],nt=Fe.nx*Fe.size,bi=new Uint8Array(W.buffer,Fe.end*2,nt*2);He.set(bi,Ie),Ie+=nt*2,Fe.end+=nt}return new DataView(He.buffer)}function ps(w){const E=w.array.slice(w.offset.value,w.offset.value+w.size),O=Zf(E),W=w.lines*w.channels*w.width,te=w.type==1?new Uint16Array(W):new Uint32Array(W);let Z=0,ue=0;const ge=new Array(4);for(let me=0;me<w.lines;me++)for(let le=0;le<w.channels;le++){let pe=0;switch(w.type){case 1:ge[0]=Z,ge[1]=ge[0]+w.width,Z=ge[1]+w.width;for(let Re=0;Re<w.width;++Re){const Ie=O[ge[0]++]<<8|O[ge[1]++];pe+=Ie,te[ue]=pe,ue++}break;case 2:ge[0]=Z,ge[1]=ge[0]+w.width,ge[2]=ge[1]+w.width,Z=ge[2]+w.width;for(let Re=0;Re<w.width;++Re){const Ie=O[ge[0]++]<<24|O[ge[1]++]<<16|O[ge[2]++]<<8;pe+=Ie,te[ue]=pe,ue++}break}}return new DataView(te.buffer)}function An(w){const E=w.viewer,O={value:w.offset.value},W=new Uint8Array(w.width*w.lines*(w.channels*w.type*2)),te={version:ji(E,O),unknownUncompressedSize:ji(E,O),unknownCompressedSize:ji(E,O),acCompressedSize:ji(E,O),dcCompressedSize:ji(E,O),rleCompressedSize:ji(E,O),rleUncompressedSize:ji(E,O),rleRawSize:ji(E,O),totalAcUncompressedCount:ji(E,O),totalDcUncompressedCount:ji(E,O),acCompression:ji(E,O)};if(te.version<2)throw new Error("EXRLoader.parse: "+Af.compression+" version "+te.version+" is unsupported");const Z=new Array;let ue=Je(E,O)-2;for(;ue>0;){const Pe=zi(E.buffer,O),Fe=qa(E,O),nt=Fe>>2&3,bi=(Fe>>4)-1,Ei=new Int8Array([bi])[0],nr=qa(E,O);Z.push({name:Pe,index:Ei,type:nr,compression:nt}),ue-=Pe.length+3}const ge=Af.channels,me=new Array(w.channels);for(let Pe=0;Pe<w.channels;++Pe){const Fe=me[Pe]={},nt=ge[Pe];Fe.name=nt.name,Fe.compression=0,Fe.decoded=!1,Fe.type=nt.pixelType,Fe.pLinear=nt.pLinear,Fe.width=w.width,Fe.height=w.lines}const le={idx:new Array(3)};for(let Pe=0;Pe<w.channels;++Pe){const Fe=me[Pe];for(let nt=0;nt<Z.length;++nt){const bi=Z[nt];Fe.name==bi.name&&(Fe.compression=bi.compression,bi.index>=0&&(le.idx[bi.index]=Pe),Fe.offset=Pe)}}let pe,Re,Ie;if(te.acCompressedSize>0)switch(te.acCompression){case 0:pe=new Uint16Array(te.totalAcUncompressedCount),yi(w.array,E,O,te.acCompressedSize,pe,te.totalAcUncompressedCount);break;case 1:const Pe=w.array.slice(O.value,O.value+te.totalAcUncompressedCount),Fe=Zf(Pe);pe=new Uint16Array(Fe.buffer),O.value+=te.totalAcUncompressedCount;break}if(te.dcCompressedSize>0){const Pe={array:w.array,offset:O,size:te.dcCompressedSize};Re=new Uint16Array(qn(Pe).buffer),O.value+=te.dcCompressedSize}if(te.rleRawSize>0){const Pe=w.array.slice(O.value,O.value+te.rleCompressedSize),Fe=Zf(Pe);Ie=$s(Fe.buffer),O.value+=te.rleCompressedSize}let He=0;const Ze=new Array(me.length);for(let Pe=0;Pe<Ze.length;++Pe)Ze[Pe]=new Array;for(let Pe=0;Pe<w.lines;++Pe)for(let Fe=0;Fe<me.length;++Fe)Ze[Fe].push(He),He+=me[Fe].width*w.type*2;Er(le,Ze,me,pe,Re,W);for(let Pe=0;Pe<me.length;++Pe){const Fe=me[Pe];if(!Fe.decoded)switch(Fe.compression){case 2:let nt=0,bi=0;for(let Ei=0;Ei<w.lines;++Ei){let nr=Ze[Pe][nt];for(let Kt=0;Kt<Fe.width;++Kt){for(let gt=0;gt<2*Fe.type;++gt)W[nr++]=Ie[bi+gt*Fe.width*Fe.height];bi++}nt++}break;case 1:default:throw new Error("EXRLoader.parse: unsupported channel compression")}}return new DataView(W.buffer)}function zi(w,E){const O=new Uint8Array(w);let W=0;for(;O[E.value+W]!=0;)W+=1;const te=new TextDecoder().decode(O.slice(E.value,E.value+W));return E.value=E.value+W+1,te}function Xn(w,E,O){const W=new TextDecoder().decode(new Uint8Array(w).slice(E.value,E.value+O));return E.value=E.value+O,W}function Fs(w,E){const O=Zi(w,E),W=Ft(w,E);return[O,W]}function Yn(w,E){const O=Ft(w,E),W=Ft(w,E);return[O,W]}function Zi(w,E){const O=w.getInt32(E.value,!0);return E.value=E.value+4,O}function Ft(w,E){const O=w.getUint32(E.value,!0);return E.value=E.value+4,O}function dt(w,E){const O=w[E.value];return E.value=E.value+1,O}function qa(w,E){const O=w.getUint8(E.value);return E.value=E.value+1,O}const ji=function(w,E){let O;return"getBigInt64"in DataView.prototype?O=Number(w.getBigInt64(E.value,!0)):O=w.getUint32(E.value+4,!0)+Number(w.getUint32(E.value,!0)<<32),E.value+=8,O};function vn(w,E){const O=w.getFloat32(E.value,!0);return E.value+=4,O}function U(w,E){return ju.toHalfFloat(vn(w,E))}function K(w){const E=(w&31744)>>10,O=w&1023;return(w>>15?-1:1)*(E?E===31?O?NaN:1/0:Math.pow(2,E-15)*(1+O/1024):6103515625e-14*(O/1024))}function Je(w,E){const O=w.getUint16(E.value,!0);return E.value+=2,O}function Ut(w,E){return K(Je(w,E))}function gs(w,E,O,W){const te=O.value,Z=[];for(;O.value<te+W-1;){const ue=zi(E,O),ge=Zi(w,O),me=qa(w,O);O.value+=3;const le=Zi(w,O),pe=Zi(w,O);Z.push({name:ue,pixelType:ge,pLinear:me,xSampling:le,ySampling:pe})}return O.value+=1,Z}function ir(w,E){const O=vn(w,E),W=vn(w,E),te=vn(w,E),Z=vn(w,E),ue=vn(w,E),ge=vn(w,E),me=vn(w,E),le=vn(w,E);return{redX:O,redY:W,greenX:te,greenY:Z,blueX:ue,blueY:ge,whiteX:me,whiteY:le}}function Us(w,E){const O=["NO_COMPRESSION","RLE_COMPRESSION","ZIPS_COMPRESSION","ZIP_COMPRESSION","PIZ_COMPRESSION","PXR24_COMPRESSION","B44_COMPRESSION","B44A_COMPRESSION","DWAA_COMPRESSION","DWAB_COMPRESSION"],W=qa(w,E);return O[W]}function QS(w,E){const O=Ft(w,E),W=Ft(w,E),te=Ft(w,E),Z=Ft(w,E);return{xMin:O,yMin:W,xMax:te,yMax:Z}}function k0(w,E){const O=["INCREASING_Y"],W=qa(w,E);return O[W]}function du(w,E){const O=vn(w,E),W=vn(w,E);return[O,W]}function co(w,E){const O=vn(w,E),W=vn(w,E),te=vn(w,E);return[O,W,te]}function ho(w,E,O,W,te){if(W==="string"||W==="stringvector"||W==="iccProfile")return Xn(E,O,te);if(W==="chlist")return gs(w,E,O,te);if(W==="chromaticities")return ir(w,O);if(W==="compression")return Us(w,O);if(W==="box2i")return QS(w,O);if(W==="lineOrder")return k0(w,O);if(W==="float")return vn(w,O);if(W==="v2f")return du(w,O);if(W==="v3f")return co(w,O);if(W==="int")return Zi(w,O);if(W==="rational")return Fs(w,O);if(W==="timecode")return Yn(w,O);if(W==="preview")return O.value+=te,"skipped";O.value+=te}function Xc(w,E,O){const W={};if(w.getUint32(0,!0)!=20000630)throw new Error("THREE.EXRLoader: Provided file doesn't appear to be in OpenEXR format.");W.version=w.getUint8(4);const te=w.getUint8(5);W.spec={singleTile:!!(te&2),longName:!!(te&4),deepFormat:!!(te&8),multiPart:!!(te&16)},O.value=8;let Z=!0;for(;Z;){const ue=zi(E,O);if(ue==0)Z=!1;else{const ge=zi(E,O),me=Ft(w,O),le=ho(w,E,O,ge,me);le===void 0?console.warn(`THREE.EXRLoader: Skipped unknown header attribute type '${ge}'.`):W[ue]=le}}if(te&-5)throw console.error("THREE.EXRHeader:",W),new Error("THREE.EXRLoader: Provided file is currently unsupported.");return W}function uo(w,E,O,W,te){const Z={size:0,viewer:E,array:O,offset:W,width:w.dataWindow.xMax-w.dataWindow.xMin+1,height:w.dataWindow.yMax-w.dataWindow.yMin+1,channels:w.channels.length,bytesPerLine:null,lines:null,inputSize:null,type:w.channels[0].pixelType,uncompress:null,getter:null,format:null,colorSpace:Di};switch(w.compression){case"NO_COMPRESSION":Z.lines=1,Z.uncompress=Ls;break;case"RLE_COMPRESSION":Z.lines=1,Z.uncompress=tr;break;case"ZIPS_COMPRESSION":Z.lines=1,Z.uncompress=qn;break;case"ZIP_COMPRESSION":Z.lines=16,Z.uncompress=qn;break;case"PIZ_COMPRESSION":Z.lines=32,Z.uncompress=fs;break;case"PXR24_COMPRESSION":Z.lines=16,Z.uncompress=ps;break;case"DWAA_COMPRESSION":Z.lines=32,Z.uncompress=An;break;case"DWAB_COMPRESSION":Z.lines=256,Z.uncompress=An;break;default:throw new Error("EXRLoader.parse: "+w.compression+" is unsupported")}if(Z.scanlineBlockSize=Z.lines,Z.type==1)switch(te){case eo:Z.getter=Ut,Z.inputSize=2;break;case On:Z.getter=Je,Z.inputSize=2;break}else if(Z.type==2)switch(te){case eo:Z.getter=vn,Z.inputSize=4;break;case On:Z.getter=U,Z.inputSize=4}else throw new Error("EXRLoader.parse: unsupported pixelType "+Z.type+" for "+w.compression+".");Z.blockCount=(w.dataWindow.yMax+1)/Z.scanlineBlockSize;for(let ge=0;ge<Z.blockCount;ge++)ji(E,W);Z.outputChannels=Z.channels==3?4:Z.channels;const ue=Z.width*Z.height*Z.outputChannels;switch(te){case eo:Z.byteArray=new Float32Array(ue),Z.channels<Z.outputChannels&&Z.byteArray.fill(1,0,ue);break;case On:Z.byteArray=new Uint16Array(ue),Z.channels<Z.outputChannels&&Z.byteArray.fill(15360,0,ue);break;default:console.error("THREE.EXRLoader: unsupported type: ",te);break}return Z.bytesPerLine=Z.width*Z.inputSize*Z.channels,Z.outputChannels==4?(Z.format=kn,Z.colorSpace=Di):(Z.format=mc,Z.colorSpace=Fh),Z}const Vo=new DataView(t),fu=new Uint8Array(t),zl={value:0},Af=Xc(Vo,t,zl),ht=uo(Af,Vo,fu,zl,this.type),zS={value:0},LO={R:0,G:1,B:2,A:3,Y:0};for(let w=0;w<ht.height/ht.scanlineBlockSize;w++){const E=Ft(Vo,zl);ht.size=Ft(Vo,zl),ht.lines=E+ht.scanlineBlockSize>ht.height?ht.height-E:ht.scanlineBlockSize;const W=ht.size<ht.lines*ht.bytesPerLine?ht.uncompress(ht):Ls(ht);zl.value+=ht.size;for(let te=0;te<ht.scanlineBlockSize;te++){const Z=te+w*ht.scanlineBlockSize;if(Z>=ht.height)break;for(let ue=0;ue<ht.channels;ue++){const ge=LO[Af.channels[ue].name];for(let me=0;me<ht.width;me++){zS.value=(te*(ht.channels*ht.width)+ue*ht.width+me)*ht.inputSize;const le=(ht.height-1-Z)*(ht.width*ht.outputChannels)+me*ht.outputChannels+ge;ht.byteArray[le]=ht.getter(W,zS)}}}}return{header:Af,width:ht.width,height:ht.height,data:ht.byteArray,format:ht.format,colorSpace:ht.colorSpace,type:this.type}}setDataType(t){return this.type=t,this}load(t,e,i,s){function r(o,a){o.colorSpace=a.colorSpace,o.minFilter=Tt,o.magFilter=Tt,o.generateMipmaps=!1,o.flipY=!1,e&&e(o,a)}return super.load(t,r,i,s)}}class Cw extends qR{constructor(t){super(t),this.type=On}parse(t){const o=function(I,P){switch(I){case 1:throw new Error("THREE.RGBELoader: Read Error: "+(P||""));case 2:throw new Error("THREE.RGBELoader: Write Error: "+(P||""));case 3:throw new Error("THREE.RGBELoader: Bad File Format: "+(P||""));default:case 4:throw new Error("THREE.RGBELoader: Memory Error: "+(P||""))}},u=`
`,d=function(I,P,R){P=P||1024;let Q=I.pos,G=-1,V=0,X="",k=String.fromCharCode.apply(null,new Uint16Array(I.subarray(Q,Q+128)));for(;0>(G=k.indexOf(u))&&V<P&&Q<I.byteLength;)X+=k,V+=k.length,Q+=128,k+=String.fromCharCode.apply(null,new Uint16Array(I.subarray(Q,Q+128)));return-1<G?(R!==!1&&(I.pos+=V+G+1),X+k.slice(0,G)):!1},f=function(I){const P=/^#\?(\S+)/,R=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,B=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,Q=/^\s*FORMAT=(\S+)\s*$/,G=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,V={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let X,k;for((I.pos>=I.byteLength||!(X=d(I)))&&o(1,"no header found"),(k=X.match(P))||o(3,"bad initial token"),V.valid|=1,V.programtype=k[1],V.string+=X+`
`;X=d(I),X!==!1;){if(V.string+=X+`
`,X.charAt(0)==="#"){V.comments+=X+`
`;continue}if((k=X.match(R))&&(V.gamma=parseFloat(k[1])),(k=X.match(B))&&(V.exposure=parseFloat(k[1])),(k=X.match(Q))&&(V.valid|=2,V.format=k[1]),(k=X.match(G))&&(V.valid|=4,V.height=parseInt(k[1],10),V.width=parseInt(k[2],10)),V.valid&2&&V.valid&4)break}return V.valid&2||o(3,"missing format specifier"),V.valid&4||o(3,"missing image size specifier"),V},p=function(I,P,R){const B=P;if(B<8||B>32767||I[0]!==2||I[1]!==2||I[2]&128)return new Uint8Array(I);B!==(I[2]<<8|I[3])&&o(3,"wrong scanline width");const Q=new Uint8Array(4*P*R);Q.length||o(4,"unable to allocate buffer space");let G=0,V=0;const X=4*B,k=new Uint8Array(4),M=new Uint8Array(X);let H=R;for(;H>0&&V<I.byteLength;){V+4>I.byteLength&&o(1),k[0]=I[V++],k[1]=I[V++],k[2]=I[V++],k[3]=I[V++],(k[0]!=2||k[1]!=2||(k[2]<<8|k[3])!=B)&&o(3,"bad rgbe scanline format");let ee=0,Y;for(;ee<X&&V<I.byteLength;){Y=I[V++];const de=Y>128;if(de&&(Y-=128),(Y===0||ee+Y>X)&&o(3,"bad scanline data"),de){const ve=I[V++];for(let _e=0;_e<Y;_e++)M[ee++]=ve}else M.set(I.subarray(V,V+Y),ee),ee+=Y,V+=Y}const he=B;for(let de=0;de<he;de++){let ve=0;Q[G]=M[de+ve],ve+=B,Q[G+1]=M[de+ve],ve+=B,Q[G+2]=M[de+ve],ve+=B,Q[G+3]=M[de+ve],G+=4}H--}return Q},g=function(I,P,R,B){const Q=I[P+3],G=Math.pow(2,Q-128)/255;R[B+0]=I[P+0]*G,R[B+1]=I[P+1]*G,R[B+2]=I[P+2]*G,R[B+3]=1},m=function(I,P,R,B){const Q=I[P+3],G=Math.pow(2,Q-128)/255;R[B+0]=ju.toHalfFloat(Math.min(I[P+0]*G,65504)),R[B+1]=ju.toHalfFloat(Math.min(I[P+1]*G,65504)),R[B+2]=ju.toHalfFloat(Math.min(I[P+2]*G,65504)),R[B+3]=ju.toHalfFloat(1)},v=new Uint8Array(t);v.pos=0;const y=f(v),b=y.width,_=y.height,x=p(v.subarray(v.pos),b,_);let S,T,L;switch(this.type){case eo:L=x.length/4;const I=new Float32Array(L*4);for(let R=0;R<L;R++)g(x,R*4,I,R*4);S=I,T=eo;break;case On:L=x.length/4;const P=new Uint16Array(L*4);for(let R=0;R<L;R++)m(x,R*4,P,R*4);S=P,T=On;break;default:throw new Error("THREE.RGBELoader: Unsupported type: "+this.type)}return{width:b,height:_,data:S,header:y.string,gamma:y.gamma,exposure:y.exposure,type:T}}setDataType(t){return this.type=t,this}load(t,e,i,s){function r(o,a){switch(o.type){case eo:case On:o.colorSpace=Di,o.minFilter=Tt,o.magFilter=Tt,o.generateMipmaps=!1,o.flipY=!0;break}e&&e(o,a)}return super.load(t,r,i,s)}}const hI="NEEDLE_lightmaps",Of=N("debuglightmapsextension")||N("debuglightmaps");var pl;(function(n){n[n.Lightmap=0]="Lightmap",n[n.Skybox=1]="Skybox",n[n.Reflection=2]="Reflection"})(pl||(pl={}));class y6{constructor(t,e,i){c(this,"parser");c(this,"registry");c(this,"source");this.parser=t,this.registry=e,this.source=i}get name(){return hI}afterRoot(t){const e=this.parser.json.extensions;if(e){const i=e[hI];if(i){const s=i.textures;return s!=null&&s.length?(Of&&console.log(i),new Promise(async(r,o)=>{const a=[];for(const h of s)if(h.pointer){Of&&console.log(h);let u=null;if(h.pointer.startsWith("/textures/"))Of&&console.log("Load texture from gltf",h.pointer),u=oC(this.parser,h.pointer).then(d=>this.resolveTexture(h,d));else if(typeof h.pointer=="string"){Of&&console.log("Load texture from path",h.pointer);const d=qh(this.source,h.pointer);let f;d.endsWith(".exr")?f=new yv(this.parser.options.manager):d.endsWith(".hdr")?f=new Cw(this.parser.options.manager):f=new Ra(this.parser.options.manager),u=f.loadAsync(d,void 0).then(p=>this.resolveTexture(h,p))}else h.pointer;u&&a.push(u)}const l=await vx(a);l!=null&&l.anyFailed&&xe()&&console.error("Failed to load lightmap extension",l),r()})):null}}return null}resolveTexture(t,e){const i=e;Of&&console.log("Lightmap loaded:",i),i!=null&&i.isTexture&&(this.registry?(i.colorSpace=Di,this.registry.registerTexture(this.source,t.type,i,t.index)):console.log(pl[t.type],t.pointer,i))}}const uI=!!N("debuglightmaps");class b6{constructor(t){c(this,"_context");c(this,"_lightmaps",new Map);this._context=t}clear(){this._lightmaps.clear()}registerTexture(t,e,i,s){uI&&console.log("Registering ",pl[e]+' "'+t+'"',i),this._lightmaps.has(t)||this._lightmaps.set(t,new Map);const r=this._lightmaps.get(t),o=(r==null?void 0:r.get(e))??[];o.length<s&&(o.length=s+1),o[s]=i,r==null||r.set(e,o)}tryGetLightmap(t,e=0){return this.tryGet(t,pl.Lightmap,e)}tryGetSkybox(t){return this.tryGet(t,pl.Skybox,0)}tryGetReflection(t){return this.tryGet(t,pl.Reflection,0)}tryGet(t,e,i){if(!t)return uI&&console.warn("Missing source id"),null;const s=this._lightmaps.get(t);if(!s)return null;const r=s.get(e);return r===void 0||!(r!=null&&r.length)||r.length<=i?null:r[i]}}ng.lights_fragment_maps=ng.lights_fragment_maps.replace("vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );",`
    vec2 lUv = vLightMapUv.xy * lightmapScaleOffset.xy + vec2(lightmapScaleOffset.z, (1. - (lightmapScaleOffset.y + lightmapScaleOffset.w)));
    vec4 lightMapTexel = texture2D( lightMap, lUv);
    // The range of RGBM lightmaps goes from 0 to 34.49 (5^2.2) in linear space, and from 0 to 5 in gamma space.
    lightMapTexel.rgb *= lightMapTexel.a * 8.; // no idea where that "8" comes from... heuristically derived
    lightMapTexel.a = 1.;
    lightMapTexel = conv_sRGBToLinear(lightMapTexel);
    `);ng.lightmap_pars_fragment=`
    #ifdef USE_LIGHTMAP
        uniform sampler2D lightMap;
        uniform float lightMapIntensity;
        uniform vec4 lightmapScaleOffset;
        
        // took from threejs 05fc79cd52b79e8c3e8dec1e7dca72c5c39983a4
        vec4 conv_sRGBToLinear( in vec4 value ) {
            return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
        }
    #endif
    `;ng.lights_fragment_begin=ng.lights_fragment_begin.replace("irradiance += getLightProbeIrradiance( lightProbe, geometry.normal );",`
#if defined(USE_LIGHTMAP)
irradiance += 0.;
#else
irradiance += getLightProbeIrradiance( lightProbe, geometry.normal );
#endif`);In.lightmap.lightmapScaleOffset={value:new ke(1,1,0,0)};const Mb=N("debugprogressive"),jm=new Nn,Gm=new Wh;class _6{constructor(t){c(this,"context");c(this,"_lodsManager");this.context=t}get manager(){return this._lodsManager}get targetTriangleDensity(){var t;return((t=this._lodsManager)==null?void 0:t.targetTriangleDensity)??-1}set targetTriangleDensity(t){this._lodsManager&&(this._lodsManager.targetTriangleDensity=t)}setRenderer(t){var e;(e=this._lodsManager)==null||e.disable(),cc.removePlugin(this),cc.addPlugin(this),cc.debugDrawLine=De.DrawLine,this._lodsManager=cc.get(t),this._lodsManager.enable()}onAfterUpdatedLOD(t,e,i,s,r){Mb&&this.onRenderDebug(i,s,r)}onRenderDebug(t,e,i){var a,l,h;if(!e.geometry||!ct.hasLODLevelAvailable(e.geometry)&&!ct.hasLODLevelAvailable(e.material))return;const s=cc.getObjectLODState(e);if(!s)return;let r=i.mesh_lod;const o=i.mesh_lod!=s.lastLodLevel_Mesh||i.texture_lod!=s.lastLodLevel_Texture;if(Mb&&e.geometry.boundingSphere){const u=e.geometry.boundingSphere;Gm.copy(u),Gm.applyMatrix4(e.matrixWorld);const d=Gm.center,f=Gm.radius,p=["#76c43e","#bcc43e","#c4ac3e","#c4673e","#ff3e3e"];if(o)De.DrawWireSphere(d,f,p[r],.1);else{const g=((a=e.geometry.index)==null?void 0:a.count)??0,m=(l=ct.getMeshLODInformation(e.geometry))==null?void 0:l.lods;r=m?Math.min((m==null?void 0:m.length)-1,r):0;let v="";if(m&&s.lastScreenCoverage>0)for(let _=0;_<m.length;_++){const x=m[_].density,S=_==m.length-1;v+=x.toFixed(0)+">"+(x/s.lastScreenCoverage).toFixed(0)+(S?"":",")}const y=m?(h=m[r])==null?void 0:h.density:-1;let b="LOD "+i.mesh_lod+`
TEX `+i.texture_lod;if(Mb=="density"&&(b+=`
`+g+` tris
`+(y/s.lastScreenCoverage).toFixed(0)+` dens
`+(s.lastScreenCoverage*100).toFixed(1)+`% cov
`+(s.lastCentrality*100).toFixed(1)+`% centr
`+(jm.min.x.toFixed(2)+"-"+jm.max.x.toFixed(2)+"x"+jm.min.y.toFixed(2)+"-"+jm.max.y.toFixed(2))+" scr"),s.lastScreenCoverage>.1){const _=t,x=_.worldForward,S=_.worldPosition,L=Pi(x).multiplyScalar(f*.7).add(d),I=L.distanceTo(S),P=p[Math.min(p.length-1,r)]+"88",R=this.context.domHeight>0?screen.height/this.context.domHeight:1,B=t.isPerspectiveCamera?Math.tan(t.fov*Math.PI/180/2):1;De.DrawLabel(L,b,I*.012*R*B,void 0,16777215,P)}}}}}const Hm=N("debugphysics"),dI=new $r;class Lo{constructor(){c(this,"ray");c(this,"cam");c(this,"screenPoint");c(this,"raycaster");c(this,"results");c(this,"targets");c(this,"recursive",!0);c(this,"minDistance");c(this,"maxDistance");c(this,"lineThreshold");c(this,"layerMask");c(this,"ignore");c(this,"testObject")}screenPointFromOffset(t,e){this.screenPoint===void 0&&(this.screenPoint=new ae),this.screenPoint.x=t/window.innerWidth*2-1,this.screenPoint.y=-(e/window.innerHeight)*2+1}setLayer(t){dI.set(t),this.layerMask=dI}setMask(t){this.layerMask||(this.layerMask=new $r);const e=this.layerMask;e?e.mask=t:this.layerMask=t}}c(Lo,"AllLayers",4294967295);class w6{constructor(t,e,i){c(this,"distance");c(this,"point");c(this,"object");this.object=t,this.distance=e,this.point=i}}class x6{constructor(t){c(this,"context");c(this,"engine");c(this,"raycaster",new jd);c(this,"defaultRaycastOptions",new Lo);c(this,"targetBuffer",new Array(1));c(this,"defaultThresholds",{Mesh:{},Line:{threshold:-1},LOD:{},Points:{threshold:0},Sprite:{}});c(this,"sphereResults",new Array);c(this,"sphereMask",new $r);c(this,"tempBoundingBox",new Nn);this.context=t}raycastPhysicsFast(t,e=void 0,i=1/0,s=!0){var r;return((r=this.context.physics.engine)==null?void 0:r.raycast(t,e,{maxDistance:i,solid:s}))??null}raycastPhysicsFastAndGetNormal(t,e=void 0,i=1/0,s=!0){var r;return((r=this.context.physics.engine)==null?void 0:r.raycastAndGetNormal(t,e,{maxDistance:i,solid:s}))??null}sphereOverlapPhysics(t,e){var i;return((i=this.context.physics.engine)==null?void 0:i.sphereOverlap(t,e))??null}sphereOverlap(t,e,i=!0){if(this.sphereResults.length=0,!this.context.scene)return this.sphereResults;const s=new Wh(t,e),r=this.sphereMask;r.enableAll(),r.disable(2);for(const o of this.context.scene.children)this.onSphereOverlap(o,s,r,this.sphereResults,i);return this.sphereResults.sort((o,a)=>o.distance-a.distance)}onSphereOverlap(t,e,i,s,r){if(t.type==="Mesh"&&t.layers.test(i)&&!De.isGizmo(t)){const o=t,a=o.geometry;if(a&&(a.boundingBox||a.computeBoundingBox(),a.boundingBox)){o.matrixWorldNeedsUpdate&&o.updateMatrixWorld();const l=this.tempBoundingBox.copy(a.boundingBox).applyMatrix4(o.matrixWorld);if(e.intersectsBox(l)){const h=qe(t),u=h.distanceTo(e.center),d=new w6(t,u,h);if(s.push(d),!r)return}}}if(t.children)for(const o of t.children){const a=s.length;if(this.onSphereOverlap(o,e,i,s,r),a!=s.length&&!r)return}}raycastFromRay(t,e=null){const i=e??this.defaultRaycastOptions;i.ray=t;const s=this.raycast(i);return i===this.defaultRaycastOptions&&(i.ray=void 0),s}raycast(t=null){t||(t=this.defaultRaycastOptions);const e=t.screenPoint??this.context.input.mousePositionRC,i=t.raycaster??this.raycaster;if(i.near=t.minDistance??0,i.far=t.maxDistance??1/0,i.params=this.defaultThresholds,t.lineThreshold===void 0&&(t.lineThreshold=-1),i.params.Line={threshold:t.lineThreshold},t.ray)i.ray.copy(t.ray);else{const a=t.cam??this.context.mainCamera;if(!a)return Hm&&console.error("Can not perform raycast - no main camera found"),this.defaultRaycastOptions.results&&(this.defaultRaycastOptions.results.length=0),this.defaultRaycastOptions.results??[];const l=this.context.xrCamera;this.context.isInXR&&l instanceof y2&&l.cameras.length>0?i.setFromCamera(e,l.cameras[0]):i.setFromCamera(e,a)}let s=t.targets;s||(s=this.targetBuffer,s.length=1,s[0]=this.context.scene);let r=t.results;this.defaultRaycastOptions.results&&(this.defaultRaycastOptions.results.length=0),r||(this.defaultRaycastOptions.results||(this.defaultRaycastOptions.results=new Array),r=this.defaultRaycastOptions.results),t.layerMask!==void 0?t.layerMask instanceof $r?i.layers.mask=t.layerMask.mask:i.layers.mask=t.layerMask:(i.layers.enableAll(),i.layers.disable(2)),Hm&&(De.DrawRay(i.ray.origin,i.ray.direction,16711680,2),console.time("raycast")),r.length=0,this.intersect(this.raycaster,s,r,t),r.sort((a,l)=>a.distance-l.distance);const o=t.ignore;return o!==void 0&&o.length>0&&(r=r.filter(a=>!o.includes(a.object))),Hm&&(console.timeEnd("raycast"),console.log("hits:",r!=null&&r.length?[...r]:"nothing")),r}intersect(t,e,i,s){var r;for(const o of e){if(o.visible===!1||De.isGizmo(o)||s.lineThreshold!==void 0&&s.lineThreshold<0&&o instanceof Hs)continue;const a=(r=s.testObject)==null?void 0:r.call(s,o);if(a===!1)continue;if(a!=="continue in children"){const h=o,u=h.geometry;if(u){const d=Dg(o);d&&(h.geometry=d),t.intersectObject(o,!1,i),Hm&&De.DrawWireMesh({mesh:o,depthTest:!1,duration:.1}),h.geometry=u}}s.recursive!==!1&&this.intersect(t,o.children,i,s)}return i}}const C6=N("debugplayerview");var yl;(function(n){n.Browser="browser",n.Headset="headset",n.Handheld="handheld"})(yl||(yl={}));class S6{constructor(t,e){c(this,"userId");c(this,"context");c(this,"viewDevice",yl.Browser);c(this,"removed",!1);c(this,"_object");this.userId=t,this.context=e}get currentObject(){return this._object}set currentObject(t){this._object=t}get isConnected(){return this.context.connection.userIsInRoom(this.userId)}}class E6{constructor(t){c(this,"context");c(this,"playerViews",new Map);this.context=t}setPlayerView(t,e,i){let s=this.playerViews.get(t);s||(s=new S6(t,this.context),this.playerViews.set(t,s)),s.viewDevice=i,s.currentObject=e,s.removed=!1}getPlayerView(t){if(!t)return;if(!this.context.connection.userIsInRoom(t)){this.playerViews.delete(t);return}return this.playerViews.get(t)}removePlayerView(t,e){const i=this.playerViews.get(t);(i==null?void 0:i.viewDevice)===e&&(C6&&console.log("REMOVE",t),i.removed=!0,this.playerViews.delete(t))}}new Zr;const Ug=new Uint8Array(4);Ug[0]=255;Ug[1]=255;Ug[2]=255;Ug[3]=255;const I6=new zd(Ug,1,1,kn);function QD(n,t=1){const e="alpha"in n,i=t*t,s=new Uint8Array(4*i),r=Math.floor(n.r*255),o=Math.floor(n.g*255),a=Math.floor(n.b*255);for(let h=0;h<i;h++){const u=h*4;s[u+0]=r,s[u+1]=o,s[u+2]=a,e?s[u+3]=Math.floor(n.alpha*255):s[u+3]=255}const l=new zd(s,t,t);return l.needsUpdate=!0,l}function T6(n,t,e,i=1,s=3){const o=i*s,a=[n,t,e],l=a.length,h=new Uint8Array(4*l*o),u=new we;for(let f=0;f<s;f++){const p=Math.floor(f/s*l),g=Ae.clamp(p+1,0,l-1),m=a[p],v=a[g],y=f/s*l%1;u.lerpColors(m,v,y);const b=Math.floor(u.r*255),_=Math.floor(u.g*255),x=Math.floor(u.b*255);for(let S=0;S<i;S++){const T=(f*i+S)*4;h[T+0]=b,h[T+1]=_,h[T+2]=x,h[T+3]=255}}const d=new zd(h,i,s);return d.needsUpdate=!0,d}var fI;(function(n){n[n.Vertex=0]="Vertex",n[n.Fragment=1]="Fragment"})(fI||(fI={}));function bv(n,t){const e=n.elements;t||(t=[]),t.length=0;for(let i=0;i<16;i+=4){const s=e[i],r=e[i+1],o=e[i+2],a=e[i+3],l=new ke(s,r,o,a);t.push(l)}return t}const Db=[],pI=[];function R6(n,t){if(Db.length===0)for(let e=0;e<27;e++)Db.push(0);t||(t=Db);for(let e=0;e<27;e++)pI[e]=t[e];t=pI,n.unity_SHAr={value:new ke(t[9],t[3],t[6],t[0])},n.unity_SHBr={value:new ke(t[12],t[15],t[18],t[21])},n.unity_SHAg={value:new ke(t[10],t[4],t[7],t[1])},n.unity_SHBg={value:new ke(t[13],t[16],t[19],t[22])},n.unity_SHAb={value:new ke(t[11],t[5],t[8],t[2])},n.unity_SHBb={value:new ke(t[14],t[17],t[20],t[23])},n.unity_SHC={value:new ke(t[24],t[25],t[26],1)}}class B6{constructor(t,e,i){c(this,"vertexShader");c(this,"fragmentShader");c(this,"technique");this.vertexShader=t,this.fragmentShader=e,this.technique=i}}async function P6(n,t){if(!n)return console.error("Can not find technique: no shader data"),null;const e=n.programs[t],i=e.vertexShader,s=e.fragmentShader;if(i!==void 0&&s!==void 0){const r=n.shaders[i],o=n.shaders[s];if(r.uri&&o.uri||r.code&&o.code){if(!r.code&&r.uri&&await gI(r),!o.code&&o.uri&&await gI(o),!r.code||!o.code)return null;const a=n.techniques[t];return new B6(r.code,o.code,a)}}return console.error("Shader technique not found",t),null}async function gI(n){const t=n.uri;if(t)if(t.endsWith(".glsl")){const i=await new Zr().loadAsync(t);n.code=i.toString()}else n.code=M6(n.uri)}function M6(n){return decodeURIComponent(Array.prototype.map.call(atob(n),function(t){return"%"+("00"+t.charCodeAt(0).toString(16)).slice(-2)}).join(""))}const go=N("debugenvlight");var ya;(function(n){n[n.Skybox=0]="Skybox",n[n.Trilight=1]="Trilight",n[n.Flat=3]="Flat",n[n.Custom=4]="Custom"})(ya||(ya={}));var yg;(function(n){n[n.Skybox=0]="Skybox",n[n.Custom=1]="Custom"})(yg||(yg={}));class D6{constructor(t){c(this,"context");c(this,"_currentLightSettingsId");c(this,"_sceneLightSettings");c(this,"_timevec4",new ke);c(this,"__currentReflectionId",null);c(this,"_lighting",{});this.context=t,this.context.pre_update_callbacks.push(this.preUpdate.bind(this))}preUpdate(){const t=this.context.time;this._timevec4.x=t.time,this._timevec4.y=Math.sin(t.time),this._timevec4.z=Math.cos(t.time),this._timevec4.w=t.deltaTime}get timeVec4(){return this._timevec4}get environmentIntensity(){if(!this._sceneLightSettings||!this._currentLightSettingsId)return 1;const t=this._sceneLightSettings.get(this._currentLightSettingsId);return t?t.ambientIntensity:1}get sceneLightSettings(){var t;return(t=this._sceneLightSettings)==null?void 0:t.values()}enable(t){var i;t instanceof it&&(t=t.uri);const e=(i=this._sceneLightSettings)==null?void 0:i.get(t);return e?(go&&console.log("Enable scene light settings",t,e),t!==this._currentLightSettingsId&&this._currentLightSettingsId&&this.disable(this._currentLightSettingsId),this._currentLightSettingsId=t,e.enabled=!0,!0):(go&&console.warn("No light settings found for",t),!1)}disable(t){var i;if(t instanceof it&&(t=t.uri),t==null)return!1;const e=(i=this._sceneLightSettings)==null?void 0:i.get(t);return e?(go&&console.log("Disable scene light settings",t,e),e.enabled=!1,!0):!1}disableCurrent(){if(this._currentLightSettingsId){const t=this._currentLightSettingsId;return this.disable(this._currentLightSettingsId),t}return null}internalRegisterSceneLightSettings(t){const e=t.sourceId;if(!e){console.error("Missing source id for scene light settings, can not register:",t);return}go&&console.log("Register "+(t==null?void 0:t.sourceId)+" lighting",t),this._sceneLightSettings||(this._sceneLightSettings=new Map),this._sceneLightSettings.set(e,t)}internalUnregisterSceneLightSettings(t){const e=t.sourceId;if(!e){console.error("Missing source id for scene light settings, can not unregister:",t);return}go&&console.log("Unregister "+(t==null?void 0:t.sourceId)+" lighting",t),this._sceneLightSettings&&this._sceneLightSettings.delete(e)}internalRegisterReflection(t,e){go&&console.log("Register reflection",t,e);const i=new k6(this.context,e,1);this._lighting[t]=i}internalGetReflection(t){return this._lighting[t]}internalEnableReflection(t){var i;this.__currentReflectionId=t;const e=(i=this._sceneLightSettings)==null?void 0:i.get(t);switch(go&&console.log("Enable reflection",t,e?ya[e.ambientMode]:"Unknown ambient mode",e),e==null?void 0:e.ambientMode){case ya.Skybox:case ya.Custom:const s=this.internalGetReflection(t);if(s&&s.Source){go&&console.log("Setting environment reflection",s);const r=this.context.scene,o=s.Source;o.mapping=wc,r.environment=o;return}else go&&console.warn("Could not find reflection for source",t);break}if((e==null?void 0:e.environmentReflectionSource)===yg.Custom)switch(e==null?void 0:e.ambientMode){case ya.Trilight:if(e.ambientTrilight){const s=e.ambientTrilight,r=T6(s[0],s[1],s[2],64,64);r.colorSpace=Ue,r.mapping=wc,this.context.scene.environment=r}else console.error("Missing ambient trilight",e.sourceId);return;case ya.Flat:if(e.ambientLight){const s=QD(e.ambientLight,64);s.colorSpace=Ue,s.mapping=wc,this.context.scene.environment=s}else console.error("Missing ambientlight",e.sourceId);return;default:return}}internalDisableReflection(t){if(t&&t!==this.__currentReflectionId){go&&console.log("Not disabling reflection for",t,"because it is not the current light settings id",this.__currentReflectionId);return}go&&console.log("Disable reflection",t);const e=this.context.scene;e.environment=null}}class k6{constructor(t,e,i=1){c(this,"_source");this._source=e,e.mapping=wc}get Source(){return this._source}}const mI=N("timescale");let Sw=1;typeof mI=="number"&&(Sw=mI);class O6{constructor(){c(this,"_time",0);c(this,"_deltaTime",0);c(this,"_deltaTimeUnscaled",0);c(this,"timeScale",1);c(this,"_frame",0);c(this,"clock",new b2);c(this,"_smoothedFps",0);c(this,"_smoothedDeltaTime",0);c(this,"_fpsSamples",[]);c(this,"_fpsSampleIndex",0);typeof Sw=="number"&&(this.timeScale=Sw)}get time(){return this._time}set time(t){this._time=t}get deltaTime(){return this._deltaTime}set deltaTime(t){this._deltaTime=t}get deltaTimeUnscaled(){return this._deltaTimeUnscaled}get frame(){return this._frame}set frame(t){this._frame=t}get frameCount(){return this.frame}get realtimeSinceStartup(){return this.clock.elapsedTime}get smoothedFps(){return this._smoothedFps}get smoothedDeltaTime(){return 1/this._smoothedFps}update(){this.deltaTime=this.clock.getDelta(),this.deltaTime=Math.min(.1,this.deltaTime),this._deltaTimeUnscaled=this.deltaTime,this.deltaTime<=0&&(this.deltaTime=1e-12),this.deltaTime*=this.timeScale,this.frame+=1,this.time+=this.deltaTime,this._fpsSamples.length<60?this._fpsSamples.push(this.deltaTime):this._fpsSamples[this._fpsSampleIndex++%60]=this.deltaTime;let t=0;for(let e=0;e<this._fpsSamples.length;e++)t+=this._fpsSamples[e];this._smoothedDeltaTime=t/this._fpsSamples.length,this._smoothedFps=1/this._smoothedDeltaTime}}function Xr(n){const t=document.createElement("span");return t.style.maxWidth="48px",t.style.maxHeight="48px",t.style.overflow="hidden",t.classList.add("material-symbols-outlined"),t.innerText=n,t}function L6(n){var e;return((e=n.classList)==null?void 0:e.contains("material-symbols-outlined"))||!1}const Vm=new Map;async function AI(n){const t="Material Symbols Outlined";if(document.fonts.check(`1em '${t}'`)||(console.log("Font not loaded yet"),await document.fonts.ready),Vm.has(n))return Vm.get(n);const e=document.createElement("canvas"),i=48;e.width=i,e.height=i;const s=e.getContext("2d");if(s){s.font=`${i}px '${t}'`,s.fillStyle="black",s.fillText(n,0,i);const r=e.toDataURL(),o=new pt;return o.name=n+" icon",o.image=new Image,o.image.src=r,o.needsUpdate=!0,Vm.set(n,o),o}return Vm.set(n,null),null}const $v=class{constructor(){c(this,"_fullscreenButton");c(this,"_muteButton");c(this,"_qrButton")}static getOrCreate(){return this._instance||(this._instance=new $v),this._instance}static create(){return new $v}get fullscreenButton(){return this._fullscreenButton}createFullscreenButton(t){if(this._fullscreenButton)return this._fullscreenButton;if(!document.fullscreenEnabled)return xe()&&console.warn("NeedleMenu: Fullscreen button could not be created, device doesn't support the Fullscreen API"),null;const e=document.createElement("button");this._fullscreenButton=e,e.classList.add("fullscreen-button"),e.title="Click to enter fullscreen mode";const i=Xr("fullscreen"),s=Xr("fullscreen_exit");return e.appendChild(i),e.onclick=()=>{document.fullscreenElement?document.exitFullscreen():"webkitRequestFullscreen"in t.domElement&&typeof t.domElement.webkitRequestFullscreen=="function"?t.domElement.webkitRequestFullscreen():"requestFullscreen"in t.domElement&&t.domElement.requestFullscreen()},document.addEventListener("fullscreenchange",()=>{document.fullscreenElement?(i.remove(),e.appendChild(s),e.title="Click to enter fullscreen mode"):(s.remove(),e.appendChild(i),e.title="Click to exit fullscreen mode")}),globalThis.addEventListener("needle-xrsession-start",()=>{e.style.display="none"}),globalThis.addEventListener("needle-xrsession-end",()=>{e.style.display=""}),e}get muteButton(){return this._muteButton}createMuteButton(t){if(this._muteButton)return this._muteButton;const e=document.createElement("button");this._muteButton=e,e.classList.add("mute-button"),e.title="Click to mute/unmute";const i=Xr("volume_off"),s=Xr("volume_up");return t.application.muted?e.appendChild(i):e.appendChild(s),e.onclick=()=>{t.application.muted?(i.remove(),e.appendChild(s),t.application.muted=!1):(s.remove(),e.appendChild(i),t.application.muted=!0)},e}get qrButton(){return this._qrButton}createQRCode(){if(this._qrButton)return this._qrButton;const t=document.createElement("button");this._qrButton=t,t.innerText="QR Code",t.prepend(Xr("qr_code")),t.title="Scan this QR code with your phone to open this page",this.hideElementDuringXRSession(t),No()&&(t.style.display="none");const e=document.createElement("div");e.style.position="fixed",e.style.display="inline-block",e.style.padding="1rem",e.style.backgroundColor="white",e.style.borderRadius="0.4rem",e.style.cursor="pointer",e.style.zIndex="1000",e.style.boxShadow="0 0 12px rgba(0, 0, 0, 0.2)";const i=document.createElement("div");i.classList.add("qr-code-container"),e.appendChild(i),t.addEventListener("click",()=>{if(e.parentNode)return r();window.location.href.includes("://localhost")&&Yt("To access your website from another device in the same local network you have to use the IP address instead of localhost."),s()});async function s(){await o(),document.body.appendChild(e);const a=i.getBoundingClientRect(),l=t.getBoundingClientRect();e.style.left=l.left+l.width*.5-a.width*.5+"px",l.top<a.height?e.style.top=`calc(${l.bottom}px + ${e.style.padding} * .6)`:e.style.top=`calc(${l.top-a.height}px - ${e.style.padding} * 2.5)`,e.style.opacity="0",e.style.pointerEvents="all",e.style.transition="opacity 0.2s ease-in-out",setTimeout(()=>{e.style.opacity="1",window.addEventListener("click",r,{once:!0})}),window.addEventListener("resize",r),window.addEventListener("scroll",r),document.body.appendChild(e)}function r(){e.style.pointerEvents="none",e.style.transition="opacity 0.2s",e.style.opacity="0",setTimeout(()=>{var a;return(a=e.parentNode)==null?void 0:a.removeChild(e)},500),window.removeEventListener("click",r),window.removeEventListener("resize",r),window.removeEventListener("scroll",r)}async function o(){const l=await pL({text:window.location.href,width:200,height:200});i.innerHTML="",i.appendChild(l)}return t.addEventListener("pointerenter",()=>{o()},{once:!0}),t}hideElementDuringXRSession(t){aC(e=>{t["previous-display"]=t.style.display,t.style.display="none"}),HM(e=>{t["previous-display"]!=null&&(t.style.display=t["previous-display"])})}};let Sa=$v;c(Sa,"_instance");function Ew(n,t){const e=(t==null?void 0:t.element)||document.head,i=Array.from(e.querySelectorAll(`link[rel=stylesheet][href*='${n}']`));if(i.length<=0){const s=document.createElement("link");s.href=n,s.rel="stylesheet",e.appendChild(s),i.push(s)}if(t!=null&&t.loadedCallback)for(let s=0;s<i.length;s++)t!=null&&t.loadedCallback&&i[s].addEventListener("load",t.loadedCallback)}function zD(){Ew("https://fonts.googleapis.com/css2?family=Roboto+Flex:opsz,wght@8..144,100..1000&display=swap")}const _v="needle-logo-element";class jD extends HTMLElement{constructor(){super();c(this,"_root");c(this,"wrapper");c(this,"logoElement",document.createElement("img"));c(this,"textElement",document.createElement("span"));this._root=this.attachShadow({mode:"closed"});const e=document.createElement("template");e.innerHTML=`<style>
        :host {
            position: relative;
            min-width: fit-content;
            /* height: 100%; can not have height 100% because of align-items: stretch; in the parent */
            display: flex;
            margin: 0 0.3rem;
        }

        .wrapper {
            position: relative;
            display: grid;
            grid-template-columns: auto auto;
            padding: .1rem;
        }
        .wrapper:hover {
            cursor: pointer;
        }
        img {
            width: 95px;
            height: 100%;
            align-self: end;
        }
        span {
            font-size: 1rem;
            white-space: nowrap;
        }
        </style>
        <div class="wrapper">
            <img class="logo" src=${kN} />
        </div>
        `,this._root.appendChild(e.content.cloneNode(!0)),this.wrapper=this._root.querySelector(".wrapper"),this._root.appendChild(this.wrapper),this.addEventListener("click",()=>{globalThis.open("https://needle.tools","_blank")}),this.wrapper.setAttribute("title","Made with Needle Engine")}static get elementName(){return _v}static create(){return document.createElement(_v)}setLogoVisible(e){this.logoElement.style.display=e?"block":"none"}}customElements.get(_v)||customElements.define(_v,jD);const kb=N("debugspatialmenu");class F6{constructor(t,e){c(this,"_context");c(this,"needleMenu");c(this,"htmlButtonsMap",new Map);c(this,"enabled",!0);c(this,"uiisDirty",!1);c(this,"_showNeedleLogo");c(this,"_wasInXR",!1);c(this,"preRender",()=>{var e;if(!this.enabled){(e=this.menu)==null||e.removeFromParent();return}kb&&Id()&&this.updateMenu();const t=this._context.xr;if(!(t!=null&&t.running)){this._wasInXR&&(this._wasInXR=!1,this.onExitXR());return}this._wasInXR||(this._wasInXR=!0,this.onEnterXR()),this.updateMenu()});c(this,"_menuTarget",new re);c(this,"positionFilter",new rP(90,.5));c(this,"familyName","Needle Spatial Menu");c(this,"menu");c(this,"_poweredByNeedleElement");var s;this._context=t,this._context.pre_render_callbacks.push(this.preRender),this.needleMenu=e;const i=(s=this.needleMenu.shadowRoot)==null?void 0:s.querySelector(".options");i?new MutationObserver(o=>{if(this.enabled&&!(this._context.isInXR==!1&&!kb))for(const a of o)a.type==="childList"&&(a.addedNodes.forEach(l=>{this.createButtonFromHTMLNode(l)}),a.removedNodes.forEach(l=>{const h=l,u=this.htmlButtonsMap.get(h);u&&(this.htmlButtonsMap.delete(h),u.remove(),zt.update())}))}).observe(i,{childList:!0}):console.error("Could not find options container in needle menu")}setEnabled(t){var e;this.enabled=t,t||(e=this.menu)==null||e.removeFromParent()}onDestroy(){const t=this._context.pre_render_callbacks.indexOf(this.preRender);t>-1&&this._context.pre_render_callbacks.splice(t,1)}markDirty(){this.uiisDirty=!0}showNeedleLogo(t){this._showNeedleLogo=t}onEnterXR(){var e;const t=(e=this.needleMenu.shadowRoot)==null?void 0:e.querySelector(".options");t&&t.childNodes.forEach(i=>{this.createButtonFromHTMLNode(i)})}onExitXR(){var t;(t=this.menu)==null||t.removeFromParent()}createButtonFromHTMLNode(t){const e=this.getMenu(),i=this.htmlButtonsMap.get(t);if(i){i.add();return}const s=t,r=this.createButton(e,s);this.htmlButtonsMap.set(s,r),r.add()}updateMenu(){var r,o;const t=this.getMenu();this.handleNeedleWatermark(),this._context.scene.add(t);const e=this._context.mainCamera,i=this._context.xr,s=(i==null?void 0:i.rigScale)||1;if(e){const a=e.worldPosition,l=e.worldForward.multiplyScalar(-1),h=l.y>.6,u=l.y>.4,d=t.visible?u:h,f=!t.visible&&d;t.visible=d||Id()&&kb,l.multiplyScalar(3*s),a.add(l),(f||!1)&&(t.position.copy(this._menuTarget.position),t.position.y+=1,this._menuTarget.position.copy(t.position),this.positionFilter.reset(t.position),t.quaternion.copy(this._menuTarget.quaternion),this.markDirty());const g=this._menuTarget.position.distanceTo(a);(f||g>1.5*s)&&(this.ensureRenderOnTop(this.menu),this._menuTarget.position.copy(a),this._context.scene.add(this._menuTarget),Ay(this._menuTarget,this._context.mainCamera,!1,!0),this._menuTarget.removeFromParent()),this.positionFilter.filter(this._menuTarget.position,t.position,this._context.time.time);const m=5;(r=this.menu)==null||r.quaternion.slerp(this._menuTarget.quaternion,this._context.time.deltaTime*m),(o=this.menu)==null||o.scale.setScalar(s)}this.uiisDirty&&(this.uiisDirty=!1,zt.update())}ensureRenderOnTop(t,e=0){t instanceof J&&(t.material.depthTest=!1,t.material.depthWrite=!1),t.renderOrder=1e3+e*2;for(const i of t.children)this.ensureRenderOnTop(i,e+1)}getMenu(){if(this.menu)return this.menu;this.ensureFont(),this.menu=new zt.Block({boxSizing:"border-box",fontFamily:this.familyName,height:"auto",fontSize:.1,color:0,lineHeight:1,backgroundColor:16777215,backgroundOpacity:.55,borderRadius:.04,whiteSpace:"pre-wrap",flexDirection:"row",alignItems:"center",padding:new ke(0,.05,0,.05),borderColor:0,borderOpacity:.05,borderWidth:.005});const t=D.get("ObjectRaycaster");return t&&Sh(this.menu,new t),this.menu}handleNeedleWatermark(){var t;if(!this._poweredByNeedleElement){this._poweredByNeedleElement=new zt.Block({width:"auto",height:"auto",fontSize:.05,whiteSpace:"pre-wrap",flexDirection:"row",flexWrap:"wrap",justifyContent:"center",margin:.02,borderRadius:.02,padding:.02,backgroundColor:16777215,backgroundOpacity:1}),this._poweredByNeedleElement["needle:use_eventsystem"]=!0;const e=new vI(this._context,()=>globalThis.open("https://needle.tools","_self"));Sh(this._poweredByNeedleElement,e);const i=new zt.Text({textContent:"Powered by",width:"auto",height:"auto"}),s=new zt.Text({textContent:"needle",width:"auto",height:"auto",fontSize:.07,margin:new ke(0,0,0,.02)});this._poweredByNeedleElement.add(i),this._poweredByNeedleElement.add(s),(t=this.menu)==null||t.add(this._poweredByNeedleElement),this.markDirty(),new Ra().load("./include/needle/poweredbyneedle.webp",o=>{var l;e.allowModifyUI=!1,i.removeFromParent(),s.removeFromParent();const a=o.image.width/o.image.height;(l=this._poweredByNeedleElement)==null||l.set({backgroundImage:o,backgroundOpacity:1,width:.1*a,height:.1}),this.markDirty()})}if(this.menu){const e=this.menu.children.indexOf(this._poweredByNeedleElement);if(!this._showNeedleLogo&&_h())e>=0&&(this._poweredByNeedleElement.removeFromParent(),this.markDirty());else{this._poweredByNeedleElement.visible=!0,this.menu.add(this._poweredByNeedleElement);const i=this.menu.children.indexOf(this._poweredByNeedleElement);e!==i&&this.markDirty()}}}ensureFont(){let t=zt.FontLibrary.getFontFamily(this.familyName);if(!t){t=zt.FontLibrary.addFontFamily(this.familyName);const e=t.addVariant("normal","normal","./include/needle/arial-msdf.json","./include/needle/arial.png");e==null||e.addEventListener("ready",()=>{this.markDirty()})}}createButton(t,e){const i=new zt.Block({width:"auto",height:"auto",whiteSpace:"pre-wrap",flexDirection:"row",flexWrap:"wrap",justifyContent:"center",backgroundColor:16777215,backgroundOpacity:0,padding:.02,margin:.01,borderRadius:.02,cursor:"pointer",fontSize:.05}),s=new zt.Text({textContent:"",width:"auto",justifyContent:"center",alignItems:"center",backgroundOpacity:0,backgroundColor:16777215,fontFamily:this.familyName,color:0,borderRadius:.02,padding:.01});i.add(s),i["needle:use_eventsystem"]=!0;const r=new vI(this._context,()=>e.click());return Sh(i,r),new U6(this,t,e,i,s)}}class U6{constructor(t,e,i,s,r){c(this,"menu");c(this,"root");c(this,"htmlbutton");c(this,"spatialContainer");c(this,"spatialText");c(this,"spatialIcon");c(this,"_lastText","");c(this,"_lastTexture");this.menu=t,this.root=e,this.htmlbutton=i,this.spatialContainer=s,this.spatialText=r,new MutationObserver(a=>{for(const l of a)l.type==="attributes"?l.attributeName==="style"&&this.updateVisible():l.type==="childList"&&this.updateText()}).observe(i,{attributes:!0,childList:!0}),this.updateText()}add(){this.spatialContainer.parent!=this.root&&(this.root.add(this.spatialContainer),this.menu.markDirty(),this.updateVisible(),this.updateText())}remove(){this.spatialContainer.parent&&(this.spatialContainer.removeFromParent(),this.menu.markDirty())}updateVisible(){const t=this.spatialContainer.visible;this.spatialContainer.visible=this.htmlbutton.style.display!=="none",t!==this.spatialContainer.visible&&this.menu.markDirty()}updateText(){let t="",e="";this.htmlbutton.childNodes.forEach(i=>{i.nodeType===Node.TEXT_NODE?t+=i.textContent:i instanceof HTMLElement&&L6(i)&&i.textContent&&(e=i.textContent)}),this._lastText!==t&&(this._lastText=t,this.spatialText.name=t,this.spatialText.set({textContent:t}),this.menu.markDirty()),t.length<=0?this.spatialText.parent&&(this.spatialText.removeFromParent(),this.menu.markDirty()):this.spatialText.parent||(this.spatialContainer.add(this.spatialText),this.menu.markDirty()),e&&this.createIcon(e)}async createIcon(t){var i;if(!this.spatialIcon){const s=await AI(t);if(s&&!this.spatialIcon){const o=new zt.Block({width:.08,height:.08,backgroundColor:16777215,backgroundImage:s,backgroundOpacity:1,margin:new ke(0,.005,0,0)});this.spatialIcon=o,this.spatialContainer.add(o),this.menu.markDirty()}}if(t!=this._lastTexture){this._lastTexture=t;const s=await AI(t);s&&((i=this.spatialIcon)==null||i.set({backgroundImage:s}),this.menu.markDirty())}const e=this.spatialContainer.children.indexOf(this.spatialIcon);e>0&&(this.spatialContainer.children.splice(e,1),this.spatialContainer.children.unshift(this.spatialIcon),this.menu.markDirty())}}class vI{constructor(t,e){c(this,"isComponent",!0);c(this,"enabled",!0);c(this,"gameObject");c(this,"allowModifyUI",!0);c(this,"context");c(this,"onclick");this.context=t,this.onclick=e}get activeAndEnabled(){return!0}__internalAwake(){}__internalEnable(){}__internalDisable(){}__internalStart(){}onEnable(){}onDisable(){}get element(){return this.gameObject}onPointerEnter(){this.context.input.setCursorPointer(),this.allowModifyUI&&(this.element.set({backgroundOpacity:1}),zt.update())}onPointerExit(){this.context.input.setCursorNormal(),this.allowModifyUI&&(this.element.set({backgroundOpacity:0}),zt.update())}onPointerDown(t){t.use()}onPointerUp(t){t.use()}onPointerClick(t){t.use(),this.onclick()}}const Xu="needle-menu",Ep=N("debugmenu"),yI=N("debugnoncommercial");let N6=class{constructor(t){c(this,"_context");c(this,"_menu");c(this,"_spatialMenu");c(this,"onPostMessage",t=>{if(t.origin===globalThis.location.origin&&typeof t.data=="object"){const e=t.data,i=e.type;if(i==="needle:menu"){const s=e.button;if(s){if(!s.label)return console.error("NeedleMenu: buttoninfo.label is required");if(!s.onclick)return console.error("NeedleMenu: buttoninfo.onclick is required");const r=document.createElement("button");if(r.textContent=s.label,s.icon){const o=Xr(s.icon);r.prepend(o)}s.priority&&r.setAttribute("priority",s.priority.toString()),r.onclick=()=>{if(s.onclick){const o=s.onclick.startsWith("http")||s.onclick.startsWith("www."),a=s.target||"_blank";o?globalThis.open(s.onclick,a):console.error("NeedleMenu: onclick is not a valid link",s.onclick)}},this._menu.appendChild(r)}else Ep&&console.error("NeedleMenu: unknown postMessage event",e)}else Ep&&console.warn("NeedleMenu: unknown postMessage type",i,e)}});c(this,"onStartXR",t=>{t.session.isScreenBasedAR&&(this._menu.previousParent=this._menu.parentNode,this._context.arOverlayElement.appendChild(this._menu),t.session.session.addEventListener("end",this.onExitXR))});c(this,"onExitXR",()=>{this._menu.previousParent&&(this._menu.previousParent.appendChild(this._menu),delete this._menu.previousParent)});c(this,"_muteButton");c(this,"_fullscreenButton");this._menu=My.getOrCreate(t.domElement,t),this._context=t,this._spatialMenu=new F6(t,this._menu),window.addEventListener("message",this.onPostMessage),aC(this.onStartXR)}onDestroy(){window.removeEventListener("message",this.onPostMessage),this._menu.remove(),this._spatialMenu.onDestroy()}setPosition(t){this._menu.setPosition(t)}setVisible(t){this._menu.setVisible(t)}showNeedleLogo(t){var e;this._menu.showNeedleLogo(t),(e=this._spatialMenu)==null||e.showNeedleLogo(t)}showSpatialMenu(t){this._spatialMenu.setEnabled(t)}showQRCodeButton(t){if(t){const e=Sa.getOrCreate().createQRCode();return e.style.display="",this._menu.appendChild(e),e}else{const e=Sa.getOrCreate().qrButton;return e&&(e.style.display="none"),e??null}}showAudioPlaybackOption(t){var e;if(!t){(e=this._muteButton)==null||e.remove();return}this._muteButton=Sa.getOrCreate().createMuteButton(this._context),this._muteButton.setAttribute("priority","100"),this._menu.appendChild(this._muteButton)}showFullscreenOption(t){var e;if(!t){(e=this._fullscreenButton)==null||e.remove();return}this._fullscreenButton=Sa.getOrCreate().createFullscreenButton(this._context),this._fullscreenButton&&(this._fullscreenButton.setAttribute("priority","150"),this._menu.appendChild(this._fullscreenButton))}appendChild(t){this._menu.appendChild(t)}};class My extends HTMLElement{constructor(){var d,f,p,g;super();c(this,"_domElement",null);c(this,"_context",null);c(this,"_sizeChangeInterval");c(this,"_userRequestedLogoVisible");c(this,"_userRequestedMenuVisible");c(this,"root");c(this,"wrapper");c(this,"options");c(this,"logoContainer");c(this,"_isHandlingChange",!1);c(this,"_didSort",new Map);c(this,"_lastAvailableWidthChange",0);c(this,"_timeoutHandle",0);c(this,"handleSizeChange",(e,i)=>{if(!this._domElement)return;const s=this._domElement.clientWidth;if(s<500){this.root.classList.add("compact");return}const r=20*2,o=s-r;if(!i&&Math.abs(o-this._lastAvailableWidthChange)<1)return;this._lastAvailableWidthChange=o,clearTimeout(this._timeoutHandle),this._timeoutHandle=setTimeout(()=>{const h=l();h<0?this.root.classList.add("compact"):h>0&&(this.root.classList.remove("compact"),l()<0&&this.root.classList.add("compact"))},200);const a=()=>this.options.clientWidth+this.logoContainer.clientWidth,l=()=>o-a()});const e=document.createElement("template");e.innerHTML=`<style>

        #root {
            position: absolute;
            width: auto;
            max-width: 95%;
            left: 50%;
            transform: translateX(-50%);
            top: 20px;
            padding: 0.3rem;
            background: #ffffff5c;
            display: flex;
            visibility: visible;
            flex-direction: row-reverse; /* if we overflow this should be right aligned so the logo is always visible */
            outline: rgb(0 0 0 / 5%) 1px solid;
            border: 1px solid rgba(255, 255, 255, .1);
            border-radius: 1.1999999999999993rem;
            overflow: clip;
            box-shadow: 0px 7px 0.5rem 0px rgb(0 0 0 / 6%), inset 0px 0px 1.3rem rgba(0,0,0,.05);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            pointer-events: all;
            z-index: 1000;
        }

        /** using a div here because then we can change the class for placement **/
        #root.bottom {
            top: auto;
            bottom: 30px;
        }
        
        .wrapper {
            position: relative;
            display: flex;
            flex-direction: row;
            justify-content: center;
            align-items: stretch;
            gap: 0px;
            padding: 0 .3rem;
        }

        .wrapper > *, .options > * {
            position: relative;
            border: none;
            border-radius: 0;
            outline: 1px solid rgba(0,0,0,0);
            display: flex;
            justify-content: center;
            align-items: center;
            max-height: 2.3rem;

            /** basic font settings for all entries **/
            font-size: 1rem;
            font-family: 'Roboto Flex', sans-serif;
            font-optical-sizing: auto;
            font-weight: 500;
            font-weight: 200;
            font-variation-settings: "wdth" 100;
            color: rgb(40,40,40);
        }

        a {
            color: inherit;
            text-decoration: none;
        }

        .options > * {
            padding: .4rem .5rem;
        }
        
        :host .options > * {
            background: transparent;
            border: none;
            white-space: nowrap;
            transition: all 0.1s linear .02s;
            border-radius: 0.8rem;
        }
        :host .options > *:hover {
            cursor: pointer;
            color: black;
            background: rgba(245, 245, 245, .8);
            outline: rgba(0,0,0,.05) 1px solid;
        }

        :host .options > *:disabled {
            background: rgba(0,0,0,.05);
            color: rgba(60,60,60,.7);
            pointer-events: none;
        }

        button {
            gap: 0.3rem;
        }

        /** XR button animation **/
        :host button.this-mode-is-requested {
            background: repeating-linear-gradient(to right, #fff 0%, #fff 40%, #aaffff 55%, #fff 80%);
            background-size: 200% auto;
            background-position: 0 100%;
            animation: AnimationName .7s ease infinite forwards;
        }
        :host button.other-mode-is-requested {
            opacity: .5;
        }
        
        @keyframes AnimationName {
            0% { background-position: 0% 0 }
            100% { background-position: -200% 0 }
        }




        .logo {
            cursor: pointer;
            padding-left: 0.6rem;
        }
        :host .logo.any-options {
            border-left: 1px solid rgba(40,40,40,.4);
            margin-left: 0.3rem;
        }

        .logo > span {
            white-space: nowrap;
        }



        /** COMPACT */
        .compact .wrapper, .compact .options {
            height: auto;
            max-height: initial;
            flex-direction: column-reverse;
        }

        .compact .options > * {
            font-size: 1.2rem;
            padding: .6rem .5rem;
        }
        .compact .top .options {
            height: auto;
            flex-direction: column-reverse;
        }
        .compact .bottom .wrapper {
            height: auto;
            flex-direction: column;
        }
        .compact .logo {
            padding-left: 0;
            margin-left: 0.3rem;
        }
        .compact.bottom .logo.any-options {
            border: none;
            border-bottom: 1px solid rgba(40,40,40,.4);
            padding-bottom: .4rem;
            margin-bottom: .5rem;
        }
        .compact.top .logo.any-options {
            border: none;
            border-top: 1px solid rgba(40,40,40,.4);
            padding-top: .4rem;
            margin-top: .5rem;
        }
        .compact .options > button {
            width: 100%;
        }

        @media (max-width: 300px) or (max-height: 350px){
            .options {
                display: none;
                padding: 0;
                margin: 0;
                border: none;
            }
            .logo.any-options {
                border: none !important;
                padding: 0;
                margin-bottom: 0 !important;
                padding-bottom: 0 !important;
            }
        }
        
        /* dark mode */
        /*
        @media (prefers-color-scheme: dark) {
            :host {
                background: rgba(0,0,0, .6);
            }
            :host button {
                color: rgba(200,200,200);
            }
            :host button:hover {
                background: rgba(100,100,100, .8);
            }
        }
        */

        </style>
        
        <div id="root" class="bottom">
            <div class="wrapper">
                <div class="options"></div>
                <div class="logo">
                    <span class="madewith">powered by</span>
                </div>
            </div>
        </div>
        `;const i=this.attachShadow({mode:"open"});zD();const s="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200&display=block";Ew(s,{loadedCallback:()=>{this.handleSizeChange()}}),Ew(s,{element:i});const r=e.content.cloneNode(!0);i==null||i.appendChild(r),this.root=i.querySelector("#root"),this.wrapper=(d=this.root)==null?void 0:d.querySelector(".wrapper"),this.options=(f=this.root)==null?void 0:f.querySelector(".options"),this.logoContainer=(p=this.root)==null?void 0:p.querySelector(".logo"),(g=this.root)==null||g.appendChild(this.wrapper),this.wrapper.classList.add("wrapper");const o=jD.create();o.style.minHeight="1rem",this.logoContainer.append(o),this.logoContainer.addEventListener("click",()=>{globalThis.open("https://needle.tools","_blank")}),ON(m=>{m==!0&&Sc()&&!yI&&(this.logoContainer.style.display=this._userRequestedLogoVisible?"":"none")});let a=this._context;setTimeout(()=>a=this._context);let l=0;const h=(m,v)=>{var y,b,_;Ep&&console.log("Set menu visible",v),a!=null&&a.isInAR&&a.arOverlayElement?m!=a.arOverlayElement&&a.arOverlayElement.appendChild(this):this.parentNode!=((y=this._domElement)==null?void 0:y.shadowRoot)&&((_=(b=this._domElement)==null?void 0:b.shadowRoot)==null||_.appendChild(this)),this.style.display=v?"flex":"none",this.style.visibility="visible",this.style.opacity="1"};new MutationObserver(m=>{var y;this.onChangeDetected(m);const v=this==null?void 0:this.parentNode;if((this.style.display!="flex"||this.style.visibility!="visible"||this.style.opacity!="1"||v!=((y=this._domElement)==null?void 0:y.shadowRoot))&&!Sc()){const b=l++;qs()&&this._userRequestedMenuVisible===!1?(b===0&&h(v,this._userRequestedMenuVisible),b===1&&console.warn("Needle Menu Warning: You need a PRO license to hide the Needle Engine menu â†’ The menu will be visible in your deployed website if you don't have a PRO license. See https://needle.tools/pricing for details.")):b===0?h(v,!0):setTimeout(()=>h(v,!0),5)}}).observe(this.root,{childList:!0,subtree:!0,attributes:!0}),Ep&&this.___insertDebugOptions()}static create(){return document.createElement(Xu,{is:Xu})}static getOrCreate(e,i){let s=e.querySelector(Xu);return!s&&e.shadowRoot&&(s=e.shadowRoot.querySelector(Xu)),s||(s=My.create(),s._domElement=e,s._context=i,e.shadowRoot?e.shadowRoot.appendChild(s):e.appendChild(s)),s}connectedCallback(){var e;window.addEventListener("resize",this.handleSizeChange),(e=this._domElement)==null||e.addEventListener("resize",this.handleSizeChange),this.handleMenuVisible(),this._sizeChangeInterval=setInterval(()=>this.handleSizeChange(void 0,!0),5e3)}disconnectedCallback(){var e;window.removeEventListener("resize",this.handleSizeChange),(e=this._domElement)==null||e.removeEventListener("resize",this.handleSizeChange),clearInterval(this._sizeChangeInterval)}showNeedleLogo(e){this._userRequestedLogoVisible=e,!(!e&&(!Sc()||yI)&&(console.warn("Needle Menu: You need a PRO license to hide the Needle Engine logo."),!qs()))&&(this.logoContainer.style.display=e?"":"none")}setPosition(e){if(e!=="top"&&e!=="bottom")return console.error("NeedleMenu.setPosition: invalid position",e);this.root.classList.remove("top","bottom"),this.root.classList.add(e)}setVisible(e){this._userRequestedMenuVisible=e,this.style.display=e?"flex":"none"}append(...e){for(const i of e)if(typeof i=="string"){const s=document.createTextNode(i);this.options.appendChild(s)}else this.options.appendChild(i)}appendChild(e){return this.options.appendChild(e)}prepend(...e){for(const i of e)if(typeof i=="string"){const s=document.createTextNode(i);this.options.prepend(s)}else this.options.prepend(i)}onChangeDetected(e){if(!this._isHandlingChange){this._isHandlingChange=!0;try{this.handleMenuVisible();for(const i of e)i.target==this.options&&this.onOptionsChildrenChanged(i)}finally{this._isHandlingChange=!1}}}onOptionsChildrenChanged(e){if(this.logoContainer.classList.toggle("any-options",this.hasAnyVisibleOptions),this.handleSizeChange(),e.type==="childList"){let i=!1;const s=Date.now();for(let r=0;r<e.addedNodes.length;r++){const o=e.addedNodes[r],a=this._didSort.get(o);typeof a=="number"&&s-a<100||(this._didSort.set(o,s),i=!0)}if(i){const r=Array.from(this.options.children);r.sort((o,a)=>{const l=parseInt(o.getAttribute("priority")||"0"),h=parseInt(a.getAttribute("priority")||"0");return l-h});for(const o of r)this.options.appendChild(o)}}}handleMenuVisible(){Ep&&console.log("Update VisibleState: Any Content?",this.hasAnyContent),this.hasAnyContent?this.root.style.display="":this.root.style.display="none",this.logoContainer.classList.toggle("any-options",this.hasAnyVisibleOptions)}get hasAnyContent(){return!!(this.logoContainer.style.display!="none"||this.hasAnyVisibleOptions)}get hasAnyVisibleOptions(){for(let e=0;e<this.options.children.length;e++)if(this.options.children[e].style.display!="none")return!0;return!1}___insertDebugOptions(){window.addEventListener("keydown",s=>{s.key==="p"&&this.setPosition(this.root.classList.contains("top")?"bottom":"top")});const e=document.createElement("button");e.textContent="Hide Buttons",e.onclick=()=>{const s=new Array(this.options.children.length);for(let r=0;r<this.options.children.length;r++)s[r]=this.options.children[r];for(const r of s)this.options.removeChild(r);setTimeout(()=>{for(const r of s)this.options.appendChild(r)},1e3)},this.appendChild(e);const i=document.createElement("button");i.textContent="Toggle Logo",i.addEventListener("click",()=>{this.logoContainer.style.display=this.logoContainer.style.display==="none"?"":"none"}),this.appendChild(i)}}customElements.get(Xu)||customElements.define(Xu,My);const Vi=N("debugcontext"),Q6=N("stats"),z6=N("debugactive"),j6=N("debugframerate"),G6=N("debugcoroutine"),aX={};class lX{constructor(){c(this,"name");c(this,"alias");c(this,"hash");c(this,"runInBackground");c(this,"domElement");c(this,"renderer");c(this,"camera");c(this,"scene")}}var ze;(function(n){n[n.Start=-1]="Start",n[n.EarlyUpdate=0]="EarlyUpdate",n[n.Update=1]="Update",n[n.LateUpdate=2]="LateUpdate",n[n.OnBeforeRender=3]="OnBeforeRender",n[n.OnAfterRender=4]="OnAfterRender",n[n.PrePhysicsStep=9]="PrePhysicsStep",n[n.PostPhysicsStep=10]="PostPhysicsStep",n[n.Undefined=-1]="Undefined"})(ze||(ze={}));function mC(n,t){if(!n)return;if(!n.isComponent){(xe()||Vi)&&console.error(`Registered script is not a Needle Engine component. 
The script will be ignored. Please make sure your component extends "Behaviour" imported from "@needle-tools/engine"
`,n);return}t||(t=Ne.Current,Vi&&console.warn("> Registering component without context"));const e=t==null?void 0:t.new_scripts;e.includes(n)||e.push(n)}const Ht=class{constructor(t){c(this,"name");c(this,"alias");c(this,"isManagedExternally",!1);c(this,"isPaused",!1);c(this,"runInBackground",!1);c(this,"targetFrameRate");c(this,"physicsSteps",1);c(this,"hash");c(this,"domElement");c(this,"_resolutionScaleFactor",1);c(this,"_boundingClientRectFrame",-1);c(this,"_boundingClientRect",null);c(this,"_domX");c(this,"_domY");c(this,"xr",null);c(this,"_xrFrame",null);c(this,"_currentFrameEvent",ze.Undefined);c(this,"scene");c(this,"renderer");c(this,"composer",null);c(this,"scripts",[]);c(this,"scripts_pausedChanged",[]);c(this,"scripts_earlyUpdate",[]);c(this,"scripts_update",[]);c(this,"scripts_lateUpdate",[]);c(this,"scripts_onBeforeRender",[]);c(this,"scripts_onAfterRender",[]);c(this,"scripts_WithCorroutines",[]);c(this,"scripts_immersive_vr",[]);c(this,"scripts_immersive_ar",[]);c(this,"coroutines",{});c(this,"post_setup_callbacks",[]);c(this,"pre_update_callbacks",[]);c(this,"pre_render_callbacks",[]);c(this,"post_render_callbacks",[]);c(this,"pre_update_oneshot_callbacks",[]);c(this,"new_scripts",[]);c(this,"new_script_start",[]);c(this,"new_scripts_pre_setup_callbacks",[]);c(this,"new_scripts_post_setup_callbacks",[]);c(this,"new_scripts_xr",[]);c(this,"mainCameraComponent");c(this,"_camera",null);c(this,"application");c(this,"time");c(this,"input");c(this,"physics");c(this,"connection");c(this,"assets");c(this,"mainLight",null);c(this,"sceneLighting");c(this,"addressables");c(this,"lightmaps");c(this,"players");c(this,"lodsManager");c(this,"menu");c(this,"_sizeChanged",!1);c(this,"_isCreated",!1);c(this,"_isCreating",!1);c(this,"_isVisible",!1);c(this,"_stats",Q6?new bp:null);c(this,"_intersectionObserver",null);c(this,"_disposeCallbacks",[]);c(this,"maxRenderResolution");c(this,"_originalCreationArgs");c(this,"onUnhandledRejection",t=>{this.domElement.dispatchEvent(new CustomEvent("error",{detail:t.reason}))});c(this,"_cameraStack",[]);c(this,"_onBeforeRenderListeners",new Map);c(this,"_onAfterRenderListeners",new Map);c(this,"_requireDepthTexture",!1);c(this,"_requireColorTexture",!1);c(this,"_renderTarget");c(this,"_isRendering",!1);c(this,"_createId",0);c(this,"_renderlooperrors",0);c(this,"_lastTimestamp",0);c(this,"_accumulatedTime",0);c(this,"_dispatchReadyAfterFrame",!1);c(this,"_wasPaused",!1);this.name=(t==null?void 0:t.name)||"",this.alias=t==null?void 0:t.alias,this.domElement=(t==null?void 0:t.domElement)||document.body,this.hash=t==null?void 0:t.hash,t!=null&&t.renderer&&(this.renderer=t.renderer,this.isManagedExternally=!0),(t==null?void 0:t.runInBackground)!==void 0&&(this.runInBackground=t.runInBackground),t!=null&&t.scene?this.scene=t.scene:this.scene=new Ws,t!=null&&t.camera&&(this._camera=t.camera),this.application=new vl(this),this.time=new O6,this.input=new gG(this),this.physics=new x6(this),this.connection=new l6(this),this.assets=new fz,this.sceneLighting=new D6(this),this.addressables=new $8(this),this.lightmaps=new b6(this),this.players=new E6(this),this.menu=new N6(this),this.lodsManager=new _6(this);const e=()=>this._sizeChanged=!0;window.addEventListener("resize",e),this._disposeCallbacks.push(()=>window.removeEventListener("resize",e));const i=new ResizeObserver(s=>this._sizeChanged=!0);i.observe(this.domElement),this._disposeCallbacks.push(()=>i.disconnect()),this._intersectionObserver=new IntersectionObserver(s=>{this._isVisible=s[0].isIntersecting}),this._disposeCallbacks.push(()=>{var s;return(s=this._intersectionObserver)==null?void 0:s.disconnect()}),mt.register(this)}static get DefaultTargetFrameRate(){return Ht._defaultTargetFramerate.value}static set DefaultTargetFrameRate(t){Ht._defaultTargetFramerate.value=t}static get DefaultWebGLRendererParameters(){return Ht._defaultWebglRendererParameters}get version(){return Eo}static get Current(){return mt.Current}static set Current(t){mt.Current=t}appendHTMLElement(t){return this.domElement.shadowRoot?this.domElement.shadowRoot.appendChild(t):this.domElement.appendChild(t)}get resolutionScaleFactor(){return this._resolutionScaleFactor}set resolutionScaleFactor(t){if(t!==this._resolutionScaleFactor&&typeof t=="number"){if(t<=0){console.error("Invalid resolution scale factor",t);return}this._resolutionScaleFactor=t,this.updateSize()}}calculateBoundingClientRect(){if(this.isInAR){this._domX=0,this._domY=0;return}this._boundingClientRectFrame!==this.time.frame&&(this._boundingClientRectFrame=this.time.frame,this._boundingClientRect=this.domElement.getBoundingClientRect(),this._domX=this._boundingClientRect.x,this._domY=this._boundingClientRect.y)}get domWidth(){return this.isInAR?window.innerWidth:this.domElement.clientWidth}get domHeight(){return this.isInAR?window.innerHeight:this.domElement.clientHeight}get domX(){return this.calculateBoundingClientRect(),this._domX}get domY(){return this.calculateBoundingClientRect(),this._domY}get isInXR(){var t,e;return((e=(t=this.renderer)==null?void 0:t.xr)==null?void 0:e.isPresenting)||!1}get xrSessionMode(){var t;return(t=this.xr)==null?void 0:t.mode}get isInVR(){return this.xrSessionMode==="immersive-vr"}get isInAR(){return this.xrSessionMode==="immersive-ar"}get isInPassThrough(){return this.xr?this.xr.isPassThrough:!1}get xrSession(){var t,e;return(e=(t=this.renderer)==null?void 0:t.xr)==null?void 0:e.getSession()}get xrFrame(){return this._xrFrame}get xrCamera(){var t,e;return this.renderer.xr.isPresenting?(e=(t=this.renderer)==null?void 0:t.xr)==null?void 0:e.getCamera():void 0}get arOverlayElement(){const t=this.domElement;return typeof t.getAROverlayContainer=="function"?t.getAROverlayContainer():this.domElement}get currentFrameEvent(){return this._currentFrameEvent}get mainCamera(){if(this._camera)return this._camera;if(this.mainCameraComponent){const t=this.mainCameraComponent;return t.cam||t.buildCamera(),t.cam}return null}set mainCamera(t){this._camera=t}get rendererData(){return this.sceneLighting}get isCreated(){return this._isCreated}createNewRenderer(t){var e,i,s;if((e=this.renderer)==null||e.dispose(),t={...Ht.DefaultWebGLRendererParameters,...t},!t.canvas){const r=(s=(i=this.domElement)==null?void 0:i.shadowRoot)==null?void 0:s.querySelector("canvas");r&&(t.canvas=r,Vi&&console.log("Using canvas from shadow root",r))}Vi&&console.log("Using Renderer Parameters:",t,this.domElement),this.renderer=new Hh(t),this.renderer.debug.checkShaderErrors=xe()||N("checkshadererrors")===!0,this.renderer.toneMappingExposure=1,this.renderer.toneMapping=sg,this.renderer.setClearColor(new we("lightgrey"),0),this.renderer.shadowMap.enabled=!0,this.renderer.shadowMap.type=_2,this.renderer.setSize(this.domWidth,this.domHeight),this.renderer.outputColorSpace=Ue,this.lodsManager.setRenderer(this.renderer),this.input.bindEvents()}internalOnUpdateVisible(){var t,e;(t=this._intersectionObserver)==null||t.disconnect(),(e=this._intersectionObserver)==null||e.observe(this.domElement)}requestSizeUpdate(){this._sizeChanged=!0}updateSize(t=!1){var e,i,s;if(t||!this.isManagedExternally&&((e=this.renderer.xr)==null?void 0:e.isPresenting)===!1){this._sizeChanged=!1;const r=this.resolutionScaleFactor;let o=this.domWidth*r,a=this.domHeight*r;this.maxRenderResolution&&(this.maxRenderResolution.x=Math.max(1,this.maxRenderResolution.x),o=Math.min(this.maxRenderResolution.x,o),this.maxRenderResolution.y=Math.max(1,this.maxRenderResolution.y),a=Math.min(this.maxRenderResolution.y,a));const l=this.mainCamera;this.updateAspect(l),this.renderer.setSize(o,a,!0),this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.domElement.style.width="100%",this.renderer.domElement.style.height="100%",this.composer&&((i=this.composer.setSize)==null||i.call(this.composer,o,a),"setPixelRatio"in this.composer&&typeof this.composer.setPixelRatio=="function"&&((s=this.composer.setPixelRatio)==null||s.call(this.composer,window.devicePixelRatio)))}}updateAspect(t,e,i){if(!t)return;e===void 0&&(e=this.domWidth),i===void 0&&(i=this.domHeight);const s=t.aspect;t.aspect=e/i,s!==t.aspect&&t.updateProjectionMatrix()}recreate(){this.clear(),this.create(this._originalCreationArgs)}async onCreate(t){return this.create(t)}async create(t){try{this._isCreating=!0,t!==this._originalCreationArgs&&(this._originalCreationArgs=dy(t)),window.addEventListener("unhandledrejection",this.onUnhandledRejection);const e=await this.internalOnCreate(t);return this._isCreated=!0,e}finally{window.removeEventListener("unhandledrejection",this.onUnhandledRejection),this._isCreating=!1}}clear(){var t,e,i,s;mt.dispatchCallback(yt.ContextClearing,this),Yo(this,yt.ContextClearing),Ua(this.scene,!0,!0),this.scene=new Ws,(t=this.addressables)==null||t.dispose(),(e=this.lightmaps)==null||e.clear(),(s=(i=this.physics)==null?void 0:i.engine)==null||s.clearCaches(),this.isManagedExternally||this.renderer&&(this.renderer.renderLists.dispose(),this.renderer.state.reset(),this.renderer.resetState()),mt.dispatchCallback(yt.ContextCleared,this)}dispose(){this.internalOnDestroy()}onDestroy(){this.internalOnDestroy()}internalOnDestroy(){var t,e;Ht.Current=this,mt.dispatchCallback(yt.ContextDestroying,this),Yo(this,yt.ContextDestroying),this.clear(),(t=this.renderer)==null||t.setAnimationLoop(null),this.renderer&&(this.renderer.setClearAlpha(0),this.renderer.clear(),this.isManagedExternally||(Vi&&console.log("Disposing renderer"),this.renderer.dispose())),this.scene=null,this.renderer=null,this.input.dispose(),this.menu.onDestroy();for(const i of this._disposeCallbacks)try{i()}catch(s){console.error("Error in on dispose callback:",s,i)}(e=this.domElement)!=null&&e.parentElement&&this.domElement.parentElement.removeChild(this.domElement),this._isCreated=!1,mt.dispatchCallback(yt.ContextDestroyed,this),Yo(this,yt.ContextDestroyed),mt.unregister(this),Ht.Current===this&&(Ht.Current=null)}registerCoroutineUpdate(t,e,i){return typeof(e==null?void 0:e.next)!="function"?(console.error("Registered invalid coroutine function from "+t.name+`
Coroutine functions must be generators: "*myCoroutine() {...}"
Start a coroutine from a component by calling "this.startCoroutine(myCoroutine())"`),e):(this.coroutines[i]||(this.coroutines[i]=[]),this.coroutines[i].push({comp:t,main:e}),e)}unregisterCoroutineUpdate(t,e){if(!this.coroutines[e])return;const i=this.coroutines[e].findIndex(s=>s.main===t);i>=0&&this.coroutines[e].splice(i,1)}stopAllCoroutinesFrom(t){for(const e in this.coroutines){const i=this.coroutines[e];for(let s=i.length-1;s>=0;s--)i[s].comp===t&&i.splice(s,1)}}setCurrentCamera(t){var s;if(!t)return;if(t.cam||t.buildCamera(),!t.cam){console.warn("Camera component is missing camera",t);return}const e=this._cameraStack.indexOf(t);e>=0&&this._cameraStack.splice(e,1),this._cameraStack.push(t),this.mainCameraComponent=t;const i=t.cam;i.isPerspectiveCamera&&this.updateAspect(i),(s=this.mainCameraComponent)==null||s.applyClearFlagsIfIsActiveCamera()}removeCamera(t){if(!t)return;const e=this._cameraStack.indexOf(t);if(e>=0&&this._cameraStack.splice(e,1),this.mainCameraComponent===t&&(this.mainCameraComponent=void 0,this._cameraStack.length>0)){const i=this._cameraStack[this._cameraStack.length-1];this.setCurrentCamera(i)}}addBeforeRenderListener(t,e){this._onBeforeRenderListeners.has(t.uuid)||(this._onBeforeRenderListeners.set(t.uuid,[]),t.onBeforeRender=this._createRenderCallbackWrapper(t,this._onBeforeRenderListeners)),this._onBeforeRenderListeners.get(t.uuid).push(e)}removeBeforeRenderListener(t,e){if(this._onBeforeRenderListeners.has(t.uuid)){const i=this._onBeforeRenderListeners.get(t.uuid),s=i.indexOf(e);s>=0&&i.splice(s,1)}}addAfterRenderListener(t,e){var i;this._onAfterRenderListeners.has(t.uuid)||(this._onAfterRenderListeners.set(t.uuid,[]),t.onAfterRender=this._createRenderCallbackWrapper(t,this._onAfterRenderListeners)),(i=this._onAfterRenderListeners.get(t.uuid))==null||i.push(e)}removeAfterRenderListener(t,e){if(this._onAfterRenderListeners.has(t.uuid)){const i=this._onAfterRenderListeners.get(t.uuid),s=i.indexOf(e);s>=0&&i.splice(s,1)}}_createRenderCallbackWrapper(t,e){return(i,s,r,o,a,l)=>{const h=e.get(t.uuid);if(h)for(let u=0;u<h.length;u++){const d=h[u];d(i,s,r,o,a,l)}}}get isRendering(){return this._isRendering}setRequireDepth(t){this._requireDepthTexture=t}setRequireColor(t){this._requireColorTexture=t}get depthTexture(){var t;return((t=this._renderTarget)==null?void 0:t.depthTexture)||null}get opaqueColorTexture(){var t;return((t=this._renderTarget)==null?void 0:t.texture)||null}get isVisibleToUser(){if(this.isInXR)return!0;if(!this._isVisible)return!1;const t=getComputedStyle(this.domElement);return t.visibility!=="hidden"&&t.display!=="none"&&t.opacity!=="0"}async internalOnCreate(t){var a,l,h,u,d,f,p,g;const e=++this._createId;Vi&&console.log("Creating context",this.name,t);const i=globalThis["needle:dependencies:ready"];i instanceof Promise&&(Vi&&console.log("Waiting for dependencies to be ready"),await i.catch(m=>{(Vi||xe())&&console.error("Needle Engine dependencies failed to load",m)}).then(()=>{Vi&&console.log("Needle Engine dependencies are ready")})),this.clear(),this.isManagedExternally===!1&&(this.createNewRenderer(),(a=this.renderer)==null||a.setAnimationLoop(null)),await El(1),Ht.Current=this,await mt.dispatchCallback(yt.ContextCreationStart,this);let s=!0,r;try{Ht.Current=this,t?r=await this.internalLoadInitialContent(e,t):r=[]}catch(m){console.error(m),s=!1}if(!s||e!==this._createId||(l=t==null?void 0:t.abortSignal)!=null&&l.aborted)return!1;if(this.internalOnUpdateVisible(),!this.renderer)return Vi&&console.warn("Context has no renderer (perhaps it was disconnected?",this.domElement.isConnected),!1;!this.isManagedExternally&&!this.domElement.shadowRoot&&this.domElement.prepend(this.renderer.domElement),Ht.Current=this,Ht.Current=this;for(let m=0;m<this.new_scripts.length;m++){const v=this.new_scripts[m];if(v.gameObject!==void 0&&v.gameObject!==null){v.gameObject.userData===void 0&&(v.gameObject.userData={}),v.gameObject.userData.components===void 0&&(v.gameObject.userData.components=[]);const y=v.gameObject.userData.components;y.includes(v)||y.push(v)}}if(this.post_setup_callbacks)for(let m=0;m<this.post_setup_callbacks.length;m++)Ht.Current=this,await this.post_setup_callbacks[m](this);if(!this.mainCamera){Ht.Current=this;let m=null;Fd(this.scene,v=>{const y=v;if(y!=null&&y.isCamera){if(vp(y.gameObject),!y.activeAndEnabled)return;if(y.tag==="MainCamera")return m=y,!0;m=y}}),m?this.setCurrentCamera(m):!mt.dispatchCallback(yt.MissingCamera,this,{files:r})&&!this.mainCamera&&!this.isManagedExternally&&console.warn("Missing camera in main scene",this)}if(this.input.bindEvents(),Ht.Current=this,dv(this),this.physics.engine&&((h=this.physics.engine)==null||h.step(0),(u=this.physics.engine)==null||u.postStep()),!this.isManagedExternally&&this.composer&&this.mainCamera){const m=new Ty(this.scene,this.mainCamera);this.renderer.setSize(this.domWidth,this.domHeight),this.composer.addPass(m),this.composer.setSize(this.domWidth,this.domHeight)}this._sizeChanged=!0,this._stats&&(this._stats.showPanel(0),(d=this.domElement.shadowRoot)==null||d.appendChild(this._stats.dom)),Vi&&F_(this.scene,!0),this.targetFrameRate===void 0?(Vi&&console.warn("No target framerate set, using default",Ht.DefaultTargetFrameRate),this.targetFrameRate=Ht._defaultTargetFramerate):Vi&&console.log("Target framerate set to",this.targetFrameRate),this._dispatchReadyAfterFrame=!0;const o=mt.dispatchCallback(yt.ContextCreated,this,{files:r});return o&&("internalSetLoadingMessage"in this.domElement&&typeof this.domElement.internalSetLoadingMessage=="function"&&((f=this.domElement)==null||f.internalSetLoadingMessage("finish loading")),await o),(p=t==null?void 0:t.abortSignal)!=null&&p.aborted?!1:(Yo(this,yt.ContextCreated),Vi&&console.log("Context Created...",this.renderer,this.renderer.domElement),this._isCreating=!1,!this.isManagedExternally&&!((g=t==null?void 0:t.abortSignal)!=null&&g.aborted)&&this.restartRenderLoop(),o)}async internalLoadInitialContent(t,e){var l,h,u,d;const i=new Array;if(e.files.length===0)return i;const s=[...e.files],r={name:"",progress:null,index:0,count:s.length},o=La(),a=0;for(let f=0;f<s.length;f++){if((l=e.abortSignal)!=null&&l.aborted){Vi&&console.log("Aborting loading because of abort signal");break}if(t!==this._createId){Vi&&console.log("Aborting loading because create id changed",t,this._createId);break}const p=s[f];(h=e==null?void 0:e.onLoadingStart)==null||h.call(this,f,p),Vi&&console.log("Context Load "+p);const g=await o.loadSync(this,p,p,a,m=>{var v,y;(v=e.abortSignal)!=null&&v.aborted||(r.name=p,r.progress=m,r.index=f,r.count=s.length,(y=e.onLoadingProgress)==null||y.call(this,r))});(u=e==null?void 0:e.onLoadingFinished)==null||u.call(this,f,p,g??null),g?i.push({src:p,file:g}):console.warn("Could not load file: "+p)}if(t!==this._createId||(d=e.abortSignal)!=null&&d.aborted){for(const f of i)if(f&&f.file)for(const p of f.file.scenes)Ua(p,!0,!0)}else for(const f of i)f&&f.file&&this.scene.add(f.file.scene);return i}restartRenderLoop(){return this.renderer?this._isCreating?(console.warn("Can not start render loop while creating context"),!1):(this.renderer.setAnimationLoop((t,e)=>{this.isManagedExternally||this.update(t,e)}),!0):(console.error("Can not start render loop without renderer"),!1)}update(t,e){if(e===void 0&&(e=null),xe()||Vi||yz())try{this.internalStep(t,e),this._renderlooperrors=0}catch(i){this._renderlooperrors+=1,(xe()||Vi)&&(i instanceof Error||i instanceof TypeError)&&Ci("Caught unhandled exception during render-loop - see console for details.",Ui.Error),console.error("Frame #"+this.time.frame+`
`,i),this._renderlooperrors>=3&&(console.warn("Stopping render loop due to error"),this.renderer.setAnimationLoop(null)),this.domElement.dispatchEvent(new CustomEvent("error",{detail:i}))}else this.internalStep(t,e)}updatePhysics(t){this.internalUpdatePhysics(t)}internalStep(t,e){this.internalOnBeforeRender(t,e)!==!1&&(this.internalOnRender(),this.internalOnAfterRender())}internalOnBeforeRender(t,e){var s;this.renderer.info.autoReset=!1;const i=e!==null&&this._xrFrame===null;if(this._xrFrame=e,i&&this.domElement.dispatchEvent(new CustomEvent("xr-session-started",{detail:{context:this,session:this.xrSession,frame:e}})),this._currentFrameEvent=ze.Undefined,this.isManagedExternally===!1&&this.isInXR===!1&&this.targetFrameRate!==void 0){this._lastTimestamp===0&&(this._lastTimestamp=t),this._accumulatedTime+=(t-this._lastTimestamp)/1e3,this._lastTimestamp=t;let r=this.targetFrameRate;if(typeof r=="object"&&(r=r.value),this._accumulatedTime<1/(r+1))return!1;this._accumulatedTime=0}if((s=this._stats)==null||s.begin(),Ht.Current=this,this.onHandlePaused())return!1;for(Ht.Current=this,this.time.update(),j6&&console.log("FPS",this.time.smoothedFps.toFixed(0)),dv(this),DA(this.scene),mM(this),Yo(this,ze.Start);this._cameraStack.length>0&&(!this.mainCameraComponent||this.mainCameraComponent.destroyed);){this._cameraStack.splice(this._cameraStack.length-1,1);const r=this._cameraStack[this._cameraStack.length-1];this.setCurrentCamera(r)}if(this.pre_update_oneshot_callbacks){for(const r in this.pre_update_oneshot_callbacks)this.pre_update_oneshot_callbacks[r]();this.pre_update_oneshot_callbacks.length=0}if(this.pre_update_callbacks)for(const r in this.pre_update_callbacks)this.pre_update_callbacks[r]();this._currentFrameEvent=ze.EarlyUpdate;for(let r=0;r<this.scripts_earlyUpdate.length;r++){const o=this.scripts_earlyUpdate[r];o.activeAndEnabled&&o.earlyUpdate!==void 0&&(Ht.Current=this,o.earlyUpdate())}if(this.executeCoroutines(ze.EarlyUpdate),Yo(this,ze.EarlyUpdate),this.onHandlePaused())return!1;this._currentFrameEvent=ze.Update;for(let r=0;r<this.scripts_update.length;r++){const o=this.scripts_update[r];o.activeAndEnabled&&o.update!==void 0&&(Ht.Current=this,o.update())}if(this.executeCoroutines(ze.Update),Yo(this,ze.Update),this.onHandlePaused())return!1;this._currentFrameEvent=ze.LateUpdate;for(let r=0;r<this.scripts_lateUpdate.length;r++){const o=this.scripts_lateUpdate[r];o.activeAndEnabled&&o.lateUpdate!==void 0&&(Ht.Current=this,o.lateUpdate())}if(this.executeCoroutines(ze.LateUpdate),Yo(this,ze.LateUpdate),this.onHandlePaused()||(this.physicsSteps===void 0&&(this.physicsSteps=1),this.physics.engine&&this.physicsSteps>0&&this.internalUpdatePhysics(this.physicsSteps),this.onHandlePaused()))return!1;if(this.isVisibleToUser||this.runInBackground){this._currentFrameEvent=ze.OnBeforeRender;for(let r=0;r<this.scripts_onBeforeRender.length;r++){const o=this.scripts_onBeforeRender[r];o.activeAndEnabled&&o.onBeforeRender!==void 0&&(Ht.Current=this,o.onBeforeRender(e))}if(this.executeCoroutines(ze.OnBeforeRender),Yo(this,ze.OnBeforeRender),this._sizeChanged&&this.updateSize(),this.pre_render_callbacks)for(const r in this.pre_render_callbacks)this.pre_render_callbacks[r](e)}return!0}internalUpdatePhysics(t){if(!this.physics.engine)return!1;const e=t,i=this.time.deltaTime/e;for(let s=0;s<e;s++)this._currentFrameEvent=ze.PrePhysicsStep,this.executeCoroutines(ze.PrePhysicsStep),this.physics.engine.step(i),this._currentFrameEvent=ze.PostPhysicsStep,this.executeCoroutines(ze.PostPhysicsStep);return this.physics.engine.postStep(),!0}internalOnRender(){this.isManagedExternally||(xz(this),this._currentFrameEvent=ze.Undefined,this.renderNow(),this._currentFrameEvent=ze.OnAfterRender)}internalOnAfterRender(){if(this.isVisibleToUser||this.runInBackground){for(let t=0;t<this.scripts_onAfterRender.length;t++){const e=this.scripts_onAfterRender[t];e.activeAndEnabled&&e.onAfterRender!==void 0&&(Ht.Current=this,e.onAfterRender())}if(this.executeCoroutines(ze.OnAfterRender),Yo(this,ze.OnAfterRender),this.post_render_callbacks)for(const t in this.post_render_callbacks)this.post_render_callbacks[t]()}this._currentFrameEvent=-1,this.connection.sendBufferedMessagesNow(),this._stats&&(this._stats.end(),this.time.frameCount%150===0&&console.log(this.renderer.info.render.calls+" DrawCalls",`
Render:`,{...this.renderer.info.render},`
Memory:`,{...this.renderer.info.memory})),this._dispatchReadyAfterFrame&&(this._dispatchReadyAfterFrame=!1,this.domElement.dispatchEvent(new CustomEvent("ready")),mt.dispatchCallback(yt.ContextFirstFrameRendered,this)),this.renderer.info.reset()}renderNow(t){return!t&&(t=this.mainCamera,!t)?!1:(this._isRendering=!0,this.renderRequiredTextures(),this.composer&&!this.isInXR?this.composer.render(this.time.deltaTime):t&&this.renderer.render(this.scene,t),this._isRendering=!1,!0)}onHandlePaused(){const t=this.evaluatePaused();if(this._wasPaused!==t){z6&&console.log("Paused?",t,"context:"+this.alias);for(let e=0;e<this.scripts_pausedChanged.length;e++){const i=this.scripts_pausedChanged[e];i.activeAndEnabled&&i.onPausedChanged!==void 0&&(Ht.Current=this,i.onPausedChanged(t,this._wasPaused))}}return this._wasPaused=t,t}evaluatePaused(){return this.isInXR?!1:this.isPaused?!0:this.runInBackground?!1:!this.isVisibleToUser}renderRequiredTextures(){if(!this.mainCamera||!this._requireDepthTexture&&!this._requireColorTexture)return;if(!this._renderTarget){if(this._renderTarget=new Ct(this.domWidth,this.domHeight),this._requireDepthTexture){const i=new fx(this.domWidth,this.domHeight);this._renderTarget.depthTexture=i}this._requireColorTexture&&(this._renderTarget.texture=new pt,this._renderTarget.texture.generateMipmaps=!1,this._renderTarget.texture.minFilter=Wt,this._renderTarget.texture.magFilter=Wt,this._renderTarget.texture.format=kn)}const t=this._renderTarget;t.texture&&(t.texture.colorSpace=this.renderer.outputColorSpace);const e=this.renderer.getRenderTarget();this.renderer.setRenderTarget(t),this.renderer.render(this.scene,this.mainCamera),this.renderer.setRenderTarget(e)}executeCoroutines(t){var i;if(this.coroutines[t]){const s=this.coroutines[t];for(let r=0;r<s.length;r++)try{const o=s[r];if(!o.comp||o.comp.destroyed||!o.main||o.comp.enabled===!1){G6&&console.log("Removing coroutine",o.comp,o.comp.enabled),s.splice(r,1),--r;continue}const l=o.chained;if(l&&l.length>0){const f=l[l.length-1].next();if(f.done&&l.pop(),e(f)&&(o.chained||(o.chained=[]),o.chained.push(f.value)),!f.done)continue}const h=o.main.next();if(h.done===!0){s.splice(r,1),--r;continue}const u=h.value;if(e(u)){if(u.next().done)continue;o.chained||(o.chained=[]),o.chained.push(u)}else if(u instanceof Promise){const d=u;o.chained||(o.chained=[]);const f=v6(d);(i=o.chained)==null||i.push(f);continue}}catch(o){console.error(o)}}function e(s){return!!(s&&s.next&&s.return)}}};let Ne=Ht;c(Ne,"_defaultTargetFramerate",{value:60}),c(Ne,"_defaultWebglRendererParameters",{antialias:!0,alpha:!1,powerPreference:"high-performance"});mt.registerCallback(yt.ContextCreated,n=>{const t=n.context;q6(t),V6(t)});const wv=N("debugcomponents"),bI="eff8ba80-635d-11ec-90d6-0242ac120003";class Qn{constructor(t){c(this,"_originalSeed");c(this,"_seed");typeof t=="string"&&(t=Qn.hash(t)),this._originalSeed=t,this._seed=t}get seed(){return this._seed}set seed(t){this._seed=t}reset(){this._seed=this._originalSeed}generateUUID(t){if(typeof t=="string")return m1(t,bI);const e=this._seed;return this._seed-=1,m1(e.toString(),bI)}initialize(t){typeof t=="string"?this._seed=Qn.hash(t):this._seed=t}static createFromString(t){return new Qn(this.hash(t))}static hash(t){let e=0;for(let i=0;i<t.length;i++)e=t.charCodeAt(i)+((e<<5)-e);return e}}var Nh;(function(n){n.NewInstanceCreated="new-instance-created",n.InstanceDestroyed="instance-destroyed"})(Nh||(Nh={}));class GD{constructor(t){c(this,"guid");this.guid=t}}function AC(n,t,e=!0){if(!n)return;const i=n;if(Ua(n,e),!t){console.warn("Can not send destroy: No networking connection provided",n.guid);return}if(!t.isConnected){console.warn("Can not send destroy: not connected",n.guid);return}let s=n.guid;if(!s&&i.uuid&&(s=i.uuid),!s){console.warn("Can not send destroy: failed to find guid",n);return}const r=new GD(s);t.send(Nh.InstanceDestroyed,r,jr.Queued)}function H6(n,t){const e=new GD(n);t.send(Nh.InstanceDestroyed,e,jr.Queued)}function V6(n){n.connection.beginListen(Nh.InstanceDestroyed,t=>{wv&&console.log("[Remote] Destroyed",n.scene,t);const e=Dy(t.guid,n.scene);e&&Ua(e)})}class cX{constructor(t,e,i){c(this,"filename");c(this,"hash");c(this,"size");this.filename=t,this.hash=e,this.size=i}}class W6{constructor(t,e){c(this,"guid");c(this,"originalGuid");c(this,"seed");c(this,"visible");c(this,"hostData");c(this,"dontSave");c(this,"parent");c(this,"position");c(this,"rotation");c(this,"scale");c(this,"preventCreation");this.originalGuid=t,this.guid=e}}function HD(n,t,e,i){var l;const s=n;if(!s.guid)return console.warn("Can not instantiate: No guid",s),null;if(t.context||(t.context=Ne.Current),!t.context)return console.error("Missing network instantiate options / reference to network connection in sync instantiate"),null;const r=t?{...t}:null,{instance:o,seed:a}=X6(s,t);if(o){const h=o;if(h.guid){wv&&console.log("[Local] new instance","gameobject:",o==null?void 0:o.guid);const u=new W6(s.guid,h.guid);u.seed=a,r&&(r.position&&(u.position={x:r.position.x,y:r.position.y,z:r.position.z}),r.rotation&&(u.rotation={x:r.rotation.x,y:r.rotation.y,z:r.rotation.z,w:r.rotation.w}),r.scale&&(u.scale={x:r.scale.x,y:r.scale.y,z:r.scale.z})),u.position||(u.position={x:h.position.x,y:h.position.y,z:h.position.z}),u.rotation||(u.rotation={x:h.quaternion.x,y:h.quaternion.y,z:h.quaternion.z,w:h.quaternion.w}),u.scale||(u.scale={x:h.scale.x,y:h.scale.y,z:h.scale.z}),u.visible=s.visible,r!=null&&r.parent&&(typeof r.parent=="string"?u.parent=r.parent:u.parent=r.parent.guid),u.hostData=e,i===!1&&(u.dontSave=!0),(l=t==null?void 0:t.context)==null||l.connection.send(Nh.NewInstanceCreated,u)}else console.warn("Missing guid, can not send new instance event",h)}return o}function vC(){return Math.random()*9999999}function q6(n){n.connection.beginListen(Nh.NewInstanceCreated,async t=>{const e=await K6(t.originalGuid,n.scene);if(t.preventCreation===!0)return;if(!e){console.warn("could not find object that was instantiated: "+t.guid);return}const i=new za;t.position&&(i.position=new C(t.position.x,t.position.y,t.position.z)),t.rotation&&(i.rotation=new ne(t.rotation.x,t.rotation.y,t.rotation.z,t.rotation.w)),t.scale&&(i.scale=new C(t.scale.x,t.scale.y,t.scale.z)),i.parent=t.parent,t.seed&&(i.idProvider=new Qn(t.seed)),i.visible=t.visible,i.context=n,wv&&n.alias&&console.log("[Remote] instantiate in: "+n.alias);const s=Qg(e,i);s&&(t.parent==="scene"&&n.scene.add(s),wv&&console.log("[Remote] new instance","gameobject:",s==null?void 0:s.guid,e))})}function X6(n,t){const e=vC(),i=t??new za;i.idProvider=new Qn(e);const s=Qg(n,i);return{seed:e,instance:s}}const VD={};function Y6(n,t){VD[n]=t}async function K6(n,t){const e=VD[n];if(e!=null){const i=await e(n);if(i)return i}return WD(n,t)}function WD(n,t){if(t===null||!n)return null;if(t.guid===n)return t;if(t.children)for(const e of t.children){const i=WD(n,e);if(i)return i}return null}const QA=N("debuggetcomponent"),zA=N("debuginstantiate");var _I;(function(n){n[n.None=0]="None",n[n.HideInHierarchy=1]="HideInHierarchy",n[n.HideInInspector=2]="HideInInspector",n[n.DontSaveInEditor=4]="DontSaveInEditor",n[n.NotEditable=8]="NotEditable",n[n.DontSaveInBuild=16]="DontSaveInBuild",n[n.DontUnloadUnusedAsset=32]="DontUnloadUnusedAsset",n[n.DontSave=52]="DontSave",n[n.HideAndDontSave=61]="HideAndDontSave"})(_I||(_I={}));class za{constructor(){c(this,"idProvider");c(this,"parent");c(this,"keepWorldPosition");c(this,"position");c(this,"rotation");c(this,"scale");c(this,"visible");c(this,"context")}clone(){var e,i,s;const t=new za;return t.idProvider=this.idProvider,t.parent=this.parent,t.keepWorldPosition=this.keepWorldPosition,t.position=(e=this.position)==null?void 0:e.clone(),t.rotation=(i=this.rotation)==null?void 0:i.clone(),t.scale=(s=this.scale)==null?void 0:s.clone(),t}cloneAssign(t){var e,i,s;this.idProvider=t.idProvider,this.parent=t.parent,this.keepWorldPosition=t.keepWorldPosition,this.position=(e=t.position)==null?void 0:e.clone(),this.rotation=(i=t.rotation)==null?void 0:i.clone(),this.scale=(s=t.scale)==null?void 0:s.clone()}}function Ng(n){return n.visible}function jA(n,t){return typeof t=="number"&&(t=t>.5),n.visible=t,n.visible}function J6(n){return n[Cc]||yC(n)}function Z6(n,t){n[pM]=t}function yC(n){return Bo.isUsingInstancing(n)}function Dy(n,t){return rg(n,t,!0,!0)}const qD=Symbol("isDestroyed");function Ld(n){return n[qD]}function $6(n,t){n[qD]=t}const Iw=Symbol("isDontDestroy");function wI(n,t=!0){n[Iw]=t}const GA=[],HA=[];function Ua(n,t=!0,e=!1){GA.length=0,HA.length=0,Tw(n,t,!0);for(const i of GA)i.gameObject=null,i.context=null;for(const i of HA)$6(i,!0),e&&Jt(i),gz(i);HA.length=0,GA.length=0}function Tw(n,t=!0,e=!0){var o;if(n==null)return;const i=n;if(i.isComponent){if(i[Iw])return;GA.push(i);const a=i.gameObject;i.__internalDisable(),i.__internalDestroy(),i.gameObject=a;return}if(n[Iw])return;const s=n;QA&&console.log(s),HA.push(s);const r=(o=s.userData)==null?void 0:o.components;if(r!=null&&Array.isArray(r)){let a=r.length;for(let l=0;l<r.length;l++){const h=r[l];Tw(h,t,!1),r.length<a&&(a=r.length,l--)}}if(t&&s.children)for(const a of s.children)Tw(a,t,!1);e&&s.removeFromParent()}function Fd(n,t,e=!0){return YD(n,t,e)}function*XD(n,t,e=!1,i=999,s=0){if(n!=null&&n.userData.components&&!(s>i)){for(const r of n.userData.components)t&&(r==null?void 0:r.isComponent)===!0&&r instanceof t?yield r:yield r;if(e===!0)for(const r of n.children)yield*XD(r,t,!0,i,s+1)}}function YD(n,t,e,i=0){var s;if(n){if(n.isObject3D,i>1e3){console.warn("Failed to iterate components: too many levels");return}if((s=n.userData)!=null&&s.components)for(let r=0;r<n.userData.components.length;r++){const o=n.userData.components[r];if((o==null?void 0:o.isComponent)===!0){const a=t(o);if(a!==void 0)return a}}if(e&&n.children){const r=i+1;for(let o=0;o<n.children.length;o++){const a=n.children[o];if(!a)continue;const l=YD(a,t,e,r);if(l!==void 0)return l}}}}function Qg(n,t=null){let e=null;t!==null&&(t.x!==void 0?(e=new za,e.position=t):e=t);let i=Ne.Current;e!=null&&e.context&&(i=e.context),QA&&i.alias&&console.log("context",i.alias),e&&!e.idProvider&&(e.idProvider=new Qn(Date.now()));const s=[],r={},o={},a=KD(i,n,e,s,r,o);a&&(t5(r),e5(o,r)),QA&&(F_(n,!0),F_(a,!0));const l={};for(const h in s){const u=s[h],d=u.guid;e&&e.idProvider&&(u.guid=e.idProvider.generateUUID(),l[d]=u.guid,QA&&console.log(u.name,u.guid)),mC(u,i),u.__internalNewInstanceCreated&&u.__internalNewInstanceCreated()}for(const h in s){const u=s[h];u.resolveGuids&&u.resolveGuids(l),u.enabled!==!1&&(u.enabled=!0)}return dv(i),a}function KD(n,t,e,i,s,r){var u;if(!t)return null;const o=t.userData;t.userData={};const a=t.children;t.children=[];const l=t.clone(!1);if(bC(l),t.userData=o,t.children=a,s[t.uuid]={original:t,clone:l},zA&&console.log("ADD",t,l),t.type==="SkinnedMesh"&&(r[t.uuid]={original:t,clone:l}),(e==null?void 0:e.visible)!==void 0&&(l.visible=e.visible),e!=null&&e.idProvider){l.uuid=e.idProvider.generateUUID();const d=l;d&&(d.guid=l.uuid)}t.animations&&t.animations.length>0&&(l.animations=[...t.animations]);const h=t.parent;if(h&&h.add(l),e!=null&&e.position?Ts(l,e.position):l.position.copy(t.position),e!=null&&e.rotation?Oo(l,e.rotation):l.quaternion.copy(t.quaternion),e!=null&&e.scale?l.scale.copy(e.scale):l.scale.copy(t.scale),e!=null&&e.parent&&e.parent!=="scene"){let d=null;if(typeof e.parent=="string"?d=rg(e.parent,n.scene,!0):d=e.parent,d){const f=e.keepWorldPosition===!0?d.attach:d.add;f?f.call(d,l):console.error("Invalid parent object",d,"received when instantiating:",t)}else console.warn("could not find parent:",e.parent)}for(const[d,f]of Object.entries(t.userData))d!=="components"&&(l.userData[d]=f);if((u=t.userData)!=null&&u.components){const d=t.userData.components,f=[];l.userData.components=f;for(let p=0;p<d.length;p++){const g=d[p],m=new g.constructor;Dd(m,g),g[TA]!==void 0&&(m[TA]=g[TA]),f.push(m),m.gameObject=l,i.push(m),Ey.dispatchComponentLifecycleEvent(gg.Added,m)}}e&&(e.position=void 0,e.rotation=void 0,e.scale=void 0,e.parent=void 0);for(const d in t.children){const f=t.children[d],p=KD(n,f,e,i,s,r);p&&l.add(p)}return l}function e5(n,t){for(const e in n){const i=n[e],s=i.original,r=s.skeleton,o=i.clone;if(!r){console.warn("Skinned mesh has no skeleton?",i);continue}const a=r.bones,l=o.skeleton.clone();o.skeleton=l,o.bindMatrix.clone().copy(s.bindMatrix),o.bindMatrixInverse.copy(s.bindMatrixInverse);const h=[];l.bones=h;for(let u=0;u<a.length;u++){const d=a[u],p=t[d.uuid].clone;h.push(p)}}for(const e in n){const i=n[e].clone;i.skeleton.update(),i.bind(i.skeleton,i.bindMatrix),i.updateMatrixWorld(!0)}}function t5(n){var t;for(const e in n){const s=n[e].clone;if((t=s.userData)!=null&&t.components)for(let r=0;r<s.userData.components.length;r++){const o=s.userData.components[r],a=Object.entries(o);for(const[l,h]of a)if(Array.isArray(h)){const u=[];o[l]=u;for(let d=0;d<h.length;d++){const f=h[d];if(typeof f!="object"){u.push(f);continue}const p=xI(o,l,f,n);p!==void 0?u.push(p):u.push(f)}}else if(typeof h=="object"){const u=xI(o,l,h,n);u!==void 0&&(o[l]=u)}}}}function xI(n,t,e,i){var s,r;if(e!=null)if(e.isComponent===!0){const o=e.gameObject;if(o){const a=o.uuid,l=(s=i[a])==null?void 0:s.clone;if(!l){zA&&console.log("reference did not change",t,n,e);return}const h=o.userData.components.indexOf(e);if(h>=0)return zA&&console.log(t,a),l.userData.components[h];console.warn("could not find component",t,e)}}else if(e.isObject3D===!0){if(t==="gameObject")return;const o=e;if(o){const a=o.uuid,l=(r=i[a])==null?void 0:r.clone;if(l)return zA&&console.log(t,"old",e,"new",l),l}}else{if(e.isVector4||e.isVector3||e.isVector2||e.isQuaternion||e.isEuler)return e.clone();if(e.isColor===!0)return e.clone();if(e.isEventList===!0)return new e.constructor}}const JD=new Map;function i5(n,t){if(!n)return;if(!t){console.warn("No prototype found",n,n.prototype,n.constructor);return}const e=JD.get(t);e&&e.apply(n)}function n5(n){const t=s5(n.prototype);JD.set(n,t)}function s5(n){return new r5(n)}class r5{constructor(t){c(this,"$symbol");c(this,"extensions");c(this,"descriptors");this.$symbol=Symbol("prototype-extension"),this.extensions=Object.keys(t),this.descriptors=new Array;for(let e=0;e<this.extensions.length;e++){const i=this.extensions[e],s=Object.getOwnPropertyDescriptor(t,i);s&&this.descriptors.push(s)}}apply(t){if(!t[this.$symbol]){t[this.$symbol]=!0;for(let e=0;e<this.extensions.length;e++){const i=this.extensions[e],s=this.descriptors[e];s&&Object.defineProperty(t,i,s)}}}}function bC(n){n&&n.isObject3D===!0&&i5(n,re)}re.prototype.SetActive=function(n){this.visible=n};re.prototype.setActive=function(n){this.visible=n};re.prototype.destroy=function(){Ua(this)};re.prototype.addComponent=function(n,t){return Eh(this,n,t)};re.prototype.addNewComponent=function(n,t){return Eh(this,n,t)};re.prototype.removeComponent=function(n){return ZD(this,n)};re.prototype.getOrAddComponent=function(n,t){return ky(this,n,t)};re.prototype.getComponent=function(n){return qd(this,n)};re.prototype.getComponents=function(n,t){return Oy(this,n,t)};re.prototype.getComponentInChildren=function(n){return Ly(this,n)};re.prototype.getComponentsInChildren=function(n,t){return Fy(this,n,t)};re.prototype.getComponentInParent=function(n){return xv(this,n)};re.prototype.getComponentsInParent=function(n,t){return _C(this,n,t)};Object.getOwnPropertyDescriptor(re.prototype,"activeSelf")||Object.defineProperty(re.prototype,"activeSelf",{get:function(){return Ng(this)},set:function(n){jA(this,n)}});Object.getOwnPropertyDescriptor(re.prototype,"transform")||Object.defineProperty(re.prototype,"transform",{get:function(){return this}});Object.getOwnPropertyDescriptor(re.prototype,"worldPosition")||Object.defineProperty(re.prototype,"worldPosition",{get:function(){return this instanceof Jx?qe(this.object):qe(this)},set:function(n){Ts(this,n)}});Object.getOwnPropertyDescriptor(re.prototype,"worldQuaternion")||Object.defineProperty(re.prototype,"worldQuaternion",{get:function(){return this instanceof Jx?Nt(this.object):Nt(this)},set:function(n){Oo(this,n)}});Object.getOwnPropertyDescriptor(re.prototype,"worldRotation")||Object.defineProperty(re.prototype,"worldRotation",{get:function(){return vy(this)},set:function(n){uP(this,n)}});Object.getOwnPropertyDescriptor(re.prototype,"worldScale")||Object.defineProperty(re.prototype,"worldScale",{get:function(){return ai(this)},set:function(n){lv(this,n)}});Object.getOwnPropertyDescriptor(re.prototype,"worldForward")||Object.defineProperty(re.prototype,"worldForward",{get:function(){return Pi().set(0,0,1).applyQuaternion(Nt(this))}});Object.getOwnPropertyDescriptor(re.prototype,"worldRight")||Object.defineProperty(re.prototype,"worldRight",{get:function(){return Pi().set(1,0,0).applyQuaternion(Nt(this))}});Object.getOwnPropertyDescriptor(re.prototype,"worldUp")||Object.defineProperty(re.prototype,"worldUp",{get:function(){return Pi().set(0,1,0).applyQuaternion(Nt(this))}});n5(re);const o5=N("debuggetcomponent"),CI=()=>o5||globalThis.NEEDLE_DEBUG_GETCOMPONENT===!0;function a5(n){return n==null||n.isObject3D?n:n.object&&n.object.isObject3D?n.object:n}function ZD(n,t){if(!n||!n.userData.components)return t;const e=n.userData.components.indexOf(t);return e<0||(Ey.dispatchComponentLifecycleEvent(gg.Removing,t),t.gameObject=null,n.userData.components.splice(e,1)),t}function ky(n,t,e){const i=qd(n,t);return i||Eh(n,t,e)}const $D=new Qn("addComponentIdProvider");function Sh(n,t,e=!0){n.userData||(n.userData={}),n.userData.components||(n.userData.components=[]),n.userData.components.push(t),t.gameObject=n,(t.guid===void 0||t.guid==="invalid")&&(t.guid=$D.generateUUID()),bC(n),mC(t,t.context);try{e&&t.__internalAwake&&(vp(n),t.activeAndEnabled&&t.__internalAwake()),Ey.dispatchComponentLifecycleEvent(gg.Added,t)}catch(i){console.error(i)}return t}function Eh(n,t,e,i){if(typeof t=="function"){const s=new t;e&&s.__internalNewInstanceCreated(e);let r=!0;return(i==null?void 0:i.callAwake)!=null&&(r=i.callAwake),Sh(n,s,r)}if(t.destroyed)return console.warn("Can not move/add a destroyed component",t),t;if(t.gameObject===n)return t;if(t.gameObject&&t.gameObject.userData.components){const s=t.gameObject.userData.components.indexOf(t);t.gameObject.userData.components.splice(s,1)}if(!n.userData.components)n.userData.components=[];else if(n.userData.components.includes(t))return t;return n.userData.components.push(t),t.gameObject=n,(t.guid===void 0||t.guid==="invalid")&&(t.guid=$D.generateUUID()),e&&t._internalInit(e),mC(t,t.context),t}function l5(n){if(n.gameObject&&n.gameObject.userData.components){const t=n.gameObject.userData.components.indexOf(n);n.gameObject.userData.components.splice(t,1)}n.__internalDisable&&n.__internalDisable(),cl(n,n.context??Ne.Current),n.destroy(),n.gameObject=null}let SI=!1;function ek(n,t,e){var i;if(n==null)return null;if(!n.isObject3D)return console.error("Object is not object3D"),null;if(!((i=n==null?void 0:n.userData)!=null&&i.components)||(typeof t=="string"&&(SI||(SI=!0,console.warn(`Accessing components by name is not supported.
Please use the component type instead. This may keep working in local development but it will fail when bundling your application.

You can import other modules your main module to get access to types
or if you use npmdefs you can make types available globally using globalThis:
https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/globalThis`,t))),CI()&&console.log("[onGetComponent] FIND",t),t==null))return null;for(let s=0;s<n.userData.components.length;s++){const r=n.userData.components[s];let o=Object.getPrototypeOf(r);for(;o;){if(o===t.prototype)if(CI()&&console.log("[onGetComponent] MATCH BY PROTOYPE",o),e)e.push(r);else return r;o=Object.getPrototypeOf(o)}}return e||null}function qd(n,t){const e=ek(n,t);return e?Array.isArray(e)?e[0]:e:null}function Oy(n,t,e,i=!0){return e||(e=[]),i&&(e.length=0),ek(n,t,e),e}function Ly(n,t,e){var s;const i=qd(n,t);if(e===!1&&(i==null?void 0:i.enabled)===!1)return null;if(i)return i;for(let r=0;r<((s=n==null?void 0:n.children)==null?void 0:s.length);r++){const o=Ly(n.children[r],t);if(o)return o}return null}function Fy(n,t,e,i=!0){var s;e||(e=[]),i&&(e.length=0),Oy(n,t,e,!1);for(let r=0;r<((s=n==null?void 0:n.children)==null?void 0:s.length);r++)Fy(n.children[r],t,e,!1);return e}function xv(n,t){if(!n)return null;if(Array.isArray(n)){for(let i=0;i<n.length;i++){const s=a5(n[i]),r=xv(s,t);if(r)return r}return null}const e=qd(n,t);return e||(n.parent?xv(n.parent,t):null)}function _C(n,t,e,i=!0){return e||(e=[]),i&&(e.length=0),n?(Oy(n,t,e,!1),n.parent?_C(n.parent,t,e,!1):e):e}function tk(n,t=void 0,e=!0){if(!n)return null;if(!t&&(t=Ne.Current,!t))return console.error("Can not search object without any needle context or scene!!!"),null;let i=t;if(i.isScene||(i=t==null?void 0:t.scene),!i)return null;for(const s in i.children){const r=i.children[s];if(e===!1&&r[Cc]===!1)continue;const o=Ly(r,n);if(o)return o}return null}function c5(n,t,e=void 0){if(!n)return t;if(t||(t=[]),t.length=0,!e&&(e=Ne.Current,!e))return console.error("Can not search object without any needle context or scene!!!"),t;"scene"in e&&(e=e.scene);const i=e;if(!i)return t;for(const s in i.children){const r=i.children[s];Fy(r,n,t,!1)}return t}class z extends re{constructor(){super(...arguments);c(this,"guid")}static isDestroyed(e){return Ld(e)}static setActive(e,i,s=!0){e&&(jA(e,i),DA(e),i&&s&&mM(Ne.Current,e))}static isActiveSelf(e){return Ng(e)}static isActiveInHierarchy(e){return J6(e)}static markAsInstancedRendered(e,i){Z6(e,i)}static isUsingInstancing(e){return yC(e)}static foreachComponent(e,i,s=!0){return Fd(e,i,s)}static instantiateSynced(e,i){return e?HD(e,i):null}static instantiate(e,i=null){return Qg(e,i)}static destroySynced(e,i,s=!0){if(!e)return;const r=e;i=i??Ne.Current,AC(r,i.connection,s)}static destroy(e,i=!0){return Ua(e,i)}static add(e,i,s){if(!(!e||!i)){if(e===i){console.warn("Can not add object to self",e);return}s||(s=Ne.Current),i.add(e),jA(e,!0),DA(e),s?z.foreachComponent(e,r=>{eC(r,s),!r.__internalDidAwakeAndStart&&s.new_script_start.includes(r)===!1&&s.new_script_start.push(r)},!0):console.warn("Missing context")}}static remove(e){var i;e&&((i=e.parent)==null||i.remove(e),jA(e,!1),DA(e),z.foreachComponent(e,s=>{bz(s)},!0))}static invokeOnChildren(e,i,...s){this.invoke(e,i,!0,s)}static invoke(e,i,s=!1,...r){e&&this.foreachComponent(e,o=>{const a=o[i];a&&typeof a=="function"&&(a==null||a.call(o,...r))},s)}static addNewComponent(e,i,s,r=!0){return Eh(e,i,s,{callAwake:r})}static addComponent(e,i,s,r){return Eh(e,i,s,r)}static moveComponent(e,i){return Eh(e,i)}static removeComponent(e){return ZD(e.gameObject,e),e}static getOrAddComponent(e,i){return ky(e,i)}static getComponent(e,i){return e===null?null:qd(e,i)}static getComponents(e,i,s=null){return e===null?s??[]:Oy(e,i,s)}static findByGuid(e,i){return Dy(e,i)}static findObjectOfType(e,i,s=!0){return tk(e,i??Ne.Current,s)}static findObjectsOfType(e,i){const s=[];return c5(e,s,i),s}static getComponentInChildren(e,i){return Ly(e,i)}static getComponentsInChildren(e,i,s=null){return Fy(e,i,s??void 0)}static getComponentInParent(e,i){return xv(e,i)}static getComponentsInParent(e,i,s=null){return _C(e,i,s)}static getAllComponents(e){var r;return[...(r=e.userData)==null?void 0:r.components]}static*iterateComponents(e){var s;const i=(s=e==null?void 0:e.userData)==null?void 0:s.components;if(i&&Array.isArray(i))for(let r=0;r<i.length;r++)yield i[r]}}var wa;let se=(wa=class{constructor(t){c(this,"__context");c(this,"__name");c(this,"gameObject");c(this,"guid","invalid");c(this,"sourceId");c(this,"__didAwake",!1);c(this,"__didStart",!1);c(this,"__didEnable",!1);c(this,"__isEnabled");c(this,"__destroyed",!1);c(this,"_eventListeners",new Map);this.__didAwake=!1,this.__didStart=!1,this.__didEnable=!1,this.__isEnabled=void 0,this.__destroyed=!1,this._internalInit(t)}get isComponent(){return!0}get context(){return this.__context??Ne.Current}set context(t){this.__context=t}get scene(){return this.context.scene}get layer(){var t,e;return(e=(t=this.gameObject)==null?void 0:t.userData)==null?void 0:e.layer}get name(){var t,e;return(t=this.gameObject)!=null&&t.name?this.gameObject.name:(e=this.gameObject)==null?void 0:e.userData.name}set name(t){this.gameObject?(this.gameObject.userData||(this.gameObject.userData={}),this.gameObject.userData.name=t,this.__name=t):this.__name=t}get tag(){var t;return(t=this.gameObject)==null?void 0:t.userData.tag}set tag(t){this.gameObject&&(this.gameObject.userData||(this.gameObject.userData={}),this.gameObject.userData.tag=t)}get static(){var t;return(t=this.gameObject)==null?void 0:t.userData.static}get hideFlags(){var t;return(t=this.gameObject)==null?void 0:t.userData.hideFlags}get activeAndEnabled(){return!(this.destroyed||this.__isEnabled===!1||!this.__isActiveInHierarchy)}get __isActive(){return this.gameObject.visible}get __isActiveInHierarchy(){if(!this.gameObject)return!1;const t=this.gameObject[Cc];return t===void 0?!0:t}set __isActiveInHierarchy(t){this.gameObject&&(this.gameObject[Cc]=t)}awake(){}onEnable(){}onDisable(){}onDestroy(){this.__destroyed=!0}startCoroutine(t,e=ze.Update){return this.context.registerCoroutineUpdate(this,t,e)}stopCoroutine(t,e=ze.Update){this.context.unregisterCoroutineUpdate(t,e)}get destroyed(){return this.__destroyed}destroy(){this.__destroyed||this.__internalDestroy()}get __internalDidAwakeAndStart(){return this.__didAwake&&this.__didStart}__internalNewInstanceCreated(t){return this.__didAwake=!1,this.__didStart=!1,this.__didEnable=!1,this.__isEnabled=void 0,this.__destroyed=!1,this._internalInit(t),this}_internalInit(t){if(typeof t=="object")for(const e of Object.keys(t)){const i=t[e];typeof i!="function"&&(this[e]=i)}}__internalAwake(){this.__didAwake||(this.__didAwake=!0,this.awake())}__internalStart(){this.__didStart||(this.__didStart=!0,this.start&&this.start())}__internalEnable(t){return this.__destroyed?(xe()&&console.warn("[Needle Engine Dev] Trying to enable destroyed component"),!1):this.__didAwake?this.__didEnable?(t!==!0&&(this.__isEnabled=!0),!1):(this.__didEnable=!0,this.__isEnabled=!0,this.onEnable(),!0):!1}__internalDisable(t){if(this.__didAwake){if(!this.__didEnable){t!==!0&&(this.__isEnabled=!1);return}this.__didEnable=!1,this.__isEnabled=!1,this.onDisable()}}__internalDestroy(){var t;this.__destroyed||(this.__destroyed=!0,this.__didAwake&&((t=this.onDestroy)==null||t.call(this),this.dispatchEvent(new CustomEvent("destroyed",{detail:this}))),l5(this))}get enabled(){return typeof this.__isEnabled=="boolean"?this.__isEnabled:!0}set enabled(t){if(this.__destroyed){xe()&&console.warn(`[Needle Engine Dev] Trying to ${t?"enable":"disable"} destroyed component`);return}if(typeof t=="number"&&(t>=.5?t=!0:t=!1),!this.__didAwake){this.__isEnabled=t;return}t?this.__internalEnable():this.__internalDisable()}get worldPosition(){return qe(this.gameObject)}set worldPosition(t){Ts(this.gameObject,t)}setWorldPosition(t,e,i){Pd(this.gameObject,t,e,i)}get worldQuaternion(){return Nt(this.gameObject)}set worldQuaternion(t){Oo(this.gameObject,t)}setWorldQuaternion(t,e,i,s){aP(this.gameObject,t,e,i,s)}get worldEuler(){return cP(this.gameObject)}set worldEuler(t){hP(this.gameObject,t)}get worldRotation(){return this.gameObject.worldRotation}set worldRotation(t){this.setWorldRotation(t.x,t.y,t.z,!0)}setWorldRotation(t,e,i,s=!0){yy(this.gameObject,t,e,i,s)}get forward(){return wa._forward.set(0,0,-1).applyQuaternion(this.worldQuaternion)}get right(){return wa._right.set(1,0,0).applyQuaternion(this.worldQuaternion)}get up(){return wa._up.set(0,1,0).applyQuaternion(this.worldQuaternion)}addEventListener(t,e){this._eventListeners[t]=this._eventListeners[t]||[],this._eventListeners[t].push(e)}removeEventListener(t,e){if(!this._eventListeners[t])return;const i=this._eventListeners[t].indexOf(e);i>=0&&this._eventListeners[t].splice(i,1)}dispatchEvent(t){if(!t||!this._eventListeners[t.type])return!1;const e=this._eventListeners[t.type];for(let i=0;i<e.length;i++)e[i](t);return!1}},c(wa,"_forward",new C),c(wa,"_right",new C),c(wa,"_up",new C),wa);const h5=Object.freeze(Object.defineProperty({__proto__:null,Behaviour:se,Component:se,GameObject:z},Symbol.toStringTag,{value:"Module"}));var ik=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};class Uy extends se{constructor(){super(...arguments);c(this,"from");c(this,"to");c(this,"width",0);c(this,"centered",!0);c(this,"_centerPos")}awake(){this._centerPos=new C}update(){if(!this.from||!this.to)return;const e=qe(this.from).clone(),i=qe(this.to).clone(),s=e.distanceTo(i);this._centerPos.copy(e),this._centerPos.add(i),this._centerPos.multiplyScalar(.5),Ts(this.gameObject,this.centered?this._centerPos:e),this.gameObject.lookAt(qe(this.to).clone()),this.gameObject.scale.set(this.width,this.width,s)}}ik([A(z)],Uy.prototype,"from",void 0);ik([A(z)],Uy.prototype,"to",void 0);var Jh=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};const wu=N("debuganimation");let nk=class{constructor(){c(this,"x");c(this,"y")}};class Ps extends se{constructor(){super(...arguments);c(this,"playAutomatically",!0);c(this,"randomStartTime",!0);c(this,"minMaxSpeed");c(this,"minMaxOffsetNormalized");c(this,"loop",!0);c(this,"clampWhenFinished",!1);c(this,"_tempAnimationClipBeforeGameObjectExisted",null);c(this,"_tempAnimationsArray");c(this,"mixer");c(this,"_actions",[]);c(this,"_currentActions",[]);c(this,"_handles",[]);c(this,"_didInit",!1)}get clip(){var e;return(e=this.animations)!=null&&e.length?this.animations[0]:null}set clip(e){if(!this.__didAwake){wu&&console.warn("Assign clip during serialization",e),this._tempAnimationClipBeforeGameObjectExisted=e;return}e&&(this.gameObject.animations||(this.gameObject.animations=[]),!this.animations.includes(e)&&(this.animations.length>0?this.animations.splice(0,0,e):this.animations.push(e)))}set clips(e){this.animations=e}set animations(e){e==null||!Array.isArray(e)||(this.gameObject?this.gameObject.animations=e:this._tempAnimationsArray=e)}get animations(){return this.gameObject.animations||this._tempAnimationsArray||[]}get currentAction(){return this._currentActions[0]}get currentActions(){return this._currentActions}get actions(){return this._actions}set actions(e){this._actions=e}awake(){wu&&console.log("Animation Awake",this.name,this),this._tempAnimationsArray&&(this.animations=this._tempAnimationsArray,this._tempAnimationsArray=void 0),this._tempAnimationClipBeforeGameObjectExisted&&(this.clip=this._tempAnimationClipBeforeGameObjectExisted,this._tempAnimationClipBeforeGameObjectExisted=null),this.playAutomatically&&this.init()}onEnable(){var e;if(this.playAutomatically&&((e=this.animations)==null?void 0:e.length)>0&&this.currentActions.length<=0){const i=Math.floor(Math.random()*this.actions.length);this.play(i)}}start(){this.randomStartTime&&this.currentAction&&(this.currentAction.time=Math.random()*this.currentAction.getClip().duration)}update(){this.mixer&&this.mixer.update(this.context.time.deltaTime)}getAction(e){var i;return(i=this.actions)==null?void 0:i.find(s=>s.getClip().name===e)}get isPlaying(){for(let e=0;e<this.actions.length;e++)if(this.actions[e].isRunning())return!0;return!1}play(e=0,i){if(wu&&console.log("PLAY",e),this.init(),!this.mixer){wu&&console.warn("Missing mixer",this);return}e===void 0&&(e=0);let s=e;if(typeof e=="number"){if(e>=this.animations.length){wu&&console.log("No animation at index",e);return}s=this.animations[e]}else typeof e=="string"&&(s=this.animations.find(o=>o.name===e));if(!s){console.error("Could not find clip",e);return}i||(i={}),i.minMaxOffsetNormalized||(i.minMaxOffsetNormalized=this.minMaxOffsetNormalized),i.minMaxSpeed||(i.minMaxSpeed=this.minMaxSpeed),i.loop===void 0&&(i.loop=this.loop),i.clampWhenFinished===void 0&&(i.clampWhenFinished=this.clampWhenFinished);for(const o of this.actions)if(o.getClip()===s)return this.internalOnPlay(o,i);if(!(s instanceof Pa)){console.warn("Clip is no AnimationClip",s,"on object: "+this.name);return}const r=this.mixer.clipAction(s);return this.actions.push(r),this.internalOnPlay(r,i)}internalOnPlay(e,i){var s=this.currentAction;if(s===e&&s.isRunning()&&s.time<s.getClip().duration){const l=this.tryFindHandle(e);if(l)return l.getPromise()}const r=(i==null?void 0:i.exclusive)??!0;i!=null&&i.fadeDuration?(r&&(s==null||s.fadeOut(i.fadeDuration)),e.fadeIn(i.fadeDuration)):r&&(s==null||s.stop()),e.reset(),e.enabled=!0,e.time=0,e.timeScale=1;const o=e.getClip();i!=null&&i.minMaxOffsetNormalized&&(e.time=Ae.lerp(i.minMaxOffsetNormalized.x,i.minMaxOffsetNormalized.y,Math.random())*o.duration),i!=null&&i.minMaxSpeed&&(e.timeScale=Ae.lerp(i.minMaxSpeed.x,i.minMaxSpeed.y,Math.random())),i!=null&&i.clampWhenFinished&&(e.clampWhenFinished=!0),(i==null?void 0:i.startTime)!==void 0&&(e.time=i.startTime),(i==null?void 0:i.loop)!==void 0?e.loop=i.loop?w2:C_:e.loop=C_,e.play(),wu&&console.log("PLAY",e.getClip().name,e);const a=new u5(e,this.mixer,i,l=>{this._handles.splice(this._handles.indexOf(a),1)});return this._handles.push(a),a.getPromise()}tryFindHandle(e){for(const i of this._handles)if(i.action===e)return i}init(){this._didInit||(this._didInit=!0,this.gameObject&&(this.actions=[],this.mixer=new gx(this.gameObject)))}}Jh([A()],Ps.prototype,"playAutomatically",void 0);Jh([A()],Ps.prototype,"randomStartTime",void 0);Jh([A(nk)],Ps.prototype,"minMaxSpeed",void 0);Jh([A(nk)],Ps.prototype,"minMaxOffsetNormalized",void 0);Jh([A()],Ps.prototype,"loop",void 0);Jh([A()],Ps.prototype,"clampWhenFinished",void 0);Jh([A(Pa)],Ps.prototype,"clips",null);class u5{constructor(t,e,i,s){c(this,"mixer");c(this,"action");c(this,"promise",null);c(this,"resolve",null);c(this,"reject",null);c(this,"_options");c(this,"_resolveCallback",null);c(this,"_rejectCallback",null);c(this,"_loopCallback");c(this,"_finishedCallback");c(this,"_resolvedOrRejectedCallback");this.action=t,this.mixer=e,this._resolvedOrRejectedCallback=s,this._options=i}getPromise(){return this.promise?this.promise:(this.promise=new Promise((t,e)=>{this._resolveCallback=t,this._rejectCallback=e,this.resolve=this.onResolve.bind(this),this.reject=this.onReject.bind(this)}),this._loopCallback=this.onLoop.bind(this),this._finishedCallback=this.onFinished.bind(this),this.mixer.addEventListener("loop",this._loopCallback),this.mixer.addEventListener("finished",this._finishedCallback),this.promise)}_update(){this._options&&this._options.endTime!==void 0&&this.action.time>this._options.endTime&&(this._options.loop===!0?this.action.time=this._options.startTime??0:(this.action.time=this._options.endTime,this.action.timeScale=0,this.onResolve()))}onResolve(){var t,e;this.dispose(),(t=this._resolvedOrRejectedCallback)==null||t.call(this,this),(e=this._resolveCallback)==null||e.call(this,this.action)}onReject(t){var e,i;this.dispose(),(e=this._resolvedOrRejectedCallback)==null||e.call(this,this),(i=this._rejectCallback)==null||i.call(this,t)}onLoop(t){}onFinished(t){t.action===this.action&&this.onResolve()}dispose(){this._loopCallback&&this.mixer.removeEventListener("loop",this._loopCallback),this._finishedCallback&&this.mixer.removeEventListener("finished",this._finishedCallback),this._loopCallback=void 0,this._finishedCallback=void 0}}var Qc=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};class Qo{constructor(){c(this,"time");c(this,"value");c(this,"inTangent");c(this,"inWeight");c(this,"outTangent");c(this,"outWeight");c(this,"weightedMode")}}Qc([A()],Qo.prototype,"time",void 0);Qc([A()],Qo.prototype,"value",void 0);Qc([A()],Qo.prototype,"inTangent",void 0);Qc([A()],Qo.prototype,"inWeight",void 0);Qc([A()],Qo.prototype,"outTangent",void 0);Qc([A()],Qo.prototype,"outWeight",void 0);Qc([A()],Qo.prototype,"weightedMode",void 0);class Tl{constructor(){c(this,"keys")}clone(){var e;const t=new Tl;return t.keys=((e=this.keys)==null?void 0:e.map(i=>{const s=new Qo;return s.time=i.time,s.value=i.value,s.inTangent=i.inTangent,s.inWeight=i.inWeight,s.outTangent=i.outTangent,s.outWeight=i.outWeight,s.weightedMode=i.weightedMode,s}))||[],t}get duration(){return!this.keys||this.keys.length==0?0:this.keys[this.keys.length-1].time}evaluate(t){if(!this.keys||this.keys.length==0)return 0;if(this.keys[0].time>=t)return this.keys[0].value;for(let e=0;e<this.keys.length;e++){const i=this.keys[e];if(i.time<=t)if(e+1<this.keys.length){const r=this.keys[e+1];if(r.time<t)continue;return!isFinite(i.outTangent)||!isFinite(r.inTangent)?i.value:Tl.interpolateValue(t,i,r)}else return i.value}return this.keys[this.keys.length-1].value}static interpolateValue(t,e,i){const s=e.time,r=e.value,o=e.outTangent,a=i.time,l=i.value,h=i.inTangent,u=a-s,d=u*u,f=d*u,p=((o+h)*u-2*(l-r))/f,g=(3*(l-r)-(h+2*o)*u)/d,m=o,v=r,y=t-s,b=y*y,_=b*y;return p*_+g*b+m*y+v}}Qc([A(Qo)],Tl.prototype,"keys",void 0);const EI=Symbol("previous-visibility"),od=class extends Ct{render(t,e,i){if(i instanceof tC)this._unsupported_effectcomposer_warning||(console.warn("RenderTexture.render() does not yet support EffectComposer"),this._unsupported_effectcomposer_warning=!0);else{this.onBeforeRender();const s=i.getRenderTarget(),r=i.xr.enabled;i.xr.enabled=!1,i.setRenderTarget(this),i.clear(!0,!0,!0),i.render(t,e),i.setRenderTarget(s),i.xr.enabled=r,this.onAfterRender()}}onBeforeRender(){od._userSet.clear();const t=fM(this.texture,!0,null,od._userSet);for(const e of t)e instanceof J&&(e[EI]=e.visible,e.visible=!1)}onAfterRender(){for(const t of od._userSet)t instanceof J&&(t.visible=t[EI]);od._userSet.clear()}};let Ih=od;c(Ih,"_userSet",new Set);class Ot extends we{constructor(e,i,s,r){super(e,i,s);c(this,"alpha",1);this.alpha=r}get isRGBAColor(){return!0}set a(e){this.alpha=e}get a(){return this.alpha}clone(){const e=super.clone();return e.alpha=this.alpha,e}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,"alpha"in e&&typeof e.alpha=="number"?this.alpha=e.alpha:typeof e.a=="number"&&(this.alpha=e.a),this}lerp(e,i){const s=e;return s.alpha!=null&&(this.alpha=Ae.lerp(this.alpha,s.alpha,i)),super.lerp(e,i)}lerpColors(e,i,s){const r=e,o=i;return r.alpha!=null&&o.alpha!=null&&(this.alpha=Ae.lerp(r.alpha,o.alpha,s)),super.lerpColors(e,i,s)}multiply(e){const i=e;return i.alpha!=null&&(this.alpha=this.alpha*i.alpha),super.multiply(e)}fromArray(e,i=0){return this.alpha=e[i+3],super.fromArray(e,i)}}const II={type:"change"},Ob={type:"start"},TI={type:"end"},Wm=new Lc,RI=new Oh,d5=Math.cos(70*vt.DEG2RAD);let f5=class extends Ml{constructor(t,e){super(),this.object=t,this.domElement=e,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new C,this.cursor=new C,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:pu.ROTATE,MIDDLE:pu.DOLLY,RIGHT:pu.PAN},this.touches={ONE:gu.ROTATE,TWO:gu.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return a.phi},this.getAzimuthalAngle=function(){return a.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(U){U.addEventListener("keydown",zi),this._domElementKeyEvents=U},this.stopListenToKeyEvents=function(){this._domElementKeyEvents.removeEventListener("keydown",zi),this._domElementKeyEvents=null},this.saveState=function(){i.target0.copy(i.target),i.position0.copy(i.object.position),i.zoom0=i.object.zoom},this.reset=function(){i.target.copy(i.target0),i.object.position.copy(i.position0),i.object.zoom=i.zoom0,i.object.updateProjectionMatrix(),i.dispatchEvent(II),i.update(),r=s.NONE},this.update=function(){const U=new C,K=new ne().setFromUnitVectors(t.up,new C(0,1,0)),Je=K.clone().invert(),Ut=new C,gs=new ne,ir=new C,Us=2*Math.PI;return function(k0=null){const du=i.object.getWorldPosition(t.position);U.copy(du).sub(i.target),U.applyQuaternion(K),a.setFromVector3(U),i.autoRotate&&r===s.NONE&&G(B(k0)),i.enableDamping?(a.theta+=l.theta*i.dampingFactor,a.phi+=l.phi*i.dampingFactor):(a.theta+=l.theta,a.phi+=l.phi);let co=i.minAzimuthAngle,ho=i.maxAzimuthAngle;isFinite(co)&&isFinite(ho)&&(co<-Math.PI?co+=Us:co>Math.PI&&(co-=Us),ho<-Math.PI?ho+=Us:ho>Math.PI&&(ho-=Us),co<=ho?a.theta=Math.max(co,Math.min(ho,a.theta)):a.theta=a.theta>(co+ho)/2?Math.max(co,a.theta):Math.min(ho,a.theta)),a.phi=Math.max(i.minPolarAngle,Math.min(i.maxPolarAngle,a.phi)),a.makeSafe(),i.enableDamping===!0?i.target.addScaledVector(d,i.dampingFactor):i.target.add(d),i.target.sub(i.cursor),i.target.clampLength(i.minTargetRadius,i.maxTargetRadius),i.target.add(i.cursor);let Xc=!1;if(i.zoomToCursor&&L||i.object.isOrthographicCamera)a.radius=he(a.radius);else{i.enableDamping?u=vt.lerp(u,h,i.dampingFactor):u=h,a.radius=he(a.radius*u);const uo=a.radius;a.radius=he(a.radius*h),Xc=uo!=a.radius}if(U.setFromSpherical(a),U.applyQuaternion(Je),du.copy(i.target).add(U),i.object.parent?i.object.parent.worldToLocal(du):i.object.position.copy(du),i.object.lookAt(i.target),i.enableDamping===!0?(l.theta*=1-i.dampingFactor,l.phi*=1-i.dampingFactor,d.multiplyScalar(1-i.dampingFactor)):(l.set(0,0,0),d.set(0,0,0)),i.zoomToCursor&&L){let uo=null;if(i.object.isPerspectiveCamera){const Vo=U.length();uo=he(Vo*h);const fu=Vo-uo;i.object.position.addScaledVector(S,fu),i.object.updateMatrixWorld(),Xc=!!fu}else if(i.object.isOrthographicCamera){const Vo=new C(T.x,T.y,0);Vo.unproject(i.object);const fu=i.object.zoom;i.object.zoom=Math.max(i.minZoom,Math.min(i.maxZoom,i.object.zoom/h)),i.object.updateProjectionMatrix(),Xc=fu!==i.object.zoom;const zl=new C(T.x,T.y,0);zl.unproject(i.object),i.object.position.sub(zl).add(Vo),i.object.updateMatrixWorld(),uo=U.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),i.zoomToCursor=!1;uo!==null&&(this.screenSpacePanning?i.target.set(0,0,-1).transformDirection(i.object.matrix).multiplyScalar(uo).add(i.object.position):(Wm.origin.copy(i.object.position),Wm.direction.set(0,0,-1).transformDirection(i.object.matrix),Math.abs(i.object.up.dot(Wm.direction))<d5?t.lookAt(i.target):(RI.setFromNormalAndCoplanarPoint(i.object.up,i.target),Wm.intersectPlane(RI,i.target))))}else if(i.object.isOrthographicCamera){const uo=i.object.zoom;i.object.zoom=Math.max(i.minZoom,Math.min(i.maxZoom,i.object.zoom/h)),uo!==i.object.zoom&&(i.object.updateProjectionMatrix(),Xc=!0)}return h=1,L=!1,Xc||Ut.distanceToSquared(i.object.position)>o||8*(1-gs.dot(i.object.quaternion))>o||ir.distanceToSquared(i.target)>o?(i.dispatchEvent(II),Ut.copy(i.object.position),gs.copy(i.object.quaternion),ir.copy(i.target),!0):!1}}(),this.dispose=function(){i.domElement.removeEventListener("contextmenu",Yn),i.domElement.removeEventListener("pointerdown",Tr),i.domElement.removeEventListener("pointercancel",mn),i.domElement.removeEventListener("wheel",qn),i.domElement.removeEventListener("pointermove",er),window.removeEventListener("pointerup",mn),i.domElement.getRootNode().removeEventListener("keydown",ps,{capture:!0}),i._domElementKeyEvents!==null&&(i._domElementKeyEvents.removeEventListener("keydown",zi),i._domElementKeyEvents=null)};const i=this,s={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let r=s.NONE;const o=1e-6,a=new HS,l=new HS;let h=1,u=1;const d=new C,f=new ae,p=new ae,g=new ae,m=new ae,v=new ae,y=new ae,b=new ae,_=new ae,x=new ae,S=new C,T=new ae;let L=!1;const I=[],P={};let R=!1;function B(U){return U!==null?2*Math.PI/60*i.autoRotateSpeed*U:2*Math.PI/60/60*i.autoRotateSpeed}function Q(U){const K=Math.abs(U*.01);return Math.pow(.95,i.zoomSpeed*K)}function G(U){l.theta-=U}function V(U){l.phi-=U}const X=function(){const U=new C;return function(Je,Ut){U.setFromMatrixColumn(Ut,0),U.multiplyScalar(-Je),d.add(U)}}(),k=function(){const U=new C;return function(Je,Ut){i.screenSpacePanning===!0?U.setFromMatrixColumn(Ut,1):(U.setFromMatrixColumn(Ut,0),U.crossVectors(i.object.up,U)),U.multiplyScalar(Je),d.add(U)}}(),M=function(){const U=new C,K=new C;return function(Ut,gs){const ir=i.domElement;if(i.object.isPerspectiveCamera){i.object.getWorldPosition(K),U.copy(K).sub(i.target);let Us=U.length();Us*=Math.tan(i.object.fov/2*Math.PI/180),X(2*Ut*Us/ir.clientHeight,i.object.matrixWorld),k(2*gs*Us/ir.clientHeight,i.object.matrixWorld)}else i.object.isOrthographicCamera?(X(Ut*(i.object.right-i.object.left)/i.object.zoom/ir.clientWidth,i.object.matrixWorld),k(gs*(i.object.top-i.object.bottom)/i.object.zoom/ir.clientHeight,i.object.matrixWorld)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),i.enablePan=!1)}}();function H(U){i.object.isPerspectiveCamera||i.object.isOrthographicCamera?h/=U:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),i.enableZoom=!1)}function ee(U){i.object.isPerspectiveCamera||i.object.isOrthographicCamera?h*=U:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),i.enableZoom=!1)}function Y(U,K){if(!i.zoomToCursor)return;L=!0;const Je=i.domElement.getBoundingClientRect(),Ut=U-Je.left,gs=K-Je.top,ir=Je.width,Us=Je.height;T.x=Ut/ir*2-1,T.y=-(gs/Us)*2+1,S.set(T.x,T.y,1).unproject(i.object).sub(i.object.position).normalize()}function he(U){return Math.max(i.minDistance,Math.min(i.maxDistance,U))}function de(U){f.set(U.clientX,U.clientY)}function ve(U){Y(U.clientX,U.clientX),b.set(U.clientX,U.clientY)}function _e(U){m.set(U.clientX,U.clientY)}function Ge(U){p.set(U.clientX,U.clientY),g.subVectors(p,f).multiplyScalar(i.rotateSpeed);const K=i.domElement;G(2*Math.PI*g.x/K.clientHeight),V(2*Math.PI*g.y/K.clientHeight),f.copy(p),i.update()}function Te(U){_.set(U.clientX,U.clientY),x.subVectors(_,b),x.y>0?H(Q(x.y)):x.y<0&&ee(Q(x.y)),b.copy(_),i.update()}function We(U){v.set(U.clientX,U.clientY),y.subVectors(v,m).multiplyScalar(i.panSpeed),M(y.x,y.y),m.copy(v),i.update()}function It(U){Y(U.clientX,U.clientY),U.deltaY<0?ee(Q(U.deltaY)):U.deltaY>0&&H(Q(U.deltaY)),i.update()}function _t(U){let K=!1;switch(U.code){case i.keys.UP:U.ctrlKey||U.metaKey||U.shiftKey?V(2*Math.PI*i.rotateSpeed/i.domElement.clientHeight):M(0,i.keyPanSpeed),K=!0;break;case i.keys.BOTTOM:U.ctrlKey||U.metaKey||U.shiftKey?V(-2*Math.PI*i.rotateSpeed/i.domElement.clientHeight):M(0,-i.keyPanSpeed),K=!0;break;case i.keys.LEFT:U.ctrlKey||U.metaKey||U.shiftKey?G(2*Math.PI*i.rotateSpeed/i.domElement.clientHeight):M(i.keyPanSpeed,0),K=!0;break;case i.keys.RIGHT:U.ctrlKey||U.metaKey||U.shiftKey?G(-2*Math.PI*i.rotateSpeed/i.domElement.clientHeight):M(-i.keyPanSpeed,0),K=!0;break}K&&(U.preventDefault(),i.update())}function $t(U){if(I.length===1)f.set(U.pageX,U.pageY);else{const K=ji(U),Je=.5*(U.pageX+K.x),Ut=.5*(U.pageY+K.y);f.set(Je,Ut)}}function yi(U){if(I.length===1)m.set(U.pageX,U.pageY);else{const K=ji(U),Je=.5*(U.pageX+K.x),Ut=.5*(U.pageY+K.y);m.set(Je,Ut)}}function ds(U){const K=ji(U),Je=U.pageX-K.x,Ut=U.pageY-K.y,gs=Math.sqrt(Je*Je+Ut*Ut);b.set(0,gs)}function Sr(U){i.enableZoom&&ds(U),i.enablePan&&yi(U)}function Wn(U){i.enableZoom&&ds(U),i.enableRotate&&$t(U)}function $s(U){if(I.length==1)p.set(U.pageX,U.pageY);else{const Je=ji(U),Ut=.5*(U.pageX+Je.x),gs=.5*(U.pageY+Je.y);p.set(Ut,gs)}g.subVectors(p,f).multiplyScalar(i.rotateSpeed);const K=i.domElement;G(2*Math.PI*g.x/K.clientHeight),V(2*Math.PI*g.y/K.clientHeight),f.copy(p)}function Er(U){if(I.length===1)v.set(U.pageX,U.pageY);else{const K=ji(U),Je=.5*(U.pageX+K.x),Ut=.5*(U.pageY+K.y);v.set(Je,Ut)}y.subVectors(v,m).multiplyScalar(i.panSpeed),M(y.x,y.y),m.copy(v)}function Ir(U){const K=ji(U),Je=U.pageX-K.x,Ut=U.pageY-K.y,gs=Math.sqrt(Je*Je+Ut*Ut);_.set(0,gs),x.set(0,Math.pow(_.y/b.y,i.zoomSpeed)),H(x.y),b.copy(_);const ir=(U.pageX+K.x)*.5,Us=(U.pageY+K.y)*.5;Y(ir,Us)}function ao(U){i.enableZoom&&Ir(U),i.enablePan&&Er(U)}function lo(U){i.enableZoom&&Ir(U),i.enableRotate&&$s(U)}function Tr(U){i.enabled!==!1&&(I.length===0&&(i.domElement.setPointerCapture(U.pointerId),i.domElement.addEventListener("pointermove",er),window.addEventListener("pointerup",mn)),!dt(U)&&(Zi(U),U.pointerType==="touch"?Xn(U):Ls(U)))}function er(U){i.enabled!==!1&&(U.pointerType==="touch"?Fs(U):tr(U))}function mn(U){switch(Ft(U),I.length){case 0:i.domElement.releasePointerCapture(U.pointerId),i.domElement.removeEventListener("pointermove",er),i.domElement.removeEventListener("pointerup",mn),i.dispatchEvent(TI),r=s.NONE;break;case 1:const K=I[0],Je=P[K];Xn({pointerId:K,pageX:Je.x,pageY:Je.y});break}}function Ls(U){let K;switch(U.button){case 0:K=i.mouseButtons.LEFT;break;case 1:K=i.mouseButtons.MIDDLE;break;case 2:K=i.mouseButtons.RIGHT;break;default:K=-1}switch(K){case pu.DOLLY:if(i.enableZoom===!1)return;ve(U),r=s.DOLLY;break;case pu.ROTATE:if(U.ctrlKey||U.metaKey||U.shiftKey){if(i.enablePan===!1)return;_e(U),r=s.PAN}else{if(i.enableRotate===!1)return;de(U),r=s.ROTATE}break;case pu.PAN:if(U.ctrlKey||U.metaKey||U.shiftKey){if(i.enableRotate===!1)return;de(U),r=s.ROTATE}else{if(i.enablePan===!1)return;_e(U),r=s.PAN}break;default:r=s.NONE}r!==s.NONE&&i.dispatchEvent(Ob)}function tr(U){switch(r){case s.ROTATE:if(i.enableRotate===!1)return;Ge(U);break;case s.DOLLY:if(i.enableZoom===!1)return;Te(U);break;case s.PAN:if(i.enablePan===!1)return;We(U);break}}function qn(U){i.enabled===!1||i.enableZoom===!1||r!==s.NONE||(U.preventDefault(),i.dispatchEvent(Ob),It(fs(U)),i.dispatchEvent(TI))}function fs(U){const K=U.deltaMode,Je={clientX:U.clientX,clientY:U.clientY,deltaY:U.deltaY};switch(K){case 1:Je.deltaY*=16;break;case 2:Je.deltaY*=100;break}return U.ctrlKey&&!R&&(Je.deltaY*=10),Je}function ps(U){U.key==="Control"&&(R=!0,i.domElement.getRootNode().addEventListener("keyup",An,{passive:!0,capture:!0}))}function An(U){U.key==="Control"&&(R=!1,i.domElement.getRootNode().removeEventListener("keyup",An,{passive:!0,capture:!0}))}function zi(U){i.enabled===!1||i.enablePan===!1||_t(U)}function Xn(U){switch(qa(U),I.length){case 1:switch(i.touches.ONE){case gu.ROTATE:if(i.enableRotate===!1)return;$t(U),r=s.TOUCH_ROTATE;break;case gu.PAN:if(i.enablePan===!1)return;yi(U),r=s.TOUCH_PAN;break;default:r=s.NONE}break;case 2:switch(i.touches.TWO){case gu.DOLLY_PAN:if(i.enableZoom===!1&&i.enablePan===!1)return;Sr(U),r=s.TOUCH_DOLLY_PAN;break;case gu.DOLLY_ROTATE:if(i.enableZoom===!1&&i.enableRotate===!1)return;Wn(U),r=s.TOUCH_DOLLY_ROTATE;break;default:r=s.NONE}break;default:r=s.NONE}r!==s.NONE&&i.dispatchEvent(Ob)}function Fs(U){switch(qa(U),r){case s.TOUCH_ROTATE:if(i.enableRotate===!1)return;$s(U),i.update();break;case s.TOUCH_PAN:if(i.enablePan===!1)return;Er(U),i.update();break;case s.TOUCH_DOLLY_PAN:if(i.enableZoom===!1&&i.enablePan===!1)return;ao(U),i.update();break;case s.TOUCH_DOLLY_ROTATE:if(i.enableZoom===!1&&i.enableRotate===!1)return;lo(U),i.update();break;default:r=s.NONE}}function Yn(U){i.enabled!==!1&&U.preventDefault()}function Zi(U){I.push(U.pointerId)}function Ft(U){delete P[U.pointerId];for(let K=0;K<I.length;K++)if(I[K]==U.pointerId){I.splice(K,1);return}}function dt(U){for(let K=0;K<I.length;K++)if(I[K]==U.pointerId)return!0;return!1}function qa(U){let K=P[U.pointerId];K===void 0&&(K=new ae,P[U.pointerId]=K),K.set(U.pageX,U.pageY)}function ji(U){const K=U.pointerId===I[0]?I[1]:I[0];return P[K]}i.domElement.addEventListener("contextmenu",Yn),i.domElement.addEventListener("pointerdown",Tr),i.domElement.addEventListener("pointercancel",mn),i.domElement.addEventListener("wheel",qn,{passive:!1}),i.domElement.getRootNode().addEventListener("keydown",ps,{passive:!0,capture:!0}),this.update()}};var wC=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};class Xd extends se{constructor(){super(...arguments);c(this,"constraintActive",!0);c(this,"locked",!1);c(this,"sources",[])}}wC([A()],Xd.prototype,"constraintActive",void 0);wC([A()],Xd.prototype,"locked",void 0);wC([A(re)],Xd.prototype,"sources",void 0);function dX(n){return Uc(n,yt.ContextCreated),()=>Nc(n,yt.ContextCreated)}function fX(n){return Uc(n,yt.ContextClearing),()=>Nc(n,yt.ContextClearing)}function pX(n){return Uc(n,yt.ContextDestroying),()=>Nc(n,yt.ContextDestroying)}function gX(n){return Uc(n,ze.Start),()=>Nc(n,ze.Start)}function p5(n){return Uc(n,ze.Update),()=>Nc(n,ze.Update)}function mX(n){return Uc(n,ze.OnBeforeRender),()=>Nc(n,ze.OnBeforeRender)}function AX(n){return Uc(n,ze.OnAfterRender),()=>Nc(n,ze.OnAfterRender)}class Th{constructor(){c(this,"bb",null);c(this,"bb_pos",0)}__init(t,e){return this.bb_pos=t,this.bb=e,this}x(){return this.bb.readFloat32(this.bb_pos)}y(){return this.bb.readFloat32(this.bb_pos+4)}z(){return this.bb.readFloat32(this.bb_pos+8)}static sizeOf(){return 12}static createVec3(t,e,i,s){return t.prep(4,12),t.writeFloat32(s),t.writeFloat32(i),t.writeFloat32(e),t.offset()}}class sk{constructor(){c(this,"bb",null);c(this,"bb_pos",0)}__init(t,e){return this.bb_pos=t,this.bb=e,this}position(t){return(t||new Th).__init(this.bb_pos,this.bb)}rotation(t){return(t||new Th).__init(this.bb_pos+12,this.bb)}scale(t){return(t||new Th).__init(this.bb_pos+24,this.bb)}static sizeOf(){return 36}static createTransform(t,e,i,s,r,o,a,l,h,u){return t.prep(4,36),t.prep(4,12),t.writeFloat32(u),t.writeFloat32(h),t.writeFloat32(l),t.prep(4,12),t.writeFloat32(a),t.writeFloat32(o),t.writeFloat32(r),t.prep(4,12),t.writeFloat32(s),t.writeFloat32(i),t.writeFloat32(e),t.offset()}}class dl{constructor(){c(this,"bb",null);c(this,"bb_pos",0)}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsSyncedTransformModel(t,e){return(e||new dl).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsSyncedTransformModel(t,e){return t.setPosition(t.position()+cC),(e||new dl).__init(t.readInt32(t.position())+t.position(),t)}guid(t){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.__string(this.bb_pos+e,t):null}fast(){const t=this.bb.__offset(this.bb_pos,6);return t?!!this.bb.readInt8(this.bb_pos+t):!1}transform(t){const e=this.bb.__offset(this.bb_pos,8);return e?(t||new sk).__init(this.bb_pos+e,this.bb):null}dontSave(){const t=this.bb.__offset(this.bb_pos,10);return t?!!this.bb.readInt8(this.bb_pos+t):!1}static startSyncedTransformModel(t){t.startObject(4)}static addGuid(t,e){t.addFieldOffset(0,e,0)}static addFast(t,e){t.addFieldInt8(1,+e,0)}static addTransform(t,e){t.addFieldStruct(2,e,0)}static addDontSave(t,e){t.addFieldInt8(3,+e,0)}static endSyncedTransformModel(t){return t.endObject()}static finishSyncedTransformModelBuffer(t,e){t.finish(e)}static finishSizePrefixedSyncedTransformModelBuffer(t,e){t.finish(e,void 0,!0)}}var rn;(function(n){n[n.Average=0]="Average",n[n.Multiply=1]="Multiply",n[n.Minimum=2]="Minimum",n[n.Maximum=3]="Maximum"})(rn||(rn={}));var Cv;(function(n){n[n.Discrete=0]="Discrete",n[n.Continuous=1]="Continuous"})(Cv||(Cv={}));var Ii;(function(n){n[n.None=0]="None",n[n.FreezePositionX=2]="FreezePositionX",n[n.FreezePositionY=4]="FreezePositionY",n[n.FreezePositionZ=8]="FreezePositionZ",n[n.FreezePosition=14]="FreezePosition",n[n.FreezeRotationX=16]="FreezeRotationX",n[n.FreezeRotationY=32]="FreezeRotationY",n[n.FreezeRotationZ=64]="FreezeRotationZ",n[n.FreezeRotation=112]="FreezeRotation",n[n.FreezeAll=126]="FreezeAll"})(Ii||(Ii={}));var Yu;(function(n){n[n.None=0]="None",n[n.X=2]="X",n[n.Y=4]="Y",n[n.Z=8]="Z",n[n.All=-1]="All"})(Yu||(Yu={}));const as=function(n,t){return function(e,i,s){g5(e,i,s,n,t)}};function g5(n,t,e,i,s){if(!s&&!i&&!n.onValidate)return;if(e!==void 0){console.error("Invalid usage of validate decorator. Only fields can be validated.",n,t,e),Ci("Invalid usage of validate decorator. Only fields can be validated. Property: "+t,Ui.Error);return}let r="";if(typeof t=="string"?r=t:r=t.name,n.__internalAwake){const o=Symbol(r),a=n.__internalAwake;n.__internalAwake=function(){var l;if(!this.onValidate){xe()&&console.warn('Usage of @validate decorate detected but there is no onValidate method in your class: "'+((l=n.constructor)==null?void 0:l.name)+'"');return}if(this[o]===void 0){this[o]=this[r];const h=this[r];if(h instanceof ae||h instanceof C||h instanceof ke||h instanceof ne){const u=this[r];mx(u,()=>{this.onValidate(r)})}Object.defineProperty(this,r,{set:function(u){var d;if(this[lw]===!0)this[o]=u;else{i==null||i.call(this,u);const f=this[o];this[o]=u,(d=this.onValidate)==null||d.call(this,r,f)}},get:function(){return s==null||s.call(this),this[o]}})}a.call(this)}}}const vX=function(n){return function(t,e,i){let s="";typeof e=="string"?s=e:s=e.name;const r=n.prototype,o=Object.getOwnPropertyDescriptor(r,s);if(!(o!=null&&o.value)){console.warn("Can not apply prefix: type does not have method named",e,n);return}const a=o.value,l=t[s];Object.defineProperty(r,s,{value:function(...h){const u=l==null?void 0:l.call(this,...h);if(u instanceof Promise){u.then(d=>{if(d!==!1)return a.call(this,...h)});return}if(u!==!1)return a.call(this,...h)}})}};var yr=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};class m5{constructor(t,e){c(this,"positionChanged",!1);c(this,"rotationChanged",!1);c(this,"position");c(this,"quaternion");c(this,"_positionKeys",["x","y","z"]);c(this,"_quaternionKeys",["_x","_y","_z","_w"]);c(this,"mute",!1);c(this,"context");c(this,"obj");c(this,"_positionWatch");c(this,"_rotationWatch");this.context=e,this.obj=t}get isDirty(){return this.positionChanged||this.rotationChanged}reset(t=!1){if(this.positionChanged=!1,this.rotationChanged=!1,this.mute=!1,t){if(this.position)for(const e of this._positionKeys)delete this.position[e];if(this.quaternion)for(const e of this._quaternionKeys)delete this.quaternion[e]}}syncValues(){for(const t of this._positionKeys)this.position[t]=this.obj.position[t];for(const t of this._quaternionKeys)this.quaternion[t]=this.obj.quaternion[t]}applyValues(){if(this.positionChanged&&this.position)for(const t of this._positionKeys){const e=this.position[t];e!==void 0&&(this.obj.position[t]=e)}if(this.rotationChanged&&this.quaternion)for(const t of this._quaternionKeys){const e=this.quaternion[t];e!==void 0&&(this.obj.quaternion[t]=e)}}start(t,e){this.reset(),t&&(this._positionWatch||(this._positionWatch=new xc(this.obj.position,["x","y","z"])),this._positionWatch.apply(),this.position={},this._positionWatch.subscribeWrite((r,o)=>{var l;if((l=this.context.physics.engine)!=null&&l.isUpdating||this.mute)return;const a=this.position[o];Math.abs(a-r)<1e-5||(this.position[o]=r,this.positionChanged=!0)})),e&&(this._rotationWatch||(this._rotationWatch=new xc(this.obj.quaternion,["_x","_y","_z","_w"])),this._rotationWatch.apply(),this.quaternion={},this._rotationWatch.subscribeWrite((r,o)=>{var l;if((l=this.context.physics.engine)!=null&&l.isUpdating||this.mute)return;const a=this.quaternion[o];Math.abs(a-r)<1e-5||(this.quaternion[o]=r,this.rotationChanged=!0)}));const i=this.obj.matrixWorld.multiplyMatrices.bind(this.obj.matrixWorld),s=new ce;this.obj.matrixWorld.multiplyMatrices=(r,o)=>{var a;return(a=this.context.physics.engine)!=null&&a.isUpdating||this.mute||s.equals(r)||(this.positionChanged=!0,this.rotationChanged=!0,s.copy(r)),i(r,o)}}stop(){var t,e;(t=this._positionWatch)==null||t.revoke(),(e=this._rotationWatch)==null||e.revoke()}}const ey=class extends se{constructor(){super(...arguments);c(this,"autoMass",!0);c(this,"_mass",0);c(this,"useGravity",!0);c(this,"centerOfMass",new C(0,0,0));c(this,"constraints",Ii.None);c(this,"isKinematic",!1);c(this,"drag",0);c(this,"angularDrag",1);c(this,"detectCollisions",!0);c(this,"sleepThreshold",.01);c(this,"collisionDetectionMode",Cv.Discrete);c(this,"_gravityScale",1);c(this,"dominanceGroup",0);c(this,"_propertiesChanged",!1);c(this,"_currentVelocity",new C);c(this,"_smoothedVelocity",new C);c(this,"_smoothedVelocityGetter",new C);c(this,"_lastPosition",new C);c(this,"_watch")}set mass(e){e!==this._mass&&(this._mass=e,this._propertiesChanged=!0,this.__didAwake&&(this.autoMass=!1))}get mass(){var e,i;return this.autoMass?((i=(e=this.context.physics.engine)==null?void 0:e.getBody(this))==null?void 0:i.mass())??-1:this._mass}get lockPositionX(){return(this.constraints&Ii.FreezePositionX)!==0}get lockPositionY(){return(this.constraints&Ii.FreezePositionY)!==0}get lockPositionZ(){return(this.constraints&Ii.FreezePositionZ)!==0}get lockRotationX(){return(this.constraints&Ii.FreezeRotationX)!==0}get lockRotationY(){return(this.constraints&Ii.FreezeRotationY)!==0}get lockRotationZ(){return(this.constraints&Ii.FreezeRotationZ)!==0}set lockPositionX(e){e?this.constraints|=Ii.FreezePositionX:this.constraints&=~Ii.FreezePositionX}set lockPositionY(e){e?this.constraints|=Ii.FreezePositionY:this.constraints&=~Ii.FreezePositionY}set lockPositionZ(e){e?this.constraints|=Ii.FreezePositionZ:this.constraints&=~Ii.FreezePositionZ}set lockRotationX(e){e?this.constraints|=Ii.FreezeRotationX:this.constraints&=~Ii.FreezeRotationX}set lockRotationY(e){e?this.constraints|=Ii.FreezeRotationY:this.constraints&=~Ii.FreezeRotationY}set lockRotationZ(e){e?this.constraints|=Ii.FreezeRotationZ:this.constraints&=~Ii.FreezeRotationZ}set gravityScale(e){this._gravityScale=e}get gravityScale(){return this._gravityScale}awake(){this._watch=void 0,this._propertiesChanged=!1}onEnable(){this._watch||(this._watch=new m5(this.gameObject,this.context)),this._watch.start(!0,!0),this.startCoroutine(this.beforePhysics(),ze.LateUpdate)}onDisable(){var e,i;(e=this._watch)==null||e.stop(),(i=this.context.physics.engine)==null||i.removeBody(this)}onDestroy(){var e;(e=this.context.physics.engine)==null||e.removeBody(this)}onValidate(){this._propertiesChanged=!0}*beforePhysics(){var e,i,s,r;for(;;)this._propertiesChanged&&(this._propertiesChanged=!1,(e=this.context.physics.engine)==null||e.updateProperties(this)),(i=this._watch)!=null&&i.isDirty?(this._watch.mute=!0,this._watch.applyValues(),(s=this.context.physics.engine)==null||s.updateBody(this,this._watch.positionChanged,this._watch.rotationChanged),this._watch.reset()):(r=this._watch)==null||r.syncValues(),this.captureVelocity(),yield}teleport(e,i=!0){var s;(s=this._watch)==null||s.reset(!0),i?this.gameObject.position.set(e.x,e.y,e.z):this.setWorldPosition(e.x,e.y,e.z),this.resetForcesAndTorques(),this.resetVelocities()}resetForces(e=!0){var i;(i=this.context.physics.engine)==null||i.resetForces(this,e)}resetTorques(e=!0){var i;(i=this.context.physics.engine)==null||i.resetTorques(this,e)}resetVelocities(){this.setVelocity(0,0,0),this.setAngularVelocity(0,0,0)}resetForcesAndTorques(){this.resetForces(),this.resetTorques()}wakeUp(){var e;(e=this.context.physics.engine)==null||e.wakeup(this)}get isSleeping(){var e;return(e=this.context.physics.engine)==null?void 0:e.isSleeping(this)}updateProperties(){var e;return this._propertiesChanged=!1,(e=this.context.physics.engine)==null?void 0:e.updateProperties(this)}applyForce(e,i,s=!0){var r;this._propertiesChanged&&this.updateProperties(),(r=this.context.physics.engine)==null||r.addForce(this,e,s)}applyImpulse(e,i=!0){var s;this._propertiesChanged&&this.updateProperties(),(s=this.context.physics.engine)==null||s.applyImpulse(this,e,i)}setForce(e,i,s,r=!0){var o,a,l;(o=this.context.physics.engine)==null||o.resetForces(this,r),typeof e=="number"?(i??(i=0),s??(s=0),(a=this.context.physics.engine)==null||a.addForce(this,{x:e,y:i,z:s},r)):(l=this.context.physics.engine)==null||l.addForce(this,e,r)}getVelocity(){var i;const e=(i=this.context.physics.engine)==null?void 0:i.getLinearVelocity(this);return e?(this._currentVelocity.x=e.x,this._currentVelocity.y=e.y,this._currentVelocity.z=e.z,this._currentVelocity):this._currentVelocity.set(0,0,0)}setVelocity(e,i,s,r=!0){var o,a;if(e instanceof C){const l=e;(o=this.context.physics.engine)==null||o.setLinearVelocity(this,l,r);return}i===void 0||s===void 0||(a=this.context.physics.engine)==null||a.setLinearVelocity(this,{x:e,y:i,z:s},r)}getAngularVelocity(){var i;const e=(i=this.context.physics.engine)==null?void 0:i.getAngularVelocity(this);return e?(this._currentVelocity.x=e.x,this._currentVelocity.y=e.y,this._currentVelocity.z=e.z,this._currentVelocity):this._currentVelocity.set(0,0,0)}setAngularVelocity(e,i,s,r=!0){var o,a;if(e instanceof C){const l=e;(o=this.context.physics.engine)==null||o.setAngularVelocity(this,l,r);return}i===void 0||s===void 0||(a=this.context.physics.engine)==null||a.setAngularVelocity(this,{x:e,y:i,z:s},r)}setTorque(e,i,s){this.setAngularVelocity(e,i,s)}get smoothedVelocity(){return this._smoothedVelocityGetter.copy(this._smoothedVelocity),this._smoothedVelocityGetter.multiplyScalar(1/this.context.time.deltaTime)}setBodyFromGameObject(e=null){}captureVelocity(){const e=qe(this.gameObject);ey.tempPosition.copy(e);const i=e.sub(this._lastPosition);this._lastPosition.copy(ey.tempPosition),this._smoothedVelocity.lerp(i,this.context.time.deltaTime/.1)}};let Pt=ey;c(Pt,"tempPosition",new C);yr([as()],Pt.prototype,"autoMass",void 0);yr([A()],Pt.prototype,"mass",null);yr([as(),A()],Pt.prototype,"useGravity",void 0);yr([A(C)],Pt.prototype,"centerOfMass",void 0);yr([as(),A()],Pt.prototype,"constraints",void 0);yr([as(),A()],Pt.prototype,"isKinematic",void 0);yr([as(),A()],Pt.prototype,"drag",void 0);yr([as(),A()],Pt.prototype,"angularDrag",void 0);yr([as(),A()],Pt.prototype,"detectCollisions",void 0);yr([as(),A()],Pt.prototype,"sleepThreshold",void 0);yr([as(),A()],Pt.prototype,"collisionDetectionMode",void 0);yr([as()],Pt.prototype,"_gravityScale",void 0);yr([as()],Pt.prototype,"dominanceGroup",void 0);const ic=N("debugsync"),bg="STRS";XM(bg,dl.getRootAsSyncedTransformModel);const Ko=new Lg;function rk(n,t,e=!0){Ko.clear();const i=Ko.createString(n);dl.startSyncedTransformModel(Ko),dl.addGuid(Ko,i),dl.addFast(Ko,e);const s=t.worldPosition,r=t.worldEuler,o=t.gameObject.scale;dl.addTransform(Ko,sk.createTransform(Ko,s.x,s.y,s.z,r.x,r.y,r.z,o.x,o.y,o.z));const a=dl.endSyncedTransformModel(Ko);return Ko.finish(a,bg),Ko.asUint8Array()}let Rw=0,Ip=0;p5(n=>{var i;const e=((i=n.connection.currentServerUrl)==null?void 0:i.includes("glitch"))?10:40;Ip=Math.floor(Rw/e),Rw=0,ic&&Ip>0&&console.log("Sync Transform Fast Interval",Ip)});class Qh extends se{constructor(){super(...arguments);c(this,"overridePhysics",!0);c(this,"interpolatePosition",!0);c(this,"interpolateRotation",!0);c(this,"fastMode",!1);c(this,"syncDestroy",!1);c(this,"_model",null);c(this,"_needsUpdate",!0);c(this,"rb",null);c(this,"_wasKinematic",!1);c(this,"_receivedDataBefore",!1);c(this,"_targetPosition");c(this,"_targetRotation");c(this,"_receivedFastUpdate",!1);c(this,"_shouldRequestOwnership",!1);c(this,"joinedRoomCallback",null);c(this,"receivedDataCallback",null);c(this,"tempEuler",new fi);c(this,"receivedUpdate",!1);c(this,"lastWorldPos");c(this,"lastWorldRotation")}requestOwnership(){ic&&console.log("Request ownership"),this._model?this._model.requestOwnership():(this._shouldRequestOwnership=!0,this._needsUpdate=!0)}hasOwnership(){var e;return((e=this._model)==null?void 0:e.hasOwnership)??void 0}isOwned(){var e;return(e=this._model)==null?void 0:e.isOwned}awake(){ic&&console.log("new instance",this.guid,this),this._receivedDataBefore=!1,this._targetPosition=new C,this._targetRotation=new ne,this.lastWorldPos=new C,this.lastWorldRotation=new ne,this.rb=z.getComponentInChildren(this.gameObject,Pt),this.rb&&(this._wasKinematic=this.rb.isKinematic),this.receivedUpdate=!0,this._model=new UD(this.context.connection,this.guid),this.context.connection.isConnected&&this.tryGetLastState(),this.joinedRoomCallback=this.tryGetLastState.bind(this),this.context.connection.beginListen(Ye.JoinedRoom,this.joinedRoomCallback),this.receivedDataCallback=this.onReceivedData.bind(this),this.context.connection.beginListenBinary(bg,this.receivedDataCallback)}onDestroy(){this.syncDestroy&&H6(this.guid,this.context.connection),this._model=null,this.context.connection.stopListen(Ye.JoinedRoom,this.joinedRoomCallback),this.context.connection.stopListenBinary(bg,this.receivedDataCallback)}tryGetLastState(){const e=this.context.connection.tryGetState(this.guid);e&&this.onReceivedData(e)}onReceivedData(e){var i;if(!this.destroyed&&typeof e.guid=="function"&&e.guid()===this.guid){ic&&console.log("new data",this.context.connection.connectionId,this.context.time.frameCount,this.guid,e),this.receivedUpdate=!0,this._receivedFastUpdate=e.fast();const s=e.transform();if(s){Bo.markDirty(this.gameObject,!0);const r=s.position();r&&(this.interpolatePosition&&((i=this._targetPosition)==null||i.set(r.x(),r.y(),r.z())),(!this.interpolatePosition||!this._receivedDataBefore)&&this.setWorldPosition(r.x(),r.y(),r.z()));const o=s.rotation();o&&(this.tempEuler.set(o.x(),o.y(),o.z()),this.interpolateRotation&&this._targetRotation.setFromEuler(this.tempEuler),(!this.interpolateRotation||!this._receivedDataBefore)&&hP(this.gameObject,this.tempEuler))}this._receivedDataBefore=!0}}onEnable(){this.lastWorldPos.copy(this.worldPosition),this.lastWorldRotation.copy(this.worldQuaternion),this._needsUpdate=!0,this._model&&this._model.updateIsOwned()}onDisable(){this._model&&this._model.freeOwnership()}onBeforeRender(){if(!this.activeAndEnabled||!this.context.connection.isConnected)return;if(!this.context.connection.isInRoom||!this._model){ic&&console.log("no model or room",this.name,this.guid,this.context.connection.isInRoom);return}this._shouldRequestOwnership&&(this._shouldRequestOwnership=!1,this._model.requestOwnership());const e=this.worldPosition,i=this.worldQuaternion;if(this._model.isOwned&&!this.receivedUpdate){const o=e.distanceTo(this.lastWorldPos),a=i.angleTo(this.lastWorldRotation),l=this._model.hasOwnership||this.fastMode?1e-4:.001;(o>l||a>l)&&(this._model.hasOwnership?this._needsUpdate=!0:(ic&&console.log(this.guid,"reset because not owned but",this.gameObject.name,this.lastWorldPos),this.worldPosition=this.lastWorldPos,e.copy(this.lastWorldPos),this.worldQuaternion=this.lastWorldRotation,i.copy(this.lastWorldRotation),Bo.markDirty(this.gameObject,!0),this._needsUpdate=!1))}if(this._model&&!this._model.hasOwnership&&this._model.isOwned&&this._receivedDataBefore){const a=this._receivedFastUpdate||this.fastMode?.5:.3;let l=!1;if(this.interpolatePosition&&this._targetPosition){const h=this.worldPosition;h.lerp(this._targetPosition,a),this.worldPosition=h,l=!0}if(this.interpolateRotation&&this._targetRotation){const h=this.worldQuaternion;h.slerp(this._targetRotation,a),this.worldQuaternion=h,l=!0}l&&Bo.markDirty(this.gameObject,!0)}if(this.receivedUpdate=!1,this.lastWorldPos.copy(e),this.lastWorldRotation.copy(i),!this._model||!this._model||this._model.hasOwnership===void 0||!this._model.hasOwnership)return;this.rb&&this.overridePhysics&&this._wasKinematic!==void 0&&(ic&&console.log("reset kinematic",this.rb.name,this._wasKinematic),this.rb.isKinematic=this._wasKinematic);const s=10,r=this.rb||this.fastMode;if(this._needsUpdate&&(this.context.time.frameCount%s===0||r)){if(Rw++,r&&Ip>0&&this.context.time.frameCount%Ip!==0)return;ic&&console.log("send update",this.context.connection.connectionId,this.guid,this.gameObject.name,this.gameObject.guid),this.overridePhysics&&this.rb,this._needsUpdate=!1;const o=rk(this.guid,this,!!r);this.context.connection.sendBinary(o)}}}const A5=N("debugshadowcomponents");jx.prototype.interactable={get(){return this.interactive},set(n){this.interactable=n}};const Yr=Symbol("shadowDomOwner");class Fo extends se{constructor(){super(...arguments);c(this,"_shadowComponent",null);c(this,"_controlsChildLayout",!0);c(this,"_root");c(this,"_parentComponent")}isRoot(){var e;return((e=this.Root)==null?void 0:e.gameObject)===this.gameObject}get canvas(){const e=this.Root;return e!=null&&e.isCanvas?e:null}get Canvas(){return this.canvas}markDirty(){pr.markUIDirty(this.context)}get shadowComponent(){return this._shadowComponent}set shadowComponent(e){this._shadowComponent=e}get controlsChildLayout(){return this._controlsChildLayout}set controlsChildLayout(e){this._controlsChildLayout=e,this.shadowComponent&&(this.shadowComponent.autoLayout=e)}get Root(){return this._root===void 0&&(this._root=z.getComponentInParent(this.gameObject,Ny)),this._root}__internalNewInstanceCreated(e){return super.__internalNewInstanceCreated(e),this.shadowComponent=null,this._root=void 0,this._parentComponent=void 0,this}onEnable(){super.onEnable()}addShadowComponent(e,i){var o;if(!e)return;this.removeShadowComponent();const s=this.isRoot()?this.gameObject:this.gameObject.parent;if(this._parentComponent=z.getComponentInParent(s,Fo),!this._parentComponent){console.warn(`Component "${this.name}" doesn't have a UI parent anywhere. Do you have an UI element outside a Canvas? UI components must be a child of a Canvas component`,this);return}e.name=this.name+" ("+(this.constructor.name??"UI")+")",e.autoLayout=this._parentComponent.controlsChildLayout,e[Yr]=this,this.setShadowComponentOwner(e);let r=!1;if(((o=this.Root)==null?void 0:o.gameObject)===this.gameObject)this.gameObject.add(e);else{const a=this._parentComponent.shadowComponent;a&&(a==null||a.add(e),r=!0)}this.shadowComponent=e,i&&i.shadowComponent&&this.shadowComponent&&i.shadowComponent.add(this.shadowComponent),Og&&e.add(new Do(.5)),this.onAfterAddedToScene(),r&&sP(),A5&&console.warn("Added shadow component",this.shadowComponent)}setShadowComponentOwner(e){if(e&&(e[Yr]===void 0||e[Yr]===this)&&(e[Yr]=this,e.children))for(const i of e.children)this.setShadowComponentOwner(i)}traverseOwnedShadowComponents(e,i,s){if(e&&e[Yr]===i){s(e);for(const r of e.children)this.traverseOwnedShadowComponents(r,i,s)}}removeShadowComponent(){this.shadowComponent&&this.shadowComponent.removeFromParent()}onAfterAddedToScene(){}setInteractable(e){this.shadowComponent&&(this.shadowComponent.interactable=e)}}class Ny extends Fo{awake(){super.awake()}}class zg{constructor(t,e){c(this,"event");c(this,"button");c(this,"buttonName");c(this,"_used",!1);c(this,"_propagationStopped",!1);c(this,"z__pointer_ctured",!1);c(this,"z__pointer_cture_rleased",!1);c(this,"inputSource");c(this,"object");c(this,"point");c(this,"normal");c(this,"face");c(this,"distance");c(this,"instanceId");c(this,"intersection");c(this,"isDown");c(this,"isUp");c(this,"isPressed");c(this,"isClick");c(this,"isDoubleClick");c(this,"input");this.event=e,this.input=t,this.button=e.button}get deviceIndex(){return this.event.deviceIndex}get pointerId(){return this.event.pointerId}get pressure(){return this.event.pressure}get used(){return this._used}use(){this._used||(this._used=!0,this.event.use(),this.pointerId!==void 0&&this.input.setPointerUsed(this.pointerId))}get propagationStopped(){return this._propagationStopped}stopPropagation(){this._propagationStopped=!0,this.event.stopImmediatePropagation()}stopImmediatePropagation(){this._propagationStopped=!0,this.event.stopImmediatePropagation()}setPointerCapture(){this.z__pointer_ctured=!0}releasePointerCapture(){this.z__pointer_cture_rleased=!0}get mode(){return this.event.mode}clone(){const t=new zg(this.input,this.event);return Object.assign(t,this),t}Use(){this.use()}StopPropagation(){this.event.stopImmediatePropagation()}}function BI(n,t){return z.foreachComponent(n,i=>{if(!i.enabled)return;const s=i;if(t)switch(t){case"pointerdown":if(s.onPointerDown)return!0;break;case"pointerup":if(s.onPointerUp||s.onPointerClick)return!0;break;case"pointermove":if(s.onPointerEnter||s.onPointerExit||s.onPointerMove)return!0;break}else if(s.onPointerDown||s.onPointerUp||s.onPointerEnter||s.onPointerExit||s.onPointerClick)return!0},!1)===!0}class _g{constructor(t,e){c(this,"method");c(this,"enabled");this.method=t,this.enabled=e!==void 0?e:!0}invoke(...t){if(this.enabled!==!1){if(!this.method){console.warn("No function. Please check you assigned a method to invoke on export",this);return}this.method(...t)}}}const v5=n=>/^[A-Z]*$/.test(n);class xC extends Event{constructor(){super(...arguments);c(this,"args")}}class dn{constructor(t){c(this,"isEventList",!0);c(this,"target");c(this,"key");c(this,"_isInvoking",!1);c(this,"methods",[]);c(this,"_methodsCopy",[]);this.methods=t??[]}setEventTarget(t,e){if(this.key=t,this.target=e,this.key!==void 0){let i="",s=!1;for(const r of this.key)s&&v5(r)&&(i+="-"),s=!0,i+=r.toLowerCase();this.key=i}}get listenerCount(){var t;return((t=this.methods)==null?void 0:t.length)??0}get isInvoking(){return this._isInvoking}invoke(...t){var e;if(this._isInvoking)return console.warn("Circular event invocation detected. Please check your event listeners for circular references.",this),!1;if(((e=this.methods)==null?void 0:e.length)<=0)return!1;this._isInvoking=!0;try{this._methodsCopy.length=0,this._methodsCopy.push(...this.methods);for(const i of this._methodsCopy)i.invoke(...t);if(typeof this.target=="object"&&typeof this.key=="string"){const i=this.target.dispatchEvent;if(typeof i=="function"){const s=new xC(this.key);s.args=t,i.call(this.target,s)}}}finally{this._isInvoking=!1}return!0}addEventListener(t){return this.methods.push(new _g(t,!0)),t}removeEventListener(t){if(t)for(let e=this.methods.length-1;e>=0;e--)this.methods[e].method===t&&(this.methods[e].enabled=!1,this.methods.splice(e,1))}removeAllEventListeners(){this.methods.length=0}}class y5 extends Na{constructor(){super([we,Ot],"ColorSerializer")}onDeserialize(t){if(t!=null)return t.a!==void 0?new Ot(t.r,t.g,t.b,t.a):t.alpha!==void 0?new Ot(t.r,t.g,t.b,t.alpha):new we(t.r,t.g,t.b)}onSerialize(t){if(t!=null)return t.a!==void 0?{r:t.r,g:t.g,b:t.b,a:t.a}:{r:t.r,g:t.g,b:t.b}}}const yX=new y5;class b5 extends Na{constructor(){super(re,"ObjectSerializer")}onSerialize(t,e){if(e.objectToNode!==void 0&&t.uuid){const i=e.objectToNode[t.uuid];return Fn&&console.log(i,t.name,t.uuid),{node:i}}}onDeserialize(t,e){var i,s,r;if(typeof t=="string"){if(t.endsWith(".glb")||t.endsWith(".gltf")){if(e.serializable instanceof Array&&e.serializable.includes(it))return;xe()&&Yt("Detected wrong usage of @serializable with Object3D or GameObject. Instead you should use AssetReference here! Please see the console for details.");const o=(s=(i=e.target)==null?void 0:i.constructor)==null?void 0:s.name;console.warn(`Wrong usage of @serializable detected in your script "${o}"

It looks like you used @serializable(Object3D) or @serializable(GameObject) for a prefab or scene reference which is exported to a separate glTF file.

To fix this please change your code to:

@serializable(AssetReference)
${e.path}! : AssetReference;
\0`)}return}if(t){if(t.node!==void 0&&e.nodeToObject){const o=e.nodeToObject[t.node];return Fn&&console.log("Deserialized object reference?",t,o,e==null?void 0:e.nodeToObject),o||console.warn("Did not find node: "+t.node,e.nodeToObject,e.object),o}else if(t.guid){if(!e.context){console.error("Missing context");return}let o;const a=(r=e.gltf)==null?void 0:r.scene;return a&&(o=z.findByGuid(t.guid,a)),o||(o=z.findByGuid(t.guid,e.context.scene)),o?Fn&&console.log("Deserialized object reference?",t,o,e==null?void 0:e.nodeToObject):((xe()||Fn)&&console.warn("Could not resolve object reference",e.path,t,e.target,e.context.scene),t.could_not_resolve=!0),o}}}}const _5=new b5;class w5 extends Na{constructor(){super([se,se],"ComponentSerializer")}onSerialize(t,e){if(t!=null&&t.guid)return{guid:t.guid}}onDeserialize(t,e){var i;if(t!=null&&t.guid){if(t.___persistentAsset){Fn&&console.log("Skipping component deserialization because it's a persistent asset",t);return}const s=e.path;Fn&&console.log(t.guid,e.root,e.object,e.target);let r=this.findObjectForGuid(t.guid,e.root);if(r||e.context&&(r=this.findObjectForGuid(t.guid,(i=e.context)==null?void 0:i.scene),r))return r;(xe()||Fn)&&console.warn('Could not resolve component reference: "'+s+'" using guid '+t.guid,e.target),t.could_not_resolve=!0;return}}findObjectForGuid(t,e){if(e.guid===t)return e;const i=z.foreachComponent(e,s=>{if(s.guid===t)return s},!1);if(i!==void 0)return i;for(let s=0;s<e.children.length;s++){const r=e.children[s],o=this.findObjectForGuid(t,r);if(o)return o}}}const Lb=new w5,x5=Symbol("eventListDebugInfo");class C5 extends Na{constructor(){super([dn])}onSerialize(t,e){console.log("TODO: SERIALIZE EVENT")}onDeserialize(t,e){var i,s,r,o;if(typeof t=="function")return new dn([new _g(t,!0)]);if(t&&t.type==="EventList"){Fn&&console.log("DESERIALIZE EVENT",t);const a=new Array;if(t.calls&&Array.isArray(t.calls))for(const u of t.calls){let p=function(y){if(typeof y=="object"){let b=_5.onDeserialize(y,e);if(b||(b=Lb.onDeserialize(y,e)),b)return b}return y};Fn&&console.log(u);let d=Lb.findObjectForGuid(u.target,e.root);!d&&((i=e.context)!=null&&i.scene)&&(d=Lb.findObjectForGuid(u.target,(s=e.context)==null?void 0:s.scene));const f=((r=u.method)==null?void 0:r.length)>0;if(d&&f){const y=()=>{const _=u.method[0].toUpperCase()+u.method.slice(1);if(typeof d[_]=="function"){console.warn(`EventList method:
Could not find method ${u.method} on object ${d.name}. Please rename ${u.method} to ${_}?
`,d[_],`
 in script: `,d),Yt("EventList methods must start with lowercase letter, see console for details");return}else console.warn(`EventList method:
Could not find method ${u.method} on object ${d.name}`,d,typeof d[u.method])};if(typeof d[u.method]!="function"){let _=!1,x=d;for(;x;){const S=Object.getOwnPropertyDescriptor(x,u.method);if(S&&(S.writable===!0||S.set)){_=!0;break}x=Object.getPrototypeOf(x)}!_&&(xe()||Fn)&&y()}}let g=u.argument;g!==void 0?g=p(g):u.arguments!==void 0&&(g=u.arguments.map(p));const m=f?this.createEventMethod(d,u.method,g):void 0,v=new _g(m,u.enabled);if(v.method||(v[x5]=(o=e.object)==null?void 0:o.name),!d||!v.method){const y=e.object?"Current object: "+e.object.name+", "+e.object.guid:null;d?console.warn('EventList method not found: "'+u.method+'" on',d):console.warn("EventList is missing target - will be ignored",u.target,y,t)}else a.push(v)}const l=new dn(a);Fn&&console.log(l);const h=e.target;return h!==void 0&&e.path!==void 0&&l.setEventTarget(e.path,h),l}}createEventMethod(t,e,i){return(...s)=>{const r=t[e];typeof r=="function"?i!==void 0?Array.isArray(i)?r==null||r.call(t,...i):r==null||r.call(t,i):r==null||r.call(t,...s):t[e]=i}}}const bX=new C5;class S5 extends Na{constructor(){super([Ih,Ct])}onSerialize(t,e){}onDeserialize(t,e){if(t instanceof pt&&e.type===Ih){const i=t,s=new Ih(i.image.width,i.image.height,{colorSpace:Di});return s.texture=i,i.isRenderTargetTexture=!0,i.flipY=!0,i.offset.y=1,i.repeat.y=-1,i.needsUpdate=!0,i.mipmaps=[],i instanceof fd&&(i.isCompressedTexture=!1,i.format=RGBAFormat),s}}}new S5;class E5 extends Na{constructor(){super([URL])}onSerialize(t,e){return null}onDeserialize(t,e){if(typeof t=="string"&&t.length>0)return qh(e.gltfId,t)}}new E5;var I5=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};class jg extends se{awake(){pr.createIfNoneExists(this.context)}onEnable(){var t;(t=pr.get(this.context))==null||t.register(this)}onDisable(){var t;(t=pr.get(this.context))==null||t.unregister(this)}}class no extends jg{constructor(){super(...arguments);c(this,"targets",null);c(this,"raycastHits",[]);c(this,"ignoreSkinnedMeshes",!1)}start(){this.targets=[this.gameObject]}performRaycast(e=null){if(!this.targets)return null;e??(e=new Lo),e.targets=this.targets,e.results=this.raycastHits;const i=e.testObject;this.ignoreSkinnedMeshes&&(e.testObject=r=>r instanceof Io?"continue in children":i?i(r):!0);const s=this.context.physics.raycast(e);return e.testObject=i,s}}I5([A()],no.prototype,"ignoreSkinnedMeshes",void 0);class CC extends no{constructor(){super(),this.ignoreSkinnedMeshes=!0}}class Sv extends jg{performRaycast(t){if(!Me.active||!(t!=null&&t.ray))return null;const e=t.ray.origin,i=.01;return this.context.physics.sphereOverlap(e,i)}}class SC{static getObject(t){const e=t[Yr];return e&&(e.isComponent===!0?t=e.gameObject:t=e),t}static isInteractable(t,e){if(e&&(e.canvasGroup=void 0,e.graphic=void 0),t==null||!t.visible||(t=this.getObject(t),!t.visible))return!1;const i=this.tryFindCanvasGroup(t);if((i==null?void 0:i.isCanvasGroup)===!0&&(e&&(e.canvasGroup=i),i.blocksRaycasts===!1||i.interactable===!1))return!1;const s=Fd(t,r=>{if(r.isGraphic===!0)return r},!1);return e&&(s==null?void 0:s.isGraphic)===!0&&(e.graphic=s),!((s==null?void 0:s.raycastTarget)===!1||(s==null?void 0:s.layer)===2)}static tryFindCanvasGroup(t){if(!t)return null;const e=Fd(t,i=>{const s=i;if(s.blocksRaycasts!==void 0&&s.interactable!==void 0)return s},!1);return e!==void 0?e:this.tryFindCanvasGroup(t.parent)}}function EC(n){const t=n[Yr];return t||(n.parent?EC(n.parent):null)}function T5(n){return n.isUI===!0||typeof n[Yr]=="object"}function Ev(n,t){if(!n)return;const e=n.material;if((e==null?void 0:e.isMaterial)===!0){const i=n.parent;i&&i.isText,e.side=t.doubleSided??!0?pi:Oa,e.shadowSide=t.doubleSided?pi:Oa,n.castShadow=t.castShadows?t.castShadows:!1,n.receiveShadow=t.receiveShadows?t.receiveShadows:!1}for(const i of n.children)Ev(i,t)}function Lu(n,t,e){n[t]===void 0&&console.warn("Field",t,"is undefined on",n);const i=Proxy.revocable(n[t],{set(o,a,l,h){const u=o[a],d=Reflect.set(o,a,l,h);return e(l,u),d}}),s=i.revoke,r=n[t];return i.revoke=()=>{n[t]=r,s()},n[t]=i.proxy,i}const PI=Symbol("Scheduled action");function R5(n,t,e=ze.OnBeforeRender){let i=n[PI];i||(i=n[PI]={});const s=t.name;i[e]||(i[e]={});const r=i[e];if(r[s])return;function*a(){t==null||t.call(n),r[s]=null}const l=n.startCoroutine(a(),e);r[s]=l}const el=N("debugeventsystem");var Ud;(function(n){n.BeforeHandleInput="BeforeHandleInput",n.AfterHandleInput="AfterHandleInput"})(Ud||(Ud={}));const aa=class extends se{constructor(){super();c(this,"raycaster",[]);c(this,"_handleInputFn");c(this,"pressedByID",new Map);c(this,"hoveredByID",new Map);c(this,"_sortedHits",[]);c(this,"_testObjectsCache",new Map);c(this,"_currentlyActiveRaycaster",null);c(this,"_currentPointerEventName",null);c(this,"shouldRaycastObject",e=>{var r;let i=null;if(T5(e)&&(i=(r=e[Yr])==null?void 0:r.gameObject),this._testObjectsCache.has(e)||i&&this._testObjectsCache.has(i))return this._testObjectsCache.get(e)===!1?"continue in children":!0;{let o=BI(e,this._currentPointerEventName);if(!o&&i&&(o=BI(i,this._currentPointerEventName)),o){this._testObjectsCache.set(e,!0);for(const a of e.children)this.shouldRaycastObject_AddToYesCache(a);return!0}return this._testObjectsCache.set(e,!1),"continue in children"}});c(this,"_sortingBuffer",[]);c(this,"_noDepthTestingResults",[]);c(this,"out",{});c(this,"_capturedPointer",{});c(this,"pointerEnterSymbol",Symbol("pointerEnter"));c(this,"pointerExitSymbol",Symbol("pointerExit"));c(this,"currentActiveMeshUIComponents",[]);aa.systems.push(this)}static createIfNoneExists(e){this.didSearchEventSystem||(this.didSearchEventSystem=!0,aa.systems.length<=0&&aa.systems.push(...z.findObjectsOfType(aa,e)));for(const s of aa.systems)if(s.context===e)return;const i=new re;z.addNewComponent(i,aa),e.scene.add(i)}static get systems(){const e=Ne.Current;return this._eventSystemMap.has(e)||this._eventSystemMap.set(e,[]),this._eventSystemMap.get(e)}static get(e){const i=this._eventSystemMap.get(e);return i&&i.length>0?i[0]:null}static get instance(){return this.systems[0]}static ensureUpdateMeshUI(e,i,s=!1){uc.update(e,i,s)}static markUIDirty(e){uc.markDirty()}get hasActiveUI(){return this.currentActiveMeshUIComponents.length>0}get isHoveringObjects(){return this.hoveredByID.size>0}onDestroy(){aa.systems.splice(aa.systems.indexOf(this),1)}start(){if(this.raycaster.length<=0&&!z.findObjectOfType(jg,this.context)){const i=z.addNewComponent(this.context.scene,no);this.raycaster.push(i),(xe()||el)&&console.warn("Added an ObjectRaycaster to the scene because no raycaster was found.")}}register(e){var i;e&&this.raycaster&&!this.raycaster.includes(e)&&((i=this.raycaster)==null||i.push(e))}unregister(e){var s,r;const i=(s=this.raycaster)==null?void 0:s.indexOf(e);i!==void 0&&i!==-1&&((r=this.raycaster)==null||r.splice(i,1))}onEnable(){this._handleInputFn??(this._handleInputFn=this.onPointerEvent.bind(this)),this.context.input.addEventListener(at.PointerDown,this._handleInputFn),this.context.input.addEventListener(at.PointerUp,this._handleInputFn),this.context.input.addEventListener(at.PointerMove,this._handleInputFn)}onDisable(){this.context.input.removeEventListener(at.PointerDown,this._handleInputFn),this.context.input.removeEventListener(at.PointerUp,this._handleInputFn),this.context.input.removeEventListener(at.PointerMove,this._handleInputFn)}onBeforeRender(){this.resetMeshUIStates()}onPointerEvent(e){if(e===void 0||e.propagationStopped)return;const i=new zg(this.context.input,e);this._currentPointerEventName=e.type,i.inputSource=this.context.input,i.isClick=e.isClick,i.isDoubleClick=e.isDoubleClick,i.isDown=e.type==at.PointerDown,i.isUp=e.type==at.PointerUp,i.isPressed=this.context.input.getPointerPressed(e.pointerId),el&&(i.isDown?console.log("DOWN",i.pointerId):i.isUp&&console.log("UP",i.pointerId),i.isClick&&console.log("CLICK",i.pointerId));const s=new Lo;e.hasRay?s.ray=e.ray:s.screenPoint=this.context.input.getPointerPositionRC(e.pointerId);const r=this.performRaycast(s);if(r)for(const a of r)a.event=e,e.intersections.push(a);el&&i.isClick&&Ci("EventSystem: "+i.pointerId+" - "+this.context.time.frame+" - Up:"+i.isUp+", Down:"+i.isDown);const o={sender:this,args:i,hasActiveUI:this.currentActiveMeshUIComponents.length>0};this.dispatchEvent(new CustomEvent(Ud.BeforeHandleInput,{detail:o})),this.handleIntersections(r,i),this.dispatchEvent(new CustomEvent(Ud.AfterHandleInput,{detail:o}))}shouldRaycastObject_AddToYesCache(e){this._testObjectsCache.set(e,!0);for(const i of e.children)this.shouldRaycastObject_AddToYesCache(i)}performRaycast(e){if(!this.raycaster)return null;this._testObjectsCache.clear(),this._sortedHits.length=0,e||(e=new Lo),e.testObject=this.shouldRaycastObject;for(const i of this.raycaster){if(!i.activeAndEnabled)continue;this._currentlyActiveRaycaster=i;const s=i.performRaycast(e);this._currentlyActiveRaycaster=null,s&&s.length>0&&this._sortedHits.push(...s)}return this._sortedHits.sort((i,s)=>i.distance-s.distance),this._sortedHits}assignHitInformation(e,i){i?(e.intersection=i,e.point=i.point,e.normal=i.normal,e.face=i.face,e.distance=i.distance,e.instanceId=i.instanceId):(e.intersection=void 0,e.point=void 0,e.normal=void 0,e.face=void 0,e.distance=void 0,e.instanceId=void 0)}handleIntersections(e,i){var r;if(e!=null&&e.length){e=this.sortCandidates(e);for(const o of e){if(i.event.immediatePropagationStopped)return!1;if(this.assignHitInformation(i,o),this.handleEventOnObject(o.object,i))return!0}}this.assignHitInformation(i,e==null?void 0:e[0]),this.invokePointerCapture(i);const s=this.hoveredByID.get(i.pointerId);return s&&this.propagatePointerExit(s.obj,s.data,null),this.hoveredByID.delete(i.pointerId),i.isUp&&((r=this.pressedByID.get(i.pointerId))==null||r.handlers.forEach(o=>this.invokeOnPointerUp(i,o)),this.pressedByID.delete(i.pointerId)),!1}sortCandidates(e){this._sortingBuffer.length=0,this._noDepthTestingResults.length=0;for(let i=0;i<e.length;i++){const s=e[i],r=s.object;if(r.material&&r.material.depthTest===!1){this._noDepthTestingResults.push(s);continue}this._sortingBuffer.push(s)}for(const i of this._sortingBuffer)this._noDepthTestingResults.push(i);return this._noDepthTestingResults}handleEventOnObject(e,i){if(!this.testIsVisible(e))return i.isClick&&el&&console.log("not allowed",e),!1;if(i.pointerId===void 0)return el&&console.error("Event without pointer can't be handled",i),!1;i.object=e;const s=e.parent,r=i.isClick??!1;let o=null;if(s&&s.isUI){const d=(i.isPressed||i.isClick)??!1;if(s[Yr]){const f=s[Yr].gameObject;if(f){if(!SC.isInteractable(f,this.out))return!1;o=this.out.canvasGroup??null,this.handleMeshUIIntersection(e,d),e=f}}}r&&el&&console.log(this.context.time.frame,e);const a=this.hoveredByID.get(i.pointerId),l=a==null?void 0:a.obj;l!==e&&l&&this.propagatePointerExit(l,a.data,e);const u=this.hoveredByID.get(i.pointerId);if(u?(u.obj=e,u.data=i):this.hoveredByID.set(i.pointerId,{obj:e,data:i}),i.isDown){const d=this.pressedByID.get(i.pointerId);d?(d.obj=e,d.data=i):this.pressedByID.set(i.pointerId,{obj:e,data:i,handlers:new Set})}return(o===null||o.interactable)&&this.handleMainInteraction(e,i,l??null),!0}propagate(e,i){for(;e;)z.foreachComponent(e,s=>{i(s)},!1),e=e.parent}handleMainInteraction(e,i,s){const r=this.pressedByID.get(i.pointerId),o=s!==e;let a=!0;switch(i.event.pointerType){case"mouse":case"touch":const l=this.context.input.getPointerPositionLastFrame(i.pointerId),h=this.context.input.getPointerPosition(i.pointerId);a=l&&!Ae.approximately(l,h);break}this.propagate(e,l=>{var u;const h=l;h.interactable!==!1&&(!h.activeAndEnabled||!h.enabled||(h.onPointerEnter&&o&&this.handlePointerEnter(h,i),i.isDown&&h.onPointerDown&&(h.onPointerDown(i),r==null||r.handlers.add(h),this.handlePointerCapture(i,h)),h.onPointerMove&&(a&&h.onPointerMove(i),this.handlePointerCapture(i,h)),i.isUp&&(h.onPointerUp&&(this.invokeOnPointerUp(i,h),r==null||r.handlers.delete(h)),h.onPointerExit&&((u=i.event)==null?void 0:u.pointerType)===yc.Touch&&(this.handlePointerExit(h,i),this.hoveredByID.delete(i.pointerId))),i.isClick&&h.onPointerClick&&h.onPointerClick(i)))}),i.isUp&&(r==null||r.handlers.forEach(l=>{this.invokeOnPointerUp(i,l)}),this.pressedByID.delete(i.pointerId))}propagatePointerExit(e,i,s){this.propagate(e,r=>{if(!r.gameObject||r.destroyed)return;const o=r;if(o.onPointerExit){if(s&&this.isChild(s,r.gameObject))return;this.handlePointerExit(o,i)}})}invokeOnPointerUp(e,i){var s;(s=i.onPointerUp)==null||s.call(i,e),this.releasePointerCapture(e,i)}handlePointerEnter(e,i){e.onPointerEnter&&this.updatePointerState(e,i.pointerId,this.pointerEnterSymbol,!0)&&e.onPointerEnter(i),this.updatePointerState(e,i.pointerId,this.pointerExitSymbol,!1)}handlePointerExit(e,i){e.onPointerExit&&this.updatePointerState(e,i.pointerId,this.pointerExitSymbol,!0)&&e.onPointerExit(i),this.updatePointerState(e,i.pointerId,this.pointerEnterSymbol,!1)}updatePointerState(e,i,s,r){let o=e[s];if(r)return o&&o.includes(i)?!1:(o=o||[],o.push(i),e[s]=o,!0);{if(!o||!o.includes(i))return!1;const a=o.indexOf(i);return a!==-1&&o.splice(a,1),!0}}handlePointerCapture(e,i){if(e.z__pointer_ctured){e.z__pointer_ctured=!1;const s=e.pointerId;if(i.onPointerMove){const r=this._capturedPointer[s]||[];r.push(i),this._capturedPointer[s]=r}else xe()&&!i.z__warned_no_pointermove&&(i.z__warned_no_pointermove=!0,console.warn("PointerCapture was requested but the component doesn't implement onPointerMove. It will not receive any pointer events"))}else e.z__pointer_cture_rleased&&(e.z__pointer_cture_rleased=!1,this.releasePointerCapture(e,i))}releasePointerCapture(e,i){const s=e.pointerId;if(this._capturedPointer[s]){const r=this._capturedPointer[s].indexOf(i);r!==-1&&(this._capturedPointer[s].splice(r,1),el&&console.log("released pointer capture",s,i,this._capturedPointer))}}invokePointerCapture(e){var i;if(e.event.type===at.PointerMove){const s=e.pointerId,r=this._capturedPointer[s];if(r){el&&console.log("Captured",s,r);for(let o=0;o<r.length;o++){const a=r[o];if(a.destroyed){r.splice(o,1),o--;continue}(i=a.onPointerMove)==null||i.call(a,e)}}}}isChild(e,i){return!e||!i?!1:e===i?!0:e.parent?this.isChild(e.parent,i):!1}handleMeshUiObjectWithoutShadowDom(e,i){return!e||!e.isUI?!0:this.handleMeshUIIntersection(e,i)}handleMeshUIIntersection(e,i){const s=uc.updateState(e,i);return s&&this.currentActiveMeshUIComponents.push(s),s!==null}resetMeshUIStates(){if(this.context.input.getPointerPressedCount()>0&&uc.resetLastSelected(),!(!this.currentActiveMeshUIComponents||this.currentActiveMeshUIComponents.length<=0)){for(let e=0;e<this.currentActiveMeshUIComponents.length;e++){const i=this.currentActiveMeshUIComponents[e];uc.resetState(i)}this.currentActiveMeshUIComponents.length=0}}testIsVisible(e){return e?z.isActiveSelf(e)?this.testIsVisible(e.parent):!1:!0}};let pr=aa;c(pr,"_eventSystemMap",new Map),c(pr,"didSearchEventSystem",!1);class uc{static markDirty(){this.needsUpdate=!0}static update(t,e,i=!1){if(i){t.update();return}const s=e.time.frameCount;for(const r of this.lastUpdateFrame)if(r.context===e){if(s===r.frame)return;r.frame=s;let o=this.needsUpdate||s<1;r.nextUpdate===e.time.frameCount&&(o=!0),o&&(el&&console.log("Update threemeshui"),this.needsUpdate=!1,t.update());return}this.lastUpdateFrame=[{context:e,frame:s,nextUpdate:s}],t.update()}static updateState(t,e){let i=null;if(t&&(i=this.findBlockInParent(t),i&&i!==this.lastSelected)){if(i.interactable===!1)return null;this.needsUpdate=!0}return i}static resetLastSelected(){const t=this.lastSelected;t&&(this.lastSelected=null,this.resetState(t))}static resetState(t){t&&(this.needsUpdate=!0)}static findBlockInParent(t){return t?t.isBlock?t:this.findBlockInParent(t.parent):null}}c(uc,"lastSelected",null),c(uc,"lastUpdateFrame",[]),c(uc,"needsUpdate",!1);var ui=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};const Fb=N("debugorbit"),qm=N("freecam"),Xm=N("debugcamerafit"),Ym=N("smoothcam"),B5={LEFT:"",UP:"",RIGHT:"",BOTTOM:""};let Ub;var Bw;(function(n){n.CameraTargetReached="target-reached"})(Bw||(Bw={}));class Iv extends CustomEvent{constructor(t,e){super(Bw.CameraTargetReached,{detail:{controls:t,type:e}})}}class Et extends se{constructor(){super(...arguments);c(this,"autoTarget",!0);c(this,"autoFit",!1);c(this,"enableRotate",!0);c(this,"autoRotate",!1);c(this,"autoRotateSpeed",1);c(this,"minAzimuthAngle",1/0);c(this,"maxAzimuthAngle",1/0);c(this,"minPolarAngle",0);c(this,"maxPolarAngle",Math.PI);c(this,"enableKeys",!0);c(this,"enableDamping",!0);c(this,"dampingFactor",.1);c(this,"enableZoom",!0);c(this,"minZoom",0);c(this,"maxZoom",1/0);c(this,"zoomSpeed",1);c(this,"zoomToCursor",!1);c(this,"enablePan",!0);c(this,"lookAtConstraint",null);c(this,"lookAtConstraint01",1);c(this,"allowInterrupt",!0);c(this,"middleClickToFocus",!0);c(this,"doubleClickToFocus",!0);c(this,"clickBackgroundToFitScene",2);c(this,"debugLog",!1);c(this,"targetLerpDuration",1);c(this,"_controls",null);c(this,"_cameraObject",null);c(this,"_lookTargetLerpActive",!1);c(this,"_lookTargetStartPosition",new C);c(this,"_lookTargetEndPosition",new C);c(this,"_lookTargetLerp01",0);c(this,"_lookTargetLerpDuration",0);c(this,"_cameraLerpActive",!1);c(this,"_cameraStartPosition",new C);c(this,"_cameraEndPosition",new C);c(this,"_cameraLerp01",0);c(this,"_cameraLerpDuration",0);c(this,"_inputs",0);c(this,"_enableTime",0);c(this,"_startedListeningToKeyEvents",!1);c(this,"_eventSystem");c(this,"_afterHandleInputFn");c(this,"_camera",null);c(this,"_syncedTransform");c(this,"_didStart",!1);c(this,"_didSetTarget",0);c(this,"targetElement",null);c(this,"_lastTimeClickOnBackground",-1);c(this,"_clickOnBackgroundCount",0);c(this,"_onPointerDown",e=>{if(this.clickBackgroundToFitScene>0&&e.isClick){if(e.hasRay||e.intersections.push(...this.context.physics.raycast()),e.intersections.length<=0){const i=this.context.time.time-this._lastTimeClickOnBackground;this._lastTimeClickOnBackground=this.context.time.time,this.clickBackgroundToFitScene<=1||i<this.clickBackgroundToFitScene*.15?(this._clickOnBackgroundCount+=1,this._clickOnBackgroundCount>=this.clickBackgroundToFitScene-1&&this.fitCamera(this.context.scene.children,{immediate:!1})):this._clickOnBackgroundCount=0}Fb&&console.log(this.clickBackgroundToFitScene,e.intersections.length,this._clickOnBackgroundCount)}});c(this,"onControlsChangeStarted",()=>{this._syncedTransform&&this._syncedTransform.requestOwnership()});c(this,"_shouldDisable",!1);c(this,"_haveAttachedKeyboardEvents",!1)}get isCameraController(){return!0}get controls(){return this._controls}get controllerObject(){return this._cameraObject}onStartInteraction(e){var i;(i=this.controls)==null||i.addEventListener("start",e)}get targetLerpSpeed(){return 5}set targetLerpSpeed(e){this.targetLerpDuration=1/e}awake(){this._didStart=!1,this._didSetTarget=0,this._startedListeningToKeyEvents=!1}start(){this._didStart=!0,this._eventSystem=pr.get(this.context)??void 0,this._eventSystem&&(this._afterHandleInputFn=this.afterHandleInput.bind(this),this._eventSystem.addEventListener(Ud.AfterHandleInput,this._afterHandleInputFn))}onDestroy(){var e,i;(e=this._controls)==null||e.dispose(),(i=this._eventSystem)==null||i.removeEventListener(Ud.AfterHandleInput,this._afterHandleInputFn)}onEnable(){this._enableTime=this.context.time.time;const e=z.getComponent(this.gameObject,Bt);this._camera=e;let i=e==null?void 0:e.cam;if(!i&&this.gameObject instanceof xt&&(i=this.gameObject),i&&dE(i,this,!0),!this._controls&&i instanceof xt){this._cameraObject=i;const s=this.targetElement??this.context.renderer.domElement,r=i==null?void 0:i.quaternion.clone();this._controls=new f5(i,s),i==null||i.quaternion.copy(r),Ub===void 0&&(Ub={...this._controls.keys})}this._controls&&(qm&&(this.enablePan=!0,this.enableZoom=!0,this.middleClickToFocus=!0,No()&&(this.doubleClickToFocus=!0)),this._controls.addEventListener("start",this.onControlsChangeStarted),(i==null?void 0:i.type)==="PerspectiveCamera"?qm||(this._controls.minDistance=this.minZoom,this._controls.maxDistance=this.maxZoom):qm||(this._controls.minZoom=this.minZoom,this._controls.maxZoom=this.maxZoom),this._startedListeningToKeyEvents||(this._startedListeningToKeyEvents=!0,this._controls.listenToKeyEvents(window.document.body))),this._syncedTransform=z.getComponent(this.gameObject,Qh)??void 0,this.context.input.addEventListener("pointerup",this._onPointerDown)}onDisable(){var e;(e=this._camera)!=null&&e.cam&&dE(this._camera.cam,this,!1),this._controls&&(this._controls.enabled=!1,this._controls.autoRotate=!1,this._controls.removeEventListener("start",this.onControlsChangeStarted)),this.context.input.removeEventListener("pointerup",this._onPointerDown)}afterHandleInput(e){e.detail.args.pointerId===0&&(e.detail.args.isDown?this._controls&&this._eventSystem&&(this._shouldDisable=this._eventSystem.hasActiveUI):(!e.detail.args.isPressed||e.detail.args.isUp)&&(this._shouldDisable=!1))}onBeforeRender(){var i,s;if(!this._controls)return;if(this._cameraObject!==this.context.mainCamera){this._controls.enabled=!1;return}this._controls.enabled=!0,this.__handleSetTargetWhenBecomingActiveTheFirstTime(),(this.context.input.getPointerDown(1)||this.context.input.getPointerDown(2)||this.context.input.mouseWheelChanged||this.context.input.getPointerPressed(0)&&((i=this.context.input.getPointerPositionDelta(0))!=null&&i.length())||0>.1)&&(this._inputs+=1),this._inputs>0&&this.allowInterrupt&&(this.enableRotate&&(this.autoRotate=!1),this._cameraLerpActive=!1,this._lookTargetLerpActive=!1),this._inputs=0;let e=this.middleClickToFocus&&this.context.input.getPointerClicked(1);if(e||(e=this.doubleClickToFocus&&this.context.input.getPointerDoubleClicked(0)&&this.context.time.time-this._enableTime>.3),e&&this.setTargetFromRaycast(),this._lookTargetLerpActive||this._cameraLerpActive){if(this._cameraLerpActive&&this._cameraObject)if(this._cameraLerp01+=this.context.time.deltaTime/this._cameraLerpDuration,this._cameraLerp01>=1)this._cameraObject.position.copy(this._cameraEndPosition),this._cameraLerpActive=!1,this.dispatchEvent(new Iv(this,"camera"));else{const r=Ae.easeInOutCubic(this._cameraLerp01);this._cameraObject.position.lerpVectors(this._cameraStartPosition,this._cameraEndPosition,r)}if(this._lookTargetLerpActive)if(this._lookTargetLerp01+=this.context.time.deltaTime/this._lookTargetLerpDuration,this._lookTargetLerp01>=1)this._controls.target.copy(this._lookTargetEndPosition),this._lookTargetLerpActive=!1,this.dispatchEvent(new Iv(this,"lookat"));else{const r=Ae.easeInOutCubic(this._lookTargetLerp01);this._controls.target.lerpVectors(this._lookTargetStartPosition,this._lookTargetEndPosition,r)}}if(this._controls){if(this.debugLog&&(this._controls.domElement=this.context.renderer.domElement),this._controls.enabled=!this._shouldDisable&&this._camera===this.context.mainCameraComponent&&!this.context.isInXR,this._controls.keys=this.enableKeys?Ub:B5,this._controls.autoRotate=this.autoRotate,this._controls.autoRotateSpeed=this.autoRotateSpeed,this._controls.enableZoom=this.enableZoom,this._controls.zoomSpeed=this.zoomSpeed,this._controls.zoomToCursor=this.zoomToCursor,this._controls.enableDamping=this.enableDamping,this._controls.dampingFactor=this.dampingFactor,this._controls.enablePan=this.enablePan,this._controls.enableRotate=this.enableRotate,this._controls.minAzimuthAngle=this.minAzimuthAngle,this._controls.maxAzimuthAngle=this.maxAzimuthAngle,this._controls.minPolarAngle=this.minPolarAngle,this._controls.maxPolarAngle=this.maxPolarAngle,typeof Ym=="number"||Ym===!0){this._controls.enableDamping=!0;const r=typeof Ym=="number"?Ym:.99;this._controls.dampingFactor=Math.max(.001,1-Math.min(1,r))}this.allowInterrupt||(this._lookTargetLerpActive&&(this._controls.enablePan=!1),this._cameraLerpActive&&(this._controls.enableRotate=!1,this._controls.autoRotate=!1),(this._lookTargetLerpActive||this._cameraLerpActive)&&(this._controls.enableZoom=!1)),this.context.isInXR||(!qm&&((s=this.lookAtConstraint)!=null&&s.locked)&&this.setLookTargetFromConstraint(0,this.lookAtConstraint01),this._controls.update(),Fb&&De.DrawWireSphere(this._controls.target,.1,65280))}}__handleSetTargetWhenBecomingActiveTheFirstTime(){if(this._didSetTarget++==1&&this.autoTarget){const e=z.getComponent(this.gameObject,Bt);if(e&&!this.setLookTargetFromConstraint()){this.debugLog&&console.log("NO TARGET");const s=qe(e.cam).length(),r=new C(0,0,-s).applyMatrix4(e.cam.matrixWorld);this.setLookTargetPosition(r,!0)}if(!this.autoFit&&!this.setLookTargetFromConstraint()){const i=new Lo;i.screenPoint=new ae(0,0),i.lineThreshold=.1;const s=this.context.physics.raycast(i);s.length>0&&this.setLookTargetPosition(s[0].point,!0),Xm&&console.log("OrbitControls hits",...s)}this.autoFit&&this.fitCamera(this.scene.children,{centerCamera:"y",immediate:!0})}}setCameraAndLookTarget(e){if(!e||!(e instanceof re))return;const i=qe(e),s=lP(e);this.setTargetFromRaycast(new Lc(i,s)),this.setCameraTargetPosition(i)}setCameraTargetPosition(e,i=!1){var s,r;e&&(e instanceof re&&(e=qe(e)),this._cameraEndPosition||(this._cameraEndPosition=new C),this._cameraEndPosition.copy(e),i===!0?(this._cameraLerpActive=!1,(s=this.controllerObject)==null||s.position.copy(this._cameraEndPosition)):this._cameraObject&&(this._cameraLerpActive=!0,this._cameraLerp01=0,this._cameraStartPosition.copy((r=this._cameraObject)==null?void 0:r.position),typeof i=="number"?this._cameraLerpDuration=i:this._cameraLerpDuration=this.targetLerpDuration))}get cameraLerpActive(){return this._cameraLerpActive}stopCameraLerp(){this._cameraLerpActive=!1}setLookTargetPosition(e=null,i=!1){this._controls&&e&&(e instanceof re&&(e=qe(e)),this._lookTargetEndPosition.copy(e),Fb&&(console.warn("OrbitControls: setLookTargetPosition",e,i),De.DrawWireSphere(this._lookTargetEndPosition,.2,16711680,2)),i===!0?this._controls.target.copy(this._lookTargetEndPosition):(this._lookTargetLerpActive=!0,this._lookTargetLerp01=0,this._lookTargetStartPosition.copy(this._controls.target),typeof i=="number"?this._lookTargetLerpDuration=i:this._lookTargetLerpDuration=this.targetLerpDuration))}get lookTargetLerpActive(){return this._lookTargetLerpActive}stopLookTargetLerp(){this._lookTargetLerpActive=!1}setLookTargetFromConstraint(e=0,i=1){var r;if(!this._controls)return!1;const s=(r=this.lookAtConstraint)==null?void 0:r.sources;if(s&&s.length>0){const o=s[e];if(o)return o.getWorldPosition(this._lookTargetEndPosition),this.lerpLookTarget(this._lookTargetEndPosition,i),!0}return!1}lerpTarget(e,i){return this.lerpLookTarget(e,i)}lerpLookTarget(e,i){this._controls&&(i>=1?this._controls.target.copy(e):this._controls.target.lerp(e,i))}setTargetFromRaycast(e){if(!this.controls)return;const i=e?this.context.physics.raycastFromRay(e):this.context.physics.raycast();for(const s of i)if(s.distance>0&&z.isActiveInHierarchy(s.object)){const r=EC(s.object);if(r){const o=r.canvas;if(o!=null&&o.screenspace)break}this.setLookTargetPosition(s.point);break}}fitCamera(e,i={fitOffset:void 0,immediate:!0}){if(this.context.isInXR)return;const{immediate:s,centerCamera:r}=i;let{fitOffset:o}=i;o==null&&(o=1.1);const a=this._cameraObject,l=this._controls;if(e!=null&&e.length||(e=this.context.scene.children),e.length<=0){console.warn("No objects to fit camera to...");return}if(!a||!l){console.warn("No camera or controls found to fit camera to objects...");return}const h=new C,u=new C,d=dP(e);if(a.updateMatrixWorld(),a.updateProjectionMatrix(),d.getCenter(u),d.applyMatrix4(a.matrixWorldInverse),d.getSize(h),d.setFromCenterAndSize(u,h),Number.isNaN(h.x)||Number.isNaN(h.y)||Number.isNaN(h.z)){console.warn("Camera fit size resultet in NaN",a,d,[...e]);return}if(h.length()<=1e-10){Xm&&console.warn("Camera fit size is zero",d,[...e]);return}const f=a.fov,p=2*Math.atan(Math.tan(f*Math.PI/360/2)*a.aspect)/Math.PI*360,g=h.y/(2*Math.atan(Math.PI*f/360)),m=h.x/(2*Math.atan(Math.PI*p/360)),v=o*Math.max(g,m)+h.z/2;Xm&&console.log("Fit camera to objects",g,m,"distance",v),l.maxDistance=v*10,l.minDistance=v*.01;const y=.05,b=u.clone();b.y-=h.y*y,this.setLookTargetPosition(b,s),this.autoTarget=!1,a.near=v/1e3,a.far=v*100,a.updateMatrixWorld(),a.updateProjectionMatrix();const _=qe(a),x=u.clone();if(x.sub(_),r==="y"&&(x.y=0),x.normalize(),x.multiplyScalar(v),r==="y"&&(x.y+=-y*4*h.y),a.parent){const S=a.parent.worldToLocal(u.clone().sub(x));this.setCameraTargetPosition(S,s)}else console.error(`Can not fit camera ${a.name} because it has no parent`);if(Xm){const S=new TR(d);this.context.scene.add(S),uP(S,vy(a)),setTimeout(()=>{this.context.scene.remove(S)},1e4),this._haveAttachedKeyboardEvents||(this._haveAttachedKeyboardEvents=!0,document.body.addEventListener("keydown",T=>{T.code==="KeyF"&&this.fitCamera(e,{fitOffset:o,immediate:s})}))}l.update()}}ui([A()],Et.prototype,"autoTarget",void 0);ui([A()],Et.prototype,"autoFit",void 0);ui([A()],Et.prototype,"enableRotate",void 0);ui([A()],Et.prototype,"autoRotate",void 0);ui([A()],Et.prototype,"autoRotateSpeed",void 0);ui([A()],Et.prototype,"minAzimuthAngle",void 0);ui([A()],Et.prototype,"maxAzimuthAngle",void 0);ui([A()],Et.prototype,"minPolarAngle",void 0);ui([A()],Et.prototype,"maxPolarAngle",void 0);ui([A()],Et.prototype,"enableKeys",void 0);ui([A()],Et.prototype,"enableDamping",void 0);ui([A()],Et.prototype,"dampingFactor",void 0);ui([A()],Et.prototype,"enableZoom",void 0);ui([A()],Et.prototype,"minZoom",void 0);ui([A()],Et.prototype,"maxZoom",void 0);ui([A()],Et.prototype,"zoomSpeed",void 0);ui([A()],Et.prototype,"enablePan",void 0);ui([A(Xd)],Et.prototype,"lookAtConstraint",void 0);ui([A()],Et.prototype,"lookAtConstraint01",void 0);ui([A()],Et.prototype,"allowInterrupt",void 0);ui([A()],Et.prototype,"middleClickToFocus",void 0);ui([A()],Et.prototype,"doubleClickToFocus",void 0);ui([A()],Et.prototype,"clickBackgroundToFitScene",void 0);ui([A()],Et.prototype,"targetLerpDuration",void 0);var Ks=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r},Gr;(function(n){n[n.Skybox=1]="Skybox",n[n.SolidColor=2]="SolidColor",n[n.Uninitialized=4]="Uninitialized"})(Gr||(Gr={}));const il=N("debugcam"),MI=N("debugscreenpointtoray"),ad=class extends se{constructor(){super(...arguments);c(this,"_nearClipPlane",.1);c(this,"_farClipPlane",1e3);c(this,"orthographic",!1);c(this,"orthographicSize",5);c(this,"ARBackgroundAlpha",0);c(this,"_cullingMask",4294967295);c(this,"_backgroundBlurriness",0);c(this,"_backgroundIntensity",1);c(this,"_environmentIntensity");c(this,"_targetTexture",null);c(this,"_backgroundColor");c(this,"_fov");c(this,"_cam",null);c(this,"_clearFlags",Gr.SolidColor);c(this,"_skybox");c(this,"_frustum");c(this,"_projScreenMatrix",new ce)}get isCamera(){return!0}get aspect(){return this._cam instanceof xt?this._cam.aspect:this.context.domWidth/this.context.domHeight}set aspect(e){this._cam instanceof xt&&this._cam.aspect!==e&&(this._cam.aspect=e,this._cam.updateProjectionMatrix())}get fieldOfView(){return this._cam instanceof xt?this._cam.fov:this._fov}set fieldOfView(e){const i=this.fieldOfView!=e;if(this._fov=e,i&&this._cam&&this._cam instanceof xt){if(this._fov===void 0){console.warn("Can not set undefined fov on PerspectiveCamera");return}this._cam.fov=this._fov,this._cam.updateProjectionMatrix()}}get nearClipPlane(){return this._nearClipPlane}set nearClipPlane(e){const i=this._nearClipPlane!=e;this._nearClipPlane=e,this._cam&&i&&(this._cam.near=e,this._cam.updateProjectionMatrix())}get farClipPlane(){return this._farClipPlane}set farClipPlane(e){const i=this._farClipPlane!=e;this._farClipPlane=e,this._cam&&i&&(this._cam.far=e,this._cam.updateProjectionMatrix())}get clearFlags(){return this._clearFlags}set clearFlags(e){e!==this._clearFlags&&(this._clearFlags=e,this.applyClearFlagsIfIsActiveCamera())}set cullingMask(e){this._cullingMask=e,this._cam&&(this._cam.layers.mask=e)}get cullingMask(){return this._cam?this._cam.layers.mask:this._cullingMask}set cullingLayer(e){this.cullingMask=(1<<e|0)>>>0}set backgroundBlurriness(e){e!==this._backgroundBlurriness&&(e===void 0?this._backgroundBlurriness=void 0:this._backgroundBlurriness=Math.min(Math.max(e,0),1),this.applyClearFlagsIfIsActiveCamera())}get backgroundBlurriness(){return this._backgroundBlurriness}set backgroundIntensity(e){e!==this._backgroundIntensity&&(e===void 0?this._backgroundIntensity=void 0:this._backgroundIntensity=Math.min(Math.max(e,0),10),this.applyClearFlagsIfIsActiveCamera())}get backgroundIntensity(){return this._backgroundIntensity}set environmentIntensity(e){this._environmentIntensity=e}get environmentIntensity(){return this._environmentIntensity}get backgroundColor(){return this._backgroundColor??null}set backgroundColor(e){if(e){if(this._backgroundColor)this._backgroundColor.copy(e);else{if(!e.clone)return;this._backgroundColor=e.clone()}e.alpha===void 0&&(this._backgroundColor.alpha=1),this.applyClearFlagsIfIsActiveCamera()}}set targetTexture(e){this._targetTexture=e}get targetTexture(){return this._targetTexture}get cam(){return this.activeAndEnabled&&this.buildCamera(),this._cam}screenPointToRay(e,i,s){const r=this.cam,o=ad._origin;o.set(e,i,-1),this.context.input.convertScreenspaceToRaycastSpace(o),MI&&console.log("screenPointToRay",e.toFixed(2),i.toFixed(2),"now:",o.x.toFixed(2),o.y.toFixed(2),"isInXR:"+this.context.isInXR),o.z=-1,o.unproject(r);const a=ad._direction.set(o.x,o.y,o.z),l=qe(r);return a.sub(l),a.normalize(),s?(s.set(l,a),s):new Lc(l.clone(),a.clone())}getFrustum(){return this._frustum||(this._frustum=new w_,this.updateFrustum()),this._frustum}updateFrustum(){this._frustum||(this._frustum=new w_),this._frustum.setFromProjectionMatrix(this.getProjectionScreenMatrix(this._projScreenMatrix,!0),this.context.renderer.coordinateSystem)}getProjectionScreenMatrix(e,i){return i&&this._projScreenMatrix.multiplyMatrices(this.cam.projectionMatrix,this.cam.matrixWorldInverse),e===this._projScreenMatrix?e:e.copy(this._projScreenMatrix)}awake(){MI&&window.addEventListener("pointerdown",e=>{const i=e.clientX,s=e.clientY;console.log("touch",i.toFixed(2),s.toFixed(2));const r=this.screenPointToRay(i,s),o="#"+Math.floor(Math.random()*16777215).toString(16);De.DrawRay(r.origin,r.direction,o,10)})}onEnable(){il&&console.log(`Camera enabled: "${this.name}". ClearFlags=${Gr[this._clearFlags]}`,this),this.buildCamera(),(this.tag=="MainCamera"||!this.context.mainCameraComponent)&&(this.context.setCurrentCamera(this),M5(this)),this.applyClearFlagsIfIsActiveCamera({applySkybox:!0})}onDisable(){this.context.removeCamera(this)}onBeforeRender(){if(this._cam&&(this._frustum&&this.updateFrustum(),this._clearFlags===Gr.SolidColor&&this.applyClearFlagsIfIsActiveCamera(),this._targetTexture)){this.context.isManagedExternally&&(this._warnedAboutExternalRenderer||(this._warnedAboutExternalRenderer=!0,console.warn("Rendering with external renderer is not supported yet. This may not work or throw errors. Please remove the the target texture from your camera: "+this.name,this.targetTexture))),this.context.composer;const e=this.context.renderer;if(e){const i=this.context.mainCameraComponent;this.applyClearFlags(),this._targetTexture.render(this.context.scene,this._cam,e),i==null||i.applyClearFlags()}}}buildCamera(){if(this._cam)return;const e=this.gameObject.isCamera;let i=null;if(e?(i=this.gameObject,i==null||i.layers.enableAll(),i instanceof xt&&(this._fov=i.fov)):i=this.gameObject.children[0],i&&i.isCamera)i instanceof xt&&(this._fov&&(i.fov=this._fov),i.near=this._nearClipPlane,i.far=this._farClipPlane,i.updateProjectionMatrix());else if(!this.orthographic)i=new xt(this.fieldOfView,window.innerWidth/window.innerHeight,this._nearClipPlane,this._farClipPlane),this.fieldOfView&&(i.fov=this.fieldOfView),this.gameObject.add(i);else{const s=this.orthographicSize*100;i=new Vh(window.innerWidth/-s,window.innerWidth/s,window.innerHeight/s,window.innerHeight/-s,this._nearClipPlane,this._farClipPlane),this.gameObject.add(i)}this._cam=i,this._cam.layers.mask=this._cullingMask,this.tag=="MainCamera"&&this.context.setCurrentCamera(this)}applyClearFlagsIfIsActiveCamera(e){this.context.mainCameraComponent===this&&this.applyClearFlags(e)}applyClearFlags(e){if(!this._cam){il&&console.log("Camera does not exist (apply clear flags)");return}if(this.fieldOfView=this._fov,il){const i=`Camera "${this.name}" clear flags: ${Gr[this._clearFlags]}`;console.debug(i)}switch(this._clearFlags){case Gr.Skybox:if(ad.backgroundShouldBeTransparent(this.context)&&(!this.ARBackgroundAlpha||this.ARBackgroundAlpha<.001)){this.context.scene.background=null,this.context.renderer.setClearColor(0,0);return}(!this.scene.background||!this._skybox||(e==null?void 0:e.applySkybox)===!0)&&this.applySceneSkybox(),this._backgroundBlurriness!==void 0?this.context.scene.backgroundBlurriness=this._backgroundBlurriness:il&&console.warn(`Camera "${this.name}" has no background blurriness`),this._backgroundIntensity!==void 0?this.context.scene.backgroundIntensity=this._backgroundIntensity:il&&console.warn(`Camera "${this.name}" has no background intensity`);break;case Gr.SolidColor:if(this._backgroundColor){let i=this._backgroundColor.alpha;ad.backgroundShouldBeTransparent(this.context)&&(i=this.ARBackgroundAlpha??0),this.context.scene.background=null,this.context.renderer.setClearColor(this._backgroundColor,i)}else il&&console.warn(`Camera "${this.name}" has no background color`,this);break;case Gr.Uninitialized:this.context.scene.background=null,this.context.renderer.setClearColor(0,0);break}}applySceneSkybox(){this._skybox||(this._skybox=new P5(this)),this._skybox.apply()}static backgroundShouldBeTransparent(e){var o,a,l,h;const i=(o=e.renderer.xr)==null?void 0:o.getSession();if(!i)return!1;if(typeof i._transparent=="boolean")return i._transparent;const s=i.environmentBlendMode;il&&Ci("Environment blend mode: "+s+" on "+navigator.userAgent);let r=s==="additive"||s==="alpha-blend";return e.isInAR&&s==="opaque"&&((a=navigator.userAgent)!=null&&a.includes("OculusBrowser")||(l=navigator.userAgent)!=null&&l.includes("Mozilla")&&((h=navigator.userAgent)!=null&&h.includes("Mobile WebXRViewer/v2")))&&(r=!0),i._transparent=r,r}};let Bt=ad;c(Bt,"_origin",new C),c(Bt,"_direction",new C);Ks([A()],Bt.prototype,"aspect",null);Ks([A()],Bt.prototype,"fieldOfView",null);Ks([A()],Bt.prototype,"nearClipPlane",null);Ks([A()],Bt.prototype,"farClipPlane",null);Ks([A()],Bt.prototype,"clearFlags",null);Ks([A()],Bt.prototype,"orthographic",void 0);Ks([A()],Bt.prototype,"orthographicSize",void 0);Ks([A()],Bt.prototype,"ARBackgroundAlpha",void 0);Ks([A()],Bt.prototype,"cullingMask",null);Ks([A()],Bt.prototype,"backgroundBlurriness",null);Ks([A()],Bt.prototype,"backgroundIntensity",null);Ks([A()],Bt.prototype,"environmentIntensity",null);Ks([A(Ot)],Bt.prototype,"backgroundColor",null);Ks([A(Ih)],Bt.prototype,"targetTexture",null);class P5{constructor(t){c(this,"_camera");c(this,"_skybox");this._camera=t}get context(){var t;return(t=this._camera)==null?void 0:t.context}apply(){this._skybox=this.context.lightmaps.tryGetSkybox(this._camera.sourceId),this._skybox?this.context.scene.background!==this._skybox&&(il&&console.log(`Camera "${this._camera.name}" set skybox`,this._camera,this._skybox),this._skybox.mapping=wc,this.context.scene.background=this._skybox):(this._did_log_failed_to_find_skybox||(this._did_log_failed_to_find_skybox=!0,console.warn(`Camera "${this._camera.name}" failed to load/find skybox texture`,this._camera.sourceId,this.context.lightmaps,"Current background: ",this.context.scene.background)),(il||xe())&&Yt(`Camera "${this._camera.name}" has no skybox texture`))}}function M5(n){N("freecam")&&n.context.mainCameraComponent===n&&z.getOrAddComponent(n.gameObject,Et)}class Rh extends se{constructor(){super(...arguments);c(this,"_listener",null);c(this,"onInteraction",()=>{this.destroyed||this.listener==null||this.addListenerIfItExists()})}get listener(){return this._listener==null&&(this._listener=new x2),this._listener}onEnable(){vl.registerWaitForInteraction(this.onInteraction),this.addListenerIfItExists()}onDisable(){vl.unregisterWaitForInteraction(this.onInteraction),this.removeListenerIfItExists()}addListenerIfItExists(){const e=this._listener;if(!e||e!=null&&e.parent)return;const i=this.context.mainCameraComponent||z.getComponentInParent(this.gameObject,Bt);i!=null&&i.cam?i.cam.add(e):this.gameObject.add(e),e.filter?(e.gain.connect(e.filter),e.filter.connect(e.context.destination)):e.gain.connect(e.context.destination)}removeListenerIfItExists(){const e=this._listener;e&&(e.removeFromParent(),e.filter&&e.filter.disconnect(),e.gain&&e.gain.disconnect())}}class D5 extends Hs{constructor(t,e=1,i=16,s=2){const r=new jt,o=i+s*2,a=new Float32Array((o*3+3)*3);r.setAttribute("position",new Ve(a,3));const l=new Ba({color:65280}),h=new Ba({color:16776960});super(r,[h,l]),this.audio=t,this.range=e,this.divisionsInnerAngle=i,this.divisionsOuterAngle=s,this.type="PositionalAudioHelper",this.update()}update(){const t=this.audio,e=this.range,i=this.divisionsInnerAngle,s=this.divisionsOuterAngle,r=vt.degToRad(t.panner.coneInnerAngle),o=vt.degToRad(t.panner.coneOuterAngle),a=r/2,l=o/2;let h=0,u=0,d,f;const p=this.geometry,g=p.attributes.position;p.clearGroups();function m(v,y,b,_){const x=(y-v)/b;for(g.setXYZ(h,0,0,0),u++,d=v;d<y;d+=x)f=h+u,g.setXYZ(f,Math.sin(d)*e,0,Math.cos(d)*e),g.setXYZ(f+1,Math.sin(Math.min(d+x,y))*e,0,Math.cos(Math.min(d+x,y))*e),g.setXYZ(f+2,0,0,0),u+=3;p.addGroup(h,u,_),h+=u,u=0}m(-l,-a,s,0),m(-a,a,i,1),m(a,l,s,0),g.needsUpdate=!0,r===o&&(this.material[0].visible=!1)}dispose(){this.geometry.dispose(),this.material[0].dispose(),this.material[1].dispose()}}var ja=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};const Jn=N("debugaudio");var Tp;(function(n){n[n.Logarithmic=0]="Logarithmic",n[n.Linear=1]="Linear",n[n.Custom=2]="Custom"})(Tp||(Tp={}));class kt extends se{constructor(){super(...arguments);c(this,"clip","");c(this,"playOnAwake",!1);c(this,"preload",!1);c(this,"_spatialBlend",0);c(this,"_minDistance",1);c(this,"_maxDistance",100);c(this,"_volume",1);c(this,"rollOffMode",0);c(this,"playInBackground",!0);c(this,"_loop",!1);c(this,"sound",null);c(this,"helper",null);c(this,"wasPlaying",!1);c(this,"audioLoader",null);c(this,"shouldPlay",!1);c(this,"_lastClipStartedLoading",null);c(this,"_audioElement",null);c(this,"onVisibilityChanged",()=>{switch(document.visibilityState){case"hidden":(this.playInBackground===!1||No())&&(this.wasPlaying=this.isPlaying,this.isPlaying&&this.pause());break;case"visible":Jn&&console.log("visible",this.enabled,this.playOnAwake,!this.isPlaying,kt.userInteractionRegistered,this.wasPlaying),this.enabled&&this.playOnAwake&&!this.isPlaying&&kt.userInteractionRegistered&&this.wasPlaying&&this.play();break}});c(this,"onApplicationMuteChanged",()=>{var e,i;this.context.application.muted?(e=this.sound)==null||e.setVolume(0):(i=this.sound)==null||i.setVolume(this.volume)});c(this,"createAudio",e=>{Jn&&console.log("AudioBuffer finished loading",e);const i=this.Sound;if(!i){Jn&&console.warn("Failed getting sound?",this.name);return}i.isPlaying&&i.stop(),e&&i.setBuffer(e),i.loop=this._loop,this.context.application.muted?i.setVolume(0):i.setVolume(this.volume),i.autoplay=this.shouldPlay&&kt.userInteractionRegistered,this.applySpatialDistanceSettings(),i.isPlaying&&i.stop(),kt.registerWaitForAllowAudio(this.__onAllowAudioCallback)});c(this,"__onAllowAudioCallback",()=>{this.shouldPlay&&this.play()});c(this,"_lastContextTime",0);c(this,"_hasEnded",!0);c(this,"_needUpdateSpatialDistanceSettings",!1)}static get userInteractionRegistered(){return vl.userInteractionRegistered}static registerWaitForAllowAudio(e){vl.registerWaitForAllowAudio(e)}get loop(){return this.sound&&(this._loop=this.sound.getLoop()),this._loop}set loop(e){this._loop=e,this.sound&&this.sound.setLoop(e)}get spatialBlend(){return this._spatialBlend}set spatialBlend(e){e!==this._spatialBlend&&(this._spatialBlend=e,this._needUpdateSpatialDistanceSettings=!0)}get minDistance(){return this._minDistance}set minDistance(e){this._minDistance!==e&&(this._minDistance=e,this._needUpdateSpatialDistanceSettings=!0)}get maxDistance(){return this._maxDistance}set maxDistance(e){this._maxDistance!==e&&(this._maxDistance=e,this._needUpdateSpatialDistanceSettings=!0)}get volume(){return this._volume}set volume(e){this._volume=e,this.sound&&!this.context.application.muted&&(Jn&&console.log(this.name,"audio set volume",e),this.sound.setVolume(e))}get Sound(){var e;if(!this.sound&&kt.userInteractionRegistered){let i=z.getComponent(this.context.mainCamera,Rh)??z.findObjectOfType(Rh,this.context);!i&&this.context.mainCamera&&(i=z.addNewComponent(this.context.mainCamera,Rh)),i!=null&&i.listener?(this.sound=new C2(i.listener),(e=this.gameObject)==null||e.add(this.sound)):Jn&&console.warn("No audio listener found in scene - can not play audio")}return this.sound}get ShouldPlay(){return this.shouldPlay}get audioContext(){var e;return(e=this.sound)==null?void 0:e.context}awake(){Jn&&console.log(this),this.audioLoader=new S_,this.playOnAwake&&(this.shouldPlay=!0),this.preload&&typeof this.clip=="string"&&this.audioLoader.load(this.clip,this.createAudio,()=>{},console.error)}onEnable(){this.sound&&this.gameObject.add(this.sound),kt.userInteractionRegistered?this.playOnAwake&&this.context.application.isVisible&&this.play():kt.registerWaitForAllowAudio(()=>{this.enabled&&!this.destroyed&&this.shouldPlay&&this.onNewClip(this.clip)}),globalThis.addEventListener("visibilitychange",this.onVisibilityChanged),this.context.application.addEventListener(Ch.MuteChanged,this.onApplicationMuteChanged)}onDisable(){globalThis.removeEventListener("visibilitychange",this.onVisibilityChanged),this.context.application.removeEventListener(Ch.MuteChanged,this.onApplicationMuteChanged),this.pause()}applySpatialDistanceSettings(){const e=this.sound;if(!e)return;this._needUpdateSpatialDistanceSettings=!1;const i=Ae.lerp(10*this._maxDistance/Math.max(1e-4,this.spatialBlend),this._minDistance,this.spatialBlend);switch(Jn&&console.log(this.name,this._minDistance,this._maxDistance,this.spatialBlend,"Ref distance="+i),e.setRefDistance(i),e.setMaxDistance(Math.max(.01,this._maxDistance)),this.rollOffMode){case Tp.Logarithmic:e.setDistanceModel("exponential");break;case Tp.Linear:e.setDistanceModel("linear");break;case Tp.Custom:console.warn("Custom rolloff for AudioSource is not supported: "+this.name);break}this.spatialBlend>0?Jn&&!this.helper&&(this.helper=new D5(e,e.getRefDistance()),e.add(this.helper)):this.helper&&this.helper.parent&&this.helper.removeFromParent()}async onNewClip(e){if(e&&(this.clip=e),typeof e=="string")if(Jn&&console.log(e),e.endsWith(".mp3")||e.endsWith(".wav")){if(this.audioLoader||(this.audioLoader=new S_),this.shouldPlay=!0,this._lastClipStartedLoading===e){Jn&&console.log("Is currently loading:",this._lastClipStartedLoading,this);return}this._lastClipStartedLoading=e,Jn&&console.log("load audio",e);const i=await this.audioLoader.loadAsync(e).catch(console.error);this._lastClipStartedLoading=null,i&&this.createAudio(i)}else console.warn("Unsupported audio clip type",e);else this.shouldPlay=!0,this.createAudio()}play(e=void 0){var s,r,o;!e&&this.clip&&(e=this.clip),e!==void 0&&typeof e!="string"&&!(e instanceof MediaStream)&&(xe()&&console.warn("Called play on AudioSource with unknown argument type:",e+`
Using the assigned clip instead:`,this.clip),e=this.clip);let i=!this.sound||e&&e!==this.clip;if(typeof e=="string"&&!this.audioLoader&&(i=!0),(e instanceof MediaStream||typeof e=="string")&&(this.clip=e),i){this.shouldPlay=!0,this.onNewClip(e);return}if(this.shouldPlay=!0,this._hasEnded=!1,Jn&&console.log("play",(s=this.sound)==null?void 0:s.getVolume(),this.sound),this.sound&&!this.sound.isPlaying){const a=this.context.application.muted;a&&this.sound.setVolume(0),(r=this.gameObject)==null||r.add(this.sound),this.clip instanceof MediaStream?(this.sound.setMediaStreamSource(this.clip),this._audioElement||(this._audioElement=document.createElement("audio"),this._audioElement.style.display="none"),this._audioElement.parentNode||(o=this.context.domElement.shadowRoot)==null||o.append(this._audioElement),this._audioElement.srcObject=this.clip,this._audioElement.autoplay=!1):(this._audioElement&&this._audioElement.remove(),this.sound.play(a?.1:0))}}pause(){var e,i;Jn&&console.log("Pause",this),this._hasEnded=!0,this.shouldPlay=!1,this.sound&&this.sound.isPlaying&&this.sound.source&&(this._lastContextTime=(e=this.sound)==null?void 0:e.context.currentTime,this.sound.pause()),(i=this._audioElement)==null||i.remove()}stop(){var e,i;Jn&&console.log("Pause",this),this._hasEnded=!0,this.shouldPlay=!1,this.sound&&this.sound.source&&(this._lastContextTime=(e=this.sound)==null?void 0:e.context.currentTime,Jn&&console.log(this._lastContextTime),this.sound.stop()),(i=this._audioElement)==null||i.remove()}get isPlaying(){var e;return((e=this.sound)==null?void 0:e.isPlaying)??!1}set isPlaying(e){}get time(){var e,i;return(e=this.sound)!=null&&e.source?((i=this.sound.source)==null?void 0:i.context.currentTime)-this._lastContextTime+this.sound.offset:0}set time(e){if(this.sound){if(e===this.sound.offset)return;const i=this.isPlaying;this.stop(),this.sound.offset=e,i&&this.play()}}update(){this.helper&&(this.isPlaying&&this.helper.update(),this.helper.visible=this.isPlaying),this._needUpdateSpatialDistanceSettings&&this.applySpatialDistanceSettings(),this.sound&&!this.sound.isPlaying&&this.shouldPlay&&!this._hasEnded&&(this._hasEnded=!0,Jn&&console.log("Audio clip ended",this.clip),this.dispatchEvent(new CustomEvent("ended",{detail:this})))}}ja([A(URL)],kt.prototype,"clip",void 0);ja([A()],kt.prototype,"playOnAwake",void 0);ja([A()],kt.prototype,"preload",void 0);ja([A()],kt.prototype,"loop",null);ja([A()],kt.prototype,"spatialBlend",null);ja([A()],kt.prototype,"minDistance",null);ja([A()],kt.prototype,"maxDistance",null);ja([A()],kt.prototype,"volume",null);ja([A()],kt.prototype,"rollOffMode",void 0);ja([A()],kt.prototype,"playInBackground",void 0);var Qy=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};const k5=N("debugsignals");class zy{constructor(){c(this,"guid")}}Qy([A()],zy.prototype,"guid",void 0);class Gg{constructor(){c(this,"signal");c(this,"reaction")}}Qy([A(zy)],Gg.prototype,"signal",void 0);Qy([A(dn)],Gg.prototype,"reaction",void 0);const la=class extends se{constructor(){super(...arguments);c(this,"events")}static invoke(e){if(la.receivers[e]){const i=la.receivers[e];if(!i)return;for(const s of i)s.invoke(e)}}awake(){k5&&console.log("SignalReceiver awake",this)}onEnable(){if(this.events)for(const e of this.events)la.receivers[e.signal.guid]||(la.receivers[e.signal.guid]=[]),la.receivers[e.signal.guid].push(this)}onDisable(){if(this.events){for(const e of this.events)if(la.receivers[e.signal.guid]){const i=la.receivers[e.signal.guid].indexOf(this);i>=0&&la.receivers[e.signal.guid].splice(i,1)}}}invoke(e){if(!this.events||!Array.isArray(this.events))return;const i=typeof e=="object"?e.guid:e;for(const s of this.events)if(s.signal.guid===i)try{if(s.reaction){if(!s.reaction.invoke){console.warn("Missing invoke - possibly a serialization error",s,this);continue}}else{console.warn("Missing reaction for signal",s,this);continue}s.reaction.invoke()}catch(r){console.error(r)}}};let Tc=la;c(Tc,"receivers",{});Qy([A(Gg)],Tc.prototype,"events",void 0);var rr;(function(n){n.Activation="ActivationTrack",n.Animation="AnimationTrack",n.Audio="AudioTrack",n.Control="ControlTrack",n.Marker="MarkerTrack",n.Signal="SignalTrack"})(rr||(rr={}));var na;(function(n){n[n.None=0]="None",n[n.Hold=1]="Hold",n[n.Loop=2]="Loop",n[n.PingPong=3]="PingPong",n[n.Continue=4]="Continue"})(na||(na={}));var Pw;(function(n){n.Signal="SignalEmitter"})(Pw||(Pw={}));const Ea=N("debugtimeline");class jy{constructor(){c(this,"director");c(this,"track")}get muted(){return this.track.muted}set muted(t){var e;t!==this.track.muted&&(this.track.muted=t,(e=this.onMuteChanged)==null||e.call(this))}*forEachClip(t=!1){var e;if((e=this.track)!=null&&e.clips)if(t)for(let i=this.track.clips.length-1;i>=0;i--)yield this.track.clips[i];else for(const i of this.track.clips)yield i}getClipTime(t,e){return e.clipIn+(t-e.start)*e.timeScale}getClipTimeNormalized(t,e){return(t-e.start)/e.duration}evaluateWeight(t,e,i,s=!0){if(e<0||e>=i.length)return 0;const r=i[e];if(s||t>=r.start&&t<=r.end){let o=1;const a=!1;if(r.easeInDuration>0){const l=Math.min((t-r.start)/r.easeInDuration,1);o*=l}if(r.easeOutDuration>0&&!a){const l=Math.min((r.end-t)/r.easeOutDuration,1);o*=l}return o}return 0}}class O5{constructor(t){c(this,"clip");c(this,"rootPositionOffset");c(this,"rootQuaternionOffset");c(this,"rootStartPosition");c(this,"rootEndPosition");c(this,"rootStartQuaternion");c(this,"rootEndQuaternion");const e=t.getClip();this.clip=e;const i=t.getRoot(),s=i.name+".position",r=i.name+".quaternion";Ea&&console.log(e.name,e.tracks,s);for(const o of e.tracks)if(!(o.times.length<=0)){if(o.name.endsWith(s))this.rootStartPosition=new C().fromArray(o.values,0),this.rootEndPosition=new C().fromArray(o.values,o.values.length-3),this.rootPositionOffset=this.rootEndPosition.clone().sub(this.rootStartPosition),Ea&&console.log(this.rootPositionOffset);else if(o.name.endsWith(r)&&(this.rootStartQuaternion=new ne().fromArray(o.values,0),this.rootEndQuaternion=new ne().fromArray(o.values,o.values.length-4),this.rootQuaternionOffset=this.rootEndQuaternion.clone().multiply(this.rootStartQuaternion),Ea)){const a=new fi().setFromQuaternion(this.rootQuaternionOffset);console.log("ROT",a)}}}get hasOffsets(){return this.rootPositionOffset!==void 0||this.rootQuaternionOffset!==void 0}}class IC extends jy{constructor(){super(...arguments);c(this,"models",[]);c(this,"trackOffset");c(this,"target");c(this,"mixer");c(this,"clips",[]);c(this,"actions",[]);c(this,"_actionOffsets",[]);c(this,"_didBind",!1);c(this,"_animator",null);c(this,"_useclipOffsets",!0);c(this,"_totalOffsetPosition",new C);c(this,"_totalOffsetRotation",new ne);c(this,"_totalOffsetPosition2",new C);c(this,"_totalOffsetRotation2",new ne);c(this,"_summedPos",new C);c(this,"_tempPos",new C);c(this,"_summedRot",new ne);c(this,"_tempRot",new ne);c(this,"_clipRotQuat",new ne)}onDisable(){var e;(e=this.mixer)==null||e.stopAllAction()}onStateChanged(){this._animator&&kI(this._animator.gameObject,this,this.director.isPlaying)}createHooks(e,i){var u,d;if(((u=i.tracks)==null?void 0:u.length)<=0){console.warn("No tracks in AnimationClip",i);return}const s=i.tracks[0].name.split("."),r=s[s.length-2],o=r+".position",a=r+".quaternion";let l=!1,h=!1;for(const f of i.tracks)f.name.endsWith(o)?(l=!0,this.createPositionInterpolant(i,e,f)):f.name.endsWith(a)&&(h=!0,this.createRotationInterpolant(i,e,f));if(!l||!h){const f=(d=this.mixer)==null?void 0:d.getRoot(),p=i.tracks[0],g=p.name.lastIndexOf("."),m=p.name.substring(0,g),v=m.substring(m.lastIndexOf(".")+1),y=f.getObjectByName(v);if(y)if(l){if(!h){const b=i.tracks[0].name.substring(0,g)+".quaternion";Ea&&console.warn("Create quaternion track",v,y);const _=y.quaternion,x=new ig(b,[0,i.duration],[_.x,_.y,_.z,_.w,_.x,_.y,_.z,_.w]);i.tracks.push(x),this.createRotationInterpolant(i,e,x)}}else{const b=m+".position";Ea&&console.warn("Create position track",v,y);const _=y.position,x=new $A(b,[0,i.duration],[_.x,_.y,_.z,_.x,_.y,_.z]);i.tracks.push(x),this.createPositionInterpolant(i,e,x)}}}bind(){if(!this._didBind){this._didBind=!0,Ea&&console.log(this.models),this.mixer?this.target=this.mixer.getRoot():console.warn("No mixer was assigned to animation track");for(const e of this.actions){const i=new O5(e);this._actionOffsets.push(i)}this.target&&(this._animator=z.getComponent(this.target,zn)??null,this._animator&&kI(this._animator.gameObject,this,!0));for(const e of this.models){const i=e.asset,s=i.position,r=i.rotation;s&&s.x!==void 0&&(s.isVector3||(i.position=new C(s.x,s.y,s.z)),r.isQuaternion||(i.rotation=new ne(r.x,r.y,r.z,r.w)))}this.ensureTrackOffsets()}}ensureTrackOffsets(){if(this.trackOffset){const e=this.trackOffset.position;e&&(e.isVector3||(this.trackOffset.position=new C(e.x,e.y,e.z)));const i=this.trackOffset.rotation;i&&(i.isQuaternion||(this.trackOffset.rotation=new ne(i.x,i.y,i.z,i.w)))}}evaluate(e){var l,h,u,d,f,p,g;if(this.track.muted||!this.mixer)return;this.bind(),this._totalOffsetPosition.set(0,0,0),this._totalOffsetRotation.set(0,0,0,1),this._totalOffsetPosition2.set(0,0,0),this._totalOffsetRotation2.set(0,0,0,1);let i=0,s=0,r=!1,o=!1,a=0;for(let m=0;m<this.clips.length;m++){const v=this.models[m],y=this.actions[m],b=v.asset;y.weight=0;const _=e>=v.start&&e<=v.end,x=v.preExtrapolationMode,S=v.postExtrapolationMode,T=m<this.clips.length-1?this.models[m+1]:null;let L=_,I=!1;if(!L&&!r&&v.end<e&&S!==na.None?(!T||T.start>e)&&(L=!0,r=!0):m==0&&!L&&!o&&v.start>e&&x!==na.None&&(!T||T.start<e)&&(L=!0,I=!0,o=!0),L){let P=1;P*=this.evaluateWeight(e,m,this.models,L),P*=this.director.weight;let R=_;if(I)switch(x){case na.Hold:break;case na.Loop:e+=v.start,R=!0;break;default:e+=v.start,R=!0;break}let B=this.getClipTime(e,v),Q=0;const G=b.duration;if(I&&x===na.Hold&&(B=0),R){if(b.loop)for(Q+=Math.floor(B/(G+1e-6));B>G;)B-=G}else if(!_&&r)switch(S){case na.Hold:B=this.getClipTime(v.end,v);break;case na.Loop:B%=G;break;case na.PingPong:const k=Math.floor(B/G)%2!==0;B%=G,k&&(B=G-B);break}v.reversed===!0?y.time=y.getClip().duration-B:y.time=B,y.timeScale=0;const V=Math.max(0,P);if(y.weight=V,a+=V,y.clampWhenFinished=!1,y.isRunning()||y.play(),this._useclipOffsets){const X=i==0?this._totalOffsetPosition:this._totalOffsetPosition2,k=i==0?this._totalOffsetRotation:this._totalOffsetRotation2;i<1&&(s=1-P),i+=1;const M=this._summedPos.set(0,0,0),H=this._tempPos.set(0,0,0),ee=this._summedRot.identity(),Y=this._tempRot.identity(),he=b.rotation;he&&(this._clipRotQuat.identity(),this._clipRotQuat.slerp(he,P));const de=this._actionOffsets[m];if(de.hasOffsets)for(let ve=0;ve<Q;ve++)de.rootPositionOffset?H.copy(de.rootPositionOffset):H.set(0,0,0),H.applyQuaternion(ee),this._clipRotQuat&&H.applyQuaternion(this._clipRotQuat),de.rootQuaternionOffset&&(Y.copy(de.rootQuaternionOffset),ee.multiply(Y)),M.add(H);this._clipRotQuat&&k.multiply(this._clipRotQuat),k.multiply(ee),b.position&&M.add(b.position),X.add(M)}}}if(this._useclipOffsets&&(this._totalOffsetPosition.lerp(this._totalOffsetPosition2,s),this._totalOffsetRotation.slerp(this._totalOffsetRotation2,s)),this.__mixerError===void 0&&(Ea||xe())&&((h=(l=this._animator)==null?void 0:l.runtimeAnimatorController)!=null&&h.mixer)&&this.mixer!==((d=(u=this._animator)==null?void 0:u.runtimeAnimatorController)==null?void 0:d.mixer)&&(this.__mixerError=!0,console.error("AnimationTrack mixer is not shared with the animator controller - this might result in the timeline to not animate properly. Please report a bug to the Needle Engine team!",this)),(f=this._animator)!=null&&f.runtimeAnimatorController){const m=Math.max(0,1-a);(g=(p=this._animator)==null?void 0:p.runtimeAnimatorController)==null||g.update(m)}else this.mixer.update(e)}createRotationInterpolant(e,i,s){var l;const r=s.createInterpolant.bind(s),o=new ne;this.ensureTrackOffsets();const a=(l=this.trackOffset)==null?void 0:l.rotation;s.createInterpolant=()=>{const h=r(),u=h.evaluate.bind(h);return h.evaluate=d=>{var p;const f=u(d);if(o.set(f[0],f[1],f[2],f[3]),o.premultiply(this._totalOffsetRotation),a&&o.premultiply(a),this.director.animationCallbackReceivers)for(const g of this.director.animationCallbackReceivers)(p=g==null?void 0:g.onTimelineRotation)==null||p.call(g,this.director,this.target,d,o);return f[0]=o.x,f[1]=o.y,f[2]=o.z,f[3]=o.w,f},h}}createPositionInterpolant(e,i,s){var u,d;const r=s.createInterpolant.bind(s),o=new C;this.ensureTrackOffsets();const a=(u=this.trackOffset)==null?void 0:u.rotation,l=(d=this.trackOffset)==null?void 0:d.position;let h;s.createInterpolant=()=>{const f=r(),p=f.evaluate.bind(f);return f.evaluate=g=>{var v,y,b;const m=p(g);if(o.set(m[0],m[1],m[2]),i.removeStartOffset&&(h===void 0?(h=null,h=(y=(v=this._actionOffsets.find(_=>_.clip===e))==null?void 0:v.rootStartPosition)==null?void 0:y.clone()):h!=null&&h.isVector3&&o.sub(h)),o.applyQuaternion(this._totalOffsetRotation),o.add(this._totalOffsetPosition),a&&o.applyQuaternion(a),l&&(o.x-=l.x,o.y+=l.y,o.z+=l.z),this.director.animationCallbackReceivers)for(const _ of this.director.animationCallbackReceivers)(b=_==null?void 0:_.onTimelinePosition)==null||b.call(_,this.director,this.target,g,o);return m[0]=o.x,m[1]=o.y,m[2]=o.z,m},f}}}const L5=N("mutetimeline"),ld=class extends jy{constructor(){super(...arguments);c(this,"models",[]);c(this,"listener");c(this,"audio",[]);c(this,"audioContextTimeOffset",[]);c(this,"lastTime",0);c(this,"audioSource");c(this,"_audioLoader",null);c(this,"_playableDirectorResumed",!1)}getAudioFilePath(e){const i=this.director.sourceId;return qh(i,e)}onAllowAudioChanged(e){for(let i=0;i<this.models.length;i++){const s=this.models[i];this.audio[i].setVolume(e?s.asset.volume:0)}}addModel(e){const i=new S2(this.listener);this.audio.push(i);const s=e;s._didTriggerPlay=!1,this.models.push(s)}onDisable(){for(const e of this.audio)e.isPlaying&&e.stop();for(const e of this.models)e._didTriggerPlay=!1}onDestroy(){for(const e of this.audio)e.source&&(e==null||e.disconnect());this.audio.length=0}onMuteChanged(){if(this.muted)for(let e=0;e<this.audio.length;e++){const i=this.audio[e];i!=null&&i.isPlaying&&i.stop()}}stop(){for(let e=0;e<this.audio.length;e++){const i=this.audio[e];i!=null&&i.isPlaying&&i.stop()}for(const e of this.models)e._didTriggerPlay=!1}onPauseChanged(){for(let e=0;e<this.audio.length;e++){const i=this.audio[e];i!=null&&i.isPlaying&&i.stop()}this._playableDirectorResumed=this.director.isPlaying}evaluate(e){if(L5||this.track.muted||this.director.speed<0)return;const i=this.director.context.application.muted,s=this._playableDirectorResumed;this._playableDirectorResumed=!1;const r=i?.1:0;for(let o=0;o<this.models.length;o++){const a=this.models[o],l=this.audio[o],h=a.asset;if((!l||!l.buffer)&&this.isInTimeRange(a,e-1,e+1)&&this.handleAudioLoading(a,l),kt.userInteractionRegistered!==!1&&!(l===null||!l.buffer))if(l.playbackRate=this.director.context.time.timeScale*this.director.speed,l.loop=h.loop,e>=a.start&&e<=a.end&&e<this.director.duration){if(!l.isPlaying||!this.director.isPlaying)(s||!a._didTriggerPlay&&this.lastTime<e)&&(a.duration*a.timeScale>.3?l.offset=a.clipIn+(e-a.start)*a.timeScale:l.offset=0,Ea&&console.log("Timeline Audio ("+this.track.name+") play with offset "+l.offset+" - "+a.asset.clip),l.play(r),a._didTriggerPlay=!0);else{const d=a.clipIn+(e-a.start)*a.timeScale,f=l.context.currentTime-l._startedAt+l.offset;Math.abs(d-f)>.3&&(l.offset=d,l.stop(),l.play(r))}let u=h.volume;if(this.track.volume!==void 0&&(u*=this.track.volume),i&&(u=0),a.easeInDuration>0){const d=Math.min((e-a.start)/a.easeInDuration,1);u*=d}if(a.easeOutDuration>0){const d=Math.min((a.end-e)/a.easeOutDuration,1);u*=d}l.setVolume(u*this.director.weight)}else a._didTriggerPlay=!1,this.director.isPlaying&&l.isPlaying&&l.stop()}this.lastTime=e}loadAudio(e,i=0,s=0){let r=null;const o=e-s,a=e+i;for(const l of this.models)if(this.isInTimeRange(l,o,a)){const h=this.audio[this.models.indexOf(l)],u=this.handleAudioLoading(l,h);u!==null&&(r===null&&(r=[]),r.push(u))}return r!==null?Promise.all(r):null}isInTimeRange(e,i,s){return i<=e.start&&s>=e.end||i>=e.start&&i<=e.end||s>=e.start&&s<=e.end}static dispose(){ld._audioBuffers.clear()}handleAudioLoading(e,i){this._audioLoader||(this._audioLoader=new S_);const s=this.getAudioFilePath(e.asset.clip);if(ld._audioBuffers.get(s)){const o=ld._audioBuffers.get(s);return o.then(a=>{a&&i.setBuffer(a)}),o}Ea&&console.warn("LOAD audio track",s,this.director.sourceId);const r=new Promise((o,a)=>{this._audioLoader.load(s,l=>{i.setBuffer(l),o(l)},void 0,l=>{console.error("Error loading audio",l),o(null)})});return ld._audioBuffers.set(s,r),r}};let bd=ld;c(bd,"_audioBuffers",new Map);class Tv extends jy{constructor(){super(...arguments);c(this,"models",[]);c(this,"didTrigger",[]);c(this,"receivers",[])}evaluate(e){var s;if(this.track.muted)return;const i=this.director.context.time.deltaTime*1.5;for(let r=0;r<this.models.length;r++){const o=this.models[r],a=this.didTrigger[r],l=o.time-e;let h=!1;if(o.retroActive)h=l<=1e-6;else{const u=Math.abs(l);(u===0||u>=1e-5&&u<i)&&(h=!0)}if(h){if(!a)if(Ea&&console.log("Trigger signal",e,o.time,o),this.didTrigger[r]=!0,((s=this.receivers)==null?void 0:s.length)<=0)Tc.invoke(o.asset);else for(const u of this.receivers)u&&u.invoke(o.asset)}else o.emitOnce||(this.didTrigger[r]=!1)}}}class TC extends jy{constructor(){super(...arguments);c(this,"models",[]);c(this,"timelines",[]);c(this,"_previousActiveModel",null)}resolveSourceObjects(e){for(let i=this.models.length-1;i>=0;i--){const r=this.models[i].asset;if(!r.sourceObject||typeof r.sourceObject!="object"){console.log("no source object, removing model",i,r),this.models.splice(i,1);continue}else{const o=z.getComponent(r.sourceObject,Rc);this.timelines.push(o),o&&r.updateDirector&&(o.playOnAwake=!1)}}}evaluate(e){var i;this._previousActiveModel=null;for(let s=0;s<this.models.length;s++){const r=this.models[s],o=r.asset;if(e>=r.start&&e<=r.end){this._previousActiveModel=r;const a=this.getClipTime(e,r);if(o.controlActivation){const l=o.sourceObject;l.visible=!0}if(o.updateDirector){const l=this.timelines[s];l&&(l.isPlaying&&l.pause(),l.time=a,l.evaluate())}}else{const a=(i=this._previousActiveModel)==null?void 0:i.asset;if(o.controlActivation){const l=o.sourceObject;(a==null?void 0:a.sourceObject)!==l&&(l.visible=!1)}}}}}const xu=N("debugtimeline");var Ku;(function(n){n[n.Hold=0]="Hold",n[n.Loop=1]="Loop",n[n.None=2]="None"})(Ku||(Ku={}));var DI;(function(n){n[n.None=0]="None",n[n.Hold=1]="Hold",n[n.Loop=2]="Loop",n[n.PingPong=3]="PingPong",n[n.Continue=4]="Continue"})(DI||(DI={}));const ty=class extends se{constructor(){super(...arguments);c(this,"playableAsset");c(this,"playOnAwake");c(this,"extrapolationMode",Ku.Loop);c(this,"waitForAudio",!0);c(this,"_visibilityChangeEvt");c(this,"_clonedPlayableAsset",!1);c(this,"_speed",1);c(this,"_guidsMap");c(this,"_isPlaying",!1);c(this,"_internalUpdateRoutine");c(this,"_isPaused",!1);c(this,"_isStopping",!1);c(this,"_time",0);c(this,"_duration",0);c(this,"_weight",1);c(this,"_animationTracks",[]);c(this,"_audioTracks",[]);c(this,"_signalTracks",[]);c(this,"_controlTracks",[]);c(this,"_customTracks",[]);c(this,"_allTracks",[this._animationTracks,this._audioTracks,this._signalTracks,this._controlTracks,this._customTracks]);c(this,"animationCallbackReceivers",[])}static registerCreateTrack(e,i){this.createTrackFunctions[e]=i}get isPlaying(){return this._isPlaying}get isPaused(){return this._isPaused}get time(){return this._time}set time(e){typeof e=="number"&&!Number.isNaN(e)?this._time=e:(xu||qs())&&console.error("INVALID TIMELINE.TIME VALUE",e,this.name)}get duration(){return this._duration}set duration(e){this._duration=e}get weight(){return this._weight}set weight(e){this._weight=e}get speed(){return this._speed}set speed(e){this._speed=e}awake(){var e,i,s;xu&&console.log(this,(e=this.playableAsset)==null?void 0:e.tracks),this.rebuildGraph(),this.isValid()||console.warn("PlayableDirector is not valid",this.playableAsset,(i=this.playableAsset)==null?void 0:i.tracks,Array.isArray((s=this.playableAsset)==null?void 0:s.tracks),this)}onEnable(){var e,i,s;for(const r of this._audioTracks)(e=r.onEnable)==null||e.call(r);for(const r of this._customTracks)(i=r.onEnable)==null||i.call(r);for(const r of this._animationTracks)(s=r.onEnable)==null||s.call(r);this.playOnAwake&&this.play(),this._visibilityChangeEvt||(this._visibilityChangeEvt=()=>{switch(document.visibilityState){case"hidden":this.setAudioTracksAllowPlaying(!1);break;case"visible":this.setAudioTracksAllowPlaying(!0);break}}),window.addEventListener("visibilitychange",this._visibilityChangeEvt)}onDisable(){var e,i,s;this.stop();for(const r of this._audioTracks)(e=r.onDisable)==null||e.call(r);for(const r of this._customTracks)(i=r.onDisable)==null||i.call(r);for(const r of this._animationTracks)(s=r.onDisable)==null||s.call(r);this._visibilityChangeEvt&&window.removeEventListener("visibilitychange",this._visibilityChangeEvt)}onDestroy(){var e;for(const i of this._allTracks)for(const s of i)(e=s.onDestroy)==null||e.call(s)}rebuildGraph(){this.isValid()&&(this.resolveBindings(),this.updateTimelineDuration(),this.setupAndCreateTrackHandlers())}async play(){if(!this.isValid())return;const e=this._isPaused==!0;if(this._isPaused=!1,!this._isPlaying){if(this._isPlaying=!0,e&&this.invokePauseChangedMethodsOnTracks(),this.waitForAudio){const i=[];for(const s of this._audioTracks){const r=s.loadAudio(this._time,1,0);r&&i.push(r)}if(i.length>0&&(await Promise.all(i),!this._isPlaying))return;for(;this._audioTracks.length>0&&this._isPlaying&&!kt.userInteractionRegistered&&this.waitForAudio;)await El(200)}this.invokeStateChangedMethodsOnTracks(),this._internalUpdateRoutine=this.startCoroutine(this.internalUpdate(),ze.LateUpdate)}}pause(){this.isValid()&&(this._isPlaying=!1,!this._isPaused&&(this._isPaused=!0,this.internalEvaluate(),this.invokePauseChangedMethodsOnTracks(),this.invokeStateChangedMethodsOnTracks()))}stop(){this._isStopping=!0;for(const s of this._audioTracks)s.stop();const e=this._isPaused==!0,i=this._isPlaying;this._isPlaying&&(this._time=0,this._isPlaying=!1,this._isPaused=!1,this.internalEvaluate(),e&&this.invokePauseChangedMethodsOnTracks()),this._isPlaying=!1,this._isPaused=!1,e&&!i&&this.invokePauseChangedMethodsOnTracks(),i&&this.invokeStateChangedMethodsOnTracks(),this._internalUpdateRoutine&&this.stopCoroutine(this._internalUpdateRoutine),this._internalUpdateRoutine=null,this._isStopping=!1}evaluate(){this.internalEvaluate(!0)}isValid(){return this.playableAsset&&this.playableAsset.tracks&&Array.isArray(this.playableAsset.tracks)}*forEachTrack(){for(const e of this._allTracks)for(const i of e)yield i}get audioTracks(){return this._audioTracks}resolveGuids(e){this._guidsMap=e}invokePauseChangedMethodsOnTracks(){var e;for(const i of this.forEachTrack())(e=i.onPauseChanged)==null||e.call(i)}invokeStateChangedMethodsOnTracks(){var e;for(const i of this.forEachTrack())(e=i.onStateChanged)==null||e.call(i,this._isPlaying)}*internalUpdate(){for(;this._isPlaying&&this.activeAndEnabled;)!this._isPaused&&this._isPlaying&&(this._time+=this.context.time.deltaTime*this.speed,this.internalEvaluate()),yield}internalEvaluate(e=!1){if(!this.isValid())return;let i=this._time;switch(this.extrapolationMode){case Ku.Hold:this._speed>0?i=Math.min(i,this._duration):this._speed<0&&(i=Math.max(i,0)),this._time=i;break;case Ku.Loop:i%=this._duration,this._time=i;break;case Ku.None:if(i>this._duration){this.stop();return}break}const s=this._time;for(const r of this.playableAsset.tracks)if(!r.muted)switch(r.type){case rr.Activation:if(!e&&!this._isPlaying)continue;for(let o=0;o<r.outputs.length;o++){const a=r.outputs[o];if(typeof a=="object"){let l=!1;if(r.clips)for(const u of r.clips)u.start<=s&&s<=u.end&&(l=!0);const h=a;h.visible!==void 0&&h.visible!==l&&(h.visible=l,xu&&console.warn(this.name,"set ActivationTrack-"+o,h.name,l,s))}}break}if(!this._isStopping)for(const r of this._animationTracks)r.evaluate(s);for(const r of this._audioTracks)r.evaluate(s);for(const r of this._signalTracks)r.evaluate(s);for(const r of this._controlTracks)r.evaluate(s);for(const r of this._customTracks)r.evaluate(s)}resolveBindings(){if(this._clonedPlayableAsset||(this._clonedPlayableAsset=!0,this.playableAsset=dy(this.playableAsset)),!this.playableAsset||!this.playableAsset.tracks)return;const e=this.findRoot(this.gameObject);for(const i of this.playableAsset.tracks){for(let s=i.outputs.length-1;s>=0;s--){let r=i.outputs[s];if(typeof r=="string"){this._guidsMap&&this._guidsMap[r]&&(r=this._guidsMap[r]);const o=z.findByGuid(r,e);o===null||typeof o!="object"?(i.outputs.splice(s,1),console.warn("Failed to resolve binding",r,i.name,i.type)):(xu&&console.log("Resolved binding",r,"to",o),i.outputs[s]=o)}else if(r===null){if(i.outputs.splice(s,1),ty.createTrackFunctions[i.type])continue;i.type!==rr.Audio&&i.type!==rr.Control&&i.type!==rr.Marker&&i.type!==rr.Signal&&console.warn("Missing binding",r,i.name,i.type,this.name,this.playableAsset.name)}}if(i.type===rr.Control&&i.clips)for(let s=0;s<i.clips.length;s++){const r=i.clips[s];let o=r.asset.sourceObject;if(typeof o=="string"){this._guidsMap&&this._guidsMap[o]&&(o=this._guidsMap[o]);const a=z.findByGuid(o,e);a===null||typeof a!="object"?console.warn("Failed to resolve sourceObject binding",o,i.name,r):(xu&&console.log("Resolved binding",o,"to",a),r.asset.sourceObject=a)}}}}findRoot(e){return e.parent?this.findRoot(e.parent):e}updateTimelineDuration(){if(this._duration=0,!(!this.playableAsset||!this.playableAsset.tracks)){for(const e of this.playableAsset.tracks)if(e.muted!==!0){if(e.clips)for(const i of e.clips)i.end>this._duration&&(this._duration=i.end);if(e.markers)for(const i of e.markers)i.time>this._duration&&(this._duration=i.time+.001)}}}setupAndCreateTrackHandlers(){var i,s,r;if(this._animationTracks.length=0,this._audioTracks.length=0,this._signalTracks.length=0,!this.playableAsset)return;let e=z.findObjectOfType(Rh,this.context);for(const o of this.playableAsset.tracks){const a=o.type,l=ty.createTrackFunctions[a];if(l!=null){const h=l(this,o);if(typeof h.evaluate=="function"){h.director=this,h.track=o,this._customTracks.push(h);continue}}if(o.type===rr.Animation){if(!o.clips||o.clips.length<=0){xu&&console.warn("Animation track has no clips",o);continue}for(let h=o.outputs.length-1;h>=0;h--){let u=o.outputs[h];if(u instanceof re){const f=z.getOrAddComponent(u,zn);f&&(u=f)}const d=(i=u==null?void 0:u.gameObject)==null?void 0:i.animations;if(d){const f=new IC;f.trackOffset=o.trackOffset,f.director=this,f.track=o;for(let p=0;p<o.clips.length;p++){const g=o.clips[p],m=g.asset;if(!m){console.error(`Timeline ${this.name}: clip #${p} on track "${o.name}" has no animation data`);continue}const v=m.clip;let y=v;if((typeof y=="string"||typeof y=="number")&&(y=d.find(_=>_.name===v)),!y){console.warn("Could not find animationClip for model",g,o.name,this.name,(s=this.playableAsset)==null?void 0:s.name);continue}u instanceof zn&&u.runtimeAnimatorController&&(u.__internalDidAwakeAndStart||u.initializeRuntimeAnimatorController(),u.runtimeAnimatorController.mixer||u.runtimeAnimatorController.bind(u),f.mixer=u.runtimeAnimatorController.mixer),f.mixer||(f.mixer=new gx(u.gameObject)),f.clips.push(y),f.mixer.uncacheAction(y),f.createHooks(g.asset,y);const b=f.mixer.clipAction(y);f.actions.push(b),f.models.push(g)}this._animationTracks.push(f)}}}else if(o.type===rr.Audio){if(!o.clips||o.clips.length<=0)continue;const h=new bd;h.director=this,h.track=o,h.audioSource=o.outputs.find(u=>u instanceof kt),this._audioTracks.push(h),e||(e=(r=this.context.mainCameraComponent)==null?void 0:r.gameObject.addNewComponent(Rh)),h.listener=e.listener;for(let u=0;u<o.clips.length;u++){const d=o.clips[u];h.addModel(d)}}else if(o.type===rr.Marker){const h=new Tv;if(h.director=this,h.track=o,o.markers)for(const u of o.markers)switch(u.type){case Pw.Signal:h.models.push(u),h.didTrigger.push(!1);break}if(h!==null&&h.models.length>0){const u=z.getComponent(this.gameObject,Tc);u&&(h.receivers.push(u),this._signalTracks.push(h))}}else if(o.type===rr.Signal){const h=new Tv;if(h.director=this,h.track=o,o.markers)for(const u of o.markers)h.models.push(u),h.didTrigger.push(!1);for(const u of o.outputs)h.receivers.push(u);this._signalTracks.push(h)}else if(o.type===rr.Control){const h=new TC;if(h.director=this,h.track=o,o.clips)for(const u of o.clips)h.models.push(u);h.resolveSourceObjects(this.context),this._controlTracks.push(h)}}}setAudioTracksAllowPlaying(e){for(const i of this._audioTracks)i.onAllowAudioChanged(e)}registerAnimationCallback(e){this.animationCallbackReceivers.push(e)}unregisterAnimationCallback(e){const i=this.animationCallbackReceivers.indexOf(e);i!==-1&&this.animationCallbackReceivers.splice(i,1)}};let Rc=ty;c(Rc,"createTrackFunctions",{});const VA=Symbol("objectIsAnimatedData");function kI(n,t,e){if(!n)return;if(n[VA]===void 0){if(!e)return;n[VA]=new Set}const i=n[VA];e?i.add(t):i.has(t)&&i.delete(t)}function F5(n){if(!n)return!1;const t=n[VA];return t!==void 0&&t.size>0}mt.registerCallback(yt.ContextCreated,n=>{const t=n.context.domElement.getAttribute("autoplay");if(t!==void 0&&(t===""||t==="true"||t==="1")&&n.files)for(const e of n.files)z.foreachComponent(e.file.scene,s=>{if(s.enabled!==!1){if(s instanceof Ps&&s.playAutomatically||s instanceof zn||s instanceof Rc&&s.playOnAwake===!0)return!0;if(s instanceof Ps)return s.playAutomatically=!0,!0;if(s instanceof Rc)return s.playOnAwake=!0,!0}},!0)!==!0&&U5(e.file)});function U5(n){if(!n||!n.animations)return;for(let e=0;e<n.animations.length;e++){const i=n.animations[e];if(!(!i.tracks||i.tracks.length<=0))for(const s in i.tracks){const r=i.tracks[s],o=vr.parseTrackName(r.name);let a=vr.findNode(n.scene,o.nodeName);if(!a){const u=r.__objectName??r.name.substring(0,r.name.indexOf("."));if(a=n.scene.getObjectByProperty("uuid",u),!a)continue}let l=t(a);l||(l=Sh(n.scene,new Ps));const h=l.animations=l.animations||[];i.name_animator=l.name,h.indexOf(i)<0&&h.push(i)}}function t(e){var s;if(!e)return;const i=(s=e.userData)==null?void 0:s.components;if(i&&i.length>0)for(let r=0;r<i.length;r++){const o=i[r];if(o instanceof zn||o instanceof Ps)return e}return t(e.parent)}}class _X{constructor(){c(this,"_context")}get context(){return this._context??Ne.Current}get isStateMachineBehaviour(){return!0}}class Km{constructor(t,e,i,s){c(this,"name");c(this,"nameHash");c(this,"normalizedTime");c(this,"length");c(this,"speed");c(this,"action");c(this,"hasTransitions");var r;this.name=t.name,this.nameHash=t.hash,this.normalizedTime=e,this.length=i,this.speed=s,this.action=t.motion.action||null,this.hasTransitions=((r=t.transitions)==null?void 0:r.length)>0||!1}}function N5(n,t){return{name:"Empty",isLooping:!1,guid:(t==null?void 0:t.generateUUID())??vt.generateUUID(),index:-1,clip:new Pa(n,0,[])}}var oc;(function(n){n[n.If=1]="If",n[n.IfNot=2]="IfNot",n[n.Greater=3]="Greater",n[n.Less=4]="Less",n[n.Equals=6]="Equals",n[n.NotEqual=7]="NotEqual"})(oc||(oc={}));var Mw;(function(n){n[n.Float=1]="Float",n[n.Int=3]="Int",n[n.Bool=4]="Bool",n[n.Trigger=9]="Trigger"})(Mw||(Mw={}));const tn=N("debuganimatorcontroller"),Jm=N("debugrootmotion");class to{constructor(t){c(this,"_speed",1);c(this,"normalizedStartOffset",0);c(this,"animator");c(this,"model");c(this,"_mixer");c(this,"_activeState");c(this,"_activeStates",[]);c(this,"_heldActions",[]);c(this,"rootMotionHandler");this.model=t,tn&&console.log(this)}static createFromClips(t,e={looping:!1,autoTransition:!0,transitionDuration:0}){const i=[];for(let o=0;o<t.length;o++){const a=t[o],l=[];if(e.autoTransition!==!1){const u=e.transitionDuration??0,d=u/a.duration;let f=o;(e.autoTransition===void 0||e.autoTransition===!0)&&(f=(o+1)%t.length),l.push({exitTime:1-d,offset:0,duration:u,hasExitTime:!0,destinationState:f,conditions:[]})}const h={name:a.name,hash:o,motion:{name:a.name,clip:a,isLooping:(e==null?void 0:e.looping)??!1},transitions:l,behaviours:[]};i.push(h)}const s={name:"AnimatorController",guid:new Qn(Date.now()).generateUUID(),parameters:[],layers:[{name:"Base Layer",stateMachine:{defaultState:0,states:i}}]};return new to(s)}play(t,e=-1,i=Number.NEGATIVE_INFINITY,s=0){if(e<0)e=0;else if(e>=this.model.layers.length){console.warn("invalid layer");return}const o=this.model.layers[e].stateMachine;for(const a of o.states)if(a.name===t||a.hash===t){tn&&console.log("transition to ",a),this.transitionTo(a,s,i);return}console.warn("Could not find "+t+" to play")}reset(){this.setStartTransition()}setBool(t,e){var s,r;const i=typeof t=="string"?"name":"hash";return(r=(s=this.model)==null?void 0:s.parameters)==null?void 0:r.filter(o=>o[i]===t).forEach(o=>o.value=e)}getBool(t){var i,s,r;const e=typeof t=="string"?"name":"hash";return((r=(s=(i=this.model)==null?void 0:i.parameters)==null?void 0:s.find(o=>o[e]===t))==null?void 0:r.value)??!1}setFloat(t,e){var r,o;const i=typeof t=="string"?"name":"hash",s=(o=(r=this.model)==null?void 0:r.parameters)==null?void 0:o.filter(a=>a[i]===t);return s.forEach(a=>a.value=e),(s==null?void 0:s.length)>0}getFloat(t){var i,s,r;const e=typeof t=="string"?"name":"hash";return((r=(s=(i=this.model)==null?void 0:i.parameters)==null?void 0:s.find(o=>o[e]===t))==null?void 0:r.value)??0}setInteger(t,e){var s,r;const i=typeof t=="string"?"name":"hash";return(r=(s=this.model)==null?void 0:s.parameters)==null?void 0:r.filter(o=>o[i]===t).forEach(o=>o.value=e)}getInteger(t){var i,s,r;const e=typeof t=="string"?"name":"hash";return((r=(s=(i=this.model)==null?void 0:i.parameters)==null?void 0:s.find(o=>o[e]===t))==null?void 0:r.value)??0}setTrigger(t){var i,s;tn&&console.log("SET TRIGGER",t);const e=typeof t=="string"?"name":"hash";return(s=(i=this.model)==null?void 0:i.parameters)==null?void 0:s.filter(r=>r[e]===t).forEach(r=>r.value=!0)}resetTrigger(t){var i,s;const e=typeof t=="string"?"name":"hash";return(s=(i=this.model)==null?void 0:i.parameters)==null?void 0:s.filter(r=>r[e]===t).forEach(r=>r.value=!1)}getTrigger(t){var i,s,r;const e=typeof t=="string"?"name":"hash";return((r=(s=(i=this.model)==null?void 0:i.parameters)==null?void 0:s.find(o=>o[e]===t))==null?void 0:r.value)??!1}isInTransition(){return this._activeStates.length>1}setSpeed(t){this._speed=t}FindState(t){return this.findState(t)}findState(t){if(!t)return null;if(Array.isArray(this.model.layers)){for(const e of this.model.layers)for(const i of e.stateMachine.states)if(i.name===t||i.hash==t)return i}return null}getCurrentStateInfo(){if(!this._activeState)return null;const t=this._activeState.motion.action;if(!t)return null;const e=this._activeState.motion.clip.duration,i=e<=0?0:Math.abs(t.time/e);return new Km(this._activeState,i,e,this._speed)}get currentAction(){if(!this._activeState)return null;const t=this._activeState.motion.action;return t||null}get context(){var t;return(t=this.animator)==null?void 0:t.context}get mixer(){return this._mixer}bind(t){t?this.animator!==t&&(this.animator=t,this._mixer=new gx(this.animator.gameObject),this.createActions(this.animator)):console.error("AnimatorController.bind: animator is null")}clone(){if(typeof this.model=="string")return console.warn("AnimatorController has not been resolved, can not create model from string",this.model),null;tn&&console.warn("AnimatorController clone()",this.model);const t=dy(this.model,(i,s,r)=>r==null?!0:!(r.type==="Object3D"||r.isObject3D===!0||vN(r)||r.tracks!==void 0||r instanceof to));return console.assert(t!==this.model),new to(t)}update(t){var i,s;if(!this.animator)return;this.evaluateTransitions(),this.updateActiveStates(t);const e=this.animator.context.time.deltaTime;this.animator.applyRootMotion&&((i=this.rootMotionHandler)==null||i.onBeforeUpdate(t)),this._mixer.update(e),this.animator.applyRootMotion&&((s=this.rootMotionHandler)==null||s.onAfterUpdate(t))}get activeState(){return this._activeState}updateActiveStates(t){for(let e=0;e<this._activeStates.length;e++){const i=this._activeStates[e],s=i.motion;if(!s.action)this._activeStates.splice(e,1),e--;else{const r=s.action;r.weight=t,r.getEffectiveWeight()<=0&&!r.isRunning()&&(tn&&console.debug("REMOVE",i.name,r.getEffectiveWeight(),r.isRunning(),r.isScheduled()),this._activeStates.splice(e,1),e--)}}}setStartTransition(){var t;this.model.layers.length>1&&(tn||xe())&&console.warn("Multiple layers are not supported yet "+((t=this.animator)==null?void 0:t.name));for(const e of this.model.layers){const i=e.stateMachine;i.defaultState===void 0&&(tn&&console.warn("AnimatorController default state is undefined, will assign state 0 as default",e),i.defaultState=0);const s=i.states[i.defaultState];this.transitionTo(s,0,this.normalizedStartOffset);break}}evaluateTransitions(){var r;let t=!1;if(!this._activeState){if(this.setStartTransition(),!this._activeState)return;t=!0}const e=this._activeState,i=e.motion.action;for(const o of e.transitions){if(!o.hasExitTime&&o.conditions.length<=0)continue;let a=!0;for(const l of o.conditions)if(!this.evaluateCondition(l)){a=!1;break}if(a)if(i){const l=e.motion.clip.duration,h=l<=0?1:Math.abs(i.time/l);let u=o.exitTime;i.timeScale<0&&(u=1-u);let d=!1;if(o.hasExitTime?d=h>=u:d=!0,d){for(const f of o.conditions){const p=this.model.parameters.find(g=>g.name===f.parameter);(p==null?void 0:p.type)===Mw.Trigger&&p.value&&(p.value=!1)}if(i.clampWhenFinished=!0,tn){const f=this.getState(o.destinationState,0);console.log(`Transition to ${o.destinationState} / ${f==null?void 0:f.name}`,o,`
Timescale: `+i.timeScale,`
Normalized time: `+h.toFixed(3),`
Exit Time: `+u,o.hasExitTime)}this.transitionTo(o.destinationState,o.duration,o.offset);return}}else{this.transitionTo(o.destinationState,o.duration,o.offset);return}}i&&this.setTimescale(i,e);let s=!1;if(e.motion.isLooping&&i&&(i.time>=i.getClip().duration?(s=!0,i.reset(),i.time=0,i.play()):i.time<=0&&i.timeScale<0&&(s=!0,i.reset(),i.time=i.getClip().duration,i.play())),!s&&e&&!t&&i&&this.animator&&e.behaviours){const o=i==null?void 0:i.getClip().duration,a=i.time/o,l=new Km(this._activeState,a,o,this._speed);for(const h of e.behaviours)h.instance&&((r=h.instance.onStateUpdate)==null||r.call(h.instance,this.animator,l,0))}}setTimescale(t,e){let i=e.speed??1;e.speedParameter&&(i*=this.getFloat(e.speedParameter)),i!==void 0&&(t.timeScale=i*this._speed)}getState(t,e){return typeof t=="number"&&(t==-1&&(t=this.model.layers[e].stateMachine.defaultState,t===void 0&&(tn&&console.warn("AnimatorController default state is undefined: ",this.model,"Layer: "+e),t=0)),t=this.model.layers[e].stateMachine.states[t]),t}releaseHeldActions(t){for(const e of this._heldActions)e.fadeOut(t);this._heldActions.length=0}transitionTo(t,e,i){var u,d,f,p,g,m,v,y;if(!this.animator)return;const s=0;if(t=this.getState(t,s),!(t!=null&&t.motion)||!t.motion.clip||!(t.motion.clip instanceof Pa))return;const r=this._activeState===t;if(r){const b=t.motion;if(!b.action_loopback&&b.clip){const _=this.rootMotionHandler?this.animator.gameObject.matrix.clone():null;this._mixer.uncacheAction(b.clip,this.animator.gameObject),_&&_.decompose(this.animator.gameObject.position,this.animator.gameObject.quaternion,this.animator.gameObject.scale),b.action_loopback=this.createAction(b.clip)}}if((u=this._activeState)!=null&&u.behaviours&&this._activeState.motion.action){const b=(d=this._activeState)==null?void 0:d.motion.clip.duration,_=this._activeState.motion.action.time/b,x=new Km(this._activeState,_,b,this._speed);for(const S of this._activeState.behaviours)(p=(f=S.instance)==null?void 0:f.onStateExit)==null||p.call(S.instance,this.animator,x,s)}const o=(g=this._activeState)==null?void 0:g.motion.action;r&&(t.motion.action=t.motion.action_loopback,t.motion.action_loopback=o);const a=this._activeState;this._activeState=t;const l=(m=t.motion)==null?void 0:m.action,h=t.motion.clip;if((h==null?void 0:h.duration)<=0&&h.tracks.length<=0?o&&this._heldActions.push(o):o&&(o.fadeOut(e),this.releaseHeldActions(e)),l){if(i=Math.max(0,Math.min(1,i)),t.cycleOffsetParameter){let _=this.getFloat(t.cycleOffsetParameter);typeof _=="number"?(_<0&&(_+=1),i+=_,i%=1):tn&&console.warn("AnimatorController cycle offset parameter is not a number",t.cycleOffsetParameter)}else typeof t.cycleOffset=="number"&&(i+=t.cycleOffset,i%=1);l.isRunning()&&l.stop(),l.reset(),l.enabled=!0,this.setTimescale(l,t);const b=t.motion.clip.duration;if(l.time=r?0:i*b,l.timeScale<0&&(l.time=b-l.time),l.clampWhenFinished=!0,l.setLoop(C_,0),e>0?l.fadeIn(e):l.weight=1,l.play(),this.rootMotionHandler&&this.rootMotionHandler.onStart(l),this._activeStates.includes(t)||this._activeStates.push(t),this._activeState.behaviours){const _=new Km(t,i,b,this._speed);for(const x of this._activeState.behaviours)(y=(v=x.instance)==null?void 0:v.onStateEnter)==null||y.call(x.instance,this.animator,_,s)}}else tn&&(t.__warned_no_motion||(t.__warned_no_motion=!0,console.warn("No action",t.motion,this)));tn&&console.log("TRANSITION FROM "+(a==null?void 0:a.name)+" TO "+t.name,e,o,l,l==null?void 0:l.getEffectiveTimeScale(),l==null?void 0:l.getEffectiveWeight(),l==null?void 0:l.isRunning(),l==null?void 0:l.isScheduled(),l==null?void 0:l.paused)}createAction(t){var i,s;if(this._mixer.existingAction(t)&&this._mixer.uncacheAction(t,(i=this.animator)==null?void 0:i.gameObject),(s=this.animator)!=null&&s.applyRootMotion){this.rootMotionHandler||(this.rootMotionHandler=new Q5(this));const r=this.animator.gameObject;return this.rootMotionHandler.createClip(this._mixer,r,t)}else return this._mixer.clipAction(t)}evaluateCondition(t){const e=this.model.parameters.find(i=>i.name===t.parameter);if(!e)return!1;switch(t.mode){case oc.If:return e.value===!0;case oc.IfNot:return e.value===!1;case oc.Greater:return e.value>t.threshold;case oc.Less:return e.value<t.threshold;case oc.Equals:return e.value===t.threshold;case oc.NotEqual:return e.value!==t.threshold}return!1}createActions(t){var e,i,s,r;tn&&console.log("AnimatorController createActions",this.model);for(const o of this.model.layers){const a=o.stateMachine;for(let l=0;l<a.states.length;l++){const h=a.states[l];h.transitions||(h.transitions=[]);for(const u of h.transitions)u.conditions||(u.conditions=[]);if(h.motion||(tn&&console.warn("No motion",h),h.motion=N5(h.name)),this.animator&&h.motion.clips){const u=(e=h.motion.clips)==null?void 0:e.find(d=>{var f,p;return d.node.name===((p=(f=this.animator)==null?void 0:f.gameObject)==null?void 0:p.name)});u?h.motion.clip=u.clip:(tn||xe())&&console.warn('Could not find clip for animator "'+((s=(i=this.animator)==null?void 0:i.gameObject)==null?void 0:s.name)+'"',h.motion.clips.map(d=>d.node.name))}if(!h.motion.clip){tn&&console.warn("No clip assigned to state",h);const u=new Pa(void 0,void 0,[]);h.motion.clip=u}if((r=h.motion)!=null&&r.clip){const u=h.motion.clip;if(u instanceof Pa){const d=this.createAction(u);h.motion.action=d}else(tn||xe())&&console.warn("No valid animationclip assigned",h)}if(h.behaviours&&Array.isArray(h.behaviours))for(const u of h.behaviours){if(!(u!=null&&u.typeName))continue;const d=D.get(u.typeName),f=new d;f.isStateMachineBehaviour&&(f._context=this.context??void 0,Dd(f,u.properties),u.instance=f),tn&&console.log("Created animator controller behaviour",h.name,u.typeName,u.properties,f)}}}}*enumerateActions(){if(this.model.layers)for(const t of this.model.layers){const e=t.stateMachine;for(let i=0;i<e.states.length;i++){const s=e.states[i];s!=null&&s.motion&&(s.motion.action&&(yield s.motion.action),s.motion.action_loopback&&(yield s.motion.action_loopback))}}}}class OI{constructor(t,e){c(this,"track");c(this,"createdInterpolant");c(this,"originalEvaluate");c(this,"customEvaluate");this.track=t;const i=t,s=i.createInterpolant.bind(t);i.createInterpolant=()=>(i.createInterpolant=s,this.createdInterpolant=s(),this.originalEvaluate=this.createdInterpolant.evaluate.bind(this.createdInterpolant),this.customEvaluate=r=>{if(!this.originalEvaluate)return;const o=this.originalEvaluate(r);return e(r,o)},this.createdInterpolant.evaluate=this.customEvaluate,this.createdInterpolant)}dispose(){this.createdInterpolant&&this.originalEvaluate&&(this.createdInterpolant.evaluate=this.originalEvaluate),this.track=void 0,this.createdInterpolant=null,this.originalEvaluate=void 0,this.customEvaluate=void 0}}const qi=class{constructor(t,e,i,s,r){c(this,"_action");c(this,"root");c(this,"clip");c(this,"positionWrapper",null);c(this,"rotationWrapper",null);c(this,"context");c(this,"positionChange",new C);c(this,"rotationChange",new ne);c(this,"_prevTime",0);if(this.context=t,this.root=e,this.clip=i,qi.firstKeyframeRotation[this.cacheId]||(qi.firstKeyframeRotation[this.cacheId]=new ne),r){const o=r.values;qi.firstKeyframeRotation[this.cacheId].set(o[0],o[1],o[2],o[3])}qi.spaceRotation[this.cacheId]||(qi.spaceRotation[this.cacheId]=new ne),qi.effectiveSpaceRotation[this.cacheId]||(qi.effectiveSpaceRotation[this.cacheId]=new ne),qi.clipOffsetRotation[this.cacheId]=new ne,r&&qi.clipOffsetRotation[this.cacheId].set(r.values[0],r.values[1],r.values[2],r.values[3]).invert(),this.handlePosition(i,s),this.handleRotation(i,r)}set action(t){this._action=t}get action(){return this._action}get cacheId(){return this.root.uuid}onStart(t){if(t.getClip()!==this.clip)return;qi.lastObjRotation[this.cacheId]||(qi.lastObjRotation[this.cacheId]=this.root.quaternion.clone());const e=qi.lastObjRotation[this.cacheId];if(qi.spaceRotation[this.cacheId].copy(e),Jm){const i=new fi().setFromQuaternion(e);console.log("START",this.clip.name,Ae.toDegrees(i.y),this.root.position.z)}}getClipRotationOffset(){return qi.clipOffsetRotation[this.cacheId]}handlePosition(t,e){if(e){const i=this.root;Jm&&i.add(new Do),qi.lastObjPosition[this.cacheId]||(qi.lastObjPosition[this.cacheId]=this.root.position.clone());const s=new C,r=new C;this.positionWrapper=new OI(e,(o,a)=>{const l=this.action.getEffectiveWeight();return Jm&&i.position.length()>8&&i.position.set(0,i.position.y,0),o>this._prevTime&&(s.set(a[0],a[1],a[2]),s.sub(r),s.multiplyScalar(l),s.applyQuaternion(this.getClipRotationOffset()),s.applyQuaternion(i.quaternion),this.positionChange.copy(s)),r.fromArray(a),this._prevTime=o,a[0]=0,a[1]=0,a[2]=0,a})}}handleRotation(t,e){if(e){if(Jm){const o=e.values,a=new fi().setFromQuaternion(new ne(o[0],o[1],o[2],o[3]));console.log(t.name,e.name,"FIRST ROTATION IN TRACK",Ae.toDegrees(a.y));const l=e.values.length-4,h=new ne().set(o[l],o[l+1],o[l+2],o[l+3]),u=new fi().setFromQuaternion(h);console.log(t.name,e.name,"LAST ROTATION IN TRACK",Ae.toDegrees(u.y))}let i=0;const s=new ne,r=new ne;this.rotationWrapper=new OI(e,(o,a)=>(o>i&&(r.set(a[0],a[1],a[2],a[3]),s.invert(),r.multiply(s),this.rotationChange.copy(r)),s.fromArray(a),i=o,a[0]=0,a[1]=0,a[2]=0,a[3]=1,a))}}onBeforeUpdate(t){this.positionChange.set(0,0,0),this.rotationChange.set(0,0,0,1)}onAfterUpdate(t){return!this.action||(t*=this.action.getEffectiveWeight(),t<=0)?!1:(this.positionChange.multiplyScalar(t),this.rotationChange.slerp(qi.identityQuaternion,1-t),!0)}};let ta=qi;c(ta,"lastObjPosition",{}),c(ta,"lastObjRotation",{}),c(ta,"firstKeyframeRotation",{}),c(ta,"spaceRotation",{}),c(ta,"effectiveSpaceRotation",{}),c(ta,"clipOffsetRotation",{}),c(ta,"identityQuaternion",new ne);class Q5{constructor(t){c(this,"controller");c(this,"handler",[]);c(this,"root");c(this,"basePosition",new C);c(this,"baseQuaternion",new ne);c(this,"baseRotation",new fi);c(this,"summedPosition",new C);c(this,"summedRotation",new ne);this.controller=t}createClip(t,e,i){this.root=e,e&&"name"in e&&e.name;const s=this.findRootTrack(i,".position"),r=this.findRootTrack(i,".quaternion"),o=new ta(this.controller.context,e,i,s,r);this.handler.push(o);const a=t.clipAction(i);return o.action=a,a}onStart(t){for(const e of this.handler)e.onStart(t)}onBeforeUpdate(t){this.basePosition.copy(this.root.position),this.baseQuaternion.copy(this.root.quaternion);for(const e of this.handler)e.onBeforeUpdate(t)}onAfterUpdate(t){if(!(t<=0)){this.root.position.copy(this.basePosition),this.root.quaternion.copy(this.baseQuaternion),this.summedPosition.set(0,0,0),this.summedRotation.set(0,0,0,1);for(const e of this.handler)e.onAfterUpdate(t)&&(this.summedPosition.add(e.positionChange),this.summedRotation.multiply(e.rotationChange));this.root.position.add(this.summedPosition),this.root.quaternion.multiply(this.summedRotation)}}findRootTrack(t,e){const i=t.tracks;if(!i)return null;for(const s of i)if(s.name.endsWith(e))return s;return null}}class z5 extends Na{onSerialize(t,e){}onDeserialize(t,e){if(e.type===to&&(t==null?void 0:t.__type)==="AnimatorController")return new to(t)}}new z5(to);var Gy=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};const Mr=N("debuganimator");class zn extends se{constructor(){super(...arguments);c(this,"applyRootMotion",!1);c(this,"hasRootMotion",!1);c(this,"keepAnimatorControllerStateOnDisable",!1);c(this,"_parametersAreDirty",!1);c(this,"_isDirty",!1);c(this,"_speed",1);c(this,"_normalizedStartOffset",0);c(this,"_animatorController",null);c(this,"_initializeWithRuntimeAnimatorController")}set runtimeAnimatorController(e){var i;this._animatorController&&this._animatorController.model===e||(e?e instanceof to?(e.animator&&e.animator!==this&&(console.warn("AnimatorController can not be bound to multiple animators",(i=e.model)==null?void 0:i.name),e.model||console.error("AnimatorController has no model"),e=new to(e.model)),this._animatorController=e,this._animatorController.bind(this)):(Mr&&console.log("Assign animator controller",e,this),this._animatorController=new to(e),this.__didAwake&&this._animatorController.bind(this)):this._animatorController=null)}get runtimeAnimatorController(){return this._animatorController}getCurrentStateInfo(){var e;return(e=this.runtimeAnimatorController)==null?void 0:e.getCurrentStateInfo()}get currentAction(){var e;return((e=this.runtimeAnimatorController)==null?void 0:e.currentAction)||null}get parametersAreDirty(){return this._parametersAreDirty}get isDirty(){return this._isDirty}Play(e,i=-1,s=Number.NEGATIVE_INFINITY,r=0){this.play(e,i,s,r)}play(e,i=-1,s=Number.NEGATIVE_INFINITY,r=0){var o;(o=this.runtimeAnimatorController)==null||o.play(e,i,s,r),this._isDirty=!0}Reset(){this.reset()}reset(){var e;(e=this._animatorController)==null||e.reset(),this._isDirty=!0}SetBool(e,i){this.setBool(e,i)}setBool(e,i){var s,r;Mr&&console.log("setBool",e,i),((s=this.runtimeAnimatorController)==null?void 0:s.getBool(e))!==i&&(this._parametersAreDirty=!0),(r=this.runtimeAnimatorController)==null||r.setBool(e,i)}GetBool(e){return this.getBool(e)}getBool(e){var s;const i=((s=this.runtimeAnimatorController)==null?void 0:s.getBool(e))??!1;return Mr&&console.log("getBool",e,i),i}toggleBool(e){this.setBool(e,!this.getBool(e))}SetFloat(e,i){this.setFloat(e,i)}setFloat(e,i){var s,r;((s=this.runtimeAnimatorController)==null?void 0:s.getFloat(e))!==i&&(this._parametersAreDirty=!0),Mr&&console.log("setFloat",e,i),(r=this.runtimeAnimatorController)==null||r.setFloat(e,i)}GetFloat(e){return this.getFloat(e)}getFloat(e){var s;const i=((s=this.runtimeAnimatorController)==null?void 0:s.getFloat(e))??-1;return Mr&&console.log("getFloat",e,i),i}SetInteger(e,i){this.setInteger(e,i)}setInteger(e,i){var s,r;((s=this.runtimeAnimatorController)==null?void 0:s.getInteger(e))!==i&&(this._parametersAreDirty=!0),Mr&&console.log("setInteger",e,i),(r=this.runtimeAnimatorController)==null||r.setInteger(e,i)}GetInteger(e){return this.getInteger(e)}getInteger(e){var s;const i=((s=this.runtimeAnimatorController)==null?void 0:s.getInteger(e))??-1;return Mr&&console.log("getInteger",e,i),i}SetTrigger(e){this.setTrigger(e)}setTrigger(e){var i;this._parametersAreDirty=!0,Mr&&console.log("setTrigger",e),(i=this.runtimeAnimatorController)==null||i.setTrigger(e)}ResetTrigger(e){this.resetTrigger(e)}resetTrigger(e){var i;this._parametersAreDirty=!0,Mr&&console.log("resetTrigger",e),(i=this.runtimeAnimatorController)==null||i.resetTrigger(e)}GetTrigger(e){this.getTrigger(e)}getTrigger(e){var s;const i=(s=this.runtimeAnimatorController)==null?void 0:s.getTrigger(e);return Mr&&console.log("getTrigger",e,i),i}IsInTransition(){return this.isInTransition()}isInTransition(){var e;return((e=this.runtimeAnimatorController)==null?void 0:e.isInTransition())??!1}SetSpeed(e){return this.setSpeed(e)}setSpeed(e){var i;e!==this._speed&&(Mr&&console.log("setSpeed",e),this._speed=e,((i=this._animatorController)==null?void 0:i.animator)==this&&this._animatorController.setSpeed(e))}set minMaxSpeed(e){var i;this._speed=Ae.lerp(e.x,e.y,Math.random()),((i=this._animatorController)==null?void 0:i.animator)==this&&this._animatorController.setSpeed(this._speed)}set minMaxOffsetNormalized(e){var i;this._normalizedStartOffset=Ae.lerp(e.x,e.y,Math.random()),((i=this.runtimeAnimatorController)==null?void 0:i.animator)==this&&(this.runtimeAnimatorController.normalizedStartOffset=this._normalizedStartOffset)}awake(){Mr&&console.log("ANIMATOR",this.name,this),this.gameObject&&this.initializeRuntimeAnimatorController()}initializeRuntimeAnimatorController(e=!1){const i=e||this.runtimeAnimatorController!==this._initializeWithRuntimeAnimatorController;if(this.runtimeAnimatorController&&i){const s=this.runtimeAnimatorController.clone();this._initializeWithRuntimeAnimatorController=s,s?(console.assert(this.runtimeAnimatorController!==s),this.runtimeAnimatorController=s,console.assert(this.runtimeAnimatorController===s),this.runtimeAnimatorController.bind(this),this.runtimeAnimatorController.setSpeed(this._speed),this.runtimeAnimatorController.normalizedStartOffset=this._normalizedStartOffset):console.warn("Could not clone animator controller",this.runtimeAnimatorController)}}onDisable(){var e;this.keepAnimatorControllerStateOnDisable||(e=this._animatorController)==null||e.reset()}onBeforeRender(){this._isDirty=!1,this._parametersAreDirty=!1,!F5(this.gameObject)&&this._animatorController&&this._animatorController.update(1)}}Gy([A()],zn.prototype,"applyRootMotion",void 0);Gy([A()],zn.prototype,"hasRootMotion",void 0);Gy([A()],zn.prototype,"keepAnimatorControllerStateOnDisable",void 0);Gy([A()],zn.prototype,"runtimeAnimatorController",null);const pa=N("debugusdzanimation"),Dw=N("debugusdzanimationserialization");class RC{constructor(t,e,i){c(this,"_start");c(this,"ext");c(this,"root");c(this,"clip");c(this,"speed");this.ext=t,this.root=e,this.clip=i}get start(){return this._start===void 0&&(this._start=this.ext.getStartTime01(this.root,this.clip)),this._start}get duration(){var t;return((t=this.clip)==null?void 0:t.duration)??Yi.restPoseClipDuration}}const BS=class{constructor(t,e,i){c(this,"clip");c(this,"pos");c(this,"rot");c(this,"scale");c(this,"root");c(this,"target");c(this,"duration",0);c(this,"useRootMotion",!1);this.root=t,this.target=e,this.clip=i,i?this.duration=i.duration:this.duration=BS.restPoseClipDuration;const s=z.getComponent(t,zn);s&&(this.useRootMotion=s.applyRootMotion)}get frameRate(){return 60}addTrack(t){var e,i;if(!this.clip){console.error("This is a rest clip but you're trying to add tracks to it â€“ this is likely a bug");return}t.name.endsWith("position")?this.pos=t:t.name.endsWith("quaternion")?this.rot=t:t.name.endsWith("scale")?this.scale=t:(t.name.endsWith("activeSelf")?console.warn("[USDZ] Animation of enabled/disabled state is not supported for USDZ export and will NOT be exported: "+t.name+" on "+(((e=this.root)==null?void 0:e.name)??this.target.name)+". Animate scale 0/1 instead."):console.warn("[USDZ] Animation track type not supported for USDZ export and will NOT be exported: "+t.name+" on "+(((i=this.root)==null?void 0:i.name)??this.target.name)+". Only .position, .rotation, .scale are supported."),xe()&&Yt("[USDZ] Some animations can't be exported. See console for details."))}getFrames(){var t,e,i,s,r,o;return this.clip?Math.max(((e=(t=this.pos)==null?void 0:t.times)==null?void 0:e.length)??0,((s=(i=this.rot)==null?void 0:i.times)==null?void 0:s.length)??0,((o=(r=this.scale)==null?void 0:r.times)==null?void 0:o.length)??0):2}getDuration(){return this.duration}getSortedTimesArray(t=!0,e=!0,i=!0){var l,h,u;if(!this.clip)return[0,this.duration];const s=(l=this.pos)==null?void 0:l.times,r=(h=this.rot)==null?void 0:h.times,o=(u=this.scale)==null?void 0:u.times,a=[];if(t&&s)for(const d of s)a.push(d);if(e&&r)for(const d of r)a.push(d);if(i&&o)for(const d of o)a.push(d);return a.includes(0)||a.push(0),a.sort((d,f)=>d-f),[...new Set(a)]}*getValues(t,e=!0,i=!0,s=!0){var f,p,g;const r=new C,o=new ne,a=new C(1,1,1),l=this.target,h=e?(f=this.pos)==null?void 0:f.createInterpolant():void 0,u=i?(p=this.rot)==null?void 0:p.createInterpolant():void 0,d=s?(g=this.scale)==null?void 0:g.createInterpolant():void 0;h||r.set(l.position.x,l.position.y,l.position.z),u||o.set(l.quaternion.x,l.quaternion.y,l.quaternion.z,l.quaternion.w),d||a.set(l.scale.x,l.scale.y,l.scale.z);for(let m=0;m<t.length;m++){const v=t[m];if(h){const y=h.evaluate(v);r.set(y[0],y[1],y[2])}if(u){const y=u.evaluate(v);o.set(y[0],y[1],y[2],y[3])}if(d){const y=d.evaluate(v);a.set(y[0],y[1],y[2])}if(this.useRootMotion&&l===this.root){const y=new ce;y.compose(r,o,a),y.multiply(l.matrix),y.decompose(r,o,a)}yield{time:v,translation:r,rotation:o,scale:a,index:m}}}};let Yi=BS;c(Yi,"animationDurationPadding",1/60),c(Yi,"restPoseClipDuration",1/60);class Hy{constructor(t){c(this,"dict",new Map);c(this,"rootTargetMap",new Map);c(this,"rootAndClipToRegisteredAnimationMap",new Map);c(this,"rootToRegisteredClip",new Map);c(this,"serializers",[]);c(this,"injectRestPoses",!1);c(this,"injectImplicitBehaviours",!1);this.injectRestPoses=t,this.injectImplicitBehaviours=t}get extensionName(){return"animation"}getStartTimeCode(){return!this.injectRestPoses||this.rootAndClipToRegisteredAnimationMap.size===0?0:(Yi.restPoseClipDuration+Yi.animationDurationPadding)*60}getEndTimeCode(){let t=0;for(const[e,i]of this.rootAndClipToRegisteredAnimationMap){const s=i.start+i.duration;s>t&&(t=s)}return t*60}getClipCount(t){var i;return((i=this.rootToRegisteredClip.get(t))==null?void 0:i.length)??0??0}getStartTime01(t,e){if(!e)return 0;const i=this.rootTargetMap.get(t);if(!i)return 0;const s=this.dict.get(i[0]);if(!s)return console.error("Trying to get start time for root that has no animation data",t,e,...this.dict),0;let r=0;for(let o=0;o<s.length&&s[o].clip!==e;o++)r+=s[o].getDuration()+Yi.animationDurationPadding;return r}registerAnimation(t,e){var h;if(!t)return null;this.rootTargetMap.has(t)||this.rootTargetMap.set(t,[]);const i=t.uuid+((e==null?void 0:e.uuid)??"-rest");if(this.rootAndClipToRegisteredAnimationMap.has(i))return this.rootAndClipToRegisteredAnimationMap.get(i);pa&&console.log("registerAnimation",t,e);const s=this.injectRestPoses?1:0,r=(((h=this.rootToRegisteredClip.get(t))==null?void 0:h.length)??0)+s,o=this.rootTargetMap.get(t),a=new Set(o);if(e&&e.tracks)for(const u of e.tracks){const d=vr.parseTrackName(u.name),f=vr.findNode(t,d.nodeName);if(!f){console.warn("no object found for track",u.name,"using "+t.name+" instead");continue}this.dict.has(f)||this.dict.set(f,[]);const p=this.dict.get(f);if(!p){console.warn("no transform data found for target ",f,"at slot "+r+", this is likely a bug");continue}a.delete(f),this.injectRestPoses&&!p[0]&&(p[0]=new Yi(null,f,null));let g=p[r];g||(g=new Yi(t,f,e),p[r]=g),g.addTrack(u),o!=null&&o.includes(f)||o==null||o.push(f)}pa&&console.log("Unregistered nodes for this clip",a,"clip",e,"at slot",r,"for root",t,"targets",o);for(const u of a){const d=this.dict.get(u);if(!d)continue;if(this.injectRestPoses&&!d[0]){console.warn("Adding rest pose for ",u,e,"at slot",r,"This is likely a bug, should have been added earlier.");const p=new Yi(null,u,null);d[0]=p}let f=d[r];f||(pa&&console.log("Adding padding clip for ",u,e,"at slot",r),f=new Yi(t,u,e),d[r]=f)}const l=new RC(this,t,e);if(this.rootAndClipToRegisteredAnimationMap.set(i,l),pa&&console.log({root:t,clip:e,info:l}),e){const u=this.rootToRegisteredClip.get(t);u?u.push(e):this.rootToRegisteredClip.set(t,[e])}return l}onAfterHierarchy(t){pa&&console.log("Animation clips per animation target node",this.dict)}onAfterBuildDocument(t){var e,i;pa&&console.log("Animation data",{dict:this.dict,rootTargetMap:this.rootTargetMap,rootToRegisteredClip:this.rootToRegisteredClip});for(const s of this.rootTargetMap.keys()){const r=this.rootTargetMap.get(s);if(!r)continue;let o;const a=[];for(const l of r){const h=this.dict.get(l);if(!h){console.error("No data found for target on USDZ export â€“ please report a bug!",l);continue}o===void 0&&(o=h==null?void 0:h.length),o!==(h==null?void 0:h.length)&&console.error("Different array lengths for targets â€“ please report a bug!",h);for(let u=0;u<h.length;u++){let d=h[u];if(!d){const p=u-(this.injectRestPoses?1:0);h[u]=new Yi(null,l,this.rootToRegisteredClip.get(s)[p]),d=h[u]}const f=d.getDuration();if(a[u]===void 0)a[u]=f;else if(a[u]!==f){console.error("Error during UDSZ export: Encountered different animation durations for animated targets. Please report a bug!",{datas:h,target:l}),a[u]=f;continue}}}}for(const s of this.serializers){const r=(e=s.model)==null?void 0:e.parent,o=(r==null?void 0:r.isDynamic)===!0;Dw&&console.log(o,(i=s.model)==null?void 0:i.parent),o&&s.registerCallback(r)}}onExportObject(t,e,i){z.foreachComponent(t,r=>{const o=r;typeof o.createAnimation=="function"&&o.createAnimation(this,e,i)},!1);const s=new j5(t,this.dict);this.serializers.push(s),s.registerCallback(e)}}class j5{constructor(t,e){c(this,"object");c(this,"dict");c(this,"model");c(this,"callback");this.object=t,this.dict=e}registerCallback(t){this.model&&this.callback&&this.model.removeEventListener("serialize",this.callback),this.callback||(this.callback=this.onSerialize.bind(this)),Dw&&console.log("REPARENT",t),this.model=t,this.callback&&this.model.addEventListener("serialize",this.callback)}skinnedMeshExport(t,e){var r;const i=this.model,s=this.dict;if(i&&i.skinnedMesh){let d=function(B){const Q=[];for(const[G,V]of B){let X=`${G} : [`;const k=[];for(const M of V)k.push(`(${an(M.x)}, ${an(M.y)}, ${an(M.z)})`);X=X.concat(k.join(", ")),X=X.concat("],"),Q.push(X)}return Q},f=function(B){const Q=[];for(const[G,V]of B){let X=`${G} : [`;const k=[];for(const M of V)k.push(`(${an(M.w)}, ${an(M.x)}, ${an(M.y)}, ${an(M.z)})`);X=X.concat(k.join(", ")),X=X.concat("],"),Q.push(X)}return Q},p=function(B){let Q,G=!0;const V=new Map;for(const[k,M]of B){Q===void 0&&(Q=M.length),Q!==M.length&&(G=!1);let H=0;for(const ee of M)H++,ee||(V.has(k)||V.set(k,[]),V.get(k).push(H))}pa&&console.log("Bone count: ",B.size,"TransformData entries per bone: ",Q,"Undefined bone entries: ",V),console.assert(G,"All bones should have the same number of TransformData entries",B),console.assert(V.size===0,"All TransformData entries should be set",V);const X=[];for(const[k,M]of B){const H=new Array;let ee=0;for(let Y=0;Y<M.length;Y++)H.push(ee),ee+=M[Y].getDuration()+Yi.animationDurationPadding;for(let Y=0;Y<M.length;Y++){const he=M[Y],de=H[Y];X.length<=Y&&X.push({pos:[],rot:[],scale:[],timeOffset:de});const ve=X[Y];ve.pos.push(...he.getSortedTimesArray(!0,!1,!1)),ve.rot.push(...he.getSortedTimesArray(!1,!0,!1)),ve.scale.push(...he.getSortedTimesArray(!1,!1,!0))}}for(const k of X)k.pos.sort((M,H)=>M-H),k.rot.sort((M,H)=>M-H),k.scale.sort((M,H)=>M-H),k.pos=[...new Set(k.pos)],k.rot=[...new Set(k.rot)],k.scale=[...new Set(k.scale)];return X},g=function(B,Q,G){const V=new Map,X=new Map,k=new Map,M=Q.length;for(const H of G){const ee=B.get(H);let Y;ee?console.assert(ee.length===M,"We should have the same number of TransformData entries for each bone",ee,Q):Y=new Yi(null,H,null);for(let he=0;he<M;he++){const de=ee?ee[he]:Y,ve=Q[he];for(const{time:_e,translation:Ge}of de.getValues(ve.pos,!0,!1,!1)){const We=(_e+ve.timeOffset)*60;V.has(We)||V.set(We,new Array),V.get(We).push(Ge.clone())}for(const{time:_e,rotation:Ge}of de.getValues(ve.rot,!1,!0,!1)){const We=(_e+ve.timeOffset)*60;X.has(We)||X.set(We,new Array),X.get(We).push(Ge.clone())}for(const{time:_e,scale:Ge}of de.getValues(ve.scale,!1,!1,!0)){const We=(_e+ve.timeOffset)*60;k.has(We)||k.set(We,new Array),k.get(We).push(Ge.clone())}}}return{position:V.size==0?void 0:V,quaternion:X.size==0?void 0:X,scale:k.size==0?void 0:k}},m=function(B){const Q=[];for(const G of B)Q.push(`(${an(G.x)}, ${an(G.y)}, ${an(G.z)})`);return Q.join(", ")},v=function(B){const Q=[];for(const G of B)Q.push(`(${an(G.w)}, ${an(G.x)}, ${an(G.y)}, ${an(G.z)})`);return Q.join(", ")},y=function(B){const Q=new Map;if(pa){const G=new Array;for(const[V,X]of s)G.push(V.uuid+": "+X.length+" "+X.map(k=>{var M;return(M=k.clip)==null?void 0:M.uuid.substring(0,6)}).join(" "));console.log(`getPerBoneTransformData
`+G.join(`
`))}for(const G of B){const V=s.get(G);V&&Q.set(G,V)}return Q},b=function(B){const Q=y(B),G=p(Q);return g(Q,G,B)};const o=i.skinnedMesh.skeleton,a=new Array,l=[],h=[];for(const B of o.bones)if(B.parent.type!=="Bone"){l.push(B);const Q=o.boneInverses[o.bones.indexOf(B)];a.push({bone:B,inverse:Q}),h.push(B.uuid)}for(;h.length<o.bones.length;)for(const B of l){const Q=B.children;for(const G of Q)if(h.indexOf(G.uuid)===-1&&o.bones.indexOf(G)!==-1){l.push(G);const V=o.boneInverses[o.bones.indexOf(G)];a.push({bone:G,inverse:V}),h.push(G.uuid)}}for(const B of $P(o.bones))a.push({bone:B,inverse:B.matrixWorld.clone().invert()});const u=a[0].bone.parent;u||console.error("No bone parent found for skinned mesh during USDZ export",i.skinnedMesh),a.sort((B,Q)=>yd(B.bone,u)>yd(Q.bone,u)?1:-1);const _=e.quickLookCompatible,x=[],S=[],T=[],L=[];for(const{bone:B}of a){if(_){const Q=B.scale;Q.x==0&&(Q.x=1e-5),Q.y==0&&(Q.y=1e-5),Q.z==0&&(Q.z=1e-5),x.push(new ce().compose(B.position,B.quaternion,B.scale))}else x.push(B.matrix.clone());S.push(B.position),T.push(B.quaternion),L.push(B.scale)}const I=a.map(B=>'"'+yd(B.bone,u)+'"').join(", "),P=a.map(B=>Hu(B.inverse.clone().invert())).join(", ");t.beginBlock('def Skeleton "Rig"'),t.appendLine(`uniform matrix4d[] bindTransforms = [${P}]`),t.appendLine(`uniform token[] joints = [${I}]`),t.appendLine('uniform token purpose = "guide"'),t.appendLine(`uniform matrix4d[] restTransforms = [${x.map(B=>Hu(B)).join(", ")}]`),t.appendLine(`matrix4d xformOp:transform = ${Hu(new ce)}`),t.appendLine('uniform token[] xformOpOrder = ["xformOp:transform"]');const R=b(a.map(B=>B.bone));if(pa){let B=1e7,Q=0;for(const G of((r=R.position)==null?void 0:r.keys())??[])B=Math.min(B,G),Q=Math.max(Q,G);console.log("Time samples",B,Q,R)}if(t.beginBlock('def SkelAnimation "_anim"'),t.appendLine(`uniform token[] joints = [${I}]`),t.appendLine(`quatf[] rotations = [${v(T)}]`),R&&R.quaternion){t.beginBlock("quatf[] rotations.timeSamples = {","");const B=f(R.quaternion);for(const Q of B)t.appendLine(Q);t.closeBlock()}if(t.appendLine(`half3[] scales = [${m(L)}]`),R&&R.scale){t.beginBlock("half3[] scales.timeSamples = {","");const B=d(R.scale);for(const Q of B)t.appendLine(Q);t.closeBlock()}if(t.appendLine(`float3[] translations = [${m(S)}]`),R&&R.position){t.beginBlock("float3[] translations.timeSamples = {","");const B=d(R.position);for(const Q of B)t.appendLine(Q);t.closeBlock()}t.closeBlock(),t.closeBlock()}}onSerialize(t,e){var u;if(!this.model)return;const i=this.dict.get(this.object);if(i)for(let d=0;d<i.length;d++)i[d]===void 0&&(i[d]=new Yi(null,this.object,null));this.skinnedMeshExport(t,e);const s=this.object,r=this.dict.get(s);if(!r||s.isSkinnedMesh)return;Dw&&console.log("SERIALIZE",this.model.name,this.object.type,r);const o=new ce;t.appendLine("matrix4d xformOp:transform.timeSamples = {"),t.indent++;const a=new Array;let l=0;for(let d=0;d<r.length;d++){if(a.push(l),r[d]===void 0){console.error("Got an undefined transform data, this is likely a bug.",s,r);continue}l+=r[d].getDuration()+Yi.animationDurationPadding}const h=Intl.NumberFormat("en-US",{maximumFractionDigits:3,minimumFractionDigits:0,useGrouping:!1});for(let d=0;d<r.length;d++){const f=r[d];if(!f)continue;const p=a[d];{const g=f.getSortedTimesArray();if(!g||g.length===0){console.error("got an animated object but no time values?",s,f);continue}{const m=((u=f.clip)==null?void 0:u.name)??"rest",v=f.getDuration();pa&&console.log("Write .timeSamples:",m,p,v,r),t.appendLine("# "+m+": start="+h.format(p*f.frameRate)+", length="+h.format(v*f.frameRate)+", frames="+f.getFrames())}for(const{time:m,translation:v,rotation:y,scale:b}of f.getValues(g)){o.compose(v,y,b);const x=`${h.format((p+m)*f.frameRate)}: ${Hu(o)},`;t.appendLine(x)}}}t.indent--,t.appendLine("}")}}var ok=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};const LI=N("debugpost");class je{constructor(t){c(this,"_active",!0);c(this,"_value");c(this,"_valueRaw");c(this,"_defaultValue");c(this,"valueProcessor");c(this,"onValueChanged");this._value=t,this._defaultValue=t,this._valueRaw=t}get overrideState(){return this._active}set overrideState(t){if(this._active===t)return;this._active=t;const e=t?this._valueRaw:this._defaultValue;this.processValue(e,!0)}get value(){return this._valueRaw}set value(t){this.processValue(t,!1)}set defaultValue(t){this._defaultValue=t}__init(){this.processValue(this._valueRaw,!0)}processValue(t,e){if(t==null||!e&&this.testIfValueChanged(t)===!1)return;const i=this._value;if(LI){let s=!0;if(typeof i=="number"&&typeof t=="number"){const r=i==null?void 0:i.toFixed(4),o=t==null?void 0:t.toFixed(4);r!=o?s=!0:s=!1}s&&console.log("VolumeParameter: value changed from",i,"to",t)}!this._active&&this._defaultValue!==void 0?(this._value=this._defaultValue,t=this._defaultValue,this._valueRaw=t):(this._valueRaw=t,this._active&&this.valueProcessor&&(t=this.valueProcessor(t)),this._value=t),this.onValueChanged?this.onValueChanged(t,i,this):LI&&console.log("VolumeParameter: onValueChanged not set")}testIfValueChanged(t){return this._valueRaw!==t}}ok([A()],je.prototype,"overrideState",null);ok([A()],je.prototype,"value",null);var G5=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};const H5=N("debugpost");class Ds extends se{constructor(e=void 0){super();c(this,"active",!0);c(this,"_result");c(this,"_didCreateVolumeParameters",!1);if(e){this.ensureVolumeParameters();for(const i of Object.keys(e)){const s=e[i],r=this[i];r instanceof je&&(r.value=s)}}}onEnable(){this.__internalDidAwakeAndStart&&(this.active=!0)}onDisable(){this.active=!1}init(){}apply(){var e;return this.ensureVolumeParameters(),this._result||(this._result=(e=this.onCreateEffect)==null?void 0:e.call(this)),this._result&&this.initParameters(),this._result}unapply(){}dispose(){H5&&console.warn("DISPOSE",this),this._result&&(Array.isArray(this._result)?this._result.forEach(e=>e.dispose()):this._result.dispose()),this._result=void 0}initParameters(){const e=Object.keys(this);for(const i of e){const s=this[i];s instanceof je&&s.__init()}}onAfterDeserialize(e,i){if(typeof e=="object"){const s=this.$serializedTypes;if(s){for(const r of Object.keys(s))if(s[r]===je){const a=e[r];if(a!==void 0){const l=this[r];l.value=a}}}}}onEditorModification(e){const i=e.propertyName;if(this[i]instanceof je){const s=e.value;return this[i].value=s,!0}}ensureVolumeParameters(){if(this._didCreateVolumeParameters)return;this._didCreateVolumeParameters=!0;const e=this.$serializedTypes;if(e)for(const i of Object.keys(e))e[i]===je&&(this[i]||(this[i]=new je))}}G5([A()],Ds.prototype,"active",void 0);var V5=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};const W5=N("debugpost"),kw={};function zo(n,t){kw[n]=t}function q5(n){return n.__type in kw?kw[n.__type]:(W5&&n.__type&&console.warn("Unknown postprocessing type",n.__type,n),Ds)}class Vy{constructor(){c(this,"components",[])}init(){var t;(t=this.components)==null||t.forEach(e=>e.init())}}V5([kg([n=>q5(n),Ds])],Vy.prototype,"components",void 0);var X5=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r},FI;(function(n){n[n.LOW=0]="LOW",n[n.MEDIUM=1]="MEDIUM",n[n.HIGH=2]="HIGH",n[n.ULTRA=3]="ULTRA"})(FI||(FI={}));class Wy extends Ds{constructor(){super(...arguments);c(this,"preset")}get typeName(){return"Antialiasing"}onCreateEffect(){const e=new MM({preset:Ou.HIGH,edgeDetectionMode:sC.DEPTH});return this.preset.onValueChanged=i=>{e.applyPreset(i)},e}}X5([A(je)],Wy.prototype,"preset",void 0);zo("Antialiasing",Wy);const Y5=N("debugusdz");class Zh{constructor(){c(this,"files",new Array)}static getName(t){var r;const e=t.split(".").pop();let s=(r=t.split(".").slice(0,-1).join(".").split("/").pop())==null?void 0:r.replace(".","_");return s||(s="Audio_"+Math.random().toString(36).substring(2,15)),Fa(s)+"."+e}get extensionName(){return"Audio"}onExportObject(t,e,i){const s=z.getComponents(t,kt);if(s.length)for(const r of s){if(!r.clip||typeof r.clip!="string"||!r.playOnAwake)continue;const o=r.clip.split("/").pop()||"Audio",a=Zh.getName(r.clip),l=Fa(a);if(!this.files.some(h=>h.path===r.clip)){this.files.push({path:r.clip,name:a});const h=a.toLowerCase();i.quickLookCompatible&&!h.endsWith(".mp3")&&!h.endsWith(".wav")&&!h.endsWith(".m4a")&&console.error("Audio file "+r.clip+" from "+r.name+" is not an MP3 or WAV file. QuickLook may not support playing it.")}i.quickLookCompatible||e.addEventListener("serialize",(h,u)=>{h.appendLine(),h.beginBlock(`def SpatialAudio "${l}"`,"(",!1),h.appendLine(`displayName = "${o}"`),h.closeBlock(")"),h.beginBlock(),h.appendLine(`uniform asset filePath = @audio/${a}@`),h.appendLine(`uniform token auralMode = "${r.spatialBlend>0?"spatial":"nonSpatial"}"`),h.appendLine(`uniform token playbackMode = "${r.loop?"loopFromStage":"onceFromStart"}"`),h.appendLine(`uniform float gain = ${r.volume}`),h.closeBlock()})}}async onAfterSerialize(t){for(const e of this.files){const i="audio/"+e.name;if(t.files[i]){Y5&&console.warn("Audio file with name "+i+" already exists in the context. Skipping.");continue}const o=await(await(await fetch(e.path)).blob()).arrayBuffer(),a=new Uint8Array(o);t.files[i]=a}}}const mh=N("debugautosync"),Nb=Symbol("syncerId");class K5{constructor(){c(this,"_syncers",{})}getOrCreateSyncer(t){if(!t.guid)return null;if(this._syncers[t.guid])return this._syncers[t.guid];const e=new J5(t);return e[Nb]=t.guid,this._syncers[e[Nb]]=e,e}removeSyncer(t){delete this._syncers[t[Nb]]}}const BC=new K5;class J5{constructor(t){c(this,"comp");c(this,"hasChanges",!1);c(this,"changedProperties",{});c(this,"data",{});c(this,"_isReceiving",!1);c(this,"_isInit",!1);c(this,"onHandleSending",()=>{if(!this.hasChanges)return;this.hasChanges=!1;const t=this.comp.context.connection;if(!t||!t.isConnected||!t.isInRoom){for(const e in this.changedProperties)delete this.changedProperties[e];return}for(const e in this.data)delete this.data[e];this.data.guid=this.comp.guid;for(const e in this.changedProperties){const i=this.changedProperties[e];delete this.changedProperties[e],this.data[e]=i}t.send(this.networkingKey,this.data,jr.Queued)});c(this,"onHandleReceiving",t=>{if(mh&&console.log("RECEIVE",this.comp.name,this.comp.guid,t),!this._isInit||!this.comp)return;const e=t.guid;if(!(e&&e!==this.comp.guid)){mh&&console.log("RECEIVED",this.comp.name,this.comp.guid,t);try{this._isReceiving=!0;for(const i in t){if(i==="guid")continue;const s=t[i];this.comp[i]=s,mh&&console.log("SET",i,s)}}catch(i){console.error(i)}finally{this._isReceiving=!1}}});this.comp=t}get networkingKey(){return this.comp.guid}init(t){if(this._isInit)return;this._isInit=!0,this.comp=t,this.comp.context.post_render_callbacks.push(this.onHandleSending),this.comp.context.connection.beginListen(this.networkingKey,this.onHandleReceiving);const e=this.comp.context.connection.tryGetState(this.comp.guid);e&&this.onHandleReceiving(e)}destroy(){this._isInit&&(this.comp.context.post_render_callbacks.splice(this.comp.context.post_render_callbacks.indexOf(this.onHandleSending),1),this.comp.context.connection.stopListen(this.networkingKey,this.onHandleReceiving),this.comp=null,this._isInit=!1)}notifyChanged(t,e){this._isReceiving||(mh&&console.log("Property changed: "+t,e),this.hasChanges=!0,this.changedProperties[t]=e)}}function Z5(n,t){let e=t!==n;return!e&&n&&t&&(Array.isArray(n)&&Array.isArray(t)||typeof n=="object"&&typeof t=="object")&&(e=!0),e}const Rp=Symbol("AutoSyncHandler");function $5(n){if(n[Rp])return n[Rp];const t=BC.getOrCreateSyncer(n);return t==null||t.init(n),n[Rp]=t,t}function eH(n){const t=n[Rp];t&&(BC.removeSyncer(t),t.destroy(),delete n[Rp])}const ak=function(n){return function(t,e){var u;let i="";typeof e=="string"?i=e:i=e.name;let s=null,r;typeof n=="string"?r=t[n]:typeof n=="function"&&(r=n);const o=t,a=o.__internalAwake;if(typeof a!="function"){(mh||xe())&&console.error('@syncField can currently only used on Needle Engine Components, custom object of type "'+((u=t==null?void 0:t.constructor)==null?void 0:u.name)+'" is not supported',t);return}mh&&console.log(i);const l=Symbol(i);o.__internalAwake=function(){if(this[l]!==void 0)return;this[l]=this[i],s=BC.getOrCreateSyncer(this);const d=Object.getOwnPropertyDescriptor(this,i);if((d==null?void 0:d.set)===void 0){let f=!1;Object.defineProperty(this,i,{set:function(p){var m;const g=this[l];if(this[l]=p,f){xe()&&console.warn("Recursive call detected",i);return}f=!0;try{const v=Z5(p,g);mh&&console.log("SyncField assignment",i,"changed?",v,p),v&&(r==null?void 0:r.call(this,p,g))!==!1&&((m=$5(this))==null||m.notifyChanged(i,p))}finally{f=!1}},get:function(){return this[l]},configurable:!0,enumerable:!0})}s==null||s.init(this),a.call(this)};const h=o.__internalDestroy;o.__internalDestroy=function(){eH(this),h.call(this)}}};var qy=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};const lr=N("debugplayersync");class Hg extends se{constructor(){super(...arguments);c(this,"autoSync",!0);c(this,"asset");c(this,"onPlayerSpawned");c(this,"_localInstance");c(this,"onJoinedRoom",()=>{lr&&console.log("PlayerSync.joinedRoom. autoSync is set to "+this.autoSync),this.autoSync&&this.getInstance()})}awake(){this.watchTabVisible(),this.onPlayerSpawned||(this.onPlayerSpawned=new dn)}onEnable(){this.context.connection.beginListen(Ye.RoomStateSent,this.onJoinedRoom),this.context.connection.beginListen(Ye.JoinedRoom,this.onJoinedRoom),this.context.connection.isInRoom&&this.onJoinedRoom()}onDisable(){this.context.connection.stopListen(Ye.RoomStateSent,this.onJoinedRoom),this.context.connection.stopListen(Ye.JoinedRoom,this.onJoinedRoom)}async getInstance(){var i,s,r,o,a,l;if(this._localInstance)return this._localInstance;if(lr&&console.log("PlayerSync.createInstance",(i=this.asset)==null?void 0:i.uri),!((s=this.asset)!=null&&s.asset)&&!((r=this.asset)!=null&&r.uri))return console.error('PlayerSync: can not create an instance because "asset" is not set!'),null;this._localInstance=(o=this.asset)==null?void 0:o.instantiateSynced({parent:this.gameObject},!0);const e=await this._localInstance;if(e){const h=z.getComponent(e,ns);h?(h.owner=this.context.connection.connectionId,(a=this.onPlayerSpawned)==null||a.invoke(e)):(this._localInstance=void 0,console.error("<strong>Failed finding PlayerState on "+((l=this.asset)==null?void 0:l.uri)+"</strong>: please make sure the asset has a PlayerState component!"),z.destroySynced(e))}else this._localInstance=void 0,console.warn("PlayerSync: failed instantiating asset!");return this._localInstance}destroyInstance(){var e;(e=this._localInstance)==null||e.then(i=>(lr&&console.log("PlayerSync.destroyInstance",i),z.destroySynced(i))),this._localInstance=void 0}watchTabVisible(){window.addEventListener("visibilitychange",e=>{if(document.visibilityState==="visible")for(let i=ns.all.length-1;i>=0;i--){const s=ns.all[i];(!s.owner||!this.context.connection.userIsInRoom(s.owner))&&s.doDestroy()}})}}qy([A()],Hg.prototype,"autoSync",void 0);qy([A(it)],Hg.prototype,"asset",void 0);qy([A(dn)],Hg.prototype,"onPlayerSpawned",void 0);var Ow;(function(n){n.OwnerChanged="ownerChanged"})(Ow||(Ow={}));const on=class extends se{constructor(){super(...arguments);c(this,"onOwnerChangeEvent",new dn);c(this,"onFirstOwnerChangeEvent",new dn);c(this,"hasOwner",!1);c(this,"owner");c(this,"dontDestroy",!1);c(this,"onUserLeftRoom",e=>{if(e.userId===this.owner){lr&&console.log("PLAYERSYNC LEFT",this.owner),this.doDestroy();return}})}static get all(){return on._all}static get local(){return on._local}static getFor(e){if(e instanceof re)return z.getComponentInParent(e,on);if(e instanceof se)return z.getComponentInParent(e.gameObject,on)}static isLocalPlayer(e){const i=on.getFor(e);return(i==null?void 0:i.isLocalPlayer)??!1}static addEventListener(e,i){return this._callbacks[e]||(this._callbacks[e]=[]),this._callbacks[e].push(i),i}static removeEventListener(e,i){if(!this._callbacks[e])return;const s=this._callbacks[e].indexOf(i);s>=0&&this._callbacks[e].splice(s,1)}static dispatchEvent(e,i){if(this._callbacks[e])for(const s of this._callbacks[e])s(i)}get isLocalPlayer(){return this.owner===this.context.connection.connectionId}onOwnerChange(e,i){var a,l;lr&&console.log("PlayerSync.onOwnerChange",this,"newOwner",e,"oldOwner",i);const s=on._local.indexOf(this);s>=0&&on._local.splice(s,1);const r={playerState:this,oldValue:i,newValue:e};if(this.hasOwner||(this.hasOwner=!0,(a=this.onFirstOwnerChangeEvent)==null||a.invoke(r)),(l=this.onOwnerChangeEvent)==null||l.invoke(r),this.owner===this.context.connection.connectionId){on._local.push(this);const h=new CustomEvent("local-owner-changed",{detail:r});this.dispatchEvent(h)}const o=new CustomEvent("owner-changed",{detail:r});this.dispatchEvent(o),on.dispatchEvent(Ow.OwnerChanged,o)}awake(){on.all.push(this),lr&&console.log("Registered new PlayerState",this.guid,on.all.length-1,on.all),this.context.connection.beginListen(Ye.UserLeftRoom,this.onUserLeftRoom)}async start(){lr&&console.log("PLAYERSTATE.START, owner: "+this.owner,this.context.connection.usersInRoom([])),this.owner?(this.context.connection.isInRoom||await El(300),this.context.connection.userIsInRoom(this.owner)==!1&&(lr&&console.log(`PlayerSync.start â†’ doDestroy "${this.name}" because user "${this.owner}" is not in room anymore...`,"Currently in room:",...this.context.connection.usersInRoom()),this.doDestroy())):this.owner||(lr&&console.warn("PlayerState.start â†’ owner is undefined!",this.name),setTimeout(()=>{!this.destroyed&&!this.owner?this.dontDestroy?lr&&console.warn("PlayerState.start â†’ owner is still undefined but dontDestroy is set to true",this.name):(lr&&console.warn(`PlayerState.start â†’ owner is still undefined: destroying "${this.name}" instance now`),this.doDestroy()):lr&&console.log("PlayerState.start â†’ owner is assigned",this.owner)},2e3))}doDestroy(){lr&&console.log("PlayerSync.doDestroy â†’ syncDestroy",this.name),AC(this.gameObject,this.context.connection)}onDestroy(){if(this.context.connection.stopListen(Ye.UserLeftRoom,this.onUserLeftRoom),on.all.splice(on.all.indexOf(this),1),this.isLocalPlayer){const e=on._local.indexOf(this);e>=0&&on._local.splice(e,1)}}};let ns=on;c(ns,"_all",[]),c(ns,"_local",[]),c(ns,"_callbacks",{});qy([ak(ns.prototype.onOwnerChange)],ns.prototype,"owner",void 0);const tH=N("debugavatar"),yo=class extends se{constructor(){super(...arguments);c(this,"connectionId");c(this,"avatar")}static getAvatar(e){return e>=0&&e<yo.instances.length?yo.instances[e]:null}static onAvatarMarkerCreated(e){return yo._onNewAvatarMarkerAdded.push(e),e}static onAvatarMarkerDestroyed(e){return yo._onAvatarMarkerDestroyed.push(e),e}awake(){yo.instances.push(this),tH&&console.log(this);for(const e of yo._onNewAvatarMarkerAdded)e({avatarMarker:this,gameObject:this.gameObject})}onDestroy(){yo.instances.splice(yo.instances.indexOf(this),1);for(const e of yo._onAvatarMarkerDestroyed)e({avatarMarker:this,gameObject:this.gameObject})}isLocalAvatar(){return this.connectionId===this.context.connection.connectionId}};let un=yo;c(un,"instances",[]),c(un,"_onNewAvatarMarkerAdded",[]),c(un,"_onAvatarMarkerDestroyed",[]);var iH=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};const Fu=N("debugxrflags"),lk=N("disablexrflags");lk&&console.warn("XRFlags are disabled");var Kr;(function(n){n[n.Never=0]="Never",n[n.Browser=1]="Browser",n[n.AR=2]="AR",n[n.VR=4]="VR",n[n.FirstPerson=8]="FirstPerson",n[n.ThirdPerson=16]="ThirdPerson",n[n.All=4294967295]="All"})(Kr||(Kr={}));const PS=class{constructor(){c(this,"Mask",Kr.Browser|Kr.ThirdPerson)}Has(t){return(this.Mask&t)!==0}Set(t){Fu&&console.warn("Set XR flag state to",t),this.Mask=t,Dn.Apply()}Enable(t){this.Mask|=t,Dn.Apply()}Disable(t){this.Mask&=~t,Dn.Apply()}Toggle(t){this.Mask^=t,Dn.Apply()}EnableAll(){this.Mask=-1,Dn.Apply()}DisableAll(){this.Mask=0,Dn.Apply()}};let ss=PS;c(ss,"Global",new PS);const ca=class extends se{constructor(){super(...arguments);c(this,"visibleIn")}static Apply(){for(const e of this.registry)e.UpdateVisible(ss.Global)}awake(){ca.registry.push(this)}onEnable(){ca.firstApply?this.UpdateVisible(ss.Global):(ca.firstApply=!0,ca.Apply())}onDestroy(){const e=ca.registry.indexOf(this);e>=0&&ca.registry.splice(e,1)}get isOn(){return this.gameObject.visible}UpdateVisible(e=null){if(lk)return;let i;const s=e;if(s&&typeof s=="number"&&(console.assert(typeof s=="number","XRFlag.UpdateVisible: state must be a number",s),Fu&&console.log(s),ca.buffer.Mask=s,e=ca.buffer),e instanceof ss?(Fu&&console.warn(this.name,"use passed in mask",e.Mask,this.visibleIn),i=e.Has(this.visibleIn)):(Fu&&console.log(this.name,"use global mask"),ss.Global.Has(this.visibleIn)),i!==void 0)if(i)Fu&&console.log(this.name,"is visible",this.gameObject.uuid),z.setActive(this.gameObject,!0);else{if(Fu&&console.log(this.name,"is not visible",this.gameObject.uuid),!this.gameObject.visible)return;this.gameObject.visible=!1}}};let Dn=ca;c(Dn,"registry",[]),c(Dn,"firstApply"),c(Dn,"buffer",new ss);iH([A()],Dn.prototype,"visibleIn",void 0);var PC=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};const Lf=N("debugwebxr"),UI=new ne().setFromAxisAngle(new C(0,1,0),Math.PI);class Yd extends se{constructor(){super(...arguments);c(this,"head");c(this,"leftHand");c(this,"rightHand");c(this,"_syncTransforms")}async onEnterXR(e){if(!this.activeAndEnabled)return;Lf&&console.warn("AVATAR ENTER XR",this.guid,this.sourceId,this,this.activeAndEnabled),this._syncTransforms&&(this._syncTransforms.length=0),await this.prepareAvatar();const i=ns.getFor(this);if(i!=null&&i.owner){const s=this.gameObject.addNewComponent(un);s.avatar=this.gameObject,s.connectionId=i.owner}else this.context.connection.isConnected?console.error("No player state found for avatar",this):i&&!this.context.connection.isConnected&&(i.dontDestroy=!0)}onLeaveXR(e){const i=this.gameObject.getComponent(un);i&&i.destroy()}onUpdateXR(e){var h,u;if(!this.activeAndEnabled)return;const i=ns.isLocalPlayer(this);if(!i)return;const s=e.xr;if(s.rig&&s.rig.gameObject!==this.gameObject.parent&&(this.gameObject.position.set(0,0,0),this.gameObject.rotation.set(0,0,0),this.gameObject.scale.set(1,1,1),s.rig.gameObject.add(this.gameObject)),this._syncTransforms&&i)for(const d of this._syncTransforms)d.fastMode=!0,d.isOwned()||d.requestOwnership();if(this.head&&this.context.mainCamera){const d=this.head.asset;if(d.position.copy(this.context.mainCamera.position),d.quaternion.copy(this.context.mainCamera.quaternion),d.quaternion.x*=-1,this.context.time.frameCount%10===0){const f=z.getComponentsInChildren(this.head.asset,Dn);for(const p of f)p.enabled=!1,p.gameObject.visible=!1}}const r=e.xr.leftController,o=(h=this.leftHand)==null?void 0:h.asset;r&&o?(o.position.copy(r.gripPosition),o.quaternion.copy(r.gripQuaternion),o.quaternion.multiply(UI),o.visible=r.isTracking):o&&o.visible&&(o.visible=!1);const a=e.xr.rightController,l=(u=this.rightHand)==null?void 0:u.asset;a&&l?(l.position.copy(a.gripPosition),l.quaternion.copy(a.gripQuaternion),l.quaternion.multiply(UI),l.visible=a.isTracking):l&&l.visible&&(l.visible=!1)}onBeforeRender(){this.context.time.frame%10===0&&this.updateRemoteAvatarVisibility()}updateRemoteAvatarVisibility(){var e,i,s;if(this.context.connection.isConnected){const r=ns.getFor(this);if(r&&r.isLocalPlayer==!1){const o=Me.getXRSync(this.context);if(o&&o.hasState(r.owner)){this.tryFindAvatarObjectsIfMissing();const a=(e=this.leftHand)==null?void 0:e.asset;a&&(a.visible=(o==null?void 0:o.isTracking(r.owner,"left"))??!1);const l=(i=this.rightHand)==null?void 0:i.asset;l&&(l.visible=(o==null?void 0:o.isTracking(r.owner,"right"))??!1)}if((s=this.head)!=null&&s.asset){const a=z.getComponentsInChildren(this.head.asset,Dn);for(const l of a)l.enabled=!1,l.gameObject.visible=!0}}}}tryFindAvatarObjectsIfMissing(){if(!this.head||!this.leftHand||!this.rightHand){const e={head:this.head,leftHand:this.leftHand,rightHand:this.rightHand};m6.tryFindAvatarObjects(this.gameObject,this.sourceId||"",e),e.head&&(this.head=e.head),e.leftHand&&(this.leftHand=e.leftHand),e.rightHand&&(this.rightHand=e.rightHand)}}async prepareAvatar(){if(this.tryFindAvatarObjectsIfMissing(),this.head)this.head instanceof re&&(this.head=new it("",this.sourceId,this.head));else{const e=new re;e.name="Head";const i=Py.createPrimitive(Da.Cube);e.add(i),this.gameObject.add(e),this.head=new it("",this.sourceId,e),Lf&&console.log("Create head",e)}if(this.rightHand)this.rightHand instanceof re&&(this.rightHand=new it("",this.sourceId,this.rightHand));else{const e=new re;e.name="Right Hand",this.gameObject.add(e),this.rightHand=new it("",this.sourceId,e),Lf&&console.log("Create right hand",e)}if(this.leftHand)this.leftHand instanceof re&&(this.leftHand=new it("",this.sourceId,this.leftHand));else{const e=new re;e.name="Left Hand",this.gameObject.add(e),this.leftHand=new it("",this.sourceId,e),Lf&&console.log("Create left hand",e)}await this.loadAvatarObjects(this.head,this.leftHand,this.rightHand),ns.isLocalPlayer(this.gameObject)&&(this._syncTransforms=z.getComponentsInChildren(this.gameObject,Qh))}async loadAvatarObjects(e,i,s){const r=e.loadAssetAsync(),o=i.loadAssetAsync(),a=s.loadAssetAsync(),l=new Array;r&&l.push(r),o&&l.push(o),a&&l.push(a);const h=await vx(l);Lf&&console.log("Avatar loaded results:",h)}}PC([A(it)],Yd.prototype,"head",void 0);PC([A(it)],Yd.prototype,"leftHand",void 0);PC([A(it)],Yd.prototype,"rightHand",void 0);class bl{static Add(t,e,i=null){if(e){for(const s of this.Pois)if(s.obj===e)return;this.Pois.push({obj:e,avatar:i}),this.LastChangeTime=t.time.time}}static Remove(t,e){var i;if(e){for(const s of this.Pois)if(s.obj===e){this.Pois.splice(this.Pois.indexOf(s),1),this.LastChangeTime=(t==null?void 0:t.time.time)??((i=Ne.Current)==null?void 0:i.time.time);return}}}}c(bl,"Pois",[]),c(bl,"LastChangeTime",0);var Rv;(function(n){n.TargetChanged="avatar-look-target-changed"})(Rv||(Rv={}));class nH{constructor(){c(this,"guid");c(this,"position",new C)}}class Bv extends se{constructor(){super(...arguments);c(this,"target",null);c(this,"avatar",null);c(this,"_model",null);c(this,"_targetModel",new nH);c(this,"_currentTargetObject",null);c(this,"_lastUpdateTime",0);c(this,"_lookDuration",0);c(this,"_lastPoiChangedTime",0)}set controlledTarget(e){this.target=e;const i=D.get("MoveRandom");if(i&&this.target){const s=z.getComponent(this.target,i);s&&s.destroy()}}awake(){if(this.avatar=z.getComponentInParent(this.gameObject,un),this.avatar){const e=z.getComponentInParent(this.gameObject,un);this._model=new UD(this.context.connection,this.guid),e!=null&&e.isLocalAvatar&&this._model.requestOwnership()}this.context.connection.beginListen(Rv.TargetChanged,e=>{var i;this.target&&e&&e.guid===((i=this.avatar)==null?void 0:i.guid)&&Ts(this.target,e.position)})}update(){var i;if((!this.context.connection.isConnected||(i=this._model)!=null&&i.hasOwnership)&&(bl.LastChangeTime!==this._lastPoiChangedTime&&(this._lastPoiChangedTime=bl.LastChangeTime,this._lookDuration=0),this.selectTarget(),this._currentTargetObject&&this.context.time.frameCount%10===0&&this.target)){const s=qe(this._currentTargetObject);Ts(this.target,s),this.context.connection.isConnected&&this.avatar&&(this.context.connection.send(Rv.TargetChanged,this._targetModel),this._targetModel.guid=this.avatar.guid,this._targetModel.position.copy(s))}}selectTarget(){if(this.context.time.time-this._lastUpdateTime>this._lookDuration){this._lastUpdateTime=this.context.time.time,this._lookDuration=Math.random()*.5+.2;const i=bl.Pois;if(i.length>0){const s=i[Math.floor(Math.random()*i.length)];if(s&&s.obj){if(s.avatar&&s.avatar===this.avatar)return;this._currentTargetObject=s.obj}}}}}const Ju=N("debugnetworkingstreams");var xi;(function(n){n.Connected="peer-user-connected",n.StreamReceived="receive-stream",n.StreamEnded="call-ended",n.Disconnected="peer-user-disconnected",n.UserJoined="user-joined"})(xi||(xi={}));class sH{constructor(t,e){c(this,"type",xi.StreamEnded);c(this,"userId");c(this,"direction");this.userId=t,this.direction=e}}class rH{constructor(t,e){c(this,"type",xi.StreamReceived);c(this,"stream");c(this,"target");this.stream=t,this.target=e}}class oH{constructor(t,e){c(this,"guid");c(this,"peerId");c(this,"dontSave",!0);this.guid=t.id,this.peerId=e}}var dc;(function(n){n.Incoming="incoming",n.Outgoing="outgoing"})(dc||(dc={}));class aH extends Ml{constructor(e,i,s){super();c(this,"userId");c(this,"direction");c(this,"call");c(this,"_stream",null);c(this,"_isDisposed",!1);this.userId=e,this.call=i,this.direction=s,this._stream=null,i.on("stream",r=>{if(Ju&&console.log("Receive video",r.getAudioTracks(),r.getVideoTracks()),this._stream=r,s===dc.Incoming){const o=new rH(r,this);this.dispatchEvent(o)}}),i.on("close",()=>{this.dispatchEvent(new sH(e,s))})}get stream(){return this._stream}close(){this._isDisposed||(this._isDisposed=!0,this.call.close(),_c(this._stream))}get isOpen(){var e;return((e=this.call.peerConnection)==null?void 0:e.connectionState)==="connected"}get isOpening(){var e;return((e=this.call.peerConnection)==null?void 0:e.connectionState)==="connecting"}get isClosed(){return!this.isOpen}}const cd=class extends Ml{constructor(e,i){super();c(this,"id");c(this,"context");c(this,"_peer");c(this,"_incomingCalls",[]);c(this,"_outgoingCalls",[]);c(this,"_enabled",!1);c(this,"_enabledPeer",!1);c(this,"onConnectRoomFn",this.onConnectRoom.bind(this));c(this,"onPeerConnectFn",this.onPeerConnect.bind(this));c(this,"onPeerReceiveCallFn",this.onPeerReceivingCall.bind(this));this.context=e,this.id=i,this.setupPeer(),navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia}static getOrCreate(e,i){if(cd.instances.has(i))return cd.instances.get(i);const s=new cd(e,i);return cd.instances.set(i,s),s}getMyPeerId(){if(this.context.connection.connectionId)return this.getPeerIdFromUserId(this.context.connection.connectionId)}getPeerIdFromUserId(e){return this.id+"-"+e}getUserIdFromPeerId(e){return e.substring(this.id.length+1)}makeCall(e,i){var o;const s={metadata:{userId:this.context.connection.connectionId}},r=(o=this._peer)==null?void 0:o.call(e,i,s);if(r)return this.registerCall(r,dc.Outgoing)}get peer(){return this._peer}enable(){this._enabled||(this._enabled=!0,this.context.connection.beginListen(Ye.JoinedRoom,this.onConnectRoomFn),this.subscribePeerEvents())}disable(){this._enabled&&(this._enabled=!1,this.context.connection.stopListen(Ye.JoinedRoom,this.onConnectRoomFn),this.unsubscribePeerEvents())}onConnectRoom(){this.setupPeer()}setupPeer(){if(this.context.connection.connectionId&&!this._enabledPeer){if(this._enabledPeer=!0,!this._peer){const e=this.getMyPeerId();e?this._peer=s6(e):console.error("Failed to setup peerjs because we dont have a connection id",this.context.connection.connectionId)}this._enabled&&this.subscribePeerEvents()}}subscribePeerEvents(){this._peer&&(this._peer.on("open",this.onPeerConnectFn),this._peer.on("call",this.onPeerReceiveCallFn))}unsubscribePeerEvents(){this._peer&&(this._peer.off("open",this.onPeerConnectFn),this._peer.off("call",this.onPeerReceiveCallFn))}onPeerConnect(e){Ju&&console.log("Peer connected as",e),this.context.connection.send(xi.Connected,new oH(this,e))}onPeerReceivingCall(e){e.answer(),this.registerCall(e,dc.Incoming)}registerCall(e,i){const s=e.metadata;(!s||!s.userId)&&console.error("Missing call metadata",e);const r=s.userId;i===dc.Incoming&&Ju?console.log("Receive call from",e.metadata):Ju&&console.log("Make call to",e.metadata);const o=i===dc.Incoming?this._incomingCalls:this._outgoingCalls,a=new aH(r,e,i);return o.push(a),e.on("error",l=>{console.error("Call error",l)}),e.on("close",()=>{Ju&&console.log("Call ended",e.metadata),e.close();const l=o.indexOf(a);l!==-1&&o.splice(l,1)}),a.addEventListener(xi.StreamEnded,l=>{this.dispatchEvent(l)}),i===dc.Incoming&&(a.addEventListener(xi.StreamReceived,l=>{this.dispatchEvent(l)}),e.on("stream",()=>{let l=0;const h=setInterval(()=>{const u=l===0;!a.isOpen&&u&&(l+=1,clearInterval(h),a.close())},2e3)})),a}};let Bp=cd;c(Bp,"instances",new Map);class Xy extends Ml{constructor(e,i){super();c(this,"context");c(this,"peer");c(this,"_sendingStreams",new Map);c(this,"debug",!1);c(this,"onJoinedRoom",e=>{this.debug&&console.log(`${e.userId} joined room and I'm currently sending ${this._sendingStreams.size} streams`),this._sendingStreams.size>0&&this.updateSendingCalls()});c(this,"onReceiveStream",e=>{this.debug&&console.log("RECEIVE STREAM",e),this.dispatchEvent({type:xi.StreamReceived,target:this,stream:e.stream,userId:e.userId})});c(this,"onCallEnded",e=>{this.dispatchEvent(e)});c(this,"onUserConnected",e=>{if(this.peer.id===e.guid){this.debug&&console.log("USER CONNECTED",e.guid,e);const i=this._sendingStreams.keys().next().value;this.peer.makeCall(e.peerId,i)}});c(this,"onUserLeft",e=>{this.stopCallsToUsersThatAreNotInTheRoomAnymore()});this.context=e,this.peer=i,Ju&&(this.debug=!0)}static create(e){const i=Bp.getOrCreate(e.context,e.context.connection.connectionId);return new Xy(e.context,i)}startSendingStream(e){this._sendingStreams.has(e)?console.warn("Received start sending stream with stream that is already being sent"):(this._sendingStreams.set(e,[]),this.updateSendingCalls())}stopSendingStream(e){if(e){const i=this._sendingStreams.get(e);if(i){this.debug&&console.log("Closing calls",i);for(const s of i)s.close()}this._sendingStreams.delete(e),i&&this.debug&&console.log("Currently sending",this._sendingStreams)}}enable(){this.peer.enable(),this.peer.addEventListener(xi.StreamReceived,this.onReceiveStream),this.peer.addEventListener(xi.StreamEnded,this.onCallEnded),this.context.connection.beginListen(xi.Connected,this.onUserConnected),this.context.connection.beginListen(Ye.JoinedRoom,this.onJoinedRoom),this.context.connection.beginListen(Ye.UserJoinedRoom,this.onJoinedRoom),this.context.connection.beginListen(Ye.UserLeftRoom,this.onUserLeft)}disable(){this.peer.disable(),this.peer.removeEventListener(xi.StreamReceived,this.onReceiveStream),this.peer.removeEventListener(xi.StreamEnded,this.onCallEnded),this.context.connection.stopListen(xi.Connected,this.onUserConnected),this.context.connection.stopListen(Ye.JoinedRoom,this.onJoinedRoom),this.context.connection.stopListen(Ye.UserJoinedRoom,this.onJoinedRoom),this.context.connection.stopListen(Ye.UserLeftRoom,this.onUserLeft)}updateSendingCalls(){var s;let e=!1;const i=this.context.connection.connectionId;for(const r of this._sendingStreams.keys()){const o=this._sendingStreams.get(r)||[];for(const a of this.context.connection.usersInRoom()){if(a===i)continue;const l=o.find(h=>h.userId===a);if(!l||((s=l.stream)==null?void 0:s.active)===!1){this.debug&&console.log("Starting call to",a,i);const h=this.peer.makeCall(this.peer.getPeerIdFromUserId(a),r);h&&(e=!0,o.push(h))}}this._sendingStreams.set(r,o)}this.stopCallsToUsersThatAreNotInTheRoomAnymore(),e&&this.debug&&console.log("Currently sending",this._sendingStreams)}stopCallsToUsersThatAreNotInTheRoomAnymore(){for(const e of this._sendingStreams.keys()){const i=this._sendingStreams.get(e);if(i)for(let s=i.length-1;s>=0;s--){const r=i[s];this.context.connection.userIsInRoom(r.userId)||(r.close(),i.splice(s,1))}}}}function _c(n){if(n&&n instanceof MediaStream)for(const t of n.getTracks())t.stop()}var ck=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};const lH="noVoip",cH=N("debugvoip");class Kd extends se{constructor(){super(...arguments);c(this,"autoConnect",!1);c(this,"runInBackground",!0);c(this,"debug",!1);c(this,"_net");c(this,"_outputStream",null);c(this,"onJoinedRoom",async()=>{await El(300),this.autoConnect&&!this.isSending&&this.connect()});c(this,"_incomingStreams",new Map);c(this,"onReceiveStream",e=>{const i=e.target.userId,s=e.stream,r=this._incomingStreams.get(i);if(r)r.srcObject=s,r.setAttribute("autoplay","true");else{const o=new Audio;this._incomingStreams.set(i,o),o.setAttribute("autoplay","true"),o.srcObject=s}});c(this,"onStreamEnded",e=>{const i=this._incomingStreams.get(e.userId);_c(i==null?void 0:i.srcObject),this._incomingStreams.delete(e.userId)});c(this,"onEnabledChanged",()=>{for(const e of this._incomingStreams){const i=e[1];i.muted=!this.enabled}});c(this,"onVisibilityChanged",()=>{if(this.runInBackground)return;const i=!(document.visibilityState==="visible");this.setMuted(i);for(const s of this._incomingStreams){const r=s[1];r.muted=i}})}awake(){cH&&(this.debug=!0),this.debug&&window.addEventListener("keydown",async e=>{e.key==="v"&&(console.log("MUTE?",!this.isMuted),this.setMuted(!this.isMuted))})}onEnable(){this._net||(this._net=Xy.create(this)),this._net.addEventListener(xi.StreamReceived,this.onReceiveStream),this._net.addEventListener(xi.StreamEnded,this.onStreamEnded),this._net.enable(),this.autoConnect&&(this.context.connection.isConnected?this.connect():this.context.connection.beginListen(Ye.JoinedRoom,this.onJoinedRoom)),this.onEnabledChanged(),window.addEventListener("visibilitychange",this.onVisibilityChanged)}onDisable(){var e;this._net.stopSendingStream(this._outputStream),this._net.removeEventListener(xi.StreamReceived,this.onReceiveStream),this._net.removeEventListener(xi.StreamEnded,this.onStreamEnded),(e=this._net)==null||e.disable(),this.context.connection.stopListen(Ye.JoinedRoom,this.onJoinedRoom),this.onEnabledChanged(),window.removeEventListener("visibilitychange",this.onVisibilityChanged)}get isSending(){return this._outputStream!=null&&this._outputStream.active}async connect(e){if(this.context.connection.isConnected){if(!await JS())return console.error("Cannot connect to voice chat - microphone permissions not granted"),!1}else return console.error("Cannot connect to voice chat - not connected to server"),!1;return this._net.stopSendingStream(this._outputStream),_c(this._outputStream),this._outputStream=await this.getAudioStream(e),this._outputStream?(this._net.startSendingStream(this._outputStream),!0):(await JS()?console.error("VOIP: Could not get audio stream - please make sure to connect an audio device and grant microphone permissions"):pP("Microphone permissions not granted: Please grant microphone permissions to use voice chat"),!1)}disconnect(){this._net.stopSendingStream(this._outputStream),_c(this._outputStream),this._outputStream=null}setMuted(e){var s;const i=(s=this._outputStream)==null?void 0:s.getAudioTracks();if(i)for(const r of i)r.enabled=!e}get isMuted(){var i;if(this._outputStream===null)return!1;const e=(i=this._outputStream)==null?void 0:i.getAudioTracks();if(e){for(const s of e)if(!s.enabled)return!0}return!1}getFrequency(e){return this.unsupported_getfrequency||(this.unsupported_getfrequency=!0,xe()&&Yt("VOIP: getFrequency is currently not supported"),console.warn("VOIP: getFrequency is currently not supported")),null}async getAudioStream(e){return navigator.mediaDevices.getUserMedia?await navigator.mediaDevices.getUserMedia({audio:e??!0,video:!1}).catch(s=>(console.warn("VOIP failed getting audio stream",s),null)):(console.error("No getDisplayMedia support"),null)}}ck([A()],Kd.prototype,"autoConnect",void 0);ck([A()],Kd.prototype,"runInBackground",void 0);var hk=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};const hH=N("debugmouth");class Yy extends se{constructor(){super(...arguments);c(this,"idle",[]);c(this,"talking",[]);c(this,"marker",null);c(this,"voip",null);c(this,"lastMouthChangeTime",0);c(this,"mouthChangeLength",0)}awake(){setTimeout(()=>{this.voip=z.findObjectOfType(Kd,this.context),this.marker||(this.marker=z.getComponentInParent(this.gameObject,un))},3e3)}update(){var s;if(!this.voip||this.context.time.frameCount%10!==0)return;let e=((s=this.marker)==null?void 0:s.connectionId)??null;if(!e){hH&&(e=null);return}const i=this.voip.getFrequency(e)??0;this.updateLips(i)}updateLips(e){if(this.context.time.time-this.lastMouthChangeTime>this.mouthChangeLength){if(this.mouthChangeLength=.05+Math.random()*.1,this.talking&&this.talking.length>0&&e>30){this.lastMouthChangeTime=this.context.time.time;const i=Math.floor(Math.random()*this.talking.length);this.setMouthShapeActive(this.talking,i)}else if(this.idle.length>0&&this.context.time.time-this.lastMouthChangeTime>.5){this.lastMouthChangeTime=this.context.time.time;const i=Math.floor(Math.random()*this.idle.length);this.setMouthShapeActive(this.idle,i)}}}setMouthShapeActive(e,i){if(e){e!=this.idle?this.idle.map(s=>s.visible=!1):this.talking.map(s=>s.visible=!1);for(let s=0;s<e.length;s++){const r=e[s];r&&(r.visible=s===i)}}}}hk([A(re)],Yy.prototype,"idle",void 0);hk([A(re)],Yy.prototype,"talking",void 0);class uk extends se{constructor(){super(...arguments);c(this,"voip",null);c(this,"marker",null);c(this,"_startPosition",null)}awake(){this.voip=z.findObjectOfType(Kd,this.context),this.marker=z.getComponentInParent(this.gameObject,un)}update(){if(!this.voip||!this.marker||this.context.time.frameCount%10!==0)return;const e=this.marker.connectionId,i=this.voip.getFrequency(e);if(i==null)return;this._startPosition||(this._startPosition=this.gameObject.position.clone());const s=i/100;this.gameObject.position.y=this._startPosition.y+s*.07}}var Ky=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};class Jd extends se{constructor(){super(...arguments);c(this,"eyes",[]);c(this,"lastBlinkTime",0);c(this,"blinkLength",0);c(this,"eyesOpen",!0);c(this,"state",null)}awake(){this.state=z.getComponentInParent(this.gameObject,Dn)}update(){if(!this.gameObject||!this.gameObject.visible||!this.eyes||!Array.isArray(this.eyes)||this.eyes.length===0)return;if(this.context.time.time-this.lastBlinkTime>this.blinkLength){if(this.lastBlinkTime=this.context.time.time,this.state&&!this.state.isOn||!this.activeAndEnabled)return;if(this.eyesOpen=!this.eyesOpen,this.blinkLength=Math.random(),this.eyesOpen?(this.blinkLength*=3,this.blinkLength+=.5,Math.random()<.1&&(this.blinkLength=.1+Math.random()*.2)):(this.blinkLength*=Math.random()*.2,this.blinkLength+=.1),Math.random()<.1&&(this.blinkLength*=3),this.blinkLength=Math.max(.2,this.blinkLength),this.blinkLength=Math.min(3,this.blinkLength),this.eyes)for(const i of this.eyes)i&&(i.visible=this.eyesOpen)}}}Ky([A(re)],Jd.prototype,"eyes",void 0);Ky([A()],Jd.prototype,"lastBlinkTime",void 0);Ky([A()],Jd.prototype,"blinkLength",void 0);Ky([A()],Jd.prototype,"eyesOpen",void 0);var MC=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};const MS=class extends se{constructor(){super(...arguments);c(this,"head",null);c(this,"eyes",null);c(this,"target",null);c(this,"brain",null);c(this,"vec",new C);c(this,"currentTargetPoint",new C)}awake(){this.brain||(this.brain=z.getComponentInParent(this.gameObject,Bv)),this.brain||(console.log("No look at brain found, adding it now"),this.brain=z.addNewComponent(this.gameObject,Bv)),this.brain&&this.target&&(this.brain.controlledTarget=this.target)}update(){const e=this.target;if(e&&this.head){const i=this.eyes;if(i){const s=qe(e);this.currentTargetPoint.lerp(s,this.context.time.deltaTime/.1);const r=qe(this.head),o=this.vec.copy(this.currentTargetPoint).sub(r).normalize();if(o.length()<.1)return;const a=MS.forward;if(a.set(0,0,1),a.applyQuaternion(Nt(this.head)),a.dot(o)>.45)for(let h=0;h<i.length;h++)i[h].lookAt(this.currentTargetPoint)}}}};let Bc=MS;c(Bc,"forward",new C(0,0,1));MC([A(re)],Bc.prototype,"head",void 0);MC([A(re)],Bc.prototype,"eyes",void 0);MC([A(re)],Bc.prototype,"target",void 0);const Ff=N("debugavatar");class DC{constructor(t,e,i,s){c(this,"root");c(this,"head");c(this,"leftHand");c(this,"rigthHand");var r;this.root=t,this.head=e,this.leftHand=i,this.rigthHand=s,(r=this.root)==null||r.traverse(o=>o.layers.set(2))}get isValid(){return this.head!==null&&this.head!==void 0}}class dk{constructor(){c(this,"avatarRegistryUrl",null)}async getOrCreateNewAvatarInstance(t,e){if(!e)return console.error("Can not create avatar: failed to provide id or root object"),null;let i=null;if(typeof e=="string"){if(i=await this.loadAvatar(t,e),!i){const r=new za;i=z.instantiate(rg(e,t.scene),r)}}else i=e;if(!i)return null;const s=this.findAvatar(i);return s.isValid?(Ff&&console.log("[Custom Avatar] valid config",e,Ff?s:""),s):(console.warn("[Custom Avatar] config isn't valid",e,Ff?s:""),null)}async loadAvatar(t,e){if(console.assert(e!=null&&typeof e=="string","Avatar id must not be null"),e.length<=0||!e)return null;if(Ff&&console.log("[Custom Avatar] "+e+", loading..."),e.endsWith(".glb")||(e+=".glb"),this.avatarRegistryUrl===null){const s=await fetch("./"+e);let r=null;if(s.ok){const a=await s.blob();a&&(r=await a.arrayBuffer())}if(!r&&(r=await GM(e,e,0,"no url here go away",!0),!r))return null;const o=await La().parseSync(t,r,null,0);return(o==null?void 0:o.scene)??null}const i=new Fc;return wy(i,t),new Promise((s,r)=>{const o=this.avatarRegistryUrl+"/"+e;i.load(o,async a=>{await La().createBuiltinComponents(t,o,a,null,void 0),s(a.scene)},a=>{Ff&&console.log("[Custom Avatar] "+a.loaded/a.total*100+"% loaded of "+a.total/1024+"kB")},a=>{console.error("[Custom Avatar] Error when loading: "+a),s(null)})})}cacheModel(t,e){}findAvatar(t){const e=t;let i=e;i.children.length==1&&(i=t.children[0]);let s=this.findAvatarPart(i,["head"]);const r=this.findAvatarPart(i,["left","hand"]),o=this.findAvatarPart(i,["right","hand"]);if(!s){s=e;const l=new C;new Nn().setFromObject(s).getSize(l);const h=Math.max(l.x,l.y,l.z);console.warn("[Custom Avatar] Normalizing head scale, it's too big: "+h+" meters! Should be < 0.3m"),h>.3&&s.scale.multiplyScalar(1/h*.3)}return new DC(e,s,r,o)}findAvatarPart(t,e){const i=t.name.toLowerCase();let s=!0;for(const r of e){if(!s)break;i.indexOf(r)===-1&&(s=!1)}if(s)return t;if(t.children)for(const r of t.children){const o=this.findAvatarPart(r,e);if(o)return o}return null}handleCustomAvatarErrors(t){if(!t.ok)throw Error(t.statusText);return t}}var kC=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};class Vg extends se{constructor(){super(...arguments);c(this,"length",1);c(this,"depthTest",!0);c(this,"isGizmo",!0);c(this,"_axes",null)}onEnable(){if(this.isGizmo&&!Og)return;this._axes||(this._axes=new Do(this.length)),this._axes.layers.disableAll(),this._axes.layers.set(this.layer),this.gameObject.add(this._axes);const e=this._axes.material;e&&e.depthTest!==void 0&&(e.depthTest=this.depthTest)}onDisable(){this._axes&&this.gameObject.remove(this._axes)}}kC([A()],Vg.prototype,"length",void 0);kC([A()],Vg.prototype,"depthTest",void 0);kC([A()],Vg.prototype,"isGizmo",void 0);class fk extends se{constructor(){super(...arguments);c(this,"from");c(this,"to");c(this,"hint");c(this,"desiredDistance",1)}onEnable(){}update(){if(!this.from||!this.to||!this.hint)return;const e=qe(this.to).clone(),i=qe(this.from).clone(),s=e.distanceTo(i),r=e.clone();r.sub(i);const o=i.clone();o.add(e),o.multiplyScalar(.5);const a=qe(this.hint).clone();a.sub(o);const l=new C;l.crossVectors(a,r),l.crossVectors(r,l),l.normalize();const h=s*.5,u=Math.max(this.desiredDistance,h),d=Math.sqrt(u*u-h*h),f=l.clone();f.multiplyScalar(d),f.add(o),Ts(this.gameObject,f);const p=o.clone();p.sub(l),this.gameObject.lookAt(p)}}const Qb=N("debugusdzbehaviours");class OC{constructor(){c(this,"behaviours",[]);c(this,"behaviourComponents",[]);c(this,"behaviourComponentsCopy",[]);c(this,"audioClips",[]);c(this,"audioClipsCopy",[])}get extensionName(){return"Behaviour"}addBehavior(t){this.behaviours.push(t)}addAudioClip(t){if(!t||typeof t!="string")return"";const i="audio/"+Zh.getName(t);return this.audioClips.push({clipUrl:t,filesKey:i}),i}onBeforeBuildDocument(t){if(!t.root)return Promise.resolve();const e=[];return t.root.traverse(i=>{z.foreachComponent(i,s=>{var o;const r=s;if(typeof r.createBehaviours=="function"||typeof r.beforeCreateDocument=="function"||typeof r.afterCreateDocument=="function"||typeof r.afterSerialize=="function"){this.behaviourComponents.push(r);const a=(o=r.beforeCreateDocument)==null?void 0:o.call(r,this,t);a instanceof Promise&&e.push(a)}},!1)}),Qb&&console.log("onBeforeBuildDocument: all components",this.behaviourComponents),Promise.all(e)}onExportObject(t,e,i){var s;for(const r of this.behaviourComponents)Qb&&console.log("onExportObject: createBehaviours",r),(s=r.createBehaviours)==null||s.call(r,this,e,i)}onAfterBuildDocument(t){for(const e of this.behaviourComponents)typeof e.afterCreateDocument=="function"&&e.afterCreateDocument(this,t);this.behaviourComponentsCopy=this.behaviourComponents.slice(),this.behaviourComponents.length=0,this.audioClipsCopy=this.audioClips.slice(),this.audioClips.length=0}onAfterHierarchy(t,e){var i;if((i=this.behaviours)!=null&&i.length){e.beginBlock('def Scope "Behaviors"');for(const s of this.behaviours)s.writeTo(this,t.document,e);e.closeBlock()}}async onAfterSerialize(t){Qb&&console.log("onAfterSerialize behaviours",this.behaviourComponentsCopy);for(const e of this.behaviourComponentsCopy)typeof e.afterSerialize=="function"&&(e.afterSerialize.constructor.name==="AsyncFunction"?await e.afterSerialize(this,t):e.afterSerialize(this,t));for(const{clipUrl:e,filesKey:i}of this.audioClipsCopy){if(t.files[i])return;const o=await(await(await fetch(e)).blob()).arrayBuffer(),a=new Uint8Array(o);t.files[i]=a}this.behaviourComponentsCopy.length=0,this.audioClipsCopy.length=0}}var LC=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};const DS=class extends Ds{constructor(){super(...arguments);c(this,"threshold");c(this,"intensity");c(this,"scatter");c(this,"selectiveBloom")}get typeName(){return"Bloom"}init(){this.threshold.defaultValue=1,this.intensity.defaultValue=0,this.scatter.defaultValue=.2,this.selectiveBloom?(this.threshold.valueProcessor=e=>e,this.intensity.valueProcessor=e=>e,this.scatter.valueProcessor=e=>1*Math.PI*(1-e)):(this.threshold.valueProcessor=e=>e,this.intensity.valueProcessor=e=>e,this.scatter.valueProcessor=e=>100*(1-e))}onCreateEffect(){let e;if(this.selectiveBloom==null&&(this.selectiveBloom=DS.useSelectiveBloom),this.selectiveBloom){const i=e=new PM(this.context.scene,this.context.mainCamera,{blendFunction:Xe.ADD,mipmapBlur:!0,luminanceThreshold:this.threshold.value,luminanceSmoothing:this.scatter.value,intensity:this.intensity.value});i.inverted=!0}else e=new nC({blendFunction:Xe.ADD,mipmapBlur:!0,luminanceThreshold:this.threshold.value,luminanceSmoothing:this.scatter.value,intensity:this.intensity.value});return this.intensity.onValueChanged=i=>{e.intensity=i},this.threshold.onValueChanged=i=>{e.luminanceMaterial.threshold=i},this.scatter.onValueChanged=i=>{e.luminancePass.enabled=!0,e.luminanceMaterial.smoothing=i},e}};let _l=DS;c(_l,"useSelectiveBloom",!1);LC([A(je)],_l.prototype,"threshold",void 0);LC([A(je)],_l.prototype,"intensity",void 0);LC([A(je)],_l.prototype,"scatter",void 0);zo("Bloom",_l);var Js=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};class ro extends se{constructor(){super(...arguments);c(this,"attachedRigidbody",null);c(this,"isTrigger",!1);c(this,"sharedMaterial");c(this,"membership",[0]);c(this,"filter");c(this,"updateProperties",()=>{var e;(e=this.context.physics.engine)==null||e.updateProperties(this)})}get isCollider(){return!0}awake(){super.awake(),this.attachedRigidbody||(this.attachedRigidbody=this.gameObject.getComponentInParent(Pt))}start(){this.attachedRigidbody||(this.attachedRigidbody=this.gameObject.getComponentInParent(Pt))}onEnable(){this.attachedRigidbody||(this.attachedRigidbody=this.gameObject.getComponentInParent(Pt))}onDisable(){var e;(e=this.context.physics.engine)==null||e.removeBody(this)}get body(){var e;return(e=this.context.physics.engine)==null?void 0:e.getBody(this)}updatePhysicsMaterial(){var e;(e=this.context.physics.engine)==null||e.updatePhysicsMaterial(this)}}Js([A(Pt)],ro.prototype,"attachedRigidbody",void 0);Js([A()],ro.prototype,"isTrigger",void 0);Js([A()],ro.prototype,"sharedMaterial",void 0);Js([A()],ro.prototype,"membership",void 0);Js([A()],ro.prototype,"filter",void 0);class Wg extends ro{constructor(){super(...arguments);c(this,"radius",.5);c(this,"center",new C(0,0,0))}onEnable(){var e;super.onEnable(),(e=this.context.physics.engine)==null||e.addSphereCollider(this),mx(this.gameObject.scale,this.updateProperties)}onDisable(){super.onDisable(),oB(this.gameObject.scale,this.updateProperties)}onValidate(){this.updateProperties()}}Js([as(),A()],Wg.prototype,"radius",void 0);Js([A(C)],Wg.prototype,"center",void 0);class qg extends ro{constructor(){super(...arguments);c(this,"size",new C(1,1,1));c(this,"center",new C(0,0,0))}onEnable(){var e;super.onEnable(),(e=this.context.physics.engine)==null||e.addBoxCollider(this,this.size),mx(this.gameObject.scale,this.updateProperties)}onDisable(){super.onDisable(),oB(this.gameObject.scale,this.updateProperties)}onValidate(){this.updateProperties()}}Js([as(),A(C)],qg.prototype,"size",void 0);Js([A(C)],qg.prototype,"center",void 0);class Zd extends ro{constructor(){super(...arguments);c(this,"sharedMesh");c(this,"convex",!1)}onEnable(){var i,s,r;if(super.onEnable(),!this.context.physics.engine)return;(i=this.sharedMesh)!=null&&i.isMesh||this.gameObject instanceof J&&(this.sharedMesh=this.gameObject);const e=0;if((s=this.sharedMesh)!=null&&s.isMesh)this.context.physics.engine.addMeshCollider(this,this.sharedMesh,this.convex,ai(this.gameObject)),ct.assignMeshLOD(this.sharedMesh,e).then(o=>{o&&this.activeAndEnabled&&this.context.physics.engine&&this.sharedMesh&&(this.context.physics.engine.removeBody(this),this.sharedMesh.geometry=o,this.context.physics.engine.addMeshCollider(this,this.sharedMesh,this.convex,ai(this.gameObject)))});else{const o=this.sharedMesh;if(o!=null&&o.isGroup){console.warn(`MeshCollider mesh is a group "${((r=this.sharedMesh)==null?void 0:r.name)||this.gameObject.name}", adding all children as colliders. This is currently not fully supported (colliders can not be removed from world again)`,this);const a=new Array;for(const l in o.children){const h=o.children[l];h.isMesh&&(this.context.physics.engine.addMeshCollider(this,h,this.convex,ai(this.gameObject)),a.push(ct.assignMeshLOD(h,e)))}Promise.all(a).then(l=>{var u,d;if(l.some(f=>f)==!1)return;(u=this.context.physics.engine)==null||u.removeBody(this);const h=new J;for(const f of l)f&&this.activeAndEnabled&&(h.geometry=f,(d=this.context.physics.engine)==null||d.addMeshCollider(this,h,this.convex,ai(this.gameObject)))})}}}}Js([A(J)],Zd.prototype,"sharedMesh",void 0);Js([A()],Zd.prototype,"convex",void 0);class Oc extends ro{constructor(){super(...arguments);c(this,"center",new C(0,0,0));c(this,"radius",.5);c(this,"height",2)}onEnable(){var e;super.onEnable(),(e=this.context.physics.engine)==null||e.addCapsuleCollider(this,this.height,this.radius)}}Js([A(C)],Oc.prototype,"center",void 0);Js([A()],Oc.prototype,"radius",void 0);Js([A()],Oc.prototype,"height",void 0);var FC=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};class $d extends se{constructor(){super(...arguments);c(this,"objectBounds",!1);c(this,"color");c(this,"isGizmo",!0);c(this,"_gizmoObject",null);c(this,"_boxHelper",null)}onEnable(){this.isGizmo&&!Og||(this._gizmoObject||(this.objectBounds?this._gizmoObject=new XR(this.gameObject,this.color??16776960):(this.objectBounds=!1,this._gizmoObject=lC(this.color??16776960))),this.objectBounds?(this.scene.add(this._gizmoObject),this._boxHelper=this._gizmoObject,this.startCoroutine(this.syncObjectBounds(),ze.OnBeforeRender)):this.gameObject.add(this._gizmoObject))}onDisable(){this._gizmoObject&&this.gameObject.remove(this._gizmoObject)}*syncObjectBounds(){var e;for(;this._boxHelper;)(e=this._boxHelper)==null||e.update(),yield}}FC([A()],$d.prototype,"objectBounds",void 0);FC([A(we)],$d.prototype,"color",void 0);FC([A()],$d.prototype,"isGizmo",void 0);const uH=N("gizmos"),dH=N("debugboxhelper"),Lr=class extends se{constructor(){super(...arguments);c(this,"box",null);c(this,"_lastMatrixUpdateFrame",-1);c(this,"_helper",null);c(this,"_color",null)}isInBox(e,i){var r;if(!e)return;if(this.box||(this.box=new Nn),e.type==="Mesh")Lr.testBox.setFromObject(e);else if(e.type==="Group"){if(Lr.testBox.makeEmpty(),e.children.length>0)for(let o=0;o<e.children.length;o++)e.children[o].type==="Mesh"&&Lr.testBox.expandByObject(e)}else{const o=qe(e,Lr._position),a=ai(e,Lr._size);i!==void 0&&a.multiplyScalar(i),Lr.testBox.setFromCenterAndSize(o,a)}this.updateBox();const s=(r=this.box)==null?void 0:r.intersectsBox(Lr.testBox);return s&&dH&&De.DrawWireBox3(Lr.testBox,16711680,5),s}intersects(e){return e?this.updateBox(!1).intersectsBox(e):!1}updateBox(e=!1){if(this.box||(this.box=new Nn),e||this.context.time.frameCount!=this._lastMatrixUpdateFrame){const i=this._lastMatrixUpdateFrame<0;this._lastMatrixUpdateFrame=this.context.time.frameCount;const s=i,r=qe(this.gameObject,Lr._position,s),o=ai(this.gameObject,Lr._size);this.box.setFromCenterAndSize(r,o)}return this.box}awake(){this._helper=null,this._color=null,this.box=null}showHelper(e=null,i=!1){var s;if(!(!uH&&!i)){if(this._helper){e&&((s=this._color)==null||s.set(e)),this.gameObject.add(this._helper);return}this._helper=lC(e),this.gameObject.add(this._helper)}}};let So=Lr;c(So,"testBox",new Nn),c(So,"_position",new C),c(So,"_size",new C(.01,.01,.01));class fH extends nP{constructor(t,e={}){super(t),t._simpleState__activeStates=[],t._simpleState__normalStyles={},t._simpleState__states=e,t._simpleState__statesProperties={};for(const i in e)for(const s in e[i])t._simpleState__statesProperties[s]||(t._simpleState__statesProperties[s]=[]),t._simpleState__statesProperties[s].push(i);for(const i of t._components)t._simpleState__statesProperties[i.id]&&(t._simpleState__normalStyles[i.id]=i.inline?i.inline:i._value);t.__overridedSet=t.set,t.set=this.storeSet.bind(t),t.renderStates=this.renderStates.bind(t),t.setupState=this.setupState.bind(t),t.setState=this.setState.bind(t),t.activatePseudoState=this.activatePseudoState.bind(t),t.deactivatePseudoState=this.deactivatePseudoState.bind(t),t.togglePseudoState=this.togglePseudoState.bind(t)}act(){}attach(){}detach(){}setupState(t,e){this._simpleState__states[t]=e;const i=[];for(const s in e)this._simpleState__statesProperties[s]||(this._simpleState__statesProperties[s]=[],i.push(s)),this._simpleState__statesProperties[s].push(t);for(const s of this._components)i.indexOf(s.id)>-1&&(this._simpleState__normalStyles[s.id]=s.inline?s.inline:s._value)}renderStates(){let t={...this._simpleState__normalStyles};for(const e in this._simpleState__states)this._simpleState__activeStates.indexOf(e)>-1&&(t={...t,...this._simpleState__states[e]});this.set(t,!1)}storeSet(t,e=!0){if(e)for(const i in t)this._simpleState__statesProperties[i]&&(this._simpleState__normalStyles[i]=t[i]);this.__overridedSet(t)}activatePseudoState(t){this._simpleState__activeStates.indexOf(t)===-1&&(this._simpleState__activeStates.push(t),this.renderStates())}deactivatePseudoState(t){const e=this._simpleState__activeStates.indexOf(t);e>-1&&(this._simpleState__activeStates.splice(e,1),this.renderStates())}togglePseudoState(t){const e=this._simpleState__activeStates.indexOf(t);e>-1?this._simpleState__activeStates.splice(e,1):this._simpleState__activeStates.push(t),this.renderStates()}setState(t){Array.isArray(t)?this._simpleState__activeStates=t:this._simpleState__activeStates=[t],this.renderStates()}}var pk=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};class Xg extends se{constructor(){super(...arguments);c(this,"effectColor");c(this,"effectDistance")}}pk([A(Ot)],Xg.prototype,"effectColor",void 0);pk([A(ae)],Xg.prototype,"effectDistance",void 0);var Yg=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};const zb=N("debugui"),jb=N("debuguilayout");class gk{constructor(){c(this,"width");c(this,"height")}}class mk{constructor(){c(this,"x");c(this,"y");c(this,"width");c(this,"height")}}const mo=new C,Uf=new ce,Zm=new ne;class jn extends Fo{constructor(){super(...arguments);c(this,"_anchoredPosition");c(this,"sizeDelta",new ae(100,100));c(this,"pivot",new ae(.5,.5));c(this,"anchorMin",new ae(0,0));c(this,"anchorMax",new ae(1,1));c(this,"minWidth");c(this,"minHeight");c(this,"lastMatrix");c(this,"rectBlock");c(this,"_transformNeedsUpdate",!1);c(this,"_initialPosition");c(this,"_parentRectTransform");c(this,"_lastUpdateFrame",-1);c(this,"_lastAnchoring");c(this,"_createdBlocks",[]);c(this,"_createdTextBlocks",[])}get parent(){return this._parentRectTransform}get translation(){return this.gameObject.position}get rotation(){return this.gameObject.quaternion}get scale(){return this.gameObject.scale}get anchoredPosition(){return this._anchoredPosition||(this._anchoredPosition=new ae),this._anchoredPosition}set anchoredPosition(e){this._anchoredPosition=e}get width(){let e=this.sizeDelta.x;if(this.anchorMin.x!==this.anchorMax.x&&this._parentRectTransform){const i=this._parentRectTransform.width,s=this.anchorMax.x-this.anchorMin.x;e=i*s,e+=this.sizeDelta.x}return this.minWidth!==void 0&&e<this.minWidth?this.minWidth:e}get height(){let e=this.sizeDelta.y;if(this.anchorMin.y!==this.anchorMax.y&&this._parentRectTransform){const i=this._parentRectTransform.height,s=this.anchorMax.y-this.anchorMin.y;e=i*s,e+=this.sizeDelta.y}return this.minHeight!==void 0&&e<this.minHeight?this.minHeight:e}awake(){super.awake(),this._anchoredPosition||(this._anchoredPosition=new ae),this.lastMatrix=new ce,this.rectBlock=new re,this.rectBlock.name=this.name,this._initialPosition=this.gameObject.position.clone(),this._initialPosition.z=0,Lu(this,"_anchoredPosition",()=>{this.markDirty()}),Lu(this,"sizeDelta",()=>{this.markDirty()}),Lu(this,"pivot",()=>{this.markDirty()}),Lu(this,"anchorMin",()=>{this.markDirty()}),Lu(this,"anchorMax",()=>{this.markDirty()})}onEnable(){var e;super.onEnable(),this.rectBlock||(this.rectBlock=new re),this.lastMatrix||(this.lastMatrix=new ce),this._lastAnchoring||(this._lastAnchoring=new ae),this._initialPosition||(this._initialPosition=new C),this._anchoredPosition||(this._anchoredPosition=new ae),this.addShadowComponent(this.rectBlock),this._transformNeedsUpdate=!0,(e=this.canvas)==null||e.registerTransform(this)}onDisable(){var e;super.onDisable(),this.removeShadowComponent(),(e=this.canvas)==null||e.unregisterTransform(this)}onParentRectTransformChanged(e){this._transformNeedsUpdate||this.onApplyTransform(jb?`${e.name} changed`:void 0)}get isDirty(){return this._transformNeedsUpdate||(this._transformNeedsUpdate=!this.lastMatrix.equals(this.gameObject.matrix)),this._transformNeedsUpdate}markDirty(){this._transformNeedsUpdate||(jb&&console.warn("RectTransform markDirty()",this.name),this._transformNeedsUpdate=!0,this._lastUpdateFrame=-1)}updateTransform(){(this._transformNeedsUpdate||!this.lastMatrix.equals(this.gameObject.matrix))&&this.canUpdate()&&this.onApplyTransform(this._transformNeedsUpdate?"Marked dirty":"Matrix changed")}canUpdate(){return this._transformNeedsUpdate&&this.activeAndEnabled&&this._lastUpdateFrame!==this.context.time.frame}onApplyTransform(e){var r;if(this.context.time.frameCount===this._lastUpdateFrame)return;this._lastUpdateFrame=this.context.time.frameCount;const i=this.shadowComponent;if(!i)return;this.gameObject.parent?this._parentRectTransform=z.getComponentInParent(this.gameObject.parent,jn):this._parentRectTransform=void 0,this._transformNeedsUpdate=!1,jb&&console.warn("RectTransform â†’ ApplyTransform",this.name+" because "+e),this.isRoot()?this.Root.screenspace||(i.rotation.y=Math.PI):(i.matrix.identity(),i.matrixAutoUpdate=!1,mo.set(0,0,0),this.applyPivot(mo),i.matrix.setPosition(mo.x,mo.y,0),(this.gameObject.quaternion.x||this.gameObject.quaternion.y||this.gameObject.quaternion.z)&&(Zm.copy(this.gameObject.quaternion),Zm.x*=-1,Zm.z*=-1,Uf.makeRotationFromQuaternion(Zm),i.matrix.premultiply(Uf)),mo.set(0,0,0),this.applyAnchoring(mo),(r=this.canvas)!=null&&r.screenspace?mo.z+=.1:mo.z+=.01,Uf.identity(),Uf.setPosition(mo.x,mo.y,mo.z),i.matrix.premultiply(Uf),i.matrix.scale(this.gameObject.scale)),this.lastMatrix.copy(this.gameObject.matrix);const s=!0;for(const o of XD(this.gameObject,Fo,s,1)){if(o===this||!o.activeAndEnabled)continue;const a=o;a.onParentRectTransformChanged&&a.onParentRectTransformChanged(this)}}applyAnchoring(e){this._lastAnchoring||(this._lastAnchoring=new ae);const i=this._lastAnchoring.sub(this._anchoredPosition);this.gameObject.position.x+=i.x,this.gameObject.position.y+=i.y,this._lastAnchoring.copy(this._anchoredPosition),e.x+=this._initialPosition.x-this.gameObject.position.x,e.y+=this._initialPosition.y-this.gameObject.position.y,e.z+=this._initialPosition.z-this.gameObject.position.z;const s=this._parentRectTransform;if(s){let r=0;const o=1-this.anchorMax.y-this.anchorMin.y;r-=s.height*.5*o,e.y+=r;let a=0;const l=1-this.anchorMax.x-this.anchorMin.x;a-=s.width*.5*l,e.x+=a}}applyPivot(e){if(this.pivot&&!this.isRoot()){const i=this.pivot.x-.5;e.x-=i*this.sizeDelta.x*this.gameObject.scale.x;const s=this.pivot.y-.5;e.y-=s*this.sizeDelta.y*this.gameObject.scale.y}}getBasicOptions(){const e={width:this.sizeDelta.x,height:this.sizeDelta.y,offset:0,backgroundOpacity:0,borderWidth:0,borderRadius:0,borderOpacity:0,letterSpacing:-.03};return this.ensureValidSize(e),e}ensureValidSize(e,i=1e-4){return e.width<=0&&(e.width=i),e.height<=0&&(e.height=1e-4),e}createNewBlock(e){e={...this.getBasicOptions(),...e},zb&&console.log(this.name,e);const i=new jx(e);return this._createdBlocks.push(i),i}createNewText(e){zb&&console.log(e),e={...this.getBasicOptions(),...e},zb&&console.log(this.name,e);const i=new Gx(e);return this._createdTextBlocks.push(i),i}}Yg([A(ae)],jn.prototype,"anchoredPosition",null);Yg([A(ae)],jn.prototype,"sizeDelta",void 0);Yg([A(ae)],jn.prototype,"pivot",void 0);Yg([A(ae)],jn.prototype,"anchorMin",void 0);Yg([A(ae)],jn.prototype,"anchorMax",void 0);var Ak=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};const $m={backgroundColor:new we(1,1,1),backgroundOpacity:1,borderColor:new we(1,1,1),borderOpacity:1},hd=class extends Fo{constructor(){super(...arguments);c(this,"_alphaFactor",1);c(this,"sRGBColor",new we(1,0,1));c(this,"raycastTarget",!0);c(this,"uiObject",null);c(this,"_color",null);c(this,"_rect",null);c(this,"_stateManager",null);c(this,"_currentlyCreatingPanel",!1)}get isGraphic(){return!0}get color(){return this._color||(this._color=new Ot(1,1,1,1)),this._color}set color(e){(!this._color||this._color.r!==e.r||this._color.g!==e.g||this._color.b!==e.b||this._color.alpha!==e.alpha)&&(this._color||(this._color=new Ot(1,1,1,1)),this._color.copy(e),this.onColorChanged())}setAlphaFactor(e){this._alphaFactor=e,this.onColorChanged()}get alphaFactor(){return this._alphaFactor}onColorChanged(){this.uiObject&&(this.sRGBColor.copy(this._color),this.sRGBColor.convertLinearToSRGB(),$m.backgroundColor=this.sRGBColor,$m.backgroundOpacity=this._color.alpha*this._alphaFactor,this.applyEffects($m,this._alphaFactor),this.uiObject.set($m),this.markDirty())}get m_Color(){return this._color}get rectTransform(){if(this._rect||(this._rect=z.getComponent(this.gameObject,jn)),!this._rect)throw new Error("Not Supported: Make sure to add a RectTransform component before adding a UI Graphic component.");return this._rect}onParentRectTransformChanged(){var e;(e=this.uiObject)==null||e.set({width:this.rectTransform.width,height:this.rectTransform.height}),this.markDirty()}__internalNewInstanceCreated(e){return super.__internalNewInstanceCreated(e),this._rect=null,this.uiObject=null,this._color&&(this._color=this._color.clone()),this}setState(e){this.makePanel(),this.uiObject&&(this.uiObject.setState(e),this==null||this.markDirty())}setupState(e){this.makePanel(),this.uiObject&&(this._stateManager||(this._stateManager=new fH(this.uiObject)),this.uiObject.setupState(e.state,e.attributes))}setOptions(e){this.makePanel(),this.uiObject&&this.uiObject.set(e)}awake(){super.awake(),this.makePanel(),Lu(this,"_color",()=>R5(this,this.onColorChanged))}onEnable(){var e;super.onEnable(),this.uiObject&&((e=this.rectTransform.shadowComponent)==null||e.add(this.uiObject),this.addShadowComponent(this.uiObject,this.rectTransform))}onDisable(){super.onDisable(),this.uiObject&&this.removeShadowComponent()}makePanel(){if(this.uiObject||this._currentlyCreatingPanel)return;this._currentlyCreatingPanel=!0;const e=.015,i={backgroundColor:this.color,backgroundOpacity:this.color.alpha,offset:e};this.onBeforeCreate(i),this.applyEffects(i),this.onCreate(i),this.controlsChildLayout=!1,this._currentlyCreatingPanel=!1,this.onAfterCreated(),this.onColorChanged()}onBeforeCreate(e){}onCreate(e){this.uiObject=this.rectTransform.createNewBlock(e),this.uiObject.name=this.name}onAfterCreated(){}applyEffects(e,i=1){var r;const s=(r=this.gameObject)==null?void 0:r.getComponent(Xg);s&&(s.effectDistance&&(e.borderWidth=Math.max(Math.abs(s.effectDistance.x),Math.abs(s.effectDistance.y))),s.effectColor&&(e.borderColor=s.effectColor,e.borderOpacity=s.effectColor.alpha*i))}async setTexture(e){if(this.setOptions({backgroundOpacity:0}),e){if(hd.textureCache.has(e))e=hd.textureCache.get(e);else if(!e.isRenderTargetTexture){const i=e.clone();i.colorSpace=Di,hd.textureCache.set(e,i),e=i}this.setOptions({backgroundImage:e,borderRadius:0,backgroundOpacity:this.color.alpha,backgroundSize:"stretch"}),ct.assignTextureLOD(e,0).then(i=>{i instanceof pt&&(e&&hd.textureCache.set(e,i),this.setOptions({backgroundImage:i}),this.markDirty())})}else this.setOptions({backgroundImage:void 0,borderRadius:0,backgroundOpacity:this.color.alpha});this.markDirty()}onAfterAddedToScene(){super.onAfterAddedToScene(),this.shadowComponent&&(this.shadowComponent.offset=this.shadowComponent.position.z)}};let wl=hd;c(wl,"textureCache",new Map);Ak([A(Ot)],wl.prototype,"color",null);Ak([A()],wl.prototype,"raycastTarget",void 0);class Jy extends wl{constructor(){super(...arguments);c(this,"_flippedObject",!1)}onAfterCreated(){this.uiObject&&!this._flippedObject&&(this._flippedObject=!0,this.uiObject.scale.y*=-1)}}var Zy=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};let UC=class{constructor(){c(this,"texture",null);c(this,"rect")}};Zy([A(pt)],UC.prototype,"texture",void 0);let Kg=class extends Jy{constructor(){super(...arguments);c(this,"_sprite");c(this,"pixelsPerUnitMultiplier",1)}set image(e){this.sprite||(this.sprite=new UC),this.sprite.texture=e,this.onAfterCreated()}get image(){return this.sprite?this.sprite.texture:null}get sprite(){return this._sprite}set sprite(e){this._sprite!==e&&(this._sprite=e,this.onAfterCreated())}isBuiltinSprite(){var i,s,r,o,a,l,h;const e=this.sprite;switch((i=e==null?void 0:e.texture)==null?void 0:i.name){case"InputFieldBackground":case"UISprite":case"Background":case"Knob":return!0}return!((r=(s=e==null?void 0:e.texture)==null?void 0:s.name)!=null&&r.length)&&((a=(o=e==null?void 0:e.texture)==null?void 0:o.image)==null?void 0:a.width)===32&&((h=(l=e==null?void 0:e.texture)==null?void 0:l.image)==null?void 0:h.height)===32}onBeforeCreate(e){var i,s;super.onBeforeCreate(e),this.isBuiltinSprite()&&(e.borderRadius=5/this.pixelsPerUnitMultiplier,((s=(i=this.sprite)==null?void 0:i.texture)==null?void 0:s.name)==="Knob"&&(e.borderRadius=999))}onAfterCreated(){var e;this.__didAwake&&(super.onAfterCreated(),!this.isBuiltinSprite()&&this.setTexture((e=this.sprite)==null?void 0:e.texture))}};Zy([A(UC)],Kg.prototype,"sprite",null);Zy([A()],Kg.prototype,"pixelsPerUnitMultiplier",void 0);class NC extends Jy{constructor(){super(...arguments);c(this,"_mainTexture")}get mainTexture(){return this._mainTexture}set mainTexture(e){this._mainTexture!==e&&(this._mainTexture=e,this.onAfterCreated())}onAfterCreated(){this.__didAwake&&(super.onAfterCreated(),this.setTexture(this.mainTexture))}}Zy([A(pt)],NC.prototype,"mainTexture",null);var br=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};const $c=N("debugbutton");var sa;(function(n){n[n.None=0]="None",n[n.ColorTint=1]="ColorTint",n[n.SpriteSwap=2]="SpriteSwap",n[n.Animation=3]="Animation"})(sa||(sa={}));class zc{constructor(){c(this,"colorMultiplier");c(this,"disabledColor");c(this,"fadeDuration");c(this,"highlightedColor");c(this,"normalColor");c(this,"pressedColor");c(this,"selectedColor")}}br([A()],zc.prototype,"colorMultiplier",void 0);br([A(Ot)],zc.prototype,"disabledColor",void 0);br([A()],zc.prototype,"fadeDuration",void 0);br([A(Ot)],zc.prototype,"highlightedColor",void 0);br([A(Ot)],zc.prototype,"normalColor",void 0);br([A(Ot)],zc.prototype,"pressedColor",void 0);br([A(Ot)],zc.prototype,"selectedColor",void 0);class pH{constructor(){c(this,"disabledTrigger");c(this,"highlightedTrigger");c(this,"normalTrigger");c(this,"pressedTrigger");c(this,"selectedTrigger")}}class jc extends se{constructor(){super(...arguments);c(this,"onClick");c(this,"_isHovered",0);c(this,"colors");c(this,"transition");c(this,"animationTriggers");c(this,"animator");c(this,"_interactable",!0);c(this,"_requestedAnimatorTrigger");c(this,"_isInit",!1);c(this,"_image")}onPointerEnter(e){var s,r;const i=e.event.pointerType==="mouse"&&e.button===0;i&&(this._isHovered+=1),$c&&console.warn("Button Enter",i,this._isHovered,(s=this.animationTriggers)==null?void 0:s.highlightedTrigger,this.animator),this.interactable&&(this.transition==sa.Animation&&this.animationTriggers&&this.animator?this.animator.setTrigger(this.animationTriggers.highlightedTrigger):this.transition===sa.ColorTint&&this.colors&&((r=this._image)==null||r.setState("hovered")),i&&this.context.input.setCursorPointer())}onPointerExit(){var e,i;this._isHovered-=1,this._isHovered<0&&(this._isHovered=0),$c&&console.log("Button Exit",this._isHovered,(e=this.animationTriggers)==null?void 0:e.highlightedTrigger,this.animator),this.interactable&&(this._isHovered>0||(this._isHovered=0,this.transition==sa.Animation&&this.animationTriggers&&this.animator?this.animator.setTrigger(this.animationTriggers.normalTrigger):this.transition===sa.ColorTint&&this.colors&&((i=this._image)==null||i.setState("normal")),this.context.input.setCursorNormal()))}onPointerDown(e){var i,s;$c&&console.log("Button Down",(i=this.animationTriggers)==null?void 0:i.highlightedTrigger,this.animator),this.interactable&&(this.transition==sa.Animation&&this.animationTriggers&&this.animator?this.animator.setTrigger(this.animationTriggers.pressedTrigger):this.transition===sa.ColorTint&&this.colors&&((s=this._image)==null||s.setState("pressed")))}onPointerUp(e){var i,s;$c&&console.warn("Button Up",(i=this.animationTriggers)==null?void 0:i.highlightedTrigger,this.animator,this._isHovered),this.interactable&&(this.transition==sa.Animation&&this.animationTriggers&&this.animator?this.animator.setTrigger(this._isHovered?this.animationTriggers.highlightedTrigger:this.animationTriggers.normalTrigger):this.transition===sa.ColorTint&&this.colors&&((s=this._image)==null||s.setState(this._isHovered?"hovered":"normal")))}onPointerClick(e){if(this.interactable&&!(e.button!==0&&e.event.pointerType===yc.Mouse)&&($c&&(console.warn("Button Click",this.onClick),Ci("CLICKED button "+this.name+" at "+this.context.time.frameCount)),this.onClick&&this.onClick.listenerCount>0&&(this.onClick.invoke(),e.use(),$c))){const i=this.gameObject.worldPosition;i.add(this.gameObject.worldUp.multiplyScalar(1+Math.random()*.5)),De.DrawLabel(i,"CLICK:"+Date.now(),.1,1+Math.random()*.5)}}set interactable(e){this._interactable=e,this._image&&(this._image.setInteractable(e),e?this._image.setState("normal"):this._image.setState("disabled"))}get interactable(){return this._interactable}set_interactable(e){this.interactable=e}awake(){super.awake(),$c&&console.log(this),this._isInit=!1,this.init()}start(){var e;(e=this._image)==null||e.setInteractable(this.interactable),this.gameObject.getComponentInParent(jg)||this.gameObject.addComponent(CC)}onEnable(){super.onEnable()}onDestroy(){this._isHovered&&this.context.input.setCursorNormal()}*setAnimatorTriggerAtEndOfFrame(e){var i;this._requestedAnimatorTrigger=e,yield,yield,this._requestedAnimatorTrigger==e&&((i=this.animator)==null||i.SetTrigger(e))}init(){this._isInit||(this._isInit=!0,this._image=z.getComponent(this.gameObject,Kg),this._image&&(this.stateSetup(this._image),this.interactable?this._image.setState("normal"):this._image.setState("disabled")))}stateSetup(e){var p,g,m,v,y;e.setInteractable(this.interactable);const i=this.getFinalColor(e.color,(p=this.colors)==null?void 0:p.normalColor),s={state:"normal",attributes:{backgroundColor:i,backgroundOpacity:i.alpha}};e.setupState(s);const r=this.getFinalColor(e.color,(g=this.colors)==null?void 0:g.highlightedColor),o={state:"hovered",attributes:{backgroundColor:r,backgroundOpacity:r.alpha}};e.setupState(o);const a=this.getFinalColor(e.color,(m=this.colors)==null?void 0:m.pressedColor),l={state:"pressed",attributes:{backgroundColor:a,backgroundOpacity:a.alpha}};e.setupState(l);const h=this.getFinalColor(e.color,(v=this.colors)==null?void 0:v.selectedColor),u={state:"selected",attributes:{backgroundColor:h,backgroundOpacity:h.alpha}};e.setupState(u);const d=this.getFinalColor(e.color,(y=this.colors)==null?void 0:y.disabledColor),f={state:"disabled",attributes:{backgroundColor:d,backgroundOpacity:d.alpha}};e.setupState(f)}getFinalColor(e,i){return i?e.clone().multiply(i).convertLinearToSRGB():e.clone().convertLinearToSRGB()}}br([A(dn)],jc.prototype,"onClick",void 0);br([A(zc)],jc.prototype,"colors",void 0);br([A()],jc.prototype,"transition",void 0);br([A(pH)],jc.prototype,"animationTriggers",void 0);br([A(zn)],jc.prototype,"animator",void 0);br([A()],jc.prototype,"interactable",null);var Qi=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};const NI=N("debuguilayout");class $h{constructor(){c(this,"left",0);c(this,"right",0);c(this,"top",0);c(this,"bottom",0)}get vertical(){return this.top+this.bottom}get horizontal(){return this.left+this.right}}Qi([A()],$h.prototype,"left",void 0);Qi([A()],$h.prototype,"right",void 0);Qi([A()],$h.prototype,"top",void 0);Qi([A()],$h.prototype,"bottom",void 0);var Lw;(function(n){n[n.UpperLeft=0]="UpperLeft",n[n.UpperCenter=1]="UpperCenter",n[n.UpperRight=2]="UpperRight",n[n.MiddleLeft=3]="MiddleLeft",n[n.MiddleCenter=4]="MiddleCenter",n[n.MiddleRight=5]="MiddleRight",n[n.LowerLeft=6]="LowerLeft",n[n.LowerCenter=7]="LowerCenter",n[n.LowerRight=8]="LowerRight",n[n.Custom=9]="Custom"})(Lw||(Lw={}));var Bh;(function(n){n.Horizontal="x",n.Vertical="y"})(Bh||(Bh={}));class _r extends se{constructor(){super(...arguments);c(this,"_rectTransform",null);c(this,"_needsUpdate",!1);c(this,"childAlignment",Lw.UpperLeft);c(this,"reverseArrangement",!1);c(this,"spacing",0);c(this,"padding");c(this,"minWidth",0);c(this,"minHeight",0);c(this,"flexibleHeight",0);c(this,"flexibleWidth",0);c(this,"preferredHeight",0);c(this,"preferredWidth",0)}get rectTransform(){return this._rectTransform}onParentRectTransformChanged(e){this._needsUpdate=!0}get isDirty(){return this._needsUpdate}get isLayoutGroup(){return!0}updateLayout(){this._rectTransform&&(NI&&console.warn("Layout Update",this.context.time.frame,this.name),this._needsUpdate=!1,this.onCalculateLayout(this._rectTransform))}start(){this._needsUpdate=!0}onEnable(){NI&&console.log(this.name,this),this._rectTransform=this.gameObject.getComponent(jn);const e=this.gameObject.getComponentInParent(fn);e&&e.registerLayoutGroup(this),this._needsUpdate=!0}onDisable(){const e=this.gameObject.getComponentInParent(fn);e&&e.unregisterLayoutGroup(this)}set m_Spacing(e){e!==this.spacing&&(this._needsUpdate=!0,this.spacing=e)}get m_Spacing(){return this.spacing}}Qi([A()],_r.prototype,"childAlignment",void 0);Qi([A()],_r.prototype,"reverseArrangement",void 0);Qi([A()],_r.prototype,"spacing",void 0);Qi([A($h)],_r.prototype,"padding",void 0);Qi([A()],_r.prototype,"minWidth",void 0);Qi([A()],_r.prototype,"minHeight",void 0);Qi([A()],_r.prototype,"flexibleHeight",void 0);Qi([A()],_r.prototype,"flexibleWidth",void 0);Qi([A()],_r.prototype,"preferredHeight",void 0);Qi([A()],_r.prototype,"preferredWidth",void 0);class Gc extends _r{constructor(){super(...arguments);c(this,"childControlHeight",!0);c(this,"childControlWidth",!0);c(this,"childForceExpandHeight",!1);c(this,"childForceExpandWidth",!1);c(this,"childScaleHeight",!1);c(this,"childScaleWidth",!1)}onCalculateLayout(e){var I;const i=this.primaryAxis,s=e.width;let r=s;const o=e.height;let a=o;r-=this.padding.horizontal,a-=this.padding.vertical,i===Bh.Horizontal?this.padding.horizontal:this.padding.vertical;const l=i===Bh.Horizontal,h=l?"y":"x",u=l?this.childControlWidth:this.childControlHeight,d=l?this.childControlHeight:this.childControlWidth,f=l?this.childForceExpandWidth:this.childForceExpandHeight,p=l?this.childForceExpandHeight:this.childForceExpandWidth,g=l?a:r,m=l?s:o,v=.5*(l?this.childAlignment%3:Math.floor(this.childAlignment/3));let y=0;l?y+=this.padding.left:y+=this.padding.top;let b=0,_=0;for(let P=0;P<this.gameObject.children.length;P++){const R=this.gameObject.children[P],B=z.getComponent(R,jn);B!=null&&B.activeAndEnabled&&(_+=1,l?b+=B.width:b+=B.height)}let x=0;const S=this.spacing*(_-1);if(f||u){let P=0;l?P=r-=S:P=a-=S,_>0&&(x=P/_)}let T=0;T+=this.padding.left,T-=this.padding.right,v!==0&&(y=m-b,y*=v,y-=S*v,l?(y-=this.padding.right*v,y+=this.padding.left*(1-v),y<this.padding.left&&(y=this.padding.left)):(y-=this.padding.bottom*v,y+=this.padding.top*(1-v),y<this.padding.top&&(y=this.padding.top)));let L=1;for(let P=0;P<this.gameObject.children.length;P++){const R=this.gameObject.children[P],B=z.getComponent(R,jn);if(B!=null&&B.activeAndEnabled){(I=B.pivot)==null||I.set(.5,.5),B.anchorMin.set(0,1),B.anchorMax.set(0,1);const Q=s*.5+T*.5;B.anchoredPosition.x!==Q&&(B.anchoredPosition.x=Q);const G=o*-.5;B.anchoredPosition.y!==G&&(B.anchoredPosition.y=G),p&&d&&B.sizeDelta[h]!==g&&(B.sizeDelta[h]=g),f&&u&&B.sizeDelta[i]!==x&&(B.sizeDelta[i]=x);const V=l?B.width:B.height,X=V*.5;if(y+=X,f){const M=x*L-x*.5;M>y&&(y=M-x*.5+V+this.padding.left,y-=X)}let k=y;i===Bh.Vertical&&(k=-k),B.anchoredPosition[i]!==k&&(B.anchoredPosition[i]=k),y+=X,y+=this.spacing,L+=1}}}}Qi([A()],Gc.prototype,"childControlHeight",void 0);Qi([A()],Gc.prototype,"childControlWidth",void 0);Qi([A()],Gc.prototype,"childForceExpandHeight",void 0);Qi([A()],Gc.prototype,"childForceExpandWidth",void 0);Qi([A()],Gc.prototype,"childScaleHeight",void 0);Qi([A()],Gc.prototype,"childScaleWidth",void 0);class vk extends Gc{get primaryAxis(){return Bh.Vertical}}class yk extends Gc{get primaryAxis(){return Bh.Horizontal}}class bk extends _r{onCalculateLayout(){}}var Ga=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r},ua;(function(n){n[n.ScreenSpaceOverlay=0]="ScreenSpaceOverlay",n[n.ScreenSpaceCamera=1]="ScreenSpaceCamera",n[n.WorldSpace=2]="WorldSpace",n[n.Undefined=-1]="Undefined"})(ua||(ua={}));const Gb=N("debuguilayout");class fn extends Ny{constructor(){super(...arguments);c(this,"_renderOnTop");c(this,"_depthWrite",!1);c(this,"_doubleSided",!0);c(this,"_castShadows",!1);c(this,"_receiveShadows",!1);c(this,"_renderMode",ua.Undefined);c(this,"_rootCanvas");c(this,"_scaleFactor",1);c(this,"worldCamera");c(this,"planeDistance",-1);c(this,"_boundRenderSettingsChanged",this.onRenderSettingsChanged.bind(this));c(this,"previousParent",null);c(this,"_lastMatrixWorld",null);c(this,"_rectTransforms",[]);c(this,"_layoutGroups",new Map);c(this,"_receivers",[]);c(this,"onBeforeRenderRoutine",()=>{var e,i,s,r;if(this.previousParent=this.gameObject.parent,((e=this.context.xr)!=null&&e.isVR||(i=this.context.xr)!=null&&i.isPassThrough)&&this.screenspace){this.gameObject.visible=!1,this.gameObject.removeFromParent();return}this.renderOnTop||this.screenspace?this.gameObject.removeFromParent():(this.onUpdateRenderMode(),this.handleLayoutUpdates(),(s=this.shadowComponent)==null||s.updateMatrixWorld(!0),(r=this.shadowComponent)==null||r.updateWorldMatrix(!0,!0),this.invokeBeforeRenderEvents(),pr.ensureUpdateMeshUI(hE,this.context))});c(this,"onAfterRenderRoutine",()=>{var e,i,s,r,o;if(((e=this.context.xr)!=null&&e.isVR||(i=this.context.xr)!=null&&i.isPassThrough)&&this.screenspace){(s=this.previousParent)==null||s.add(this.gameObject);return}if((this.screenspace||this.renderOnTop)&&this.previousParent&&this.context.mainCamera){if(this.screenspace){const h=this.context.mainCamera;h==null||h.add(this.gameObject)}else this.previousParent.add(this.gameObject);const a=this.context.renderer.autoClear,l=this.context.renderer.autoClearColor;this.context.renderer.autoClear=!1,this.context.renderer.autoClearColor=!1,this.context.renderer.clearDepth(),this.onUpdateRenderMode(!0),this.handleLayoutUpdates(),(r=this.shadowComponent)==null||r.updateMatrixWorld(!0),this.invokeBeforeRenderEvents(),pr.ensureUpdateMeshUI(hE,this.context,!0),this.context.renderer.render(this.gameObject,this.context.mainCamera),this.context.renderer.autoClear=a,this.context.renderer.autoClearColor=l,this.previousParent.add(this.gameObject)}(o=this._lastMatrixWorld)==null||o.copy(this.gameObject.matrixWorld)});c(this,"_updateRenderSettingsRoutine");c(this,"_activeRenderMode",-1);c(this,"_lastWidth",-1);c(this,"_lastHeight",-1)}get isCanvas(){return!0}get screenspace(){return this.renderMode!==ua.WorldSpace}set renderOnTop(e){e!==this._renderOnTop&&(this._renderOnTop=e,this.onRenderSettingsChanged())}get renderOnTop(){return this._renderOnTop!==void 0?this._renderOnTop:!!(this.screenspace&&this._renderMode===ua.ScreenSpaceOverlay)}set depthWrite(e){this._depthWrite!==e&&(this._depthWrite=e,this.onRenderSettingsChanged())}get depthWrite(){return this._depthWrite}set doubleSided(e){this._doubleSided!==e&&(this._doubleSided=e,this.onRenderSettingsChanged())}get doubleSided(){return this._doubleSided}set castShadows(e){this._castShadows!==e&&(this._castShadows=e,this.onRenderSettingsChanged())}get castShadows(){return this._castShadows}set receiveShadows(e){this._receiveShadows!==e&&(this._receiveShadows=e,this.onRenderSettingsChanged())}get receiveShadows(){return this._receiveShadows}get renderMode(){return this._renderMode}set renderMode(e){this._renderMode!==e&&(this._renderMode=e,this.onRenderSettingsChanged())}set rootCanvas(e){this._rootCanvas instanceof fn||(this._rootCanvas=e)}get rootCanvas(){return this._rootCanvas}get scaleFactor(){return this._scaleFactor}set scaleFactor(e){this._scaleFactor=e}awake(){var e;this.shadowComponent=this.gameObject,this.previousParent=this.gameObject.parent,Gb&&console.log("Canvas.Awake()",((e=this.previousParent)==null?void 0:e.name)+"/"+this.gameObject.name),super.awake()}start(){this.onUpdateRenderMode()}onEnable(){super.onEnable(),this._updateRenderSettingsRoutine=void 0,this._lastMatrixWorld=new ce,this.onUpdateRenderMode(),document.addEventListener("resize",this._boundRenderSettingsChanged),this.context.pre_render_callbacks.push(this.onBeforeRenderRoutine),this.context.post_render_callbacks.push(this.onAfterRenderRoutine)}onDisable(){super.onDisable(),document.removeEventListener("resize",this._boundRenderSettingsChanged);const e=this.context.pre_render_callbacks.indexOf(this.onBeforeRenderRoutine);e!==-1&&this.context.pre_render_callbacks.splice(e,1);const i=this.context.post_render_callbacks.indexOf(this.onAfterRenderRoutine);i!==-1&&this.context.post_render_callbacks.splice(i,1)}registerTransform(e){this._rectTransforms.push(e)}unregisterTransform(e){const i=this._rectTransforms.indexOf(e);i!==-1&&this._rectTransforms.splice(i,1)}registerLayoutGroup(e){const i=e.gameObject;this._layoutGroups.set(i,e)}unregisterLayoutGroup(e){const i=e.gameObject;this._layoutGroups.delete(i)}registerEventReceiver(e){this._receivers.push(e)}unregisterEventReceiver(e){const i=this._receivers.indexOf(e);i!==-1&&this._receivers.splice(i,1)}async onEnterXR(e){this.screenspace?(e.xr.isVR||e.xr.isPassThrough)&&(this.gameObject.visible=!1):(this.gameObject.visible=!1,await rL(1).then(()=>{this.gameObject.visible=!0}))}onLeaveXR(e){this.screenspace&&(e.xr.isVR||e.xr.isPassThrough)&&(this.gameObject.visible=!0)}invokeBeforeRenderEvents(){var e;for(const i of this._receivers)(e=i.onBeforeCanvasRender)==null||e.call(i,this)}handleLayoutUpdates(){this._lastMatrixWorld===null&&(this._lastMatrixWorld=new ce);const e=!this._lastMatrixWorld.equals(this.gameObject.matrixWorld);Gb&&e&&console.log("Canvas Layout changed",this.context.time.frameCount,this.name);const i=!1;for(const s of this._rectTransforms){e&&s.markDirty();let r=this._layoutGroups.get(s.gameObject);s.isDirty&&!r&&(r=s.gameObject.getComponentInParent(_r)),(s.isDirty||r!=null&&r.isDirty)&&(Gb&&!i&&console.log("CANVAS UPDATE ### "+s.name+" ##################################### "+this.context.time.frame),r==null||r.updateLayout(),s.updateTransform())}}applyRenderSettings(){this.onRenderSettingsChanged()}onRenderSettingsChanged(){this._updateRenderSettingsRoutine||(this._updateRenderSettingsRoutine=this.startCoroutine(this._updateRenderSettingsDelayed(),ze.OnBeforeRender))}*_updateRenderSettingsDelayed(){if(yield,this._updateRenderSettingsRoutine=void 0,this.shadowComponent){this.onUpdateRenderMode(),Ev(this.shadowComponent,this);for(const e of z.getComponentsInChildren(this.gameObject,Fo))Ev(e.shadowComponent,this)}}onUpdateRenderMode(e=!1){if(!e&&this._renderMode===this._activeRenderMode&&this._lastWidth===this.context.domWidth&&this._lastHeight===this.context.domHeight)return;this._activeRenderMode=this._renderMode;let i=this.context.mainCameraComponent,s=10;switch(i&&i.nearClipPlane>0&&i.farClipPlane>0&&(s=Ae.lerp(i.nearClipPlane,i.farClipPlane,.01)),this._renderMode===ua.ScreenSpaceCamera&&(this.worldCamera&&(i=this.worldCamera),this.planeDistance>0&&(s=this.planeDistance)),this._renderMode){case ua.ScreenSpaceOverlay:case ua.ScreenSpaceCamera:if(this._lastWidth=this.context.domWidth,this._lastHeight=this.context.domHeight,!i)return;const r=s+.01;this.gameObject.position.x=0,this.gameObject.position.y=0,this.gameObject.position.z=-r,this.gameObject.quaternion.identity();const o=this.gameObject.getComponent(jn);let a=!1;o.sizeDelta.x!==this.context.domWidth&&(a=!0),o.sizeDelta.y!==this.context.domHeight&&(a=!0);const l=i.fieldOfView*Math.PI/180,h=2*Math.tan(l/2)*Math.abs(r);this.gameObject.scale.x=h/this.context.domHeight,this.gameObject.scale.y=h/this.context.domHeight,this.gameObject.scale.z=.01,a&&(o.sizeDelta.x=this.context.domWidth,o.sizeDelta.y=this.context.domHeight,o==null||o.markDirty());break;case ua.WorldSpace:this._lastWidth=-1,this._lastHeight=-1;break}}}Ga([A()],fn.prototype,"renderOnTop",null);Ga([A()],fn.prototype,"depthWrite",null);Ga([A()],fn.prototype,"doubleSided",null);Ga([A()],fn.prototype,"castShadows",null);Ga([A()],fn.prototype,"receiveShadows",null);Ga([A()],fn.prototype,"renderMode",null);Ga([A(fn)],fn.prototype,"rootCanvas",null);Ga([A()],fn.prototype,"scaleFactor",null);Ga([A(Bt)],fn.prototype,"worldCamera",void 0);Ga([A()],fn.prototype,"planeDistance",void 0);var QC=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};class zh extends se{constructor(){super(...arguments);c(this,"_alpha",1);c(this,"interactable",!0);c(this,"blocksRaycasts",!0);c(this,"_isDirty",!1);c(this,"_buffer",[])}get alpha(){return this._alpha}set alpha(e){e!==this._alpha&&(this._alpha=e,this.markDirty())}get isCanvasGroup(){return!0}markDirty(){this._isDirty||(this._isDirty=!0,this.startCoroutine(this.applyChangesDelayed(),ze.OnBeforeRender))}*applyChangesDelayed(){this._isDirty=!1,this.applyChangesNow()}applyChangesNow(){this._buffer.length=0;for(const e of z.getComponentsInChildren(this.gameObject,Fo,this._buffer)){const i=e;i.setAlphaFactor&&i.setAlphaFactor(this._alpha)}}}QC([A()],zh.prototype,"alpha",null);QC([A()],zh.prototype,"interactable",void 0);QC([A()],zh.prototype,"blocksRaycasts",void 0);var mi=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};const QI=N("debugusdzbehaviours");function Jg(n){n&&(n.getComponentInParent(jg)||(xe()&&console.warn("Create Raycaster on "+n.name+" because no raycaster was found in the hierarchy"),n.addNewComponent(no)))}class ef extends se{constructor(){super(...arguments);c(this,"object");c(this,"target");c(this,"duration",1);c(this,"relativeMotion",!1);c(this,"coroutine",null);c(this,"targetPos",new C);c(this,"targetRot",new ne);c(this,"targetScale",new C)}start(){Jg(this.gameObject)}onPointerClick(e){e.use(),this.coroutine&&this.stopCoroutine(this.coroutine),this.relativeMotion?this.coroutine=this.startCoroutine(this.moveRelative()):this.coroutine=this.startCoroutine(this.moveToTarget())}*moveToTarget(){if(!this.target||!this.object)return;const e=qe(this.object).clone(),i=qe(this.target).clone(),s=Nt(this.object).clone(),r=Nt(this.target).clone(),o=ai(this.object).clone(),a=ai(this.target).clone(),l=e.distanceTo(i),h=s.angleTo(r),u=o.distanceTo(a);if(l<.01&&h<.01&&u<.01){Ts(this.object,i),Oo(this.object,r),lv(this.object,a),this.coroutine=null;return}let d=0,f=0;for(;d<1;)d+=this.context.time.deltaTime/this.duration,d>1&&(d=1),f=d<.5?4*d*d*d:1-Math.pow(-2*d+2,3)/2,this.targetPos.lerpVectors(e,i,f),this.targetRot.slerpQuaternions(s,r,f),this.targetScale.lerpVectors(o,a,f),Ts(this.object,this.targetPos),Oo(this.object,this.targetRot),lv(this.object,this.targetScale),yield;this.coroutine=null}*moveRelative(){if(!this.target||!this.object)return;const e=this.object.position.clone(),i=this.object.quaternion.clone(),s=this.object.scale.clone(),r=this.target.position.clone(),o=this.target.quaternion.clone(),a=this.target.scale.clone();r.applyQuaternion(this.object.quaternion),this.targetPos.copy(this.object.position).add(r),this.targetRot.copy(this.object.quaternion).multiply(o),this.targetScale.copy(this.object.scale).multiply(a);let l=0,h=0;for(;l<1;)l+=this.context.time.deltaTime/this.duration,l>1&&(l=1),h=l<.5?4*l*l*l:1-Math.pow(-2*l+2,3)/2,this.object.position.lerpVectors(e,this.targetPos,h),this.object.quaternion.slerpQuaternions(i,this.targetRot,h),this.object.scale.lerpVectors(s,this.targetScale,h),yield;this.coroutine=null}beforeCreateDocument(e){var i;if(this.target&&this.object&&this.gameObject){const s=new Ki("Move to "+((i=this.target)==null?void 0:i.name),Ln.tapTrigger(this.gameObject),At.transformAction(this.object,this.target,this.duration,this.relativeMotion?"relative":"absolute"));e.addBehavior(s)}}}mi([A(re)],ef.prototype,"object",void 0);mi([A(re)],ef.prototype,"target",void 0);mi([A()],ef.prototype,"duration",void 0);mi([A()],ef.prototype,"relativeMotion",void 0);const bo=class extends se{constructor(){super(...arguments);c(this,"materialToSwitch");c(this,"variantMaterial");c(this,"fadeDuration",0);c(this,"_objectsWithThisMaterial",null);c(this,"selfModel");c(this,"targetModels")}start(){this._objectsWithThisMaterial=this.objectsWithThisMaterial,Jg(this.gameObject)}onPointerClick(e){if(e.use(),!!this.variantMaterial)for(let i=0;i<this.objectsWithThisMaterial.length;i++){const s=this.objectsWithThisMaterial[i];s.material=this.variantMaterial}}get objectsWithThisMaterial(){return this._objectsWithThisMaterial!=null?this._objectsWithThisMaterial:(this._objectsWithThisMaterial=[],this.variantMaterial&&this.materialToSwitch&&this.context.scene.traverse(e=>{if(e instanceof J)if(Array.isArray(e.material)){for(const i of e.material)if(i===this.materialToSwitch){this.objectsWithThisMaterial.push(e);break}}else e.material===this.materialToSwitch&&this.objectsWithThisMaterial.push(e)}),this._objectsWithThisMaterial)}async beforeCreateDocument(e,i){this.targetModels=[],bo._materialTriggersPerId={},bo.variantSwitchIndex=0,this.materialToSwitch&&await ct.assignTextureLOD(this.materialToSwitch,0),this.variantMaterial&&await ct.assignTextureLOD(this.variantMaterial,0)}createBehaviours(e,i,s){this.objectsWithThisMaterial.find(o=>o.uuid===i.uuid)&&this.targetModels.push(i),this.gameObject.uuid===i.uuid&&(this.selfModel=i,this.materialToSwitch&&(bo._materialTriggersPerId[this.materialToSwitch.uuid]||(bo._materialTriggersPerId[this.materialToSwitch.uuid]=[]),bo._materialTriggersPerId[this.materialToSwitch.uuid].push(this)))}afterCreateDocument(e,i){if(!this.materialToSwitch)return;const s=bo._materialTriggersPerId[this.materialToSwitch.uuid];if(s){const r={};for(const o of s){const a=o.createVariants();a&&a.length>0&&(r[o.selfModel.uuid]=a)}for(const o of s){const a=[];for(const l in r)l!==o.selfModel.uuid&&a.push(...r[l]);o.createAndAttachBehaviors(e,r[o.selfModel.uuid],a)}}delete bo._materialTriggersPerId[this.materialToSwitch.uuid]}createAndAttachBehaviors(e,i,s){const r=[],o=[],a=Math.max(0,this.fadeDuration);o.push(At.fadeAction([...this.targetModels,...s],a,!1)),r.push(At.fadeAction(i,a,!1)),o.push(At.fadeAction(i,a,!0)),e.addBehavior(new Ki("Select_"+this.selfModel.name,Ln.tapTrigger(this.selfModel),At.parallel(...o))),e.addBehavior(new Ki("StartHidden_"+this.selfModel.name,Ln.sceneStartTrigger(),At.parallel(...r)))}static getMaterialName(e){return Fa(e.name||"Material")+"_"+e.id}createVariants(){if(!this.variantMaterial)return null;const e=[];for(const i of this.targetModels){const s=i.clone();s.name+="_Variant_"+bo.variantSwitchIndex+++"_"+bo.getMaterialName(this.variantMaterial),s.displayName=s.displayName+": Variant with material "+this.variantMaterial.name,s.material=this.variantMaterial,s.geometry=i.geometry,s.matrix=i.matrix,(!i.parent||!i.parent.isEmpty())&&rs.createEmptyParent(i),i.parent&&i.parent.add(s),e.push(s)}return e}};let gl=bo;c(gl,"_materialTriggersPerId",{}),c(gl,"variantSwitchIndex",0);mi([A(ft)],gl.prototype,"materialToSwitch",void 0);mi([A(ft)],gl.prototype,"variantMaterial",void 0);mi([A()],gl.prototype,"fadeDuration",void 0);const ii=class extends se{constructor(){super(...arguments);c(this,"target");c(this,"toggleOnClick",!1);c(this,"targetState",!0);c(this,"hideSelf",!0);c(this,"selfModel");c(this,"selfModelClone");c(this,"targetModel");c(this,"toggleModel");c(this,"stateBeforeCreatingDocument",!1);c(this,"targetStateBeforeCreatingDocument",!1)}start(){Jg(this.gameObject)}onPointerClick(e){e.use(),!this.toggleOnClick&&this.hideSelf&&(this.gameObject.visible=!1),this.target&&(this.target.visible=this.toggleOnClick?!this.target.visible:this.targetState)}createBehaviours(e,i,s){i.uuid===this.gameObject.uuid&&(this.selfModel=i,this.selfModelClone=i.clone())}beforeCreateDocument(){this.target&&(this.gameObject[ii.wasVisible]===void 0&&(this.gameObject[ii.wasVisible]=this.gameObject.activeSelf),this.target[ii.wasVisible]===void 0&&(this.target[ii.wasVisible]=this.target.activeSelf),this.stateBeforeCreatingDocument=this.gameObject[ii.wasVisible],this.targetStateBeforeCreatingDocument=this.target[ii.wasVisible],this.gameObject.visible=!0,this.target.visible=!0)}afterCreateDocument(e,i){if(!this.target)return;this.targetModel=i.document.findById(this.target.uuid);const s=this.selfModel;if(this.selfModel&&this.targetModel){let r=this.selfModel,o=this.targetState;if(this.toggleOnClick)if(o=!this.targetStateBeforeCreatingDocument,!this.selfModelClone.geometry)(!this.selfModel.parent||this.selfModel.parent.isEmpty())&&eM.createEmptyParent(this.selfModel),this.toggleModel=this.selfModel.deepClone(),this.toggleModel.name+="_toggle",this.selfModel.parent.add(this.toggleModel);else{if(!this.gameObject[ii.toggleClone]){const h=this.selfModelClone.clone();h.matrix.identity(),h.name+="_toggle"+ii.clonedToggleIndex++,s.add(h),this.gameObject[ii.toggleClone]=h,console.warn("USDZExport: Toggle "+this.gameObject.name+" doesn't have geometry. It will be deep cloned and nested behaviours will likely not work.")}const l=this.gameObject[ii.toggleClone];if(!this.gameObject[ii.reverseToggleClone]){const h=this.selfModelClone.clone();h.matrix.identity(),h.name+="_toggleReverse"+ii.clonedToggleIndex++,s.add(h),this.gameObject[ii.reverseToggleClone]=h}this.toggleModel=this.gameObject[ii.reverseToggleClone],(!this.toggleModel.geometry||!l.geometry)&&console.error("triggers without childs and without geometry won't work!",this,s.geometry),r=l,s.geometry=null,s.material=null}if(this.toggleModel){if(this.toggleOnClick){const l=[];l.push(At.fadeAction(r,0,!1)),l.push(At.fadeAction(this.toggleModel,0,!0)),l.push(At.fadeAction(this.targetModel,0,o)),e.addBehavior(new Ki("Toggle_"+r.name+"_toggleTo"+(o?"On":"Off"),Ln.tapTrigger(r),At.parallel(...l)));const h=[];h.push(At.fadeAction(this.toggleModel,0,!1)),h.push(At.fadeAction(r,0,!0)),h.push(At.fadeAction(this.targetModel,0,!o)),e.addBehavior(new Ki("Toggle_"+r.name+"_toggleTo"+(o?"Off":"On"),Ln.tapTrigger(this.toggleModel),At.parallel(...h)))}}else{const l=[];this.hideSelf&&l.push(At.fadeAction(r,0,!1)),l.push(At.fadeAction(this.targetModel,0,o)),e.addBehavior(new Ki("Toggle_"+r.name+"_toggleTo"+(o?"On":"Off"),Ln.tapTrigger(r),At.parallel(...l)))}const a=new Array;this.targetStateBeforeCreatingDocument||a.push(this.targetModel),this.stateBeforeCreatingDocument||a.push(s),this.toggleModel&&a.push(this.toggleModel),e.addBehavior(new Ki("HideOnStart_"+this.gameObject.name,Ln.sceneStartTrigger(),At.fadeAction(a,0,!1)))}}afterSerialize(e,i){this.gameObject[ii.wasVisible]!==void 0&&(this.gameObject.visible=this.gameObject[ii.wasVisible],delete this.gameObject[ii.wasVisible]),this.target&&this.target[ii.wasVisible]!==void 0&&(this.target.visible=this.target[ii.wasVisible],delete this.target[ii.wasVisible]),delete this.gameObject[ii.toggleClone],delete this.gameObject[ii.reverseToggleClone]}};let Vr=ii;c(Vr,"clonedToggleIndex",0),c(Vr,"wasVisible",Symbol("usdz_SetActiveOnClick_wasVisible")),c(Vr,"toggleClone",Symbol("clone for toggling")),c(Vr,"reverseToggleClone",Symbol("clone for reverse toggling"));mi([A(re)],Vr.prototype,"target",void 0);mi([A()],Vr.prototype,"toggleOnClick",void 0);mi([A()],Vr.prototype,"targetState",void 0);mi([A()],Vr.prototype,"hideSelf",void 0);class _k extends se{constructor(){super(...arguments);c(this,"wasVisible",!1)}start(){z.setActive(this.gameObject,!1)}createBehaviours(e,i,s){i.uuid===this.gameObject.uuid&&(this.wasVisible||e.addBehavior(new Ki("HideOnStart_"+this.gameObject.name,Ln.sceneStartTrigger(),At.fadeAction(i,0,!1))))}beforeCreateDocument(){this.wasVisible=z.isActiveSelf(this.gameObject)}}class Zg extends se{constructor(){super(...arguments);c(this,"target");c(this,"duration",.5);c(this,"motionType","bounce")}beforeCreateDocument(){}createBehaviours(e,i,s){if(this.target&&i.uuid===this.gameObject.uuid){const r=new Ki("emphasize "+this.name,Ln.tapTrigger(this.gameObject),At.emphasize(this.target,this.duration,this.motionType,void 0,"basic"));e.addBehavior(r)}}afterCreateDocument(e,i){}}mi([A()],Zg.prototype,"target",void 0);mi([A()],Zg.prototype,"duration",void 0);mi([A()],Zg.prototype,"motionType",void 0);class jh extends se{constructor(){super(...arguments);c(this,"target");c(this,"clip","");c(this,"toggleOnClick",!1);c(this,"trigger","tap")}start(){Jg(this.gameObject)}ensureAudioSource(){if(!this.target){const e=this.gameObject.addNewComponent(kt);e&&(this.target=e,e.spatialBlend=1,e.volume=1,e.loop=!1,e.preload=!0)}}onPointerClick(e){var i;e.use(),!(!((i=this.target)!=null&&i.clip)&&!this.clip)&&(this.ensureAudioSource(),this.target&&(this.target.isPlaying&&this.toggleOnClick?this.target.stop():(!this.toggleOnClick&&this.target.isPlaying&&this.target.stop(),this.clip?this.target.play(this.clip):this.target.play())))}createBehaviours(e,i,s){if(!(!this.target&&!this.clip)&&i.uuid===this.gameObject.uuid){const r=this.clip?this.clip:this.target?this.target.clip:void 0;if(!r||typeof r!="string")return;const o=this.target?this.target.gameObject:this.gameObject;Zh.getName(r);const a=this.target?this.target.volume:1,l=this.target&&this.target.spatialBlend==0?"nonSpatial":"spatial";let h=!1;this.gameObject.traverse(p=>{p instanceof J&&p.visible&&(h=!0)}),h=!0;const u=e.addAudioClip(r);let d=At.playAudioAction(o,u,"play",a,l);this.target&&this.target.loop&&(d=At.sequence(d).makeLooping());const f=this.name?"_"+this.name:"";if(h&&this.trigger==="tap"){this.toggleOnClick&&(d.multiplePerformOperation="stop");const p=new Ki("playAudio"+f,Ln.tapTrigger(i),d);e.addBehavior(p)}if(this.target&&this.target.playOnAwake&&this.target.enabled)if(h&&this.trigger==="tap")console.warn("USDZExport: Audio sources that are played on tap can't also auto-play at scene start due to a QuickLook bug.");else{const p=new Ki("playAudioOnStart"+f,Ln.sceneStartTrigger(),d);e.addBehavior(p)}}}}mi([A(kt)],jh.prototype,"target",void 0);mi([A(URL)],jh.prototype,"clip",void 0);mi([A()],jh.prototype,"toggleOnClick",void 0);const _o=class extends se{constructor(){super(...arguments);c(this,"animator");c(this,"stateName");c(this,"trigger","tap");c(this,"animation");c(this,"selfModel");c(this,"stateAnimationModel");c(this,"animationSequence",new Array);c(this,"animationLoopAfterSequence",new Array)}get target(){var e,i;return((e=this.animator)==null?void 0:e.gameObject)||((i=this.animation)==null?void 0:i.gameObject)}start(){Jg(this.gameObject)}onPointerClick(e){var i;e.use(),this.target&&this.stateName&&((i=this.animator)==null||i.play(this.stateName,0,0,.1))}createBehaviours(e,i,s){i.uuid===this.gameObject.uuid&&(this.selfModel=i)}afterSerialize(){if(_o.rootsWithExclusivePlayback.size>1){const e='Multiple root objects targeted by more than one animation. To work around QuickLook bug FB13410767, animations will be set as "exclusive" and activating them will stop other animations being marked as exclusive.';xe()&&Yt(e),console.warn(e,..._o.rootsWithExclusivePlayback)}_o.animationActions=[],_o.rootsWithExclusivePlayback=new Set}afterCreateDocument(e,i){if(this.animationSequence===void 0&&this.animationLoopAfterSequence===void 0||!this.stateAnimationModel||!this.target)return;const s=i.document,r=i.extensions.find(l=>l instanceof Hy);if(!r)return;const o=r.getClipCount(this.target)>1;o&&(xe()&&console.warn("Setting exclusive playback for "+this.target.name+"@"+this.stateName+" because it has "+r.getClipCount(this.target)+" animations. This works around QuickLook bug FB13410767."),_o.rootsWithExclusivePlayback.add(this.target));const a=this.name?this.name:"";s.traverse(l=>{var h,u;if(l.uuid===((h=this.target)==null?void 0:h.uuid)){const d=_o.getActionForSequences(l,this.animationSequence,this.animationLoopAfterSequence),f=new Ki(this.trigger+"_"+a+"_toPlayAnimation_"+this.stateName+"_on_"+((u=this.target)==null?void 0:u.name),this.trigger=="tap"?Ln.tapTrigger(this.selfModel):Ln.sceneStartTrigger(),d);o&&f.makeExclusive(!0),e.addBehavior(f)}})}static getActionForSequences(e,i,s){const r=(a,l)=>{let h=_o.animationActions.find(u=>u.affectedObjects==a&&u.start==l.start&&u.duration==l.duration&&u.animationSpeed==l.speed);return h||(h=At.startAnimationAction(a,l.start,l.duration,l.speed),_o.animationActions.push(h)),h},o=At.sequence();if(i&&i.length>0)for(const a of i)o.addAction(r(e,a));if(s&&s.length>0){const a=o.actions.length==0?o:At.sequence();for(const l of s)a.addAction(r(e,l));a.makeLooping(),o!==a&&o.addAction(a)}return o}static getAndRegisterAnimationSequences(e,i,s){var g,m,v,y,b;if(!i)return;const r=i.getComponent(zn),o=i.getComponent(Ps);if(!r&&!o)return;if(r&&!s)throw new Error("PlayAnimationOnClick: No stateName specified for animator "+r.name+" on "+i.name);let a=[],l=[];if(o){const _=e.registerAnimation(i,o.clip);return _&&(o.loop?l.push(_):a.push(_)),{animationSequence:a,animationLoopAfterSequence:l}}const h=r==null?void 0:r.runtimeAnimatorController;let u=h==null?void 0:h.findState(s),d=[],f=[];if(h&&u){const _=new Array;_.push(u);let x=!1;for(;_.length<100;){if(!u||u===null||!u.transitions||u.transitions.length===0){(g=u.motion)!=null&&g.isLooping&&(x=!0);break}const S=u.transitions.find(L=>L.conditions.length===0),T=S?h.getState(S.destinationState,0):null;if(T&&_.includes(T)){u=T,x=!0;break}else if(S){if(u=T,!u)break;_.push(u)}else{x=((m=u.motion)==null?void 0:m.isLooping)??!1;break}}if(x&&u){const S=_.indexOf(u);d=_.slice(0,S),f=_.slice(S),QI&&console.log("found loop from "+s,"states until loop",d,"states looping",f)}else d=_,f=[],QI&&console.log("found no loop from "+s,"states",d)}if(d.length===1&&(!((v=d[0].motion)!=null&&v.clip)||((b=(y=d[0].motion)==null?void 0:y.clip.tracks)==null?void 0:b.length)===0)){a=new Array;const _=e.registerAnimation(i,null);_&&a.push(_);return}if(d=d.filter(_=>{var x,S,T;return((x=_.motion)==null?void 0:x.clip)&&((T=(S=_.motion)==null?void 0:S.clip.tracks)==null?void 0:T.length)>0}),f=f.filter(_=>{var x,S,T;return((x=_.motion)==null?void 0:x.clip)&&((T=(S=_.motion)==null?void 0:S.clip.tracks)==null?void 0:T.length)>0}),d.length===0&&f.length===0){console.warn("No clips found for state "+s+" on "+(r==null?void 0:r.name)+", can't export animation data");return}const p=(_,x)=>{if(!i)return;const S=e.registerAnimation(i,_.motion.clip??null);S?(S.speed=_.speed,x.push(S)):console.warn("Couldn't register animation for state "+_.name+" on "+(r==null?void 0:r.name))};if(d.length>0){a=new Array;for(const _ of d)p(_,a)}if(f.length>0){l=new Array;for(const _ of f)p(_,l)}return{animationSequence:a,animationLoopAfterSequence:l}}createAnimation(e,i,s){if(!this.target||!this.animator&&!this.animation)return;const r=_o.getAndRegisterAnimationSequences(e,this.target,this.stateName);r&&(this.animationSequence=r.animationSequence,this.animationLoopAfterSequence=r.animationLoopAfterSequence,this.stateAnimationModel=i)}};let Ia=_o;c(Ia,"animationActions",[]),c(Ia,"rootsWithExclusivePlayback",new Set);mi([A(zn)],Ia.prototype,"animator",void 0);mi([A()],Ia.prototype,"stateName",void 0);class $g extends se{constructor(){super(...arguments);c(this,"target")}getType(){}getDuration(){}}mi([A(re)],$g.prototype,"target",void 0);class $y extends se{constructor(){super(...arguments);c(this,"target")}}mi([A($g)],$y.prototype,"target",void 0);class e0 extends $g{constructor(){super(...arguments);c(this,"type",Pp.Hide);c(this,"duration",1)}getType(){switch(this.type){case Pp.Hide:return"hide";case Pp.Show:return"show"}}getDuration(){return this.duration}}mi([A()],e0.prototype,"type",void 0);mi([A()],e0.prototype,"duration",void 0);class wk extends $y{}var Pp;(function(n){n[n.Show=0]="Show",n[n.Hide=1]="Hide"})(Pp||(Pp={}));var Dl=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};const zI=N("debugcharactercontroller");class tf extends se{constructor(){super(...arguments);c(this,"center",new C(0,0,0));c(this,"radius",.5);c(this,"height",2);c(this,"_rigidbody",null);c(this,"_activeGroundCollisions");c(this,"_contactVelocity",new C)}get rigidbody(){return this._rigidbody?this._rigidbody:(this._rigidbody=this.gameObject.getComponent(Pt),this._rigidbody||(this._rigidbody=this.gameObject.addNewComponent(Pt)),this.rigidbody)}awake(){this._activeGroundCollisions=new Set}onEnable(){const e=this.rigidbody;let i=this.gameObject.getComponent(Oc);i||(i=this.gameObject.addNewComponent(Oc)),i.center.copy(this.center),i.radius=this.radius,i.height=this.height;const s=new C(0,0,1),r=new C(1,0,0),o=new C(0,1,0),a=this.gameObject.getWorldDirection(new C);a.y=0;const l=r.dot(a)<0?-1:1,h=s.angleTo(a)*l;this.gameObject.setRotationFromAxisAngle(o,h),e.lockRotationX=!0,e.lockRotationY=!0,e.lockRotationZ=!0}move(e){this.gameObject.position.add(e)}onCollisionEnter(e){(e.contacts.length==0||e.contacts.some(i=>i.normal.y>.2))&&(this._activeGroundCollisions.add(e),zI&&console.log(`Collision(${this._activeGroundCollisions.size}): ${e.contacts.map(i=>i.normal.y.toFixed(2)).join(", ")} - ${this.isGrounded}`))}onCollisionExit(e){this._activeGroundCollisions.delete(e),zI&&console.log(`Collision(${this._activeGroundCollisions.size}) - ${this.isGrounded}`)}get isGrounded(){return this._activeGroundCollisions.size>0}get contactVelocity(){var e;this._contactVelocity.set(0,0,0);for(const i of this._activeGroundCollisions){const s=(e=this.context.physics.engine)==null?void 0:e.getLinearVelocity(i.collider);s&&(this._contactVelocity.x+=s.x,this._contactVelocity.y+=s.y,this._contactVelocity.z+=s.z)}return this._contactVelocity}}Dl([A(C)],tf.prototype,"center",void 0);Dl([A()],tf.prototype,"radius",void 0);Dl([A()],tf.prototype,"height",void 0);class Hc extends se{constructor(){super(...arguments);c(this,"controller");c(this,"movementSpeed",2);c(this,"rotationSpeed",2);c(this,"jumpForce",1);c(this,"doubleJumpForce",2);c(this,"animator");c(this,"lookForward",!0);c(this,"lookInput",new ae(0,0));c(this,"moveInput",new ae(0,0));c(this,"jumpInput",!1);c(this,"_currentSpeed",new C(0,0,0));c(this,"_currentAngularSpeed",new C(0,0,0));c(this,"_temp",new C(0,0,0));c(this,"_jumpCount",0);c(this,"_currentRotation");c(this,"_raycastOptions",new Lo)}awake(){this._currentRotation=new ne}update(){const e=this.context.input;e.isKeyPressed("KeyW")?this.moveInput.y+=1:e.isKeyPressed("KeyS")&&(this.moveInput.y-=1),e.isKeyPressed("KeyD")?this.lookInput.x+=1:e.isKeyPressed("KeyA")&&(this.lookInput.x-=1),this.jumpInput||(this.jumpInput=e.isKeyDown("Space"))}move(e){this.moveInput.add(e)}look(e){this.lookInput.add(e)}jump(){this.jumpInput=!0}onBeforeRender(){this.handleInput(this.moveInput,this.lookInput,this.jumpInput),this.lookInput.set(0,0),this.moveInput.set(0,0),this.jumpInput=!1}handleInput(e,i,s){var r,o,a,l,h,u,d,f,p,g,m;if((r=this.controller)!=null&&r.isGrounded&&(this._jumpCount=0,this.doubleJumpForce>0&&((o=this.animator)==null||o.setBool("doubleJump",!1))),this._currentSpeed.z+=e.y*this.movementSpeed*this.context.time.deltaTime,(a=this.animator)==null||a.setBool("running",e.length()>.01),(h=this.animator)==null||h.setBool("jumping",((l=this.controller)==null?void 0:l.isGrounded)===!0&&s),this._temp.copy(this._currentSpeed),this._temp.applyQuaternion(this.gameObject.quaternion),this.controller?this.controller.move(this._temp):this.gameObject.position.add(this._temp),this._currentAngularSpeed.y+=Ae.toRadians(-i.x*this.rotationSpeed)*this.context.time.deltaTime,this.lookForward&&Math.abs(this._currentAngularSpeed.y)<.01){const v=this.context.mainCameraComponent.forward;v.y=0,v.normalize(),this._currentRotation.setFromUnitVectors(new C(0,0,1),v),this.gameObject.quaternion.slerp(this._currentRotation,this.context.time.deltaTime*10)}if(this.gameObject.rotateY(this._currentAngularSpeed.y),this._currentSpeed.multiplyScalar(1-this.context.time.deltaTime*10),this._currentAngularSpeed.y*=1-this.context.time.deltaTime*10,this.controller&&s&&this.jumpForce>0){let v=(u=this.controller)==null?void 0:u.isGrounded;if(this.doubleJumpForce>0&&!((d=this.controller)!=null&&d.isGrounded)&&this._jumpCount===1&&(v=!0,(f=this.animator)==null||f.setBool("doubleJump",!0)),v){this._jumpCount+=1;const y=this.controller.rigidbody,b=this._jumpCount===2?this.doubleJumpForce:this.jumpForce;y.applyImpulse(new C(0,1,0).multiplyScalar(b))}}if(this.controller){const v=(p=this.controller)==null?void 0:p.rigidbody.getVelocity().y;if(v<-1){this._raycastOptions.ray||(this._raycastOptions.ray=new Lc),this._raycastOptions.ray.origin.copy(qe(this.gameObject)),this._raycastOptions.ray.direction.set(0,-1,0);const y=this.layer;this.gameObject.layers.disableAll(),this.gameObject.layers.set(2);const b=this.context.physics.raycast(this._raycastOptions);this.gameObject.layers.set(y),(b.length&&b[0].distance>2||v<-10)&&((g=this.animator)==null||g.setBool("falling",!0))}else(m=this.animator)==null||m.setBool("falling",!1)}}}Dl([A(tf)],Hc.prototype,"controller",void 0);Dl([A()],Hc.prototype,"movementSpeed",void 0);Dl([A()],Hc.prototype,"rotationSpeed",void 0);Dl([A()],Hc.prototype,"jumpForce",void 0);Dl([A()],Hc.prototype,"doubleJumpForce",void 0);Dl([A(zn)],Hc.prototype,"animator",void 0);var gH=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};class t0 extends Ds{constructor(){super(...arguments);c(this,"intensity")}get typeName(){return"ChromaticAberration"}init(){this.intensity.defaultValue=0}onCreateEffect(){const e=new SM;return e.offset=new ae(0,0),e.radialModulation=!0,e.modulationOffset=.15,this.intensity.valueProcessor=i=>i*.02,this.intensity.onValueChanged=i=>{e.offset.x=-i,e.offset.y=i},e}}gH([A(je)],t0.prototype,"intensity",void 0);zo("ChromaticAberration",t0);new Vh(-1,1,1,-1,0,1);class mH extends jt{constructor(){super(),this.setAttribute("position",new hn([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new hn([0,2,0,0,2,0],2))}}new mH;const em=new jt;em.setAttribute("position",new Ve(new Float32Array([-1,-1,3,-1,-1,3]),2));em.setAttribute("uv",new Ve(new Float32Array([0,0,2,0,0,2]),2));em.boundingSphere=new Wh;em.computeBoundingSphere=function(){};const AH=new Vh;class eh{constructor(t){this._mesh=new J(em,t),this._mesh.frustumCulled=!1}render(t){t.render(this._mesh,AH)}get material(){return this._mesh.material}set material(t){this._mesh.material=t}dispose(){this._mesh.material.dispose(),this._mesh.geometry.dispose()}}const vH={uniforms:{sceneDiffuse:{value:null},sceneDepth:{value:null},sceneNormal:{value:null},projMat:{value:new ce},viewMat:{value:new ce},projViewMat:{value:new ce},projectionMatrixInv:{value:new ce},viewMatrixInv:{value:new ce},cameraPos:{value:new C},resolution:{value:new ae},time:{value:0},samples:{value:[]},bluenoise:{value:null},distanceFalloff:{value:1},radius:{value:5},near:{value:.1},far:{value:1e3},logDepth:{value:!1},ortho:{value:!1},screenSpaceRadius:{value:!1},frame:{value:0}},depthWrite:!1,depthTest:!1,vertexShader:`
varying vec2 vUv;
void main() {
  vUv = uv;
  gl_Position = vec4(position, 1);
}`,fragmentShader:`
    #define SAMPLES 16
    #define FSAMPLES 16.0
uniform sampler2D sceneDiffuse;
uniform highp sampler2D sceneNormal;
uniform highp sampler2D sceneDepth;
uniform mat4 projectionMatrixInv;
uniform mat4 viewMatrixInv;
uniform mat4 projMat;
uniform mat4 viewMat;
uniform mat4 projViewMat;
uniform vec3 cameraPos;
uniform vec2 resolution;
uniform float time;
uniform vec3[SAMPLES] samples;
uniform float radius;
uniform float distanceFalloff;
uniform float near;
uniform float far;
uniform float frame;
uniform bool logDepth;
uniform bool ortho;
uniform bool screenSpaceRadius;
uniform sampler2D bluenoise;
    varying vec2 vUv;
    highp float linearize_depth(highp float d, highp float zNear,highp float zFar)
    {
        return (zFar * zNear) / (zFar - d * (zFar - zNear));
    }
    highp float linearize_depth_ortho(highp float d, highp float nearZ, highp float farZ) {
      return nearZ + (farZ - nearZ) * d;
    }
    highp float linearize_depth_log(highp float d, highp float nearZ,highp float farZ) {
      float depth = pow(2.0, d * log2(farZ + 1.0)) - 1.0;
      float a = farZ / (farZ - nearZ);
      float b = farZ * nearZ / (nearZ - farZ);
      float linDepth = a + b / depth;
      return ortho ? linearize_depth_ortho(
        linDepth,
        nearZ,
        farZ
      ) :linearize_depth(linDepth, nearZ, farZ);
    }

    vec3 getWorldPosLog(vec3 posS) {
      vec2 uv = posS.xy;
      float z = posS.z;
      float nearZ =near;
      float farZ = far;
      float depth = pow(2.0, z * log2(farZ + 1.0)) - 1.0;
      float a = farZ / (farZ - nearZ);
      float b = farZ * nearZ / (nearZ - farZ);
      float linDepth = a + b / depth;
      vec4 clipVec = vec4(uv, linDepth, 1.0) * 2.0 - 1.0;
      vec4 wpos = projectionMatrixInv * clipVec;
      return wpos.xyz / wpos.w;
    }
    vec3 getWorldPos(float depth, vec2 coord) {
      #ifdef LOGDEPTH
        return getWorldPosLog(vec3(coord, depth));
      #endif
      float z = depth * 2.0 - 1.0;
      vec4 clipSpacePosition = vec4(coord * 2.0 - 1.0, z, 1.0);
      vec4 viewSpacePosition = projectionMatrixInv * clipSpacePosition;
      // Perspective division
     vec4 worldSpacePosition = viewSpacePosition;
     worldSpacePosition.xyz /= worldSpacePosition.w;
      return worldSpacePosition.xyz;
  }

  vec3 computeNormal(vec3 worldPos, vec2 vUv) {
    ivec2 p = ivec2(vUv * resolution);
    float c0 = texelFetch(sceneDepth, p, 0).x;
    float l2 = texelFetch(sceneDepth, p - ivec2(2, 0), 0).x;
    float l1 = texelFetch(sceneDepth, p - ivec2(1, 0), 0).x;
    float r1 = texelFetch(sceneDepth, p + ivec2(1, 0), 0).x;
    float r2 = texelFetch(sceneDepth, p + ivec2(2, 0), 0).x;
    float b2 = texelFetch(sceneDepth, p - ivec2(0, 2), 0).x;
    float b1 = texelFetch(sceneDepth, p - ivec2(0, 1), 0).x;
    float t1 = texelFetch(sceneDepth, p + ivec2(0, 1), 0).x;
    float t2 = texelFetch(sceneDepth, p + ivec2(0, 2), 0).x;

    float dl = abs((2.0 * l1 - l2) - c0);
    float dr = abs((2.0 * r1 - r2) - c0);
    float db = abs((2.0 * b1 - b2) - c0);
    float dt = abs((2.0 * t1 - t2) - c0);

    vec3 ce = getWorldPos(c0, vUv).xyz;

    vec3 dpdx = (dl < dr) ? ce - getWorldPos(l1, (vUv - vec2(1.0 / resolution.x, 0.0))).xyz
                          : -ce + getWorldPos(r1, (vUv + vec2(1.0 / resolution.x, 0.0))).xyz;
    vec3 dpdy = (db < dt) ? ce - getWorldPos(b1, (vUv - vec2(0.0, 1.0 / resolution.y))).xyz
                          : -ce + getWorldPos(t1, (vUv + vec2(0.0, 1.0 / resolution.y))).xyz;

    return normalize(cross(dpdx, dpdy));
}

mat3 makeRotationZ(float theta) {
	float c = cos(theta);
	float s = sin(theta);
	return mat3(c, - s, 0,
			s,  c, 0,
			0,  0, 1);
  }

void main() {
      vec4 diffuse = texture2D(sceneDiffuse, vUv);
      float depth = texture2D(sceneDepth, vUv).x;
      if (depth == 1.0) {
        gl_FragColor = vec4(vec3(1.0), 1.0);
        return;
      }
      vec3 worldPos = getWorldPos(depth, vUv);
      #ifdef HALFRES
        vec3 normal = texture2D(sceneNormal, vUv).rgb;
      #else
        vec3 normal = computeNormal(worldPos, vUv);
      #endif
      vec4 noise = texture2D(bluenoise, gl_FragCoord.xy / 128.0);
      vec2 harmoniousNumbers = vec2(
        1.618033988749895,
        1.324717957244746
      );
      noise.rg += harmoniousNumbers * frame;
      noise.rg = fract(noise.rg);
        vec3 helperVec = vec3(0.0, 1.0, 0.0);
        if (dot(helperVec, normal) > 0.99) {
          helperVec = vec3(1.0, 0.0, 0.0);
        }
        vec3 tangent = normalize(cross(helperVec, normal));
        vec3 bitangent = cross(normal, tangent);
        mat3 tbn = mat3(tangent, bitangent, normal) *  makeRotationZ(noise.r * 2.0 * 3.1415962) ;

      float occluded = 0.0;
      float totalWeight = 0.0;
      float radiusToUse = screenSpaceRadius ? distance(
        worldPos,
        getWorldPos(depth, vUv +
          vec2(radius, 0.0) / resolution)
      ) : radius;
      float distanceFalloffToUse =screenSpaceRadius ?
          radiusToUse * distanceFalloff
      : radiusToUse * distanceFalloff * 0.2;
      float bias = (min(
        0.1,
        distanceFalloffToUse * 0.1
      ) / near) * fwidth(distance(worldPos, cameraPos)) / radiusToUse;
      float phi = 1.61803398875;
      float offsetMove = 0.0;
      float offsetMoveInv = 1.0 / FSAMPLES;
      for(float i = 0.0; i < FSAMPLES; i++) {
        vec3 sampleDirection = tbn * samples[int(i)];

        float moveAmt = fract(noise.g + offsetMove);
        offsetMove += offsetMoveInv;

        vec3 samplePos = worldPos + radiusToUse * moveAmt * sampleDirection;
        vec4 offset = projMat * vec4(samplePos, 1.0);
        offset.xyz /= offset.w;
        offset.xyz = offset.xyz * 0.5 + 0.5;
        
        vec2 diff = gl_FragCoord.xy - floor(offset.xy * resolution);
        // From Rabbid76's hbao
        vec2 clipRangeCheck = step(vec2(0.0),offset.xy) * step(offset.xy, vec2(1.0));
          float sampleDepth = textureLod(sceneDepth, offset.xy, 0.0).x;

          #ifdef LOGDEPTH

          float distSample = linearize_depth_log(sampleDepth, near, far);

          #else

          float distSample = ortho ? linearize_depth_ortho(sampleDepth, near, far) : linearize_depth(sampleDepth, near, far);

          #endif

          float distWorld = ortho ? linearize_depth_ortho(offset.z, near, far) : linearize_depth(offset.z, near, far);
          
          float rangeCheck = distSample == distWorld ? 0.0 : smoothstep(0.0, 1.0, distanceFalloffToUse / (abs(distSample - distWorld)));
          
          float sampleValid = (clipRangeCheck.x * clipRangeCheck.y);
          occluded += rangeCheck * float(sampleDepth != depth) * float(distSample + bias < distWorld) * step(
            1.0,
            dot(diff, diff)
          ) * sampleValid;
          
          totalWeight += sampleValid;
      }
      float occ = clamp(1.0 - occluded / (totalWeight == 0.0 ? 1.0 : totalWeight), 0.0, 1.0);
      gl_FragColor = vec4(occ, 0.5 + 0.5 * normal);
}`},yH={uniforms:{sceneDiffuse:{value:null},sceneDepth:{value:null},tDiffuse:{value:null},transparencyDWFalse:{value:null},transparencyDWTrue:{value:null},transparencyDWTrueDepth:{value:null},transparencyAware:{value:!1},projMat:{value:new ce},viewMat:{value:new ce},projectionMatrixInv:{value:new ce},viewMatrixInv:{value:new ce},cameraPos:{value:new C},resolution:{value:new ae},color:{value:new C(0,0,0)},blueNoise:{value:null},downsampledDepth:{value:null},time:{value:0},intensity:{value:10},renderMode:{value:0},gammaCorrection:{value:!1},logDepth:{value:!1},ortho:{value:!1},near:{value:.1},far:{value:1e3},screenSpaceRadius:{value:!1},radius:{value:0},distanceFalloff:{value:1},fog:{value:!1},fogExp:{value:!1},fogDensity:{value:0},fogNear:{value:1/0},fogFar:{value:1/0},colorMultiply:{value:!0}},depthWrite:!1,depthTest:!1,vertexShader:`
		varying vec2 vUv;
		void main() {
			vUv = uv;
			gl_Position = vec4(position, 1);
		}`,fragmentShader:`
		uniform sampler2D sceneDiffuse;
    uniform highp sampler2D sceneDepth;
    uniform highp sampler2D downsampledDepth;
    uniform highp sampler2D transparencyDWFalse;
    uniform highp sampler2D transparencyDWTrue;
    uniform highp sampler2D transparencyDWTrueDepth;
    uniform sampler2D tDiffuse;
    uniform sampler2D blueNoise;
    uniform vec2 resolution;
    uniform vec3 color;
    uniform mat4 projectionMatrixInv;
    uniform mat4 viewMatrixInv;
    uniform float intensity;
    uniform float renderMode;
    uniform float near;
    uniform float far;
    uniform bool gammaCorrection;
    uniform bool logDepth;
    uniform bool ortho;
    uniform bool screenSpaceRadius;
    uniform bool fog;
    uniform bool fogExp;
    uniform bool colorMultiply;
    uniform bool transparencyAware;
    uniform float fogDensity;
    uniform float fogNear;
    uniform float fogFar;
    uniform float radius;
    uniform float distanceFalloff;
    uniform vec3 cameraPos;
    varying vec2 vUv;
    highp float linearize_depth(highp float d, highp float zNear,highp float zFar)
    {
        return (zFar * zNear) / (zFar - d * (zFar - zNear));
    }
    highp float linearize_depth_ortho(highp float d, highp float nearZ, highp float farZ) {
      return nearZ + (farZ - nearZ) * d;
    }
    highp float linearize_depth_log(highp float d, highp float nearZ,highp float farZ) {
      float depth = pow(2.0, d * log2(farZ + 1.0)) - 1.0;
      float a = farZ / (farZ - nearZ);
      float b = farZ * nearZ / (nearZ - farZ);
      float linDepth = a + b / depth;
      return ortho ? linearize_depth_ortho(
        linDepth,
        nearZ,
        farZ
      ) :linearize_depth(linDepth, nearZ, farZ);
    }
    vec3 getWorldPosLog(vec3 posS) {
        vec2 uv = posS.xy;
        float z = posS.z;
        float nearZ =near;
        float farZ = far;
        float depth = pow(2.0, z * log2(farZ + 1.0)) - 1.0;
        float a = farZ / (farZ - nearZ);
        float b = farZ * nearZ / (nearZ - farZ);
        float linDepth = a + b / depth;
        vec4 clipVec = vec4(uv, linDepth, 1.0) * 2.0 - 1.0;
        vec4 wpos = projectionMatrixInv * clipVec;
        return wpos.xyz / wpos.w;
      }
      vec3 getWorldPos(float depth, vec2 coord) {
       // if (logDepth) {
        #ifdef LOGDEPTH
          return getWorldPosLog(vec3(coord, depth));
        #endif
      //  }
        float z = depth * 2.0 - 1.0;
        vec4 clipSpacePosition = vec4(coord * 2.0 - 1.0, z, 1.0);
        vec4 viewSpacePosition = projectionMatrixInv * clipSpacePosition;
        // Perspective division
       vec4 worldSpacePosition = viewSpacePosition;
       worldSpacePosition.xyz /= worldSpacePosition.w;
        return worldSpacePosition.xyz;
    }
  
    vec3 computeNormal(vec3 worldPos, vec2 vUv) {
      ivec2 p = ivec2(vUv * resolution);
      float c0 = texelFetch(sceneDepth, p, 0).x;
      float l2 = texelFetch(sceneDepth, p - ivec2(2, 0), 0).x;
      float l1 = texelFetch(sceneDepth, p - ivec2(1, 0), 0).x;
      float r1 = texelFetch(sceneDepth, p + ivec2(1, 0), 0).x;
      float r2 = texelFetch(sceneDepth, p + ivec2(2, 0), 0).x;
      float b2 = texelFetch(sceneDepth, p - ivec2(0, 2), 0).x;
      float b1 = texelFetch(sceneDepth, p - ivec2(0, 1), 0).x;
      float t1 = texelFetch(sceneDepth, p + ivec2(0, 1), 0).x;
      float t2 = texelFetch(sceneDepth, p + ivec2(0, 2), 0).x;
  
      float dl = abs((2.0 * l1 - l2) - c0);
      float dr = abs((2.0 * r1 - r2) - c0);
      float db = abs((2.0 * b1 - b2) - c0);
      float dt = abs((2.0 * t1 - t2) - c0);
  
      vec3 ce = getWorldPos(c0, vUv).xyz;
  
      vec3 dpdx = (dl < dr) ? ce - getWorldPos(l1, (vUv - vec2(1.0 / resolution.x, 0.0))).xyz
                            : -ce + getWorldPos(r1, (vUv + vec2(1.0 / resolution.x, 0.0))).xyz;
      vec3 dpdy = (db < dt) ? ce - getWorldPos(b1, (vUv - vec2(0.0, 1.0 / resolution.y))).xyz
                            : -ce + getWorldPos(t1, (vUv + vec2(0.0, 1.0 / resolution.y))).xyz;
  
      return normalize(cross(dpdx, dpdy));
  }

    #include <common>
    #include <dithering_pars_fragment>
    void main() {
        //vec4 texel = texture2D(tDiffuse, vUv);//vec3(0.0);
        vec4 sceneTexel = texture2D(sceneDiffuse, vUv);
        float depth = texture2D(
            sceneDepth,
            vUv
        ).x;
        #ifdef HALFRES 
        vec4 texel;
        if (depth == 1.0) {
            texel = vec4(0.0, 0.0, 0.0, 1.0);
        } else {
        vec3 worldPos = getWorldPos(depth, vUv);
        vec3 normal = computeNormal(getWorldPos(depth, vUv), vUv);
       // vec4 texel = texture2D(tDiffuse, vUv);
       // Find closest depth;
       float totalWeight = 0.0;
       float radiusToUse = screenSpaceRadius ? distance(
        worldPos,
        getWorldPos(depth, vUv +
          vec2(radius, 0.0) / resolution)
      ) : radius;
      float distanceFalloffToUse =screenSpaceRadius ?
          radiusToUse * distanceFalloff
      : distanceFalloff;
        for(float x = -1.0; x <= 1.0; x++) {
            for(float y = -1.0; y <= 1.0; y++) {
                vec2 offset = vec2(x, y);
                ivec2 p = ivec2(
                    (vUv * resolution * 0.5) + offset
                );
                vec2 pUv = vec2(p) / (resolution * 0.5);
                float sampleDepth = texelFetch(downsampledDepth,p, 0).x;
                vec4 sampleInfo = texelFetch(tDiffuse, p, 0);
                vec3 normalSample = sampleInfo.gba * 2.0 - 1.0;
                vec3 worldPosSample = getWorldPos(sampleDepth, pUv);
                float tangentPlaneDist = abs(dot(worldPosSample - worldPos, normal));
                float rangeCheck = exp(-1.0 * tangentPlaneDist * (1.0 / distanceFalloffToUse)) * max(dot(normal, normalSample), 0.0);
                float weight = rangeCheck;
                totalWeight += weight;
                texel += sampleInfo * weight;
            }
        }
        if (totalWeight == 0.0) {
            texel = texture2D(tDiffuse, vUv);
        } else {
            texel /= totalWeight;
        }
    }
        #else
        vec4 texel = texture2D(tDiffuse, vUv);
        #endif

        #ifdef LOGDEPTH
        texel.r = clamp(texel.r, 0.0, 1.0);
        if (texel.r == 0.0) {
          texel.r = 1.0;
        }
        #endif
     
        float finalAo = pow(texel.r, intensity);
        float fogFactor;
        float fogDepth = distance(
            cameraPos,
            getWorldPos(depth, vUv)
        );
        if (fog) {
            if (fogExp) {
                fogFactor = 1.0 - exp( - fogDensity * fogDensity * fogDepth * fogDepth );
            } else {
                fogFactor = smoothstep( fogNear, fogFar, fogDepth );
            }
        }
        if (transparencyAware) {
            float transparencyDWOff = texture2D(transparencyDWFalse, vUv).a;
            float transparencyDWOn = texture2D(transparencyDWTrue, vUv).a;
            float adjustmentFactorOff = transparencyDWOff;
            float adjustmentFactorOn = (1.0 - transparencyDWOn) * (
                texture2D(transparencyDWTrueDepth, vUv).r == texture2D(sceneDepth, vUv).r ? 1.0 : 0.0
            );
            float adjustmentFactor = max(adjustmentFactorOff, adjustmentFactorOn);
            finalAo = mix(finalAo, 1.0, adjustmentFactor);
        }
        finalAo = mix(finalAo, 1.0, fogFactor);
        vec3 aoApplied = color * mix(vec3(1.0), sceneTexel.rgb, float(colorMultiply));
        if (renderMode == 0.0) {
            gl_FragColor = vec4( mix(sceneTexel.rgb, aoApplied, 1.0 - finalAo), sceneTexel.a);
        } else if (renderMode == 1.0) {
            gl_FragColor = vec4( mix(vec3(1.0), aoApplied, 1.0 - finalAo), sceneTexel.a);
        } else if (renderMode == 2.0) {
            gl_FragColor = vec4( sceneTexel.rgb, sceneTexel.a);
        } else if (renderMode == 3.0) {
            if (vUv.x < 0.5) {
                gl_FragColor = vec4( sceneTexel.rgb, sceneTexel.a);
            } else if (abs(vUv.x - 0.5) < 1.0 / resolution.x) {
                gl_FragColor = vec4(1.0);
            } else {
                gl_FragColor = vec4( mix(sceneTexel.rgb, aoApplied, 1.0 - finalAo), sceneTexel.a);
            }
        } else if (renderMode == 4.0) {
            if (vUv.x < 0.5) {
                gl_FragColor = vec4( sceneTexel.rgb, sceneTexel.a);
            } else if (abs(vUv.x - 0.5) < 1.0 / resolution.x) {
                gl_FragColor = vec4(1.0);
            } else {
                gl_FragColor = vec4( mix(vec3(1.0), aoApplied, 1.0 - finalAo), sceneTexel.a);
            }
        }
        #include <dithering_fragment>
        if (gammaCorrection) {
            gl_FragColor = LinearTosRGB(gl_FragColor);
        }
    }
    `},bH={uniforms:{sceneDiffuse:{value:null},sceneDepth:{value:null},tDiffuse:{value:null},projMat:{value:new ce},viewMat:{value:new ce},projectionMatrixInv:{value:new ce},viewMatrixInv:{value:new ce},cameraPos:{value:new C},resolution:{value:new ae},time:{value:0},r:{value:5},blueNoise:{value:null},radius:{value:12},worldRadius:{value:5},index:{value:0},poissonDisk:{value:[]},distanceFalloff:{value:1},near:{value:.1},far:{value:1e3},logDepth:{value:!1},screenSpaceRadius:{value:!1}},depthWrite:!1,depthTest:!1,vertexShader:`
		varying vec2 vUv;
		void main() {
			vUv = uv;
			gl_Position = vec4(position, 1.0);
		}`,fragmentShader:`
		uniform sampler2D sceneDiffuse;
    uniform highp sampler2D sceneDepth;
    uniform sampler2D tDiffuse;
    uniform sampler2D blueNoise;
    uniform mat4 projectionMatrixInv;
    uniform mat4 viewMatrixInv;
    uniform vec2 resolution;
    uniform float r;
    uniform float radius;
     uniform float worldRadius;
    uniform float index;
     uniform float near;
     uniform float far;
     uniform float distanceFalloff;
     uniform bool logDepth;
     uniform bool screenSpaceRadius;
    varying vec2 vUv;

    highp float linearize_depth(highp float d, highp float zNear,highp float zFar)
    {
        highp float z_n = 2.0 * d - 1.0;
        return 2.0 * zNear * zFar / (zFar + zNear - z_n * (zFar - zNear));
    }
    highp float linearize_depth_log(highp float d, highp float nearZ,highp float farZ) {
     float depth = pow(2.0, d * log2(farZ + 1.0)) - 1.0;
     float a = farZ / (farZ - nearZ);
     float b = farZ * nearZ / (nearZ - farZ);
     float linDepth = a + b / depth;
     return linearize_depth(linDepth, nearZ, farZ);
   }
   highp float linearize_depth_ortho(highp float d, highp float nearZ, highp float farZ) {
     return nearZ + (farZ - nearZ) * d;
   }
   vec3 getWorldPosLog(vec3 posS) {
     vec2 uv = posS.xy;
     float z = posS.z;
     float nearZ =near;
     float farZ = far;
     float depth = pow(2.0, z * log2(farZ + 1.0)) - 1.0;
     float a = farZ / (farZ - nearZ);
     float b = farZ * nearZ / (nearZ - farZ);
     float linDepth = a + b / depth;
     vec4 clipVec = vec4(uv, linDepth, 1.0) * 2.0 - 1.0;
     vec4 wpos = projectionMatrixInv * clipVec;
     return wpos.xyz / wpos.w;
   }
    vec3 getWorldPos(float depth, vec2 coord) {
     #ifdef LOGDEPTH
          return getWorldPosLog(vec3(coord, depth));
     #endif
        
        float z = depth * 2.0 - 1.0;
        vec4 clipSpacePosition = vec4(coord * 2.0 - 1.0, z, 1.0);
        vec4 viewSpacePosition = projectionMatrixInv * clipSpacePosition;
        // Perspective division
       vec4 worldSpacePosition = viewSpacePosition;
       worldSpacePosition.xyz /= worldSpacePosition.w;
        return worldSpacePosition.xyz;
    }
    #include <common>
    #define NUM_SAMPLES 16
    uniform vec2 poissonDisk[NUM_SAMPLES];
    void main() {
        const float pi = 3.14159;
        vec2 texelSize = vec2(1.0 / resolution.x, 1.0 / resolution.y);
        vec2 uv = vUv;
        vec4 data = texture2D(tDiffuse, vUv);
        float occlusion = data.r;
        float baseOcc = data.r;
        vec3 normal = data.gba * 2.0 - 1.0;
        float count = 1.0;
        float d = texture2D(sceneDepth, vUv).x;
        if (d == 1.0) {
          gl_FragColor = data;
          return;
        }
        vec3 worldPos = getWorldPos(d, vUv);
        float size = radius;
        float angle;
        if (index == 0.0) {
             angle = texture2D(blueNoise, gl_FragCoord.xy / 128.0).x * PI2;
        } else if (index == 1.0) {
             angle = texture2D(blueNoise, gl_FragCoord.xy / 128.0).y * PI2;
        } else if (index == 2.0) {
             angle = texture2D(blueNoise, gl_FragCoord.xy / 128.0).z * PI2;
        } else {
             angle = texture2D(blueNoise, gl_FragCoord.xy / 128.0).w * PI2;
        }

        mat2 rotationMatrix = mat2(cos(angle), -sin(angle), sin(angle), cos(angle));
        float radiusToUse = screenSpaceRadius ? distance(
          worldPos,
          getWorldPos(d, vUv +
            vec2(worldRadius, 0.0) / resolution)
        ) : worldRadius;
        float distanceFalloffToUse =screenSpaceRadius ?
        radiusToUse * distanceFalloff
    : radiusToUse * distanceFalloff * 0.2;


        for(int i = 0; i < NUM_SAMPLES; i++) {
            vec2 offset = (rotationMatrix * poissonDisk[i]) * texelSize * size;
            vec4 dataSample = texture2D(tDiffuse, uv + offset);
            float occSample = dataSample.r;
            vec3 normalSample = dataSample.gba * 2.0 - 1.0;
            float dSample = texture2D(sceneDepth, uv + offset).x;
            vec3 worldPosSample = getWorldPos(dSample, uv + offset);
            float tangentPlaneDist = abs(dot(worldPosSample - worldPos, normal));
            float rangeCheck = dSample == 1.0 ? 0.0 :exp(-1.0 * tangentPlaneDist * (1.0 / distanceFalloffToUse)) * max(dot(normal, normalSample), 0.0) * (1.0 - abs(occSample - baseOcc));
            occlusion += occSample * rangeCheck;
            count += rangeCheck;
        }
        if (count > 0.0) {
          occlusion /= count;
        }
        #ifdef LOGDEPTH
          occlusion = clamp(occlusion, 0.0, 1.0);
          if (occlusion == 0.0) {
            occlusion = 1.0;
          }
        #endif
        gl_FragColor = vec4(occlusion, 0.5 + 0.5 * normal);
    }
    `},_H={uniforms:{sceneDepth:{value:null},resolution:{value:new ae},near:{value:.1},far:{value:1e3},viewMatrixInv:{value:new ce},projectionMatrixInv:{value:new ce},logDepth:{value:!1}},depthWrite:!1,depthTest:!1,vertexShader:`
    varying vec2 vUv;
    void main() {
        vUv = uv;
        gl_Position = vec4(position, 1);
    }`,fragmentShader:`
    uniform highp sampler2D sceneDepth;
    uniform vec2 resolution;
    uniform float near;
    uniform float far;
    uniform bool logDepth;
    uniform mat4 viewMatrixInv;
    uniform mat4 projectionMatrixInv;
    varying vec2 vUv;
    layout(location = 1) out vec4 gNormal;
    vec3 getWorldPosLog(vec3 posS) {
        vec2 uv = posS.xy;
        float z = posS.z;
        float nearZ =near;
        float farZ = far;
        float depth = pow(2.0, z * log2(farZ + 1.0)) - 1.0;
        float a = farZ / (farZ - nearZ);
        float b = farZ * nearZ / (nearZ - farZ);
        float linDepth = a + b / depth;
        vec4 clipVec = vec4(uv, linDepth, 1.0) * 2.0 - 1.0;
        vec4 wpos = projectionMatrixInv * clipVec;
        return wpos.xyz / wpos.w;
      }
      vec3 getWorldPos(float depth, vec2 coord) {
        if (logDepth) {
          return getWorldPosLog(vec3(coord, depth));
        }
        float z = depth * 2.0 - 1.0;
        vec4 clipSpacePosition = vec4(coord * 2.0 - 1.0, z, 1.0);
        vec4 viewSpacePosition = projectionMatrixInv * clipSpacePosition;
        // Perspective division
       vec4 worldSpacePosition = viewSpacePosition;
       worldSpacePosition.xyz /= worldSpacePosition.w;
        return worldSpacePosition.xyz;
    }
  
    vec3 computeNormal(vec3 worldPos, vec2 vUv) {
      ivec2 p = ivec2(vUv * resolution);
      float c0 = texelFetch(sceneDepth, p, 0).x;
      float l2 = texelFetch(sceneDepth, p - ivec2(2, 0), 0).x;
      float l1 = texelFetch(sceneDepth, p - ivec2(1, 0), 0).x;
      float r1 = texelFetch(sceneDepth, p + ivec2(1, 0), 0).x;
      float r2 = texelFetch(sceneDepth, p + ivec2(2, 0), 0).x;
      float b2 = texelFetch(sceneDepth, p - ivec2(0, 2), 0).x;
      float b1 = texelFetch(sceneDepth, p - ivec2(0, 1), 0).x;
      float t1 = texelFetch(sceneDepth, p + ivec2(0, 1), 0).x;
      float t2 = texelFetch(sceneDepth, p + ivec2(0, 2), 0).x;
  
      float dl = abs((2.0 * l1 - l2) - c0);
      float dr = abs((2.0 * r1 - r2) - c0);
      float db = abs((2.0 * b1 - b2) - c0);
      float dt = abs((2.0 * t1 - t2) - c0);
  
      vec3 ce = getWorldPos(c0, vUv).xyz;
  
      vec3 dpdx = (dl < dr) ? ce - getWorldPos(l1, (vUv - vec2(1.0 / resolution.x, 0.0))).xyz
                            : -ce + getWorldPos(r1, (vUv + vec2(1.0 / resolution.x, 0.0))).xyz;
      vec3 dpdy = (db < dt) ? ce - getWorldPos(b1, (vUv - vec2(0.0, 1.0 / resolution.y))).xyz
                            : -ce + getWorldPos(t1, (vUv + vec2(0.0, 1.0 / resolution.y))).xyz;
  
      return normalize(cross(dpdx, dpdy));
  }
    void main() {
        vec2 uv = vUv - vec2(0.5) / resolution;
        vec2 pixelSize = vec2(1.0) / resolution;
        highp vec2[4] uvSamples;
        uvSamples[0] = uv;
        uvSamples[1] = uv + vec2(pixelSize.x, 0.0);
        uvSamples[2] = uv + vec2(0.0, pixelSize.y);
        uvSamples[3] = uv + pixelSize;
        float depth00 = texture2D(sceneDepth, uvSamples[0]).r;
        float depth10 = texture2D(sceneDepth, uvSamples[1]).r;
        float depth01 = texture2D(sceneDepth, uvSamples[2]).r;
        float depth11 = texture2D(sceneDepth, uvSamples[3]).r;
        float minDepth = min(min(depth00, depth10), min(depth01, depth11));
        float maxDepth = max(max(depth00, depth10), max(depth01, depth11));
        float targetDepth = minDepth;
        // Checkerboard pattern to avoid artifacts
        if (mod(gl_FragCoord.x + gl_FragCoord.y, 2.0) > 0.5) { 
            targetDepth = maxDepth;
        }
        int chosenIndex = 0;
        float[4] samples;
        samples[0] = depth00;
        samples[1] = depth10;
        samples[2] = depth01;
        samples[3] = depth11;
        for(int i = 0; i < 4; ++i) {
            if (samples[i] == targetDepth) {
                chosenIndex = i;
                break;
            }
        }
        gl_FragColor = vec4(samples[chosenIndex], 0.0, 0.0, 1.0);
        gNormal = vec4(computeNormal(
            getWorldPos(samples[chosenIndex], uvSamples[chosenIndex]), uvSamples[chosenIndex]
        ), 0.0);
    }`};var xk="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";const wH=Uint8Array.from(atob(xk),n=>n.charCodeAt(0));function Ck(n,t,e){if(t.getQueryParameter(n,t.QUERY_RESULT_AVAILABLE)){const r=t.getQueryParameter(n,t.QUERY_RESULT)/1e6;e.lastTime=r}else setTimeout(()=>{Ck(n,t,e)},1)}class Sk extends Gn{constructor(t,e,i=512,s=512){super(),this.width=i,this.height=s,this.clear=!0,this.camera=e,this.scene=t,this.autosetGamma=!0,this.configuration=new Proxy({aoSamples:16,aoRadius:5,denoiseSamples:8,denoiseRadius:12,distanceFalloff:1,intensity:5,denoiseIterations:2,renderMode:0,color:new we(0,0,0),gammaCorrection:!0,logarithmicDepthBuffer:!1,screenSpaceRadius:!1,halfRes:!1,depthAwareUpsampling:!0,colorMultiply:!0,transparencyAware:!1,accumulate:!1},{set:(r,o,a)=>{const l=r[o];return r[o]=a,a.equals?a.equals(l)||this.firstFrame():l!==a&&this.firstFrame(),o==="aoSamples"&&l!==a&&this.configureAOPass(this.configuration.logarithmicDepthBuffer),o==="denoiseSamples"&&l!==a&&this.configureDenoisePass(this.configuration.logarithmicDepthBuffer),o==="halfRes"&&l!==a&&(this.configureAOPass(this.configuration.logarithmicDepthBuffer),this.configureHalfResTargets(),this.configureEffectCompositer(this.configuration.logarithmicDepthBuffer),this.setSize(this.width,this.height)),o==="depthAwareUpsampling"&&l!==a&&this.configureEffectCompositer(this.configuration.logarithmicDepthBuffer),o==="gammaCorrection"&&(this.autosetGamma=!1),o==="transparencyAware"&&l!==a&&(this.autoDetectTransparency=!1,this.configureTransparencyTarget()),!0}}),this.samples=[],this.samplesDenoise=[],this.autoDetectTransparency=!0,this.frames=0,this.lastViewMatrix=new ce,this.lastProjectionMatrix=new ce,this.configureEffectCompositer(this.configuration.logarithmicDepthBuffer),this.configureSampleDependentPasses(),this.configureHalfResTargets(),this.detectTransparency(),this.configureTransparencyTarget(),this.copyQuad=new eh(new $e({uniforms:{tDiffuse:{value:null}},depthWrite:!1,vertexShader:`
            varying vec2 vUv;
            void main() {
                vUv = uv;
                gl_Position = vec4(position, 1);
            }
            `,fragmentShader:`
            uniform sampler2D tDiffuse;
            varying vec2 vUv;
            void main() {
                gl_FragColor = texture2D(tDiffuse, vUv);
            }
            `})),this.writeTargetInternal=new Ct(this.width,this.height,{minFilter:Tt,magFilter:Tt,depthBuffer:!1}),this.readTargetInternal=new Ct(this.width,this.height,{minFilter:Tt,magFilter:Tt,depthBuffer:!1}),this.outputTargetInternal=new Ct(this.width,this.height,{minFilter:Tt,magFilter:Tt,depthBuffer:!1}),this.accumulationRenderTarget=new Ct(this.width,this.height,{minFilter:Tt,magFilter:Tt,depthBuffer:!1,format:kn,type:On,stencilBuffer:!1,depthBuffer:!1,alpha:!0}),this.accumulationQuad=new eh(new $e({uniforms:{frame:{value:0},tDiffuse:{value:null}},transparent:!0,opacity:1,vertexShader:`
             varying vec2 vUv;
             void main() {
                 vUv = uv;
                 gl_Position = vec4(position, 1);
             }`,fragmentShader:`
             uniform sampler2D tDiffuse;
             uniform float frame;
                varying vec2 vUv;
                void main() {
                    vec4 color = texture2D(tDiffuse, vUv);
                    gl_FragColor = vec4(color.rgb, 1.0 / (frame + 1.0));
                }
                `})),this.bluenoise=new zd(wH,128,128),this.bluenoise.colorSpace=Fh,this.bluenoise.wrapS=Sl,this.bluenoise.wrapT=Sl,this.bluenoise.minFilter=Wt,this.bluenoise.magFilter=Wt,this.bluenoise.needsUpdate=!0,this.lastTime=0,this.needsDepthTexture=!0,this.needsSwap=!0,this._r=new ae,this._c=new we}configureHalfResTargets(){this.firstFrame(),this.configuration.halfRes?(this.depthDownsampleTarget=new Ct(this.width/2,this.height/2,{count:2}),this.depthDownsampleTarget.textures[0].format=mc,this.depthDownsampleTarget.textures[0].type=eo,this.depthDownsampleTarget.textures[0].minFilter=Wt,this.depthDownsampleTarget.textures[0].magFilter=Wt,this.depthDownsampleTarget.textures[0].depthBuffer=!1,this.depthDownsampleTarget.textures[1].format=kn,this.depthDownsampleTarget.textures[1].type=On,this.depthDownsampleTarget.textures[1].minFilter=Wt,this.depthDownsampleTarget.textures[1].magFilter=Wt,this.depthDownsampleTarget.textures[1].depthBuffer=!1,this.depthDownsampleQuad=new eh(new $e(_H))):(this.depthDownsampleTarget&&(this.depthDownsampleTarget.dispose(),this.depthDownsampleTarget=null),this.depthDownsampleQuad&&(this.depthDownsampleQuad.dispose(),this.depthDownsampleQuad=null))}detectTransparency(){if(this.autoDetectTransparency){let t=!1;this.scene.traverse(e=>{e.material&&e.material.transparent&&(t=!0)}),t&&(this.configuration.transparencyAware=!0)}}configureTransparencyTarget(){this.configuration.transparencyAware?(this.transparencyRenderTargetDWFalse=new Ct(this.width,this.height,{minFilter:Tt,magFilter:Wt,type:On,format:kn}),this.transparencyRenderTargetDWTrue=new Ct(this.width,this.height,{minFilter:Tt,magFilter:Wt,type:On,format:kn}),this.transparencyRenderTargetDWTrue.depthTexture=new fx(this.width,this.height,FR),this.depthCopyPass=new eh(new $e({uniforms:{depthTexture:{value:this.depthTexture}},vertexShader:`
            varying vec2 vUv;
            void main() {
                vUv = uv;
                gl_Position = vec4(position, 1);
            }`,fragmentShader:`
            uniform sampler2D depthTexture;
            varying vec2 vUv;
            void main() {
               gl_FragDepth = texture2D(depthTexture, vUv).r + 0.00001;
               gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
            }
            `}))):(this.transparencyRenderTargetDWFalse&&(this.transparencyRenderTargetDWFalse.dispose(),this.transparencyRenderTargetDWFalse=null),this.transparencyRenderTargetDWTrue&&(this.transparencyRenderTargetDWTrue.dispose(),this.transparencyRenderTargetDWTrue=null),this.depthCopyPass&&(this.depthCopyPass.dispose(),this.depthCopyPass=null))}renderTransparency(t){const e=this.scene.background,i=t.getClearColor(new we),s=t.getClearAlpha(),r=new Map,o=t.autoClearDepth;this.scene.traverse(a=>{r.set(a,a.visible)}),this.scene.background=null,t.autoClearDepth=!1,t.setClearColor(new we(0,0,0),0),this.depthCopyPass.material.uniforms.depthTexture.value=this.depthTexture,t.setRenderTarget(this.transparencyRenderTargetDWFalse),this.scene.traverse(a=>{a.material&&(a.visible=r.get(a)&&a.material.transparent&&!a.material.depthWrite&&!a.userData.treatAsOpaque)}),t.clear(!0,!0,!0),this.depthCopyPass.render(t),t.render(this.scene,this.camera),t.setRenderTarget(this.transparencyRenderTargetDWTrue),this.scene.traverse(a=>{a.material&&(a.visible=r.get(a)&&a.material.transparent&&a.material.depthWrite&&!a.userData.treatAsOpaque)}),t.clear(!0,!0,!0),this.depthCopyPass.render(t),t.render(this.scene,this.camera),this.scene.traverse(a=>{a.visible=r.get(a)}),t.setClearColor(i,s),this.scene.background=e,t.autoClearDepth=o}configureSampleDependentPasses(){this.configureAOPass(this.configuration.logarithmicDepthBuffer),this.configureDenoisePass(this.configuration.logarithmicDepthBuffer)}configureAOPass(t=!1){this.firstFrame(),this.samples=this.generateHemisphereSamples(this.configuration.aoSamples);const e={...vH};e.fragmentShader=e.fragmentShader.replace("16",this.configuration.aoSamples).replace("16.0",this.configuration.aoSamples+".0"),t&&(e.fragmentShader=`#define LOGDEPTH
`+e.fragmentShader),this.configuration.halfRes&&(e.fragmentShader=`#define HALFRES
`+e.fragmentShader),this.effectShaderQuad?(this.effectShaderQuad.material.dispose(),this.effectShaderQuad.material=new $e(e)):this.effectShaderQuad=new eh(new $e(e))}configureDenoisePass(t=!1){this.firstFrame(),this.samplesDenoise=this.generateDenoiseSamples(this.configuration.denoiseSamples,11);const e={...bH};e.fragmentShader=e.fragmentShader.replace("16",this.configuration.denoiseSamples),t&&(e.fragmentShader=`#define LOGDEPTH
`+e.fragmentShader),this.poissonBlurQuad?(this.poissonBlurQuad.material.dispose(),this.poissonBlurQuad.material=new $e(e)):this.poissonBlurQuad=new eh(new $e(e))}configureEffectCompositer(t=!1){this.firstFrame();const e={...yH};t&&(e.fragmentShader=`#define LOGDEPTH
`+e.fragmentShader),this.configuration.halfRes&&this.configuration.depthAwareUpsampling&&(e.fragmentShader=`#define HALFRES
`+e.fragmentShader),this.effectCompositerQuad?(this.effectCompositerQuad.material.dispose(),this.effectCompositerQuad.material=new $e(e)):this.effectCompositerQuad=new eh(new $e(e))}generateHemisphereSamples(t){const e=[];for(let i=0;i<t;i++){const s=2.399963*i,r=Math.sqrt(i+.5)/Math.sqrt(t),o=r*Math.cos(s),a=r*Math.sin(s),l=Math.sqrt(1-(o*o+a*a));e.push(new C(o,a,l))}return e}generateDenoiseSamples(t,e){const i=2*Math.PI*e/t,s=1/t,r=s,o=[];let a=s,l=0;for(let h=0;h<t;h++)o.push(new ae(Math.cos(l),Math.sin(l)).multiplyScalar(Math.pow(a,.75))),a+=r,l+=i;return o}setSize(t,e){this.firstFrame(),this.width=t,this.height=e;const i=this.configuration.halfRes?.5:1;this.writeTargetInternal.setSize(t*i,e*i),this.readTargetInternal.setSize(t*i,e*i),this.accumulationRenderTarget.setSize(t*i,e*i),this.configuration.halfRes&&this.depthDownsampleTarget.setSize(t*i,e*i),this.configuration.transparencyAware&&(this.transparencyRenderTargetDWFalse.setSize(t,e),this.transparencyRenderTargetDWTrue.setSize(t,e)),this.outputTargetInternal.setSize(t,e)}setDepthTexture(t){this.depthTexture=t}firstFrame(){this.needsFrame=!0}render(t,e,i){const s=t.xr.enabled;t.xr.enabled=!1,t.capabilities.logarithmicDepthBuffer!==this.configuration.logarithmicDepthBuffer&&(this.configuration.logarithmicDepthBuffer=t.capabilities.logarithmicDepthBuffer,this.configureAOPass(this.configuration.logarithmicDepthBuffer),this.configureDenoisePass(this.configuration.logarithmicDepthBuffer),this.configureEffectCompositer(this.configuration.logarithmicDepthBuffer)),this.detectTransparency(),(e.texture.type!==this.outputTargetInternal.texture.type||e.texture.format!==this.outputTargetInternal.texture.format)&&(this.outputTargetInternal.texture.type=e.texture.type,this.outputTargetInternal.texture.format=e.texture.format,this.outputTargetInternal.texture.needsUpdate=!0),this.camera.updateMatrixWorld(),this.lastViewMatrix.equals(this.camera.matrixWorldInverse)&&this.lastProjectionMatrix.equals(this.camera.projectionMatrix)&&this.configuration.accumulate&&!this.needsFrame?this.frame++:(t.setRenderTarget(this.accumulationRenderTarget),t.clear(!0,!0,!0),this.frame=0,this.needsFrame=!1),this.lastViewMatrix.copy(this.camera.matrixWorldInverse),this.lastProjectionMatrix.copy(this.camera.projectionMatrix);let r,o,a;this.debugMode&&(r=t.getContext(),o=r.getExtension("EXT_disjoint_timer_query_webgl2"),o===null&&(console.error("EXT_disjoint_timer_query_webgl2 not available, disabling debug mode."),this.debugMode=!1)),this.debugMode&&(a=r.createQuery(),r.beginQuery(o.TIME_ELAPSED_EXT,a)),this.configuration.transparencyAware&&this.renderTransparency(t),this._r.set(this.width,this.height);let l=this.configuration.aoRadius;if(this.configuration.halfRes&&this.configuration.screenSpaceRadius&&(l*=.5),this.frame<1024/this.configuration.aoSamples){this.configuration.halfRes&&(t.setRenderTarget(this.depthDownsampleTarget),this.depthDownsampleQuad.material.uniforms.sceneDepth.value=this.depthTexture,this.depthDownsampleQuad.material.uniforms.resolution.value=this._r,this.depthDownsampleQuad.material.uniforms.near.value=this.camera.near,this.depthDownsampleQuad.material.uniforms.far.value=this.camera.far,this.depthDownsampleQuad.material.uniforms.projectionMatrixInv.value=this.camera.projectionMatrixInverse,this.depthDownsampleQuad.material.uniforms.viewMatrixInv.value=this.camera.matrixWorld,this.depthDownsampleQuad.material.uniforms.logDepth.value=this.configuration.logarithmicDepthBuffer,this.depthDownsampleQuad.render(t)),this.effectShaderQuad.material.uniforms.sceneDiffuse.value=e.texture,this.effectShaderQuad.material.uniforms.sceneDepth.value=this.configuration.halfRes?this.depthDownsampleTarget.textures[0]:this.depthTexture,this.effectShaderQuad.material.uniforms.sceneNormal.value=this.configuration.halfRes?this.depthDownsampleTarget.textures[1]:null,this.effectShaderQuad.material.uniforms.projMat.value=this.camera.projectionMatrix,this.effectShaderQuad.material.uniforms.viewMat.value=this.camera.matrixWorldInverse,this.effectShaderQuad.material.uniforms.projViewMat.value=this.camera.projectionMatrix.clone().multiply(this.camera.matrixWorldInverse.clone()),this.effectShaderQuad.material.uniforms.projectionMatrixInv.value=this.camera.projectionMatrixInverse,this.effectShaderQuad.material.uniforms.viewMatrixInv.value=this.camera.matrixWorld,this.effectShaderQuad.material.uniforms.cameraPos.value=this.camera.getWorldPosition(new C),this.effectShaderQuad.material.uniforms.resolution.value=this.configuration.halfRes?this._r.clone().multiplyScalar(.5).floor():this._r,this.effectShaderQuad.material.uniforms.time.value=performance.now()/1e3,this.effectShaderQuad.material.uniforms.samples.value=this.samples,this.effectShaderQuad.material.uniforms.bluenoise.value=this.bluenoise,this.effectShaderQuad.material.uniforms.radius.value=l,this.effectShaderQuad.material.uniforms.distanceFalloff.value=this.configuration.distanceFalloff,this.effectShaderQuad.material.uniforms.near.value=this.camera.near,this.effectShaderQuad.material.uniforms.far.value=this.camera.far,this.effectShaderQuad.material.uniforms.logDepth.value=t.capabilities.logarithmicDepthBuffer,this.effectShaderQuad.material.uniforms.ortho.value=this.camera.isOrthographicCamera,this.effectShaderQuad.material.uniforms.screenSpaceRadius.value=this.configuration.screenSpaceRadius,this.effectShaderQuad.material.uniforms.frame.value=this.frame,t.setRenderTarget(this.writeTargetInternal),this.effectShaderQuad.render(t);for(let u=0;u<this.configuration.denoiseIterations;u++)[this.writeTargetInternal,this.readTargetInternal]=[this.readTargetInternal,this.writeTargetInternal],this.poissonBlurQuad.material.uniforms.tDiffuse.value=this.readTargetInternal.texture,this.poissonBlurQuad.material.uniforms.sceneDepth.value=this.configuration.halfRes?this.depthDownsampleTarget.textures[0]:this.depthTexture,this.poissonBlurQuad.material.uniforms.projMat.value=this.camera.projectionMatrix,this.poissonBlurQuad.material.uniforms.viewMat.value=this.camera.matrixWorldInverse,this.poissonBlurQuad.material.uniforms.projectionMatrixInv.value=this.camera.projectionMatrixInverse,this.poissonBlurQuad.material.uniforms.viewMatrixInv.value=this.camera.matrixWorld,this.poissonBlurQuad.material.uniforms.cameraPos.value=this.camera.getWorldPosition(new C),this.poissonBlurQuad.material.uniforms.resolution.value=this.configuration.halfRes?this._r.clone().multiplyScalar(.5).floor():this._r,this.poissonBlurQuad.material.uniforms.time.value=performance.now()/1e3,this.poissonBlurQuad.material.uniforms.blueNoise.value=this.bluenoise,this.poissonBlurQuad.material.uniforms.radius.value=this.configuration.denoiseRadius*(this.configuration.halfRes?.5:1),this.poissonBlurQuad.material.uniforms.worldRadius.value=l,this.poissonBlurQuad.material.uniforms.distanceFalloff.value=this.configuration.distanceFalloff,this.poissonBlurQuad.material.uniforms.index.value=u,this.poissonBlurQuad.material.uniforms.poissonDisk.value=this.samplesDenoise,this.poissonBlurQuad.material.uniforms.near.value=this.camera.near,this.poissonBlurQuad.material.uniforms.far.value=this.camera.far,this.poissonBlurQuad.material.uniforms.logDepth.value=t.capabilities.logarithmicDepthBuffer,this.poissonBlurQuad.material.uniforms.screenSpaceRadius.value=this.configuration.screenSpaceRadius,t.setRenderTarget(this.writeTargetInternal),this.poissonBlurQuad.render(t);t.setRenderTarget(this.accumulationRenderTarget);const h=t.autoClear;t.autoClear=!1,this.accumulationQuad.material.uniforms.tDiffuse.value=this.writeTargetInternal.texture,this.accumulationQuad.material.uniforms.frame.value=this.frame,this.accumulationQuad.render(t),t.autoClear=h}this.configuration.transparencyAware&&(this.effectCompositerQuad.material.uniforms.transparencyDWFalse.value=this.transparencyRenderTargetDWFalse.texture,this.effectCompositerQuad.material.uniforms.transparencyDWTrue.value=this.transparencyRenderTargetDWTrue.texture,this.effectCompositerQuad.material.uniforms.transparencyDWTrueDepth.value=this.transparencyRenderTargetDWTrue.depthTexture,this.effectCompositerQuad.material.uniforms.transparencyAware.value=!0),this.effectCompositerQuad.material.uniforms.sceneDiffuse.value=e.texture,this.effectCompositerQuad.material.uniforms.sceneDepth.value=this.depthTexture,this.effectCompositerQuad.material.uniforms.near.value=this.camera.near,this.effectCompositerQuad.material.uniforms.far.value=this.camera.far,this.effectCompositerQuad.material.uniforms.projectionMatrixInv.value=this.camera.projectionMatrixInverse,this.effectCompositerQuad.material.uniforms.viewMatrixInv.value=this.camera.matrixWorld,this.effectCompositerQuad.material.uniforms.logDepth.value=t.capabilities.logarithmicDepthBuffer,this.effectCompositerQuad.material.uniforms.ortho.value=this.camera.isOrthographicCamera,this.effectCompositerQuad.material.uniforms.downsampledDepth.value=this.configuration.halfRes?this.depthDownsampleTarget.textures[0]:this.depthTexture,this.effectCompositerQuad.material.uniforms.resolution.value=this._r,this.effectCompositerQuad.material.uniforms.blueNoise.value=this.bluenoise,this.effectCompositerQuad.material.uniforms.intensity.value=this.configuration.intensity,this.effectCompositerQuad.material.uniforms.renderMode.value=this.configuration.renderMode,this.effectCompositerQuad.material.uniforms.screenSpaceRadius.value=this.configuration.screenSpaceRadius,this.effectCompositerQuad.material.uniforms.radius.value=l,this.effectCompositerQuad.material.uniforms.distanceFalloff.value=this.configuration.distanceFalloff,this.effectCompositerQuad.material.uniforms.gammaCorrection.value=this.autosetGamma?this.renderToScreen:this.configuration.gammaCorrection,this.effectCompositerQuad.material.uniforms.tDiffuse.value=this.accumulationRenderTarget.texture,this.effectCompositerQuad.material.uniforms.color.value=this._c.copy(this.configuration.color).convertSRGBToLinear(),this.effectCompositerQuad.material.uniforms.colorMultiply.value=this.configuration.colorMultiply,this.effectCompositerQuad.material.uniforms.cameraPos.value=this.camera.getWorldPosition(new C),this.effectCompositerQuad.material.uniforms.fog.value=!!this.scene.fog,this.scene.fog&&(this.scene.fog.isFog?(this.effectCompositerQuad.material.uniforms.fogExp.value=!1,this.effectCompositerQuad.material.uniforms.fogNear.value=this.scene.fog.near,this.effectCompositerQuad.material.uniforms.fogFar.value=this.scene.fog.far):this.scene.fog.isFogExp2?(this.effectCompositerQuad.material.uniforms.fogExp.value=!0,this.effectCompositerQuad.material.uniforms.fogDensity.value=this.scene.fog.density):console.error(`Unsupported fog type ${this.scene.fog.constructor.name} in SSAOPass.`)),t.setRenderTarget(this.outputTargetInternal),this.effectCompositerQuad.render(t),t.setRenderTarget(this.renderToScreen?null:i),this.copyQuad.material.uniforms.tDiffuse.value=this.outputTargetInternal.texture,this.copyQuad.render(t),this.debugMode&&(r.endQuery(o.TIME_ELAPSED_EXT),Ck(a,r,this)),t.xr.enabled=s}enableDebugMode(){this.debugMode=!0}disableDebugMode(){this.debugMode=!1}setDisplayMode(t){this.configuration.renderMode=["Combined","AO","No AO","Split","Split AO"].indexOf(t)}setQualityMode(t){t==="Performance"?(this.configuration.aoSamples=8,this.configuration.denoiseSamples=4,this.configuration.denoiseRadius=12):t==="Low"?(this.configuration.aoSamples=16,this.configuration.denoiseSamples=4,this.configuration.denoiseRadius=12):t==="Medium"?(this.configuration.aoSamples=16,this.configuration.denoiseSamples=8,this.configuration.denoiseRadius=12):t==="High"?(this.configuration.aoSamples=64,this.configuration.denoiseSamples=8,this.configuration.denoiseRadius=6):t==="Ultra"&&(this.configuration.aoSamples=64,this.configuration.denoiseSamples=16,this.configuration.denoiseRadius=6)}}Uint8Array.from(atob(xk),n=>n.charCodeAt(0));const eA=N("debugpost"),Hb=Symbol("needle:postprocessing-handler"),Vb=Symbol("needle:previous-autoclear-state");class zC{constructor(t){c(this,"_composer",null);c(this,"_lastVolumeComponents");c(this,"_effects",[]);c(this,"_isActive",!1);c(this,"context");this.context=t}get isActive(){return this._isActive}get composer(){return this._composer}apply(t){this._isActive=!0,this.onApply(this.context,t)}unapply(){var i;if(this._isActive=!1,this._lastVolumeComponents){for(const s of this._lastVolumeComponents)s.unapply();this._lastVolumeComponents.length=0}const t=this.context;t[Hb]===this&&delete t[Hb],t.composer===this._composer&&((i=t.composer)==null||i.dispose(),t.composer=null),typeof t.renderer[Vb]=="boolean"&&(t.renderer.autoClear=t.renderer[Vb])}dispose(){this.unapply();for(const t of this._effects)t.dispose();this._effects.length=0,this._composer=null}onApply(t,e){if(e){t[Hb]=this,eA&&console.log("refreshing volume profile",e),this._lastVolumeComponents=[...e],this._effects.length=0;for(const i of e)if(i.context=t,i.apply){if(i.active){if(!t.mainCameraComponent){console.error("No camera in scene found or available yet - can not create postprocessing effects");return}const s=i.apply();if(!s)continue;Array.isArray(s)?this._effects.push(...s):this._effects.push(s)}}else i.active&&Yt("Volume component is not a VolumeComponent: "+i.__type);this.applyEffects(t)}}applyEffects(t){const e=this._effects;if(e.length<=0)return;const i=t.mainCameraComponent,s=t.renderer,r=t.scene,o=i.cam;s[Vb]=s.autoClear;const a=s.capabilities.maxSamples;this._composer||(this._composer=new tC(s,{frameBufferType:On,stencilBuffer:!0,multisampling:Math.min(No()?4:8,a)})),t.composer=this._composer;const l=t.composer;l.setMainCamera(o),l.setRenderer(s),l.setMainScene(r);for(const u of l.passes)u.dispose();l.removeAllPasses();const h=new Ty(r,o);h.name="Render To Screen",h.mainScene=r,l.addPass(h);try{this.orderEffects();const u=[];for(const d of e)if(d instanceof so)u.push(d);else if(d instanceof Gn){const f=new x1(o,...u);f.mainScene=r,f.name=u.map(p=>p.constructor.name).join(", "),f.enabled=!0,u.length=0,l.addPass(d)}if(u.length>0){const d=new x1(o,...u);d.name=u.map(f=>f.name).join(" "),d.mainScene=r,d.enabled=!0,l.addPass(d)}}catch(u){console.error("Error while applying postprocessing effects",u),l.removeAllPasses()}eA&&console.log("PostProcessing Passes",e,"->",l.passes)}orderEffects(){var e;eA&&console.log("Before ordering effects",[...this._effects]);const t=this._effects;t.sort((i,s)=>{const r=jI.indexOf(i.constructor),o=jI.indexOf(s.constructor);return r<0&&o<0?-1:r<0?1:o<0?-1:r-o}),eA&&console.log("After ordering effects",[...this._effects]);for(let i=0;i<t.length;i++){const s=t[i];if(((e=s==null?void 0:s.configuration)==null?void 0:e.gammaCorrection)!==void 0){const r=i===t.length-1;s.configuration.gammaCorrection=r}}}}const jI=[LM,rC,MM,DM,Sk,TM,SM,nC,PM,OM,kM,RM,CM,BM];var xH=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};const Nf=N("debugpost");class i0 extends se{constructor(){super(...arguments);c(this,"sharedProfile");c(this,"_postprocessing");c(this,"_effects",[]);c(this,"_lastApplyTime");c(this,"_rapidApplyCount",0);c(this,"_isDirty",!1);c(this,"_modificationQueue");c(this,"_recreateId",-1)}get effects(){return this._effects}markDirty(){this._isDirty=!0}awake(){var e;Nf&&(console.log(this),console.log("Press P to toggle post processing"),window.addEventListener("keydown",i=>{i.key==="p"&&(this.enabled=!this.enabled,Ci("Toggle PostProcessing "+this.name+": Enabled="+this.enabled),this.markDirty())})),(e=this.sharedProfile)==null||e.init()}onDisable(){var e;(e=this._postprocessing)==null||e.unapply()}onBeforeRender(){if(!this.context.isInXR){if(this.context.composer&&!(this.context.composer instanceof tC)){Nf&&console.warn("PostProcessing: The current composer is not an EffectComposer - this is not supported");return}this.context.mainCamera&&(!this._postprocessing||!this._postprocessing.isActive||this._isDirty)&&this.apply(),this.context.composer&&(this.context.composer.setRenderer(this.context.renderer),this.context.composer.setMainScene(this.context.scene),this.context.mainCamera&&this.context.composer.setMainCamera(this.context.mainCamera))}}onDestroy(){var e;(e=this._postprocessing)==null||e.dispose()}apply(){var i,s;Nf&&console.log("Apply PostProcessing",this,(i=this.context.mainCamera)==null?void 0:i.name),xe()&&(this._lastApplyTime!==void 0&&Date.now()-this._lastApplyTime<100&&(this._rapidApplyCount++,this._rapidApplyCount===5&&console.warn("Detected rapid post processing modifications - this might be a bug",this)),this._lastApplyTime=Date.now()),this._isDirty=!1,this.unapply(),this._effects.length=0,(s=this.sharedProfile)!=null&&s.components&&this._effects.push(...this.sharedProfile.components);const e=this.gameObject.getComponentsInChildren(Ds);if(Nf&&(e!=null&&e.length)&&console.log("Additional",e),e)for(const r of e)r.active&&this._effects.push(r);this._effects.length>0&&(this._postprocessing||(this._postprocessing=new zC(this.context)),this._postprocessing.apply(this._effects),this._applyPostQueue())}unapply(){var e;Nf&&console.log("Unapply PostProcessing",this),(e=this._postprocessing)==null||e.unapply()}_applyPostQueue(){if(this._modificationQueue){for(const e of this._modificationQueue.values())this.onEditorModification(e);this._modificationQueue.clear()}}onEditorModification(e){var i,s;if(e.propertyName.startsWith("postprocessing.")){if(!this._postprocessing)return this._modificationQueue||(this._modificationQueue=new Map),this._modificationQueue.set(e.propertyName,e),!0;if(!((i=this._effects)!=null&&i.length))return;const r=e.propertyName.split(".");if(r.length===3||r.length===4){const o=r[1],a=r[2];for(const l of this._effects)if(((s=l.typeName)==null?void 0:s.toLowerCase())===o.toLowerCase()){if(a==="active"){l.active=e.value,this.scheduleRecreate();return}if(!tA.has(o)){const h=new Array;tA.set(o,h);const u=Object.keys(l);for(const d of u)l[d]instanceof je&&h.push(d)}if(tA.has(o)){const h=a.toLowerCase(),u=tA.get(o);for(const d of u)if(d.toLowerCase()===h){const f=l[d];f instanceof je&&(r.length===4&&r[3]==="active"?(f.overrideState=e.value,this.scheduleRecreate()):f&&f.value!==void 0&&(f.value=e.value));return}}console.warn("Unknown modification",a);return}}return!0}return!1}scheduleRecreate(){const e=++this._recreateId;setTimeout(()=>{e===this._recreateId&&(this.onDisable(),this.onEnable())},200)}}xH([kg(Vy)],i0.prototype,"sharedProfile",void 0);const tA=new Map;var n0=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};class eu extends Ds{constructor(){super(...arguments);c(this,"postExposure");c(this,"contrast");c(this,"hueShift");c(this,"saturation");c(this,"toneMappingEffect",null)}get typeName(){return"ColorAdjustments"}init(){this.postExposure.valueProcessor=e=>(e=Math.pow(2,e),e),this.postExposure.defaultValue=0,this.contrast.valueProcessor=e=>{let i=1;return e>0?i=200:e<0&&(i=100),e/i},this.contrast.defaultValue=0,this.hueShift.valueProcessor=e=>Math.PI*e/180,this.hueShift.defaultValue=0,this.saturation.valueProcessor=e=>e<0?e/100:e/(100*Math.PI),this.saturation.defaultValue=0}unapply(){var s,r,o;const e=(r=(s=this.toneMappingEffect)==null?void 0:s.mode)==null?void 0:r.value,i=(o=this.toneMappingEffect)==null?void 0:o.getThreeToneMapping(e);this.context.renderer.toneMapping=i??tv}threeToneMappingToEffectMode(e){switch(e){case tv:return Rn.LINEAR;case KR:return Rn.ACES_FILMIC;case E2:return Rn.AGX;case YR:return Rn.NEUTRAL;default:return Rn.LINEAR}}onCreateEffect(){var l,h,u,d,f;const e=[];this.context.renderer.toneMapping!==sg&&this.postExposure.overrideState&&(this.context.renderer.toneMapping=sg),this.toneMappingEffect=(h=(l=z.findObjectOfType(i0))==null?void 0:l.sharedProfile)==null?void 0:h.components.find(p=>p.typeName==="ToneMapping");const i=(d=(u=this.toneMappingEffect)==null?void 0:u.mode)==null?void 0:d.value,s=(f=this.toneMappingEffect)==null?void 0:f.getThreeToneMapping(i),r=new kM({mode:this.threeToneMappingToEffectMode(s)});this.postExposure.onValueChanged=p=>{var y,b,_;this.postExposure.overrideState&&(this.context.renderer.toneMappingExposure=p);const g=(b=(y=this.toneMappingEffect)==null?void 0:y.mode)==null?void 0:b.value,m=(_=this.toneMappingEffect)==null?void 0:_.getThreeToneMapping(g),v=this.threeToneMappingToEffectMode(m);v!==void 0&&(r.mode=v)};const o=new CM;this.contrast.onValueChanged=p=>o.contrast=p;const a=new RM;return e.push(o),e.push(a),e.push(r),this.hueShift.onValueChanged=p=>a.hue=p,this.saturation.onValueChanged=p=>a.saturation=p,e}}n0([A(je)],eu.prototype,"postExposure",void 0);n0([A(je)],eu.prototype,"contrast",void 0);n0([A(je)],eu.prototype,"hueShift",void 0);n0([A(je)],eu.prototype,"saturation",void 0);zo("ColorAdjustments",eu);const CH=(Math.sqrt(5)-1)/4,yn=(5-Math.sqrt(5))/20,iA=n=>Math.floor(n)|0,nA=new Float64Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);function SH(n=Math.random){const t=EH(n),e=new Float64Array(t).map(o=>nA[o%32*4]),i=new Float64Array(t).map(o=>nA[o%32*4+1]),s=new Float64Array(t).map(o=>nA[o%32*4+2]),r=new Float64Array(t).map(o=>nA[o%32*4+3]);return function(a,l,h,u){let d,f,p,g,m;const v=(a+l+h+u)*CH,y=iA(a+v),b=iA(l+v),_=iA(h+v),x=iA(u+v),S=(y+b+_+x)*yn,T=y-S,L=b-S,I=_-S,P=x-S,R=a-T,B=l-L,Q=h-I,G=u-P;let V=0,X=0,k=0,M=0;R>B?V++:X++,R>Q?V++:k++,R>G?V++:M++,B>Q?X++:k++,B>G?X++:M++,Q>G?k++:M++;const H=V>=3?1:0,ee=X>=3?1:0,Y=k>=3?1:0,he=M>=3?1:0,de=V>=2?1:0,ve=X>=2?1:0,_e=k>=2?1:0,Ge=M>=2?1:0,Te=V>=1?1:0,We=X>=1?1:0,It=k>=1?1:0,_t=M>=1?1:0,$t=R-H+yn,yi=B-ee+yn,ds=Q-Y+yn,Sr=G-he+yn,Wn=R-de+2*yn,$s=B-ve+2*yn,Er=Q-_e+2*yn,Ir=G-Ge+2*yn,ao=R-Te+3*yn,lo=B-We+3*yn,Tr=Q-It+3*yn,er=G-_t+3*yn,mn=R-1+4*yn,Ls=B-1+4*yn,tr=Q-1+4*yn,qn=G-1+4*yn,fs=y&255,ps=b&255,An=_&255,zi=x&255;let Xn=.6-R*R-B*B-Q*Q-G*G;if(Xn<0)d=0;else{const dt=fs+t[ps+t[An+t[zi]]];Xn*=Xn,d=Xn*Xn*(e[dt]*R+i[dt]*B+s[dt]*Q+r[dt]*G)}let Fs=.6-$t*$t-yi*yi-ds*ds-Sr*Sr;if(Fs<0)f=0;else{const dt=fs+H+t[ps+ee+t[An+Y+t[zi+he]]];Fs*=Fs,f=Fs*Fs*(e[dt]*$t+i[dt]*yi+s[dt]*ds+r[dt]*Sr)}let Yn=.6-Wn*Wn-$s*$s-Er*Er-Ir*Ir;if(Yn<0)p=0;else{const dt=fs+de+t[ps+ve+t[An+_e+t[zi+Ge]]];Yn*=Yn,p=Yn*Yn*(e[dt]*Wn+i[dt]*$s+s[dt]*Er+r[dt]*Ir)}let Zi=.6-ao*ao-lo*lo-Tr*Tr-er*er;if(Zi<0)g=0;else{const dt=fs+Te+t[ps+We+t[An+It+t[zi+_t]]];Zi*=Zi,g=Zi*Zi*(e[dt]*ao+i[dt]*lo+s[dt]*Tr+r[dt]*er)}let Ft=.6-mn*mn-Ls*Ls-tr*tr-qn*qn;if(Ft<0)m=0;else{const dt=fs+1+t[ps+1+t[An+1+t[zi+1]]];Ft*=Ft,m=Ft*Ft*(e[dt]*mn+i[dt]*Ls+s[dt]*tr+r[dt]*qn)}return 27*(d+f+p+g+m)}}function EH(n){const e=new Uint8Array(512);for(let i=0;i<512/2;i++)e[i]=i;for(let i=0;i<512/2-1;i++){const s=i+~~(n()*(256-i)),r=e[i];e[i]=e[s],e[s]=r}for(let i=256;i<512;i++)e[i]=e[i-256];return e}const Wb=N("debugstencil");function IH(n,t){return(n&1<<t.layer)!=0}const TH=Symbol("stencils"),fh=class{constructor(t,e){c(this,"parser");c(this,"source");this.parser=t,this.source=e}get name(){return"NEEDLE_render_objects"}static applyStencil(t){if(!t)return;const e=t.sourceId;if(Wb&&console.log(e,fh.stencils),!e)return;const i=fh.stencils[e];if(i)for(let s=i.length-1;s>=0;s--){const r=i[s];if(IH(r.layer,t)){Wb&&console.log(r),setTimeout(()=>{qs()&&yC(t.gameObject)&&(Yt("Stencil not supported on instanced objects"),console.warn("Stencil not supported on instanced objects",t))},500);for(let o=0;o<t.sharedMaterials.length;o++){let a=t.sharedMaterials[o];a&&(a=a.clone(),a[TH]=!0,a.stencilWrite=!0,a.stencilWriteMask=255,a.stencilFuncMask=255,a.stencilRef=r.value,a.stencilFunc=r.compareFunc,a.stencilZPass=r.passOp,a.stencilFail=r.failOp,a.stencilZFail=r.zFailOp,t.sharedMaterials[o]=a)}t.gameObject.renderOrder=r.event*1e3+r.index*50;break}}}afterRoot(t){const e=this.parser.json.extensions;if(e){const i=e[BH];if(i){Wb&&console.log(i);const s=i.stencil;if(s&&Array.isArray(s))for(const r of s){const o={...r};o.compareFunc=RH(o.compareFunc),o.passOp=qb(o.passOp),o.failOp=qb(o.failOp),o.zFailOp=qb(o.zFailOp),fh.stencils[this.source]||(fh.stencils[this.source]=[]),fh.stencils[this.source].push(o)}}}return null}};let Mp=fh;c(Mp,"stencils",{});var ra;(function(n){n[n.Keep=0]="Keep",n[n.Zero=1]="Zero",n[n.Replace=2]="Replace",n[n.IncrementSaturate=3]="IncrementSaturate",n[n.DecrementSaturate=4]="DecrementSaturate",n[n.Invert=5]="Invert",n[n.IncrementWrap=6]="IncrementWrap",n[n.DecrementWrap=7]="DecrementWrap"})(ra||(ra={}));var oa;(function(n){n[n.Disabled=0]="Disabled",n[n.Never=1]="Never",n[n.Less=2]="Less",n[n.Equal=3]="Equal",n[n.LessEqual=4]="LessEqual",n[n.Greater=5]="Greater",n[n.NotEqual=6]="NotEqual",n[n.GreaterEqual=7]="GreaterEqual",n[n.Always=8]="Always"})(oa||(oa={}));function qb(n){switch(n){case ra.Keep:return k2;case ra.Zero:return D2;case ra.Replace:return M2;case ra.IncrementSaturate:return P2;case ra.DecrementSaturate:return B2;case ra.IncrementWrap:return R2;case ra.DecrementWrap:return T2;case ra.Invert:return I2}return 0}function RH(n){switch(n){case oa.Never:return VS;case oa.Less:return z2;case oa.Equal:return Q2;case oa.LessEqual:return N2;case oa.Greater:return U2;case oa.NotEqual:return F2;case oa.GreaterEqual:return L2;case oa.Always:return O2}return VS}const BH="NEEDLE_render_objects",Ek=Symbol("customVisibilityFlag");function lh(n,t){n.layers[Ek]=t}const GI=Symbol("DidPatchLayers");function PH(){const n=$r.prototype;if(n[GI])return;n[GI]=!0;const t=n.test;n.test=function(e){return this[Ek]===!1?!1:t.call(this,e)}}PH();var Ik=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};const Qf=N("debugreflectionprobe"),HI=N("noreflectionprobe"),MH=Symbol("reflectionProbeKey"),DH=Symbol("original material"),ha=class extends se{constructor(){var e;super();c(this,"_texture");c(this,"center");c(this,"size");c(this,"_boxHelper");ha._probes.has(this.context)||ha._probes.set(this.context,[]),(e=ha._probes.get(this.context))==null||e.push(this)}static get(e,i,s,r){if(!e||e.isObject3D!==!0||HI)return null;const o=ha._probes.get(i);if(o){for(const a of o)if(a.__didAwake||a.__internalAwake(),a.enabled){if(r){if(a.gameObject===r)return a}else if(a.isInBox(e,void 0))return Qf&&console.log("Found reflection probe",e.name,a.name),a}}return Qf&&console.debug("Did not find reflection probe",e.name,s,e),null}set texture(e){if(e&&!(e instanceof pt)){console.error("ReflectionProbe.texture must be a Texture",e);return}this._texture=e,e&&(e.mapping=wc,e.colorSpace=Ue,e.needsUpdate=!0)}get texture(){return this._texture}isInBox(e,i){var s;return(s=this._boxHelper)==null?void 0:s.isInBox(e,i)}awake(){this._boxHelper=this.gameObject.addNewComponent(So),this._boxHelper.updateBox(!0),Qf&&this._boxHelper.showHelper(5592320,!0),this.texture&&(this.texture.mapping=wc,this.texture.colorSpace=Ue,this.texture.needsUpdate=!0)}onDestroy(){const e=ha._probes.get(this.context);if(e){const i=e.indexOf(this);i>=0&&e.splice(i,1)}}onSet(e){var s;if(HI||!this.enabled||((s=e.sharedMaterials)==null?void 0:s.length)<=0||!this.texture)return;let i=ha._rendererMaterialsCache.get(e);i||(i=[],ha._rendererMaterialsCache.set(e,i));for(let r=0;r<e.sharedMaterials.length;r++){const o=e.sharedMaterials[r];if(!o||o.envMap===void 0)continue;let a=i[r];const l=o===(a==null?void 0:a.copy),h=!a||a.material.uuid!==o.uuid||a.copy.version!==o.version;if(!l&&h){if(Qf){let f="";a?a.material!==o?f="reference changed; cached instance?: "+l:a.copy.version!==o.version&&(f="version changed"):f="not cached",console.warn("Cloning material",o.name,o.version,"Reason:",f,`
`,o.uuid,`
`,a==null?void 0:a.copy.uuid,`
`,e.name)}const d=o.clone();d.version=o.version,a?(a.copy=d,a.material=o):(a={material:o,copy:d},i.push(a)),d[MH]=this,d[DH]=o,Qf&&console.log("Set reflection",e.name,e.guid)}a&&a.copy&&(a.copy.onBeforeCompile=o.onBeforeCompile);const u=a==null?void 0:a.copy;u.envMap=this.texture,e.sharedMaterials[r]=u}}onUnset(e){const i=ha._rendererMaterialsCache.get(e);if(i)for(let s=0;s<i.length;s++){const r=i[s];e.sharedMaterials[s]=r.material}}};let ml=ha;c(ml,"_probes",new Map),c(ml,"_rendererMaterialsCache",new Map);Ik([A(C)],ml.prototype,"center",void 0);Ik([A(C)],ml.prototype,"size",void 0);const Xb=N("debugexr");class kH{constructor(t){c(this,"parser");this.parser=t,Xb&&console.log(t)}get name(){return"EXT_texture_exr"}loadTexture(t){const e=this.name,i=this.parser,r=i.json.textures[t];if(Xb&&console.log("EXT_texture_exr.loadTexture",t,r),!r.extensions||!r.extensions[e])return null;const o=r.extensions[e],a=new yv(i.options.manager);return Xb&&console.log("EXT_texture_exr.loadTexture",o),i.loadTextureImage(t,o.source,a)}}typeof window<"u"&&window.addEventListener("unhandledrejection",n=>{});const Ja=Fn,sA="$___Export_Components",OH="NEEDLE_components";var nq;class LH{constructor(){c(this,nq)}}nq=Du;class FH{constructor(t,e,i){c(this,"node");c(this,"nodeIndex");c(this,"nodeDef");this.node=t,this.nodeIndex=e,this.nodeDef=i}}class UH{constructor(){c(this,"parser");c(this,"nodeToObjectMap",{});c(this,"exportContext");c(this,"objectToNodeMap",{});c(this,"context");c(this,"writer")}get name(){return OH}registerExport(t){t.register(e=>{if("serializeUserData"in e){const i=e.serializeUserData.bind(e);this.writer=e,e.serializeUserData=(s,r)=>{try{this.serializeUserData(s,r),i(s,r)}finally{this.afterSerializeUserData(s,r)}}}return this})}beforeParse(){this.exportContext={},this.objectToNodeMap={}}serializeUserData(t,e){var s;const i=(s=t.userData)==null?void 0:s.components;!i||i.length<=0||(delete t.userData.components,t[sA]=i)}afterSerializeUserData(t,e){if(t.type==="Scene"&&Ja&&console.log("DONE",JSON.stringify(e)),t[sA]===void 0)return;const i=t[sA];delete t[sA],i!==null&&(t.userData.components=i)}writeNode(t,e){const i=this.writer.json.nodes.length;Ja&&console.log(t.name,i,t.uuid);const s=new FH(t,i,e);this.exportContext[i]=s,this.objectToNodeMap[t.uuid]=i}afterParse(t){var e;Ja&&console.log("AFTER",t);for(const i in this.exportContext){const s=this.exportContext[i],r=s.node,o=s.nodeDef,a=s.nodeIndex,l=(e=r.userData)==null?void 0:e.components;if(!l||l.length<=0)continue;const h=new LH;o.extensions=o.extensions||{},o.extensions[this.name]=h,this.context.object=r,this.context.nodeId=a,this.context.objectToNode=this.objectToNodeMap;const u=[];for(const d of l){this.context.target=d;const f=La().writeBuiltinComponentData(d,this.context);f!==null&&u.push(f)}u.length>0&&(h[Du]=u,Ja&&console.log("DID WRITE",r,"nodeIndex",a,u))}}beforeRoot(){return Ja&&console.log("BEGIN LOAD"),this.nodeToObjectMap={},null}async afterRoot(t){const e=t.parser,i=e==null?void 0:e.extensions;if(!i)return;const s=i[this.name];Ja&&console.log("After root",t,this.parser,i);const r=[];if(s===!0){const o=e.json.nodes;if(o){for(let a=0;a<o.length;a++){const l=await e.getDependency("node",a);this.nodeToObjectMap[a]=l}for(let a=0;a<o.length;a++){const l=o[a],h=a,u=l.extensions;if(!u)continue;const d=u[this.name];if(!d)continue;Ja&&console.log("NODE",l);const f=this.nodeToObjectMap[h];if(!f){console.error("Could not find object for node index: "+h,l,e);continue}bC(f),r.push(this.createComponents(f,d))}}}await Promise.all(r)}async createComponents(t,e){if(!e)return;const i=e[Du];if(i){const s=new Array;Ja&&console.log(t.name,i);for(const r in i){const o=i[r];Ja&&console.log("Serialized data",JSON.parse(JSON.stringify(o))),o&&this.parser&&s.push(oC(this.parser,o).catch(a=>console.error(`Error while resolving references (see console for details)
`,a,t,o))),t.userData=t.userData||{},t.userData[Du]=t.userData[Du]||[],t.userData[Du].push(o)}await Promise.all(s).catch(r=>{console.error("Error while loading components",r)})}}}const VI="NEEDLE_gameobject_data";class NH{constructor(t){c(this,"parser");this.parser=t}get name(){return VI}afterRoot(t){var i;const e=[];for(let s=0;s<((i=this.parser.json.nodes)==null?void 0:i.length);s++){const r=this.parser.json.nodes[s];if(r&&r.extensions){const o=r.extensions[VI];if(o){const a=this.findAndApplyExtensionData(s,o);e.push(a)}}}return Promise.all(e).then(()=>null)}async findAndApplyExtensionData(t,e){const i=await this.parser.getDependency("node",t);i&&this.applyExtensionData(i,e)}applyExtensionData(t,e){e.layers===void 0&&(e.layers=0),t.userData.layer=e.layers,t.layers.disableAll(),t.layers.set(e.layers),t.userData.tag=e.tag??"none",t.userData.hideFlags=e.hideFlags??0,t.userData.static=e.static??!1,t.visible=e.activeSelf??!0,t.guid=e.guid}}const WI="NEEDLE_lighting_settings",Uu=N("debugenvlight");class QH{constructor(t,e,i){c(this,"parser");c(this,"sourceId");c(this,"context");this.parser=t,this.sourceId=e,this.context=i}get name(){return WI}afterRoot(t){const e=this.parser.json.extensions;if(e){const i=e[WI];if(i){Uu&&console.log('Loaded "'+this.name+'", src: "'+this.sourceId+'"',i);let s;if(t.scene.children.length===1){const r=t.scene.children[0];s=z.addNewComponent(r,Fw,{},!1)}else{const r=new re;r.name="LightSettings "+this.sourceId,t.scene.add(r),s=z.addNewComponent(r,Fw,{},!1)}s.sourceId=this.sourceId,s.ambientIntensity=i.ambientIntensity,s.ambientLight=new we().fromArray(i.ambientLight),Array.isArray(i.ambientTrilight)&&(s.ambientTrilight=i.ambientTrilight.map(r=>new we().fromArray(r))),s.ambientMode=i.ambientMode,s.environmentReflectionSource=i.environmentReflectionSource}}return null}}mt.registerCallback(yt.ContextCreated,n=>{const t=n.context,e=z.findObjectOfType(Fw,t);e!=null&&e.sourceId&&(e.enabled=!0)});class Fw extends se{constructor(){super(...arguments);c(this,"ambientMode",ya.Skybox);c(this,"ambientLight");c(this,"ambientTrilight");c(this,"ambientIntensity",1);c(this,"environmentReflectionSource",yg.Skybox);c(this,"_hasReflection",!1);c(this,"_ambientLightObj");c(this,"_hemisphereLightObj")}awake(){var i;if(this.sourceId){const s=this.environmentReflectionSource===yg.Skybox?pl.Skybox:pl.Reflection,r=this.context.lightmaps.tryGet(this.sourceId,s,0);this._hasReflection=r!=null,r&&this.context.sceneLighting.internalRegisterReflection(this.sourceId,r)}this.enabled=!1,this.context.sceneLighting.internalRegisterSceneLightSettings(this),Uu&&window.addEventListener("keydown",s=>{if(!this.destroyed)switch(s.key){case"l":this.enabled=!this.enabled;break}});const e=(i=this.gameObject.userData)==null?void 0:i.components;if(e){const s=e.indexOf(this);e.splice(s,1),e.push(this)}}onDestroy(){this.context.sceneLighting.internalUnregisterSceneLightSettings(this)}calculateIntensityFactor(e){const i=Math.max(e.r,e.g,e.b);return 2.2*Ae.lerp(0,1.33,i)}onEnable(){if(Uu&&console.warn("ðŸ’¡ðŸŸ¡ >>> Enable lighting",this.sourceId,this.enabled,this),this.ambientMode==ya.Flat){if(this.ambientLight&&!this._ambientLightObj){const e=this.calculateIntensityFactor(this.ambientLight);this._ambientLightObj=new OR(this.ambientLight,this.ambientIntensity*e),Uu&&console.log("Created ambient light",this.sourceId,this._ambientLightObj,this.ambientIntensity,e)}this._ambientLightObj&&this.gameObject.add(this._ambientLightObj)}else if(this.ambientMode===ya.Trilight){if(this.ambientTrilight){const e=this.ambientTrilight[0],i=this.ambientTrilight[this.ambientTrilight.length-1],s=this.calculateIntensityFactor(i);this._hemisphereLightObj=new j2(i,e,this.ambientIntensity*s),this.gameObject.add(this._hemisphereLightObj),Uu&&console.log("Created hemisphere ambient light",this.sourceId,this._hemisphereLightObj,this.ambientIntensity,s)}}else this._ambientLightObj&&this._ambientLightObj.removeFromParent(),this._hemisphereLightObj&&this._hemisphereLightObj.removeFromParent();this.sourceId&&this.context.sceneLighting.internalEnableReflection(this.sourceId)}onDisable(){Uu&&console.warn("ðŸ’¡âš« <<< Disable lighting:",this.sourceId,this),this._ambientLightObj&&this._ambientLightObj.removeFromParent(),this._hemisphereLightObj&&this._hemisphereLightObj.removeFromParent(),this.sourceId&&this.context.sceneLighting.internalDisableReflection(this.sourceId)}}var qI;(function(n){n[n.Fragment=35632]="Fragment",n[n.Vertex=35633]="Vertex"})(qI||(qI={}));var Uw;(function(n){n[n.INT=5124]="INT",n[n.FLOAT=5126]="FLOAT",n[n.FLOAT_VEC2=35664]="FLOAT_VEC2",n[n.FLOAT_VEC3=35665]="FLOAT_VEC3",n[n.FLOAT_VEC4=35666]="FLOAT_VEC4",n[n.INT_VEC2=35667]="INT_VEC2",n[n.INT_VEC3=35668]="INT_VEC3",n[n.INT_VEC4=35669]="INT_VEC4",n[n.BOOL=35670]="BOOL",n[n.BOOL_VEC2=35671]="BOOL_VEC2",n[n.BOOL_VEC3=35672]="BOOL_VEC3",n[n.BOOL_VEC4=35673]="BOOL_VEC4",n[n.FLOAT_MAT2=35674]="FLOAT_MAT2",n[n.FLOAT_MAT3=35675]="FLOAT_MAT3",n[n.FLOAT_MAT4=35676]="FLOAT_MAT4",n[n.SAMPLER_2D=35678]="SAMPLER_2D",n[n.SAMPLER_3D=35680]="SAMPLER_3D",n[n.SAMPLER_CUBE=35681]="SAMPLER_CUBE",n[n.UNKNOWN=0]="UNKNOWN"})(Uw||(Uw={}));const ac=N("debugcustomshader"),Cu="NEEDLE_techniques_webgl";var XI;(function(n){n[n.INT=5124]="INT",n[n.FLOAT=5126]="FLOAT",n[n.FLOAT_VEC2=35664]="FLOAT_VEC2",n[n.FLOAT_VEC3=35665]="FLOAT_VEC3",n[n.FLOAT_VEC4=35666]="FLOAT_VEC4",n[n.INT_VEC2=35667]="INT_VEC2",n[n.INT_VEC3=35668]="INT_VEC3",n[n.INT_VEC4=35669]="INT_VEC4",n[n.BOOL=35670]="BOOL",n[n.BOOL_VEC2=35671]="BOOL_VEC2",n[n.BOOL_VEC3=35672]="BOOL_VEC3",n[n.BOOL_VEC4=35673]="BOOL_VEC4",n[n.FLOAT_MAT2=35674]="FLOAT_MAT2",n[n.FLOAT_MAT3=35675]="FLOAT_MAT3",n[n.FLOAT_MAT4=35676]="FLOAT_MAT4",n[n.SAMPLER_2D=35678]="SAMPLER_2D",n[n.SAMPLER_3D=35680]="SAMPLER_3D",n[n.SAMPLER_CUBE=35681]="SAMPLER_CUBE",n[n.UNKNOWN=0]="UNKNOWN"})(XI||(XI={}));class zH{constructor(){c(this,"objectToWorldMatrix",new ce);c(this,"worldToObjectMatrix",new ce);c(this,"objectToWorld",new Array);c(this,"worldToObject",new Array)}updateFrom(t){this.objectToWorldMatrix.copy(t.matrixWorld),bv(this.objectToWorldMatrix,this.objectToWorld),this.worldToObjectMatrix.copy(t.matrixWorld).invert(),bv(this.worldToObjectMatrix,this.worldToObject)}}var Dp;(function(n){n[n.Off=0]="Off",n[n.Front=1]="Front",n[n.Back=2]="Back"})(Dp||(Dp={}));var nl;(function(n){n[n.Never=1]="Never",n[n.Less=2]="Less",n[n.Equal=3]="Equal",n[n.LEqual=4]="LEqual",n[n.Greater=5]="Greater",n[n.NotEqual=6]="NotEqual",n[n.GEqual=7]="GEqual",n[n.Always=8]="Always"})(nl||(nl={}));const ni=class extends JR{constructor(e,...i){super(...i);c(this,"identifier");c(this,"onBeforeRenderSceneCallback",this.onBeforeRenderScene.bind(this));c(this,"_sphericalHarmonicsName","unity_SpecCube0");c(this,"_objToWorldName","hlslcc_mtx4x4unity_ObjectToWorld");c(this,"_worldToObjectName","hlslcc_mtx4x4unity_WorldToObject");c(this,"_viewProjectionName","hlslcc_mtx4x4unity_MatrixVP");c(this,"_viewMatrixName","hlslcc_mtx4x4unity_MatrixV");c(this,"_rendererData",new zH);this.identifier=e,ac&&console.log(this),this.type="NEEDLE_CUSTOM_SHADER",this.uniforms[this._objToWorldName]||(this.uniforms[this._objToWorldName]={value:[]}),this.uniforms[this._worldToObjectName]||(this.uniforms[this._worldToObjectName]={value:[]}),this.uniforms[this._viewProjectionName]||(this.uniforms[this._viewProjectionName]={value:[]}),this.uniforms[this._sphericalHarmonicsName],(this.depthTextureUniform||this.opaqueTextureUniform)&&Ne.Current.pre_render_callbacks.push(this.onBeforeRenderSceneCallback)}clone(){const e=super.clone();return Tk(e),e}dispose(){super.dispose();const e=Ne.Current.pre_render_callbacks.indexOf(this.onBeforeRenderSceneCallback);e>=0&&Ne.Current.pre_render_callbacks.splice(e,1)}get depthTextureUniform(){if(this.uniforms)return this.uniforms._CameraDepthTexture}get opaqueTextureUniform(){if(this.uniforms)return this.uniforms._CameraOpaqueTexture}onBeforeRenderScene(){this.opaqueTextureUniform&&Ne.Current.setRequireColor(!0),this.depthTextureUniform&&Ne.Current.setRequireDepth(!0)}onBeforeRender(e,i,s,r,o,a){r.attributes.tangent||r.computeTangents(),this.onUpdateUniforms(s,o)}onUpdateUniforms(e,i){const s=Ne.Current;if(e&&(ni.viewProjection&&this.uniforms[this._viewProjectionName]&&(ni.viewProjection.copy(e.projectionMatrix).multiply(e.matrixWorldInverse),bv(ni.viewProjection,ni._viewProjectionValues)),ni.viewMatrix&&this.uniforms[this._viewMatrixName]&&(ni.viewMatrix.copy(e.matrixWorldInverse),bv(ni.viewMatrix,ni._viewMatrixValues)),this.uniforms[ni._worldSpaceCameraPosName]&&ni._worldSpaceCameraPos.setFromMatrixPosition(e.matrixWorld)),this.uniforms._TimeParameters&&(this.uniforms._TimeParameters.value=s.sceneLighting.timeVec4),this.uniforms._Time){const l=this.uniforms._Time.value;l.x=s.sceneLighting.timeVec4.x/20,l.y=s.sceneLighting.timeVec4.x,l.z=s.sceneLighting.timeVec4.x*2,l.w=s.sceneLighting.timeVec4.x*3}if(this.uniforms._SinTime){const l=this.uniforms._SinTime.value;l.x=Math.sin(s.sceneLighting.timeVec4.x/8),l.y=Math.sin(s.sceneLighting.timeVec4.x/4),l.z=Math.sin(s.sceneLighting.timeVec4.x/2),l.w=Math.sin(s.sceneLighting.timeVec4.x)}if(this.uniforms._CosTime){const l=this.uniforms._CosTime.value;l.x=Math.cos(s.sceneLighting.timeVec4.x/8),l.y=Math.cos(s.sceneLighting.timeVec4.x/4),l.z=Math.cos(s.sceneLighting.timeVec4.x/2),l.w=Math.cos(s.sceneLighting.timeVec4.x)}if(this.uniforms.unity_DeltaTime){const l=this.uniforms.unity_DeltaTime.value;l.x=s.time.deltaTime,l.y=1/s.time.deltaTime,l.z=s.time.smoothedDeltaTime,l.w=1/s.time.smoothedDeltaTime}const r=s.mainLight;if(r){const l=qe(r.gameObject,ni._mainLightPosition);this.uniforms._MainLightPosition={value:l.normalize()},ni._mainLightColor.set(r.color.r,r.color.g,r.color.b,0),this.uniforms._MainLightColor={value:ni._mainLightColor};const h=r.intensity;ni._lightData.z=h,this.uniforms.unity_LightData={value:ni._lightData}}if(e&&(ni.viewProjection&&this.uniforms[this._viewProjectionName]&&(this.uniforms[this._viewProjectionName].value=ni._viewProjectionValues),ni.viewMatrix&&this.uniforms[this._viewMatrixName]&&(this.uniforms[this._viewMatrixName].value=ni._viewMatrixValues),this.uniforms[ni._worldSpaceCameraPosName]&&(this.uniforms[ni._worldSpaceCameraPosName]={value:ni._worldSpaceCameraPos}),s.mainCameraComponent)){if(this.uniforms._ProjectionParams){const l=this.uniforms._ProjectionParams.value;l.x=1,l.y=s.mainCameraComponent.nearClipPlane,l.z=s.mainCameraComponent.farClipPlane,l.w=1/l.z,this.uniforms._ProjectionParams.value=l}if(this.uniforms._ZBufferParams){const l=this.uniforms._ZBufferParams.value,h=s.mainCameraComponent;l.x=1-h.farClipPlane/h.nearClipPlane,l.y=h.farClipPlane/h.nearClipPlane,l.z=l.x/h.farClipPlane,l.w=l.y/h.farClipPlane,this.uniforms._ZBufferParams.value=l}if(this.uniforms._ScreenParams){const l=this.uniforms._ScreenParams.value;l.x=s.domWidth,l.y=s.domHeight,l.z=1+1/l.x,l.w=1+1/l.y,this.uniforms._ScreenParams.value=l}if(this.uniforms._ScaledScreenParams){const l=this.uniforms._ScaledScreenParams.value;l.x=s.domWidth,l.y=s.domHeight,l.z=1+1/l.x,l.w=1+1/l.y,this.uniforms._ScaledScreenParams.value=l}}const o=this.depthTextureUniform;o&&(o.value=s.depthTexture);const a=this.opaqueTextureUniform;if(a&&(a.value=s.opaqueColorTexture),i){const l=this._rendererData;l.updateFrom(i),this.uniforms[this._worldToObjectName].value=l.worldToObject,this.uniforms[this._objToWorldName].value=l.objectToWorld}this.uniformsNeedUpdate=!0}};let kr=ni;c(kr,"viewProjection",new ce),c(kr,"_viewProjectionValues",[]),c(kr,"viewMatrix",new ce),c(kr,"_viewMatrixValues",[]),c(kr,"_worldSpaceCameraPosName","_WorldSpaceCameraPos"),c(kr,"_worldSpaceCameraPos",new C),c(kr,"_mainLightColor",new ke),c(kr,"_mainLightPosition",new C),c(kr,"_lightData",new ke);class jH{constructor(t,e){c(this,"parser");c(this,"identifier");this.parser=t,this.identifier=e}get name(){return Cu}loadMaterial(t){const e=this.parser.json.materials[t];if(!e)return ac&&console.log(t,this.parser.json.materials),null;if(!e.extensions||!e.extensions[Cu])return ac&&console.log("material "+t+" does not use NEEDLE_techniques_webgl"),null;const i=e.extensions[Cu].technique;if(i<0)return null;const s=this.parser.json.extensions[Cu];if(!s)return null;ac&&console.log(s);const r=s.techniques[i];return r?new Promise(async(o,a)=>{var y,b,_;const l=await P6(s,r.program),h=l==null?void 0:l.fragmentShader,u=l==null?void 0:l.vertexShader;if(!h||!u)return a();ac&&console.log("loadMaterial",e,l);const d={},f=r.uniforms;(u.includes("_Time")||h.includes("_Time"))&&(d._Time={value:new ke(0,0,0,0)}),(u.includes("_SinTime")||h.includes("_SinTime"))&&(d._SinTime={value:new ke(0,0,0,0)}),(u.includes("_CosTime")||h.includes("_CosTime"))&&(d._CosTime={value:new ke(0,0,0,0)}),(u.includes("unity_DeltaTime")||h.includes("unity_DeltaTime"))&&(d.unity_DeltaTime={value:new ke(0,0,0,0)});for(const x in f){const S=x;switch(S){case"_TimeParameters":const T=new ke;d[S]={value:T};break;case"hlslcc_mtx4x4unity_MatrixV":case"hlslcc_mtx4x4unity_MatrixVP":d[S]={value:[]};break;case"_MainLightPosition":case"_MainLightColor":case"_WorldSpaceCameraPos":d[S]={value:[0,0,0,1]};break;case"unity_OrthoParams":break;case"unity_SpecCube0":d[S]={value:null};break;default:case"_ScreenParams":case"_ZBufferParams":case"_ProjectionParams":d[S]={value:[0,0,0,0]};break;case"_CameraOpaqueTexture":case"_CameraDepthTexture":d[S]={value:null};break}}let p=!1;if(e.extensions&&e.extensions[Cu]){const x=e.extensions[Cu];if(x.technique===i){ac&&console.log(e.name,"Material Properties",x);for(const S in x.values){const T=x.values[S];if(typeof T=="string"){if(T.startsWith("/textures/")){const L=T.substring(10),I=Number.parseInt(L);if(I>=0){const P=await this.parser.getDependency("texture",I);P instanceof pt&&(P.colorSpace=Di,P.needsUpdate=!0),d[S]={value:P};continue}}switch(S){case"alphaMode":T==="BLEND"&&(p=!0);continue}}if(Array.isArray(T)&&T.length===4){d[S]={value:new ke(T[0],T[1],T[2],T[3])};continue}d[S]={value:T}}}}const g=new kr(this.identifier,{name:e.name??"",uniforms:d,vertexShader:u,fragmentShader:h,lights:!1});switch(g.glslVersion=G2,g.vertexShader=g.vertexShader.replace("#version 300 es",""),g.fragmentShader=g.fragmentShader.replace("#version 300 es",""),(y=d._Cull)==null?void 0:y.value){case Dp.Off:g.side=pi;break;case Dp.Front:g.side=pc;break;case Dp.Back:g.side=Oa;break;default:g.side=Oa;break}switch((b=d._ZTest)==null?void 0:b.value){case nl.Equal:g.depthTest=!0,g.depthFunc=ev;break;case nl.NotEqual:g.depthTest=!0,g.depthFunc=px;break;case nl.Less:g.depthTest=!0,g.depthFunc=x_;break;case nl.LEqual:g.depthTest=!0,g.depthFunc=HR;break;case nl.Greater:g.depthTest=!0,g.depthFunc=jR;break;case nl.GEqual:g.depthTest=!0,g.depthFunc=GR;break;case nl.Always:g.depthTest=!1,g.depthFunc=VR;break}g.transparent=p,p&&(g.depthWrite=!1),R6(d),g.onUpdateUniforms();for(const x in f){const S=x,T=f[x].type;if(((_=d[S])==null?void 0:_.value)===void 0)switch(T){case Uw.SAMPLER_2D:d[S]={value:I6},console.warn("Missing/unassigned texture, fallback to white: "+S);break;default:S==="unity_OrthoParams"||console.warn("TODO: EXPECTED UNIFORM / fallback NOT SET: "+S,f[x]);break}}ac&&console.log(g.uuid,d),Tk(g),o(g)}):null}}function Tk(n){if(n.uniforms){ac&&console.log("Uniforms:",n.uniforms);for(const e in n.uniforms)switch(t(e,e),e){case"_Color":t("color",e);break}}function t(e,i){Object.getOwnPropertyDescriptor(n,e)||Object.defineProperty(n,e,{get:()=>n.uniforms[i].value,set:s=>{n.uniforms[i].value=s,n.needsUpdate=!0}})}}const GH=N("debugextensions");let Pv;const HH=hy(()=>import("./GLTFLoaderAnimationPointer-0c78b86e.js"),["./GLTFLoaderAnimationPointer-0c78b86e.js","./three.module-8eacf7c9.js"],import.meta.url).then(async n=>(Pv=n.GLTFAnimationPointerExtension,Pv)).catch(n=>{console.warn("Failed to import GLTFLoaderAnimationPointer. Please use @needle-tools/three for full KHR_animation support",n)}),Gh=new Array;function CX(n){Gh.includes(n)||Gh.push(n)}function SX(n){const t=Gh.indexOf(n);t>=0&&Gh.splice(t,1)}function Rk(n){const t=new UH;return n.register(e=>(t.parser=e,t)),t}class VH{resolvePath(t){return t.includes("/extensions/builtin_components/")?t.replace("/extensions/builtin_components/","/userData/components/"):t.includes("extensions/builtin_components/")?t.replace("extensions/builtin_components/","/userData/components/"):t}}async function Bk(n,t,e){const i=e.indexOf("?");i>=0&&(e=e.substring(0,i)),n.register(s=>new NH(s)),n.register(s=>new L8(s)),n.register(s=>new y6(s,t.lightmaps,e)),n.register(s=>new QH(s,e,t)),n.register(s=>new jH(s,e)),n.register(s=>new Mp(s,e)),n.register(s=>new ct(s,e)),n.register(s=>new kH(s)),pz()&&n.register(s=>new Ap(s)),await HH.catch(s=>{}),n.register(s=>{if(Pv){const r=new Pv(s);return r.setAnimationPointerResolver.bind(r)(new VH),r}else return(GH||xe())&&console.error("Missing KHR_animation_pointer extension..."),{name:"KHR_animation_pointer_NOT_AVAILABLE"}});for(const s of Gh)s.onImport&&s.onImport(n,e,t)}function WH(n,t){for(const e of Gh)e.onExport&&e.onExport(n,t)}function Pk(n,t,e){for(const i of Gh)i.onLoaded&&i.onLoaded(n,t,e)}const Ao=N("debuginstancing"),kS=class{constructor(){c(this,"objs",[])}setup(t,e,i,s,r,o=0){t.applySettings(e);const a=this.tryCreateOrAddInstance(e,i,r);if(a)ct.assignTextureLOD(a.renderer.material,0),s===null&&(s=[]),s.push(a);else if(o<=0&&e.type!=="Mesh"){const l=o+1;for(const h of e.children)s=this.setup(t,h,i,s,r,l)}return o===0&&r.useMatrixWorldAutoUpdate&&s&&s.length>=0&&this.autoUpdateInstanceMatrix(e),s}tryCreateOrAddInstance(t,e,i){if(t.type==="Mesh"){const s=i.foundMeshes;if(i.foundMeshes+=1,!i.rend.enableInstancing)return null;if(i.rend.enableInstancing!==!0){if(s>=i.rend.enableInstancing.length)return Ao&&console.error("Something is wrong with instance setup",t,i.rend.enableInstancing,s),null;if(!i.rend.enableInstancing[s])return null}const r=t,o=r.material;for(const d of this.objs){if(!d.canAdd(r.geometry,o))continue;return d.addInstance(r)}const a=16;let l=t.name;l!=null&&l.length||(l=rB());const h=new Mk(l,r.geometry,o,a,e);return this.objs.push(h),h.addInstance(r)}return null}autoUpdateInstanceMatrix(t){const e=t.matrixWorld.multiplyMatrices.bind(t.matrixWorld),i=t.matrixWorld.clone(),s=(r,o)=>{const a=e(r,o);return(t[mg]||i.equals(a)===!1)&&(i.copy(a),t[mg]=!0),a};t.matrixWorld.multiplyMatrices=s}};let _d=kS;c(_d,"instance",new kS);const Kp=class{constructor(t,e){c(this,"object");c(this,"renderer");c(this,"__instanceIndex",-1);c(this,"__reservedVertexRange",0);c(this,"__reservedIndexRange",0);c(this,"meshInformation");this.__instanceIndex=-1,this.object=t,this.renderer=e,t[gM]=e,this.meshInformation=Nu(t.geometry),Kp.all.push(this)}get name(){return this.object.name}get isActive(){return this.__instanceIndex>=0}get vertexCount(){return this.object.geometry.attributes.position.count}get maxVertexCount(){return this.meshInformation.vertexCount}get reservedVertexCount(){return this.__reservedVertexRange}get indexCount(){return this.object.geometry.index?this.object.geometry.index.count:0}get maxIndexCount(){return this.meshInformation.indexCount}get reservedIndexCount(){return this.__reservedIndexRange}updateInstanceMatrix(t=!1,e=!0){this.__instanceIndex<0||(e&&this.object.updateWorldMatrix(!0,t),this.renderer.updateInstance(this.object.matrixWorld,this.__instanceIndex))}setMatrix(t){this.__instanceIndex<0||this.renderer.updateInstance(t,this.__instanceIndex)}setGeometry(t){return this.__instanceIndex<0?!1:this.vertexCount>this.__reservedVertexRange?(console.error(`Cannot update geometry, reserved range is too small: ${this.__reservedVertexRange} < ${this.vertexCount} vertices for ${this.name}`),!1):this.indexCount>this.__reservedIndexRange?(console.error(`Cannot update geometry, reserved range is too small: ${this.__reservedIndexRange} < ${this.indexCount} indices for ${this.name}`),!1):this.renderer.updateGeometry(t,this.__instanceIndex)}add(){this.__instanceIndex>=0||(this.renderer.add(this),z.markAsInstancedRendered(this.object,!0))}remove(t){if(!(this.__instanceIndex<0)&&(this.renderer.remove(this,t),z.markAsInstancedRendered(this.object,!1),t)){const e=Kp.all.indexOf(this);e>=0&&Kp.all.splice(e,1)}}};let wd=Kp;c(wd,"all",[]);class Mk{constructor(t,e,i,s,r){c(this,"allowResize",!0);c(this,"name","");c(this,"geometry");c(this,"material");c(this,"context");c(this,"inst");c(this,"handles",[]);c(this,"maxInstanceCount");c(this,"_currentInstanceCount",0);c(this,"_currentVertexCount",0);c(this,"_currentIndexCount",0);c(this,"_maxVertexCount");c(this,"_maxIndexCount");c(this,"_needUpdateBounds",!1);c(this,"_debugMaterial",null);c(this,"onBeforeRender",()=>{this.inst.layers.enableAll(),this._needUpdateBounds&&this.inst[np]===!0&&(Ao&&console.log("Update instancing bounds",this.name,this.inst.matrixWorldNeedsUpdate),this.updateBounds())});c(this,"onAfterRender",()=>{this.inst.layers.disableAll()});c(this,"_availableBuckets",new Array);c(this,"_usedBuckets",new Array);this.name=t,this.geometry=e,this.material=i,this.context=r,this.maxInstanceCount=Math.max(2,s),Ao&&(this._debugMaterial=YI());const o=this.tryEstimateVertexCountSize(this.maxInstanceCount,[e],s);this._maxVertexCount=o.vertexCount,this._maxIndexCount=o.indexCount,this.inst=new WS(this.maxInstanceCount,this._maxVertexCount,this._maxIndexCount,this._debugMaterial??this.material),this.inst[np]=!0,this.inst.visible=!0,this.context.scene.add(this.inst),i instanceof JR&&(i.defines.USE_INSTANCING=!0,i.needsUpdate=!0),r.pre_render_callbacks.push(this.onBeforeRender),r.post_render_callbacks.push(this.onAfterRender),Ao&&console.log(`Instanced renderer created with ${this.maxInstanceCount} instances, ${this._maxVertexCount} max vertices and ${this._maxIndexCount} max indices for "${t}"`)}get mesh(){return this.inst}get visible(){return this.inst.visible}set visible(t){this.inst.visible=t}get castShadow(){return this.inst.castShadow}set castShadow(t){this.inst.castShadow=t}set receiveShadow(t){this.inst.receiveShadow=t}updateBounds(t=!0,e=!0){this._needUpdateBounds=!1,t&&this.inst.computeBoundingBox(),e&&this.inst.computeBoundingSphere()}get count(){return this._currentInstanceCount}canAdd(t,e){return this._maxVertexCount>1e7||e!==this.material?!1:!!(!this.mustGrow(t)||this.allowResize)}dispose(){Ao&&console.warn("Dispose instanced renderer",this.name),this.context.scene.remove(this.inst),this.inst.dispose(),this.inst=null,this.handles=[]}addInstance(t){const e=new wd(t,this);t.castShadow===!0&&this.inst.castShadow===!1&&(this.inst.castShadow=!0),t.receiveShadow===!0&&this.inst.receiveShadow===!1&&(this.inst.receiveShadow=!0);try{this.add(e)}catch(i){return console.error(`Failed adding mesh to instancing
`,i),xe()&&pP("Failed instancing mesh. See the browser console for details."),null}return e}add(t){const e=t.object.geometry;if(!this.validateGeometry(e)){Ao&&console.error("Cannot add instance, invalid geometry",this.name,e);return}if(this.mustGrow(e))if(this.allowResize)this.grow(e);else{console.error("Cannot add instance, max count reached",this.name,this.count,this.maxInstanceCount);return}t.object.updateWorldMatrix(!0,!0),this.addGeometry(t),this.handles[t.__instanceIndex]=t,this._currentInstanceCount+=1,this.markNeedsUpdate(),this._currentInstanceCount>0&&(this.inst.visible=!0)}remove(t,e){t&&(t.__instanceIndex<0||this.handles[t.__instanceIndex]!=t||this._currentInstanceCount<=0||(this.removeGeometry(t,e),this.handles[t.__instanceIndex]=null,t.__instanceIndex=-1,this._currentInstanceCount>0&&(this._currentInstanceCount-=1),this._currentInstanceCount<=0&&(this.inst.visible=!1),this.markNeedsUpdate()))}updateInstance(t,e){this.inst.setMatrixAt(e,t),this.markNeedsUpdate()}updateGeometry(t,e){return this.validateGeometry(t)?(this.mustGrow()&&this.grow(t),Ao&&console.debug("UPDATE MESH",e,t.name,Nu(t),t.attributes.position.count,t.index?t.index.count:0),this.inst.setGeometryAt(e,t),this.markNeedsUpdate(),!0):!1}validateGeometry(t){return this.geometry,!0}markNeedsUpdate(){this._needUpdateBounds=!0}mustGrow(t){if(this.count>=this.maxInstanceCount)return!0;if(!t)return!1;const e=Nu(t),i=e.vertexCount,s=e.indexCount;return this._currentVertexCount+i>this._maxVertexCount||this._currentIndexCount+s>this._maxIndexCount}grow(t){const e=this.maxInstanceCount*2,i=this.tryEstimateVertexCountSize(e,[t]),s=Math.max(this._maxVertexCount,i.vertexCount),r=Math.max(this._maxIndexCount,i.indexCount,this._maxVertexCount*2);if(Ao){const a=Nu(t);console.warn(`Growing batched mesh for "${this.name}/${t.name}" ${a.vertexCount} vertices, ${a.indexCount} indices
Max count ${this.maxInstanceCount} â†’ ${e}
Max vertex count ${this._maxVertexCount} -> ${s}
Max index count ${this._maxIndexCount} -> ${r}`),this._debugMaterial=YI()}this._maxVertexCount=s,this._maxIndexCount=r;const o=new WS(e,this._maxVertexCount,this._maxIndexCount,this._debugMaterial??this.material);o.layers=this.inst.layers,o.castShadow=this.inst.castShadow,o.receiveShadow=this.inst.receiveShadow,o.visible=this.inst.visible,o[np]=this.inst[np],o.matrixAutoUpdate=this.inst.matrixAutoUpdate,o.matrixWorldNeedsUpdate=this.inst.matrixWorldNeedsUpdate,o.matrixAutoUpdate=this.inst.matrixAutoUpdate,o.matrixWorld.copy(this.inst.matrixWorld),o.matrix.copy(this.inst.matrix),this.inst.dispose(),this.inst.removeFromParent(),this.inst=o,this.maxInstanceCount=e;for(const a of this.handles)a&&a.__instanceIndex>=0&&this.addGeometry(a);this.context.scene.add(o)}tryEstimateVertexCountSize(t,e,i=1){const s=new Map;for(const d of this.handles)if(d&&d.__instanceIndex>=0)if(s.has(d.object.geometry)){const f=s.get(d.object.geometry);f.count+=1}else{const f={count:1,...Nu(d.object.geometry)};s.set(d.object.geometry,f)}let r=0,o=0;for(const[d,f]of s)r+=f.vertexCount*f.count,o+=f.indexCount*f.count;let l=Math.ceil(r/Math.max(1,this._currentInstanceCount))*t,u=Math.ceil(o/Math.max(1,this._currentInstanceCount))*t*2;if(e)for(const d of e){const f=Nu(d);l+=f.vertexCount*i,u+=f.indexCount*i}return{vertexCount:l,indexCount:u}}addGeometry(t){let e=null,i=-1;for(let o=this._availableBuckets.length-1;o>=0;o--){const a=this._availableBuckets[o];a.vertexCount>=t.maxVertexCount&&a.indexCount>=t.maxIndexCount&&(e==null||a.vertexCount<e.vertexCount)&&(e=a,i=o)}if(e!=null){const o=e;Ao&&console.debug(`RE-USE SPACE #${o.index}, ${t.maxVertexCount} vertices, ${t.maxIndexCount} indices, ${t.name}`),this.inst.setGeometryAt(o.index,t.object.geometry),this.inst.setMatrixAt(o.index,t.object.matrixWorld),this.inst.setVisibleAt(o.index,!0),t.__instanceIndex=o.index,this._usedBuckets[o.index]=o,this._availableBuckets.splice(i,1);return}const s=t.object.geometry;Ao&&console.debug("ADD GEOMETRY",s.name,`
vertex:`,`${this._currentVertexCount} + ${t.maxVertexCount} < ${this._maxVertexCount}?`,`
index:`,t.maxIndexCount,this._currentIndexCount,this._maxIndexCount);const r=this.inst.addGeometry(s,t.maxVertexCount,t.maxIndexCount);t.__instanceIndex=r,t.__reservedVertexRange=t.maxVertexCount,t.__reservedIndexRange=t.maxIndexCount,this._currentVertexCount+=t.maxVertexCount,this._currentIndexCount+=t.maxIndexCount,this._usedBuckets[r]={index:r,vertexCount:t.maxVertexCount,indexCount:t.maxIndexCount},this.inst.setMatrixAt(r,t.object.matrixWorld),Ao&&console.debug(`ADD MESH & RESERVE SPACE #${r}, ${t.maxVertexCount} vertices, ${t.maxIndexCount} indices, ${t.name} ${t.object.uuid}`)}removeGeometry(t,e){t.__instanceIndex<0||(this._usedBuckets.splice(t.__instanceIndex,1),this.inst.setVisibleAt(t.__instanceIndex,!1),this._availableBuckets.push({index:t.__instanceIndex,vertexCount:t.reservedVertexCount,indexCount:t.reservedIndexCount}))}}c(Mk,"nullMatrix",new ce);function Nu(n){let t=n.attributes.position.count,e=n.index?n.index.count:0;const i=ct.getMeshLODInformation(n);if(i){const s=i.lods[0];let r=s.vertexCount,o=s.indexCount;r+=10,r+=r*.05,o+=20,t=Math.max(t,r),e=Math.max(e,o)}return t=Math.ceil(t),e=Math.ceil(e),{vertexCount:t,indexCount:e}}function YI(){const n=new mr({color:new we(Math.random(),Math.random(),Math.random())});return n.emissive=n.color,n.emissiveIntensity=.3,N("wireframe")&&(n.wireframe=!0),n}const Su=N("debuglightmaps");class Mv{constructor(t,e){c(this,"lightmapIndex",-1);c(this,"lightmapScaleOffset",new ke(1,1,0,0));c(this,"context");c(this,"gameObject");c(this,"lightmapTexture",null);c(this,"lightmapScaleOffsetUniform",{value:new ke(1,1,0,0)});c(this,"lightmapUniform",{value:null});c(this,"onBeforeCompile",(t,e)=>{Su&&console.log(`Lightmaps, before compile
`,t),this.lightmapScaleOffsetUniform.value=this.lightmapScaleOffset,this.lightmapUniform.value=this.lightmapTexture,t.uniforms.lightmapScaleOffset=this.lightmapScaleOffsetUniform});this.gameObject=t,this.context=e}get lightmap(){return this.lightmapTexture}set lightmap(t){t!==this.lightmapTexture&&(this.lightmapTexture=t,this.applyLightmap())}init(t,e,i){console.assert(this.gameObject!==void 0&&this.gameObject!==null,"Missing gameobject",this),this.lightmapIndex=t,!(this.lightmapIndex<0)&&(this.lightmapScaleOffset=e,this.lightmapTexture=i,ct.assignTextureLOD(this.lightmapTexture,0).then(s=>{s instanceof pt&&(this.lightmapTexture=s)}),Su=="show"?(console.log("Lightmap:",this.gameObject.name,t,`
ScaleOffset:`,e,`
Texture:`,i),this.setLightmapDebugMaterial()):Su&&console.log("Use debuglightmaps=show to render lightmaps only in the scene."),this.applyLightmap())}updateLightmapUniforms(t){const e=t.uniforms;e&&e.lightmap&&(this.lightmapScaleOffsetUniform.value=this.lightmapScaleOffset,e.lightmapScaleOffset=this.lightmapScaleOffsetUniform)}applyLightmap(){if(this.gameObject.type==="Object3D"){Su&&console.warn("Can not add lightmap. Is this object missing a renderer?",this.gameObject.name);return}if(this.gameObject.type==="Group"){console.warn("Lightmap on multimaterial object is not supported yet... please open a feature request on https://github.com/needle-tools/needle-engine-support if your project requires it");return}console.assert(this.gameObject.type==="Mesh","Lightmap only works on meshes",this);const t=this.gameObject;if(t.geometry.getAttribute("uv1")||t.geometry.setAttribute("uv1",t.geometry.getAttribute("uv")),Array.isArray(this.gameObject.material)){const e=this.gameObject.material;for(let i=0;i<e.length;i++)e[i]=this.ensureLightmapMaterial(e[i])}else this.gameObject.material=this.ensureLightmapMaterial(this.gameObject.material);if(this.lightmapIndex>=0&&this.lightmapTexture){this.lightmapTexture.channel=1;const e=this.gameObject.material;if(Array.isArray(e))for(const i of e)this.assignLightmapTexture(i);else e&&this.assignLightmapTexture(e)}}ensureLightmapMaterial(t){return t.userData||(t.userData={}),t["NEEDLE:lightmap-material-version"]!=t.version&&t["NEEDLE:lightmap-material-version"]==null&&(Su&&console.warn("Cloning material for lightmap "+t.name),t=t.clone(),t.onBeforeCompile=this.onBeforeCompile),t}assignLightmapTexture(t){!t||t instanceof io&&t.transmission>0||!(t.lightMap!==this.lightmapTexture||t["NEEDLE:lightmap-material-version"]!==t.version)||(Su&&console.log("Assigning lightmap",t.name,t.version),t.lightMap=this.lightmapTexture,t["NEEDLE:lightmap-material-version"]=t.version)}setLightmapDebugMaterial(){this.gameObject.material=new $e({vertexShader:`
                varying vec2 vUv1;
                void main()
                {
                    vUv1 = uv1;
                    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
                }
                `,fragmentShader:`
                uniform sampler2D lightMap;
                uniform float lightMapIntensity;
                uniform vec4 lightmapScaleOffset;
                varying vec2 vUv1;

                // took from threejs 05fc79cd52b79e8c3e8dec1e7dca72c5c39983a4
                vec4 conv_sRGBToLinear( in vec4 value ) {
                    return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
                }

                void main() {
                    vec2 lUv = vUv1.xy * lightmapScaleOffset.xy + vec2(lightmapScaleOffset.z, (1. - (lightmapScaleOffset.y + lightmapScaleOffset.w)));
                    
                    vec4 lightMapTexel = texture2D( lightMap, lUv);
                    gl_FragColor = lightMapTexel;
                    gl_FragColor.a = 1.;
                }
                `,defines:{USE_LIGHTMAP:""}})}}var kl=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};const ap=N("debugrenderer"),KI=N("debugskinnedmesh"),JI=N("noinstancing"),qH=N("wireframe");var Zu;(function(n){n[n.Off=0]="Off",n[n.BlendProbes=1]="BlendProbes",n[n.BlendProbesAndSkybox=2]="BlendProbesAndSkybox",n[n.Simple=3]="Simple"})(Zu||(Zu={}));class Dk{constructor(){c(this,"path",null);c(this,"asset",null);c(this,"default")}}var ZI;(function(n){n[n.Both=0]="Both",n[n.Back=1]="Back",n[n.Front=2]="Front"})(ZI||(ZI={}));class XH{constructor(t,e){c(this,"_renderer");c(this,"_targets",[]);c(this,"_indexMapMaxIndex");c(this,"_indexMap");c(this,"_changed",!1);this._renderer=t;const i=this.setMaterial.bind(this),s=this.getMaterial.bind(this),r=t.gameObject;if(this._targets=[],r)switch(r.type){case"Group":this._targets=[...r.children];break;case"SkinnedMesh":case"Mesh":this._targets.push(r);break}let o=!1,a,l=0;for(let h=0;h<this._targets.length;h++){const u=this._targets[h];if(!u)continue;const d=u.material;if(d){d.shadowSide=d.side;for(let f=0;f<e.length;f++){const p=e[f];if(!p){o=!0;continue}if(d.name===p.name){a===void 0&&(a=new Map),a.set(f,h),l=Math.max(l,f);break}}}}if(o){this._indexMapMaxIndex=l,this._indexMap=a;const h=`Renderer ${t.name} was initialized with missing materials - this may lead to unexpected behaviour when trying to access sharedMaterials by index.`;console.warn(h),qs()&&Yt("Found renderer with missing materials: please check the console for details.")}return new Proxy(this,{get(h,u){if(typeof u=="string"){const d=parseInt(u);if(!isNaN(d))return s(d)}return h[u]},set(h,u,d){return typeof u=="string"&&i(d,Number.parseInt(u)),Reflect.set(h,u,d)?(d instanceof ft&&(h.changed=!0),!0):!1}})}get changed(){return this._changed}set changed(t){t===!0&&ap&&console.warn("SharedMaterials have changed: "+this._renderer.name,this),this._changed=t}is(t){return this._renderer===t}get length(){return this._indexMapMaxIndex!==void 0?this._indexMapMaxIndex+1:this._targets.length}*[Symbol.iterator](){for(let t=0;t<this.length;t++)yield this.getMaterial(t)}resolveIndex(t){const e=this._indexMap;return e&&e.has(t)?e.get(t):t}setMaterial(t,e){if(e=this.resolveIndex(e),e<0||e>=this._targets.length)return;const i=this._targets[e];!i||i.material===void 0||(i.material=t,this.changed=!0)}getMaterial(t){if(t=this.resolveIndex(t),t<0)return null;const e=this._targets;if(t>=e.length)return null;const i=e[t];return i?i.material:null}}class ci extends se{constructor(){super(...arguments);c(this,"receiveShadows",!1);c(this,"shadowCastingMode",Dv.Off);c(this,"lightmapIndex",-1);c(this,"lightmapScaleOffset",new ke(1,1,0,0));c(this,"enableInstancing");c(this,"renderOrder");c(this,"allowOcclusionWhenDynamic",!0);c(this,"probeAnchor");c(this,"reflectionProbeUsage",Zu.Off);c(this,"_lightmaps");c(this,"_sharedMeshes",[]);c(this,"_sharedMaterials");c(this,"_originalMaterials");c(this,"_probeAnchorLastFrame");c(this,"_lightmapTextureOverride");c(this,"allowProgressiveLoading",!0);c(this,"_firstFrame",-1);c(this,"_isInstancingEnabled",!1);c(this,"handles");c(this,"onBeforeRenderThree",(e,i,s,r,o,a)=>{var l;if(o.envMapIntensity!==void 0){const h=this.hasLightmap?Math.PI:1,u=((l=this.context.mainCameraComponent)==null?void 0:l.environmentIntensity)??1;o.envMapIntensity=Math.max(0,u*this.context.sceneLighting.environmentIntensity/h)}if(this._lightmaps)for(const h of this._lightmaps)h.updateLightmapUniforms(o),h.applyLightmap()});c(this,"_reflectionProbe",null)}static setInstanced(e,i){const s=ky(e,ci);return s.setInstancingEnabled(i),s}static isInstanced(e){const i=qd(e,ci);return i?i.isInstancingActive:Bo.isUsingInstancing(e)}static setVisible(e,i){lh(e,i)}get sharedMesh(){if(this.gameObject.type==="Mesh")return this.gameObject;if(this.gameObject.type==="SkinnesMesh")return this.gameObject;if(this.gameObject.type==="Group")return this.gameObject.children[0]}get sharedMeshes(){if(this.destroyed||!this.gameObject)return this._sharedMeshes;if(this._sharedMeshes.length=0,this.gameObject.type==="Group")for(const e of this.gameObject.children)(e.type==="Mesh"||e.type==="SkinnedMesh")&&this._sharedMeshes.push(e);else(this.gameObject.type==="Mesh"||this.gameObject.type==="SkinnedMesh")&&this._sharedMeshes.push(this.gameObject);return this._sharedMeshes}get sharedMaterial(){return this.sharedMaterials[0]}set sharedMaterial(e){this.sharedMaterials[0]!==e&&(this.sharedMaterials[0]=e,this.applyLightmapping())}get material(){return this.sharedMaterials[0]}set material(e){this.sharedMaterial=e}set sharedMaterials(e){if(!this._originalMaterials)this._originalMaterials=e;else if(e){let i=!1;for(let s=0;s<this._sharedMaterials.length;s++){const r=s<e.length?e[s]:null;r&&r instanceof ft?this.sharedMaterials[s]=r:i||(i=!0,console.warn("Can not assign null as material: "+this.name,r))}}}get sharedMaterials(){return(!this._sharedMaterials||!this._sharedMaterials.is(this))&&(this._originalMaterials||(this._originalMaterials=[]),this._sharedMaterials=new XH(this,this._originalMaterials)),this._sharedMaterials}static get shouldSuppressInstancing(){return JI}get lightmap(){var e;return(e=this._lightmaps)!=null&&e.length?this._lightmaps[0].lightmap:null}set lightmap(e){var i;if(this._lightmapTextureOverride=e,e===void 0&&(e=this.context.lightmaps.tryGetLightmap(this.sourceId,this.lightmapIndex)),(i=this._lightmaps)!=null&&i.length)for(const s of this._lightmaps)s.lightmap=e}get hasLightmap(){const e=this.lightmap;return e!=null}registering(){this.enabled||this.setVisibility(!1)}awake(){if(this._firstFrame=this.context.time.frame,ap&&console.log("Renderer ",this.name,this),this.clearInstancingState(),this.probeAnchor&&ap&&this.probeAnchor.add(new Do(.2)),this._reflectionProbe=null,this.isMultiMaterialObject(this.gameObject)){for(const e of this.gameObject.children)this.context.addBeforeRenderListener(e,this.onBeforeRenderThree),e.layers.mask=this.gameObject.layers.mask;if(this.renderOrder!==void 0){let e=0;for(let i=0;i<this.gameObject.children.length;i++){const s=this.gameObject.children[i];if(!(!this.isMeshOrSkinnedMesh(s)||z.getComponent(s,ci))){if(this.renderOrder.length<=e){console.warn("Incorrect renderOrder element count",this,this.renderOrder.length+" but expected "+this.gameObject.children.length,"Index: "+e,"ChildElement:",s);continue}s.renderOrder=this.renderOrder[e],e+=1}}}}else this.isMeshOrSkinnedMesh(this.gameObject)?(this.context.addBeforeRenderListener(this.gameObject,this.onBeforeRenderThree),this.renderOrder!==void 0&&this.renderOrder.length>0&&(this.gameObject.renderOrder=this.renderOrder[0])):this.context.addBeforeRenderListener(this.gameObject,this.onBeforeRenderThree);if(this.applyLightmapping(),qH)for(let e=0;e<this.sharedMaterials.length;e++){const i=this.sharedMaterials[e];i&&(i.wireframe=!0)}}applyLightmapping(){var e;if(this.lightmapIndex>=0){const i=this.gameObject.type,s=this._lightmapTextureOverride!==void 0?this._lightmapTextureOverride:this.context.lightmaps.tryGetLightmap(this.sourceId,this.lightmapIndex);if(s){if(this._lightmaps||(this._lightmaps=[]),i==="Mesh"){const r=this.gameObject.material;if(r!=null&&r.isMeshBasicMaterial)r&&console.warn("Lightmapping is not supported on MeshBasicMaterial",r.name);else{if(this._lightmaps.length<=0){const a=new Mv(this.gameObject,this.context);this._lightmaps.push(a)}this._lightmaps[0].init(this.lightmapIndex,this.lightmapScaleOffset,s)}}else if(this.isMultiMaterialObject(this.gameObject)&&this.sharedMaterials.length>0)for(let r=0;r<this.gameObject.children.length;r++){const o=this.gameObject.children[r];if(!((e=o.material)!=null&&e.isMeshBasicMaterial)){let a;r>=this._lightmaps.length?(a=new Mv(o,this.context),this._lightmaps.push(a)):a=this._lightmaps[r],a.init(this.lightmapIndex,this.lightmapScaleOffset,s)}}}else ap&&console.warn("Lightmap not found",this.sourceId,this.lightmapIndex)}}get isInstancingActive(){return this.handles!=null&&this.handles.length>0&&this._isInstancingEnabled}setInstancingEnabled(e){if(this._isInstancingEnabled===e)return e&&(this.handles===void 0||this.handles!=null&&this.handles.length>0);if(this._isInstancingEnabled=e,e){if(this.enableInstancing===void 0&&(this.enableInstancing=!0),this.handles===void 0){if(this.handles=_d.instance.setup(this,this.gameObject,this.context,null,{rend:this,foundMeshes:0,useMatrixWorldAutoUpdate:this.useInstanceMatrixWorldAutoUpdate()}),this.handles)return z.markAsInstancedRendered(this.gameObject,!0),!0}else if(this.handles!==null){for(const i of this.handles)i.updateInstanceMatrix(!0),i.add();return z.markAsInstancedRendered(this.gameObject,!0),!0}}else{if(this.handles)for(const i of this.handles)i.remove(this.destroyed);return!0}return!1}clearInstancingState(){this._isInstancingEnabled=!1,this.handles=void 0}useInstanceMatrixWorldAutoUpdate(){return!0}start(){if(this.enableInstancing&&!JI&&(this.setInstancingEnabled(!0),Bo.markDirty(this.gameObject)),this.gameObject.frustumCulled=this.allowOcclusionWhenDynamic,this.isMultiMaterialObject(this.gameObject))for(let e=0;e<this.gameObject.children.length;e++){const i=this.gameObject.children[e];i.frustumCulled=this.allowOcclusionWhenDynamic}}onEnable(){this.sharedMeshes,this.setVisibility(!0),this._isInstancingEnabled||this.enableInstancing==!0||Array.isArray(this.enableInstancing)&&this.enableInstancing.some(i=>i)?this.__internalDidAwakeAndStart&&this.setInstancingEnabled(!0):this.enabled&&this.applyStencil(),this.updateReflectionProbe()}onDisable(){this.setVisibility(!1),this.handles&&this.handles.length>0&&this.setInstancingEnabled(!1)}onDestroy(){if(this.handles=null,this.isMultiMaterialObject(this.gameObject))for(const e of this.gameObject.children)this.context.removeBeforeRenderListener(e,this.onBeforeRenderThree);else this.context.removeBeforeRenderListener(this.gameObject,this.onBeforeRenderThree)}onBeforeRender(){var e,i,s;if(this.gameObject){if(this._probeAnchorLastFrame!==this.probeAnchor&&((e=this._reflectionProbe)==null||e.onUnset(this),this.updateReflectionProbe()),ap==this.name&&this.gameObject instanceof J){this.gameObject.geometry.computeBoundingSphere();const r=Pi(this.gameObject.geometry.boundingSphere.center).applyMatrix4(this.gameObject.matrixWorld);De.DrawWireSphere(r,this.gameObject.geometry.boundingSphere.radius,56831)}if(this.isMultiMaterialObject(this.gameObject)&&((i=this.gameObject.children)==null?void 0:i.length)>0)for(const r of this.gameObject.children)this.applySettings(r);else this.applySettings(this.gameObject);if(this.sharedMaterials.changed&&(this.sharedMaterials.changed=!1,this.applyLightmapping()),(s=this.handles)!=null&&s.length&&this.gameObject[mg]===!0){this.gameObject[mg]=!1;for(let o=this.handles.length-1;o>=0;o--)this.handles[o].updateInstanceMatrix();this.gameObject.matrixWorldNeedsUpdate=!1}if(this.handles&&this.handles.length<=0&&z.markAsInstancedRendered(this.gameObject,!1),this._isInstancingEnabled&&this.handles)for(let r=0;r<this.handles.length;r++){const o=this.handles[r];lh(o.object,!1)}this.reflectionProbeUsage!==Zu.Off&&this._reflectionProbe&&this._reflectionProbe.onSet(this)}}onAfterRender(){if(this._isInstancingEnabled&&this.handles)for(let e=0;e<this.handles.length;e++){const i=this.handles[e];lh(i.object,!0)}this.reflectionProbeUsage!==Zu.Off&&this._reflectionProbe&&this._reflectionProbe.onUnset(this)}applyStencil(){Mp.applyStencil(this)}applySettings(e){e.receiveShadow=this.receiveShadows,this.shadowCastingMode==Dv.On?e.castShadow=!0:e.castShadow=!1}updateReflectionProbe(){this._reflectionProbe=null,this.reflectionProbeUsage!==Zu.Off&&(this.startCoroutine(this._updateReflectionProbe(),ze.LateUpdate),this._probeAnchorLastFrame=this.probeAnchor)}*_updateReflectionProbe(){const e=this.probeAnchor||this.gameObject,i=!!this.probeAnchor;this._reflectionProbe=ml.get(e,this.context,i,this.probeAnchor)}setVisibility(e){if(!this.isMultiMaterialObject(this.gameObject))lh(this.gameObject,e);else for(const i of this.gameObject.children)this.isMeshOrSkinnedMesh(i)&&lh(i,e)}isMultiMaterialObject(e){return e.type==="Group"}isMeshOrSkinnedMesh(e){return e.type==="Mesh"||e.type==="SkinnedMesh"}}kl([A()],ci.prototype,"receiveShadows",void 0);kl([A()],ci.prototype,"shadowCastingMode",void 0);kl([A()],ci.prototype,"lightmapIndex",void 0);kl([A(ke)],ci.prototype,"lightmapScaleOffset",void 0);kl([A()],ci.prototype,"enableInstancing",void 0);kl([A()],ci.prototype,"renderOrder",void 0);kl([A()],ci.prototype,"allowOcclusionWhenDynamic",void 0);kl([A(re)],ci.prototype,"probeAnchor",void 0);kl([A()],ci.prototype,"reflectionProbeUsage",void 0);class s0 extends ci{}class kk extends s0{constructor(){super(...arguments);c(this,"_needUpdateBoundingSphere",!1)}awake(){var e;super.awake(),KI&&console.log('SkinnedMeshRenderer for "'+this.name+'"',this),this.allowOcclusionWhenDynamic=!1;for(const i of this.sharedMeshes)(e=i.parent)==null||e.updateWorldMatrix(!1,!0),this.markBoundsDirty()}onAfterRender(){if(super.onAfterRender(),this._needUpdateBoundingSphere){for(const e of this.sharedMeshes)if(e instanceof Io){this._needUpdateBoundingSphere=!1;const i=e.geometry,s=Dg(e);s&&(e.geometry=s),e.computeBoundingSphere(),e.geometry=i}}if(KI){for(const e of this.sharedMeshes)if(e instanceof Io&&e.boundingSphere){const i=Pi(e.boundingSphere.center).applyMatrix4(e.matrixWorld);De.DrawWireSphere(i,e.boundingSphere.radius,"red")}}}markBoundsDirty(){this._needUpdateBoundingSphere=!0}}var Dv;(function(n){n[n.Off=0]="Off",n[n.On=1]="On",n[n.TwoSided=2]="TwoSided",n[n.ShadowsOnly=3]="ShadowsOnly"})(Dv||(Dv={}));var j=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};const rA=N("debugparticles");var ga;(function(n){n[n.Billboard=0]="Billboard",n[n.Stretch=1]="Stretch",n[n.HorizontalBillboard=2]="HorizontalBillboard",n[n.VerticalBillboard=3]="VerticalBillboard",n[n.Mesh=4]="Mesh"})(ga||(ga={}));let tu=class{constructor(){c(this,"alphaKeys");c(this,"colorKeys")}get duration(){return 1}evaluate(t,e){let i,s=0,r=null,o=0;for(let a=0;a<this.alphaKeys.length;a++){const l=this.alphaKeys[a];(l.time<t||!i)&&(i=l,s=a)}for(let a=0;a<this.colorKeys.length;a++){const l=this.colorKeys[a];(l.time<t||!r)&&(r=l,o=a)}if(r)if(o+1<this.colorKeys.length){const l=this.colorKeys[o+1],h=Ae.remap(t,r.time,l.time,0,1);e.r=Ae.lerp(r.color.r,l.color.r,h),e.g=Ae.lerp(r.color.g,l.color.g,h),e.b=Ae.lerp(r.color.b,l.color.b,h)}else e.r=r.color.r,e.g=r.color.g,e.b=r.color.b;if(i)if(s+1<this.alphaKeys.length){const l=this.alphaKeys[s+1],h=Ae.remap(t,i.time,l.time,0,1);e.alpha=Ae.lerp(i.alpha,l.alpha,h)}else e.alpha=i.alpha;return e}};j([A()],tu.prototype,"alphaKeys",void 0);j([A()],tu.prototype,"colorKeys",void 0);var cn;(function(n){n[n.Constant=0]="Constant",n[n.Curve=1]="Curve",n[n.TwoCurves=2]="TwoCurves",n[n.TwoConstants=3]="TwoConstants"})(cn||(cn={}));var $u;(function(n){n[n.Color=0]="Color",n[n.Gradient=1]="Gradient",n[n.TwoColors=2]="TwoColors",n[n.TwoGradients=3]="TwoGradients",n[n.RandomColor=4]="RandomColor"})($u||($u={}));var Po;(function(n){n[n.Local=0]="Local",n[n.World=1]="World",n[n.Custom=2]="Custom"})(Po||(Po={}));var xs;(function(n){n[n.Sphere=0]="Sphere",n[n.SphereShell=1]="SphereShell",n[n.Hemisphere=2]="Hemisphere",n[n.HemisphereShell=3]="HemisphereShell",n[n.Cone=4]="Cone",n[n.Box=5]="Box",n[n.Mesh=6]="Mesh",n[n.ConeShell=7]="ConeShell",n[n.ConeVolume=8]="ConeVolume",n[n.ConeVolumeShell=9]="ConeVolumeShell",n[n.Circle=10]="Circle",n[n.CircleEdge=11]="CircleEdge",n[n.SingleSidedEdge=12]="SingleSidedEdge",n[n.MeshRenderer=13]="MeshRenderer",n[n.SkinnedMeshRenderer=14]="SkinnedMeshRenderer",n[n.BoxShell=15]="BoxShell",n[n.BoxEdge=16]="BoxEdge",n[n.Donut=17]="Donut",n[n.Rectangle=18]="Rectangle",n[n.Sprite=19]="Sprite",n[n.SpriteRenderer=20]="SpriteRenderer"})(xs||(xs={}));var ch;(function(n){n[n.Random=0]="Random",n[n.Loop=1]="Loop",n[n.PingPong=2]="PingPong",n[n.BurstSpread=3]="BurstSpread"})(ch||(ch={}));class Se{constructor(){c(this,"mode");c(this,"constant");c(this,"constantMin");c(this,"constantMax");c(this,"curve");c(this,"curveMin");c(this,"curveMax");c(this,"curveMultiplier")}clone(){var e,i,s;const t=new Se;return t.mode=this.mode,t.constant=this.constant,t.constantMin=this.constantMin,t.constantMax=this.constantMax,t.curve=(e=this.curve)==null?void 0:e.clone(),t.curveMin=(i=this.curveMin)==null?void 0:i.clone(),t.curveMax=(s=this.curveMax)==null?void 0:s.clone(),t.curveMultiplier=this.curveMultiplier,t}evaluate(t,e){const i=e===void 0?Math.random():e;switch(this.mode){case cn.Constant:return this.constant;case cn.Curve:return t=Ae.clamp01(t),this.curve.evaluate(t)*this.curveMultiplier;case cn.TwoCurves:const s=t*this.curveMin.duration,r=t*this.curveMax.duration;return Ae.lerp(this.curveMin.evaluate(s),this.curveMax.evaluate(r),i%1)*this.curveMultiplier;case cn.TwoConstants:return Ae.lerp(this.constantMin,this.constantMax,i%1);default:this.curveMax.evaluate(t)*this.curveMultiplier;break}return 0}getMax(){switch(this.mode){case cn.Constant:return this.constant;case cn.Curve:return this.getMaxFromCurve(this.curve)*this.curveMultiplier;case cn.TwoCurves:return Math.max(this.getMaxFromCurve(this.curveMin),this.getMaxFromCurve(this.curveMax))*this.curveMultiplier;case cn.TwoConstants:return Math.max(this.constantMin,this.constantMax);default:return 0}}getMaxFromCurve(t){if(!t)return 0;let e=Number.MIN_VALUE;for(let i=0;i<t.keys.length;i++){const s=t.keys[i];s.value>e&&(e=s.value)}return e}}j([A()],Se.prototype,"mode",void 0);j([A()],Se.prototype,"constant",void 0);j([A()],Se.prototype,"constantMin",void 0);j([A()],Se.prototype,"constantMax",void 0);j([A(Tl)],Se.prototype,"curve",void 0);j([A(Tl)],Se.prototype,"curveMin",void 0);j([A(Tl)],Se.prototype,"curveMax",void 0);j([A()],Se.prototype,"curveMultiplier",void 0);const Fr=class{constructor(){c(this,"mode");c(this,"color");c(this,"colorMin");c(this,"colorMax");c(this,"gradient");c(this,"gradientMin");c(this,"gradientMax")}evaluate(t,e){const i=e===void 0?Math.random():e;switch(this.mode){case $u.Color:return this.color;case $u.Gradient:return this.gradient.evaluate(t,Fr._temp),Fr._temp;case $u.TwoColors:return Fr._temp.lerpColors(this.colorMin,this.colorMax,i);case $u.TwoGradients:return this.gradientMin.evaluate(t,Fr._temp),this.gradientMax.evaluate(t,Fr._temp2),Fr._temp.lerp(Fr._temp2,i)}return Fr._temp.set(16711935),Fr._temp.alpha=1,Fr._temp}};let Un=Fr;c(Un,"_temp",new Ot(0,0,0,1)),c(Un,"_temp2",new Ot(0,0,0,1));j([A(Ot)],Un.prototype,"color",void 0);j([A(Ot)],Un.prototype,"colorMin",void 0);j([A(Ot)],Un.prototype,"colorMax",void 0);j([A(tu)],Un.prototype,"gradient",void 0);j([A(tu)],Un.prototype,"gradientMin",void 0);j([A(tu)],Un.prototype,"gradientMax",void 0);var kv;(function(n){n[n.Hierarchy=0]="Hierarchy",n[n.Local=1]="Local",n[n.Shape=2]="Shape"})(kv||(kv={}));class ls{constructor(){c(this,"cullingMode");c(this,"duration");c(this,"emitterVelocityMode");c(this,"flipRotation");c(this,"gravityModifier");c(this,"gravityModifierMultiplier");c(this,"loop");c(this,"maxParticles");c(this,"playOnAwake");c(this,"prewarm");c(this,"ringBufferLoopRange");c(this,"ringBufferMode");c(this,"scalingMode");c(this,"simulationSpace");c(this,"simulationSpeed");c(this,"startColor");c(this,"startDelay");c(this,"startDelayMultiplier");c(this,"startLifetime");c(this,"startLifetimeMultiplier");c(this,"startRotation");c(this,"startRotationMultiplier");c(this,"startRotation3D");c(this,"startRotationX");c(this,"startRotationXMultiplier");c(this,"startRotationY");c(this,"startRotationYMultiplier");c(this,"startRotationZ");c(this,"startRotationZMultiplier");c(this,"startSize");c(this,"startSize3D");c(this,"startSizeMultiplier");c(this,"startSizeX");c(this,"startSizeXMultiplier");c(this,"startSizeY");c(this,"startSizeYMultiplier");c(this,"startSizeZ");c(this,"startSizeZMultiplier");c(this,"startSpeed");c(this,"startSpeedMultiplier");c(this,"stopAction");c(this,"useUnscaledTime")}}j([A(Se)],ls.prototype,"gravityModifier",void 0);j([A(Un)],ls.prototype,"startColor",void 0);j([A(Se)],ls.prototype,"startDelay",void 0);j([A(Se)],ls.prototype,"startLifetime",void 0);j([A(Se)],ls.prototype,"startRotation",void 0);j([A(Se)],ls.prototype,"startRotationX",void 0);j([A(Se)],ls.prototype,"startRotationY",void 0);j([A(Se)],ls.prototype,"startRotationZ",void 0);j([A(Se)],ls.prototype,"startSize",void 0);j([A(Se)],ls.prototype,"startSizeX",void 0);j([A(Se)],ls.prototype,"startSizeY",void 0);j([A(Se)],ls.prototype,"startSizeZ",void 0);j([A(Se)],ls.prototype,"startSpeed",void 0);class Ov{constructor(){c(this,"cycleCount");c(this,"maxCount");c(this,"minCount");c(this,"probability");c(this,"repeatInterval");c(this,"time");c(this,"count");c(this,"_performed",0)}reset(){this._performed=0}run(t){if(t<=this.time)return 0;let e=0;if(this.cycleCount===0||this._performed<this.cycleCount){const i=this.time+this.repeatInterval*this._performed;if(t>=i&&(this._performed+=1,Math.random()<this.probability))switch(this.count.mode){case cn.Constant:e=this.count.constant;break;case cn.TwoConstants:e=Ae.lerp(this.count.constantMin,this.count.constantMax,Math.random());break;case cn.Curve:e=this.count.curve.evaluate(Math.random());break;case cn.TwoCurves:const s=Math.random();e=Ae.lerp(this.count.curveMin.evaluate(s),this.count.curveMax.evaluate(s),Math.random());break}}return e}}class Ol{constructor(){c(this,"enabled");c(this,"bursts");c(this,"rateOverTime");c(this,"rateOverTimeMultiplier");c(this,"rateOverDistance");c(this,"rateOverDistanceMultiplier");c(this,"system")}get burstCount(){var t;return((t=this.bursts)==null?void 0:t.length)??0}reset(){var t;(t=this.bursts)==null||t.forEach(e=>e.reset())}getBurst(){let t=0;if(this.burstCount>0)for(let e=0;e<this.burstCount;e++){const i=this.bursts[e];this.system.main.loop&&i.time>=this.system.time&&i.reset(),t+=Math.round(i.run(this.system.time))}return t}}j([A()],Ol.prototype,"enabled",void 0);j([A()],Ol.prototype,"bursts",void 0);j([A(Se)],Ol.prototype,"rateOverTime",void 0);j([A()],Ol.prototype,"rateOverTimeMultiplier",void 0);j([A(Se)],Ol.prototype,"rateOverDistance",void 0);j([A()],Ol.prototype,"rateOverDistanceMultiplier",void 0);class r0{constructor(){c(this,"enabled");c(this,"color")}}j([A(Un)],r0.prototype,"color",void 0);class iu{constructor(){c(this,"enabled");c(this,"separateAxes");c(this,"size");c(this,"sizeMultiplier");c(this,"x");c(this,"xMultiplier");c(this,"y");c(this,"yMultiplier");c(this,"z");c(this,"zMultiplier");c(this,"_time",0);c(this,"_temp",new C)}evaluate(t,e,i){if(e||(e=this._temp),!this.enabled)return e.x=e.y=e.z=1,e;if(this.separateAxes)e.x=this.x.evaluate(t,i)*this.xMultiplier,e.y=this.y.evaluate(t,i)*this.yMultiplier,e.z=this.z.evaluate(t,i)*this.zMultiplier;else{const s=this.size.evaluate(t,i)*this.sizeMultiplier;e.x=s}return e}}j([A(Se)],iu.prototype,"size",void 0);j([A(Se)],iu.prototype,"x",void 0);j([A(Se)],iu.prototype,"y",void 0);j([A(Se)],iu.prototype,"z",void 0);var lc;(function(n){n[n.Vertex=0]="Vertex",n[n.Edge=1]="Edge",n[n.Triangle=2]="Triangle"})(lc||(lc={}));const ud=class{constructor(){c(this,"shapeType",xs.Box);c(this,"enabled",!0);c(this,"alignToDirection",!1);c(this,"angle",0);c(this,"arc",360);c(this,"arcSpread");c(this,"arcSpeedMultiplier");c(this,"arcMode");c(this,"boxThickness");c(this,"position");c(this,"rotation");c(this,"_rotation",new fi);c(this,"scale");c(this,"radius");c(this,"radiusThickness");c(this,"sphericalDirectionAmount");c(this,"randomDirectionAmount");c(this,"randomPositionAmount");c(this,"meshShapeType");c(this,"meshRenderer");c(this,"_meshObj");c(this,"_meshGeometry");c(this,"system");c(this,"_space");c(this,"_worldSpaceMatrix",new ce);c(this,"_worldSpaceMatrixInverse",new ce);c(this,"_vector",new C(0,0,0));c(this,"_temp",new C(0,0,0));c(this,"_triangle",new ZR);c(this,"_dir",new C);c(this,"_loopTime",0);c(this,"_loopDirection",1);rA&&console.log(this)}get type(){return xs[this.shapeType]}initialize(t){this.onInitialize(t),t.position.copy(this._vector)}toJSON(){return this}clone(){return new ud}setMesh(t){this.meshRenderer=t,t?(this._meshObj=t.sharedMeshes[Math.floor(Math.random()*t.sharedMeshes.length)],this._meshGeometry=this._meshObj.geometry):(this._meshObj=void 0,this._meshGeometry=void 0)}update(t,e,i,s){this.system=t,this._space=i,i===Po.World&&(this._worldSpaceMatrix.copy(s.matrixWorld),this._worldSpaceMatrix.elements[0]=1,this._worldSpaceMatrix.elements[5]=1,this._worldSpaceMatrix.elements[10]=1,this._worldSpaceMatrixInverse.copy(this._worldSpaceMatrix).invert())}applyRotation(t){const e=this.rotation.x!==0||this.rotation.y!==0||this.rotation.z!==0;return e&&(this._rotation.x=Ae.toRadians(this.rotation.x),this._rotation.y=Ae.toRadians(this.rotation.y),this._rotation.z=Ae.toRadians(this.rotation.z),this._rotation.order="ZYX",t.applyEuler(this._rotation)),e}onInitialize(t){this._vector.set(0,0,0),t.mesh=void 0,t.mesh_geometry=void 0;const e=this._temp.copy(this.position),i=this._space===Po.World;i&&e.applyQuaternion(this.system.worldQuaternion);let s=this.radius;if(i&&(s*=this.system.worldScale.x),this.enabled){switch(this.shapeType){case xs.Box:rA&&De.DrawWireBox(this.position,this.scale,14540253,1),this._vector.x=Math.random()*this.scale.x-this.scale.x/2,this._vector.y=Math.random()*this.scale.y-this.scale.y/2,this._vector.z=Math.random()*this.scale.z-this.scale.z/2,this._vector.add(e);break;case xs.Cone:this.randomConePoint(this.position,this.angle,s,this.radiusThickness,this.arc,this.arcMode,this._vector);break;case xs.Sphere:this.randomSpherePoint(this.position,s,this.radiusThickness,this.arc,this._vector);break;case xs.Circle:this.randomCirclePoint(this.position,s,this.radiusThickness,this.arc,this._vector);break;case xs.MeshRenderer:const r=this.meshRenderer;(r==null?void 0:r.destroyed)==!1&&this.setMesh(r);const o=t.mesh=this._meshObj,a=t.mesh_geometry=this._meshGeometry;if(o&&a)switch(this.meshShapeType){case lc.Vertex:{const l=a.getAttribute("position"),h=Math.floor(Math.random()*l.count);this._vector.fromBufferAttribute(l,h),this._vector.applyMatrix4(o.matrixWorld),t.mesh_normal=h}break;case lc.Edge:break;case lc.Triangle:{const l=a.index;if(l){let h=Math.random(),u=Math.random();h+u>1&&(h=1-h,u=1-u);const d=Math.floor(Math.random()*(l.count/3));let f=d*3,p=d*3+1,g=d*3+2;f=l.getX(f),p=l.getX(p),g=l.getX(g);const m=a.getAttribute("position");this._triangle.a.fromBufferAttribute(m,f),this._triangle.b.fromBufferAttribute(m,p),this._triangle.c.fromBufferAttribute(m,g),this._vector.set(0,0,0).addScaledVector(this._triangle.a,h).addScaledVector(this._triangle.b,u).addScaledVector(this._triangle.c,1-(h+u)),this._vector.applyMatrix4(o.matrixWorld),t.mesh_normal=d}}break}break;default:this._vector.set(0,0,0),xe()&&!globalThis.__particlesystem_shapetype_unsupported&&(console.warn("ParticleSystem ShapeType is not supported:",xs[this.shapeType]),globalThis.__particlesystem_shapetype_unsupported=!0);break}this.randomizePosition(this._vector,this.randomPositionAmount)}this.applyRotation(this._vector),i&&(this._vector.applyQuaternion(this.system.worldQuaternion),this._vector.add(this.system.worldPos)),rA&&De.DrawSphere(this._vector,.03,16711680,.5,!0)}getDirection(t,e){var i;if(!this.enabled)return this._dir.set(0,0,1),this._dir;switch(this.shapeType){case xs.Box:this._dir.set(0,0,1);break;case xs.Cone:this._dir.set(0,0,1);break;case xs.Circle:case xs.Sphere:const s=e.x,r=e.y,o=e.z;this._dir.set(s,r,o),(i=this.system)!=null&&i.worldspace?this._dir.sub(this.system.worldPos):this._dir.sub(this.position);break;case xs.MeshRenderer:const a=t.mesh,l=t.mesh_geometry;if(a&&l)switch(this.meshShapeType){case lc.Vertex:{const h=l.getAttribute("normal"),u=t.mesh_normal;this._dir.fromBufferAttribute(h,u)}break;case lc.Edge:break;case lc.Triangle:{const h=l.index;if(h){const u=t.mesh_normal,d=h.getX(u*3),f=h.getX(u*3+1),p=h.getX(u*3+2),g=l.getAttribute("position"),m=Pi(),v=Pi(),y=Pi();m.fromBufferAttribute(g,d),v.fromBufferAttribute(g,f),y.fromBufferAttribute(g,p),m.sub(v),y.sub(v),m.cross(y),this._dir.copy(m).multiplyScalar(-1);const b=Nt(a);this._dir.applyQuaternion(b)}}break}break;default:this._dir.set(0,0,1);break}return this._space===Po.World&&this._dir.applyQuaternion(this.system.worldQuaternion),this.applyRotation(this._dir),this._dir.normalize(),this.spherizeDirection(this._dir,this.sphericalDirectionAmount),this.randomizeDirection(this._dir,this.randomDirectionAmount),rA&&(De.DrawSphere(e,.01,8925952,.5,!0),De.DrawDirection(e,this._dir,8925952,.5,!0)),this._dir}randomizePosition(t,e){if(e<=0)return;const i=ud._tempVec;i.set(Math.random()*2-1,Math.random()*2-1,Math.random()*2-1),i.x*=e*this.scale.x,i.y*=e*this.scale.y,i.z*=e*this.scale.z,t.add(i)}randomizeDirection(t,e){if(e===0)return;const i=ud._randomQuat,s=ud._tempVec;s.set(Math.random()-.5,Math.random()-.5,Math.random()-.5).normalize(),i.setFromAxisAngle(s,e*Math.random()*Math.PI),t.applyQuaternion(i)}spherizeDirection(t,e){if(e===0)return;const i=Math.random()*Math.PI*2,s=Math.acos(1-Math.random()*2),r=Math.sin(s)*Math.cos(i),o=Math.sin(s)*Math.sin(i),a=Math.cos(s),l=new C(r,o,a);t.lerp(l,e)}randomSpherePoint(t,e,i,s,r){const o=Math.random(),a=Math.random(),l=2*Math.PI*o*(s/360),h=Math.acos(2*a-1),u=Ae.lerp(1,1-Math.pow(1-Math.random(),Math.PI),i)*e,d=t.x+this.scale.x*(-u*Math.sin(h)*Math.cos(l)),f=t.y+this.scale.y*(u*Math.sin(h)*Math.sin(l)),p=t.z+this.scale.z*(u*Math.cos(h));r.x=d,r.y=f,r.z=p}randomCirclePoint(t,e,i,s,r){const o=Math.random(),a=2*Math.PI*o*(s/360),l=Ae.lerp(1,1-Math.pow(1-Math.random(),Math.PI),i)*e,h=t.x+this.scale.x*l*Math.cos(a),u=t.y+this.scale.y*l*Math.sin(a),d=t.z;r.x=h,r.y=u,r.z=d}randomConePoint(t,e,i,s,r,o,a){let l=0,h=0;switch(o){case ch.Random:l=Math.random(),h=Math.random();break;case ch.PingPong:this._loopTime>1&&(this._loopDirection=-1),this._loopTime<0&&(this._loopDirection=1);case ch.Loop:l=.5,h=Math.random(),this._loopTime+=this.system.deltaTime*this._loopDirection;break}let u=2*Math.PI*l*(r/360);switch(o){case ch.PingPong:case ch.Loop:u+=Math.PI+.5,u+=this._loopTime*Math.PI*2,u%=Ae.toRadians(r);break}const d=Math.acos(2*h-1),f=Ae.lerp(1,1-Math.pow(1-Math.random(),Math.PI),s)*i,p=t.x+-f*Math.sin(d)*Math.cos(u),g=t.y+f*Math.sin(d)*Math.sin(u),m=t.z;a.x=p*this.scale.x,a.y=g*this.scale.y,a.z=m*this.scale.z}};let Xt=ud;c(Xt,"_randomQuat",new ne),c(Xt,"_tempVec",new C);j([A()],Xt.prototype,"shapeType",void 0);j([A()],Xt.prototype,"enabled",void 0);j([A()],Xt.prototype,"alignToDirection",void 0);j([A()],Xt.prototype,"angle",void 0);j([A()],Xt.prototype,"arc",void 0);j([A()],Xt.prototype,"arcSpread",void 0);j([A()],Xt.prototype,"arcSpeedMultiplier",void 0);j([A()],Xt.prototype,"arcMode",void 0);j([A(C)],Xt.prototype,"boxThickness",void 0);j([A(C)],Xt.prototype,"position",void 0);j([A(C)],Xt.prototype,"rotation",void 0);j([A(C)],Xt.prototype,"scale",void 0);j([A()],Xt.prototype,"radius",void 0);j([A()],Xt.prototype,"radiusThickness",void 0);j([A()],Xt.prototype,"sphericalDirectionAmount",void 0);j([A()],Xt.prototype,"randomDirectionAmount",void 0);j([A()],Xt.prototype,"randomPositionAmount",void 0);j([A()],Xt.prototype,"meshShapeType",void 0);j([A(s0)],Xt.prototype,"meshRenderer",void 0);class Lt{constructor(){c(this,"damping");c(this,"enabled");c(this,"frequency");c(this,"octaveCount");c(this,"octaveMultiplier");c(this,"octaveScale");c(this,"positionAmount");c(this,"quality");c(this,"remap");c(this,"remapEnabled");c(this,"remapMultiplier");c(this,"remapX");c(this,"remapXMultiplier");c(this,"remapY");c(this,"remapYMultiplier");c(this,"remapZ");c(this,"remapZMultiplier");c(this,"scrollSpeedMultiplier");c(this,"separateAxes");c(this,"strengthMultiplier");c(this,"strengthX");c(this,"strengthXMultiplier");c(this,"strengthY");c(this,"strengthYMultiplier");c(this,"strengthZ");c(this,"strengthZMultiplier");c(this,"_noise");c(this,"_time",0);c(this,"_temp",new C)}update(t){this._time+=t.time.deltaTime*this.scrollSpeedMultiplier}apply(t,e,i,s,r,o){if(!this.enabled)return;this._noise||(this._noise=SH(()=>0));const a=this._temp.set(e.x,e.y,e.z).multiplyScalar(this.frequency),l=this._noise(a.x,a.y,a.z,this._time),h=this._noise(a.x,a.y,a.z,this._time+1e3*this.frequency),u=this._noise(a.x,a.y,a.z,this._time+2e3*this.frequency);this._temp.set(l,h,u).normalize();const d=r/o;let f=this.positionAmount.evaluate(d);this.separateAxes?(this._temp.x*=f*this.strengthXMultiplier,this._temp.y*=f*this.strengthYMultiplier,this._temp.z*=f*this.strengthZMultiplier):(this.strengthX&&(f*=this.strengthX.evaluate(d)*1.5),this._temp.multiplyScalar(f)),i.x+=this._temp.x,i.y+=this._temp.y,i.z+=this._temp.z}}j([A()],Lt.prototype,"damping",void 0);j([A()],Lt.prototype,"enabled",void 0);j([A()],Lt.prototype,"frequency",void 0);j([A()],Lt.prototype,"octaveCount",void 0);j([A()],Lt.prototype,"octaveMultiplier",void 0);j([A()],Lt.prototype,"octaveScale",void 0);j([A(Se)],Lt.prototype,"positionAmount",void 0);j([A()],Lt.prototype,"quality",void 0);j([A(Se)],Lt.prototype,"remap",void 0);j([A()],Lt.prototype,"remapEnabled",void 0);j([A()],Lt.prototype,"remapMultiplier",void 0);j([A(Se)],Lt.prototype,"remapX",void 0);j([A()],Lt.prototype,"remapXMultiplier",void 0);j([A(Se)],Lt.prototype,"remapY",void 0);j([A()],Lt.prototype,"remapYMultiplier",void 0);j([A(Se)],Lt.prototype,"remapZ",void 0);j([A()],Lt.prototype,"remapZMultiplier",void 0);j([A()],Lt.prototype,"scrollSpeedMultiplier",void 0);j([A()],Lt.prototype,"separateAxes",void 0);j([A()],Lt.prototype,"strengthMultiplier",void 0);j([A(Se)],Lt.prototype,"strengthX",void 0);j([A()],Lt.prototype,"strengthXMultiplier",void 0);j([A(Se)],Lt.prototype,"strengthY",void 0);j([A()],Lt.prototype,"strengthYMultiplier",void 0);j([A(Se)],Lt.prototype,"strengthZ",void 0);j([A()],Lt.prototype,"strengthZMultiplier",void 0);var Nw;(function(n){n[n.PerParticle=0]="PerParticle",n[n.Ribbon=1]="Ribbon"})(Nw||(Nw={}));var Qw;(function(n){n[n.Stretch=0]="Stretch",n[n.Tile=1]="Tile",n[n.DistributePerSegment=2]="DistributePerSegment",n[n.RepeatPerSegment=3]="RepeatPerSegment"})(Qw||(Qw={}));class Ai{constructor(){c(this,"enabled");c(this,"attachRibbonToTransform",!1);c(this,"colorOverLifetime");c(this,"colorOverTrail");c(this,"dieWithParticles",!0);c(this,"inheritParticleColor",!0);c(this,"lifetime");c(this,"lifetimeMultiplier");c(this,"minVertexDistance",.2);c(this,"mode",Nw.PerParticle);c(this,"ratio",1);c(this,"ribbonCount",1);c(this,"shadowBias",0);c(this,"sizeAffectsLifetime",!1);c(this,"sizeAffectsWidth",!1);c(this,"splitSubEmitterRibbons",!1);c(this,"textureMode",Qw.Stretch);c(this,"widthOverTrail");c(this,"widthOverTrailMultiplier");c(this,"worldSpace",!1)}getWidth(t,e,i,s){const r=this.widthOverTrail.evaluate(i,s);return t*=r,t}getColor(t,e,i){const s=this.colorOverTrail.evaluate(i),r=this.colorOverLifetime.evaluate(e);t.x*=s.r*r.r,t.y*=s.g*r.g,t.z*=s.b*r.b,t.w*=s.alpha*r.alpha}}j([A()],Ai.prototype,"enabled",void 0);j([A()],Ai.prototype,"attachRibbonToTransform",void 0);j([A(Un)],Ai.prototype,"colorOverLifetime",void 0);j([A(Un)],Ai.prototype,"colorOverTrail",void 0);j([A()],Ai.prototype,"dieWithParticles",void 0);j([A()],Ai.prototype,"inheritParticleColor",void 0);j([A(Se)],Ai.prototype,"lifetime",void 0);j([A()],Ai.prototype,"lifetimeMultiplier",void 0);j([A()],Ai.prototype,"minVertexDistance",void 0);j([A()],Ai.prototype,"mode",void 0);j([A()],Ai.prototype,"ratio",void 0);j([A()],Ai.prototype,"ribbonCount",void 0);j([A()],Ai.prototype,"shadowBias",void 0);j([A()],Ai.prototype,"sizeAffectsLifetime",void 0);j([A()],Ai.prototype,"sizeAffectsWidth",void 0);j([A()],Ai.prototype,"splitSubEmitterRibbons",void 0);j([A()],Ai.prototype,"textureMode",void 0);j([A(Se)],Ai.prototype,"widthOverTrail",void 0);j([A()],Ai.prototype,"widthOverTrailMultiplier",void 0);j([A()],Ai.prototype,"worldSpace",void 0);class Si{constructor(){c(this,"enabled");c(this,"space",Po.Local);c(this,"orbitalX");c(this,"orbitalY");c(this,"orbitalZ");c(this,"orbitalXMultiplier");c(this,"orbitalYMultiplier");c(this,"orbitalZMultiplier");c(this,"orbitalOffsetX");c(this,"orbitalOffsetY");c(this,"orbitalOffsetZ");c(this,"speedModifier");c(this,"speedModifierMultiplier");c(this,"x");c(this,"xMultiplier");c(this,"y");c(this,"yMultiplier");c(this,"z");c(this,"zMultiplier");c(this,"_system");c(this,"_temp",new C);c(this,"_temp2",new C);c(this,"_temp3",new C);c(this,"_hasOrbital",!1);c(this,"_index",0);c(this,"_orbitalMatrix",new ce)}update(t){this._system=t}init(t){this._index==0&&(t.debug=!0),this._index+=1,t.orbitx=this.orbitalX.evaluate(Math.random()),t.orbity=this.orbitalY.evaluate(Math.random()),t.orbitz=this.orbitalZ.evaluate(Math.random()),this._hasOrbital=t.orbitx!=0||t.orbity!=0||t.orbitz!=0}apply(t,e,i,s,r,o,a){var p;if(!this.enabled)return;const l=o/a,h=this.speedModifier.evaluate(l)*this.speedModifierMultiplier,u=this.x.evaluate(l),d=this.y.evaluate(l),f=this.z.evaluate(l);if(this._temp.set(-u,d,f),this._system&&this._system.main.simulationSpace===Po.World&&this._temp.applyQuaternion(this._system.worldQuaternion),this._hasOrbital&&((p=this._system)==null?void 0:p.worldPos)){const m=this._temp2.set(i.x,i.y,i.z),v=this.orbitalXMultiplier,y=this.orbitalYMultiplier,b=this.orbitalZMultiplier,_=h*Math.PI*2*10,x=Math.cos(_*v),S=Math.sin(_*v),T=Math.cos(_*y),L=Math.sin(_*y),I=Math.cos(_*b),P=Math.sin(_*b),R=m.x*(T*I)+m.y*(T*P)+m.z*-L,B=m.x*(S*L*I-x*P)+m.y*(S*L*P+x*I)+m.z*(S*T),Q=m.x*(x*L*I+S*P)+m.y*(x*L*P-S*I)+m.z*(x*T),G=this._temp3.set(m.x-R,m.y-B,m.z-Q);G.normalize(),G.multiplyScalar(.2/r*Math.max(this.orbitalXMultiplier,this.orbitalYMultiplier,this.orbitalZMultiplier)),s.x+=G.x,s.y+=G.y,s.z+=G.z}s.x+=this._temp.x,s.y+=this._temp.y,s.z+=this._temp.z,s.x*=h,s.y*=h,s.z*=h}}j([A()],Si.prototype,"enabled",void 0);j([A()],Si.prototype,"space",void 0);j([A(Se)],Si.prototype,"orbitalX",void 0);j([A(Se)],Si.prototype,"orbitalY",void 0);j([A(Se)],Si.prototype,"orbitalZ",void 0);j([A()],Si.prototype,"orbitalXMultiplier",void 0);j([A()],Si.prototype,"orbitalYMultiplier",void 0);j([A()],Si.prototype,"orbitalZMultiplier",void 0);j([A()],Si.prototype,"orbitalOffsetX",void 0);j([A()],Si.prototype,"orbitalOffsetY",void 0);j([A()],Si.prototype,"orbitalOffsetZ",void 0);j([A(Se)],Si.prototype,"speedModifier",void 0);j([A()],Si.prototype,"speedModifierMultiplier",void 0);j([A(Se)],Si.prototype,"x",void 0);j([A()],Si.prototype,"xMultiplier",void 0);j([A(Se)],Si.prototype,"y",void 0);j([A()],Si.prototype,"yMultiplier",void 0);j([A(Se)],Si.prototype,"z",void 0);j([A()],Si.prototype,"zMultiplier",void 0);var zw;(function(n){n[n.Lifetime=0]="Lifetime",n[n.Speed=1]="Speed",n[n.FPS=2]="FPS"})(zw||(zw={}));var $I;(function(n){n[n.Grid=0]="Grid",n[n.Sprites=1]="Sprites"})($I||($I={}));var eT;(function(n){n[n.Custom=0]="Custom",n[n.Random=1]="Random",n[n.MeshIndex=2]="MeshIndex"})(eT||(eT={}));var tT;(function(n){n[n.WholeSheet=0]="WholeSheet",n[n.SingleRow=1]="SingleRow"})(tT||(tT={}));class cs{constructor(){c(this,"animation");c(this,"enabled");c(this,"cycleCount");c(this,"frameOverTime");c(this,"frameOverTimeMultiplier");c(this,"numTilesX");c(this,"numTilesY");c(this,"startFrame");c(this,"startFrameMultiplier");c(this,"rowMode");c(this,"rowIndex");c(this,"spriteCount");c(this,"timeMode")}sampleOnceAtStart(){if(this.timeMode===zw.Lifetime)switch(this.frameOverTime.mode){case cn.Constant:case cn.TwoConstants:case cn.TwoCurves:case cn.Curve:return!0}return!1}getStartIndex(){return this.sampleOnceAtStart()?Math.random()*(this.numTilesX*this.numTilesY):0}evaluate(t){if(!this.sampleOnceAtStart())return this.getIndex(t)}getIndex(t){const e=this.numTilesX*this.numTilesY;t=t*this.cycleCount;let i=this.frameOverTime.evaluate(t%1);return i*=this.frameOverTimeMultiplier,i*=e,i=i%e,i=Math.floor(i),i}}j([A()],cs.prototype,"animation",void 0);j([A()],cs.prototype,"enabled",void 0);j([A()],cs.prototype,"cycleCount",void 0);j([A(Se)],cs.prototype,"frameOverTime",void 0);j([A()],cs.prototype,"frameOverTimeMultiplier",void 0);j([A()],cs.prototype,"numTilesX",void 0);j([A()],cs.prototype,"numTilesY",void 0);j([A(Se)],cs.prototype,"startFrame",void 0);j([A()],cs.prototype,"startFrameMultiplier",void 0);j([A()],cs.prototype,"rowMode",void 0);j([A()],cs.prototype,"rowIndex",void 0);j([A()],cs.prototype,"spriteCount",void 0);j([A()],cs.prototype,"timeMode",void 0);class jo{constructor(){c(this,"enabled");c(this,"separateAxes");c(this,"x");c(this,"xMultiplier");c(this,"y");c(this,"yMultiplier");c(this,"z");c(this,"zMultiplier")}evaluate(t,e){return this.enabled?this.separateAxes?0:this.z.evaluate(t,e)*-1:0}}j([A()],jo.prototype,"enabled",void 0);j([A()],jo.prototype,"separateAxes",void 0);j([A(Se)],jo.prototype,"x",void 0);j([A()],jo.prototype,"xMultiplier",void 0);j([A(Se)],jo.prototype,"y",void 0);j([A()],jo.prototype,"yMultiplier",void 0);j([A(Se)],jo.prototype,"z",void 0);j([A()],jo.prototype,"zMultiplier",void 0);class oo{constructor(){c(this,"enabled");c(this,"range");c(this,"separateAxes");c(this,"x");c(this,"xMultiplier");c(this,"y");c(this,"yMultiplier");c(this,"z");c(this,"zMultiplier")}evaluate(t,e){if(!this.enabled)return 0;if(!this.separateAxes){const i=Ae.lerp(this.range.x,this.range.y,e);return this.z.evaluate(i)*-1}return 0}}j([A()],oo.prototype,"enabled",void 0);j([A()],oo.prototype,"range",void 0);j([A()],oo.prototype,"separateAxes",void 0);j([A(Se)],oo.prototype,"x",void 0);j([A()],oo.prototype,"xMultiplier",void 0);j([A(Se)],oo.prototype,"y",void 0);j([A()],oo.prototype,"yMultiplier",void 0);j([A(Se)],oo.prototype,"z",void 0);j([A()],oo.prototype,"zMultiplier",void 0);class Ji{constructor(){c(this,"enabled");c(this,"dampen");c(this,"drag");c(this,"dragMultiplier");c(this,"limit");c(this,"limitMultiplier");c(this,"separateAxes");c(this,"limitX");c(this,"limitXMultiplier");c(this,"limitY");c(this,"limitYMultiplier");c(this,"limitZ");c(this,"limitZMultiplier");c(this,"multiplyDragByParticleSize",!1);c(this,"multiplyDragByParticleVelocity",!1);c(this,"space");c(this,"_temp",new C);c(this,"_temp2",new C)}apply(t,e,i,s,r,o,a){if(this.enabled){const l=this.limit.evaluate(r)*this.limitMultiplier;if(e.length()>l){this._temp.copy(e).normalize().multiplyScalar(l);const u=this.dampen*.5;e.x=Ae.lerp(e.x,this._temp.x,u),e.y=Ae.lerp(e.y,this._temp.y,u),e.z=Ae.lerp(e.z,this._temp.z,u),i.x=Ae.lerp(i.x,this._temp.x,u),i.y=Ae.lerp(i.y,this._temp.y,u),i.z=Ae.lerp(i.z,this._temp.z,u)}}}}j([A()],Ji.prototype,"enabled",void 0);j([A()],Ji.prototype,"dampen",void 0);j([A(Se)],Ji.prototype,"drag",void 0);j([A()],Ji.prototype,"dragMultiplier",void 0);j([A(Se)],Ji.prototype,"limit",void 0);j([A()],Ji.prototype,"limitMultiplier",void 0);j([A()],Ji.prototype,"separateAxes",void 0);j([A(Se)],Ji.prototype,"limitX",void 0);j([A()],Ji.prototype,"limitXMultiplier",void 0);j([A(Se)],Ji.prototype,"limitY",void 0);j([A()],Ji.prototype,"limitYMultiplier",void 0);j([A(Se)],Ji.prototype,"limitZ",void 0);j([A()],Ji.prototype,"limitZMultiplier",void 0);j([A()],Ji.prototype,"multiplyDragByParticleSize",void 0);j([A()],Ji.prototype,"multiplyDragByParticleVelocity",void 0);j([A()],Ji.prototype,"space",void 0);var Lv;(function(n){n[n.Initial=0]="Initial",n[n.Current=1]="Current"})(Lv||(Lv={}));class Ll{constructor(){c(this,"enabled");c(this,"curve");c(this,"curveMultiplier");c(this,"mode");c(this,"system");c(this,"_temp",new C);c(this,"_firstUpdate",!0);c(this,"_frames",0)}clone(){var e;const t=new Ll;return t.enabled=this.enabled,t.curve=(e=this.curve)==null?void 0:e.clone(),t.curveMultiplier=this.curveMultiplier,t.mode=this.mode,t}get _lastWorldPosition(){return this.system._iv_lastWorldPosition||(this.system._iv_lastWorldPosition=new C),this.system._iv_lastWorldPosition}get _velocity(){return this.system._iv_velocity||(this.system._iv_velocity=new C),this.system._iv_velocity}awake(t){this.system=t,this.reset()}reset(){this._firstUpdate=!0}update(t){this.enabled&&this.system.worldspace!==!1&&(this._firstUpdate?(this._firstUpdate=!1,this._velocity.set(0,0,0),this._lastWorldPosition.copy(this.system.worldPos)):this._lastWorldPosition&&(this._velocity.copy(this.system.worldPos).sub(this._lastWorldPosition).multiplyScalar(1/this.system.deltaTime),this._lastWorldPosition.copy(this.system.worldPos)))}applyInitial(t){if(this.enabled&&this.system.worldspace!==!1&&this.mode===Lv.Initial){const e=this.curve.evaluate(Math.random(),Math.random());this._temp.copy(this._velocity).multiplyScalar(e),t.add(this._temp)}}applyCurrent(t,e,i){if(this.enabled&&this.system&&this.system.worldspace!==!1&&this.mode===Lv.Current){const s=this.curve.evaluate(e,i);this._temp.copy(this._velocity).multiplyScalar(s),t.add(this._temp)}}}j([A()],Ll.prototype,"enabled",void 0);j([A(Se)],Ll.prototype,"curve",void 0);j([A()],Ll.prototype,"curveMultiplier",void 0);j([A()],Ll.prototype,"mode",void 0);class Zs{constructor(){c(this,"enabled");c(this,"range");c(this,"separateAxes");c(this,"size");c(this,"sizeMultiplier");c(this,"x");c(this,"xMultiplier");c(this,"y");c(this,"yMultiplier");c(this,"z");c(this,"zMultiplier")}evaluate(t,e,i,s){const r=t.length(),o=Ae.remap(r,this.range.x,this.range.y,0,1),a=this.size.evaluate(o,i);return s*a}}j([A()],Zs.prototype,"enabled",void 0);j([A(ae)],Zs.prototype,"range",void 0);j([A()],Zs.prototype,"separateAxes",void 0);j([A(Se)],Zs.prototype,"size",void 0);j([A()],Zs.prototype,"sizeMultiplier",void 0);j([A(Se)],Zs.prototype,"x",void 0);j([A()],Zs.prototype,"xMultiplier",void 0);j([A(Se)],Zs.prototype,"y",void 0);j([A()],Zs.prototype,"yMultiplier",void 0);j([A(Se)],Zs.prototype,"z",void 0);j([A()],Zs.prototype,"zMultiplier",void 0);class nf{constructor(){c(this,"enabled");c(this,"range");c(this,"color")}evaluate(t,e,i){const s=t.length(),r=Ae.remap(s,this.range.x,this.range.y,0,1),o=this.color.evaluate(r,e);i.x*=o.r,i.y*=o.g,i.z*=o.b,i.w*=o.alpha}}j([A()],nf.prototype,"enabled",void 0);j([A(ae)],nf.prototype,"range",void 0);j([A(Un)],nf.prototype,"color",void 0);const YH={name:"HorizontalBlurShader",uniforms:{tDiffuse:{value:null},h:{value:1/512}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;
		uniform float h;

		varying vec2 vUv;

		void main() {

			vec4 sum = vec4( 0.0 );

			sum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * h, vUv.y ) ) * 0.051;
			sum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * h, vUv.y ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * h, vUv.y ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * h, vUv.y ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;
			sum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * h, vUv.y ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * h, vUv.y ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * h, vUv.y ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * h, vUv.y ) ) * 0.051;

			gl_FragColor = sum;

		}`},KH={name:"VerticalBlurShader",uniforms:{tDiffuse:{value:null},v:{value:1/512}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;
		uniform float v;

		varying vec2 vUv;

		void main() {

			vec4 sum = vec4( 0.0 );

			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * v ) ) * 0.051;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * v ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * v ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * v ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * v ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * v ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * v ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * v ) ) * 0.051;

			gl_FragColor = sum;

		}`};var sf=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};const oA=N("debugcontactshadows"),OS=class extends se{constructor(){super(...arguments);c(this,"autoFit",!1);c(this,"darkness",.5);c(this,"opacity",.5);c(this,"blur",4);c(this,"occludeBelowGround",!1);c(this,"backfaceShadows",!0);c(this,"shadowCamera");c(this,"shadowGroup");c(this,"renderTarget");c(this,"renderTargetBlur");c(this,"plane");c(this,"occluderMesh");c(this,"blurPlane");c(this,"depthMaterial");c(this,"horizontalBlurMaterial");c(this,"verticalBlurMaterial");c(this,"textureSize",512)}static auto(e){if(e||(e=Ne.Current),!e)throw new Error("No context provided and no current context set.");let i=this._instances.get(e);if(!i||i.destroyed){const s=new re;i=Eh(s,OS,{autoFit:!1,occludeBelowGround:!1}),this._instances.set(e,i)}return e.scene.add(i.gameObject),i.fitShadows(),i}fitShadows(){oA&&console.log("Fitting shadows to scene"),fE(this.gameObject,!1);const e=dP(this.context.scene.children,[this.gameObject]),i=Math.max(.5,this.blur/32),s=e.max.x-e.min.x,r=e.max.z-e.min.z;e.expandByVector(new C(i*s,0,i*r)),oA&&De.DrawWireBox3(e,16776960,60),this.gameObject.parent&&e.applyMatrix4(this.gameObject.parent.matrixWorld.clone().invert());const o=e.min,a=Math.max(1e-5,(e.max.y-o.y)*.002);e.max.y+=a,this.gameObject.position.set((o.x+e.max.x)/2,o.y-a,(o.z+e.max.z)/2),this.gameObject.scale.set(e.max.x-o.x,e.max.y-o.y,e.max.z-o.z),this.gameObject.matrixWorldNeedsUpdate=!0}awake(){fE(this.gameObject,!1)}start(){oA&&console.log("Create ContactShadows on "+this.gameObject.name,this),this.shadowGroup=new To,this.gameObject.add(this.shadowGroup),this.renderTarget=new Ct(this.textureSize,this.textureSize),this.renderTarget.texture.generateMipmaps=!1,this.renderTargetBlur=new Ct(this.textureSize,this.textureSize),this.renderTargetBlur.texture.generateMipmaps=!1;const e=new Ys(1,1).rotateX(Math.PI/2);this.gameObject instanceof J&&(console.warn("ContactShadows can not be added to a Mesh. Please add it to a Group or an empty Object"),lh(this.gameObject,!1));const i=new St({map:this.renderTarget.texture,opacity:this.opacity,color:0,transparent:!0,depthWrite:!1,side:Oa});this.plane=new J(e,i),this.plane.scale.y=-1,this.plane.layers.set(2),this.gameObject.add(this.plane),this.plane&&(this.plane.renderOrder=1),this.occluderMesh=new J(this.plane.geometry,new St({depthWrite:!0,stencilWrite:!0,colorWrite:!1,side:pc})).translateY(-1e-4),this.occluderMesh.renderOrder=-100,this.occluderMesh.layers.set(2),this.gameObject.add(this.occluderMesh),this.blurPlane=new J(e),this.blurPlane.visible=!1,this.shadowGroup.add(this.blurPlane),this.shadowCamera=new Vh(-1/2,1/2,1/2,-1/2,0,1),this.shadowCamera.rotation.x=Math.PI/2,this.shadowGroup.add(this.shadowCamera),this.depthMaterial=new zR,this.depthMaterial.userData.darkness={value:this.darkness},this.depthMaterial.blending=H2,this.depthMaterial.blendEquation=V2,this.depthMaterial.onBeforeCompile=s=>{this.depthMaterial&&(s.uniforms.darkness=this.depthMaterial.userData.darkness,s.fragmentShader=`
                uniform float darkness;
                ${s.fragmentShader.replace("gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );","gl_FragColor = vec4( vec3( 1.0 ), ( 1.0 - fragCoordZ ) * darkness * opacity * (gl_FrontFacing ? 1.0 : 0.66) );")}
            `)},this.depthMaterial.depthTest=!1,this.depthMaterial.depthWrite=!1,this.horizontalBlurMaterial=new $e(YH),this.horizontalBlurMaterial.depthTest=!1,this.verticalBlurMaterial=new $e(KH),this.verticalBlurMaterial.depthTest=!1,this.shadowGroup.visible=!1,this.autoFit&&this.fitShadows()}onDestroy(){var e,i,s,r,o,a,l,h;(e=this.renderTarget)==null||e.dispose(),(i=this.renderTargetBlur)==null||i.dispose(),(s=this.depthMaterial)==null||s.dispose(),(r=this.horizontalBlurMaterial)==null||r.dispose(),(o=this.verticalBlurMaterial)==null||o.dispose(),(a=this.blurPlane)==null||a.geometry.dispose(),(l=this.plane)==null||l.geometry.dispose(),(h=this.occluderMesh)==null||h.geometry.dispose()}onBeforeRender(e){if(!this.renderTarget||!this.renderTargetBlur||!this.depthMaterial||!this.shadowCamera||!this.blurPlane||!this.shadowGroup||!this.plane||!this.horizontalBlurMaterial||!this.verticalBlurMaterial){oA&&console.error("ContactShadows: not initialized yet");return}const i=this.context.scene,s=this.context.renderer,r=s.getRenderTarget();this.shadowGroup.visible=!0,this.occluderMesh&&(this.occluderMesh.visible=!1);const o=this.plane.visible;this.plane.visible=!1,this.gameObject instanceof J&&lh(this.gameObject,!1);const a=i.background;i.background=null,i.overrideMaterial=this.depthMaterial,this.backfaceShadows?this.depthMaterial.side=pi:this.depthMaterial.side=Oa;const l=s.getClearAlpha();s.setClearAlpha(0);const h=s.xr.enabled;s.xr.enabled=!1;const u=s.renderLists.get(i,0),d=u.transparent;u.transparent=[],s.setRenderTarget(this.renderTarget),s.clear(),s.render(i,this.shadowCamera),u.transparent=d,i.overrideMaterial=null;const f=Math.max(this.blur,.05);this.blurShadow(f*2),this.blurShadow(f*.5),this.shadowGroup.visible=!1,this.occluderMesh&&(this.occluderMesh.visible=this.occludeBelowGround),this.plane.visible=o,s.setRenderTarget(r),s.setClearAlpha(l),i.background=a,s.xr.enabled=h}blurShadow(e){if(!this.blurPlane||!this.shadowCamera||!this.renderTarget||!this.renderTargetBlur||!this.horizontalBlurMaterial||!this.verticalBlurMaterial)return;this.blurPlane.visible=!0;const i=this.gameObject.worldScale,s=(i.x+i.z)/2,r=i.z/s,o=i.x/s;this.blurPlane.material=this.horizontalBlurMaterial,this.blurPlane.material.uniforms.tDiffuse.value=this.renderTarget.texture,this.horizontalBlurMaterial.uniforms.h.value=e*1/this.textureSize*r;const a=this.context.renderer,l=a.getRenderTarget();a.setRenderTarget(this.renderTargetBlur),a.render(this.blurPlane,this.shadowCamera),this.blurPlane.material=this.verticalBlurMaterial,this.blurPlane.material.uniforms.tDiffuse.value=this.renderTargetBlur.texture,this.verticalBlurMaterial.uniforms.v.value=e*1/this.textureSize*o,a.setRenderTarget(this.renderTarget),a.render(this.blurPlane,this.shadowCamera),this.blurPlane.visible=!1,a.setRenderTarget(l)}};let Mo=OS;c(Mo,"_instances",new Map);sf([A()],Mo.prototype,"autoFit",void 0);sf([A()],Mo.prototype,"darkness",void 0);sf([A()],Mo.prototype,"opacity",void 0);sf([A()],Mo.prototype,"blur",void 0);sf([A()],Mo.prototype,"occludeBelowGround",void 0);sf([A()],Mo.prototype,"backfaceShadows",void 0);var hs=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};const Fv=N("debugspriterenderer"),JH=N("wireframe"),iy=class{static getOrCreateGeometry(t){if(t.__cached_geometry)return t.__cached_geometry;if(t.guid&&iy.cache[t.guid])return Fv&&console.log("Take cached geometry for sprite",t.guid),iy.cache[t.guid];const e=new jt;t.__cached_geometry=e;const i=new Float32Array(t.triangles.length*3),s=new Float32Array(t.triangles.length*2);for(let r=0;r<t.triangles.length;r+=1){const o=t.triangles[r];i[r*3]=-t.vertices[o].x,i[r*3+1]=t.vertices[o].y,i[r*3+2]=0;const a=t.uv[o];s[r*2]=a.x,s[r*2+1]=1-a.y}return e.setAttribute("position",new Ve(i,3)),e.setAttribute("uv",new Ve(s,2)),t.guid&&(this.cache[t.guid]=e),Fv&&console.log("Built sprite geometry",t,e),e}};let Ph=iy;c(Ph,"cache",{});var Uv;(function(n){n[n.Simple=0]="Simple",n[n.Sliced=1]="Sliced",n[n.Tiled=2]="Tiled"})(Uv||(Uv={}));class ZH{constructor(){c(this,"x");c(this,"y")}}class Vc{constructor(){c(this,"guid");c(this,"texture");c(this,"triangles");c(this,"uv");c(this,"vertices");c(this,"__cached_geometry");c(this,"_mesh");c(this,"_material")}get mesh(){return this._mesh||(this._mesh=new J(Ph.getOrCreateGeometry(this),this.material)),this._mesh}get material(){return this._material||(this.texture&&(this.texture.colorSpace=Ue,this.texture.minFilter==Wt&&this.texture.magFilter==Wt&&(this.texture.anisotropy=1),this.texture.needsUpdate=!0),this._material=new St({map:this.texture,color:16777215,side:pi,transparent:!0})),this._material}getGeometry(){return Ph.getOrCreateGeometry(this)}}hs([A()],Vc.prototype,"guid",void 0);hs([A(pt)],Vc.prototype,"texture",void 0);hs([kg()],Vc.prototype,"triangles",void 0);hs([kg()],Vc.prototype,"uv",void 0);hs([kg()],Vc.prototype,"vertices",void 0);const Yb=Symbol("spriteOwner");class o0{constructor(){c(this,"sprites")}}hs([A(Vc)],o0.prototype,"sprites",void 0);class tm{constructor(){c(this,"spriteSheet");c(this,"index",0)}update(t){if(!this.spriteSheet)return;const e=this.index;if(e<0||e>=this.spriteSheet.sprites.length)return;const i=this.spriteSheet.sprites[e],s=i==null?void 0:i.texture;if(s&&(s.colorSpace=Ue,s.minFilter==Wt&&s.magFilter==Wt&&(s.anisotropy=1),s.needsUpdate=!0,!i.__hasLoadedProgressive)){i.__hasLoadedProgressive=!0;const r=s;ct.assignTextureLOD(s,0).then(o=>{o instanceof pt&&(i.texture=o,(t==null?void 0:t.map)===r&&(t.map=o,t.needsUpdate=!0))})}}}hs([A(o0)],tm.prototype,"spriteSheet",void 0);hs([A()],tm.prototype,"index",void 0);class Go extends se{constructor(){super(...arguments);c(this,"drawMode",Uv.Simple);c(this,"size",{x:1,y:1});c(this,"color");c(this,"sharedMaterial");c(this,"transparent",!0);c(this,"cutoutThreshold",0);c(this,"castShadows",!1);c(this,"_spriteSheet");c(this,"_currentSprite")}get sprite(){return this._spriteSheet}set sprite(e){if(e!==this._spriteSheet)if(typeof e=="number"){const i=Math.floor(e);this.spriteIndex=i;return}else this._spriteSheet=e,this.updateSprite()}set spriteIndex(e){this._spriteSheet&&(this._spriteSheet.index=e,this.updateSprite())}get spriteIndex(){var e;return((e=this._spriteSheet)==null?void 0:e.index)??0}get spriteFrames(){var e,i;return((i=(e=this._spriteSheet)==null?void 0:e.spriteSheet)==null?void 0:i.sprites.length)??0}awake(){this._currentSprite=void 0,Fv&&console.log("Awake",this.name,this,this.sprite)}start(){this._currentSprite?this.gameObject&&this.gameObject.add(this._currentSprite):this.updateSprite()}updateSprite(){var i,s,r;if(!this.__didAwake||!((s=(i=this.sprite)==null?void 0:i.spriteSheet)!=null&&s.sprites))return;const e=this.sprite.spriteSheet.sprites[this.spriteIndex];if(!e){Fv&&console.warn("Sprite not found",this.spriteIndex,this.sprite.spriteSheet.sprites);return}if(this._currentSprite)this._currentSprite.geometry=Ph.getOrCreateGeometry(e),this._currentSprite.material.map=e.texture;else{const o=new St({color:16777215,side:pi});if(!o)return;if(JH&&(o.wireframe=!0),this.color&&(o.color||(o.color=new we),o.color.copy(this.color),o.opacity=this.color.alpha),o.transparent=!0,e.texture&&!o.wireframe){let a=e.texture;a[Yb]!==void 0&&a[Yb]!==this&&this.spriteFrames>1&&(a=e.texture=a.clone()),a[Yb]=this,o.map=a}this.sharedMaterial=o,this._currentSprite=new J(Ph.getOrCreateGeometry(e),o),ct.assignTextureLOD(o,0)}this._currentSprite.parent!==this.gameObject&&(this.drawMode===Uv.Tiled&&this._currentSprite.scale.set(this.size.x,this.size.y,1),this.gameObject&&this.gameObject.add(this._currentSprite)),this._currentSprite&&this._currentSprite.layers.set(this.layer),this.sharedMaterial&&(this.sharedMaterial.alphaTest=this.cutoutThreshold,this.sharedMaterial.transparent=this.transparent),this._currentSprite.castShadow=this.castShadows,(r=this._spriteSheet)==null||r.update(this.sharedMaterial)}}hs([A()],Go.prototype,"drawMode",void 0);hs([A(ZH)],Go.prototype,"size",void 0);hs([A(Ot)],Go.prototype,"color",void 0);hs([A(ft)],Go.prototype,"sharedMaterial",void 0);hs([A()],Go.prototype,"transparent",void 0);hs([A()],Go.prototype,"cutoutThreshold",void 0);hs([A()],Go.prototype,"castShadows",void 0);hs([A(tm)],Go.prototype,"sprite",null);var rf=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};const iT=N("debugwebxr"),$H=new ce().makeRotationY(Math.PI);class Xs extends se{constructor(){super(...arguments);c(this,"_arScale",1);c(this,"invertForward",!1);c(this,"customReticle");c(this,"useXRAnchor",!1);c(this,"arTouchTransform",!1);c(this,"autoPlace",!1);c(this,"_isPlacing",!0);c(this,"_startOffset",new ce);c(this,"_createdPlacementObject",null);c(this,"_reparentedComponents",[]);c(this,"_placementScene",new Ws);c(this,"_reticle",[]);c(this,"_hits",[]);c(this,"_placementStartTime",-1);c(this,"_rigPlacementMatrix");c(this,"_anchor",null);c(this,"userInput");c(this,"onPlaceScene",e=>{var r;if(this._isPlacing==!1||e!=null&&e.used)return;let i=this._reticle[0];if(!i){console.warn("No reticle to place...");return}if(!i.visible&&!this.autoPlace){console.warn("Reticle is not visible (can not place)");return}if((r=Me.active)!=null&&r.isTrackingImages){console.warn("Scene Placement is disabled while images are being tracked");return}let s=this._hits[0];if(e&&e.origin instanceof WM){const o=this._reticle[e.origin.index];o&&(i=o,s=this._hits[e.origin.index])}e&&(e.stopImmediatePropagation(),e.stopPropagation(),e.use()),this._isPlacing=!1,this.context.input.removeEventListener("pointerup",this.onPlaceScene),this.onRevertSceneChanges(),i.position.copy(i.lastPos),i.quaternion.copy(i.lastQuat),this.onApplyPose(i),this.useXRAnchor&&this.onCreateAnchor(Me.active,s)});c(this,"upVec",new C(0,1,0));c(this,"lookPoint",new C);c(this,"worldUpVec",new C(0,1,0))}static onPlaced(e){const i="placed";return this._eventListeners[i]||(this._eventListeners[i]=[]),this._eventListeners[i].push(e),()=>{const s=this._eventListeners[i].indexOf(e);s>=0&&this._eventListeners[i].splice(s,1)}}get arScale(){return this._arScale}set arScale(e){e!==this._arScale&&(this._arScale=e,this.onScaleChanged())}onEnable(){var e;(e=this.customReticle)==null||e.preload()}supportsXR(e){return e==="immersive-ar"}onEnterXR(e){iT&&console.log("ENTER WEBXR: SessionRoot start..."),this._anchor=null,this.gameObject.updateMatrixWorld(),this._startOffset.copy(this.gameObject.matrixWorld);const i=new re;this._createdPlacementObject=i,i.name="AR Session Root",this._placementScene.name="AR Placement Scene",this._placementScene.children.length=0;for(let s=this.context.scene.children.length-1;s>=0;s--){const r=this.context.scene.children[s];this._placementScene.add(r)}this.context.scene.add(i),this._reparentedComponents.length=0,this._reparentedComponents.push({comp:this,originalObject:this.gameObject}),z.addComponent(i,this);for(const s of this._reticle)Ua(s);this._reticle.length=0,this._isPlacing=!0,this.context.input.addEventListener("pointerup",this.onPlaceScene,{queue:fa.Early})}onLeaveXR(){this.context.input.removeEventListener("pointerup",this.onPlaceScene,{queue:fa.Early}),this.onRevertSceneChanges(),this._anchor=null,this._rigPlacementMatrix=void 0}onUpdateXR(e){var i,s,r,o;if(e.xr.isTrackingImages){for(const a of this._reticle)a.visible=!1;return}if(this._isPlacing){const a=(i=e.xr.rig)==null?void 0:i.gameObject;a&&a.parent!==this.context.scene&&this.context.scene.add(a);let l=!1;if(e.xr.isPassThrough&&e.xr.controllers.length>0)for(const h of e.xr.controllers){const u=h.getHitTest();u&&(l=!0,this.updateReticleAndHits(e.xr,h.index,u,e.xr.rigScale))}if(!l){const h=e.xr.getHitTest();h&&this.updateReticleAndHits(e.xr,0,h,e.xr.rigScale)}}else{if(this._anchor&&e.xr.referenceSpace){const a=e.xr.frame.getPose(this._anchor.anchorSpace,e.xr.referenceSpace);if(a&&this.context.time.frame%20===0){const l=e.xr.convertSpace(a.transform),h=this._reticle[0];h&&(h.position.copy(l.position),h.quaternion.copy(l.quaternion),this.onApplyPose(h))}}if(this.arTouchTransform?(this.userInput||(this.userInput=new Qu(this.context)),(s=this.userInput)==null||s.enable()):(r=this.userInput)==null||r.disable(),this.arTouchTransform&&((o=this.userInput)!=null&&o.hasChanged)){if(e.xr.rig){const a=e.xr.rig.gameObject;this.userInput.applyMatrixTo(a.matrix,!0),a.matrix.decompose(a.position,a.quaternion,a.scale),this.userInput.factor=a.scale.x}this.userInput.reset()}}}updateReticleAndHits(e,i,s,r){this._hits[i]=s.hit;let o=this._reticle[i];if(!o){if(this.customReticle)if(this.customReticle.asset)o=Qg(this.customReticle.asset);else{this.customReticle.loadAssetAsync();return}else o=new J(new E_(.07,.09,32).rotateX(-Math.PI/2),new St({side:pi})),o.name="AR Placement Reticle";if(iT){const a=new Do(1);a.position.y+=.01,o.add(a)}this._reticle[i]=o,o.matrixAutoUpdate=!1,o.visible=!1}o.lastPos=o.lastPos||s.position.clone(),o.lastQuat=o.lastQuat||s.quaternion.clone(),o.position.copy(o.lastPos.lerp(s.position,this.context.time.deltaTime/.1)),o.lastPos.copy(o.position),o.quaternion.copy(o.lastQuat.slerp(s.quaternion,this.context.time.deltaTime/.05)),o.lastQuat.copy(o.quaternion),o.scale.set(r,r,r),this.customReticle&&this.applyViewBasedTransform(o),o.updateMatrix(),o.visible=!0,o.parent!==this.context.scene&&this.context.scene.add(o),this._placementStartTime<0&&(this._placementStartTime=this.context.time.realtimeSinceStartup),this.autoPlace&&(o.visible=!1,this.onPlaceScene(null))}onScaleChanged(){}onRevertSceneChanges(){var e;for(const i of this._reticle)i&&(i.visible=!1,i==null||i.removeFromParent());this._reticle.length=0;for(let i=this._placementScene.children.length-1;i>=0;i--){const s=this._placementScene.children[i];this.context.scene.add(s)}(e=this._createdPlacementObject)==null||e.removeFromParent();for(const i of this._reparentedComponents)z.addComponent(i.originalObject,i.comp)}async onCreateAnchor(e,i){if(i.createAnchor===void 0){console.warn("Hit does not support creating an anchor",i),xe()&&Yt("Hit does not support creating an anchor");return}else{const s=await i.createAnchor(e.viewerPose.transform);e.running&&s&&(this._anchor=s)}}applyViewBasedTransform(e){const i=this.context.mainCamera,s=e,r=i.worldPosition,o=s.worldPosition;this.upVec.set(0,1,0).applyQuaternion(e.quaternion);const a=i.worldPosition;a&&e.position.clone().sub(a).angleTo(this.upVec)<Math.PI/2&&this.upVec.negate();const l=this.upVec.angleTo(this.worldUpVec)*180/Math.PI,h=30;l>h&&l<180-h||l<-h&&l>-180+h?(this.lookPoint.copy(e.position).add(this.upVec),this.lookPoint.y=e.position.y,e.lookAt(this.lookPoint)):(r.y=o.y,e.lookAt(r))}onApplyPose(e){var r,o,a,l;const i=(o=(r=Me.active)==null?void 0:r.rig)==null?void 0:o.gameObject;if(!i){console.warn("No rig object to place");return}(a=Me.active)!=null&&a.rigScale;const s=i.parent||this.context.scene;this._rigPlacementMatrix?(l=this._rigPlacementMatrix)==null||l.decompose(i.position,i.quaternion,i.scale):this._rigPlacementMatrix=i.matrix.clone(),this.applyViewBasedTransform(e),e.updateMatrix(),this.context.scene.add(e),e.attach(i),e.removeFromParent(),i.scale.set(this.arScale,this.arScale,this.arScale),i.position.multiplyScalar(this.arScale),i.updateMatrix(),this.invertForward&&i.matrix.premultiply($H),i.matrix.premultiply(this._startOffset),i.matrix.decompose(i.position,i.quaternion,i.scale),s.add(i)}}c(Xs,"_eventListeners",{});rf([A()],Xs.prototype,"arScale",null);rf([A()],Xs.prototype,"invertForward",void 0);rf([A(it)],Xs.prototype,"customReticle",void 0);rf([A()],Xs.prototype,"useXRAnchor",void 0);rf([A()],Xs.prototype,"arTouchTransform",void 0);rf([A()],Xs.prototype,"autoPlace",void 0);const ny=class{constructor(t){c(this,"oneFingerDrag",!0);c(this,"twoFingerRotate",!0);c(this,"twoFingerScale",!0);c(this,"factor",1);c(this,"context");c(this,"offset");c(this,"plane");c(this,"_scale",1);c(this,"_hasChanged",!1);c(this,"_enabled",!1);c(this,"currentlyUsedPointerIds",new Set);c(this,"currentlyUnusedPointerIds",new Set);c(this,"onPointerDownEarly",t=>{this.isActive&&t.stopPropagation()});c(this,"onPointerDownLate",t=>{t.used?this.currentlyUsedPointerIds.add(t.pointerId):this.currentlyUsedPointerIds.size<=0&&this.currentlyUnusedPointerIds.add(t.pointerId)});c(this,"onPointerUpEarly",t=>{this.currentlyUsedPointerIds.delete(t.pointerId),this.currentlyUnusedPointerIds.delete(t.pointerId)});c(this,"prev",new Map);c(this,"_didMultitouch",!1);c(this,"touchStart",t=>{for(let e=0;e<t.changedTouches.length;e++){const i=t.changedTouches[e],s=lL()&&i.clientY<window.innerHeight*.1;this.prev.has(i.identifier)||this.prev.set(i.identifier,{ignore:s,x:0,z:0,screenx:0,screeny:0});const r=this.prev.get(i.identifier);if(r){const o=this.getPositionOnPlane(i.clientX,i.clientY);r.x=o.x,r.z=o.z,r.screenx=i.clientX,r.screeny=i.clientY}}});c(this,"touchEnd",t=>{t.touches.length<=0&&(this._didMultitouch=!1);for(let e=0;e<t.changedTouches.length;e++){const i=t.changedTouches[e];this.prev.delete(i.identifier)}});c(this,"touchMove",t=>{if(!t.defaultPrevented&&this.isActive){if(t.touches.length===1){if(this._didMultitouch)return;const e=t.touches[0],i=this.prev.get(e.identifier);if(!i||i.ignore)return;const s=this.getPositionOnPlane(e.clientX,e.clientY),r=s.x-i.x,o=s.z-i.z;if(r===0&&o===0)return;this.oneFingerDrag&&this.addMovement(r,o),i.x=s.x,i.z=s.z,i.screenx=e.clientX,i.screeny=e.clientY;return}else if(t.touches.length===2){this._didMultitouch=!0;const e=t.touches[0],i=t.touches[1],s=this.prev.get(e.identifier),r=this.prev.get(i.identifier);if(!s||!r)return;if(this.twoFingerRotate){const o=Math.atan2(e.clientY-i.clientY,e.clientX-i.clientX),a=Math.atan2(s.screeny-r.screeny,s.screenx-r.screenx),l=o-a;Math.abs(l)>.001&&this.addRotation(l)}if(this.twoFingerScale){const o=e.clientX-i.clientX,a=e.clientY-i.clientY,l=Math.sqrt(o*o+a*a),h=s.screenx-r.screenx,u=s.screeny-r.screeny,d=Math.sqrt(h*h+u*u),f=l-d;Math.abs(f)>2&&this.addScale(f)}s.screenx=e.clientX,s.screeny=e.clientY,r.screenx=i.clientX,r.screeny=i.clientY}}});c(this,"_raycaster",new jd);c(this,"_intersection",new C);c(this,"_screenPos",new C);c(this,"_tempMatrix",new ce);this.context=t,this.offset=new ce,this.plane=new Oh,this.plane.setFromNormalAndCoplanarPoint(ny.up,ny.zero)}reset(){this._scale=1,this.offset.identity()}get hasChanged(){return this._hasChanged}applyMatrixTo(t,e){this._hasChanged=!1,e?(this.offset.invert(),t.premultiply(this.offset)):t.multiply(this.offset)}get isActive(){return this.currentlyUsedPointerIds.size<=0&&this.currentlyUnusedPointerIds.size>0}enable(){this._enabled||(this._enabled=!0,this.context.input.addEventListener("pointerdown",this.onPointerDownEarly,{queue:fa.Early}),this.context.input.addEventListener("pointerdown",this.onPointerDownLate,{queue:fa.Late}),this.context.input.addEventListener("pointerup",this.onPointerUpEarly,{queue:fa.Early}),window.addEventListener("touchstart",this.touchStart,{passive:!1}),window.addEventListener("touchmove",this.touchMove,{passive:!1}),window.addEventListener("touchend",this.touchEnd,{passive:!1}))}disable(){this._enabled&&(this._enabled=!1,this.context.input.removeEventListener("pointerdown",this.onPointerDownEarly,{queue:fa.Early}),this.context.input.removeEventListener("pointerdown",this.onPointerDownLate,{queue:fa.Late}),this.context.input.removeEventListener("pointerup",this.onPointerUpEarly,{queue:fa.Early}),window.removeEventListener("touchstart",this.touchStart),window.removeEventListener("touchmove",this.touchMove),window.removeEventListener("touchend",this.touchEnd))}getPositionOnPlane(t,e){const i=this.context.mainCamera;return this._screenPos.x=t/window.innerWidth*2-1,this._screenPos.y=-(e/window.innerHeight)*2+1,this._screenPos.z=1,this._screenPos.unproject(i),this._raycaster.set(i.position,this._screenPos.sub(i.position)),this._raycaster.ray.intersectPlane(this.plane,this._intersection),this._intersection}addMovement(t,e){t/=this._scale,e/=this._scale,t*=this.factor,e*=this.factor,this.offset.elements[12]+=t,this.offset.elements[14]+=e,(t!==0||e!==0)&&(this._hasChanged=!0)}addScale(t){t/=window.innerWidth,t*=-1,this._scale*=1+t,this._tempMatrix.makeScale(1-t,1-t,1-t),this.offset.premultiply(this._tempMatrix),t!==0&&(this._hasChanged=!0)}addRotation(t){t*=-1,this._tempMatrix.makeRotationY(t),this.offset.premultiply(this._tempMatrix),t!==0&&(this._hasChanged=!0)}};let Qu=ny;c(Qu,"up",new C(0,1,0)),c(Qu,"zero",new C(0,0,0)),c(Qu,"one",new C(1,1,1));var of=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};class Fl extends se{constructor(){super(...arguments);c(this,"position","bottom");c(this,"showNeedleLogo",!0);c(this,"showSpatialMenu");c(this,"createFullscreenButton");c(this,"createMuteButton");c(this,"createQRCodeButton")}onEnable(){this.applyOptions()}applyOptions(){this.context.menu.setPosition(this.position),this.context.menu.showNeedleLogo(this.showNeedleLogo),this.createFullscreenButton===!0&&this.context.menu.showFullscreenOption(!0),this.createMuteButton===!0&&this.context.menu.showAudioPlaybackOption(!0),this.showSpatialMenu===!0&&this.context.menu.showSpatialMenu(this.showSpatialMenu),this.createQRCodeButton===!0&&(No()||this.context.menu.showQRCodeButton(!0))}}of([A()],Fl.prototype,"position",void 0);of([A()],Fl.prototype,"showNeedleLogo",void 0);of([A()],Fl.prototype,"showSpatialMenu",void 0);of([A()],Fl.prototype,"createFullscreenButton",void 0);of([A()],Fl.prototype,"createMuteButton",void 0);of([A()],Fl.prototype,"createQRCodeButton",void 0);const wi={Handedness:Object.freeze({NONE:"none",LEFT:"left",RIGHT:"right"}),ComponentState:Object.freeze({DEFAULT:"default",TOUCHED:"touched",PRESSED:"pressed"}),ComponentProperty:Object.freeze({BUTTON:"button",X_AXIS:"xAxis",Y_AXIS:"yAxis",STATE:"state"}),ComponentType:Object.freeze({TRIGGER:"trigger",SQUEEZE:"squeeze",TOUCHPAD:"touchpad",THUMBSTICK:"thumbstick",BUTTON:"button"}),ButtonTouchThreshold:.05,AxisTouchThreshold:.1,VisualResponseProperty:Object.freeze({TRANSFORM:"transform",VISIBILITY:"visibility"})};async function Ok(n){const t=await fetch(n);if(t.ok)return t.json();throw new Error(t.statusText)}async function eV(n){if(!n)throw new Error("No basePath supplied");return await Ok(`${n}/profilesList.json`)}async function tV(n,t,e=null,i=!0){if(!n)throw new Error("No xrInputSource supplied");if(!t)throw new Error("No basePath supplied");const s=await eV(t);let r;if(n.profiles.some(l=>{const h=s[l];return h&&(r={profileId:l,profilePath:`${t}/${h.path}`,deprecated:!!h.deprecated}),!!r}),!r){if(!e)throw new Error("No matching profile name found");const l=s[e];if(!l)throw new Error(`No matching profile name found and default profile "${e}" missing.`);r={profileId:e,profilePath:`${t}/${l.path}`,deprecated:!!l.deprecated}}const o=await Ok(r.profilePath);let a;if(i){let l;if(n.handedness==="any"?l=o.layouts[Object.keys(o.layouts)[0]]:l=o.layouts[n.handedness],!l)throw new Error(`No matching handedness, ${n.handedness}, in profile ${r.profileId}`);l.assetPath&&(a=r.profilePath.replace("profile.json",l.assetPath))}return{profile:o,assetPath:a}}const iV={xAxis:0,yAxis:0,button:0,state:wi.ComponentState.DEFAULT};function nV(n=0,t=0){let e=n,i=t;if(Math.sqrt(n*n+t*t)>1){const o=Math.atan2(t,n);e=Math.cos(o),i=Math.sin(o)}return{normalizedXAxis:e*.5+.5,normalizedYAxis:i*.5+.5}}class sV{constructor(t){this.componentProperty=t.componentProperty,this.states=t.states,this.valueNodeName=t.valueNodeName,this.valueNodeProperty=t.valueNodeProperty,this.valueNodeProperty===wi.VisualResponseProperty.TRANSFORM&&(this.minNodeName=t.minNodeName,this.maxNodeName=t.maxNodeName),this.value=0,this.updateFromComponent(iV)}updateFromComponent({xAxis:t,yAxis:e,button:i,state:s}){const{normalizedXAxis:r,normalizedYAxis:o}=nV(t,e);switch(this.componentProperty){case wi.ComponentProperty.X_AXIS:this.value=this.states.includes(s)?r:.5;break;case wi.ComponentProperty.Y_AXIS:this.value=this.states.includes(s)?o:.5;break;case wi.ComponentProperty.BUTTON:this.value=this.states.includes(s)?i:0;break;case wi.ComponentProperty.STATE:this.valueNodeProperty===wi.VisualResponseProperty.VISIBILITY?this.value=this.states.includes(s):this.value=this.states.includes(s)?1:0;break;default:throw new Error(`Unexpected visualResponse componentProperty ${this.componentProperty}`)}}}class rV{constructor(t,e){if(!t||!e||!e.visualResponses||!e.gamepadIndices||Object.keys(e.gamepadIndices).length===0)throw new Error("Invalid arguments supplied");this.id=t,this.type=e.type,this.rootNodeName=e.rootNodeName,this.touchPointNodeName=e.touchPointNodeName,this.visualResponses={},Object.keys(e.visualResponses).forEach(i=>{const s=new sV(e.visualResponses[i]);this.visualResponses[i]=s}),this.gamepadIndices=Object.assign({},e.gamepadIndices),this.values={state:wi.ComponentState.DEFAULT,button:this.gamepadIndices.button!==void 0?0:void 0,xAxis:this.gamepadIndices.xAxis!==void 0?0:void 0,yAxis:this.gamepadIndices.yAxis!==void 0?0:void 0}}get data(){return{id:this.id,...this.values}}updateFromGamepad(t){if(this.values.state=wi.ComponentState.DEFAULT,this.gamepadIndices.button!==void 0&&t.buttons.length>this.gamepadIndices.button){const e=t.buttons[this.gamepadIndices.button];this.values.button=e.value,this.values.button=this.values.button<0?0:this.values.button,this.values.button=this.values.button>1?1:this.values.button,e.pressed||this.values.button===1?this.values.state=wi.ComponentState.PRESSED:(e.touched||this.values.button>wi.ButtonTouchThreshold)&&(this.values.state=wi.ComponentState.TOUCHED)}this.gamepadIndices.xAxis!==void 0&&t.axes.length>this.gamepadIndices.xAxis&&(this.values.xAxis=t.axes[this.gamepadIndices.xAxis],this.values.xAxis=this.values.xAxis<-1?-1:this.values.xAxis,this.values.xAxis=this.values.xAxis>1?1:this.values.xAxis,this.values.state===wi.ComponentState.DEFAULT&&Math.abs(this.values.xAxis)>wi.AxisTouchThreshold&&(this.values.state=wi.ComponentState.TOUCHED)),this.gamepadIndices.yAxis!==void 0&&t.axes.length>this.gamepadIndices.yAxis&&(this.values.yAxis=t.axes[this.gamepadIndices.yAxis],this.values.yAxis=this.values.yAxis<-1?-1:this.values.yAxis,this.values.yAxis=this.values.yAxis>1?1:this.values.yAxis,this.values.state===wi.ComponentState.DEFAULT&&Math.abs(this.values.yAxis)>wi.AxisTouchThreshold&&(this.values.state=wi.ComponentState.TOUCHED)),Object.values(this.visualResponses).forEach(e=>{e.updateFromComponent(this.values)})}}class oV{constructor(t,e,i){if(!t)throw new Error("No xrInputSource supplied");if(!e)throw new Error("No profile supplied");this.xrInputSource=t,this.assetUrl=i,this.id=e.profileId,this.layoutDescription=e.layouts[t.handedness],this.components={},Object.keys(this.layoutDescription.components).forEach(s=>{const r=this.layoutDescription.components[s];this.components[s]=new rV(s,r)}),this.updateFromGamepad()}get gripSpace(){return this.xrInputSource.gripSpace}get targetRaySpace(){return this.xrInputSource.targetRaySpace}get data(){const t=[];return Object.values(this.components).forEach(e=>{t.push(e.data)}),t}updateFromGamepad(){Object.values(this.components).forEach(t=>{t.updateFromGamepad(this.xrInputSource.gamepad)})}}const aV="https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@1.0/dist/profiles",lV="generic-trigger";let cV=class extends re{constructor(){super(),this.motionController=null,this.envMap=null}setEnvironmentMap(t){return this.envMap==t?this:(this.envMap=t,this.traverse(e=>{e.isMesh&&(e.material.envMap=this.envMap,e.material.needsUpdate=!0)}),this)}updateMatrixWorld(t){super.updateMatrixWorld(t),this.motionController&&(this.motionController.updateFromGamepad(),Object.values(this.motionController.components).forEach(e=>{Object.values(e.visualResponses).forEach(i=>{const{valueNode:s,minNode:r,maxNode:o,value:a,valueNodeProperty:l}=i;s&&(l===wi.VisualResponseProperty.VISIBILITY?s.visible=a:l===wi.VisualResponseProperty.TRANSFORM&&(s.quaternion.slerpQuaternions(r.quaternion,o.quaternion,a),s.position.lerpVectors(r.position,o.position,a)))})}))}};function hV(n,t){Object.values(n.components).forEach(e=>{const{type:i,touchPointNodeName:s,visualResponses:r}=e;if(i===wi.ComponentType.TOUCHPAD)if(e.touchPointNode=t.getObjectByName(s),e.touchPointNode){const o=new Qd(.001),a=new St({color:255}),l=new J(o,a);e.touchPointNode.add(l)}else console.warn(`Could not find touch dot, ${e.touchPointNodeName}, in touchpad component ${e.id}`);Object.values(r).forEach(o=>{const{valueNodeName:a,minNodeName:l,maxNodeName:h,valueNodeProperty:u}=o;if(u===wi.VisualResponseProperty.TRANSFORM){if(o.minNode=t.getObjectByName(l),o.maxNode=t.getObjectByName(h),!o.minNode){console.warn(`Could not find ${l} in the model`);return}if(!o.maxNode){console.warn(`Could not find ${h} in the model`);return}}o.valueNode=t.getObjectByName(a),o.valueNode||console.warn(`Could not find ${a} in the model`)})})}function nT(n,t){hV(n.motionController,t),n.envMap&&t.traverse(e=>{e.isMesh&&(e.material.envMap=n.envMap,e.material.needsUpdate=!0)}),n.layers.mask!=0&&t.traverse(e=>{e.layers.mask=n.layers.mask}),n.add(t)}class uV{constructor(t=null,e=null){this.gltfLoader=t,this.path=aV,this._assetCache={},this.onLoad=e,this.gltfLoader||(this.gltfLoader=new Fc)}setPath(t){return this.path=t,this}createControllerModel(t){const e=new cV;let i=null;return t.addEventListener("connected",s=>{const r=s.data;r.targetRayMode!=="tracked-pointer"||!r.gamepad||tV(r,this.path,lV).then(({profile:o,assetPath:a})=>{e.motionController=new oV(r,o,a);const l=this._assetCache[e.motionController.assetUrl];if(l)i=l.scene.clone(),nT(e,i),this.onLoad&&this.onLoad(i);else{if(!this.gltfLoader)throw new Error("GLTFLoader not set.");this.gltfLoader.setPath(""),this.gltfLoader.load(e.motionController.assetUrl,h=>{this._assetCache[e.motionController.assetUrl]=h,i=h.scene.clone(),nT(e,i),this.onLoad&&this.onLoad(i)},null,()=>{throw new Error(`Asset ${e.motionController.assetUrl} missing or malformed.`)})}}).catch(o=>{console.warn(o)})}),t.addEventListener("disconnected",()=>{e.motionController=null,e.remove(i),i=null}),e}}const dV="https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@1.0/dist/profiles/generic-hand/";class fV{constructor(t,e,i,s,r=null,o=null){this.controller=e,this.handModel=t,this.bones=[],r===null&&(r=new Fc,r.setPath(i||dV)),r.load(`${s}.glb`,a=>{const l=a.scene.children[0];this.handModel.add(l),l.layers.mask=this.handModel.layers.mask;const h=l.getObjectByProperty("type","SkinnedMesh");h.frustumCulled=!1,h.castShadow=!0,h.receiveShadow=!0,["wrist","thumb-metacarpal","thumb-phalanx-proximal","thumb-phalanx-distal","thumb-tip","index-finger-metacarpal","index-finger-phalanx-proximal","index-finger-phalanx-intermediate","index-finger-phalanx-distal","index-finger-tip","middle-finger-metacarpal","middle-finger-phalanx-proximal","middle-finger-phalanx-intermediate","middle-finger-phalanx-distal","middle-finger-tip","ring-finger-metacarpal","ring-finger-phalanx-proximal","ring-finger-phalanx-intermediate","ring-finger-phalanx-distal","ring-finger-tip","pinky-finger-metacarpal","pinky-finger-phalanx-proximal","pinky-finger-phalanx-intermediate","pinky-finger-phalanx-distal","pinky-finger-tip"].forEach(d=>{const f=l.getObjectByName(d);f!==void 0?f.jointName=d:console.warn(`Couldn't find ${d} in ${s} hand mesh`),this.bones.push(f)}),o&&o(l)})}updateMesh(){const t=this.controller.joints;for(let e=0;e<this.bones.length;e++){const i=this.bones[e];if(i){const s=t[i.jointName];if(s.visible){const r=s.position;i.position.copy(r),i.quaternion.copy(s.quaternion)}}}}}var a0=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};const Jo=N("debugwebxr"),Kl=new Array;class Rl extends se{constructor(){super(...arguments);c(this,"createControllerModel",!0);c(this,"createHandModel",!0);c(this,"customLeftHand");c(this,"customRightHand");c(this,"_models",new Array)}supportsXR(e){return e==="immersive-vr"||e==="immersive-ar"}async onXRControllerAdded(e){var r,o,a;if(!(e.xr.isVR||e.xr.isPassThrough))return;const{controller:s}=e;if(Jo&&console.warn("Add Controller Model for",s.side,s.index),this.createControllerModel){if(s.hand){if(this.createHandModel){const l=await this.loadHandModel(s);if(!l||!s.connected||!s.isHand){(r=l==null?void 0:l.handObject)==null||r.removeFromParent(),(a=(o=l==null?void 0:l.handmesh)==null?void 0:o.controller)==null||a.removeFromParent();return}this._models.push({controller:s,model:l.handObject,handmesh:l.handmesh}),this._models.sort((h,u)=>h.controller.index-u.controller.index),this.scene.add(l.handObject)}}else if(this.createControllerModel){const l=await s.getModelUrl();if(l){const h=await this.loadModel(s,l);if(!h||!s.connected||s.isHand)return;this._models.push({controller:s,model:h}),this._models.sort((u,d)=>u.controller.index-d.controller.index),this.scene.add(h),h.traverse(u=>{u.layers.set(2)})}else s.targetRayMode!=="transient-pointer"&&console.warn("XRControllerModel: no model found for "+s.side)}}}onXRControllerRemoved(e){var r;const i=this._models.findIndex(o=>o.controller===e.controller),s=this._models[i];s&&(this._models.splice(i,1),s.handmesh&&((r=s.handmesh.handModel)==null||r.removeFromParent(),s.handmesh=void 0),s.model&&(s.model.removeFromParent(),s.model=void 0))}onBeforeRender(){if(Me.active&&(Jo&&(Kl[0]=Date.now()),this.updateRendering(Me.active),Jo)){const e=Date.now()-Kl[0];if(Kl.push(e),Kl.length>=30){Kl[0]=0;const i=Kl.reduce((s,r)=>s+r,0)/Kl.length;Kl.length=0,console.log("[XRControllerModel] "+i.toFixed(2)+" ms")}}}onLeaveXR(e){var i;for(const s of this._models)s&&((i=s.model)==null||i.removeFromParent());this._models.length=0}updateRendering(e){var i,s,r,o,a;for(let l=0;l<this._models.length;l++){const h=this._models[l];if(!h)continue;const u=h.controller;if(!u.connected){Jo&&console.warn("XRControllerModel.onUpdateXR: controller is not connected anymore",u.side,u.hand);continue}if(h.model&&!h.handmesh)h.model.position.copy(u.gripPosition),h.model.quaternion.copy(u.gripQuaternion),h.model.visible=u.isTracking,(i=e.rig)==null||i.gameObject.add(h.model);else if(u.inputSource.hand&&h.handmesh){const d=e.referenceSpace,f=this.context.renderer.xr.getHand(u.index);if(d&&e.frame.getJointPose){for(const p of u.inputSource.hand.values()){const g=f.joints[p.jointName];if(g){const m=u.getHandJointPose(p);if(m){const{position:v,quaternion:y}=e.convertSpace(m.transform);g.position.copy(v),g.quaternion.copy(y),g.matrixWorldAutoUpdate=!1}g.visible=m!=null}}h.model&&(h.model.visible=u.isTracking,h.model.visible&&h.model.parent!==((s=e.rig)==null?void 0:s.gameObject)&&((r=e.rig)==null||r.gameObject.add(h.model)),h.model.position.set(0,0,0)),(o=h.model)!=null&&o.visible&&((a=h.handmesh)==null||a.updateMesh())}}}}async loadModel(e,i){var o;if(!e.connected)return console.warn("XRControllerModel.onXRControllerAdded: controller is not connected anymore",e.side),null;const r=await it.getOrCreate("",i).instantiate();return wI(r),(o=Me.active)!=null&&o.isPassThrough&&r.traverseVisible(a=>{this.makeOccluder(a)}),r}async loadHandModel(e){const i=this.context,s=i.renderer.xr.getHand(e.index);s||(Jo?De.DrawLabel(e.rayWorldPosition,"No hand found for index "+e.index,.05,5):console.warn("No hand found for index "+e.index));const r=new Fc;wy(r,i),await Bk(r,i,this.sourceId??""),r.setPath("https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@1.0/dist/profiles/generic-hand/");const o=e.side==="left"?"left.":"right.",a=e.side==="left"?this.customLeftHand:this.customRightHand;if(a)if(!a.uri.includes(o))console.warn("XRControllerModel: custom hand model must be named "+o),Yt("Custom Hand: unexpected name, please see the console for details");else{const u=a.uri.substring(0,a.uri.indexOf(o));r.setPath(u),Jo&&console.log("XRControllerModel: loading custom hand model from "+u)}const l=new re;wI(l);const h=new fV(l,s,r.path,e.inputSource.handedness,r,u=>{u.traverse(d=>{var f;d.layers.set(2),(f=Me.active)!=null&&f.isPassThrough&&this.makeOccluder(d),d instanceof J&&ct.assignMeshLOD(d,0)}),e.connected||(Jo&&De.DrawLabel(e.rayWorldPosition,"Hand is loaded but not connected anymore",.05,5),u.removeFromParent())});if(Jo&&l.add(new Do(.5)),e.inputSource.hand){Jo&&console.log(e.inputSource.hand);for(const u of e.inputSource.hand.values())if(s.joints[u.jointName]===void 0){const d=new To;d.matrixAutoUpdate=!1,d.visible=!0,s.joints[u.jointName]=d,s.add(d)}}else Jo&&De.DrawLabel(e.rayWorldPosition,"No inputSource.hand found for index "+e.index,.05,5);return{handObject:l,handmesh:h}}makeOccluder(e){if(e instanceof J){let i=e.material;i instanceof ft&&(i=e.material=i.clone(),i.depthWrite=!0,i.depthTest=!0,i.colorWrite=!1,e.renderOrder=-100)}}}c(Rl,"factory",new uV);a0([A()],Rl.prototype,"createControllerModel",void 0);a0([A()],Rl.prototype,"createHandModel",void 0);a0([A(it)],Rl.prototype,"customLeftHand",void 0);a0([A(it)],Rl.prototype,"customRightHand",void 0);const sT=new Nn,aA=new C;class Lk extends $R{constructor(){super(),this.isLineSegmentsGeometry=!0,this.type="LineSegmentsGeometry";const t=[-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],e=[-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],i=[0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5];this.setIndex(i),this.setAttribute("position",new hn(t,3)),this.setAttribute("uv",new hn(e,2))}applyMatrix4(t){const e=this.attributes.instanceStart,i=this.attributes.instanceEnd;return e!==void 0&&(e.applyMatrix4(t),i.applyMatrix4(t),e.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}setPositions(t){let e;t instanceof Float32Array?e=t:Array.isArray(t)&&(e=new Float32Array(t));const i=new I_(e,6,1);return this.setAttribute("instanceStart",new Ac(i,3,0)),this.setAttribute("instanceEnd",new Ac(i,3,3)),this.computeBoundingBox(),this.computeBoundingSphere(),this}setColors(t){let e;t instanceof Float32Array?e=t:Array.isArray(t)&&(e=new Float32Array(t));const i=new I_(e,6,1);return this.setAttribute("instanceColorStart",new Ac(i,3,0)),this.setAttribute("instanceColorEnd",new Ac(i,3,3)),this}fromWireframeGeometry(t){return this.setPositions(t.attributes.position.array),this}fromEdgesGeometry(t){return this.setPositions(t.attributes.position.array),this}fromMesh(t){return this.fromWireframeGeometry(new W2(t.geometry)),this}fromLineSegments(t){const e=t.geometry;return this.setPositions(e.attributes.position.array),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Nn);const t=this.attributes.instanceStart,e=this.attributes.instanceEnd;t!==void 0&&e!==void 0&&(this.boundingBox.setFromBufferAttribute(t),sT.setFromBufferAttribute(e),this.boundingBox.union(sT))}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Wh),this.boundingBox===null&&this.computeBoundingBox();const t=this.attributes.instanceStart,e=this.attributes.instanceEnd;if(t!==void 0&&e!==void 0){const i=this.boundingSphere.center;this.boundingBox.getCenter(i);let s=0;for(let r=0,o=t.count;r<o;r++)aA.fromBufferAttribute(t,r),s=Math.max(s,i.distanceToSquared(aA)),aA.fromBufferAttribute(e,r),s=Math.max(s,i.distanceToSquared(aA));this.boundingSphere.radius=Math.sqrt(s),isNaN(this.boundingSphere.radius)&&console.error("THREE.LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}toJSON(){}applyMatrix(t){return console.warn("THREE.LineSegmentsGeometry: applyMatrix() has been renamed to applyMatrix4()."),this.applyMatrix4(t)}}In.line={worldUnits:{value:1},linewidth:{value:1},resolution:{value:new ae(1,1)},dashOffset:{value:0},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1}};gd.line={uniforms:ly.merge([In.common,In.fog,In.line]),vertexShader:`
		#include <common>
		#include <color_pars_vertex>
		#include <fog_pars_vertex>
		#include <logdepthbuf_pars_vertex>
		#include <clipping_planes_pars_vertex>

		uniform float linewidth;
		uniform vec2 resolution;

		attribute vec3 instanceStart;
		attribute vec3 instanceEnd;

		attribute vec3 instanceColorStart;
		attribute vec3 instanceColorEnd;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#ifdef USE_DASH

			uniform float dashScale;
			attribute float instanceDistanceStart;
			attribute float instanceDistanceEnd;
			varying float vLineDistance;

		#endif

		void trimSegment( const in vec4 start, inout vec4 end ) {

			// trim end segment so it terminates between the camera plane and the near plane

			// conservative estimate of the near plane
			float a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column
			float b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column
			float nearEstimate = - 0.5 * b / a;

			float alpha = ( nearEstimate - start.z ) / ( end.z - start.z );

			end.xyz = mix( start.xyz, end.xyz, alpha );

		}

		void main() {

			#ifdef USE_COLOR

				vColor.xyz = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;

			#endif

			#ifdef USE_DASH

				vLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;
				vUv = uv;

			#endif

			float aspect = resolution.x / resolution.y;

			// camera space
			vec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );
			vec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );

			#ifdef WORLD_UNITS

				worldStart = start.xyz;
				worldEnd = end.xyz;

			#else

				vUv = uv;

			#endif

			// special case for perspective projection, and segments that terminate either in, or behind, the camera plane
			// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space
			// but we need to perform ndc-space calculations in the shader, so we must address this issue directly
			// perhaps there is a more elegant solution -- WestLangley

			bool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column

			if ( perspective ) {

				if ( start.z < 0.0 && end.z >= 0.0 ) {

					trimSegment( start, end );

				} else if ( end.z < 0.0 && start.z >= 0.0 ) {

					trimSegment( end, start );

				}

			}

			// clip space
			vec4 clipStart = projectionMatrix * start;
			vec4 clipEnd = projectionMatrix * end;

			// ndc space
			vec3 ndcStart = clipStart.xyz / clipStart.w;
			vec3 ndcEnd = clipEnd.xyz / clipEnd.w;

			// direction
			vec2 dir = ndcEnd.xy - ndcStart.xy;

			// account for clip-space aspect ratio
			dir.x *= aspect;
			dir = normalize( dir );

			#ifdef WORLD_UNITS

				vec3 worldDir = normalize( end.xyz - start.xyz );
				vec3 tmpFwd = normalize( mix( start.xyz, end.xyz, 0.5 ) );
				vec3 worldUp = normalize( cross( worldDir, tmpFwd ) );
				vec3 worldFwd = cross( worldDir, worldUp );
				worldPos = position.y < 0.5 ? start: end;

				// height offset
				float hw = linewidth * 0.5;
				worldPos.xyz += position.x < 0.0 ? hw * worldUp : - hw * worldUp;

				// don't extend the line if we're rendering dashes because we
				// won't be rendering the endcaps
				#ifndef USE_DASH

					// cap extension
					worldPos.xyz += position.y < 0.5 ? - hw * worldDir : hw * worldDir;

					// add width to the box
					worldPos.xyz += worldFwd * hw;

					// endcaps
					if ( position.y > 1.0 || position.y < 0.0 ) {

						worldPos.xyz -= worldFwd * 2.0 * hw;

					}

				#endif

				// project the worldpos
				vec4 clip = projectionMatrix * worldPos;

				// shift the depth of the projected points so the line
				// segments overlap neatly
				vec3 clipPose = ( position.y < 0.5 ) ? ndcStart : ndcEnd;
				clip.z = clipPose.z * clip.w;

			#else

				vec2 offset = vec2( dir.y, - dir.x );
				// undo aspect ratio adjustment
				dir.x /= aspect;
				offset.x /= aspect;

				// sign flip
				if ( position.x < 0.0 ) offset *= - 1.0;

				// endcaps
				if ( position.y < 0.0 ) {

					offset += - dir;

				} else if ( position.y > 1.0 ) {

					offset += dir;

				}

				// adjust for linewidth
				offset *= linewidth;

				// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...
				offset /= resolution.y;

				// select end
				vec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;

				// back to clip space
				offset *= clip.w;

				clip.xy += offset;

			#endif

			gl_Position = clip;

			vec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation

			#include <logdepthbuf_vertex>
			#include <clipping_planes_vertex>
			#include <fog_vertex>

		}
		`,fragmentShader:`
		uniform vec3 diffuse;
		uniform float opacity;
		uniform float linewidth;

		#ifdef USE_DASH

			uniform float dashOffset;
			uniform float dashSize;
			uniform float gapSize;

		#endif

		varying float vLineDistance;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#include <common>
		#include <color_pars_fragment>
		#include <fog_pars_fragment>
		#include <logdepthbuf_pars_fragment>
		#include <clipping_planes_pars_fragment>

		vec2 closestLineToLine(vec3 p1, vec3 p2, vec3 p3, vec3 p4) {

			float mua;
			float mub;

			vec3 p13 = p1 - p3;
			vec3 p43 = p4 - p3;

			vec3 p21 = p2 - p1;

			float d1343 = dot( p13, p43 );
			float d4321 = dot( p43, p21 );
			float d1321 = dot( p13, p21 );
			float d4343 = dot( p43, p43 );
			float d2121 = dot( p21, p21 );

			float denom = d2121 * d4343 - d4321 * d4321;

			float numer = d1343 * d4321 - d1321 * d4343;

			mua = numer / denom;
			mua = clamp( mua, 0.0, 1.0 );
			mub = ( d1343 + d4321 * ( mua ) ) / d4343;
			mub = clamp( mub, 0.0, 1.0 );

			return vec2( mua, mub );

		}

		void main() {

			#include <clipping_planes_fragment>

			#ifdef USE_DASH

				if ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps

				if ( mod( vLineDistance + dashOffset, dashSize + gapSize ) > dashSize ) discard; // todo - FIX

			#endif

			float alpha = opacity;

			#ifdef WORLD_UNITS

				// Find the closest points on the view ray and the line segment
				vec3 rayEnd = normalize( worldPos.xyz ) * 1e5;
				vec3 lineDir = worldEnd - worldStart;
				vec2 params = closestLineToLine( worldStart, worldEnd, vec3( 0.0, 0.0, 0.0 ), rayEnd );

				vec3 p1 = worldStart + lineDir * params.x;
				vec3 p2 = rayEnd * params.y;
				vec3 delta = p1 - p2;
				float len = length( delta );
				float norm = len / linewidth;

				#ifndef USE_DASH

					#ifdef USE_ALPHA_TO_COVERAGE

						float dnorm = fwidth( norm );
						alpha = 1.0 - smoothstep( 0.5 - dnorm, 0.5 + dnorm, norm );

					#else

						if ( norm > 0.5 ) {

							discard;

						}

					#endif

				#endif

			#else

				#ifdef USE_ALPHA_TO_COVERAGE

					// artifacts appear on some hardware if a derivative is taken within a conditional
					float a = vUv.x;
					float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
					float len2 = a * a + b * b;
					float dlen = fwidth( len2 );

					if ( abs( vUv.y ) > 1.0 ) {

						alpha = 1.0 - smoothstep( 1.0 - dlen, 1.0 + dlen, len2 );

					}

				#else

					if ( abs( vUv.y ) > 1.0 ) {

						float a = vUv.x;
						float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
						float len2 = a * a + b * b;

						if ( len2 > 1.0 ) discard;

					}

				#endif

			#endif

			vec4 diffuseColor = vec4( diffuse, alpha );

			#include <logdepthbuf_fragment>
			#include <color_fragment>

			gl_FragColor = vec4( diffuseColor.rgb, alpha );

			#include <tonemapping_fragment>
			#include <colorspace_fragment>
			#include <fog_fragment>
			#include <premultiplied_alpha_fragment>

		}
		`};class jC extends $e{constructor(t){super({type:"LineMaterial",uniforms:ly.clone(gd.line.uniforms),vertexShader:gd.line.vertexShader,fragmentShader:gd.line.fragmentShader,clipping:!0}),this.isLineMaterial=!0,this.setValues(t)}get color(){return this.uniforms.diffuse.value}set color(t){this.uniforms.diffuse.value=t}get worldUnits(){return"WORLD_UNITS"in this.defines}set worldUnits(t){t===!0?this.defines.WORLD_UNITS="":delete this.defines.WORLD_UNITS}get linewidth(){return this.uniforms.linewidth.value}set linewidth(t){this.uniforms.linewidth&&(this.uniforms.linewidth.value=t)}get dashed(){return"USE_DASH"in this.defines}set dashed(t){t===!0!==this.dashed&&(this.needsUpdate=!0),t===!0?this.defines.USE_DASH="":delete this.defines.USE_DASH}get dashScale(){return this.uniforms.dashScale.value}set dashScale(t){this.uniforms.dashScale.value=t}get dashSize(){return this.uniforms.dashSize.value}set dashSize(t){this.uniforms.dashSize.value=t}get dashOffset(){return this.uniforms.dashOffset.value}set dashOffset(t){this.uniforms.dashOffset.value=t}get gapSize(){return this.uniforms.gapSize.value}set gapSize(t){this.uniforms.gapSize.value=t}get opacity(){return this.uniforms.opacity.value}set opacity(t){this.uniforms&&(this.uniforms.opacity.value=t)}get resolution(){return this.uniforms.resolution.value}set resolution(t){this.uniforms.resolution.value.copy(t)}get alphaToCoverage(){return"USE_ALPHA_TO_COVERAGE"in this.defines}set alphaToCoverage(t){this.defines&&(t===!0!==this.alphaToCoverage&&(this.needsUpdate=!0),t===!0?(this.defines.USE_ALPHA_TO_COVERAGE="",this.extensions.derivatives=!0):(delete this.defines.USE_ALPHA_TO_COVERAGE,this.extensions.derivatives=!1))}}const rT=new C,oT=new C,bn=new ke,_n=new ke,Zo=new ke,Kb=new C,Jb=new ce,Bn=new eB,aT=new C,lA=new Nn,cA=new Wh,$o=new ke;let ba,Mh;function lT(n,t,e){return $o.set(0,0,-t,1).applyMatrix4(n.projectionMatrix),$o.multiplyScalar(1/$o.w),$o.x=Mh/e.width,$o.y=Mh/e.height,$o.applyMatrix4(n.projectionMatrixInverse),$o.multiplyScalar(1/$o.w),Math.abs(Math.max($o.x,$o.y))}function pV(n,t){const e=n.matrixWorld,i=n.geometry,s=i.attributes.instanceStart,r=i.attributes.instanceEnd,o=Math.min(i.instanceCount,s.count);for(let a=0,l=o;a<l;a++){Bn.start.fromBufferAttribute(s,a),Bn.end.fromBufferAttribute(r,a),Bn.applyMatrix4(e);const h=new C,u=new C;ba.distanceSqToSegment(Bn.start,Bn.end,u,h),u.distanceTo(h)<Mh*.5&&t.push({point:u,pointOnLine:h,distance:ba.origin.distanceTo(u),object:n,face:null,faceIndex:a,uv:null,uv1:null})}}function gV(n,t,e){const i=t.projectionMatrix,r=n.material.resolution,o=n.matrixWorld,a=n.geometry,l=a.attributes.instanceStart,h=a.attributes.instanceEnd,u=Math.min(a.instanceCount,l.count),d=-t.near;ba.at(1,Zo),Zo.w=1,Zo.applyMatrix4(t.matrixWorldInverse),Zo.applyMatrix4(i),Zo.multiplyScalar(1/Zo.w),Zo.x*=r.x/2,Zo.y*=r.y/2,Zo.z=0,Kb.copy(Zo),Jb.multiplyMatrices(t.matrixWorldInverse,o);for(let f=0,p=u;f<p;f++){if(bn.fromBufferAttribute(l,f),_n.fromBufferAttribute(h,f),bn.w=1,_n.w=1,bn.applyMatrix4(Jb),_n.applyMatrix4(Jb),bn.z>d&&_n.z>d)continue;if(bn.z>d){const _=bn.z-_n.z,x=(bn.z-d)/_;bn.lerp(_n,x)}else if(_n.z>d){const _=_n.z-bn.z,x=(_n.z-d)/_;_n.lerp(bn,x)}bn.applyMatrix4(i),_n.applyMatrix4(i),bn.multiplyScalar(1/bn.w),_n.multiplyScalar(1/_n.w),bn.x*=r.x/2,bn.y*=r.y/2,_n.x*=r.x/2,_n.y*=r.y/2,Bn.start.copy(bn),Bn.start.z=0,Bn.end.copy(_n),Bn.end.z=0;const m=Bn.closestPointToPointParameter(Kb,!0);Bn.at(m,aT);const v=vt.lerp(bn.z,_n.z,m),y=v>=-1&&v<=1,b=Kb.distanceTo(aT)<Mh*.5;if(y&&b){Bn.start.fromBufferAttribute(l,f),Bn.end.fromBufferAttribute(h,f),Bn.start.applyMatrix4(o),Bn.end.applyMatrix4(o);const _=new C,x=new C;ba.distanceSqToSegment(Bn.start,Bn.end,x,_),e.push({point:x,pointOnLine:_,distance:ba.origin.distanceTo(x),object:n,face:null,faceIndex:f,uv:null,uv1:null})}}}class mV extends J{constructor(t=new Lk,e=new jC({color:Math.random()*16777215})){super(t,e),this.isLineSegments2=!0,this.type="LineSegments2"}computeLineDistances(){const t=this.geometry,e=t.attributes.instanceStart,i=t.attributes.instanceEnd,s=new Float32Array(2*e.count);for(let o=0,a=0,l=e.count;o<l;o++,a+=2)rT.fromBufferAttribute(e,o),oT.fromBufferAttribute(i,o),s[a]=a===0?0:s[a-1],s[a+1]=s[a]+rT.distanceTo(oT);const r=new I_(s,2,1);return t.setAttribute("instanceDistanceStart",new Ac(r,1,0)),t.setAttribute("instanceDistanceEnd",new Ac(r,1,1)),this}raycast(t,e){const i=this.material.worldUnits,s=t.camera;s===null&&!i&&console.error('LineSegments2: "Raycaster.camera" needs to be set in order to raycast against LineSegments2 while worldUnits is set to false.');const r=t.params.Line2!==void 0&&t.params.Line2.threshold||0;ba=t.ray;const o=this.matrixWorld,a=this.geometry,l=this.material;Mh=l.linewidth+r,a.boundingSphere===null&&a.computeBoundingSphere(),cA.copy(a.boundingSphere).applyMatrix4(o);let h;if(i)h=Mh*.5;else{const d=Math.max(s.near,cA.distanceToPoint(ba.origin));h=lT(s,d,l.resolution)}if(cA.radius+=h,ba.intersectsSphere(cA)===!1)return;a.boundingBox===null&&a.computeBoundingBox(),lA.copy(a.boundingBox).applyMatrix4(o);let u;if(i)u=Mh*.5;else{const d=Math.max(s.near,lA.distanceToPoint(ba.origin));u=lT(s,d,l.resolution)}lA.expandByScalar(u),ba.intersectsBox(lA)!==!1&&(i?pV(this,e):gV(this,s,e))}}class Fk extends Lk{constructor(){super(),this.isLineGeometry=!0,this.type="LineGeometry"}setPositions(t){const e=t.length-3,i=new Float32Array(2*e);for(let s=0;s<e;s+=3)i[2*s]=t[s],i[2*s+1]=t[s+1],i[2*s+2]=t[s+2],i[2*s+3]=t[s+3],i[2*s+4]=t[s+4],i[2*s+5]=t[s+5];return super.setPositions(i),this}setColors(t){const e=t.length-3,i=new Float32Array(2*e);for(let s=0;s<e;s+=3)i[2*s]=t[s],i[2*s+1]=t[s+1],i[2*s+2]=t[s+2],i[2*s+3]=t[s+3],i[2*s+4]=t[s+4],i[2*s+5]=t[s+5];return super.setColors(i),this}fromLine(t){const e=t.geometry;return this.setPositions(e.attributes.position.array),this}}class AV extends mV{constructor(t=new Fk,e=new jC({color:Math.random()*16777215})){super(t,e),this.isLine2=!0,this.type="Line2"}}class GC extends se{}var nu=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};const cT=N("debugwebxr");class Uo extends se{constructor(){super(...arguments);c(this,"movementSpeed",1);c(this,"rotationStep",60);c(this,"useTeleport",!0);c(this,"useTeleportTarget",!1);c(this,"useTeleportFade",!1);c(this,"showRays",!0);c(this,"showHits",!0);c(this,"isXRMovementHandler",!0);c(this,"xrSessionMode","immersive-vr");c(this,"_didApplyRotation",!1);c(this,"_didTeleport",!1);c(this,"_lines",[]);c(this,"_hitDiscs",[]);c(this,"_hitDistances",[]);c(this,"hitPointRaycastFilter",e=>e.type==="SkinnedMesh"?"continue in children":!0)}onUpdateXR(e){const i=e.xr.rig;if(!(i!=null&&i.gameObject)||e.xr.isPassThrough)return;const s=e.xr.leftController,r=e.xr.rightController;s&&this.onHandleMovement(s,i.gameObject),r&&(this.onHandleRotation(r,i.gameObject),this.useTeleport&&this.onHandleTeleport(r,i.gameObject))}onLeaveXR(e){for(const i of this._lines)i.removeFromParent();for(const i of this._hitDiscs)i==null||i.removeFromParent()}onBeforeRender(){var e;(e=this.context.xr)!=null&&e.running&&(this.showRays&&this.renderRays(this.context.xr),this.showHits&&this.renderHits(this.context.xr))}onHandleMovement(e,i){const s=e.getStick("xr-standard-thumbstick"),r=new C(s.x,0,s.y);r.multiplyScalar(this.context.time.deltaTimeUnscaled*this.movementSpeed);const o=ai(i);r.multiplyScalar(o.x),r.applyQuaternion(e.xr.poseOrientation),r.y=0,r.applyQuaternion(i.worldQuaternion),i.position.add(r),i.updateMatrixWorld()}onHandleRotation(e,i){const r=e.getStick("xr-standard-thumbstick").x;if(this._didApplyRotation)Math.abs(r)<.3&&(this._didApplyRotation=!1);else if(Math.abs(r)>.5){this._didApplyRotation=!0;const o=r>0?1:-1;i.rotateY(o*Ae.toRadians(this.rotationStep))}}onHandleTeleport(e,i){var r;const s=e.getStick("xr-standard-thumbstick");if(this._didTeleport)s.y<.2&&(this._didTeleport=!1);else if(s.y>.8){this._didTeleport=!0;const o=this.context.physics.raycastFromRay(e.ray)[0];if(o){if(this.useTeleportTarget&&!z.getComponentInParent(o.object,GC))return;cT&&De.DrawSphere(o.point,.025,16711680,5);const a=o.point.clone();this.useTeleportFade?(r=e.xr.fadeTransition())==null||r.then(()=>{i.worldPosition=a}):i.worldPosition=a}}}renderRays(e){for(let i=0;i<this._lines.length;i++){const s=this._lines[i];s&&(s.visible=!1)}for(let i=0;i<e.controllers.length;i++){const s=e.controllers[i];let r=this._lines[i];if(!s.connected||!s.isTracking||!s.ray||s.targetRayMode==="transient-pointer"||!s.hasSelectEvent){r&&(r.visible=!1);continue}r||(r=this.createRayLineObject(),r.scale.z=.5,this._lines[i]=r),s.updateRayWorldPosition(),s.updateRayWorldQuaternion();const o=s.rayWorldPosition,a=s.rayWorldQuaternion;r.position.copy(o),r.quaternion.copy(a);const l=e.rigScale,h=this._hitDistances[i]??1;r.scale.set(l,l,h),r.visible=!0,r.layers.disableAll(),r.layers.enable(2),r.parent!==this.context.scene&&this.context.scene.add(r)}}renderHits(e){for(const i of this._hitDiscs)i&&(i.visible=!1);for(let i=0;i<e.controllers.length;i++){const s=e.controllers[i];if(!s.connected||!s.isTracking||!s.ray||!s.hasSelectEvent)continue;if(this.context.time.frame%2!==0){const a=this._hitDiscs[i];a&&a.hit&&(a.visible=!0);continue}const r=this.context.physics.raycastFromRay(s.ray,{testObject:this.hitPointRaycastFilter})[0];this._hitDistances[i]=r==null?void 0:r.distance;let o=this._hitDiscs[i];if(o&&(o.hit=r),r){const a=e.rigScale??1;cT&&(De.DrawWireSphere(r.point,.025*a,16711680),De.DrawLabel(Pi(0,.2,0).add(r.point),r.object.name,.02,0)),o||(o=this.createHitPointObject(),this._hitDiscs[i]=o),o.visible=!0;const l=.01*(a+r.distance);if(o.scale.set(l,l,l),o.layers.disableAll(),o.layers.enable(2),o.hit=r,r.normal){const h=.02*a;o.position.set(0,0,-.1*h).applyQuaternion(s.rayWorldQuaternion),o.position.add(r.point);const u=r.normal.applyQuaternion(Nt(r.object));o.quaternion.setFromUnitVectors(vV,u)}else o.position.add(r.point);o.parent!==this.context.scene&&this.context.scene.add(o)}else this._hitDiscs[i]&&(this._hitDiscs[i].visible=!1)}}createHitPointObject(){var e=new re;const i=new J(new E_(.3,.5,32).rotateX(-Math.PI/2),new St({color:15658734,opacity:.7,transparent:!0,side:pi}));i.layers.disableAll(),i.layers.enable(2),e.add(i);const s=new J(new E_(.43,.5,32).rotateX(-Math.PI/2),new St({color:0,opacity:.2,transparent:!0,side:pi}));return s.layers.disableAll(),s.layers.enable(2),s.position.y=.01,e.add(s),e}createRayLineObject(){const e=new AV;e.layers.disableAll(),e.layers.enable(2);const i=new Fk;e.geometry=i;const s=new Float32Array(9);s.set([0,0,.02,0,0,.4,0,0,1]),i.setPositions(s);const r=new Float32Array(9);r.set([1,1,1,.1,.1,.1,0,0,0]),i.setColors(r);const o=new jC({color:16777215,vertexColors:!0,worldUnits:!0,linewidth:.004,transparent:!0,blending:cy,dashed:!1,alphaToCoverage:!0});return e.material=o,e}}nu([A()],Uo.prototype,"movementSpeed",void 0);nu([A()],Uo.prototype,"rotationStep",void 0);nu([A()],Uo.prototype,"useTeleport",void 0);nu([A()],Uo.prototype,"useTeleportTarget",void 0);nu([A()],Uo.prototype,"useTeleportFade",void 0);nu([A()],Uo.prototype,"showRays",void 0);nu([A()],Uo.prototype,"showHits",void 0);const vV=new C(0,1,0),LS=class{constructor(){c(this,"_quicklookButton");c(this,"_arButton");c(this,"_vrButton");c(this,"_sendToQuestButton")}static create(){return new LS}static getOrCreate(){return this._instance||(this._instance=this.create()),this._instance}get isSecureConnection(){return window.location.protocol==="https:"}get quicklookButton(){return this._quicklookButton}get arButton(){return this._arButton}get vrButton(){return this._vrButton}get sendToQuestButton(){return this._sendToQuestButton}get qrButton(){return Sa.getOrCreate().createQRCode()}createQuicklookButton(){if(this._quicklookButton)return this._quicklookButton;const t=document.createElement("button");return this._quicklookButton=t,t.dataset.needle="quicklook-button",t.innerText="Open in Quicklook",t.prepend(Xr("view_in_ar")),t.addEventListener("click",()=>{const e=z.findObjectOfType(li);e?(t.classList.add("this-mode-is-requested"),e.exportAndOpen().then(()=>{t.classList.remove("this-mode-is-requested")}).catch(i=>{t.classList.remove("this-mode-is-requested"),console.error(i)})):console.warn("No USDZExporter component found in the scene")}),this.hideElementDuringXRSession(t),t}createARButton(t){var s;if(this._arButton)return this._arButton;const e="immersive-ar",i=document.createElement("button");return this._arButton=i,i.classList.add("webxr-button"),i.dataset.needle="webxr-ar-button",i.innerText="Enter AR",i.prepend(Xr("view_in_ar")),i.title="Click to start an AR session",i.addEventListener("click",()=>Me.start(e,t)),this.updateSessionSupported(i,e),this.listenToXRSessionState(i,e),this.hideElementDuringXRSession(i),this.isSecureConnection||(i.disabled=!0,i.title="WebXR requires a secure connection (HTTPS)"),md()||(s=navigator.xr)==null||s.addEventListener("devicechange",()=>this.updateSessionSupported(i,e)),i}createVRButton(t){var s;if(this._vrButton)return this._vrButton;const e="immersive-vr",i=document.createElement("button");return this._vrButton=i,i.classList.add("webxr-button"),i.dataset.needle="webxr-vr-button",i.innerText="Enter VR",i.prepend(Xr("panorama_photosphere")),i.title="Click to start a VR session",i.addEventListener("click",()=>Me.start(e,t)),this.updateSessionSupported(i,e),this.listenToXRSessionState(i,e),this.hideElementDuringXRSession(i),this.isSecureConnection||(i.disabled=!0,i.title="WebXR requires a secure connection (HTTPS)"),md()||(s=navigator.xr)==null||s.addEventListener("devicechange",()=>this.updateSessionSupported(i,e)),i}createSendToQuestButton(){var i;if(this._sendToQuestButton)return this._sendToQuestButton;const t="https://oculus.com/open_url/?url=",e=document.createElement("button");return this._sendToQuestButton=e,e.dataset.needle="webxr-sendtoquest-button",e.innerText="Open on Quest",e.prepend(Xr("share_windows")),e.title="Click to send this page to the Oculus Browser on your Quest",e.addEventListener("click",()=>{const s=encodeURIComponent(window.location.href),r=t+s;window.open(r)==null&&Ci("This page doesn't allow popups. Please paste "+r+" into your browser.")}),this.listenToXRSessionState(e),this.hideElementDuringXRSession(e),md()||(i=navigator.xr)==null||i.addEventListener("devicechange",()=>{var s;(s=navigator.xr)!=null&&s.isSessionSupported("immersive-vr")?e.style.display="none":e.style.display=""}),e}createQRCode(){return Sa.getOrCreate().createQRCode()}updateSessionSupported(t,e){if(!("xr"in navigator)){t.style.display="none";return}Me.isSessionSupported(e).then(i=>{t.style.display=i?"":"none",xe()&&!i&&console.log('[WebXR] "'+e+'" is not supported on this device â€“ make sure your server runs using HTTPS and you have a device connected that supports '+e)})}hideElementDuringXRSession(t){aC(e=>{t["previous-display"]=t.style.display,t.style.display="none"}),HM(e=>{t["previous-display"]!=null&&(t.style.display=t["previous-display"])})}listenToXRSessionState(t,e){e&&(Me.onSessionRequestStart(i=>{i.mode===e?t.classList.add("this-mode-is-requested"):(t["was-disabled"]=t.disabled,t.disabled=!0,t.classList.add("other-mode-is-requested"))}),Me.onSessionRequestEnd(i=>{t.classList.remove("this-mode-is-requested"),t.classList.remove("other-mode-is-requested"),t.disabled=t["was-disabled"]}))}};let Dh=LS;c(Dh,"_instance");var yV=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};const hA=N("debugwebxr"),bV=N("debugusdz");class l0 extends se{constructor(){super(...arguments);c(this,"createVRButton",!0);c(this,"createARButton",!0);c(this,"createSendToQuestButton",!0);c(this,"createQRCode",!0);c(this,"useDefaultControls",!0);c(this,"showControllerModels",!0);c(this,"showHandModels",!0);c(this,"usePlacementReticle",!0);c(this,"usePlacementAdjustment",!0);c(this,"arSceneScale",1);c(this,"useXRAnchor",!1);c(this,"useQuicklookExport",!1);c(this,"useDepthSensing",!1);c(this,"defaultAvatar");c(this,"_playerSync");c(this,"_createdComponentsInSession",[]);c(this,"_usdzExporter");c(this,"_previousXRState",0);c(this,"onAvatarSpawned",e=>{hA&&console.log("WebXR.onAvatarSpawned",e),z.getOrAddComponent(e,Yd)});c(this,"_buttonFactory");c(this,"_buttons",[])}awake(){Me.getXRSync(this.context)}onEnable(){var e,i;window.location.protocol!=="https:"&&Yt('<a href="https://developer.mozilla.org/en-US/docs/Web/API/WebXR_Device_API" target="_blank">WebXR</a> only works on secure connections (https).'),this.useQuicklookExport&&(z.findObjectOfType(li)||(hA&&console.log("WebXR: Adding USDZExporter"),this._usdzExporter=z.addComponent(this.gameObject,li),this._usdzExporter.objectToExport=this.context.scene,this._usdzExporter.autoExportAnimations=!0,this._usdzExporter.autoExportAudioSources=!0)),this.handleCreatingHTML(),this.handleOfferSession(),this.defaultAvatar&&(this._playerSync=this.gameObject.getOrAddComponent(Hg),this._playerSync.autoSync=!1),this._playerSync&&(this._playerSync.asset=this.defaultAvatar,(e=this._playerSync.onPlayerSpawned)==null||e.removeEventListener(this.onAvatarSpawned),(i=this._playerSync.onPlayerSpawned)==null||i.addEventListener(this.onAvatarSpawned))}onDisable(){var e;(e=this._usdzExporter)==null||e.destroy(),this.removeButtons()}async handleOfferSession(){return this.createVRButton&&await Me.isVRSupported()&&this.createVRButton?Me.offerSession("immersive-vr","default",this.context):this.createARButton&&await Me.isARSupported()&&this.createARButton?Me.offerSession("immersive-ar","default",this.context):!1}get session(){return Me.active??null}get sessionMode(){return Me.activeMode??null}async enterVR(e){return Me.start("immersive-vr",e,this.context)}async enterAR(e){return Me.start("immersive-ar",e,this.context)}exitXR(){Me.stop()}onBeforeXR(e,i){e=="immersive-ar"&&this.useDepthSensing&&(i.optionalFeatures=i.optionalFeatures||[],i.optionalFeatures.push("depth-sensing"))}async onEnterXR(e){hA&&console.log("WebXR onEnterXR"),this._previousXRState=ss.Global.Mask;const i=e.xr.isVR;if(ss.Global.Set(i?Kr.VR:Kr.AR),this.usePlacementReticle&&e.xr.isAR){let r=z.findObjectOfType(Xs);if(r)hA&&console.log("WebXR: WebARSessionRoot already exists, not creating a new one");else{const o=new re;for(const a of this.context.scene.children)o.add(a);this.context.scene.add(o),r=z.addNewComponent(o,Xs),this._createdComponentsInSession.push(r),r.arScale=this.arSceneScale,r.arTouchTransform=this.usePlacementAdjustment,r.useXRAnchor=this.useXRAnchor}}this.useDefaultControls&&this.setDefaultMovementEnabled(!0),(this.showControllerModels||this.showHandModels)&&this.setDefaultControllerRenderingEnabled(!0);let s=z.findObjectOfType(Sv);s||(s=this.gameObject.addNewComponent(Sv)),this.createLocalAvatar(e.xr)}onLeaveXR(e){var i;ss.Global.Set(this._previousXRState),(i=this._playerSync)==null||i.destroyInstance();for(const s of this._createdComponentsInSession)s.destroy();this._createdComponentsInSession.length=0,this.handleOfferSession()}setDefaultMovementEnabled(e){let i=this.gameObject.getComponent(Uo);return!i&&e&&(i=this.gameObject.addComponent(Uo),this._createdComponentsInSession.push(i)),i&&(i.enabled=e),i}setDefaultControllerRenderingEnabled(e){let i=this.gameObject.getComponent(Rl);return!i&&e&&(i=this.gameObject.addComponent(Rl),this._createdComponentsInSession.push(i),i.createControllerModel=this.showControllerModels,i.createHandModel==this.showHandModels),i&&(i.enabled=e),i}async createLocalAvatar(e){this._playerSync&&e.running&&(this._playerSync.asset=this.defaultAvatar,await this._playerSync.getInstance())}getButtonsContainer(){return this.getButtonsFactory()}getButtonsFactory(){return this._buttonFactory||(this._buttonFactory=Dh.getOrCreate()),this._buttonFactory}handleCreatingHTML(){if(this.createARButton||this.createVRButton||this.useQuicklookExport){if((Td()&&dp()||bV)&&this.useQuicklookExport){const i=z.findObjectOfType(li);if(!i||i&&i.allowCreateQuicklookButton){const s=this.getButtonsFactory().createQuicklookButton();this.addButton(s,50)}}if(this.createARButton){const i=this.getButtonsFactory().createARButton();this.addButton(i,50)}if(this.createVRButton){const i=this.getButtonsFactory().createVRButton();this.addButton(i,50)}}if(this.createSendToQuestButton&&!Ax()&&Me.isVRSupported().then(i=>{if(!i){const s=this.getButtonsFactory().createSendToQuestButton();this.addButton(s,50)}}),this.createQRCode&&!No()){const i=tk(Fl);i&&i.createQRCodeButton===!1?xe()&&console.warn("WebXR: QRCode button is disabled in the Needle Menu component"):Me.isXRSupported().then(s=>{if(Id()||!s){const r=Sa.getOrCreate().createQRCode();this.addButton(r,50)}})}}addButton(e,i){this._buttons.push(e),e.setAttribute("priority",i.toString()),this.context.menu.appendChild(e)}removeButtons(){for(const e of this._buttons)e.remove();this._buttons.length=0}}yV([A(it)],l0.prototype,"defaultAvatar",void 0);class HC{get extensionName(){return"Physics"}onExportObject(t,e,i){const s=z.getComponents(t,Pt).filter(l=>l.enabled),r=z.getComponents(t,ro).filter(l=>l.enabled&&!l.isTrigger);let o=s.length>0?s[0]:null;const a=r.length>0?r[0]:null;a&&!o&&(o=new Pt,o.isKinematic=!0),o&&e.addEventListener("serialize",(l,h)=>{var u,d,f;if(o){if(l.appendLine(),l.beginBlock('def RealityKitComponent "RigidBody"',"{",!0),o.useGravity||l.appendLine("bool gravityEnabled = 0"),l.appendLine('uniform token info:id = "RealityKit.RigidBody"'),o.isKinematic&&l.appendLine('token motionType = "Kinematic"'),l.beginBlock('def RealityKitStruct "massFrame"',"{",!0),l.appendLine(`float m_mass = ${o.mass}`),l.beginBlock('def RealityKitStruct "m_pose"',"{",!0),l.appendLine(`float3 position = (${o.centerOfMass.x}, ${o.centerOfMass.y}, ${o.centerOfMass.z})`),l.closeBlock("}"),l.closeBlock("}"),r.length>0){const p=r[0];l.beginBlock('def RealityKitStruct "material"',"{",!0);const g=p.sharedMaterial;g&&g.dynamicFriction!==void 0&&l.appendLine(`double dynamicFriction = ${(u=p.sharedMaterial)==null?void 0:u.dynamicFriction}`),g&&g.bounciness!==void 0&&l.appendLine(`double restitution = ${(d=p.sharedMaterial)==null?void 0:d.bounciness}`),g&&g.staticFriction!==void 0&&l.appendLine(`double staticFriction = ${(f=p.sharedMaterial)==null?void 0:f.staticFriction}`),l.closeBlock("}")}l.closeBlock("}")}}),a&&(e.addEventListener("serialize",(l,h)=>{var f;l.beginBlock('def RealityKitComponent "Collider"',"{",!0),l.appendLine("uint group = 1"),l.appendLine('uniform token info:id = "RealityKit.Collider"'),l.appendLine("uint mask = 4294967295");const d=a.isTrigger?"Trigger":"Default";if(l.appendLine(`token type = "${d}"`),l.beginBlock('def RealityKitStruct "Shape"',"{",!0),a instanceof Wg){const p=a;l.appendLine('token shapeType = "Sphere"'),l.appendLine(`float radius = ${p.radius}`)}else if(a instanceof qg){const p=a;l.appendLine('token shapeType = "Box"'),l.appendLine(`float3 extent = (${p.size.x}, ${p.size.y}, ${p.size.z})`)}else if(a instanceof Oc){const p=a;l.appendLine('token shapeType = "Capsule"'),l.appendLine(`float radius = ${p.radius}`),l.appendLine(`float height = ${p.height}`)}else if(a instanceof Zd&&((f=a.sharedMesh)!=null&&f.geometry)){const p=a.sharedMesh.geometry;p.boundingBox||p.computeBoundingBox();const g=a.sharedMesh.geometry.boundingBox;g&&(l.appendLine('token shapeType = "Box"'),l.appendLine(`float3 extent = (${g.max.x-g.min.x}, ${g.max.y-g.min.y}, ${g.max.z-g.min.z})`),console.log("[USDZ] Only Box, Sphere, and Capsule colliders are supported in visionOS/iOS. MeshCollider will be exported as Box",a))}else console.warn("[USDZ] Only Box, Sphere, and Capsule colliders are supported in visionOS/iOS. Ignoring collider:",a);l.beginBlock('def RealityKitStruct "pose"',"{",!0),l.closeBlock("}"),l.closeBlock("}"),l.closeBlock("}")}),r.length>1&&console.log("WARNING: Multiple colliders detected. visionOS / iOS can only support objects with a single collider, only exporting the first collider: ",a))}}var Ul=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};const th=N("debugtext");var tt;(function(n){n[n.UpperLeft=0]="UpperLeft",n[n.UpperCenter=1]="UpperCenter",n[n.UpperRight=2]="UpperRight",n[n.MiddleLeft=3]="MiddleLeft",n[n.MiddleCenter=4]="MiddleCenter",n[n.MiddleRight=5]="MiddleRight",n[n.LowerLeft=6]="LowerLeft",n[n.LowerCenter=7]="LowerCenter",n[n.LowerRight=8]="LowerRight"})(tt||(tt={}));var kp;(function(n){n[n.Truncate=0]="Truncate",n[n.Overflow=1]="Overflow"})(kp||(kp={}));var Op;(function(n){n[n.Wrap=0]="Wrap",n[n.Overflow=1]="Overflow"})(Op||(Op={}));var zs;(function(n){n[n.Normal=0]="Normal",n[n.Bold=1]="Bold",n[n.Italic=2]="Italic",n[n.BoldAndItalic=3]="BoldAndItalic"})(zs||(zs={}));class ks extends wl{constructor(){super(...arguments);c(this,"alignment",tt.UpperLeft);c(this,"verticalOverflow",kp.Truncate);c(this,"horizontalOverflow",Op.Wrap);c(this,"lineSpacing",1);c(this,"supportRichText",!1);c(this,"font");c(this,"fontStyle",zs.Normal);c(this,"sRGBTextColor",new we(1,0,1));c(this,"_text","");c(this,"_fontSize",12);c(this,"_textMeshUi",null);c(this,"_didHandleTextRenderOnTop",!1)}setAlphaFactor(e){var i;super.setAlphaFactor(e),(i=this.uiObject)==null||i.set({fontOpacity:this.color.alpha*this.alphaFactor}),this.markDirty()}get text(){return this._text}set text(e){e!==this._text&&(this._text=e,this.feedText(this.text,this.supportRichText),this.markDirty())}set_text(e){this.text=e}get fontSize(){return this._fontSize}set fontSize(e){var i;this._fontSize=e,(i=this.uiObject)==null||i.set({fontSize:e})}onColorChanged(){var e;this.sRGBTextColor.copy(this.color),this.sRGBTextColor.convertLinearToSRGB(),(e=this.uiObject)==null||e.set({color:this.sRGBTextColor,fontOpacity:this.color.alpha})}onParentRectTransformChanged(){super.onParentRectTransformChanged(),this.uiObject&&this.updateOverflow()}onBeforeCanvasRender(e){this.updateOverflow()}updateOverflow(){var i;const e=(i=this.uiObject)==null?void 0:i._overflow;e&&(e._needsUpdate=!0,this.markDirty())}onCreate(e){th&&console.log(this),this.horizontalOverflow==Op.Overflow&&(e.whiteSpace="pre"),this.verticalOverflow==kp.Truncate&&(this.context.renderer.localClippingEnabled=!0,e.overflow="hidden"),this.horizontalOverflow==Op.Overflow&&this.verticalOverflow==kp.Truncate,e.lineHeight=this.lineSpacing,delete e.backgroundOpacity,delete e.backgroundColor,th&&(e.backgroundColor=16750848,e.backgroundOpacity=.5);const i=this.rectTransform;e={...e,...this.getTextOpts()},this.getAlignment(e),th&&(e.backgroundColor=Math.random()*16777215,e.backgroundOpacity=.1),this.uiObject=i.createNewText(e),this.feedText(this.text,this.supportRichText)}onAfterAddedToScene(){super.onAfterAddedToScene(),this.handleTextRenderOnTop()}getTextOpts(){const e=this.fontSize,i={color:this.color,fontOpacity:this.color.alpha,fontSize:e,fontKerning:"normal"};return this.setFont(i,this.fontStyle),i}onEnable(){var e;super.onEnable(),this._didHandleTextRenderOnTop=!1,this.uiObject&&this.uiObject.addAfterUpdate(()=>{this.setShadowComponentOwner(this.uiObject),this.markDirty()}),setTimeout(()=>this.markDirty(),10),(e=this.canvas)==null||e.registerEventReceiver(this)}onDisable(){var e;super.onDisable(),(e=this.canvas)==null||e.unregisterEventReceiver(this)}getAlignment(e){switch(e.flexDirection="column",this.alignment){case tt.UpperLeft:case tt.MiddleLeft:case tt.LowerLeft:e.textAlign="left";break;case tt.UpperCenter:case tt.MiddleCenter:case tt.LowerCenter:e.textAlign="center";break;case tt.UpperRight:case tt.MiddleRight:case tt.LowerRight:e.textAlign="right";break}switch(this.alignment){default:case tt.UpperLeft:case tt.UpperCenter:case tt.UpperRight:e.alignItems="start";break;case tt.MiddleLeft:case tt.MiddleCenter:case tt.MiddleRight:e.alignItems="center";break;case tt.LowerLeft:case tt.LowerCenter:case tt.LowerRight:e.alignItems="end";break}return e}feedText(e,i){var s,r,o;if(th&&console.log("feedText",this.uiObject,e,i),!!this.uiObject)if(this._textMeshUi||(this._textMeshUi=[]),this.uiObject.children.length=0,!i||e.length===0)this.uiObject.textContent=e;else{let a=this.getNextTag(e);if(a){if(a.startIndex>0){for(let u=this.uiObject.children.length-1;u>=0;u--){const d=this.uiObject.children[u];d.isUI&&(this.uiObject.remove(d),d.clear())}const h=new EA({textContent:e.substring(0,a.startIndex),color:"inherit"});this.uiObject.add(h)}}else{this.uiObject.textContent="",this.setOptions({textContent:e});return}const l=[];for(;a;){const h=this.getNextTag(e,a.endIndex),u={fontFamily:(s=this.uiObject)==null?void 0:s.get("fontFamily"),color:"inherit",textContent:""};if(h){u.textContent=this.getText(e,a,h),this.handleTag(a,u,l);const d=new EA(u);(r=this.uiObject)==null||r.add(d)}else{u.textContent=e.substring(a.endIndex),this.handleTag(a,u,l);const d=new EA(u);(o=this.uiObject)==null||o.add(d)}a=h}}}handleTextRenderOnTop(){this._didHandleTextRenderOnTop||(this._didHandleTextRenderOnTop=!0,this.startCoroutine(this.renderOnTopCoroutine()))}*renderOnTopCoroutine(){if(!this.canvas)return;const e=[],i=this.canvas,s={renderOnTop:i.renderOnTop,depthWrite:i.depthWrite,doubleSided:i.doubleSided};for(;;){let r=!1;if(this._textMeshUi)for(let o=0;o<this._textMeshUi.length;o++){if(e[o]===!0)continue;r=!0;const a=this._textMeshUi[o];a.textContent&&(Ev(a,s),e[o]=!0)}if(!r)break;yield}}handleTag(e,i,s){if(!e.isEndTag){if(e.type.includes("color")){const r=new Zb(e,{color:i.color});if(s.push(r),e.type.length>6){const o=parseInt("0x"+e.type.substring(7));i.color=o}else i.color=new we(1,1,1)}else if(e.type=="b"){this.setFont(i,zs.Bold);const r=new Zb(e,{fontWeight:700});s.push(r)}else if(e.type=="i"){this.setFont(i,zs.Italic);const r=new Zb(e,{fontStyle:"italic"});s.push(r)}}}getText(e,i,s){return e.substring(i.endIndex,s.startIndex)}getNextTag(e,i=0){const s=e.indexOf("<",i),r=e.indexOf(">",s);if(s>=0&&r>=0){const o=e.substring(s+1,r);return{type:o,startIndex:s,endIndex:r+1,isEndTag:o.startsWith("/")}}return null}setFont(e,i){if(!this.font)return;const s=this.font,r=this.getFamilyNameWithCorrectSuffix(s,i);th&&console.log("Selected font family:"+r);let o=O_.getFontFamily(r);switch(o||(o=O_.addFontFamily(r)),e.fontFamily=o,i){default:case zs.Normal:e.fontWeight=400,e.fontStyle="normal";break;case zs.Bold:e.fontWeight=700,e.fontStyle="normal";break;case zs.Italic:e.fontWeight=400,e.fontStyle="italic";break;case zs.BoldAndItalic:e.fontStyle="italic",e.fontWeight=400}let a=o.getVariant(e.fontWeight,e.fontStyle);if(!a){let l=r;l!=null&&l.endsWith("-msdf.json")||(l+="-msdf.json");let h=r;h!=null&&h.endsWith(".png")||(h+=".png"),a=o.addVariant(e.fontWeight,e.fontStyle,l,h),a==null||a.addEventListener("ready",()=>{this.markDirty()})}}getFamilyNameWithCorrectSuffix(e,i){var u;const s=e.lastIndexOf("-");if(s<0)return e;const r=(u=e.substring(s+1))==null?void 0:u.toLowerCase();if(_V.includes(r))return th&&console.warn("Unsupported font style: "+r),e;const o=e.lastIndexOf("/");let a=e;o>=0&&(a=a.substring(o+1));const l=a[0]===a[0].toUpperCase(),h=e.substring(0,s);switch(th&&console.log("Select font: ",e,zs[i],a,l,h),i){case zs.Normal:return l?h+"-Regular":h+"-regular";case zs.Bold:return l?h+"-Bold":h+"-bold";case zs.Italic:return l?h+"-Italic":h+"-italic";case zs.BoldAndItalic:return l?h+"-BoldItalic":h+"-bolditalic";default:return e}}}Ul([A()],ks.prototype,"alignment",void 0);Ul([A()],ks.prototype,"verticalOverflow",void 0);Ul([A()],ks.prototype,"horizontalOverflow",void 0);Ul([A()],ks.prototype,"lineSpacing",void 0);Ul([A()],ks.prototype,"supportRichText",void 0);Ul([A(URL)],ks.prototype,"font",void 0);Ul([A()],ks.prototype,"fontStyle",void 0);Ul([A()],ks.prototype,"text",null);Ul([A()],ks.prototype,"fontSize",null);class Zb{constructor(t,e){c(this,"tag");c(this,"previousValues");this.tag=t,this.previousValues=e}}const _V=["medium","mediumitalic","black","blackitalic","thin","thinitalic","extrabold","light","lightitalic","semibold"];var Lp;(function(n){n.singleLine="singleLine",n.hardBreaks="hardBreaks",n.flowing="flowing"})(Lp||(Lp={}));var ed;(function(n){n.left="left",n.center="center",n.right="right",n.justified="justified"})(ed||(ed={}));var td;(function(n){n.top="top",n.middle="middle",n.lowerMiddle="lowerMiddle",n.baseline="baseline",n.bottom="bottom"})(td||(td={}));class Ah{constructor(t){c(this,"id");c(this,"content","");c(this,"font",[]);c(this,"pointSize",144);c(this,"width");c(this,"height");c(this,"depth");c(this,"wrapMode");c(this,"horizontalAlignment");c(this,"verticalAlignment");c(this,"material");this.id=t}static getId(){return this.global_id++}setDepth(t){return this.depth=t,this}setPointSize(t){return this.pointSize=t,this}setHorizontalAlignment(t){return this.horizontalAlignment=t,this}setVerticalAlignment(t){return this.verticalAlignment=t,this}writeTo(t,e){var s;e.beginBlock(`def Preliminary_Text "${this.id}"`,"(",!1),e.appendLine('prepend apiSchemas = ["MaterialBindingAPI"]'),e.closeBlock(")"),e.beginBlock(),this.content&&e.appendLine(`string content = "${this.content}"`),(!this.font||this.font.length<=0)&&(this.font||(this.font=[]),(s=this.font)==null||s.push("sans-serif"));const i=this.font.map(r=>`"${r}"`).join(", ");e.appendLine(`string[] font = [ ${i} ]`),e.appendLine(`double pointSize = ${this.pointSize}`),typeof this.width=="number"&&e.appendLine(`double width = ${this.width}`),typeof this.height=="number"&&e.appendLine(`double height = ${this.height}`),typeof this.depth=="number"&&e.appendLine(`double depth = ${this.depth}`),this.wrapMode&&e.appendLine(`token wrapMode = "${this.wrapMode}"`),this.horizontalAlignment&&e.appendLine(`token horizontalAlignment = "${this.horizontalAlignment}"`),this.verticalAlignment&&e.appendLine(`token verticalAlignment = "${this.verticalAlignment}"`),this.material!==void 0&&e.appendLine(`rel material:binding = </StageRoot/Materials/${Kx(this.material)}>`),e.closeBlock()}}c(Ah,"global_id",0);class VC{static singleLine(t,e,i){const s=new Ah("text_"+Ah.getId());return s.content=t,e&&(s.pointSize=e),i&&(s.depth=i),s}static multiLine(t,e,i,s,r,o){const a=new Ah("text_"+Ah.getId());return a.content=t,a.width=e,a.height=i,a.horizontalAlignment=s,a.verticalAlignment=r,o!==void 0&&(a.wrapMode=o),a}}const wV=new ce().makeRotationY(Math.PI),xV=new ce().makeScale(-1,1,-1);class c0{get extensionName(){return"text"}exportText(t,e,i){const s=z.getComponent(t,ks);if(!s)return;const r=z.getComponent(t,jn);let o=100,a=100;r&&(o=r.width,a=r.height),e.matrix=wV.clone(),r&&e.matrix.premultiply(xV);const l=s.color.clone();e.material=new mr({color:l,emissive:l}),e.addEventListener("serialize",(h,u)=>{let d=s.text;d=d.replace(/\r/g,""),d=d.replace(/\n/g,"\\n");const f=VC.multiLine(d,o,a,ed.center,td.bottom,Lp.flowing);this.setTextAlignment(f,s.alignment),this.setOverflow(f,s),e.material&&(f.material=e.material),f.pointSize=this.convertToTextSize(s.fontSize),f.depth=.001,f.writeTo(void 0,h)})}convertToTextSize(t){return 1/.0502*144*t}setOverflow(t,e){e.horizontalOverflow?t.wrapMode=Lp.singleLine:t.wrapMode=Lp.flowing}setTextAlignment(t,e){switch(e){case tt.LowerLeft:case tt.MiddleLeft:case tt.UpperLeft:t.horizontalAlignment=ed.left;break;case tt.LowerCenter:case tt.MiddleCenter:case tt.UpperCenter:t.horizontalAlignment=ed.center;break;case tt.LowerRight:case tt.MiddleRight:case tt.UpperRight:t.horizontalAlignment=ed.right;break}switch(e){case tt.LowerLeft:case tt.LowerCenter:case tt.LowerRight:t.verticalAlignment=td.bottom;break;case tt.MiddleLeft:case tt.MiddleCenter:case tt.MiddleRight:t.verticalAlignment=td.middle;break;case tt.UpperLeft:case tt.UpperCenter:case tt.UpperRight:t.verticalAlignment=td.top;break}}}class WC{get extensionName(){return"tmui"}onExportObject(t,e,i){const s=z.getComponent(t,fn);if(s&&s.enabled&&s.renderMode===ua.WorldSpace){const r=new c0,o=z.getComponent(t,jn),a=z.getComponent(t,zh),l=new Array;if(o){if(!z.isActiveSelf(t)){const d=z.isActiveSelf(t);z.setActive(t,!0),o.onEnable(),o.updateTransform(),l.push(()=>{o.onDisable(),z.setActive(t,d)})}t.traverse(d=>{if(!z.isActiveInHierarchy(d)){const f=z.isActiveSelf(d);z.setActive(d,!0);const p=z.getComponent(d,Fo);p&&(p.onEnable(),l.push(()=>{p.onDisable()}));const g=z.getComponent(d,jn);g&&(g.onEnable(),g.updateTransform(),g.onApplyTransform(),l.push(()=>{g.onDisable()}));const m=z.getComponent(d,ks);m&&(m.onEnable(),l.push(()=>{m.onDisable()})),l.push(()=>{z.setActive(d,f)})}}),o.width,o.height;const h=rs.createEmpty(),u=o.shadowComponent;if(e.add(h),u){const d=u.matrix;h.matrix.copy(d);const f=new Map,p=new Map;f.set(u,h),p.set(u,a?a.alpha:1),u.traverse(g=>{if(g===u)return;const m=rs.createEmpty();m.matrix.copy(g.matrix);const v=g.parent,y=!!v&&typeof v.textContent=="string"&&v.textContent.length>0;let b=p.get(v)||1;const _=z.getComponent(g,zh);if(_&&(b*=_.alpha),g instanceof J&&y){const S=g[Yr];S?r.exportText(S.gameObject,m,i):console.error("Error when exporting UI: shadow component owner not found. This is likely a bug.",g)}if(g instanceof J&&!y){const S=g.geometry.clone();S.scale(1,1,-1),this.flipWindingOrder(S),m.geometry=S;const T=new we,L=g.material.opacity;T.copy(g.material.color),m.material=new St({color:T,opacity:L*b,map:g.material.map,transparent:!0})}f.set(g,m),p.set(g,b);const x=f.get(v);if(!x){console.error("Error when exporting UI: shadow component parent not found!",g,g.parent);return}x.add(m)})}}for(const h of l)h()}}flipWindingOrder(t){const e=t.index.array;for(let i=0,s=e.length/3;i<s;i++){const r=e[i*3];e[i*3]=e[i*3+2],e[i*3+2]=r}t.index.needsUpdate=!0}}const lp=N("debugusdz");function CV(n,t){var a;const e=[],i=z.getComponentsInChildren(n,zn),s=z.getComponentsInChildren(n,Ps),r=new Array,o=new Array;if(t.injectImplicitBehaviours)for(const l of i){if(!l||!l.runtimeAnimatorController||!l.enabled)continue;const h=l.runtimeAnimatorController.activeState;if(!h||!h.motion||!h.motion.clip||((a=h.motion.clip.tracks)==null?void 0:a.length)<1||r.includes(l))continue;const u=new Ia;u.animator=l,u.stateName=h.name,u.trigger="start",u.name="PlayAnimationOnClick_implicitAtStart_"+u.stateName;const d=new re;z.addComponent(d,u),o.push(d),r.push(l),n.add(d)}else for(const l of i){if(!l||!l.runtimeAnimatorController||!l.enabled)continue;lp&&console.log(l);const h=[];for(const u of l.runtimeAnimatorController.enumerateActions()){lp&&console.log(u);const d=u.getClip();h.includes(d)||h.push(d)}e.push({root:l.gameObject,clips:h})}if(t.injectImplicitBehaviours)for(const l of s){if(!l||!l.clip||!l.enabled||!l.playAutomatically||r.includes(l))continue;const h=new Ia;h.animation=l,h.stateName=l.clip.name,h.trigger="start",h.name="PlayAnimationOnClick_implicitAtStart_"+h.stateName;const u=new re;z.addComponent(u,h),o.push(u),r.push(l),n.add(u)}else for(const l of s){lp&&console.log(l);const h=[];for(const u of l.animations)h.includes(u)||h.push(u);e.push({root:l.gameObject,clips:h})}lp&&(e==null?void 0:e.length)>0&&console.log("USDZ Animation Clips without behaviours",e);for(const l of e)for(const h of l.clips)t.registerAnimation(l.root,h);return o}function SV(n,t){const e=z.getComponentsInChildren(n,kt),i=z.getComponentsInChildren(n,jh),s=new Array,r=new Array;lp&&console.log({audioSources:e,playAudioOnClicks:i});for(const o of i){if(!o.target)continue;const a=e.indexOf(o.target);a>-1&&e.splice(a,1)}for(const o of e){if(!o||!o.clip||o.volume<=0||s.includes(o))continue;const a=new jh;a.target=o,a.name="PlayAudioOnClick_implicitAtStart_",a.trigger="start";const l=new re;z.addComponent(l,a),console.log("implicit PlayAudioOnStart",l,a),r.push(l),s.push(o),n.add(l)}return r}function EV(n){return new Ki("DisableAtStart",Ln.sceneStartTrigger(),At.fadeAction(n,0,!1))}function hT(n){const t=n.domElement.shadowRoot.querySelector("link[rel='ar']");if(t)return t;const e=document.createElement("div");e.classList.add("menu"),e.classList.add("quicklook-menu"),e.style.display="none",e.style.visibility="hidden";const i=document.createElement("button");i.id="open-in-ar",i.innerText="Open in QuickLook",e.appendChild(i);const s=document.createElement("a");s.id="needle-usdz-link",s.style.display="none",s.rel="ar",s.href="",e.appendChild(s);const r=document.createElement("img");return r.id="button",s.appendChild(r),n.domElement.shadowRoot.appendChild(e),s}var us=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};const Dr=N("debugusdz");class su{constructor(){c(this,"callToAction");c(this,"checkoutTitle");c(this,"checkoutSubtitle");c(this,"callToActionURL")}}us([A()],su.prototype,"callToAction",void 0);us([A()],su.prototype,"checkoutTitle",void 0);us([A()],su.prototype,"checkoutSubtitle",void 0);us([A()],su.prototype,"callToActionURL",void 0);const sy=class extends se{constructor(){super(...arguments);c(this,"objectToExport");c(this,"autoExportAnimations",!0);c(this,"autoExportAudioSources",!0);c(this,"exportFileName");c(this,"customUsdzFile");c(this,"customBranding");c(this,"anchoringType","plane");c(this,"maxTextureSize",2048);c(this,"planeAnchoringAlignment","horizontal");c(this,"interactive",!0);c(this,"allowCreateQuicklookButton",!0);c(this,"quickLookCompatible",!0);c(this,"extensions",[]);c(this,"link");c(this,"button");c(this,"onClickedOpenInARElement",e=>{e.preventDefault(),this.exportAndOpen()});c(this,"_currentExportTasks",new Map);c(this,"_previousTimeScale",1);c(this,"lastCallback");c(this,"_rootSessionRootWasAppliedTo",null);c(this,"_rootPositionBeforeExport",new C);c(this,"_rootRotationBeforeExport",new ne);c(this,"_rootScaleBeforeExport",new C)}start(){var e,i,s;Dr&&(console.log("USDZExporter",this),console.log("Debug USDZ Mode. Press 'T' to export"),window.addEventListener("keydown",r=>{switch(r.key){case"t":this.exportAsync();break}}),No()&&setTimeout(()=>{this.exportAsync()},2e3)),this.objectToExport||(this.objectToExport=this.gameObject),!((i=(e=this.objectToExport)==null?void 0:e.children)!=null&&i.length)&&!((s=this.objectToExport)!=null&&s.isMesh)&&(this.objectToExport=this.context.scene),this.interactive&&(this.extensions.push(new OC),this.extensions.push(new Zh),this.extensions.push(new HC),this.extensions.push(new c0),this.extensions.push(new WC))}onEnable(){var s;const e=Td(),i=dp();(Dr||e&&i)&&(this.allowCreateQuicklookButton&&(this.button=this.createQuicklookButton()),this.lastCallback=this.quicklookCallback.bind(this),this.link=hT(this.context),this.link.addEventListener("message",this.lastCallback)),Dr&&Ci("USDZ Exporter enabled: "+this.name),(s=document.getElementById("open-in-ar"))==null||s.addEventListener("click",this.onClickedOpenInARElement)}onDisable(){var e,i,s;(e=this.button)==null||e.remove(),(i=this.link)==null||i.removeEventListener("message",this.lastCallback),Dr&&Ci("USDZ Exporter disabled: "+this.name),(s=document.getElementById("open-in-ar"))==null||s.removeEventListener("click",this.onClickedOpenInARElement)}async exportAsync(){return this.exportAndOpen()}async exportAndOpen(){var s;let e=this.exportFileName??((s=this.objectToExport)==null?void 0:s.name)??this.name;if(e+="-"+QQ(),_h()||(e!==""&&(e+="-"),e+="MadeWithNeedle"),this.link||(this.link=hT(this.context)),this.customUsdzFile)return Dr&&console.log("Exporting custom usdz",this.customUsdzFile),this.openInQuickLook(this.customUsdzFile,e),null;if(!this.objectToExport)return console.warn("No object to export",this),null;const i=await this.export(this.objectToExport);return i?(Dr&&console.log("USDZ generation done. Downloading as "+e),this.openInQuickLook(i,e),i):(console.error("USDZ generation failed. Please report a bug",this),null)}async export(e){if(!e)return console.warn("No object to export"),null;const i=this._currentExportTasks.get(e);if(i)return i;const s=this.internalExport(e);return s instanceof Promise?(this._currentExportTasks.set(e,s),s.then(r=>(this._currentExportTasks.delete(e),r)).catch(r=>(this._currentExportTasks.delete(e),console.error("Error during USDZ export â€“ please report a bug!",r),null))):s}async internalExport(e){st.start("export-usdz",{onProgress:_=>{this.dispatchEvent(new CustomEvent("export-progress",{detail:{progress:_}}))}}),st.report("export-usdz",{message:"Starting export",totalSteps:40,currentStep:0}),st.report("export-usdz",{message:"Load progressive textures",autoStep:5}),st.start("export-usdz-textures","export-usdz");const i=z.getComponentsInChildren(e,Go);for(const _ of i)_&&_.enabled&&_.start&&_.start();const s=z.getComponentsInChildren(e,ci),r=new Array;let o=0;for(const _ of s){for(const x of _.sharedMeshes)if(x){const S=ct.assignMeshLOD(x,0);S instanceof Promise&&r.push(new Promise((T,L)=>{S.then(()=>{o++,st.report("export-usdz-textures",{message:"Loaded progressive mesh",currentStep:o,totalSteps:r.length}),T()}).catch(I=>L(I))}))}for(const x of _.sharedMaterials)if(x){const S=ct.assignTextureLOD(x,0);S instanceof Promise&&r.push(new Promise((T,L)=>{S.then(()=>{o++,st.report("export-usdz-textures",{message:"Loaded progressive texture",currentStep:o,totalSteps:r.length}),T()}).catch(I=>L(I))}))}}Dr&&Ci("Progressive Loading: "+r.length),await Promise.all(r),Dr&&Ci("Progressive Loading: done"),st.end("export-usdz-textures");const a=ss.Global.Mask;ss.Global.Set(Kr.AR);const l=new HQ,h=new Hy(this.quickLookCompatible),u=[h,...this.extensions],d={self:this,exporter:l,extensions:u,object:e};st.report("export-usdz","Invoking before-export"),this.dispatchEvent(new CustomEvent("before-export",{detail:d})),this.applyWebARSessionRoot(),this._previousTimeScale=this.context.time.timeScale,this.context.time.timeScale=0,st.report("export-usdz","auto export animations and audio sources");const f=new Array;this.autoExportAnimations&&f.push(...CV(e,h)),this.extensions.find(_=>_.extensionName==="Audio")&&this.autoExportAudioSources&&f.push(...SV(e)),l.debug=Dr,l.keepObject=_=>{const x=z.getComponent(_,ci);return!(x&&!x.enabled)};const g=new Array;this.objectToExport&&this.quickLookCompatible&&this.interactive&&this.objectToExport.traverse(_=>{_.visible||g.push(_)});const m=this.extensions.find(_=>_.extensionName==="Behaviour");this.interactive&&m&&g.length>0&&m.addBehavior(EV(g));let v=!0;this.quickLookCompatible&&!this.interactive&&(v=!1),this.anchoringType!=="plane"&&this.anchoringType!=="none"&&this.anchoringType!=="image"&&this.anchoringType!=="face"&&(this.anchoringType="plane"),this.planeAnchoringAlignment!=="horizontal"&&this.planeAnchoringAlignment!=="vertical"&&this.planeAnchoringAlignment!=="any"&&(this.planeAnchoringAlignment="horizontal"),st.report("export-usdz","Invoking exporter.parse");const y=await l.parse(this.objectToExport,{ar:{anchoring:{type:this.anchoringType},planeAnchoring:{alignment:this.planeAnchoringAlignment}},extensions:u,quickLookCompatible:this.quickLookCompatible,maxTextureSize:this.maxTextureSize,exportInvisible:v}),b=new Blob([y],{type:"model/vnd.usdz+zip"});this.revertWebARSessionRoot(),this.context.time.timeScale=this._previousTimeScale,st.report("export-usdz","Invoking after-export"),this.dispatchEvent(new CustomEvent("after-export",{detail:d}));for(const _ of f)z.destroy(_);return ss.Global.Set(a),st.end("export-usdz"),b}openInQuickLook(e,i){const s=e instanceof Blob?URL.createObjectURL(e):e,r=this.buildQuicklookOverlay();Dr&&console.log("QuickLook Overlay",r);const o=r.callToAction?encodeURIComponent(r.callToAction):"",a=r.checkoutTitle?encodeURIComponent(r.checkoutTitle):"",l=r.checkoutSubtitle?encodeURIComponent(r.checkoutSubtitle):"";this.link.href=s+`#callToAction=${o}&checkoutTitle=${a}&checkoutSubtitle=${l}&callToActionURL=${r.callToActionURL}`,this.lastCallback||(this.lastCallback=this.quicklookCallback.bind(this),this.link.addEventListener("message",this.lastCallback)),this.link.download=i+".usdz",this.link.click()}download(e,i){sy.save(e,i)}static save(e,i){const s=document.createElement("a");s.style.display="none",document.body.appendChild(s),typeof e=="string"?s.href=e:s.href=URL.createObjectURL(e),s.download=i,s.click(),s.remove()}quicklookCallback(e){if((e==null?void 0:e.data)=="_apple_ar_quicklook_button_tapped"){Dr&&Yt("Quicklook closed via call to action button");var i=new CustomEvent("quicklook-button-tapped",{detail:this});if(this.dispatchEvent(i),!i.defaultPrevented){const s=new URLSearchParams(this.link.href);if(s){const r=s.get("callToActionURL");Dr&&Ci("Quicklook url: "+r),r&&(_h()?globalThis.open(r,"_blank"):console.warn("Quicklook closed: custom redirects require a Needle Engine Pro license: https://needle.tools/pricing",r))}}}}buildQuicklookOverlay(){var s,r,o,a,l,h;const e={};return this.customBranding&&Object.assign(e,this.customBranding),_h()||(console.log("Custom Quicklook banner text requires pro license: https://needle.tools/pricing"),e.callToAction="Close",e.checkoutTitle="ðŸŒµ Made with Needle",e.checkoutSubtitle="_"),(((s=e.callToAction)==null?void 0:s.length)||((r=e.checkoutTitle)==null?void 0:r.length)||((o=e.checkoutSubtitle)==null?void 0:o.length))&&((a=e.callToAction)!=null&&a.length||(e.callToAction="\0"),(l=e.checkoutTitle)!=null&&l.length||(e.checkoutTitle="\0"),(h=e.checkoutSubtitle)!=null&&h.length||(e.checkoutSubtitle="\0")),this.dispatchEvent(new CustomEvent("quicklook-overlay",{detail:e})),e}getARScaleAndTarget(){if(!this.objectToExport)return{scale:1,_invertForward:!1,target:this.gameObject,sessionRoot:null};let e=z.getComponentInParent(this.objectToExport,Xs);e||(e=z.getComponentInChildren(this.objectToExport,Xs));let i=1,s=!1;const r=this.objectToExport;if(e)i=e.arScale,s=e.invertForward;else{const l=z.findObjectOfType(l0);l&&(i=l.arSceneScale)}return{scale:1/i,_invertForward:s,target:r,sessionRoot:(e==null?void 0:e.gameObject)??null}}applyWebARSessionRoot(){if(!this.objectToExport)return;const{scale:e,_invertForward:i,target:s,sessionRoot:r}=this.getARScaleAndTarget(),o=r==null?void 0:r.matrixWorld.clone().invert();this._rootSessionRootWasAppliedTo=s,this._rootPositionBeforeExport.copy(s.position),this._rootRotationBeforeExport.copy(s.quaternion),this._rootScaleBeforeExport.copy(s.scale),s.scale.multiplyScalar(e),i&&s.quaternion.multiply(sy.invertForwardQuaternion),s.updateMatrix(),s.updateMatrixWorld(!0),r&&o&&s.matrix.premultiply(o)}revertWebARSessionRoot(){if(!this.objectToExport||!this._rootSessionRootWasAppliedTo)return;const e=this._rootSessionRootWasAppliedTo;e.position.copy(this._rootPositionBeforeExport),e.quaternion.copy(this._rootRotationBeforeExport),e.scale.copy(this._rootScaleBeforeExport),e.updateMatrix(),e.updateMatrixWorld(!0),this._rootSessionRootWasAppliedTo=null}createQuicklookButton(){const i=Dh.getOrCreate().createQuicklookButton();return i.parentNode||this.context.menu.appendChild(i),i}};let li=sy;c(li,"invertForwardMatrix",new ce().makeRotationY(Math.PI)),c(li,"invertForwardQuaternion",new ne().setFromEuler(new fi(0,Math.PI,0)));us([A(re)],li.prototype,"objectToExport",void 0);us([A()],li.prototype,"autoExportAnimations",void 0);us([A()],li.prototype,"autoExportAudioSources",void 0);us([A()],li.prototype,"exportFileName",void 0);us([A(URL)],li.prototype,"customUsdzFile",void 0);us([A(su)],li.prototype,"customBranding",void 0);us([A()],li.prototype,"anchoringType",void 0);us([A()],li.prototype,"maxTextureSize",void 0);us([A()],li.prototype,"planeAnchoringAlignment",void 0);us([A()],li.prototype,"interactive",void 0);us([A()],li.prototype,"allowCreateQuicklookButton",void 0);us([A()],li.prototype,"quickLookCompatible",void 0);class h0 extends se{constructor(){super(...arguments);c(this,"isUsed",!0);c(this,"usedBy",null)}}class Uk extends se{}const uT=N("debugdeletable");class qC extends So{}class Nk extends se{constructor(){super(...arguments);c(this,"deleteBoxes",[])}awake(){this.deleteBoxes=z.findObjectsOfType(qC,this.context)}update(){for(const e of this.deleteBoxes){const i=this.gameObject;if(e.isInBox(i)===!0){const r=z.getComponentInParent(this.gameObject,h0);r?uT&&console.warn("Can not delete object with usage marker",this.guid,r):(uT&&console.log("DESTROY",this.gameObject),AC(this.gameObject,this.context.connection))}}}}var ru=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r},jw;(function(n){n[n.Off=0]="Off",n[n.Gaussian=1]="Gaussian",n[n.Bokeh=2]="Bokeh"})(jw||(jw={}));const dT=N("debugpost");class Ha extends Ds{constructor(){super(...arguments);c(this,"mode");c(this,"focusDistance");c(this,"focalLength");c(this,"aperture");c(this,"gaussianMaxRadius");c(this,"resolutionScale");c(this,"bokehScale")}get typeName(){return"DepthOfField"}init(){dT&&console.log("DOF: INIT"),this.focalLength.valueProcessor=i=>{const s=i/300,r=2;return Ae.lerp(r,.01,s)};const e=20;this.aperture.valueProcessor=i=>{const s=1-i/32;return Ae.lerp(1,e,s)}}onCreateEffect(){if(this.mode===jw.Off){dT&&console.warn("DepthOfField: Mode is set to Off");return}const e=1/window.devicePixelRatio;if(this.resolutionScale===void 0){let s=1;No()&&(s=.6),this.resolutionScale=new je(s*e)}const i=new TM(this.context.mainCamera,{worldFocusRange:.2,focalLength:1,bokehScale:20,resolutionScale:this.resolutionScale.value});return this.focusDistance.onValueChanged=s=>{i.cocMaterial.worldFocusDistance=s},this.focalLength.onValueChanged=s=>i.cocMaterial.worldFocusRange=s,this.aperture.onValueChanged=s=>i.bokehScale=s,this.resolutionScale&&(this.resolutionScale.onValueChanged=s=>i.resolution.scale=s),[i]}unapply(){}}ru([A()],Ha.prototype,"mode",void 0);ru([A(je)],Ha.prototype,"focusDistance",void 0);ru([A(je)],Ha.prototype,"focalLength",void 0);ru([A(je)],Ha.prototype,"aperture",void 0);ru([A(je)],Ha.prototype,"gaussianMaxRadius",void 0);ru([A(je)],Ha.prototype,"resolutionScale",void 0);ru([A(je)],Ha.prototype,"bokehScale",void 0);zo("DepthOfField",Ha);var IV=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r},Nv;(function(n){n[n.Never=0]="Never",n[n.Desktop=1]="Desktop",n[n.Mobile=2]="Mobile"})(Nv||(Nv={}));class XC extends se{constructor(){super(...arguments);c(this,"visibleOn")}onEnable(){this.apply()}apply(){this.test()||z.setActive(this.gameObject,!1)}test(){return this.visibleOn<0?!0:No()?(this.visibleOn&Nv.Mobile)!==0:(this.visibleOn&Nv.Desktop)!==0}}IV([A()],XC.prototype,"visibleOn",void 0);class Qk{get extensionName(){return"DocumentExtension"}onAfterBuildDocument(t){}}var ou=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};const Ta=N("debugdrag");var Vs;(function(n){n[n.XZPlane=0]="XZPlane",n[n.Attached=1]="Attached",n[n.HitNormal=2]="HitNormal",n[n.DynamicViewAngle=3]="DynamicViewAngle",n[n.SnapToSurfaces=4]="SnapToSurfaces",n[n.None=5]="None"})(Vs||(Vs={}));const wo=class extends se{constructor(){super(...arguments);c(this,"dragMode",Vs.DynamicViewAngle);c(this,"snapGridResolution",0);c(this,"keepRotation",!0);c(this,"xrDragMode",Vs.Attached);c(this,"xrKeepRotation",!1);c(this,"xrDistanceDragFactor",1);c(this,"showGizmo",!1);c(this,"targetObject",null);c(this,"orbit",null);c(this,"_dragHelper",null);c(this,"_draggingRigidbodies",[]);c(this,"_potentialDragStartEvt",null);c(this,"_dragHandlers",new Map);c(this,"_totalMovement",new C);c(this,"_marker",null);c(this,"_isDragging",!1);c(this,"_didDrag",!1)}static get HasAnySelected(){return this._active>0}setTargetObject(e){this.targetObject=e;for(const i of this._dragHandlers.values())i.setTargetObject(e)}awake(){this._potentialDragStartEvt=null,this._dragHandlers=new Map,this._totalMovement=new C,this._marker=null,this._isDragging=!1,this._didDrag=!1,this._dragHelper=null,this._draggingRigidbodies=[]}start(){this.orbit=z.findObjectOfType(Et,this.context),this.gameObject.getComponentInParent(no)||this.gameObject.addComponent(no)}allowEdit(e=null){return this.context.connection.allowEditing}onPointerEnter(e){if(!this.allowEdit(this.gameObject)||e.mode!=="screen"||(e.event.mode==="tracked-pointer"||e.event.mode==="transient-pointer"?this.xrDragMode:this.dragMode)===Vs.None)return;const r=z.getComponentInParent(e.object,wo);!r||r!==this||(wo.lastHovered=e.object,this.context.domElement.style.cursor="pointer")}onPointerExit(e){this.allowEdit(this.gameObject)&&e.mode==="screen"&&wo.lastHovered===e.object&&(this.context.domElement.style.cursor="auto")}onPointerDown(e){if(!(!this.allowEdit(this.gameObject)||e.used||(e.mode==="tracked-pointer"||e.mode==="transient-pointer"?this.xrDragMode:this.dragMode)===Vs.None)&&(wo.lastHovered=e.object,e.button===0)){this._dragHandlers.size===0&&(this._didDrag=!1,this._totalMovement.set(0,0,0),this._potentialDragStartEvt=e),wo._active+=1;const r=new RV(this,this.targetObject||this.gameObject);if(this._dragHandlers.set(e.event.space,r),this.orbit&&(this.orbit.enabled=!1),r.onDragStart(e),this._dragHandlers.size===2){const o=this._dragHandlers.values(),a=o.next().value,l=o.next().value,h=new TV(this,this.targetObject||this.gameObject,a,l);this._dragHandlers.set(this.gameObject,h),h.onDragStart(e)}e.use()}}onPointerMove(e){(this._isDragging||this._potentialDragStartEvt!==null)&&e.use()}onPointerUp(e){if(Ta&&De.DrawLabel(e.point??this.gameObject.worldPosition,"POINTERUP:"+e.pointerId+", "+e.button,.03,3),!this.allowEdit(this.gameObject)||e.button!==0)return;this._potentialDragStartEvt=null;const i=this._dragHandlers.get(e.event.space),s=this._dragHandlers.get(this.gameObject);s&&(s.handlerA===i||s.handlerB===i)&&(this._dragHandlers.delete(this.gameObject),s.onDragEnd(e)),i&&(wo._active>0&&(wo._active-=1),i.onDragEnd&&i.onDragEnd(e),this._dragHandlers.delete(e.event.space),this._dragHandlers.size===0&&this.onLastDragEnd(e),e.use()),wo._active===0&&this.orbit&&(this.orbit.enabled=!0)}update(){for(const e of this._dragHandlers.values())e.collectMovementInfo&&e.collectMovementInfo(),e.getTotalMovement&&this._totalMovement.add(e.getTotalMovement());if(this._potentialDragStartEvt){if(!this._didDrag)if(this._totalMovement.length()>3e-4)this._didDrag=!0;else return;const e=this._potentialDragStartEvt;this._potentialDragStartEvt=null,this.onFirstDragStart(e)}for(const e of this._dragHandlers.values())e.onDragUpdate&&e.onDragUpdate(this._dragHandlers.size);this._dragHelper&&this._dragHelper.hasSelected&&this.onAnyDragUpdate()}onFirstDragStart(e){if(!this._dragHelper)if(this.context.mainCamera)this._dragHelper=new WA(this.context.mainCamera);else return;if(!e||!e.object)return;const i=z.getComponentInParent(e.object,wo);if(!i||i!==this)return;const s=this.targetObject||this.gameObject;if(!s)return;this._isDragging=!0,this._dragHelper.setSelected(s,this.context),this.orbit&&(this.orbit.enabled=!1);const r=z.getComponentInChildren(s,Qh);Ta&&console.log("DRAG START",r,s),r&&(r.fastMode=!0,r==null||r.requestOwnership()),this._marker=z.addComponent(s,h0),this._draggingRigidbodies.length=0;const o=z.getComponentsInChildren(s,Pt);o&&this._draggingRigidbodies.push(...o)}onAnyDragUpdate(){if(!this._dragHelper)return;this._dragHelper.showGizmo=this.showGizmo,this._dragHelper.onUpdate(this.context);for(const i of this._draggingRigidbodies)i.wakeUp(),i.resetVelocities(),i.resetForcesAndTorques();const e=this.targetObject||this.gameObject;Bo.markDirty(e)}onLastDragEnd(e){if(!this||!this._isDragging||(this._isDragging=!1,!this._dragHelper))return;for(const s of this._draggingRigidbodies)s.setVelocity(s.smoothedVelocity);this._draggingRigidbodies.length=0;const i=this._dragHelper.selected;if(Ta&&console.log("DRAG END",i,i==null?void 0:i.visible),this._dragHelper.setSelected(null,this.context),this.orbit&&(this.orbit.enabled=!0),e!=null&&e.object){const s=z.getComponentInChildren(e.object,Qh);s&&(s.fastMode=!1)}this._marker&&this._marker.destroy()}};let Is=wo;c(Is,"_active",0),c(Is,"lastHovered");ou([A()],Is.prototype,"dragMode",void 0);ou([A()],Is.prototype,"snapGridResolution",void 0);ou([A()],Is.prototype,"keepRotation",void 0);ou([A()],Is.prototype,"xrDragMode",void 0);ou([A()],Is.prototype,"xrKeepRotation",void 0);ou([A()],Is.prototype,"xrDistanceDragFactor",void 0);ou([A()],Is.prototype,"showGizmo",void 0);class TV{constructor(t,e,i,s){c(this,"handlerA");c(this,"handlerB");c(this,"context");c(this,"settings");c(this,"gameObject");c(this,"_handlerAAttachmentPoint",new C);c(this,"_handlerBAttachmentPoint",new C);c(this,"_followObject");c(this,"_manipulatorObject");c(this,"_deviceMode");c(this,"_followObjectStartWorldQuaternion",new ne);c(this,"_manipulatorPosOffset",new C);c(this,"_manipulatorRotOffset",new ne);c(this,"_manipulatorScaleOffset",new C);c(this,"_tempVec1",new C);c(this,"_tempVec2",new C);c(this,"_tempVec3",new C);c(this,"tempLookMatrix",new ce);c(this,"_initialScale",new C);c(this,"_initialDistance",0);var o,a;this.context=t.context,this.settings=t,this.gameObject=e,this.handlerA=i,this.handlerB=s,this._followObject=new re,this._manipulatorObject=new re,this.context.scene.add(this._manipulatorObject);const r=(a=(o=Me.active)==null?void 0:o.rig)==null?void 0:a.gameObject;if(!this.handlerA||!this.handlerB||!this.handlerA.hitPointInLocalSpace||!this.handlerB.hitPointInLocalSpace){console.error("Invalid: MultiTouchDragHandler needs two valid DragPointerHandlers with hitPointInLocalSpace set.");return}if(this._tempVec1.copy(this.handlerA.hitPointInLocalSpace),this._tempVec2.copy(this.handlerB.hitPointInLocalSpace),this.gameObject.localToWorld(this._tempVec1),this.gameObject.localToWorld(this._tempVec2),r&&(r.worldToLocal(this._tempVec1),r.worldToLocal(this._tempVec2)),this._initialDistance=this._tempVec1.distanceTo(this._tempVec2),this._initialDistance<.02?(Ta&&console.log("Finding alternative drag attachment points since initial distance is too low: "+this._initialDistance.toFixed(2)),this.handlerA.followObject.parent.getWorldPosition(this._tempVec1),this.handlerB.followObject.parent.getWorldPosition(this._tempVec2),this._handlerAAttachmentPoint.copy(this._tempVec1),this._handlerBAttachmentPoint.copy(this._tempVec2),this.gameObject.worldToLocal(this._handlerAAttachmentPoint),this.gameObject.worldToLocal(this._handlerBAttachmentPoint),this._initialDistance=this._tempVec1.distanceTo(this._tempVec2),this._initialDistance<.001&&(console.warn("Not supported right now â€“ controller drag points for multitouch are too close!"),this._initialDistance=1)):(this._handlerAAttachmentPoint.copy(this.handlerA.hitPointInLocalSpace),this._handlerBAttachmentPoint.copy(this.handlerB.hitPointInLocalSpace)),this._tempVec3.lerpVectors(this._tempVec1,this._tempVec2,.5),this._initialScale.copy(e.scale),Ta){this._followObject.add(new Do(2)),this._manipulatorObject.add(new Do(5));const l=h=>`${h.x.toFixed(2)}, ${h.y.toFixed(2)}, ${h.z.toFixed(2)}`;De.DrawLine(this._tempVec1,this._tempVec2,65535,0,!1),De.DrawLabel(this._tempVec3,"A:B "+this._initialDistance.toFixed(2)+`
`+l(this._tempVec1)+`
`+l(this._tempVec2),.03,5)}}onDragStart(t){this.gameObject.add(this._followObject),this._followObject.matrixAutoUpdate=!1,this._followObject.matrix.identity(),this._deviceMode=t.mode,this._followObjectStartWorldQuaternion.copy(this._followObject.worldQuaternion),this.alignManipulator(),this._manipulatorObject.attach(this._followObject),this._manipulatorPosOffset.copy(this._followObject.position),this._manipulatorRotOffset.copy(this._followObject.quaternion),this._manipulatorScaleOffset.copy(this._followObject.scale)}onDragEnd(t){if(!this.handlerA||!this.handlerB){console.error("onDragEnd called on MultiTouchDragHandler without valid handlers. This is likely a bug.");return}this.handlerA.recenter(),this.handlerB.recenter(),this._manipulatorObject.removeFromParent(),this._followObject.removeFromParent(),this._manipulatorObject.destroy(),this._followObject.destroy()}alignManipulator(){if(!this.handlerA||!this.handlerB){console.error("alignManipulator called on MultiTouchDragHandler without valid handlers. This is likely a bug.",this);return}if(!this.handlerA.followObject||!this.handlerB.followObject){console.error("alignManipulator called on MultiTouchDragHandler without valid follow objects. This is likely a bug.",this.handlerA,this.handlerB);return}this._tempVec1.copy(this._handlerAAttachmentPoint),this._tempVec2.copy(this._handlerBAttachmentPoint),this.handlerA.followObject.localToWorld(this._tempVec1),this.handlerB.followObject.localToWorld(this._tempVec2),this._tempVec3.lerpVectors(this._tempVec1,this._tempVec2,.5),this._manipulatorObject.position.copy(this._tempVec3);const t=this.context.mainCamera;this.tempLookMatrix.lookAt(this._tempVec3,this._tempVec2,t.worldUp),this._manipulatorObject.quaternion.setFromRotationMatrix(this.tempLookMatrix);const e=this._tempVec1.distanceTo(this._tempVec2);this._manipulatorObject.scale.copy(this._initialScale).multiplyScalar(e/this._initialDistance),this._manipulatorObject.updateMatrix(),this._manipulatorObject.updateMatrixWorld(!0),Ta&&(De.DrawLabel(this._tempVec3.clone().add(new C(0,.2,0)),"A:B "+e.toFixed(2),.03),De.DrawLine(this._tempVec1,this._tempVec2,65280,0,!1))}onDragUpdate(){this.alignManipulator();const t=30,e=1;this._followObject.position.copy(this._manipulatorPosOffset),this._followObject.quaternion.copy(this._manipulatorRotOffset),this._followObject.scale.copy(this._manipulatorScaleOffset);const i=this.gameObject,s=this._followObject;s.updateMatrix(),s.updateMatrixWorld(!0);const o=this._deviceMode==="tracked-pointer"||this._deviceMode==="transient-pointer"?this.settings.xrKeepRotation:this.settings.keepRotation;if(this.settings.snapGridResolution>0){const d=this._followObject.worldPosition,f=this.settings.snapGridResolution;d.x=Math.round(d.x/f)*f,d.y=Math.round(d.y/f)*f,d.z=Math.round(d.z/f)*f,this._followObject.worldPosition=d,this._followObject.updateMatrix()}o&&(this._followObject.worldQuaternion=this._followObjectStartWorldQuaternion,this._followObject.updateMatrix());const a=Ae.clamp01(this.context.time.deltaTime*t*e),l=i.worldPosition;l.lerp(s.worldPosition,a),i.worldPosition=l;const h=i.worldQuaternion;h.slerp(s.worldQuaternion,a),i.worldQuaternion=h;const u=i.worldScale;u.lerp(s.worldScale,a),i.worldScale=u}setTargetObject(t){this.gameObject=t}}class RV{constructor(t,e){c(this,"context");c(this,"gameObject");c(this,"settings");c(this,"_lastRig");c(this,"_followObject");c(this,"_totalMovement",new C);c(this,"_totalMovementAlongRayDirection",0);c(this,"_grabStartDistance",0);c(this,"_deviceMode");c(this,"_followObjectStartPosition",new C);c(this,"_followObjectStartQuaternion",new ne);c(this,"_followObjectStartWorldQuaternion",new ne);c(this,"_lastDragPosRigSpace");c(this,"_tempVec",new C);c(this,"_tempMat",new ce);c(this,"_hitPointInLocalSpace",new C);c(this,"_hitNormalInLocalSpace",new C);c(this,"_bottomCenter",new C);c(this,"_backCenter",new C);c(this,"_backBottomCenter",new C);c(this,"_bounds",new Nn);c(this,"_dragPlane",new Oh(new C(0,1,0)));c(this,"_draggedOverObject",null);c(this,"_draggedOverObjectLastSetUp",null);c(this,"_draggedOverObjectLastNormal",new C);c(this,"_draggedOverObjectDuration",0);this.settings=t,this.context=t.context,this.gameObject=e,this._followObject=new re}getTotalMovement(){return this._totalMovement}get followObject(){return this._followObject}get hitPointInLocalSpace(){return this._hitPointInLocalSpace}setTargetObject(t){this.gameObject=t}recenter(){var r,o;if(!this._followObject.parent){console.warn("Error: space follow object doesn't have parent but recenter() is called. This is likely a bug");return}const t=this._followObject.parent;this.gameObject.add(this._followObject),this._followObject.matrixAutoUpdate=!1,this._followObject.position.set(0,0,0),this._followObject.quaternion.set(0,0,0,1),this._followObject.scale.set(1,1,1),this._followObject.updateMatrix(),this._followObject.updateMatrixWorld(!0),t.attach(this._followObject),this._followObjectStartPosition.copy(this._followObject.position),this._followObjectStartQuaternion.copy(this._followObject.quaternion),this._followObjectStartWorldQuaternion.copy(this._followObject.worldQuaternion),this._followObject.updateMatrix(),this._followObject.updateMatrixWorld(!0);const e=this._hitPointInLocalSpace.clone();this.gameObject.localToWorld(e),this._grabStartDistance=e.distanceTo(t.worldPosition);const i=(o=(r=Me.active)==null?void 0:r.rig)==null?void 0:o.gameObject,s=(i==null?void 0:i.worldScale.x)||1;this._grabStartDistance/=s,this._totalMovementAlongRayDirection=0,this._lastDragPosRigSpace=void 0,Ta&&(De.DrawLine(e,t.worldPosition,65280,.5,!1),De.DrawLabel(t.worldPosition.add(new C(0,.1,0)),this._grabStartDistance.toFixed(2),.03,.5))}onDragStart(t){if(t.event.space.add(this._followObject),this._lastDragPosRigSpace=void 0,t.point&&t.normal)this._hitPointInLocalSpace.copy(t.point),this.gameObject.worldToLocal(this._hitPointInLocalSpace),this._hitNormalInLocalSpace.copy(t.normal);else if(t){const m=t.event.space,v=m.worldPosition;this.gameObject.worldToLocal(v),this._hitPointInLocalSpace.copy(v);const y=m.worldUp;this._tempMat.copy(this.gameObject.matrixWorld).invert(),y.transformDirection(this._tempMat),this._hitNormalInLocalSpace.copy(y)}this.recenter(),this._totalMovement.set(0,0,0),this._deviceMode=t.mode;const i=this._followObject.parent.worldForward,r=this._deviceMode==="tracked-pointer"||this._deviceMode==="transient-pointer"?this.settings.xrDragMode:this.settings.dragMode,o=this._hitPointInLocalSpace.clone();switch(this.gameObject.localToWorld(o),r){case Vs.XZPlane:const m=new C(0,1,0);this.gameObject.parent&&m.transformDirection(this.gameObject.parent.matrixWorld.clone().invert()),this._dragPlane.setFromNormalAndCoplanarPoint(m,o);break;case Vs.HitNormal:const v=this._hitNormalInLocalSpace.clone();v.transformDirection(this.gameObject.matrixWorld),this._dragPlane.setFromNormalAndCoplanarPoint(v,o);break;case Vs.Attached:this._dragPlane.setFromNormalAndCoplanarPoint(i,o);break;case Vs.DynamicViewAngle:const y=new C(0,1,0),b=i,_=y.angleTo(b),x=.5;_>Math.PI/2+x||_<Math.PI/2-x?this._dragPlane.setFromNormalAndCoplanarPoint(new C(0,1,0),o):this._dragPlane.setFromNormalAndCoplanarPoint(i,o);break;case Vs.None:break}const a=new Nn,l=this.gameObject.parent,h=this.gameObject.position.clone(),u=this.gameObject.quaternion.clone(),d=this.gameObject.scale.clone(),f=this.gameObject.matrixWorld.clone();l&&l.remove(this.gameObject),this.gameObject.position.set(0,0,0),this.gameObject.quaternion.set(0,0,0,1),this.gameObject.scale.set(1,1,1),a.setFromObject(this.gameObject);const p=new C;a.getCenter(p);const g=new C;a.getSize(g),this._bottomCenter.copy(p.clone().add(new C(0,-g.y/2,0))),this._backCenter.copy(p.clone().add(new C(0,0,g.z/2))),this._backBottomCenter.copy(p.clone().add(new C(0,-g.y/2,g.z/2))),this._bounds.copy(a),l&&l.add(this.gameObject),this.gameObject.position.copy(h),this.gameObject.quaternion.copy(u),this.gameObject.scale.copy(d),this.gameObject.matrixWorld.copy(f),this._draggedOverObject=null,this._draggedOverObjectLastSetUp=null,this._draggedOverObjectLastNormal.set(0,1,0),this._draggedOverObjectDuration=0}collectMovementInfo(){var r,o;if(!this._followObject.parent)return;const t=this._followObject.parent;this._followObject.updateMatrix();const e=t.worldPosition,i=(o=(r=Me.active)==null?void 0:r.rig)==null?void 0:o.gameObject;i&&i.worldToLocal(e),(this._lastDragPosRigSpace===void 0||i!=this._lastRig)&&(this._lastDragPosRigSpace=e.clone(),this._lastRig=i),this._tempVec.copy(e).sub(this._lastDragPosRigSpace);const s=t.worldForward;if(i&&(this._tempMat.copy(i.matrixWorld).invert(),s.transformDirection(this._tempMat)),this._totalMovementAlongRayDirection+=s.dot(this._tempVec),this._tempVec.x=Math.abs(this._tempVec.x),this._tempVec.y=Math.abs(this._tempVec.y),this._tempVec.z=Math.abs(this._tempVec.z),this._totalMovement.add(this._tempVec),this._lastDragPosRigSpace.copy(e),Ta){let a=e;i&&(a=a.clone(),a.transformDirection(i.matrixWorld)),De.DrawRay(a,s,255)}}onDragUpdate(t){if(t>1)return;const e=this.gameObject,i=this._followObject.parent;this._followObject.updateMatrix();const s=i.worldPosition,r=i.worldForward,o=this._deviceMode==="tracked-pointer"||this._deviceMode==="transient-pointer",a=o?this.settings.xrKeepRotation:this.settings.keepRotation,l=o?this.settings.xrDragMode:this.settings.dragMode;if(l===Vs.None)return;const h=10;a&&(this._followObject.worldQuaternion=this._followObjectStartWorldQuaternion),this._followObject.updateMatrix(),this._followObject.updateMatrixWorld(!0);let u=1,d=1;if(o&&this._grabStartDistance>.5){const v=1+this._totalMovementAlongRayDirection*(2*this.settings.xrDistanceDragFactor);u=Math.max(0,v),u=u*u*u}else this._grabStartDistance<=.5&&(d=3);this._followObject.position.copy(this._followObjectStartPosition),a||this._followObject.quaternion.copy(this._followObjectStartQuaternion),this._followObject.position.multiplyScalar(u),this._followObject.updateMatrix();const f=new Lc(s,r);if(l==Vs.SnapToSurfaces){const v=new Lo;v.ignore=[e];const y=this.context.physics.raycastFromRay(f,v);if(y.length>0){const b=y[0];if(this._draggedOverObject===b.object?this._draggedOverObjectDuration+=this.context.time.deltaTime:(this._draggedOverObject=b.object,this._draggedOverObjectDuration=0),b.face&&this._draggedOverObjectDuration>.15&&(this._draggedOverObjectLastSetUp!==this._draggedOverObject||this._draggedOverObjectLastNormal.dot(b.face.normal)<.999999)){this._draggedOverObjectLastSetUp=this._draggedOverObject,this._draggedOverObjectLastNormal.copy(b.face.normal);const _=new C,x=new C;this._bounds.getCenter(_),this._bounds.getSize(x),_.sub(x.multiplyScalar(.5).multiply(b.face.normal)),this._hitPointInLocalSpace.copy(_),this._hitNormalInLocalSpace.copy(b.face.normal),this._bounds.getCenter(_),this._bounds.getSize(x),_.add(x.multiplyScalar(.5).multiply(b.face.normal));const S=this._hitPointInLocalSpace.clone().add(_);this._followObject.localToWorld(S);const T=this._followObject.worldPosition.sub(S);this._dragPlane.setFromNormalAndCoplanarPoint(b.face.normal,b.point.sub(T))}}}if(l!==Vs.Attached&&f.intersectPlane(this._dragPlane,this._tempVec)){this._followObject.worldPosition=this._tempVec,this._followObject.updateMatrix(),this._followObject.updateMatrixWorld(!0);const v=this._hitPointInLocalSpace.clone();this._followObject.localToWorld(v),Ta&&De.DrawLine(v,this._tempVec,65535,0,!1),this._followObject.worldPosition=this._tempVec.multiplyScalar(2).sub(v),this._followObject.updateMatrix(),this._followObject.updateMatrix()}if(this.settings.snapGridResolution>0){const v=this._followObject.worldPosition,y=this.settings.snapGridResolution;v.x=Math.round(v.x/y)*y,v.y=Math.round(v.y/y)*y,v.z=Math.round(v.z/y)*y,this._followObject.worldPosition=v,this._followObject.updateMatrix()}a&&(this._followObject.worldQuaternion=this._followObjectStartWorldQuaternion,this._followObject.updateMatrix());const p=Ae.clamp01(this.context.time.deltaTime*h*d),g=e.worldPosition;g.lerp(this._followObject.worldPosition,p),e.worldPosition=g;const m=e.worldQuaternion;if(m.slerp(this._followObject.worldQuaternion,p),e.worldQuaternion=m,Ta){const v=this._hitPointInLocalSpace.clone();e.localToWorld(v),De.DrawSphere(v,.02,16711680);const y=this._hitNormalInLocalSpace.clone();y.applyQuaternion(m),De.DrawRay(v,y,16711680),De.DrawLabel(g.add(new C(0,.25,0)),`Distance: ${this._totalMovement.length().toFixed(2)}

                Along Ray: ${this._totalMovementAlongRayDirection.toFixed(2)}

                Session: ${!!Me.active}

                Device: ${this._deviceMode}

                `,.03);const b=this._bottomCenter.clone(),_=this._backCenter.clone(),x=this._backBottomCenter.clone();e.localToWorld(b),e.localToWorld(_),e.localToWorld(x),De.DrawSphere(b,.01,65280,0,!1),De.DrawSphere(_,.01,255,0,!1),De.DrawSphere(x,.01,16711935,0,!1),De.DrawLine(b,x,65535,0,!1),De.DrawLine(x,_,65535,0,!1)}}onDragEnd(t){console.assert(this._followObject.parent===t.event.space,"Drag end: _followObject is not parented to the space object"),this._followObject.removeFromParent(),this._followObject.destroy(),this._lastDragPosRigSpace=void 0}}const FS=class{constructor(t){c(this,"showGizmo",!0);c(this,"useViewAngle",!0);c(this,"_selected",null);c(this,"_context",null);c(this,"_camera");c(this,"_cameraPlane",new Oh);c(this,"_hasGroundPlane",!1);c(this,"_groundPlane",new Oh);c(this,"_groundOffset",new C);c(this,"_groundOffsetFactor",0);c(this,"_groundDistance",0);c(this,"_groundPlanePoint",new C);c(this,"_raycaster",new jd);c(this,"_cameraPlaneOffset",new C);c(this,"_intersection",new C);c(this,"_worldPosition",new C);c(this,"_inverseMatrix",new ce);c(this,"_rbs",[]);c(this,"_groundLine");c(this,"_groundMarker");c(this,"_groundOffsetVector",new C(0,1,0));c(this,"_requireUpdateGroundPlane",!0);c(this,"_didDragOnGroundPlaneLastFrame",!1);this._camera=t;const e=new Hs(FS.geometry),i=e.material;i.color=new we(.4,.4,.4),e.layers.set(2),e.name="line",e.scale.y=1,this._groundLine=e;const s=new Qd(.5,22,22),r=new St({color:i.color}),o=new J(s,r);o.visible=!1,o.layers.set(2),this._groundMarker=o}get hasSelected(){return this._selected!==null&&this._selected!==void 0}get selected(){return this._selected}setSelected(t,e){if(this._selected&&e)for(const i of this._rbs)i.wakeUp(),i.setVelocity(0,0,0);if(this._selected&&bl.Remove(e,this._selected),this._selected=t,this._context=e,this._rbs.length=0,t?(e.scene.add(this._groundLine),e.scene.add(this._groundMarker)):(this._groundLine.removeFromParent(),this._groundMarker.removeFromParent()),this._selected){if(!e){console.error("DragHelper: no context");return}bl.Add(e,this._selected,null),this._groundOffsetFactor=0,this._hasGroundPlane=!0,this._groundOffset.set(0,0,0),this._requireUpdateGroundPlane=!0,this.onUpdateScreenSpacePlane()}}onUpdate(t){if(!this._selected)return;const e=qe(this._selected);this.onUpdateWorldPosition(e,this._groundPlanePoint,!1),this.onUpdateGroundPlane(),this._didDragOnGroundPlaneLastFrame=!0,this._hasGroundPlane=!0}onUpdateWorldPosition(t,e,i){if(this._selected){if(i){const s=qe(this._selected);s.y=t.y,t=s}if(Ts(this._selected,t),Ts(this._groundLine,t),this._hasGroundPlane?this._groundLine.scale.y=this._groundDistance:this._groundLine.scale.y=1e3,this._groundLine.visible=this.showGizmo,this._groundMarker.visible=e!==null&&this.showGizmo,e){const s=qe(this._camera).distanceTo(e)*.01;this._groundMarker.scale.set(s,s,s),Ts(this._groundMarker,e)}}}onUpdateScreenSpacePlane(){if(!this._selected||!this._context)return;const t=this._context.input.getPointerPositionRC(0);t&&(this._raycaster.setFromCamera(t,this._camera),this._cameraPlane.setFromNormalAndCoplanarPoint(this._camera.getWorldDirection(this._cameraPlane.normal),this._worldPosition.setFromMatrixPosition(this._selected.matrixWorld)),this._raycaster.ray.intersectPlane(this._cameraPlane,this._intersection)&&this._selected.parent&&(this._inverseMatrix.copy(this._selected.parent.matrixWorld).invert(),this._cameraPlaneOffset.copy(this._intersection).sub(this._worldPosition.setFromMatrixPosition(this._selected.matrixWorld))))}onUpdateGroundPlane(){if(!this._selected||!this._context)return;const t=qe(this._selected),e=new Lc(new C(0,.1,0).add(t),new C(0,-1,0)),i=new Lo;i.ignore=[this._selected];const s=this._context.physics.raycastFromRay(e,i);for(let r=0;r<s.length;r++){const o=s[r];if(!o.face||this.contains(this._selected,o.object))continue;const a=new C(0,1,0);this._groundPlane.setFromNormalAndCoplanarPoint(a,o.point);break}this._hasGroundPlane=!0,this._groundPlane.setFromNormalAndCoplanarPoint(e.direction.multiplyScalar(-1),e.origin),this._raycaster.ray.intersectPlane(this._groundPlane,this._intersection),this._groundDistance=this._intersection.distanceTo(t),this._groundOffset.copy(this._intersection).sub(t)}contains(t,e){if(t===e)return!0;if(t.children){for(const i of t.children)if(this.contains(i,e))return!0}return!1}};let WA=FS;c(WA,"geometry",new jt().setFromPoints([new C(0,0,0),new C(0,-1,0)]));function YC(n,t,e){console.warn("Adding components on object has been temporarily disabled")}var Qv;(function(n){n.File_Spawned="file-spawned"})(Qv||(Qv={}));class BV{constructor(t,e,i,s,r,o,a,l){c(this,"guid");c(this,"file_name");c(this,"file_hash");c(this,"file_size");c(this,"position");c(this,"seed");c(this,"sender");c(this,"serverUrl");c(this,"parentGuid");c(this,"boundsSize");this.seed=e,this.guid=i,this.file_name=s,this.file_hash=r,this.file_size=o,this.position=a,this.sender=t,this.serverUrl=l}}async function PV(n,t,e){const i=n.name;return i.endsWith(".gltf")||i.endsWith(".glb")||n.type==="model/gltf+json"||n.type==="model/gltf-binary"?new Promise((s,r)=>{const o=new FileReader;o.readAsArrayBuffer(n),o.onloadend=async a=>{const l=o.result,h=vC(),u=new Qn(h),d=await La().parseSync(t,l,n.name,u);if(d&&d.scene){const f=d.scene;if(!f.guid){const p=new Qn(h);f.guid=p.generateUUID()}e&&kV(t.connection,n,h,f,e),YC(),s(d)}}}):(console.warn("Unsupported file type: "+i,n),null)}async function MV(n,t){return new Promise(async(e,i)=>{const s=vC(),r=new Qn(s),o=n.toString(),a=await La().loadSync(t,o,o,r);a&&a.scene?(a.scene,YC(),e(a)):console.warn("Unsupported file type: "+n.toString())})}mt.registerCallback(yt.ContextCreated,n=>{DV(n.context)});function DV(n){n.connection.beginListen(Qv.File_Spawned,async t=>{if(t.sender!==n.connection.connectionId){console.log("received file event",t),OV(t,n);let e=null;try{e=await GM(t.file_name,t.file_hash,t.file_size,t.serverUrl)}finally{LV(t)}if(e){const i=new Qn(t.seed),s=await La().parseSync(n,e,t.file_name,i);if(s&&s.scene){const r=s.scene;if(YC(),t.parentGuid){const o=Dy(t.parentGuid,n.scene);o&&"add"in o&&o.add(r)}r.parent||n.scene.add(r),t.position!==null&&r.position.copy(t.position)}}else console.error("download didnt return file")}})}async function kV(n,t,e,i,s){if(!n.connectionId){console.error("Can not upload file - no connection id");return}if(!i.guid){console.error("Can not upload file - no guid",i,i.guid);return}const r=await J8(t,s);if(!r)return;if(!r.filename){console.error("Can not send upload event - no filename",t.name);return}if(!r.hash){console.error("Can not send upload event - no hash",t.name);return}const o=new BV(n.connectionId,e,i.guid,r.filename,r.hash,t.size,i.position,r.url??s);i.parent&&(o.parentGuid=i.parent.guid),n.send(Qv.File_Spawned,o)}const Gw={};function OV(n,t){const e=new Xi,i=new J(e,new St({color:65280})),s=new XR(i,5592405);if(Gw[n.guid]=s,t.scene.add(s),n.parentGuid){const r=Dy(n.parentGuid,t.scene);r&&r.add(s)}n.position&&s.position.copy(n.position)}function LV(n,t){const e=n.guid,i=Gw[e];i&&(delete Gw[e],i.removeFromParent())}var KC=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};const FV=N("debugnet");class Bl extends se{constructor(){super(...arguments);c(this,"url",null);c(this,"urlParameterName",null);c(this,"localhost",null)}awake(){FV&&console.log(this),this.context.connection.registerProvider(this)}getWebsocketUrl(){let e=this.url?Bl.GetUrl(this.url,this.localhost):null;if(this.urlParameterName){const o=N(this.urlParameterName);o&&typeof o=="string"&&(e=o)}if(!e)return null;const s=new RegExp("(((https?)|(?<socket_prefix>wss?))://)?(www.)?(?<url>.+)","gm").exec(e);return s!=null&&s.groups?(s==null?void 0:s.groups.socket_prefix)?e:"wss://"+(s==null?void 0:s.groups.url):null}static GetUrl(e,i){let s=e;const r=Bl.IsLocalNetwork()&&i;if(r&&(s=i),e!=null&&e.startsWith("/")){const o=r?s:window.location.origin;o!=null&&o.endsWith("/")&&e.startsWith("/")&&(e=e.substring(1)),s=o+e}return s}static IsLocalNetwork(e=window.location.hostname){return qs(e)}}KC([A()],Bl.prototype,"url",void 0);KC([A()],Bl.prototype,"urlParameterName",void 0);KC([A()],Bl.prototype,"localhost",void 0);var zk=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};const Eu=N("debugdroplistener");var zv;(function(n){n.FileDropped="file-dropped",n.ObjectAdded="object-added"})(zv||(zv={}));class u0 extends se{constructor(){super(...arguments);c(this,"filesBackendUrl");c(this,"localhost");c(this,"onDrag",e=>{e.preventDefault()});c(this,"onDrop",async e=>{if(Eu&&console.log(e),!(e!=null&&e.dataTransfer))return;e.preventDefault();const i=e.dataTransfer.items;if(i)for(const s in i){const r=i[s];if(r.kind==="file"){const o=r.getAsFile();if(!o)continue;await this.addFiles(o)}else r.kind==="string"&&r.type=="text/plain"&&r.getAsString(async o=>{Eu&&console.log("dropped url",o);try{const a=new URL(o);if(!a)return;const l=await MV(a,this.context);l&&this.addObject(e,l)}catch{console.log("dropped string is not a valid URL!",o)}})}})}onEnable(){this.filesBackendUrl=Bl.GetUrl(this.filesBackendUrl,this.localhost)??this.filesBackendUrl,Eu&&console.log(this,this.filesBackendUrl),this.context.domElement.addEventListener("dragover",this.onDrag),this.context.domElement.addEventListener("drop",this.onDrop)}onDisable(){this.context.domElement.removeEventListener("dragover",this.onDrag),this.context.domElement.removeEventListener("drop",this.onDrop)}async addFiles(...e){if(Eu&&console.log("Add files",e),!!Array.isArray(e)&&e.length)for(const i of e){if(!i)continue;Eu&&console.log("Register file "+i.name+" to",this.filesBackendUrl,i);const s=await PV(i,this.context,this.filesBackendUrl);this.dispatchEvent(new CustomEvent(zv.FileDropped,{detail:i})),s&&this.addObject(void 0,s)}}async addObject(e,i){if(Eu&&console.log("Dropped",i),!(i!=null&&i.scene)){console.warn("No object specified to add to scene",i);return}const s=i.scene;if(e!==void 0){const r=new Lo;r.setMask(16777215),r.screenPointFromOffset(e.offsetX,e.offsetY);const o=this.context.physics.raycast(r);if(o&&o.length>0)for(const a of o){s.position.copy(a.point);break}}this.gameObject.add(s),this.dispatchEvent(new CustomEvent(zv.ObjectAdded,{detail:i}))}}zk([A()],u0.prototype,"filesBackendUrl",void 0);zk([A()],u0.prototype,"localhost",void 0);var d0=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};class af extends se{constructor(){super(...arguments);c(this,"parent",null);c(this,"object",null);c(this,"limitCount",10);c(this,"limitInterval",60);c(this,"_currentCount",0);c(this,"_startPosition",null);c(this,"_startQuaternion",null);c(this,"_forwardPointerEvents",new Map)}start(){var i,s;if(this.object){if(this.object===this.gameObject){console.error("Can not duplicate self");return}this.object.visible=!1,this._startPosition=((i=this.object.position)==null?void 0:i.clone())??new C(0,0,0),this._startQuaternion=((s=this.object.quaternion)==null?void 0:s.clone())??new ne(0,0,0,1)}const e=this.gameObject.getComponent(Is);e&&(xe()&&console.warn(`Please remove DragControls from "${e.name}": it's not needed anymore when the object also has a Duplicatable component`),e.enabled=!1),this.gameObject.getComponentInParent(no)||this.gameObject.addNewComponent(no),this.cloneLimitIntervalFn()}onPointerDown(e){if(!this.object||!this.context.connection.allowEditing||e.button!==0)return;const i=this.handleDuplication();if(i){const s=z.getComponent(i,Is);s?(s.onPointerDown(e),this._forwardPointerEvents.set(e.event.space,s)):console.warn("Duplicated object does not have DragControls")}}onPointerUp(e){const i=this._forwardPointerEvents.get(e.event.space);i&&(i.onPointerUp(e),this._forwardPointerEvents.delete(e.event.space))}cloneLimitIntervalFn(){this.destroyed||(this._currentCount>0&&(this._currentCount-=1),setTimeout(()=>{this.cloneLimitIntervalFn()},this.limitInterval/this.limitCount*1e3))}handleDuplication(){var s;if(!this.object||this._currentCount>=this.limitCount||this.object===this.gameObject)return null;this.object.visible=!0,this._startPosition&&this.object.position.copy(this._startPosition),this._startQuaternion&&this.object.quaternion.copy(this._startQuaternion);const e=new za;this.parent||(this.parent=this.gameObject.parent),this.parent&&(e.parent=this.parent.guid??((s=this.parent.userData)==null?void 0:s.guid),e.keepWorldPosition=!0),e.position=this.worldPosition,e.rotation=this.worldQuaternion,e.context=this.context,this._currentCount+=1;const i=z.instantiateSynced(this.object,e);return console.assert(i!==this.object,"Duplicated object is original"),this.object.visible=!1,this._startPosition&&this.object.position.clone().copy(this._startPosition),this._startQuaternion&&this.object.quaternion.clone().copy(this._startQuaternion),i}}d0([A(re)],af.prototype,"parent",void 0);d0([A(re)],af.prototype,"object",void 0);d0([A()],af.prototype,"limitCount",void 0);d0([A()],af.prototype,"limitInterval",void 0);var hh;(function(n){n[n.PointerEnter=0]="PointerEnter",n[n.PointerExit=1]="PointerExit",n[n.PointerDown=2]="PointerDown",n[n.PointerUp=3]="PointerUp",n[n.PointerClick=4]="PointerClick",n[n.Drag=5]="Drag",n[n.Drop=6]="Drop",n[n.Scroll=7]="Scroll",n[n.UpdateSelected=8]="UpdateSelected",n[n.Select=9]="Select",n[n.Deselect=10]="Deselect",n[n.Move=11]="Move",n[n.InitializePotentialDrag=12]="InitializePotentialDrag",n[n.BeginDrag=13]="BeginDrag",n[n.EndDrag=14]="EndDrag",n[n.Submit=15]="Submit",n[n.Cancel=16]="Cancel"})(hh||(hh={}));var JC=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};class ZC{constructor(){c(this,"eventID");c(this,"callback",new dn)}}JC([A()],ZC.prototype,"eventID",void 0);JC([A(dn)],ZC.prototype,"callback",void 0);class $C extends se{constructor(){super(...arguments);c(this,"triggers",[])}invoke(e){if(this.triggers)for(const i of this.triggers)i.eventID===e&&i.callback.invoke()}onPointerClick(e){this.invoke(hh.PointerClick)}onPointerEnter(e){this.invoke(hh.PointerEnter)}onPointerExit(e){this.invoke(hh.PointerExit)}onPointerDown(e){this.invoke(hh.PointerDown)}onPointerUp(e){this.invoke(hh.PointerUp)}}JC([A(ZC)],$C.prototype,"triggers",void 0);var eS=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};class tS extends se{constructor(){super(...arguments);c(this,"connectedBody");c(this,"_rigidBody",null)}get rigidBody(){return this._rigidBody}onEnable(){this._rigidBody||(this._rigidBody=this.gameObject.getComponent(Pt)),this.rigidBody&&this.connectedBody&&this.startCoroutine(this.create())}*create(){yield,this.rigidBody&&this.connectedBody&&this.activeAndEnabled&&this.createJoint(this.rigidBody,this.connectedBody)}}eS([A(Pt)],tS.prototype,"connectedBody",void 0);class jk extends tS{createJoint(t,e){var i;(i=this.context.physics.engine)==null||i.addFixedJoint(t,e)}}class f0 extends tS{constructor(){super(...arguments);c(this,"anchor");c(this,"axis")}createJoint(e,i){var s;this.axis&&this.anchor&&((s=this.context.physics.engine)==null||s.addHingeJoint(e,i,this.anchor,this.axis))}}eS([A(C)],f0.prototype,"anchor",void 0);eS([A(C)],f0.prototype,"axis",void 0);const UV={type:"change"};let NV=class extends Ml{constructor(t,e){super(),this.object=t,this.domElement=e,this.enabled=!0,this.movementSpeed=1,this.rollSpeed=.005,this.dragToLook=!1,this.autoForward=!1;const i=this,s=1e-6,r=new ne,o=new C;this.tmpQuaternion=new ne,this.status=0,this.moveState={up:0,down:0,left:0,right:0,forward:0,back:0,pitchUp:0,pitchDown:0,yawLeft:0,yawRight:0,rollLeft:0,rollRight:0},this.moveVector=new C(0,0,0),this.rotationVector=new C(0,0,0),this.keydown=function(g){if(!(g.altKey||this.enabled===!1)){switch(g.code){case"ShiftLeft":case"ShiftRight":this.movementSpeedMultiplier=.1;break;case"KeyW":this.moveState.forward=1;break;case"KeyS":this.moveState.back=1;break;case"KeyA":this.moveState.left=1;break;case"KeyD":this.moveState.right=1;break;case"KeyR":this.moveState.up=1;break;case"KeyF":this.moveState.down=1;break;case"ArrowUp":this.moveState.pitchUp=1;break;case"ArrowDown":this.moveState.pitchDown=1;break;case"ArrowLeft":this.moveState.yawLeft=1;break;case"ArrowRight":this.moveState.yawRight=1;break;case"KeyQ":this.moveState.rollLeft=1;break;case"KeyE":this.moveState.rollRight=1;break}this.updateMovementVector(),this.updateRotationVector()}},this.keyup=function(g){if(this.enabled!==!1){switch(g.code){case"ShiftLeft":case"ShiftRight":this.movementSpeedMultiplier=1;break;case"KeyW":this.moveState.forward=0;break;case"KeyS":this.moveState.back=0;break;case"KeyA":this.moveState.left=0;break;case"KeyD":this.moveState.right=0;break;case"KeyR":this.moveState.up=0;break;case"KeyF":this.moveState.down=0;break;case"ArrowUp":this.moveState.pitchUp=0;break;case"ArrowDown":this.moveState.pitchDown=0;break;case"ArrowLeft":this.moveState.yawLeft=0;break;case"ArrowRight":this.moveState.yawRight=0;break;case"KeyQ":this.moveState.rollLeft=0;break;case"KeyE":this.moveState.rollRight=0;break}this.updateMovementVector(),this.updateRotationVector()}},this.pointerdown=function(g){if(this.enabled!==!1)if(this.dragToLook)this.status++;else{switch(g.button){case 0:this.moveState.forward=1;break;case 2:this.moveState.back=1;break}this.updateMovementVector()}},this.pointermove=function(g){if(this.enabled!==!1&&(!this.dragToLook||this.status>0)){const m=this.getContainerDimensions(),v=m.size[0]/2,y=m.size[1]/2;this.moveState.yawLeft=-(g.pageX-m.offset[0]-v)/v,this.moveState.pitchDown=(g.pageY-m.offset[1]-y)/y,this.updateRotationVector()}},this.pointerup=function(g){if(this.enabled!==!1){if(this.dragToLook)this.status--,this.moveState.yawLeft=this.moveState.pitchDown=0;else{switch(g.button){case 0:this.moveState.forward=0;break;case 2:this.moveState.back=0;break}this.updateMovementVector()}this.updateRotationVector()}},this.pointercancel=function(){this.enabled!==!1&&(this.dragToLook?(this.status=0,this.moveState.yawLeft=this.moveState.pitchDown=0):(this.moveState.forward=0,this.moveState.back=0,this.updateMovementVector()),this.updateRotationVector())},this.contextMenu=function(g){this.enabled!==!1&&g.preventDefault()},this.update=function(g){if(this.enabled===!1)return;const m=g*i.movementSpeed,v=g*i.rollSpeed;i.object.translateX(i.moveVector.x*m),i.object.translateY(i.moveVector.y*m),i.object.translateZ(i.moveVector.z*m),i.tmpQuaternion.set(i.rotationVector.x*v,i.rotationVector.y*v,i.rotationVector.z*v,1).normalize(),i.object.quaternion.multiply(i.tmpQuaternion),(o.distanceToSquared(i.object.position)>s||8*(1-r.dot(i.object.quaternion))>s)&&(i.dispatchEvent(UV),r.copy(i.object.quaternion),o.copy(i.object.position))},this.updateMovementVector=function(){const g=this.moveState.forward||this.autoForward&&!this.moveState.back?1:0;this.moveVector.x=-this.moveState.left+this.moveState.right,this.moveVector.y=-this.moveState.down+this.moveState.up,this.moveVector.z=-g+this.moveState.back},this.updateRotationVector=function(){this.rotationVector.x=-this.moveState.pitchDown+this.moveState.pitchUp,this.rotationVector.y=-this.moveState.yawRight+this.moveState.yawLeft,this.rotationVector.z=-this.moveState.rollRight+this.moveState.rollLeft},this.getContainerDimensions=function(){return this.domElement!=document?{size:[this.domElement.offsetWidth,this.domElement.offsetHeight],offset:[this.domElement.offsetLeft,this.domElement.offsetTop]}:{size:[window.innerWidth,window.innerHeight],offset:[0,0]}},this.dispose=function(){this.domElement.removeEventListener("contextmenu",a),this.domElement.removeEventListener("pointerdown",h),this.domElement.removeEventListener("pointermove",l),this.domElement.removeEventListener("pointerup",u),this.domElement.removeEventListener("pointercancel",d),window.removeEventListener("keydown",f),window.removeEventListener("keyup",p)};const a=this.contextMenu.bind(this),l=this.pointermove.bind(this),h=this.pointerdown.bind(this),u=this.pointerup.bind(this),d=this.pointercancel.bind(this),f=this.keydown.bind(this),p=this.keyup.bind(this);this.domElement.addEventListener("contextmenu",a),this.domElement.addEventListener("pointerdown",h),this.domElement.addEventListener("pointermove",l),this.domElement.addEventListener("pointerup",u),this.domElement.addEventListener("pointercancel",d),window.addEventListener("keydown",f),window.addEventListener("keyup",p),this.updateMovementVector(),this.updateRotationVector()}};class Gk extends se{constructor(){super(...arguments);c(this,"_controls",null)}onEnable(){var i;const e=(i=z.getComponent(this.gameObject,Bt))==null?void 0:i.cam;if(!e){console.warn("FlyControls: Requires a Camera component on the same object as this component.");return}this._controls=new NV(e,this.context.renderer.domElement),this._controls.rollSpeed=.5,this._controls.movementSpeed=3,this._controls.dragToLook=!0}onDisable(){var e;(e=this._controls)==null||e.dispose(),this._controls=null}update(){this._controls&&this._controls.update(this.context.time.deltaTime)}}var iS=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r},Hw;(function(n){n[n.Linear=1]="Linear",n[n.Exponential=2]="Exponential",n[n.ExponentialSquared=3]="ExponentialSquared"})(Hw||(Hw={}));class im extends se{constructor(){super(...arguments);c(this,"_fog")}get fog(){return this._fog||(this._fog=new WR(0,0,50)),this._fog}get mode(){return Hw.Linear}set near(e){this.fog.near=e}get near(){return this.fog.near}set far(e){this.fog.far=e}get far(){return this.fog.far}set color(e){this.fog.color.copy(e)}get color(){return this.fog.color}onEnable(){this.scene.fog=this.fog}onDisable(){this.scene.fog===this._fog&&(this.scene.fog=null)}}iS([A()],im.prototype,"near",null);iS([A()],im.prototype,"far",null);iS([A(we)],im.prototype,"color",null);let zf,$b,Iu,uA;function e_(n,t=1/0,e=null){$b||($b=new Ys(2,2,1,1)),Iu||(Iu=new $e({uniforms:{blitTexture:new $(n)},vertexShader:`
			varying vec2 vUv;
			void main(){
				vUv = uv;
				gl_Position = vec4(position.xy * 1.0,0.,.999999);
			}`,fragmentShader:`
			uniform sampler2D blitTexture; 
			varying vec2 vUv;

			void main(){ 
				gl_FragColor = vec4(vUv.xy, 0, 1);
				
				#ifdef IS_SRGB
				gl_FragColor = LinearTosRGB( texture2D( blitTexture, vUv) );
				#else
				gl_FragColor = texture2D( blitTexture, vUv);
				#endif
			}`})),Iu.uniforms.blitTexture.value=n,Iu.defines.IS_SRGB=n.colorSpace==Ue,Iu.needsUpdate=!0,uA||(uA=new J($b,Iu),uA.frustrumCulled=!1);const i=new xt,s=new Ws;s.add(uA),e===null&&(e=zf=new Hh({antialias:!1}));const r=Math.min(n.image.width,t),o=Math.min(n.image.height,t);e.setSize(r,o),e.clear(),e.render(s,i);const a=document.createElement("canvas"),l=a.getContext("2d");a.width=r,a.height=o,l.drawImage(e.domElement,0,0,r,o);const h=new tB(a);return h.minFilter=n.minFilter,h.magFilter=n.magFilter,h.wrapS=n.wrapS,h.wrapT=n.wrapT,h.name=n.name,zf&&(zf.forceContextLoss(),zf.dispose(),zf=null),h}const fT={POSITION:["byte","byte normalized","unsigned byte","unsigned byte normalized","short","short normalized","unsigned short","unsigned short normalized"],NORMAL:["byte normalized","short normalized"],TANGENT:["byte normalized","short normalized"],TEXCOORD:["byte","byte normalized","unsigned byte","short","short normalized","unsigned short"]};class nS{constructor(){this.pluginCallbacks=[],this.register(function(t){return new YV(t)}),this.register(function(t){return new KV(t)}),this.register(function(t){return new $V(t)}),this.register(function(t){return new e9(t)}),this.register(function(t){return new t9(t)}),this.register(function(t){return new i9(t)}),this.register(function(t){return new JV(t)}),this.register(function(t){return new ZV(t)}),this.register(function(t){return new n9(t)}),this.register(function(t){return new s9(t)}),this.register(function(t){return new r9(t)}),this.register(function(t){return new o9(t)}),this.register(function(t){return new a9(t)})}register(t){return this.pluginCallbacks.indexOf(t)===-1&&this.pluginCallbacks.push(t),this}unregister(t){return this.pluginCallbacks.indexOf(t)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(t),1),this}parse(t,e,i,s){const r=new XV,o=[];for(let a=0,l=this.pluginCallbacks.length;a<l;a++)o.push(this.pluginCallbacks[a](r));r.setPlugins(o),r.write(t,e,s).catch(i)}parseAsync(t,e){const i=this;return new Promise(function(s,r){i.parse(t,s,r,e)})}}const ot={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,ARRAY_BUFFER:34962,ELEMENT_ARRAY_BUFFER:34963,NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,REPEAT:10497},t_="KHR_mesh_quantization",gr={};gr[Wt]=ot.NEAREST;gr[BR]=ot.NEAREST_MIPMAP_NEAREST;gr[MR]=ot.NEAREST_MIPMAP_LINEAR;gr[Tt]=ot.LINEAR;gr[PR]=ot.LINEAR_MIPMAP_NEAREST;gr[Bg]=ot.LINEAR_MIPMAP_LINEAR;gr[ZA]=ot.CLAMP_TO_EDGE;gr[Sl]=ot.REPEAT;gr[DR]=ot.MIRRORED_REPEAT;const pT={scale:"scale",position:"translation",quaternion:"rotation",morphTargetInfluences:"weights"},QV=new we,gT=12,zV=1179937895,jV=2,mT=8,GV=1313821514,HV=5130562;function cp(n,t){return n.length===t.length&&n.every(function(e,i){return e===t[i]})}function VV(n){return new TextEncoder().encode(n).buffer}function WV(n){return cp(n.elements,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}function qV(n,t,e){const i={min:new Array(n.itemSize).fill(Number.POSITIVE_INFINITY),max:new Array(n.itemSize).fill(Number.NEGATIVE_INFINITY)};for(let s=t;s<t+e;s++)for(let r=0;r<n.itemSize;r++){let o;n.itemSize>4?o=n.array[s*n.itemSize+r]:(r===0?o=n.getX(s):r===1?o=n.getY(s):r===2?o=n.getZ(s):r===3&&(o=n.getW(s)),n.normalized===!0&&(o=vt.normalize(o,n.array))),i.min[r]=Math.min(i.min[r],o),i.max[r]=Math.max(i.max[r],o)}return i}function Hk(n){return Math.ceil(n/4)*4}function i_(n,t=0){const e=Hk(n.byteLength);if(e!==n.byteLength){const i=new Uint8Array(e);if(i.set(new Uint8Array(n)),t!==0)for(let s=n.byteLength;s<e;s++)i[s]=t;return i.buffer}return n}function AT(){return typeof document>"u"&&typeof OffscreenCanvas<"u"?new OffscreenCanvas(1,1):document.createElement("canvas")}function vT(n,t){if(n.toBlob!==void 0)return new Promise(i=>n.toBlob(i,t));let e;return t==="image/jpeg"?e=.92:t==="image/webp"&&(e=.8),n.convertToBlob({type:t,quality:e})}class XV{constructor(){this.plugins=[],this.options={},this.pending=[],this.buffers=[],this.byteOffset=0,this.buffers=[],this.nodeMap=new Map,this.skins=[],this.extensionsUsed={},this.extensionsRequired={},this.uids=new Map,this.uid=0,this.json={asset:{version:"2.0",generator:"THREE.GLTFExporter"}},this.cache={meshes:new Map,attributes:new Map,attributesNormalized:new Map,materials:new Map,textures:new Map,images:new Map}}setPlugins(t){this.plugins=t}async write(t,e,i={}){this.options=Object.assign({binary:!1,trs:!1,onlyVisible:!0,maxTextureSize:1/0,animations:[],includeCustomExtensions:!1},i),this.options.animations.length>0&&(this.options.trs=!0),this.processInput(t),await Promise.all(this.pending);const s=this,r=s.buffers,o=s.json;i=s.options;const a=s.extensionsUsed,l=s.extensionsRequired,h=new Blob(r,{type:"application/octet-stream"}),u=Object.keys(a),d=Object.keys(l);if(u.length>0&&(o.extensionsUsed=u),d.length>0&&(o.extensionsRequired=d),o.buffers&&o.buffers.length>0&&(o.buffers[0].byteLength=h.size),i.binary===!0){const f=new FileReader;f.readAsArrayBuffer(h),f.onloadend=function(){const p=i_(f.result),g=new DataView(new ArrayBuffer(mT));g.setUint32(0,p.byteLength,!0),g.setUint32(4,HV,!0);const m=i_(VV(JSON.stringify(o)),32),v=new DataView(new ArrayBuffer(mT));v.setUint32(0,m.byteLength,!0),v.setUint32(4,GV,!0);const y=new ArrayBuffer(gT),b=new DataView(y);b.setUint32(0,zV,!0),b.setUint32(4,jV,!0);const _=gT+v.byteLength+m.byteLength+g.byteLength+p.byteLength;b.setUint32(8,_,!0);const x=new Blob([y,v,m,g,p],{type:"application/octet-stream"}),S=new FileReader;S.readAsArrayBuffer(x),S.onloadend=function(){e(S.result)}}}else if(o.buffers&&o.buffers.length>0){const f=new FileReader;f.readAsDataURL(h),f.onloadend=function(){const p=f.result;o.buffers[0].uri=p,e(o)}}else e(o)}serializeUserData(t,e){if(Object.keys(t.userData).length===0)return;const i=this.options,s=this.extensionsUsed;try{const r=JSON.parse(JSON.stringify(t.userData));if(i.includeCustomExtensions&&r.gltfExtensions){e.extensions===void 0&&(e.extensions={});for(const o in r.gltfExtensions)e.extensions[o]=r.gltfExtensions[o],s[o]=!0;delete r.gltfExtensions}Object.keys(r).length>0&&(e.extras=r)}catch(r){console.warn("THREE.GLTFExporter: userData of '"+t.name+"' won't be serialized because of JSON.stringify error - "+r.message)}}getUID(t,e=!1){if(this.uids.has(t)===!1){const s=new Map;s.set(!0,this.uid++),s.set(!1,this.uid++),this.uids.set(t,s)}return this.uids.get(t).get(e)}isNormalizedNormalAttribute(t){if(this.cache.attributesNormalized.has(t))return!1;const i=new C;for(let s=0,r=t.count;s<r;s++)if(Math.abs(i.fromBufferAttribute(t,s).length()-1)>5e-4)return!1;return!0}createNormalizedNormalAttribute(t){const e=this.cache;if(e.attributesNormalized.has(t))return e.attributesNormalized.get(t);const i=t.clone(),s=new C;for(let r=0,o=i.count;r<o;r++)s.fromBufferAttribute(i,r),s.x===0&&s.y===0&&s.z===0?s.setX(1):s.normalize(),i.setXYZ(r,s.x,s.y,s.z);return e.attributesNormalized.set(t,i),i}applyTextureTransform(t,e){let i=!1;const s={};(e.offset.x!==0||e.offset.y!==0)&&(s.offset=e.offset.toArray(),i=!0),e.rotation!==0&&(s.rotation=e.rotation,i=!0),(e.repeat.x!==1||e.repeat.y!==1)&&(s.scale=e.repeat.toArray(),i=!0),i&&(t.extensions=t.extensions||{},t.extensions.KHR_texture_transform=s,this.extensionsUsed.KHR_texture_transform=!0)}buildMetalRoughTexture(t,e){if(t===e)return t;function i(p){return p.colorSpace===Ue?function(m){return m<.04045?m*.0773993808:Math.pow(m*.9478672986+.0521327014,2.4)}:function(m){return m}}console.warn("THREE.GLTFExporter: Merged metalnessMap and roughnessMap textures."),t instanceof fd&&(t=e_(t)),e instanceof fd&&(e=e_(e));const s=t?t.image:null,r=e?e.image:null,o=Math.max(s?s.width:0,r?r.width:0),a=Math.max(s?s.height:0,r?r.height:0),l=AT();l.width=o,l.height=a;const h=l.getContext("2d");h.fillStyle="#00ffff",h.fillRect(0,0,o,a);const u=h.getImageData(0,0,o,a);if(s){h.drawImage(s,0,0,o,a);const p=i(t),g=h.getImageData(0,0,o,a).data;for(let m=2;m<g.length;m+=4)u.data[m]=p(g[m]/256)*256}if(r){h.drawImage(r,0,0,o,a);const p=i(e),g=h.getImageData(0,0,o,a).data;for(let m=1;m<g.length;m+=4)u.data[m]=p(g[m]/256)*256}h.putImageData(u,0,0);const f=(t||e).clone();return f.source=new LR(l),f.colorSpace=Fh,f.channel=(t||e).channel,t&&e&&t.channel!==e.channel&&console.warn("THREE.GLTFExporter: UV channels for metalnessMap and roughnessMap textures must match."),f}processBuffer(t){const e=this.json,i=this.buffers;return e.buffers||(e.buffers=[{byteLength:0}]),i.push(t),0}processBufferView(t,e,i,s,r){const o=this.json;o.bufferViews||(o.bufferViews=[]);let a;switch(e){case ot.BYTE:case ot.UNSIGNED_BYTE:a=1;break;case ot.SHORT:case ot.UNSIGNED_SHORT:a=2;break;default:a=4}const l=Hk(s*t.itemSize*a),h=new DataView(new ArrayBuffer(l));let u=0;for(let p=i;p<i+s;p++)for(let g=0;g<t.itemSize;g++){let m;t.itemSize>4?m=t.array[p*t.itemSize+g]:(g===0?m=t.getX(p):g===1?m=t.getY(p):g===2?m=t.getZ(p):g===3&&(m=t.getW(p)),t.normalized===!0&&(m=vt.normalize(m,t.array))),e===ot.FLOAT?h.setFloat32(u,m,!0):e===ot.INT?h.setInt32(u,m,!0):e===ot.UNSIGNED_INT?h.setUint32(u,m,!0):e===ot.SHORT?h.setInt16(u,m,!0):e===ot.UNSIGNED_SHORT?h.setUint16(u,m,!0):e===ot.BYTE?h.setInt8(u,m):e===ot.UNSIGNED_BYTE&&h.setUint8(u,m),u+=a}const d={buffer:this.processBuffer(h.buffer),byteOffset:this.byteOffset,byteLength:l};return r!==void 0&&(d.target=r),r===ot.ARRAY_BUFFER&&(d.byteStride=t.itemSize*a),this.byteOffset+=l,o.bufferViews.push(d),{id:o.bufferViews.length-1,byteLength:0}}processBufferViewImage(t){const e=this,i=e.json;return i.bufferViews||(i.bufferViews=[]),new Promise(function(s){const r=new FileReader;r.readAsArrayBuffer(t),r.onloadend=function(){const o=i_(r.result),a={buffer:e.processBuffer(o),byteOffset:e.byteOffset,byteLength:o.byteLength};e.byteOffset+=o.byteLength,s(i.bufferViews.push(a)-1)}})}processAccessor(t,e,i,s){const r=this.json,o={1:"SCALAR",2:"VEC2",3:"VEC3",4:"VEC4",9:"MAT3",16:"MAT4"};let a;if(t.array.constructor===Float32Array)a=ot.FLOAT;else if(t.array.constructor===Int32Array)a=ot.INT;else if(t.array.constructor===Uint32Array)a=ot.UNSIGNED_INT;else if(t.array.constructor===Int16Array)a=ot.SHORT;else if(t.array.constructor===Uint16Array)a=ot.UNSIGNED_SHORT;else if(t.array.constructor===Int8Array)a=ot.BYTE;else if(t.array.constructor===Uint8Array)a=ot.UNSIGNED_BYTE;else throw new Error("THREE.GLTFExporter: Unsupported bufferAttribute component type: "+t.array.constructor.name);if(i===void 0&&(i=0),(s===void 0||s===1/0)&&(s=t.count),s===0)return null;const l=qV(t,i,s);let h;e!==void 0&&(h=t===e.index?ot.ELEMENT_ARRAY_BUFFER:ot.ARRAY_BUFFER);const u=this.processBufferView(t,a,i,s,h),d={bufferView:u.id,byteOffset:u.byteOffset,componentType:a,count:s,max:l.max,min:l.min,type:o[t.itemSize]};return t.normalized===!0&&(d.normalized=!0),r.accessors||(r.accessors=[]),r.accessors.push(d)-1}processImage(t,e,i,s="image/png"){if(t!==null){const r=this,o=r.cache,a=r.json,l=r.options,h=r.pending;o.images.has(t)||o.images.set(t,{});const u=o.images.get(t),d=s+":flipY/"+i.toString();if(u[d]!==void 0)return u[d];a.images||(a.images=[]);const f={mimeType:s},p=AT();p.width=Math.min(t.width,l.maxTextureSize),p.height=Math.min(t.height,l.maxTextureSize);const g=p.getContext("2d");if(i===!0&&(g.translate(0,p.height),g.scale(1,-1)),t.data!==void 0){e!==kn&&console.error("GLTFExporter: Only RGBAFormat is supported.",e),(t.width>l.maxTextureSize||t.height>l.maxTextureSize)&&console.warn("GLTFExporter: Image size is bigger than maxTextureSize",t);const v=new Uint8ClampedArray(t.height*t.width*4);for(let y=0;y<v.length;y+=4)v[y+0]=t.data[y+0],v[y+1]=t.data[y+1],v[y+2]=t.data[y+2],v[y+3]=t.data[y+3];g.putImageData(new ImageData(v,t.width,t.height),0,0)}else if(typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&t instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas)g.drawImage(t,0,0,p.width,p.height);else throw new Error("THREE.GLTFExporter: Invalid image type. Use HTMLImageElement, HTMLCanvasElement, ImageBitmap or OffscreenCanvas.");l.binary===!0?h.push(vT(p,s).then(v=>r.processBufferViewImage(v)).then(v=>{f.bufferView=v})):p.toDataURL!==void 0?f.uri=p.toDataURL(s):h.push(vT(p,s).then(v=>new FileReader().readAsDataURL(v)).then(v=>{f.uri=v}));const m=a.images.push(f)-1;return u[d]=m,m}else throw new Error("THREE.GLTFExporter: No valid image data found. Unable to process texture.")}processSampler(t){const e=this.json;e.samplers||(e.samplers=[]);const i={magFilter:gr[t.magFilter],minFilter:gr[t.minFilter],wrapS:gr[t.wrapS],wrapT:gr[t.wrapT]};return e.samplers.push(i)-1}processTexture(t){const i=this.options,s=this.cache,r=this.json;if(s.textures.has(t))return s.textures.get(t);r.textures||(r.textures=[]),t instanceof fd&&(t=e_(t,i.maxTextureSize));let o=t.userData.mimeType;o==="image/webp"&&(o="image/png");const a={sampler:this.processSampler(t),source:this.processImage(t.image,t.format,t.flipY,o)};t.name&&(a.name=t.name),this._invokeAll(function(h){h.writeTexture&&h.writeTexture(t,a)});const l=r.textures.push(a)-1;return s.textures.set(t,l),l}processMaterial(t){var h,u,d,f,p;const e=this.cache,i=this.json;if(e.materials.has(t))return e.materials.get(t);if(t.isShaderMaterial)return console.warn("GLTFExporter: THREE.ShaderMaterial not supported."),null;i.materials||(i.materials=[]);const s={pbrMetallicRoughness:{}};t.isMeshStandardMaterial!==!0&&t.isMeshBasicMaterial!==!0&&console.warn("GLTFExporter: Use MeshStandardMaterial or MeshBasicMaterial for best results.");const r=t.color.toArray().concat([t.opacity]);cp(r,[1,1,1,1])||(s.pbrMetallicRoughness.baseColorFactor=r),t.isMeshStandardMaterial?(s.pbrMetallicRoughness.metallicFactor=t.metalness,s.pbrMetallicRoughness.roughnessFactor=t.roughness):(s.pbrMetallicRoughness.metallicFactor=.5,s.pbrMetallicRoughness.roughnessFactor=.5);const o=(h=t.metalnessMap)!=null&&h.image?t.metalnessMap:void 0,a=(u=t.roughnessMap)!=null&&u.image?t.roughnessMap:void 0;if(o||a){const g=this.buildMetalRoughTexture(o,a),m={index:this.processTexture(g),channel:g.channel};this.applyTextureTransform(m,g),s.pbrMetallicRoughness.metallicRoughnessTexture=m}if(t.map){const g={index:this.processTexture(t.map),texCoord:t.map.channel};this.applyTextureTransform(g,t.map),s.pbrMetallicRoughness.baseColorTexture=g}if(t.emissive){const g=t.emissive;if(Math.max(g.r,g.g,g.b)>0&&(s.emissiveFactor=t.emissive.toArray()),(d=t.emissiveMap)!=null&&d.image){const v={index:this.processTexture(t.emissiveMap),texCoord:t.emissiveMap.channel};this.applyTextureTransform(v,t.emissiveMap),s.emissiveTexture=v}}if((f=t.normalMap)!=null&&f.image){const g={index:this.processTexture(t.normalMap),texCoord:t.normalMap.channel};t.normalScale&&t.normalScale.x!==1&&(g.scale=t.normalScale.x),this.applyTextureTransform(g,t.normalMap),s.normalTexture=g}if((p=t.aoMap)!=null&&p.image){const g={index:this.processTexture(t.aoMap),texCoord:t.aoMap.channel};t.aoMapIntensity!==1&&(g.strength=t.aoMapIntensity),this.applyTextureTransform(g,t.aoMap),s.occlusionTexture=g}t.transparent?s.alphaMode="BLEND":t.alphaTest>0&&(s.alphaMode="MASK",s.alphaCutoff=t.alphaTest),t.side===pi&&(s.doubleSided=!0),t.name!==""&&(s.name=t.name),this.serializeUserData(t,s),this._invokeAll(function(g){g.writeMaterial&&g.writeMaterial(t,s)});const l=i.materials.push(s)-1;return e.materials.set(t,l),l}processMesh(t){const e=this.cache,i=this.json,s=[t.geometry.uuid];if(Array.isArray(t.material))for(let x=0,S=t.material.length;x<S;x++)s.push(t.material[x].uuid);else s.push(t.material.uuid);const r=s.join(":");if(e.meshes.has(r))return e.meshes.get(r);const o=t.geometry;let a;t.isLineSegments?a=ot.LINES:t.isLineLoop?a=ot.LINE_LOOP:t.isLine?a=ot.LINE_STRIP:t.isPoints?a=ot.POINTS:a=t.material.wireframe?ot.LINES:ot.TRIANGLES;const l={},h={},u=[],d=[],f={uv:"TEXCOORD_0",uv1:"TEXCOORD_1",uv2:"TEXCOORD_2",uv3:"TEXCOORD_3",color:"COLOR_0",skinWeight:"WEIGHTS_0",skinIndex:"JOINTS_0"},p=o.getAttribute("normal");p!==void 0&&!this.isNormalizedNormalAttribute(p)&&(console.warn("THREE.GLTFExporter: Creating normalized normal attribute from the non-normalized one."),o.setAttribute("normal",this.createNormalizedNormalAttribute(p)));let g=null;for(let x in o.attributes){if(x.slice(0,5)==="morph")continue;const S=o.attributes[x];if(x=f[x]||x.toUpperCase(),/^(POSITION|NORMAL|TANGENT|TEXCOORD_\d+|COLOR_\d+|JOINTS_\d+|WEIGHTS_\d+)$/.test(x)||(x="_"+x),e.attributes.has(this.getUID(S))){h[x]=e.attributes.get(this.getUID(S));continue}g=null;const L=S.array;x==="JOINTS_0"&&!(L instanceof Uint16Array)&&!(L instanceof Uint8Array)&&(console.warn('GLTFExporter: Attribute "skinIndex" converted to type UNSIGNED_SHORT.'),g=new Ve(new Uint16Array(L),S.itemSize,S.normalized));const I=this.processAccessor(g||S,o);I!==null&&(x.startsWith("_")||this.detectMeshQuantization(x,S),h[x]=I,e.attributes.set(this.getUID(S),I))}if(p!==void 0&&o.setAttribute("normal",p),Object.keys(h).length===0)return null;if(t.morphTargetInfluences!==void 0&&t.morphTargetInfluences.length>0){const x=[],S=[],T={};if(t.morphTargetDictionary!==void 0)for(const L in t.morphTargetDictionary)T[t.morphTargetDictionary[L]]=L;for(let L=0;L<t.morphTargetInfluences.length;++L){const I={};let P=!1;for(const R in o.morphAttributes){if(R!=="position"&&R!=="normal"){P||(console.warn("GLTFExporter: Only POSITION and NORMAL morph are supported."),P=!0);continue}const B=o.morphAttributes[R][L],Q=R.toUpperCase(),G=o.attributes[R];if(e.attributes.has(this.getUID(B,!0))){I[Q]=e.attributes.get(this.getUID(B,!0));continue}const V=B.clone();if(!o.morphTargetsRelative)for(let X=0,k=B.count;X<k;X++)for(let M=0;M<B.itemSize;M++)M===0&&V.setX(X,B.getX(X)-G.getX(X)),M===1&&V.setY(X,B.getY(X)-G.getY(X)),M===2&&V.setZ(X,B.getZ(X)-G.getZ(X)),M===3&&V.setW(X,B.getW(X)-G.getW(X));I[Q]=this.processAccessor(V,o),e.attributes.set(this.getUID(G,!0),I[Q])}d.push(I),x.push(t.morphTargetInfluences[L]),t.morphTargetDictionary!==void 0&&S.push(T[L])}l.weights=x,S.length>0&&(l.extras={},l.extras.targetNames=S)}const m=Array.isArray(t.material);if(m&&o.groups.length===0)return null;let v=!1;if(m&&o.index===null){const x=[];for(let S=0,T=o.attributes.position.count;S<T;S++)x[S]=S;o.setIndex(x),v=!0}const y=m?t.material:[t.material],b=m?o.groups:[{materialIndex:0,start:void 0,count:void 0}];for(let x=0,S=b.length;x<S;x++){const T={mode:a,attributes:h};if(this.serializeUserData(o,T),d.length>0&&(T.targets=d),o.index!==null){let I=this.getUID(o.index);(b[x].start!==void 0||b[x].count!==void 0)&&(I+=":"+b[x].start+":"+b[x].count),e.attributes.has(I)?T.indices=e.attributes.get(I):(T.indices=this.processAccessor(o.index,o,b[x].start,b[x].count),e.attributes.set(I,T.indices)),T.indices===null&&delete T.indices}const L=this.processMaterial(y[b[x].materialIndex]);L!==null&&(T.material=L),u.push(T)}v===!0&&o.setIndex(null),l.primitives=u,i.meshes||(i.meshes=[]),this._invokeAll(function(x){x.writeMesh&&x.writeMesh(t,l)});const _=i.meshes.push(l)-1;return e.meshes.set(r,_),_}detectMeshQuantization(t,e){if(this.extensionsUsed[t_])return;let i;switch(e.array.constructor){case Int8Array:i="byte";break;case Uint8Array:i="unsigned byte";break;case Int16Array:i="short";break;case Uint16Array:i="unsigned short";break;default:return}e.normalized&&(i+=" normalized");const s=t.split("_",1)[0];fT[s]&&fT[s].includes(i)&&(this.extensionsUsed[t_]=!0,this.extensionsRequired[t_]=!0)}processCamera(t){const e=this.json;e.cameras||(e.cameras=[]);const i=t.isOrthographicCamera,s={type:i?"orthographic":"perspective"};return i?s.orthographic={xmag:t.right*2,ymag:t.top*2,zfar:t.far<=0?.001:t.far,znear:t.near<0?0:t.near}:s.perspective={aspectRatio:t.aspect,yfov:vt.degToRad(t.fov),zfar:t.far<=0?.001:t.far,znear:t.near<0?0:t.near},t.name!==""&&(s.name=t.type),e.cameras.push(s)-1}processAnimation(t,e){const i=this.json,s=this.nodeMap;i.animations||(i.animations=[]),t=nS.Utils.mergeMorphTargetTracks(t.clone(),e);const r=t.tracks,o=[],a=[];for(let l=0;l<r.length;++l){const h=r[l],u=vr.parseTrackName(h.name);let d=vr.findNode(e,u.nodeName);const f=pT[u.propertyName];if(u.objectName==="bones"&&(d.isSkinnedMesh===!0?d=d.skeleton.getBoneByName(u.objectIndex):d=void 0),!d||!f)return console.warn('THREE.GLTFExporter: Could not export animation track "%s".',h.name),null;const p=1;let g=h.values.length/h.times.length;f===pT.morphTargetInfluences&&(g/=d.morphTargetInfluences.length);let m;h.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline===!0?(m="CUBICSPLINE",g/=3):h.getInterpolation()===kR?m="STEP":m="LINEAR",a.push({input:this.processAccessor(new Ve(h.times,p)),output:this.processAccessor(new Ve(h.values,g)),interpolation:m}),o.push({sampler:a.length-1,target:{node:s.get(d),path:f}})}return i.animations.push({name:t.name||"clip_"+i.animations.length,samplers:a,channels:o}),i.animations.length-1}processSkin(t){const e=this.json,i=this.nodeMap,s=e.nodes[i.get(t)],r=t.skeleton;if(r===void 0)return null;const o=t.skeleton.bones[0];if(o===void 0)return null;const a=[],l=new Float32Array(r.bones.length*16),h=new ce;for(let d=0;d<r.bones.length;++d)a.push(i.get(r.bones[d])),h.copy(r.boneInverses[d]),h.multiply(t.bindMatrix).toArray(l,d*16);return e.skins===void 0&&(e.skins=[]),e.skins.push({inverseBindMatrices:this.processAccessor(new Ve(l,16)),joints:a,skeleton:i.get(o)}),s.skin=e.skins.length-1}processNode(t){const e=this.json,i=this.options,s=this.nodeMap;e.nodes||(e.nodes=[]);const r={};if(i.trs){const a=t.quaternion.toArray(),l=t.position.toArray(),h=t.scale.toArray();cp(a,[0,0,0,1])||(r.rotation=a),cp(l,[0,0,0])||(r.translation=l),cp(h,[1,1,1])||(r.scale=h)}else t.matrixAutoUpdate&&t.updateMatrix(),WV(t.matrix)===!1&&(r.matrix=t.matrix.elements);if(t.name!==""&&(r.name=String(t.name)),this.serializeUserData(t,r),t.isMesh||t.isLine||t.isPoints){const a=this.processMesh(t);a!==null&&(r.mesh=a)}else t.isCamera&&(r.camera=this.processCamera(t));if(t.isSkinnedMesh&&this.skins.push(t),t.children.length>0){const a=[];for(let l=0,h=t.children.length;l<h;l++){const u=t.children[l];if(u.visible||i.onlyVisible===!1){const d=this.processNode(u);d!==null&&a.push(d)}}a.length>0&&(r.children=a)}this._invokeAll(function(a){a.writeNode&&a.writeNode(t,r)});const o=e.nodes.push(r)-1;return s.set(t,o),o}processScene(t){const e=this.json,i=this.options;e.scenes||(e.scenes=[],e.scene=0);const s={};t.name!==""&&(s.name=t.name),e.scenes.push(s);const r=[];for(let o=0,a=t.children.length;o<a;o++){const l=t.children[o];if(l.visible||i.onlyVisible===!1){const h=this.processNode(l);h!==null&&r.push(h)}}r.length>0&&(s.nodes=r),this.serializeUserData(t,s)}processObjects(t){const e=new Ws;e.name="AuxScene";for(let i=0;i<t.length;i++)e.children.push(t[i]);this.processScene(e)}processInput(t){const e=this.options;t=t instanceof Array?t:[t],this._invokeAll(function(s){s.beforeParse&&s.beforeParse(t)});const i=[];for(let s=0;s<t.length;s++)t[s]instanceof Ws?this.processScene(t[s]):i.push(t[s]);i.length>0&&this.processObjects(i);for(let s=0;s<this.skins.length;++s)this.processSkin(this.skins[s]);for(let s=0;s<e.animations.length;++s)this.processAnimation(e.animations[s],t[0]);this._invokeAll(function(s){s.afterParse&&s.afterParse(t)})}_invokeAll(t){for(let e=0,i=this.plugins.length;e<i;e++)t(this.plugins[e])}}class YV{constructor(t){this.writer=t,this.name="KHR_lights_punctual"}writeNode(t,e){if(!t.isLight)return;if(!t.isDirectionalLight&&!t.isPointLight&&!t.isSpotLight){console.warn("THREE.GLTFExporter: Only directional, point, and spot lights are supported.",t);return}const i=this.writer,s=i.json,r=i.extensionsUsed,o={};t.name&&(o.name=t.name),o.color=t.color.toArray(),o.intensity=t.intensity,t.isDirectionalLight?o.type="directional":t.isPointLight?(o.type="point",t.distance>0&&(o.range=t.distance)):t.isSpotLight&&(o.type="spot",t.distance>0&&(o.range=t.distance),o.spot={},o.spot.innerConeAngle=(1-t.penumbra)*t.angle,o.spot.outerConeAngle=t.angle),t.decay!==void 0&&t.decay!==2&&console.warn("THREE.GLTFExporter: Light decay may be lost. glTF is physically-based, and expects light.decay=2."),t.target&&(t.target.parent!==t||t.target.position.x!==0||t.target.position.y!==0||t.target.position.z!==-1)&&console.warn("THREE.GLTFExporter: Light direction may be lost. For best results, make light.target a child of the light with position 0,0,-1."),r[this.name]||(s.extensions=s.extensions||{},s.extensions[this.name]={lights:[]},r[this.name]=!0);const a=s.extensions[this.name].lights;a.push(o),e.extensions=e.extensions||{},e.extensions[this.name]={light:a.length-1}}}class KV{constructor(t){this.writer=t,this.name="KHR_materials_unlit"}writeMaterial(t,e){if(!t.isMeshBasicMaterial)return;const s=this.writer.extensionsUsed;e.extensions=e.extensions||{},e.extensions[this.name]={},s[this.name]=!0,e.pbrMetallicRoughness.metallicFactor=0,e.pbrMetallicRoughness.roughnessFactor=.9}}class JV{constructor(t){this.writer=t,this.name="KHR_materials_clearcoat"}writeMaterial(t,e){if(!t.isMeshPhysicalMaterial||t.clearcoat===0)return;const i=this.writer,s=i.extensionsUsed,r={};if(r.clearcoatFactor=t.clearcoat,t.clearcoatMap){const o={index:i.processTexture(t.clearcoatMap),texCoord:t.clearcoatMap.channel};i.applyTextureTransform(o,t.clearcoatMap),r.clearcoatTexture=o}if(r.clearcoatRoughnessFactor=t.clearcoatRoughness,t.clearcoatRoughnessMap){const o={index:i.processTexture(t.clearcoatRoughnessMap),texCoord:t.clearcoatRoughnessMap.channel};i.applyTextureTransform(o,t.clearcoatRoughnessMap),r.clearcoatRoughnessTexture=o}if(t.clearcoatNormalMap){const o={index:i.processTexture(t.clearcoatNormalMap),texCoord:t.clearcoatNormalMap.channel};i.applyTextureTransform(o,t.clearcoatNormalMap),r.clearcoatNormalTexture=o}e.extensions=e.extensions||{},e.extensions[this.name]=r,s[this.name]=!0}}class ZV{constructor(t){this.writer=t,this.name="KHR_materials_iridescence"}writeMaterial(t,e){if(!t.isMeshPhysicalMaterial||t.iridescence===0)return;const i=this.writer,s=i.extensionsUsed,r={};if(r.iridescenceFactor=t.iridescence,t.iridescenceMap){const o={index:i.processTexture(t.iridescenceMap),texCoord:t.iridescenceMap.channel};i.applyTextureTransform(o,t.iridescenceMap),r.iridescenceTexture=o}if(r.iridescenceIor=t.iridescenceIOR,r.iridescenceThicknessMinimum=t.iridescenceThicknessRange[0],r.iridescenceThicknessMaximum=t.iridescenceThicknessRange[1],t.iridescenceThicknessMap){const o={index:i.processTexture(t.iridescenceThicknessMap),texCoord:t.iridescenceThicknessMap.channel};i.applyTextureTransform(o,t.iridescenceThicknessMap),r.iridescenceThicknessTexture=o}e.extensions=e.extensions||{},e.extensions[this.name]=r,s[this.name]=!0}}class $V{constructor(t){this.writer=t,this.name="KHR_materials_transmission"}writeMaterial(t,e){if(!t.isMeshPhysicalMaterial||t.transmission===0)return;const i=this.writer,s=i.extensionsUsed,r={};if(r.transmissionFactor=t.transmission,t.transmissionMap){const o={index:i.processTexture(t.transmissionMap),texCoord:t.transmissionMap.channel};i.applyTextureTransform(o,t.transmissionMap),r.transmissionTexture=o}e.extensions=e.extensions||{},e.extensions[this.name]=r,s[this.name]=!0}}class e9{constructor(t){this.writer=t,this.name="KHR_materials_volume"}writeMaterial(t,e){if(!t.isMeshPhysicalMaterial||t.transmission===0)return;const i=this.writer,s=i.extensionsUsed,r={};if(r.thicknessFactor=t.thickness,t.thicknessMap){const o={index:i.processTexture(t.thicknessMap),texCoord:t.thicknessMap.channel};i.applyTextureTransform(o,t.thicknessMap),r.thicknessTexture=o}r.attenuationDistance=t.attenuationDistance,r.attenuationColor=t.attenuationColor.toArray(),e.extensions=e.extensions||{},e.extensions[this.name]=r,s[this.name]=!0}}class t9{constructor(t){this.writer=t,this.name="KHR_materials_ior"}writeMaterial(t,e){if(!t.isMeshPhysicalMaterial||t.ior===1.5)return;const s=this.writer.extensionsUsed,r={};r.ior=t.ior,e.extensions=e.extensions||{},e.extensions[this.name]=r,s[this.name]=!0}}class i9{constructor(t){this.writer=t,this.name="KHR_materials_specular"}writeMaterial(t,e){if(!t.isMeshPhysicalMaterial||t.specularIntensity===1&&t.specularColor.equals(QV)&&!t.specularIntensityMap&&!t.specularColorMap)return;const i=this.writer,s=i.extensionsUsed,r={};if(t.specularIntensityMap){const o={index:i.processTexture(t.specularIntensityMap),texCoord:t.specularIntensityMap.channel};i.applyTextureTransform(o,t.specularIntensityMap),r.specularTexture=o}if(t.specularColorMap){const o={index:i.processTexture(t.specularColorMap),texCoord:t.specularColorMap.channel};i.applyTextureTransform(o,t.specularColorMap),r.specularColorTexture=o}r.specularFactor=t.specularIntensity,r.specularColorFactor=t.specularColor.toArray(),e.extensions=e.extensions||{},e.extensions[this.name]=r,s[this.name]=!0}}class n9{constructor(t){this.writer=t,this.name="KHR_materials_sheen"}writeMaterial(t,e){if(!t.isMeshPhysicalMaterial||t.sheen==0)return;const i=this.writer,s=i.extensionsUsed,r={};if(t.sheenRoughnessMap){const o={index:i.processTexture(t.sheenRoughnessMap),texCoord:t.sheenRoughnessMap.channel};i.applyTextureTransform(o,t.sheenRoughnessMap),r.sheenRoughnessTexture=o}if(t.sheenColorMap){const o={index:i.processTexture(t.sheenColorMap),texCoord:t.sheenColorMap.channel};i.applyTextureTransform(o,t.sheenColorMap),r.sheenColorTexture=o}r.sheenRoughnessFactor=t.sheenRoughness,r.sheenColorFactor=t.sheenColor.toArray(),e.extensions=e.extensions||{},e.extensions[this.name]=r,s[this.name]=!0}}class s9{constructor(t){this.writer=t,this.name="KHR_materials_anisotropy"}writeMaterial(t,e){if(!t.isMeshPhysicalMaterial||t.anisotropy==0)return;const i=this.writer,s=i.extensionsUsed,r={};if(t.anisotropyMap){const o={index:i.processTexture(t.anisotropyMap)};i.applyTextureTransform(o,t.anisotropyMap),r.anisotropyTexture=o}r.anisotropyStrength=t.anisotropy,r.anisotropyRotation=t.anisotropyRotation,e.extensions=e.extensions||{},e.extensions[this.name]=r,s[this.name]=!0}}class r9{constructor(t){this.writer=t,this.name="KHR_materials_emissive_strength"}writeMaterial(t,e){if(!t.isMeshStandardMaterial||t.emissiveIntensity===1)return;const s=this.writer.extensionsUsed,r={};r.emissiveStrength=t.emissiveIntensity,e.extensions=e.extensions||{},e.extensions[this.name]=r,s[this.name]=!0}}class o9{constructor(t){this.writer=t,this.name="EXT_materials_bump"}writeMaterial(t,e){if(!t.isMeshStandardMaterial||t.bumpScale===1&&!t.bumpMap)return;const i=this.writer,s=i.extensionsUsed,r={};if(t.bumpMap){const o={index:i.processTexture(t.bumpMap),texCoord:t.bumpMap.channel};i.applyTextureTransform(o,t.bumpMap),r.bumpTexture=o}r.bumpFactor=t.bumpScale,e.extensions=e.extensions||{},e.extensions[this.name]=r,s[this.name]=!0}}class a9{constructor(t){this.writer=t,this.name="EXT_mesh_gpu_instancing"}writeNode(t,e){if(!t.isInstancedMesh)return;const i=this.writer,s=t,r=new Float32Array(s.count*3),o=new Float32Array(s.count*4),a=new Float32Array(s.count*3),l=new ce,h=new C,u=new ne,d=new C;for(let p=0;p<s.count;p++)s.getMatrixAt(p,l),l.decompose(h,u,d),h.toArray(r,p*3),u.toArray(o,p*4),d.toArray(a,p*3);const f={TRANSLATION:i.processAccessor(new Ve(r,3)),ROTATION:i.processAccessor(new Ve(o,4)),SCALE:i.processAccessor(new Ve(a,3))};s.instanceColor&&(f._COLOR_0=i.processAccessor(s.instanceColor)),e.extensions=e.extensions||{},e.extensions[this.name]={attributes:f},i.extensionsUsed[this.name]=!0,i.extensionsRequired[this.name]=!0}}nS.Utils={insertKeyframe:function(n,t){const i=n.getValueSize(),s=new n.TimeBufferType(n.times.length+1),r=new n.ValueBufferType(n.values.length+i),o=n.createInterpolant(new n.ValueBufferType(i));let a;if(n.times.length===0){s[0]=t;for(let l=0;l<i;l++)r[l]=0;a=0}else if(t<n.times[0]){if(Math.abs(n.times[0]-t)<.001)return 0;s[0]=t,s.set(n.times,1),r.set(o.evaluate(t),0),r.set(n.values,i),a=0}else if(t>n.times[n.times.length-1]){if(Math.abs(n.times[n.times.length-1]-t)<.001)return n.times.length-1;s[s.length-1]=t,s.set(n.times,0),r.set(n.values,0),r.set(o.evaluate(t),n.values.length),a=s.length-1}else for(let l=0;l<n.times.length;l++){if(Math.abs(n.times[l]-t)<.001)return l;if(n.times[l]<t&&n.times[l+1]>t){s.set(n.times.slice(0,l+1),0),s[l+1]=t,s.set(n.times.slice(l+1),l+2),r.set(n.values.slice(0,(l+1)*i),0),r.set(o.evaluate(t),(l+1)*i),r.set(n.values.slice((l+1)*i),(l+2)*i),a=l+1;break}}return n.times=s,n.values=r,a},mergeMorphTargetTracks:function(n,t){const e=[],i={},s=n.tracks;for(let r=0;r<s.length;++r){let o=s[r];const a=vr.parseTrackName(o.name),l=vr.findNode(t,a.nodeName);if(a.propertyName!=="morphTargetInfluences"||a.propertyIndex===void 0){e.push(o);continue}if(o.createInterpolant!==o.InterpolantFactoryMethodDiscrete&&o.createInterpolant!==o.InterpolantFactoryMethodLinear){if(o.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline)throw new Error("THREE.GLTFExporter: Cannot merge tracks with glTF CUBICSPLINE interpolation.");console.warn("THREE.GLTFExporter: Morph target interpolation mode not yet supported. Using LINEAR instead."),o=o.clone(),o.setInterpolation(dx)}const h=l.morphTargetInfluences.length,u=l.morphTargetDictionary[a.propertyIndex];if(u===void 0)throw new Error("THREE.GLTFExporter: Morph target name not found: "+a.propertyIndex);let d;if(i[l.uuid]===void 0){d=o.clone();const p=new d.ValueBufferType(h*d.times.length);for(let g=0;g<d.times.length;g++)p[g*h+u]=d.values[g];d.name=(a.nodeName||"")+".morphTargetInfluences",d.values=p,i[l.uuid]=d,e.push(d);continue}const f=o.createInterpolant(new o.ValueBufferType(1));d=i[l.uuid];for(let p=0;p<d.times.length;p++)d.values[p*h+u]=f.evaluate(d.times[p]);for(let p=0;p<o.times.length;p++){const g=this.insertKeyframe(d,o.times[p]);d.values[g*h+u]=o.values[p]}}return n.tracks=e,n}};class l9{constructor(t){this.writer=t,this.name="EXT_mesh_gpu_instancing"}writeNode(t,e){if(t.constructor.name!=="InstancedMesh")return;const i=this.writer,s=i.extensionsUsed,r={};e.extensions=e.extensions||{},e.extensions[this.name]=r;let o=new ce;const a=new Array,l=new Array,h=new Array;for(let p=0;p<t.count;p++){t.getMatrixAt(p,o);let g=new C,m=new ne,v=new C;o.decompose(g,m,v),a.push(g.x,g.y,g.z),l.push(m.x,m.y,m.z,m.w),h.push(v.x,v.y,v.z)}const u=new Float32Array(a),d=new Float32Array(l),f=new Float32Array(h);r.attributes={TRANSLATION:i.processAccessor(new Ve(u,3)),ROTATION:i.processAccessor(new Ve(d,4)),SCALE:i.processAccessor(new Ve(f,3))},s[this.name]=!0}}var Vk=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};const dA=N("debuggltfexport");class Wk extends So{constructor(){super(...arguments);c(this,"sceneRoot")}}class _a extends se{constructor(){super(...arguments);c(this,"binary",!0);c(this,"objects",[]);c(this,"ext")}async exportNow(e){dA&&console.log("Exporting objects as glTF",this.objects),e||(e="scene"),(!this.objects||this.objects.length<=0)&&(this.objects=[this.context.scene]);const i={binary:this.binary,pivot:_a.calculateCenter(this.objects)},s=await this.export(this.objects,i).catch(r=>(console.error(r),!1));return s===!1?!1:(this.binary?e.endsWith(".glb")||(e+=".glb"):e.endsWith(".gltf")||(e+=".gltf"),this.binary?_a.saveArrayBuffer(s,e):_a.saveJson(s,e),!0)}async export(e,i){if(!e||e.length<=0){console.warn("No objects set to export");return}const s=new nS;s.register(h=>new l9(h)),WH(s,this.context),_a.filterTopmostParent(e);const r={trs:!1,onlyVisible:!0,truncateDrawRange:!1,binary:!0,maxTextureSize:1/0,embedImages:!0,includeCustomExtensions:!0,animations:(i==null?void 0:i.animations)||_a.collectAnimations(e),...i},o=new re;i!=null&&i.pivot&&o.position.sub(i.pivot),dA&&console.log("EXPORT",e),e.forEach(h=>{h&&(o.children.push(h),h.matrixAutoUpdate=!1,h.matrix.copy(h.matrixWorld),z.getComponentsInChildren(h,ci).forEach(u=>{z.isActiveInHierarchy(u.gameObject)&&u.setInstancingEnabled(!1)}))});const a=new FM(o);return this.ext&&(this.ext.context=a),new Promise((h,u)=>{dA&&console.log("Starting glTF export.");try{s==null||s.parse(o,d=>{l(),h(d)},d=>{l(),u(d)},r)}catch(d){console.error(d),u(d)}finally{dA&&console.log("Finished glTF export.")}});function l(){e.forEach(h=>{h&&(h.matrixAutoUpdate=!0,z.getComponentsInChildren(h,ci).forEach(u=>{z.isActiveInHierarchy(u.gameObject)&&u.setInstancingEnabled(!1)}))})}}static saveArrayBuffer(e,i){this.save(new Blob([e],{type:"application/octet-stream"}),i)}static saveJson(e,i){this.save("data: text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(e)),i)}static save(e,i){const s=document.createElement("a");s.style.display="none",document.body.appendChild(s),typeof e=="string"?s.href=e:s.href=URL.createObjectURL(e),s.download=i,s.click(),s.remove()}static collectAnimations(e,i){i=i||[];for(const s of e)s&&s.traverseVisible(r=>{r.animations&&r.animations.length>0&&i.push(...r.animations)});return i}static calculateCenter(e,i){const s=i||new C;return s.set(0,0,0),e.forEach(r=>{s.add(qe(r))}),console.log(s),s.divideScalar(e.length),s}static filterTopmostParent(e){if(!(e.length<=0))for(let i=0;i<e.length;i++){let s=e[i];if(!s){e.splice(i,1),i--;continue}for(;s.parent;){if(e.includes(s.parent)){e.splice(i,1),i--;break}s=s.parent}}}}Vk([A()],_a.prototype,"binary",void 0);Vk([A(re)],_a.prototype,"objects",void 0);var sS=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};class nm extends se{constructor(){super(...arguments);c(this,"isGizmo",!1);c(this,"color0");c(this,"color1");c(this,"gridHelper");c(this,"size");c(this,"divisions");c(this,"offset")}onEnable(){if(this.isGizmo&&!Og)return;const e=this.size,i=this.divisions;this.gridHelper||(this.gridHelper=new cx(e,i,this.color0??new we(.4,.4,.4),this.color1??new we(.6,.6,.6)),this.offset!==void 0&&(this.gridHelper.position.y+=this.offset)),this.gridHelper&&this.gameObject.add(this.gridHelper)}onDisable(){this.gridHelper&&(this.gameObject.remove(this.gridHelper),this.gridHelper=null)}}sS([A()],nm.prototype,"isGizmo",void 0);sS([A(we)],nm.prototype,"color0",void 0);sS([A(we)],nm.prototype,"color1",void 0);var p0=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};const c9=N("debuggroundprojection");class lf extends se{constructor(){super(...arguments);c(this,"applyOnAwake",!1);c(this,"_scale",20);c(this,"_radius",100);c(this,"_height",100);c(this,"_lastEnvironment");c(this,"_lastRadius");c(this,"_lastHeight");c(this,"env");c(this,"_watcher")}set scale(e){var i;this._scale=e,(i=this.env)==null||i.scale.setScalar(e)}get scale(){return this._scale}set radius(e){this._radius=e,this.updateProjection()}get radius(){return this._radius}set height(e){this._height=e,this.updateProjection()}get height(){return this._height}awake(){this.applyOnAwake&&this.updateAndCreate()}onEnable(){this.context.time.frameCount>0&&this.applyOnAwake&&this.updateAndCreate(),this._watcher||(this._watcher=new xc(this.context.scene,"environment"),this._watcher.subscribeWrite(e=>{this.updateProjection()}))}onDisable(){var e,i;(e=this._watcher)==null||e.revoke(),(i=this.env)==null||i.removeFromParent()}onEnterXR(){this.updateProjection()}onLeaveXR(){this.updateProjection()}updateAndCreate(){var e;this.updateProjection(),(e=this._watcher)==null||e.apply()}updateProjection(){var e,i,s;if(!this.context.scene.environment||(e=this.context.xr)!=null&&e.isPassThrough){(i=this.env)==null||i.removeFromParent();return}(!this.env||this.context.scene.environment!==this._lastEnvironment||this._height!==this._lastHeight||this._radius!==this._lastRadius)&&(c9&&console.log("Create/Update Ground Projection",this.context.scene.environment.name),(s=this.env)==null||s.removeFromParent(),this.env=new oP(this.context.scene.environment,this._height,this.radius,32),this.env.position.y=this._height),this._lastEnvironment=this.context.scene.environment,this._lastHeight=this._height,this._lastRadius=this._radius,this.env.parent||this.gameObject.add(this.env),this.env.isObject3D===!0&&this.env.layers.set(2)}}p0([A()],lf.prototype,"applyOnAwake",void 0);p0([A()],lf.prototype,"scale",null);p0([A()],lf.prototype,"radius",null);p0([A()],lf.prototype,"height",null);var g0=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};const Jl=N("debuginputfield"),Be=class extends se{constructor(){super(...arguments);c(this,"textComponent");c(this,"placeholder");c(this,"onValueChanged");c(this,"onEndEdit");c(this,"inputEventFn");c(this,"_iosEventFn")}get text(){var e;return((e=this.textComponent)==null?void 0:e.text)??""}get isFocused(){return Be.active===this}start(){Jl&&console.log(this.name,this)}onEnable(){var e;Be.htmlField||(Be.htmlField=document.createElement("input"),Be.htmlField.style.width="0px",Be.htmlField.style.height="0px",Be.htmlField.style.padding="0px",Be.htmlField.style.border="none",Be.htmlField.style.overflow="hidden",Be.htmlField.style.caretColor="transparent",Be.htmlField.style.outline="none",Be.htmlField.classList.add("ar"),Be.htmlField.onfocus=()=>Be.htmlFieldFocused=!0,Be.htmlField.onblur=()=>Be.htmlFieldFocused=!1,document.body.append(Be.htmlField)),this.inputEventFn||(this.inputEventFn=this.onInput.bind(this)),Be.htmlField.addEventListener("keyup",this.inputEventFn),this.placeholder&&((e=this.textComponent)!=null&&e.text.length)&&z.setActive(this.placeholder.gameObject,!1),Td()&&(this._iosEventFn=this.processInputOniOS.bind(this),window.addEventListener("click",this._iosEventFn))}onDisable(){var e;(e=Be.htmlField)==null||e.removeEventListener("keyup",this.inputEventFn),this.onDeselected(),this._iosEventFn&&window.removeEventListener("click",this._iosEventFn)}clear(){Be.active===this&&Be.htmlField?(Be.htmlField.value="",this.setTextFromInputField()):(this.textComponent&&(this.textComponent.text=""),this.placeholder&&z.setActive(this.placeholder.gameObject,!0))}select(){this.onSelected()}deselect(){this.onDeselected()}onPointerClick(e){Jl&&console.log("CLICK",e,Be.active),Be.activeTime=this.context.time.time,Be.active!==this&&this.startCoroutine(this.activeLoop(),ze.LateUpdate),this.selectInputField()}*activeLoop(){for(this.onSelected();Be.active===this&&!(this.context.input.getPointerClicked(0)&&this.context.time.time-Be.activeTime>.2);)this.setTextFromInputField(),yield;this.onDeselected()}onSelected(){var e,i,s,r;if(Be.active!==this&&(Jl&&console.log("Select",this.name,this,Be.htmlField,this.context.isInXR,this.context.arOverlayElement,(e=this.textComponent)==null?void 0:e.text,(i=Be.htmlField)==null?void 0:i.value),(s=Be.active)==null||s.onDeselected(),Be.active=this,this.placeholder&&z.setActive(this.placeholder.gameObject,!1),Be.htmlField)){if(Be.htmlField.value=((r=this.textComponent)==null?void 0:r.text)||"",Jl&&console.log("set input field value",Be.htmlField.value),this.context.isInXR){const o=this.context.arOverlayElement;o&&o.append(Be.htmlField)}this.selectInputField()}}onDeselected(){var e;Be.active===this&&(Be.active=null,Jl&&console.log("Deselect",this.name,this),Be.htmlField&&(Be.htmlField.blur(),document.body.append(Be.htmlField)),this.placeholder&&(!this.textComponent||this.textComponent.text.length<=0)&&z.setActive(this.placeholder.gameObject,!0),Be.htmlField&&((e=this.onEndEdit)==null||e.invoke(Be.htmlField.value)))}update(){var e;Be.active===this&&((e=this.textComponent)==null||e.markDirty())}onInput(e){var i,s;if(Be.active===this){if(Jl&&console.log(e.code,e,(i=Be.htmlField)==null?void 0:i.value,(s=this.textComponent)==null?void 0:s.text),e.code==="Escape"||e.code==="Enter"){this.onDeselected();return}Be.htmlField&&(this.textComponent&&(this.setTextFromInputField(),this.placeholder&&z.setActive(this.placeholder.gameObject,this.textComponent.text.length<=0)),this.selectInputField())}}setTextFromInputField(){var e;if(this.textComponent&&Be.htmlField){if(this.textComponent.text!==Be.htmlField.value){Jl&&console.log("VALUE CHANGED");const i=this.textComponent.text,s=Be.htmlField.value;(e=this.onValueChanged)==null||e.invoke(s,i)}this.textComponent.text=Be.htmlField.value}}selectInputField(){Be.htmlField&&(Jl&&console.log("Focus Inputfield",Be.htmlFieldFocused),Be.htmlField.setSelectionRange(Be.htmlField.value.length,Be.htmlField.value.length),Td()?Be.htmlField.focus({preventScroll:!0}):setTimeout(()=>{var e;return(e=Be.htmlField)==null?void 0:e.focus()},1))}processInputOniOS(){const e=this.context.physics.raycast();if(!e.length)return;const s=e[0].object,r=EC(s);((r==null?void 0:r.gameObject)===this.gameObject||(r==null?void 0:r.gameObject.parent)===this.gameObject)&&this.selectInputField()}};let Wr=Be;c(Wr,"active",null),c(Wr,"activeTime",-1),c(Wr,"htmlField",null),c(Wr,"htmlFieldFocused",!1);g0([A(ks)],Wr.prototype,"textComponent",void 0);g0([A(ks)],Wr.prototype,"placeholder",void 0);g0([A(dn)],Wr.prototype,"onValueChanged",void 0);g0([A(dn)],Wr.prototype,"onEndEdit",void 0);var Va=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};function n_(n){return n*Math.PI/180}const yT=300,Zl=N("debuglights");var sl;(function(n){n[n.Spot=0]="Spot",n[n.Directional=1]="Directional",n[n.Point=2]="Point",n[n.Area=3]="Area",n[n.Rectangle=3]="Rectangle",n[n.Disc=4]="Disc"})(sl||(sl={}));var jv;(function(n){n[n.Realtime=4]="Realtime",n[n.Baked=2]="Baked",n[n.Mixed=1]="Mixed"})(jv||(jv={}));var Fp;(function(n){n[n.None=0]="None",n[n.Hard=1]="Hard",n[n.Soft=2]="Soft"})(Fp||(Fp={}));class wr extends se{constructor(){super(...arguments);c(this,"type",0);c(this,"range",1);c(this,"spotAngle",1);c(this,"innerSpotAngle",1);c(this,"_color",new we(16777215));c(this,"_shadowNearPlane",.1);c(this,"_shadowBias",0);c(this,"_shadowNormalBias",0);c(this,"_overrideShadowBiasSettings",!1);c(this,"_shadows",1);c(this,"lightmapBakeType",jv.Realtime);c(this,"_intensity",-1);c(this,"_shadowDistance");c(this,"shadowWidth");c(this,"shadowHeight");c(this,"_shadowResolution");c(this,"light");c(this,"_webXRStartedListener");c(this,"_webXREndedListener");c(this,"_webARRoot")}set color(e){this._color=e,this.light!==void 0&&(this.light.color=e)}get color(){return this.light?this.light.color:this._color}set shadowNearPlane(e){var i,s;if(e!==this._shadowNearPlane&&(this._shadowNearPlane=e,((s=(i=this.light)==null?void 0:i.shadow)==null?void 0:s.camera)!==void 0)){const r=this.light.shadow.camera;r.near=e}}get shadowNearPlane(){return this._shadowNearPlane}set shadowBias(e){var i,s;e!==this._shadowBias&&(this._shadowBias=e,((s=(i=this.light)==null?void 0:i.shadow)==null?void 0:s.bias)!==void 0&&(this.light.shadow.bias=e,this.light.shadow.needsUpdate=!0))}get shadowBias(){return this._shadowBias}set shadowNormalBias(e){var i,s;e!==this._shadowNormalBias&&(this._shadowNormalBias=e,((s=(i=this.light)==null?void 0:i.shadow)==null?void 0:s.normalBias)!==void 0&&(this.light.shadow.normalBias=e,this.light.shadow.needsUpdate=!0))}get shadowNormalBias(){return this._shadowNormalBias}set shadows(e){this._shadows=e,this.light&&(this.light.castShadow=e!==Fp.None,this.updateShadowSoftHard())}get shadows(){return this._shadows}set intensity(e){var i;if(this._intensity=e,this.light){let s=1;if(this.context.isInXR&&this._webARRoot){const r=(i=this._webARRoot)==null?void 0:i.arScale;typeof r=="number"&&r>0&&(s/=r)}this.light.intensity=e*s}Zl&&console.log("Set light intensity to "+this._intensity,e,this)}get intensity(){return this._intensity}get shadowDistance(){const e=this.light;return e!=null&&e.shadow?e.shadow.camera.far:-1}set shadowDistance(e){this._shadowDistance=e;const i=this.light;if(i!=null&&i.shadow){const s=i.shadow.camera;s.far=e,s.updateProjectionMatrix()}}get shadowResolution(){const e=this.light;return e!=null&&e.shadow?e.shadow.mapSize.x:-1}set shadowResolution(e){if(e===this._shadowResolution)return;this._shadowResolution=e;const i=this.light;i!=null&&i.shadow&&(i.shadow.mapSize.set(e,e),i.shadow.needsUpdate=!0)}get isBaked(){return this.lightmapBakeType===jv.Baked}get selfIsLight(){if(this.gameObject.isLight===!0)return!0;switch(this.gameObject.type){case"SpotLight":case"PointLight":case"DirectionalLight":return!0}return!1}getWorldPosition(e){return this.light?this.type===sl.Directional?this.light.getWorldPosition(e).multiplyScalar(1):this.light.getWorldPosition(e):e}awake(){this.color=new we(this.color??16777215),Zl&&console.log(this.name,this)}onEnable(){Zl&&console.log("ENABLE LIGHT",this.name),this.createLight(),!this.isBaked&&(this.light&&(this.light.visible=!0,this.light.intensity=this._intensity,Zl&&console.log("Set light intensity to "+this.light.intensity,this.name),this.selfIsLight||this.light.parent!==this.gameObject&&this.gameObject.add(this.light)),this.type===sl.Directional&&this.startCoroutine(this.updateMainLightRoutine(),ze.LateUpdate))}onDisable(){Zl&&console.log("DISABLE LIGHT",this.name),this.light&&(this.selfIsLight?this.light.intensity=0:this.light.visible=!1)}onEnterXR(e){this._webARRoot=z.getComponentInParent(this.gameObject,Xs)??void 0}onLeaveXR(e){}createLight(){const e=this.selfIsLight;if(e&&!this.light)switch(this.light=this.gameObject,this.light.name=this.name,this._intensity=this.light.intensity,this.type){case sl.Directional:this.setDirectionalLight(this.light);break}else if(!this.light)switch(this.type){case sl.Directional:const i=new eg(this.color,this.intensity*Math.PI);if(i.position.set(0,0,-yT*.5).applyQuaternion(this.gameObject.quaternion),this.gameObject.add(i.target),Pd(i.target,0,0,0),this.light=i,this.gameObject.position.set(0,0,0),this.gameObject.rotation.set(0,0,0),Zl){const a=new q2(this.light,.2,this.color);this.context.scene.add(a)}break;case sl.Spot:const s=new hx(this.color,this.intensity*Math.PI,this.range,n_(this.spotAngle/2),1-n_(this.innerSpotAngle/2)/n_(this.spotAngle/2),2);s.position.set(0,0,0),s.rotation.set(0,0,0),this.light=s;const r=s.target;s.add(r),r.position.set(0,0,this.range),r.rotation.set(0,0,0);break;case sl.Point:const o=new $p(this.color,this.intensity*Math.PI,this.range);this.light=o;break}if(this.light){if(this._intensity>=0?this.light.intensity=this._intensity:this._intensity=this.light.intensity,this.shadows!==Fp.None?this.light.castShadow=!0:this.light.castShadow=!1,this.light.shadow){this._shadowResolution!==void 0&&this._shadowResolution>4?(this.light.shadow.mapSize.width=this._shadowResolution,this.light.shadow.mapSize.height=this._shadowResolution):(this.light.shadow.mapSize.width=2048,this.light.shadow.mapSize.height=2048),Zl&&console.log("Override shadow bias?",this._overrideShadowBiasSettings,this.shadowBias,this.shadowNormalBias),this.light.shadow.bias=this.shadowBias,this.light.shadow.normalBias=this.shadowNormalBias,this.updateShadowSoftHard();const i=this.light.shadow.camera;if(i.near=this.shadowNearPlane,this._shadowDistance!==void 0&&typeof this._shadowDistance=="number"?i.far=this._shadowDistance:i.far=yT*Math.abs(this.gameObject.scale.z),this.gameObject.scale.set(1,1,1),this.shadowWidth!==void 0)i.left=-this.shadowWidth/2,i.right=this.shadowWidth/2;else{const s=this.gameObject.scale.x;i.left*=s,i.right*=s}if(this.shadowHeight!==void 0)i.top=this.shadowHeight/2,i.bottom=-this.shadowHeight/2;else{const s=this.gameObject.scale.y;i.top*=s,i.bottom*=s}this.light.shadow.needsUpdate=!0,Zl&&this.context.scene.add(new X2(i))}this.isBaked?this.light.removeFromParent():e||this.gameObject.add(this.light)}}*updateMainLightRoutine(){for(;;){this.type===sl.Directional&&((!this.context.mainLight||this.intensity>this.context.mainLight.intensity)&&(this.context.mainLight=this),yield);break}}updateShadowSoftHard(){this.light&&this.light.shadow&&(this.shadows===Fp.Soft||(this.light.shadow.radius=1,this.light.shadow.blurSamples=1))}setDirectionalLight(e){e.add(e.target),e.target.position.set(0,0,-1)}}c(wr,"allowChangingRendererShadowMapType",!0);Va([A()],wr.prototype,"type",void 0);Va([A(we)],wr.prototype,"color",null);Va([A()],wr.prototype,"shadowNearPlane",null);Va([A()],wr.prototype,"shadowBias",null);Va([A()],wr.prototype,"shadowNormalBias",null);Va([A()],wr.prototype,"shadows",null);Va([A()],wr.prototype,"lightmapBakeType",void 0);Va([A()],wr.prototype,"intensity",null);Va([A()],wr.prototype,"shadowDistance",null);Va([A()],wr.prototype,"shadowResolution",null);new C(0,0,0);var sm=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};const s_=N("debuglods"),h9=N("nolods");var Vw;(function(n){n[n.None=0]="None",n[n.CrossFade=1]="CrossFade",n[n.SpeedTree=2]="SpeedTree"})(Vw||(Vw={}));class cf{constructor(){c(this,"screenRelativeTransitionHeight");c(this,"distance");c(this,"renderers")}}sm([A()],cf.prototype,"screenRelativeTransitionHeight",void 0);sm([A()],cf.prototype,"distance",void 0);sm([A(ci)],cf.prototype,"renderers",void 0);class u9{constructor(t){c(this,"model");this.model=t}get renderers(){return this.model.renderers}}class m0 extends se{constructor(){super(...arguments);c(this,"fadeMode",Vw.None);c(this,"localReferencePoint");c(this,"lodCount",0);c(this,"size",0);c(this,"animateCrossFading",!1);c(this,"lodModels");c(this,"_lods",[]);c(this,"_settings",[]);c(this,"_lodsHandler");c(this,"_distanceFactor",1)}start(){if(s_&&console.log("LODGROUP",this.name,this.lodModels,this),!h9&&!this._lodsHandler&&this.gameObject&&this.lodModels&&Array.isArray(this.lodModels)){const e=[];for(const s of this.lodModels){const r=new u9(s);this._lods.push(r);for(const o of r.renderers)e.includes(o)||e.push(o)}this._lodsHandler=new Array;for(let s=0;s<e.length;s++){const r=new Y2;this._lodsHandler.push(r),this.gameObject.add(r)}const i=new re;i.name="Cull "+this.name;for(let s=0;s<e.length;s++){const r=e[s],o=this._lodsHandler[s],a=r.gameObject;s_&&console.log(s,a.name);for(const l of this._lods){const h=l.model.distance;let u=null;if(l.renderers.includes(r)?u=a:u=i,u.type==="Group"){console.warn(`LODGroup ${this.name}: Group or MultiMaterial object's are not supported as LOD object: ${u.name}`);continue}s_&&console.log("LEVEL",u.name,h),o.autoUpdate=!1,this.onAddLodLevel(o,u,l.model.distance)}}}}onAfterRender(){if(!this.gameObject||!this._lodsHandler)return;const e=this.context.mainCamera;if(e)for(const i of this._lodsHandler){i.update(e);const s=i.getCurrentLevel(),r=i.levels[s];i.layers.mask=r.object.layers.mask}}onAddLodLevel(e,i,s){if(i===this.gameObject){console.warn("LODGroup component must be on parent object and not mesh directly at the moment",i.name,i);return}e.addLevel(i,s*this._distanceFactor,.01);const r={lod:e,levelIndex:e.levels.length-1,distance:s};this._settings.push(r)}distanceFactor(e){if(e!==this._distanceFactor){this._distanceFactor=e;for(const i of this._settings){const s=i.lod.levels[i.levelIndex];s.distance=i.distance*e}}}}sm([A(C)],m0.prototype,"localReferencePoint",void 0);sm([A(cf)],m0.prototype,"lodModels",void 0);const d9=N("logstats");class qk extends se{onEnable(){console.log(this),d9&&this.startCoroutine(this.run(),ze.OnAfterRender)}*run(){for(;this.enabled;){const t=this.context.renderer.info;console.log(t.memory,t.render,t.programs),yield}}}var A0=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};const US=class extends se{constructor(){super(...arguments);c(this,"target");c(this,"invertForward",!1);c(this,"keepUpDirection",!0);c(this,"copyTargetRotation",!1)}onBeforeRender(){let e=this.target;e||(e=this.context.mainCamera),e&&(Ay(this.gameObject,e,this.keepUpDirection,this.copyTargetRotation),this.invertForward&&this.gameObject.quaternion.multiply(US.flipYQuat))}createBehaviours(e,i,s){if(i.uuid===this.gameObject.uuid){let r=i;if(this.keepUpDirection){const a=rs.createEmptyParent(i);r=a;const l=this.invertForward?-1:1;a.matrix.multiply(new ce().makeRotationZ(Math.PI/2*l)),i.matrix.multiply(new ce().makeRotationZ(-Math.PI/2*l))}const o=new Ki("lookat "+this.name,Ln.sceneStartTrigger(),At.lookAtCameraAction(r,void 0,this.invertForward?Vu.back:Vu.forward,this.keepUpDirection?Vu.up:Vu.zero));e.addBehavior(o)}}};let xl=US;c(xl,"flipYQuat",new ne().setFromAxisAngle(new C(0,1,0),Math.PI));A0([A(re)],xl.prototype,"target",void 0);A0([A()],xl.prototype,"invertForward",void 0);A0([A()],xl.prototype,"keepUpDirection",void 0);A0([A()],xl.prototype,"copyTargetRotation",void 0);var f9=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};const fA=N("debugnestedgltf");class rS extends se{constructor(){super(...arguments);c(this,"filePath");c(this,"_isLoadingOrDoneLoading",!1)}listenToProgress(e){var i;(i=this.filePath)==null||i.beginListenDownload(e)}preload(){var e;(e=this.filePath)==null||e.preload()}async start(){var i,s,r,o,a;if(this._isLoadingOrDoneLoading)return;fA&&console.log(this,this.guid);const e=this.gameObject.parent;if(e){this._isLoadingOrDoneLoading=!0;const l=new za;l.idProvider=new Qn(this.hash(this.guid)),l.parent=e,this.gameObject.updateMatrix();const h=this.gameObject.matrix;fA&&console.log("Load nested:",((i=this.filePath)==null?void 0:i.uri)??this.filePath,this.gameObject.position);const u=await((r=(s=this.filePath)==null?void 0:s.instantiate)==null?void 0:r.call(this.filePath,l));fA&&console.log("Nested loaded:",((o=this.filePath)==null?void 0:o.uri)??this.filePath,u),u&&(u.matrixAutoUpdate=!1,u.matrix.identity(),u.applyMatrix4(h),u.matrixAutoUpdate=!0,u.layers.disableAll(),u.layers.set(this.layer),this.dispatchEvent(new CustomEvent("loaded",{detail:{instance:u,assetReference:this.filePath}}))),fA&&console.log("Nested loading done:",((a=this.filePath)==null?void 0:a.uri)??this.filePath,u)}}onDestroy(){var e;(e=this.filePath)==null||e.unload()}hash(e){let i=0;for(let s=0;s<e.length;s++)i=e.charCodeAt(s)+((i<<5)-i);return i}}f9([A(it)],rS.prototype,"filePath",void 0);var v0=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};class hf extends se{constructor(){super(...arguments);c(this,"referenceSpace");c(this,"from");c(this,"affectPosition",!1);c(this,"affectRotation",!1);c(this,"alignLookDirection",!1);c(this,"levelLookDirection",!1);c(this,"levelPosition",!1);c(this,"positionOffset",new C(0,0,0));c(this,"rotationOffset",new C(0,0,0));c(this,"offset",new C(0,0,0))}update(){if(!this.from)return;var e=qe(this.from),i=Nt(this.from);this.offset.copy(this.positionOffset);const s=this.offset.length();if(this.referenceSpace&&this.offset.transformDirection(this.referenceSpace.matrixWorld).multiplyScalar(s),e.add(this.offset),this.levelPosition&&this.referenceSpace){const l=new Oh(this.gameObject.up,0),h=qe(this.referenceSpace);l.setFromNormalAndCoplanarPoint(this.gameObject.up,h);const u=new C(0,0,0);l.projectPoint(e,u),e.copy(u)}this.affectPosition&&Ts(this.gameObject,e);const r=new fi(this.rotationOffset.x,this.rotationOffset.y,this.rotationOffset.z),o=new ne().setFromEuler(r);this.affectRotation&&Oo(this.gameObject,i.multiply(o));const a=new C;this.from.getWorldDirection(a).multiplyScalar(50),this.levelLookDirection&&(a.y=0),this.alignLookDirection&&this.gameObject.lookAt(a)}}v0([A(z)],hf.prototype,"referenceSpace",void 0);v0([A(z)],hf.prototype,"from",void 0);v0([A(C)],hf.prototype,"positionOffset",void 0);v0([A(C)],hf.prototype,"rotationOffset",void 0);var oS=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r},id;(function(n){n[n.NewTab=0]="NewTab",n[n.SameTab=1]="SameTab",n[n.NewWindow=2]="NewWindow"})(id||(id={}));class rm extends se{constructor(){super(...arguments);c(this,"url");c(this,"mode",id.NewTab);c(this,"clickable",!0)}async open(){if(!this.url){console.warn("OpenURL: URL is not set, can't open.",this);return}this._validateUrl();let e=this.url;switch(!e.startsWith("mailto:")&&e.includes("@")&&(e="mailto:"+e),xe()&&Ci("Open URL: "+e),this.mode){case id.NewTab:dp(),globalThis.open(e,"_blank");break;case id.SameTab:dp()&&Td()?globalThis.open(e,"_top"):globalThis.open(e,"_self");break;case id.NewWindow:dp()?globalThis.open(e,"_top"):globalThis.open(e,"_new");break}}start(){this.gameObject.getComponentInParent(no)||this.gameObject.addComponent(no)}onPointerEnter(e){!e.used&&this.clickable&&this.context.input.setCursorPointer()}onPointerExit(){this.clickable&&this.context.input.setCursorNormal()}onPointerClick(e){var i;this.clickable&&!e.used&&((i=this.url)!=null&&i.length)&&this.open()}_validateUrl(){this.url&&this.url.startsWith("www.")&&(xe()&&console.warn("URL is not valid, adding https:// to the start of the URL",this.url),this.url="https://"+this.url)}}oS([A()],rm.prototype,"url",void 0);oS([A()],rm.prototype,"mode",void 0);oS([A()],rm.prototype,"clickable",void 0);function p9(n,t){var e=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(e!=null){var i,s,r,o,a=[],l=!0,h=!1;try{if(r=(e=e.call(n)).next,t===0){if(Object(e)!==e)return;l=!1}else for(;!(l=(i=r.call(e)).done)&&(a.push(i.value),a.length!==t);l=!0);}catch(u){h=!0,s=u}finally{try{if(!l&&e.return!=null&&(o=e.return(),Object(o)!==o))return}finally{if(h)throw s}}return a}}function Ww(){Ww=function(){return t};var n,t={},e=Object.prototype,i=e.hasOwnProperty,s=Object.defineProperty||function(k,M,H){k[M]=H.value},r=typeof Symbol=="function"?Symbol:{},o=r.iterator||"@@iterator",a=r.asyncIterator||"@@asyncIterator",l=r.toStringTag||"@@toStringTag";function h(k,M,H){return Object.defineProperty(k,M,{value:H,enumerable:!0,configurable:!0,writable:!0}),k[M]}try{h({},"")}catch{h=function(M,H,ee){return M[H]=ee}}function u(k,M,H,ee){var Y=M&&M.prototype instanceof y?M:y,he=Object.create(Y.prototype),de=new V(ee||[]);return s(he,"_invoke",{value:R(k,H,de)}),he}function d(k,M,H){try{return{type:"normal",arg:k.call(M,H)}}catch(ee){return{type:"throw",arg:ee}}}t.wrap=u;var f="suspendedStart",p="suspendedYield",g="executing",m="completed",v={};function y(){}function b(){}function _(){}var x={};h(x,o,function(){return this});var S=Object.getPrototypeOf,T=S&&S(S(X([])));T&&T!==e&&i.call(T,o)&&(x=T);var L=_.prototype=y.prototype=Object.create(x);function I(k){["next","throw","return"].forEach(function(M){h(k,M,function(H){return this._invoke(M,H)})})}function P(k,M){function H(Y,he,de,ve){var _e=d(k[Y],k,he);if(_e.type!=="throw"){var Ge=_e.arg,Te=Ge.value;return Te&&typeof Te=="object"&&i.call(Te,"__await")?M.resolve(Te.__await).then(function(We){H("next",We,de,ve)},function(We){H("throw",We,de,ve)}):M.resolve(Te).then(function(We){Ge.value=We,de(Ge)},function(We){return H("throw",We,de,ve)})}ve(_e.arg)}var ee;s(this,"_invoke",{value:function(Y,he){function de(){return new M(function(ve,_e){H(Y,he,ve,_e)})}return ee=ee?ee.then(de,de):de()}})}function R(k,M,H){var ee=f;return function(Y,he){if(ee===g)throw new Error("Generator is already running");if(ee===m){if(Y==="throw")throw he;return{value:n,done:!0}}for(H.method=Y,H.arg=he;;){var de=H.delegate;if(de){var ve=B(de,H);if(ve){if(ve===v)continue;return ve}}if(H.method==="next")H.sent=H._sent=H.arg;else if(H.method==="throw"){if(ee===f)throw ee=m,H.arg;H.dispatchException(H.arg)}else H.method==="return"&&H.abrupt("return",H.arg);ee=g;var _e=d(k,M,H);if(_e.type==="normal"){if(ee=H.done?m:p,_e.arg===v)continue;return{value:_e.arg,done:H.done}}_e.type==="throw"&&(ee=m,H.method="throw",H.arg=_e.arg)}}}function B(k,M){var H=M.method,ee=k.iterator[H];if(ee===n)return M.delegate=null,H==="throw"&&k.iterator.return&&(M.method="return",M.arg=n,B(k,M),M.method==="throw")||H!=="return"&&(M.method="throw",M.arg=new TypeError("The iterator does not provide a '"+H+"' method")),v;var Y=d(ee,k.iterator,M.arg);if(Y.type==="throw")return M.method="throw",M.arg=Y.arg,M.delegate=null,v;var he=Y.arg;return he?he.done?(M[k.resultName]=he.value,M.next=k.nextLoc,M.method!=="return"&&(M.method="next",M.arg=n),M.delegate=null,v):he:(M.method="throw",M.arg=new TypeError("iterator result is not an object"),M.delegate=null,v)}function Q(k){var M={tryLoc:k[0]};1 in k&&(M.catchLoc=k[1]),2 in k&&(M.finallyLoc=k[2],M.afterLoc=k[3]),this.tryEntries.push(M)}function G(k){var M=k.completion||{};M.type="normal",delete M.arg,k.completion=M}function V(k){this.tryEntries=[{tryLoc:"root"}],k.forEach(Q,this),this.reset(!0)}function X(k){if(k||k===""){var M=k[o];if(M)return M.call(k);if(typeof k.next=="function")return k;if(!isNaN(k.length)){var H=-1,ee=function Y(){for(;++H<k.length;)if(i.call(k,H))return Y.value=k[H],Y.done=!1,Y;return Y.value=n,Y.done=!0,Y};return ee.next=ee}}throw new TypeError(typeof k+" is not iterable")}return b.prototype=_,s(L,"constructor",{value:_,configurable:!0}),s(_,"constructor",{value:b,configurable:!0}),b.displayName=h(_,l,"GeneratorFunction"),t.isGeneratorFunction=function(k){var M=typeof k=="function"&&k.constructor;return!!M&&(M===b||(M.displayName||M.name)==="GeneratorFunction")},t.mark=function(k){return Object.setPrototypeOf?Object.setPrototypeOf(k,_):(k.__proto__=_,h(k,l,"GeneratorFunction")),k.prototype=Object.create(L),k},t.awrap=function(k){return{__await:k}},I(P.prototype),h(P.prototype,a,function(){return this}),t.AsyncIterator=P,t.async=function(k,M,H,ee,Y){Y===void 0&&(Y=Promise);var he=new P(u(k,M,H,ee),Y);return t.isGeneratorFunction(M)?he:he.next().then(function(de){return de.done?de.value:he.next()})},I(L),h(L,l,"Generator"),h(L,o,function(){return this}),h(L,"toString",function(){return"[object Generator]"}),t.keys=function(k){var M=Object(k),H=[];for(var ee in M)H.push(ee);return H.reverse(),function Y(){for(;H.length;){var he=H.pop();if(he in M)return Y.value=he,Y.done=!1,Y}return Y.done=!0,Y}},t.values=X,V.prototype={constructor:V,reset:function(k){if(this.prev=0,this.next=0,this.sent=this._sent=n,this.done=!1,this.delegate=null,this.method="next",this.arg=n,this.tryEntries.forEach(G),!k)for(var M in this)M.charAt(0)==="t"&&i.call(this,M)&&!isNaN(+M.slice(1))&&(this[M]=n)},stop:function(){this.done=!0;var k=this.tryEntries[0].completion;if(k.type==="throw")throw k.arg;return this.rval},dispatchException:function(k){if(this.done)throw k;var M=this;function H(_e,Ge){return he.type="throw",he.arg=k,M.next=_e,Ge&&(M.method="next",M.arg=n),!!Ge}for(var ee=this.tryEntries.length-1;ee>=0;--ee){var Y=this.tryEntries[ee],he=Y.completion;if(Y.tryLoc==="root")return H("end");if(Y.tryLoc<=this.prev){var de=i.call(Y,"catchLoc"),ve=i.call(Y,"finallyLoc");if(de&&ve){if(this.prev<Y.catchLoc)return H(Y.catchLoc,!0);if(this.prev<Y.finallyLoc)return H(Y.finallyLoc)}else if(de){if(this.prev<Y.catchLoc)return H(Y.catchLoc,!0)}else{if(!ve)throw new Error("try statement without catch or finally");if(this.prev<Y.finallyLoc)return H(Y.finallyLoc)}}}},abrupt:function(k,M){for(var H=this.tryEntries.length-1;H>=0;--H){var ee=this.tryEntries[H];if(ee.tryLoc<=this.prev&&i.call(ee,"finallyLoc")&&this.prev<ee.finallyLoc){var Y=ee;break}}Y&&(k==="break"||k==="continue")&&Y.tryLoc<=M&&M<=Y.finallyLoc&&(Y=null);var he=Y?Y.completion:{};return he.type=k,he.arg=M,Y?(this.method="next",this.next=Y.finallyLoc,v):this.complete(he)},complete:function(k,M){if(k.type==="throw")throw k.arg;return k.type==="break"||k.type==="continue"?this.next=k.arg:k.type==="return"?(this.rval=this.arg=k.arg,this.method="return",this.next="end"):k.type==="normal"&&M&&(this.next=M),v},finish:function(k){for(var M=this.tryEntries.length-1;M>=0;--M){var H=this.tryEntries[M];if(H.finallyLoc===k)return this.complete(H.completion,H.afterLoc),G(H),v}},catch:function(k){for(var M=this.tryEntries.length-1;M>=0;--M){var H=this.tryEntries[M];if(H.tryLoc===k){var ee=H.completion;if(ee.type==="throw"){var Y=ee.arg;G(H)}return Y}}throw new Error("illegal catch attempt")},delegateYield:function(k,M,H){return this.delegate={iterator:X(k),resultName:M,nextLoc:H},this.method==="next"&&(this.arg=n),v}},t}function Oe(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function")}function bT(n,t){for(var e=0;e<t.length;e++){var i=t[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,Yk(i.key),i)}}function Le(n,t,e){return t&&bT(n.prototype,t),e&&bT(n,e),Object.defineProperty(n,"prototype",{writable:!1}),n}function F(n,t,e){return t=Yk(t),t in n?Object.defineProperty(n,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):n[t]=e,n}function uf(n,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(t&&t.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),t&&qw(n,t)}function Gv(n){return Gv=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Gv(n)}function qw(n,t){return qw=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,s){return i.__proto__=s,i},qw(n,t)}function g9(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function rt(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function m9(n,t){if(t&&(typeof t=="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return rt(n)}function df(n){var t=g9();return function(){var i=Gv(n),s;if(t){var r=Gv(this).constructor;s=Reflect.construct(i,arguments,r)}else s=i.apply(this,arguments);return m9(this,s)}}function xd(n,t){return A9(n)||p9(n,t)||Xk(n,t)||v9()}function A9(n){if(Array.isArray(n))return n}function Xk(n,t){if(n){if(typeof n=="string")return _T(n,t);var e=Object.prototype.toString.call(n).slice(8,-1);if(e==="Object"&&n.constructor&&(e=n.constructor.name),e==="Map"||e==="Set")return Array.from(n);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return _T(n,t)}}function _T(n,t){(t==null||t>n.length)&&(t=n.length);for(var e=0,i=new Array(t);e<t;e++)i[e]=n[e];return i}function v9(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function wT(n,t){var e=typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(!e){if(Array.isArray(n)||(e=Xk(n))||t&&n&&typeof n.length=="number"){e&&(n=e);var i=0,s=function(){};return{s,n:function(){return i>=n.length?{done:!0}:{done:!1,value:n[i++]}},e:function(l){throw l},f:s}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var r=!0,o=!1,a;return{s:function(){e=e.call(n)},n:function(){var l=e.next();return r=l.done,l},e:function(l){o=!0,a=l},f:function(){try{!r&&e.return!=null&&e.return()}finally{if(o)throw a}}}}function y9(n,t){if(typeof n!="object"||n===null)return n;var e=n[Symbol.toPrimitive];if(e!==void 0){var i=e.call(n,t||"default");if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(n)}function Yk(n){var t=y9(n,"string");return typeof t=="symbol"?t:String(t)}var b9=function(n){uf(e,n);var t=df(e);function e(i){var s;return Oe(this,e),s=t.call(this),F(rt(s),"type","ParticleEmitter"),F(rt(s),"system",void 0),s.system=i,s}return Le(e,[{key:"clone",value:function(){var s=this.system.clone();return s.emitter.copy(this,!0),s.emitter}},{key:"dispose",value:function(){}},{key:"extractFromCache",value:function(s){var r=[];for(var o in s){var a=s[o];delete a.metadata,r.push(a)}return r}},{key:"toJSON",value:function(s){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=s===void 0||typeof s=="string",a={};o&&(s={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},a.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});var l={};if(l.uuid=this.uuid,l.type=this.type,this.name!==""&&(l.name=this.name),this.castShadow===!0&&(l.castShadow=!0),this.receiveShadow===!0&&(l.receiveShadow=!0),this.visible===!1&&(l.visible=!1),this.frustumCulled===!1&&(l.frustumCulled=!1),this.renderOrder!==0&&(l.renderOrder=this.renderOrder),JSON.stringify(this.userData)!=="{}"&&(l.userData=this.userData),l.layers=this.layers.mask,l.matrix=this.matrix.toArray(),this.matrixAutoUpdate===!1&&(l.matrixAutoUpdate=!1),this.system!==null&&(l.ps=this.system.toJSON(s,r)),this.children.length>0){l.children=[];for(var h=0;h<this.children.length;h++)this.children[h].type!=="ParticleSystemPreview"&&l.children.push(this.children[h].toJSON(s).object)}if(o){var u=this.extractFromCache(s.geometries),d=this.extractFromCache(s.materials),f=this.extractFromCache(s.textures),p=this.extractFromCache(s.images);u.length>0&&(a.geometries=u),d.length>0&&(a.materials=d),f.length>0&&(a.textures=f),p.length>0&&(a.images=p)}return a.object=l,a}}]),e}(re),r_=function(){function n(t){Oe(this,n),F(this,"data",void 0),F(this,"next",void 0),F(this,"prev",void 0),this.data=t,this.next=null,this.prev=null}return Le(n,[{key:"hasPrev",value:function(){return this.prev!==null}},{key:"hasNext",value:function(){return this.next!==null}}]),n}(),_9=function(){function n(){Oe(this,n),F(this,"length",void 0),F(this,"head",void 0),F(this,"tail",void 0),this.length=0,this.head=this.tail=null}return Le(n,[{key:"isEmpty",value:function(){return this.head===null}},{key:"clear",value:function(){this.length=0,this.head=this.tail=null}},{key:"front",value:function(){return this.head===null?null:this.head.data}},{key:"back",value:function(){return this.tail===null?null:this.tail.data}},{key:"dequeue",value:function(){if(this.head){var e=this.head.data;return this.head=this.head.next,this.head?this.head.prev=null:this.tail=null,this.length--,e}}},{key:"pop",value:function(){if(this.tail){var e=this.tail.data;return this.tail=this.tail.prev,this.tail?this.tail.next=null:this.head=null,this.length--,e}}},{key:"queue",value:function(e){var i=new r_(e);this.tail||(this.tail=i),this.head&&(this.head.prev=i,i.next=this.head),this.head=i,this.length++}},{key:"push",value:function(e){var i=new r_(e);this.head||(this.head=i),this.tail&&(this.tail.next=i,i.prev=this.tail),this.tail=i,this.length++}},{key:"insertBefore",value:function(e,i){var s=new r_(i);s.next=e,s.prev=e.prev,s.prev!==null&&(s.prev.next=s),s.next.prev=s,e==this.head&&(this.head=s),this.length++}},{key:"remove",value:function(e){if(!(this.head===null||this.tail===null)){var i=this.head;for(e===this.head.data&&(this.head=this.head.next),e===this.tail.data&&(this.tail=this.tail.prev);i.next!==null&&i.data!==e;)i=i.next;i.data===e&&(i.prev!==null&&(i.prev.next=i.next),i.next!==null&&(i.next.prev=i.prev),this.length--)}}},{key:"values",value:Ww().mark(function t(){var e;return Ww().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:e=this.head;case 1:if(e===null){s.next=7;break}return s.next=4,e.data;case 4:e=e.next,s.next=1;break;case 7:case"end":return s.stop()}},t,this)})}]),n}(),wg=function(){function n(){Oe(this,n),F(this,"parentMatrix",void 0),F(this,"startSpeed",0),F(this,"startColor",new ke),F(this,"startSize",1),F(this,"position",new C),F(this,"velocity",new C),F(this,"age",0),F(this,"life",1),F(this,"size",1),F(this,"angularVelocity",void 0),F(this,"rotation",0),F(this,"color",new ke),F(this,"uvTile",0)}return Le(n,[{key:"died",get:function(){return this.age>=this.life}}]),n}(),w9=Le(function n(t,e,i){Oe(this,n),this.position=t,this.size=e,this.color=i}),xg=function(){function n(){Oe(this,n),F(this,"parentMatrix",void 0),F(this,"startSpeed",0),F(this,"startColor",new ke),F(this,"startSize",1),F(this,"position",new C),F(this,"localPosition",void 0),F(this,"velocity",new C),F(this,"age",0),F(this,"life",1),F(this,"size",1),F(this,"length",100),F(this,"color",new ke),F(this,"previous",new _9),F(this,"uvTile",0)}return Le(n,[{key:"update",value:function(){for(this.age<=this.life?this.previous.push(new w9(this.position.clone(),this.size,this.color.clone())):this.previous.length>0&&this.previous.dequeue();this.previous.length>this.length;)this.previous.dequeue()}},{key:"died",get:function(){return this.age>=this.life}},{key:"reset",value:function(){this.previous.clear()}}]),n}(),ts=function(){function n(t){Oe(this,n),F(this,"type",void 0),this.value=t,this.type="value"}return Le(n,[{key:"genValue",value:function(){return this.value}},{key:"toJSON",value:function(){return{type:"ConstantValue",value:this.value}}},{key:"clone",value:function(){return new n(this.value)}}],[{key:"fromJSON",value:function(e){return new n(e.value)}}]),n}(),y0=function(){function n(t,e){Oe(this,n),F(this,"type",void 0),this.a=t,this.b=e,this.type="value"}return Le(n,[{key:"genValue",value:function(){return vt.lerp(this.a,this.b,Math.random())}},{key:"toJSON",value:function(){return{type:"IntervalValue",a:this.a,b:this.b}}},{key:"clone",value:function(){return new n(this.a,this.b)}}],[{key:"fromJSON",value:function(e){return new n(e.a,e.b)}}]),n}(),x9=function(){function n(){Oe(this,n),F(this,"functions",void 0),this.functions=new Array}return Le(n,[{key:"findFunction",value:function(e){for(var i=0,s=0,r=this.functions.length-1;s+1<r;)if(i=Math.floor((s+r)/2),e<this.getStartX(i))r=i-1;else if(e>this.getEndX(i))s=i+1;else return i;for(var o=s;o<=r;o++)if(e>=this.functions[o][1]&&e<=this.getEndX(o))return o;return-1}},{key:"getStartX",value:function(e){return this.functions[e][1]}},{key:"setStartX",value:function(e,i){e>0&&(this.functions[e][1]=i)}},{key:"getEndX",value:function(e){return e+1<this.functions.length?this.functions[e+1][1]:1}},{key:"setEndX",value:function(e,i){e+1<this.functions.length&&(this.functions[e+1][1]=i)}},{key:"insertFunction",value:function(e,i){var s=this.findFunction(e);this.functions.splice(s+1,0,[i,e])}},{key:"removeFunction",value:function(e){return this.functions.splice(e,1)[0][0]}},{key:"getFunction",value:function(e){return this.functions[e][0]}},{key:"setFunction",value:function(e,i){this.functions[e][0]=i}},{key:"numOfFunctions",get:function(){return this.functions.length}}]),n}(),Xw=function(){function n(t,e,i,s){Oe(this,n),F(this,"p",void 0),this.p=[t,e,i,s]}return Le(n,[{key:"genValue",value:function(e){var i=e*e,s=e*e*e,r=1-e,o=r*r,a=o*r;return this.p[0]*a+this.p[1]*o*e*3+this.p[2]*r*i*3+this.p[3]*s}},{key:"derivativeCoefficients",value:function(e){for(var i=[],s=e,r=s.length-1;r>0;r--){for(var o=[],a=0;a<r;a++){var l=r*(s[a+1]-s[a]);o.push(l)}i.push(o),s=o}return i}},{key:"getSlope",value:function(e){var i=this.derivativeCoefficients(this.p)[0],s=1-e,r=s*s,o=s*e*2,a=e*e;return r*i[0]+o*i[1]+a*i[2]}},{key:"controlCurve",value:function(e,i){this.p[1]=e/3+this.p[0],this.p[2]=this.p[3]-i/3}},{key:"hull",value:function(e){var i=this.p,s=[],r,o=0,a=0,l=0,h=[];for(h[o++]=i[0],h[o++]=i[1],h[o++]=i[2],h[o++]=i[3];i.length>1;){for(s=[],a=0,l=i.length-1;a<l;a++)r=e*i[a]+(1-e)*i[a+1],h[o++]=r,s.push(r);i=s}return h}},{key:"split",value:function(e){var i=this.hull(e),s={left:new n(i[0],i[4],i[7],i[9]),right:new n(i[9],i[8],i[6],i[3]),span:i};return s}},{key:"clone",value:function(){return new n(this.p[0],this.p[1],this.p[2],this.p[3])}},{key:"toJSON",value:function(){return{p0:this.p[0],p1:this.p[1],p2:this.p[2],p3:this.p[3]}}}],[{key:"fromJSON",value:function(e){return new n(e.p0,e.p1,e.p2,e.p3)}}]),n}(),C9=function(n){uf(e,n);var t=df(e);function e(){var i,s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[[new Xw(0,.3333333333333333,.6666666666666666,1),0]];return Oe(this,e),i=t.call(this),F(rt(i),"type",void 0),i.type="function",i.functions=s,i}return Le(e,[{key:"genValue",value:function(){var s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,r=this.findFunction(s);return r===-1?0:this.functions[r][0].genValue((s-this.getStartX(r))/(this.getEndX(r)-this.getStartX(r)))}},{key:"toSVG",value:function(s,r){if(r<1)return"";for(var o=["M",0,this.functions[0][0].p[0]].join(" "),a=1/r;a<=1;a+=1/r)o=[o,"L",a*s,this.genValue(a)].join(" ");return o}},{key:"toJSON",value:function(){return{type:"PiecewiseBezier",functions:this.functions.map(function(s){var r=xd(s,2),o=r[0],a=r[1];return{function:o.toJSON(),start:a}})}}},{key:"clone",value:function(){return new e(this.functions.map(function(s){var r=xd(s,2),o=r[0],a=r[1];return[o.clone(),a]}))}}],[{key:"fromJSON",value:function(s){return new e(s.functions.map(function(r){return[Xw.fromJSON(r.function),r.start]}))}}]),e}(x9);function qt(n){switch(n.type){case"ConstantValue":return ts.fromJSON(n);case"IntervalValue":return y0.fromJSON(n);case"PiecewiseBezier":return C9.fromJSON(n);default:return new ts(0)}}var Cg=function(t){return{r:t.x,g:t.y,b:t.z,a:t.w}},Sg=function(t){return new ke(t.r,t.g,t.b,t.a)},S9=function(t,e){switch(e){case"Vector3":return new C(t.x,t.y,t.z);case"Vector4":return new ke(t.x,t.y,t.z,t.w);case"Color":return new C(t.r,t.g,t.b);case"Number":return t;default:return t}},E9=function(t,e){switch(e){case"Vector3":return{x:t.x,y:t.y,z:t.z};case"Vector4":return{x:t.x,y:t.y,z:t.z,w:t.w};case"Color":return{r:t.x,g:t.y,b:t.z};case"Number":return t;default:return t}},I9=function(){function n(t,e){Oe(this,n),F(this,"type",void 0),this.a=t,this.b=e,this.type="value"}return Le(n,[{key:"genColor",value:function(e){var i=Math.random();return e.copy(this.a).lerp(this.b,i)}},{key:"toJSON",value:function(){return{type:"RandomColor",a:Cg(this.a),b:Cg(this.b)}}},{key:"clone",value:function(){return new n(this.a.clone(),this.b.clone())}}],[{key:"fromJSON",value:function(e){return new n(Sg(e.a),Sg(e.b))}}]),n}(),Yw=function(){function n(t,e){Oe(this,n),F(this,"type",void 0),this.a=t,this.b=e,this.type="function"}return Le(n,[{key:"genColor",value:function(e,i){return e.copy(this.a).lerp(this.b,i)}},{key:"toJSON",value:function(){return{type:"ColorRange",a:Cg(this.a),b:Cg(this.b)}}},{key:"clone",value:function(){return new n(this.a.clone(),this.b.clone())}}],[{key:"fromJSON",value:function(e){return new n(Sg(e.a),Sg(e.b))}}]),n}(),pA=function(){function n(t,e){Oe(this,n),F(this,"keys",void 0),F(this,"type",void 0),F(this,"subType",void 0),this.subType=e,this.type="function",this.keys=t}return Le(n,[{key:"findKey",value:function(e){for(var i=0,s=0,r=this.keys.length-1;s+1<r;)if(i=Math.floor((s+r)/2),e<this.getStartX(i))r=i-1;else if(e>this.getEndX(i))s=i+1;else return i;for(var o=s;o<=r;o++)if(e>=this.getStartX(o)&&e<=this.getEndX(o))return o;return-1}},{key:"getStartX",value:function(e){return this.keys[e][1]}},{key:"getEndX",value:function(e){return e+1<this.keys.length?this.keys[e+1][1]:1}},{key:"genValue",value:function(e,i){var s=this.findKey(i);return this.subType==="Number"?s===-1?this.keys[0][0]:s+1>=this.keys.length?this.keys[this.keys.length-1][0]:(this.keys[s+1][0]-this.keys[s][0])*((i-this.getStartX(s))/(this.getEndX(s)-this.getStartX(s)))+this.keys[s][0]:s===-1?e.copy(this.keys[0][0]):s+1>=this.keys.length?e.copy(this.keys[this.keys.length-1][0]):e.copy(this.keys[s][0]).lerp(this.keys[s+1][0],(i-this.getStartX(s))/(this.getEndX(s)-this.getStartX(s)))}},{key:"toJSON",value:function(){var e=this;return this.keys[0][0].constructor.name,{type:"CLinearFunction",subType:this.subType,keys:this.keys.map(function(i){var s=xd(i,2),r=s[0],o=s[1];return{value:E9(r,e.subType),pos:o}})}}},{key:"clone",value:function(){return this.subType==="Number"?new n(this.keys.map(function(e){var i=xd(e,2),s=i[0],r=i[1];return[s,r]}),this.subType):new n(this.keys.map(function(e){var i=xd(e,2),s=i[0],r=i[1];return[s.clone(),r]}),this.subType)}}],[{key:"fromJSON",value:function(e){return new n(e.keys.map(function(i){return[S9(i.value,e.subType),i.pos]}),e.subType)}}]),n}(),gA=new C,Kw=function(){function n(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[[new C(0,0,0),0],[new C(1,1,1),0]],e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[[1,0],[1,1]];Oe(this,n),F(this,"type",void 0),F(this,"color",void 0),F(this,"alpha",void 0),this.type="function",this.color=new pA(t,"Color"),this.alpha=new pA(e,"Number")}return Le(n,[{key:"genColor",value:function(e,i){return this.color.genValue(gA,i),e.set(gA.x,gA.y,gA.z,this.alpha.genValue(1,i))}},{key:"toJSON",value:function(){return{type:"Gradient",color:this.color.toJSON(),alpha:this.alpha.toJSON()}}},{key:"clone",value:function(){var e=new n;return e.alpha=this.alpha.clone(),e.color=this.color.clone(),e}}],[{key:"fromJSON",value:function(e){if(e.functions){var i=e.functions.map(function(r){return[Yw.fromJSON(r.function).a,r.start]});return e.functions.length>0&&i.push([Yw.fromJSON(e.functions[e.functions.length-1].function).b,1]),new n(i.map(function(r){return[new C(r[0].x,r[0].y,r[0].z),r[1]]}),i.map(function(r){return[r[0].w,r[1]]}))}else{var s=new n;return s.alpha=pA.fromJSON(e.alpha),s.color=pA.fromJSON(e.color),s}}}]),n}(),o_=new ke,T9=function(){function n(t,e){Oe(this,n),F(this,"gradient1",void 0),F(this,"gradient2",void 0),F(this,"type",void 0),this.type="memorizedFunction",this.gradient1=t,this.gradient2=e}return Le(n,[{key:"startGen",value:function(e){e.rand=Math.random()}},{key:"genColor",value:function(e,i,s){return this.gradient1.genColor(e,i),this.gradient2.genColor(o_,i),s&&s.rand?e.lerp(o_,s.rand):e.lerp(o_,Math.random()),e}},{key:"toJSON",value:function(){return{type:"RandomColorBetweenGradient",gradient1:this.gradient1.toJSON(),gradient2:this.gradient2.toJSON()}}},{key:"clone",value:function(){return new n(this.gradient1.clone(),this.gradient2.clone())}}],[{key:"fromJSON",value:function(e){return new n(Kw.fromJSON(e.gradient1),Kw.fromJSON(e.gradient2))}}]),n}(),Hv=function(){function n(t){Oe(this,n),F(this,"type",void 0),this.color=t,this.type="value"}return Le(n,[{key:"genColor",value:function(e){return e.copy(this.color)}},{key:"toJSON",value:function(){return{type:"ConstantColor",color:Cg(this.color)}}},{key:"clone",value:function(){return new n(this.color.clone())}}],[{key:"fromJSON",value:function(e){return new n(Sg(e.color))}}]),n}();function aS(n){switch(n.type){case"ConstantColor":return Hv.fromJSON(n);case"ColorRange":return Yw.fromJSON(n);case"RandomColor":return I9.fromJSON(n);case"Gradient":return Kw.fromJSON(n);case"RandomColorBetweenGradient":return T9.fromJSON(n);default:return new Hv(new ke(1,1,1,1))}}var xT=function(){function n(){Oe(this,n),F(this,"type",void 0),this.type="rotation"}return Le(n,[{key:"genValue",value:function(e,i){var s,r,o,a,l,h;do s=Math.random()*2-1,r=Math.random()*2-1,o=s*s+r*r;while(o>1);do a=Math.random()*2-1,l=Math.random()*2-1,h=a*a+l*l;while(h>1);var u=Math.sqrt((1-o)/h);return e.set(s,r,u*a,u*l),e}},{key:"toJSON",value:function(){return{type:"RandomQuat"}}},{key:"clone",value:function(){return new n}}],[{key:"fromJSON",value:function(e){return new n}}]),n}(),Kk=function(){function n(t,e){Oe(this,n),F(this,"type",void 0),this.axis=t,this.angle=e,this.type="rotation"}return Le(n,[{key:"genValue",value:function(e,i){return e.setFromAxisAngle(this.axis,this.angle.genValue(i))}},{key:"toJSON",value:function(){return{type:"AxisAngle",axis:{x:this.axis.x,y:this.axis.y,z:this.axis.z},angle:this.angle.toJSON()}}},{key:"clone",value:function(){return new n(this.axis.clone(),this.angle.clone())}}],[{key:"fromJSON",value:function(e){return new n(e.axis,qt(e.angle))}}]),n}(),R9=function(){function n(t,e,i){Oe(this,n),F(this,"type",void 0),this.angleX=t,this.angleY=e,this.angleZ=i,this.type="rotation"}return Le(n,[{key:"genValue",value:function(e,i){return e.setFromEuler(new fi(this.angleX.genValue(i),this.angleY.genValue(i),this.angleZ.genValue(i)))}},{key:"toJSON",value:function(){return{type:"Euler",angleX:this.angleX.toJSON(),angleY:this.angleY.toJSON(),angleZ:this.angleZ.toJSON()}}},{key:"clone",value:function(){return new n(this.angleX,this.angleY,this.angleZ)}}],[{key:"fromJSON",value:function(e){return new n(qt(e.angleX),qt(e.angleY),qt(e.angleZ))}}]),n}();function Jk(n){switch(n.type){case"AxisAngle":return Kk.fromJSON(n);case"Euler":return R9.fromJSON(n);case"RandomQuat":return xT.fromJSON(n);default:return new xT}}function B9(n){switch(n.type){case"ConstantValue":case"IntervalValue":case"PiecewiseBezier":return qt(n);case"AxisAngle":case"RandomQuat":case"Euler":return Jk(n);default:return new ts(0)}}var CT=function(){function n(t){Oe(this,n),F(this,"type","ColorOverLife"),this.color=t}return Le(n,[{key:"initialize",value:function(e){this.color.type==="memorizedFunction"&&(e.colorOverLifeMemory={},this.color.startGen(e.colorOverLifeMemory))}},{key:"update",value:function(e,i){this.color.type==="memorizedFunction"?this.color.genColor(e.color,e.age/e.life,e.colorOverLifeMemory):this.color.genColor(e.color,e.age/e.life),e.color.x*=e.startColor.x,e.color.y*=e.startColor.y,e.color.z*=e.startColor.z,e.color.w*=e.startColor.w}},{key:"frameUpdate",value:function(e){}},{key:"toJSON",value:function(){return{type:this.type,color:this.color.toJSON()}}},{key:"clone",value:function(){return new n(this.color.clone())}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(e){return new n(aS(e.color))}}]),n}(),ST=function(){function n(t,e){Oe(this,n),F(this,"type","RotationOverLife"),F(this,"tempQuat",new ne),this.angularVelocity=t,this.dynamic=e}return Le(n,[{key:"initialize",value:function(e){!this.dynamic&&e instanceof wg&&(e.angularVelocity=this.angularVelocity.genValue())}},{key:"update",value:function(e,i){this.dynamic?e.rotation+=i*this.angularVelocity.genValue(e.age/e.life):e instanceof wg&&(e.rotation+=i*e.angularVelocity)}},{key:"toJSON",value:function(){return{type:this.type,angularVelocity:this.angularVelocity.toJSON(),dynamic:this.dynamic}}},{key:"frameUpdate",value:function(e){}},{key:"clone",value:function(){return new n(this.angularVelocity.clone(),this.dynamic)}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(e){return new n(qt(e.angularVelocity),e.dynamic)}}]),n}(),ET=function(){function n(t){Oe(this,n),F(this,"type","SizeOverLife"),this.size=t}return Le(n,[{key:"initialize",value:function(e){}},{key:"update",value:function(e){e.size=e.startSize*this.size.genValue(e.age/e.life)}},{key:"toJSON",value:function(){return{type:this.type,size:this.size.toJSON()}}},{key:"frameUpdate",value:function(e){}},{key:"clone",value:function(){return new n(this.size.clone())}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(e){return new n(qt(e.size))}}]),n}(),IT=function(){function n(t){Oe(this,n),F(this,"type","SpeedOverLife"),this.speed=t}return Le(n,[{key:"initialize",value:function(e){}},{key:"update",value:function(e){e.velocity.normalize().multiplyScalar(e.startSpeed*this.speed.genValue(e.age/e.life))}},{key:"toJSON",value:function(){return{type:this.type,speed:this.speed.toJSON()}}},{key:"frameUpdate",value:function(e){}},{key:"clone",value:function(){return new n(this.speed.clone())}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(e){return new n(qt(e.speed))}}]),n}(),TT=function(){function n(t,e){Oe(this,n),F(this,"type","RotationBySpeed"),F(this,"tempQuat",new ne),this.angularVelocity=t,this.speedRange=e}return Le(n,[{key:"initialize",value:function(e){}},{key:"update",value:function(e,i){var s=(e.startSpeed-this.speedRange.a)/(this.speedRange.b-this.speedRange.a);e.rotation+=i*this.angularVelocity.genValue(s)}},{key:"toJSON",value:function(){return{type:this.type,angularVelocity:this.angularVelocity.toJSON(),speedRange:this.speedRange.toJSON()}}},{key:"frameUpdate",value:function(e){}},{key:"clone",value:function(){return new n(this.angularVelocity.clone(),this.speedRange.clone())}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(e){return new n(qt(e.angularVelocity),y0.fromJSON(e.speedRange))}}]),n}(),RT=function(){function n(t,e){Oe(this,n),F(this,"type","SizeBySpeed"),this.size=t,this.speedRange=e}return Le(n,[{key:"initialize",value:function(e){}},{key:"update",value:function(e){var i=(e.startSpeed-this.speedRange.a)/(this.speedRange.b-this.speedRange.a);e.size=e.startSize*this.size.genValue(i)}},{key:"toJSON",value:function(){return{type:this.type,size:this.size.toJSON(),speedRange:this.speedRange.toJSON()}}},{key:"frameUpdate",value:function(e){}},{key:"clone",value:function(){return new n(this.size.clone(),this.speedRange.clone())}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(e){return new n(qt(e.size),y0.fromJSON(e.speedRange))}}]),n}(),BT=function(){function n(t,e){Oe(this,n),F(this,"type","ColorBySpeed"),this.color=t,this.speedRange=e}return Le(n,[{key:"initialize",value:function(e){this.color.type==="memorizedFunction"&&(e.colorOverLifeMemory={},this.color.startGen(e.colorOverLifeMemory))}},{key:"update",value:function(e,i){var s=(e.startSpeed-this.speedRange.a)/(this.speedRange.b-this.speedRange.a);this.color.type==="memorizedFunction"?this.color.genColor(e.color,s,e.colorOverLifeMemory):this.color.genColor(e.color,s),e.color.x*=e.startColor.x,e.color.y*=e.startColor.y,e.color.z*=e.startColor.z,e.color.w*=e.startColor.w}},{key:"frameUpdate",value:function(e){}},{key:"toJSON",value:function(){return{type:this.type,color:this.color.toJSON(),speedRange:this.speedRange.toJSON()}}},{key:"clone",value:function(){return new n(this.color.clone(),this.speedRange.clone())}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(e){return new n(aS(e.color),y0.fromJSON(e.speedRange))}}]),n}(),PT=function(){function n(t){Oe(this,n),F(this,"type","FrameOverLife"),this.frame=t}return Le(n,[{key:"initialize",value:function(e){}},{key:"update",value:function(e,i){e.uvTile=Math.floor(this.frame.genValue(e.age/e.life))}},{key:"frameUpdate",value:function(e){}},{key:"toJSON",value:function(){return{type:this.type,frame:this.frame.toJSON()}}},{key:"clone",value:function(){return new n(this.frame.clone())}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(e){return new n(qt(e.frame))}}]),n}();new C(0,0,1);var MT=function(){function n(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new C(0,1,0);Oe(this,n),F(this,"type","OrbitOverLife"),F(this,"rotation",void 0),F(this,"line",void 0),F(this,"temp",new C),this.orbitSpeed=t,this.axis=e,this.rotation=new ne,this.line=new eB}return Le(n,[{key:"initialize",value:function(e){}},{key:"update",value:function(e,i){this.line.set(new C(0,0,0),this.axis),this.line.closestPointToPoint(e.position,!1,this.temp),this.rotation.setFromAxisAngle(this.axis,this.orbitSpeed.genValue(e.age/e.life)*i),e.position.sub(this.temp),e.position.applyQuaternion(this.rotation),e.position.add(this.temp)}},{key:"frameUpdate",value:function(e){}},{key:"toJSON",value:function(){return{type:this.type,orbitSpeed:this.orbitSpeed.toJSON(),axis:[this.axis.x,this.axis.y,this.axis.z]}}},{key:"clone",value:function(){return new n(this.orbitSpeed.clone())}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(e){return new n(qt(e.orbitSpeed),e.axis?new C(e.axis[0],e.axis[1],e.axis[2]):void 0)}}]),n}(),DT=function(){function n(t,e){Oe(this,n),F(this,"type","ApplyForce"),F(this,"magnitudeValue",void 0),this.direction=t,this.magnitude=e,this.magnitudeValue=this.magnitude.genValue()}return Le(n,[{key:"initialize",value:function(e){}},{key:"update",value:function(e,i){e.velocity.addScaledVector(this.direction,this.magnitudeValue*i)}},{key:"frameUpdate",value:function(e){this.magnitudeValue=this.magnitude.genValue()}},{key:"toJSON",value:function(){return{type:this.type,direction:[this.direction.x,this.direction.y,this.direction.z],magnitude:this.magnitude.toJSON()}}},{key:"clone",value:function(){return new n(this.direction.clone(),this.magnitude.clone())}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(e){var i;return new n(new C(e.direction[0],e.direction[1],e.direction[2]),qt((i=e.magnitude)!==null&&i!==void 0?i:e.force))}}]),n}(),kT=function(){function n(t,e){Oe(this,n),F(this,"type","GravityForce"),F(this,"temp",new C),this.center=t,this.magnitude=e}return Le(n,[{key:"initialize",value:function(e){}},{key:"update",value:function(e,i){this.temp.copy(this.center).sub(e.position).normalize(),e.velocity.addScaledVector(this.temp,this.magnitude/e.position.distanceToSquared(this.center)*i)}},{key:"frameUpdate",value:function(e){}},{key:"toJSON",value:function(){return{type:this.type,center:[this.center.x,this.center.y,this.center.z],magnitude:this.magnitude}}},{key:"clone",value:function(){return new n(this.center.clone(),this.magnitude)}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(e){return new n(new C(e.center[0],e.center[1],e.center[2]),e.magnitude)}}]),n}(),OT=function(){function n(t){Oe(this,n),F(this,"type","WidthOverLength"),this.width=t}return Le(n,[{key:"initialize",value:function(e){}},{key:"update",value:function(e){if(e instanceof xg)for(var i=e.previous.values(),s=0;s<e.previous.length;s++){var r=i.next();r.value.size=this.width.genValue((e.previous.length-s)/e.length)}}},{key:"frameUpdate",value:function(e){}},{key:"toJSON",value:function(){return{type:this.type,width:this.width.toJSON()}}},{key:"clone",value:function(){return new n(this.width.clone())}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(e){return new n(qt(e.width))}}]),n}();new C(0,0,1);var LT=function(){function n(t){Oe(this,n),F(this,"type","ChangeEmitDirection"),F(this,"_temp",new C),F(this,"_q",new ne),this.angle=t}return Le(n,[{key:"initialize",value:function(e){var i=e.velocity.length();i!=0&&(e.velocity.normalize(),e.velocity.x===0&&e.velocity.y===0?this._temp.set(0,e.velocity.z,0):this._temp.set(-e.velocity.y,e.velocity.x,0),this._q.setFromAxisAngle(this._temp.normalize(),this.angle.genValue()),this._temp.copy(e.velocity),e.velocity.applyQuaternion(this._q),this._q.setFromAxisAngle(this._temp,Math.random()*Math.PI*2),e.velocity.applyQuaternion(this._q),e.velocity.setLength(i))}},{key:"update",value:function(e,i){}},{key:"frameUpdate",value:function(e){}},{key:"toJSON",value:function(){return{type:this.type,angle:this.angle.toJSON()}}},{key:"clone",value:function(){return new n(this.angle)}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(e){return new n(qt(e.angle))}}]),n}(),P9=new C(1,1,1),FT=new C(0,0,1),UT=function(){function n(t,e,i){Oe(this,n),F(this,"type","EmitSubParticleSystem"),F(this,"q_",new ne),F(this,"v_",new C),F(this,"v2_",new C),this.particleSystem=t,this.useVelocityAsBasis=e,this.subParticleSystem=i,this.subParticleSystem&&this.subParticleSystem.system&&(this.subParticleSystem.system.onlyUsedByOther=!0)}return Le(n,[{key:"initialize",value:function(e){e.emissionState={burstIndex:0,burstWaveIndex:0,time:0,waitEmiting:0,matrix:new ce}}},{key:"update",value:function(e,i){if(!(!this.subParticleSystem||!e.emissionState)){var s=e.emissionState.matrix,r;if(e.rotation===void 0||this.useVelocityAsBasis)if(e.velocity.x===0&&e.velocity.y===0&&(e.velocity.z===1||e.velocity.z===0))s.set(1,0,0,e.position.x,0,1,0,e.position.y,0,0,1,e.position.z,0,0,0,1);else{this.v_.copy(FT).cross(e.velocity),this.v2_.copy(e.velocity).cross(this.v_);var o=this.v_.length(),a=this.v2_.length();s.set(this.v_.x/o,this.v2_.x/a,e.velocity.x,e.position.x,this.v_.y/o,this.v2_.y/a,e.velocity.y,e.position.y,this.v_.z/o,this.v2_.z/a,e.velocity.z,e.position.z,0,0,0,1)}else e.rotation instanceof ne?r=e.rotation:(this.q_.setFromAxisAngle(FT,e.rotation),r=this.q_),s.compose(e.position,r,P9);this.particleSystem.worldSpace||s.multiplyMatrices(this.particleSystem.emitter.matrixWorld,s),this.subParticleSystem.system.emit(i,e.emissionState,s)}}},{key:"frameUpdate",value:function(e){}},{key:"toJSON",value:function(){return{type:this.type,subParticleSystem:this.subParticleSystem?this.subParticleSystem.uuid:"",useVelocityAsBasis:this.useVelocityAsBasis}}},{key:"clone",value:function(){return new n(this.particleSystem,this.useVelocityAsBasis,this.subParticleSystem)}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(e,i){return new n(i,e.useVelocityAsBasis,e.subParticleSystem)}}]),n}(),M9=.5*(Math.sqrt(3)-1),jf=(3-Math.sqrt(3))/6,D9=1/3,ea=1/6,k9=(Math.sqrt(5)-1)/4,wn=(5-Math.sqrt(5))/20,nn=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),Oi=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]),Zk=function(){function n(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Math.random;Oe(this,n),F(this,"p",void 0),F(this,"perm",void 0),F(this,"permMod12",void 0);var e=typeof t=="function"?t:L9(t);this.p=O9(e),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(var i=0;i<512;i++)this.perm[i]=this.p[i&255],this.permMod12[i]=this.perm[i]%12}return Le(n,[{key:"noise2D",value:function(e,i){var s=this.permMod12,r=this.perm,o=0,a=0,l=0,h=(e+i)*M9,u=Math.floor(e+h),d=Math.floor(i+h),f=(u+d)*jf,p=u-f,g=d-f,m=e-p,v=i-g,y,b;m>v?(y=1,b=0):(y=0,b=1);var _=m-y+jf,x=v-b+jf,S=m-1+2*jf,T=v-1+2*jf,L=u&255,I=d&255,P=.5-m*m-v*v;if(P>=0){var R=s[L+r[I]]*3;P*=P,o=P*P*(nn[R]*m+nn[R+1]*v)}var B=.5-_*_-x*x;if(B>=0){var Q=s[L+y+r[I+b]]*3;B*=B,a=B*B*(nn[Q]*_+nn[Q+1]*x)}var G=.5-S*S-T*T;if(G>=0){var V=s[L+1+r[I+1]]*3;G*=G,l=G*G*(nn[V]*S+nn[V+1]*T)}return 70*(o+a+l)}},{key:"noise3D",value:function(e,i,s){var r=this.permMod12,o=this.perm,a,l,h,u,d=(e+i+s)*D9,f=Math.floor(e+d),p=Math.floor(i+d),g=Math.floor(s+d),m=(f+p+g)*ea,v=f-m,y=p-m,b=g-m,_=e-v,x=i-y,S=s-b,T,L,I,P,R,B;_>=x?x>=S?(T=1,L=0,I=0,P=1,R=1,B=0):_>=S?(T=1,L=0,I=0,P=1,R=0,B=1):(T=0,L=0,I=1,P=1,R=0,B=1):x<S?(T=0,L=0,I=1,P=0,R=1,B=1):_<S?(T=0,L=1,I=0,P=0,R=1,B=1):(T=0,L=1,I=0,P=1,R=1,B=0);var Q=_-T+ea,G=x-L+ea,V=S-I+ea,X=_-P+2*ea,k=x-R+2*ea,M=S-B+2*ea,H=_-1+3*ea,ee=x-1+3*ea,Y=S-1+3*ea,he=f&255,de=p&255,ve=g&255,_e=.6-_*_-x*x-S*S;if(_e<0)a=0;else{var Ge=r[he+o[de+o[ve]]]*3;_e*=_e,a=_e*_e*(nn[Ge]*_+nn[Ge+1]*x+nn[Ge+2]*S)}var Te=.6-Q*Q-G*G-V*V;if(Te<0)l=0;else{var We=r[he+T+o[de+L+o[ve+I]]]*3;Te*=Te,l=Te*Te*(nn[We]*Q+nn[We+1]*G+nn[We+2]*V)}var It=.6-X*X-k*k-M*M;if(It<0)h=0;else{var _t=r[he+P+o[de+R+o[ve+B]]]*3;It*=It,h=It*It*(nn[_t]*X+nn[_t+1]*k+nn[_t+2]*M)}var $t=.6-H*H-ee*ee-Y*Y;if($t<0)u=0;else{var yi=r[he+1+o[de+1+o[ve+1]]]*3;$t*=$t,u=$t*$t*(nn[yi]*H+nn[yi+1]*ee+nn[yi+2]*Y)}return 32*(a+l+h+u)}},{key:"noise4D",value:function(e,i,s,r){var o=this.perm,a,l,h,u,d,f=(e+i+s+r)*k9,p=Math.floor(e+f),g=Math.floor(i+f),m=Math.floor(s+f),v=Math.floor(r+f),y=(p+g+m+v)*wn,b=p-y,_=g-y,x=m-y,S=v-y,T=e-b,L=i-_,I=s-x,P=r-S,R=0,B=0,Q=0,G=0;T>L?R++:B++,T>I?R++:Q++,T>P?R++:G++,L>I?B++:Q++,L>P?B++:G++,I>P?Q++:G++;var V=R>=3?1:0,X=B>=3?1:0,k=Q>=3?1:0,M=G>=3?1:0,H=R>=2?1:0,ee=B>=2?1:0,Y=Q>=2?1:0,he=G>=2?1:0,de=R>=1?1:0,ve=B>=1?1:0,_e=Q>=1?1:0,Ge=G>=1?1:0,Te=T-V+wn,We=L-X+wn,It=I-k+wn,_t=P-M+wn,$t=T-H+2*wn,yi=L-ee+2*wn,ds=I-Y+2*wn,Sr=P-he+2*wn,Wn=T-de+3*wn,$s=L-ve+3*wn,Er=I-_e+3*wn,Ir=P-Ge+3*wn,ao=T-1+4*wn,lo=L-1+4*wn,Tr=I-1+4*wn,er=P-1+4*wn,mn=p&255,Ls=g&255,tr=m&255,qn=v&255,fs=.6-T*T-L*L-I*I-P*P;if(fs<0)a=0;else{var ps=o[mn+o[Ls+o[tr+o[qn]]]]%32*4;fs*=fs,a=fs*fs*(Oi[ps]*T+Oi[ps+1]*L+Oi[ps+2]*I+Oi[ps+3]*P)}var An=.6-Te*Te-We*We-It*It-_t*_t;if(An<0)l=0;else{var zi=o[mn+V+o[Ls+X+o[tr+k+o[qn+M]]]]%32*4;An*=An,l=An*An*(Oi[zi]*Te+Oi[zi+1]*We+Oi[zi+2]*It+Oi[zi+3]*_t)}var Xn=.6-$t*$t-yi*yi-ds*ds-Sr*Sr;if(Xn<0)h=0;else{var Fs=o[mn+H+o[Ls+ee+o[tr+Y+o[qn+he]]]]%32*4;Xn*=Xn,h=Xn*Xn*(Oi[Fs]*$t+Oi[Fs+1]*yi+Oi[Fs+2]*ds+Oi[Fs+3]*Sr)}var Yn=.6-Wn*Wn-$s*$s-Er*Er-Ir*Ir;if(Yn<0)u=0;else{var Zi=o[mn+de+o[Ls+ve+o[tr+_e+o[qn+Ge]]]]%32*4;Yn*=Yn,u=Yn*Yn*(Oi[Zi]*Wn+Oi[Zi+1]*$s+Oi[Zi+2]*Er+Oi[Zi+3]*Ir)}var Ft=.6-ao*ao-lo*lo-Tr*Tr-er*er;if(Ft<0)d=0;else{var dt=o[mn+1+o[Ls+1+o[tr+1+o[qn+1]]]]%32*4;Ft*=Ft,d=Ft*Ft*(Oi[dt]*ao+Oi[dt+1]*lo+Oi[dt+2]*Tr+Oi[dt+3]*er)}return 27*(a+l+h+u+d)}}]),n}();function O9(n){for(var t=new Uint8Array(256),e=0;e<256;e++)t[e]=e;for(var i=0;i<255;i++){var s=i+~~(n()*(256-i)),r=t[i];t[i]=t[s],t[s]=r}return t}function L9(n){var t=0,e=0,i=0,s=1,r=F9();return t=r(" "),e=r(" "),i=r(" "),t-=r(n),t<0&&(t+=1),e-=r(n),e<0&&(e+=1),i-=r(n),i<0&&(i+=1),function(){var o=2091639*t+s*23283064365386963e-26;return t=e,e=i,i=o-(s=o|0)}}function F9(){var n=4022871197;return function(t){t=t.toString();for(var e=0;e<t.length;e++){n+=t.charCodeAt(e);var i=.02519603282416938*n;n=i>>>0,i-=n,i*=n,n=i>>>0,i-=n,n+=i*4294967296}return(n>>>0)*23283064365386963e-26}}var NT=function(){function n(t,e,i,s){Oe(this,n),F(this,"type","TurbulenceField"),F(this,"generator",new Zk),F(this,"timeOffset",new C),F(this,"temp",new C),F(this,"temp2",new C),this.scale=t,this.octaves=e,this.velocityMultiplier=i,this.timeScale=s,this.timeOffset.x=Math.random()/this.scale.x*this.timeScale.x,this.timeOffset.y=Math.random()/this.scale.y*this.timeScale.y,this.timeOffset.z=Math.random()/this.scale.z*this.timeScale.z}return Le(n,[{key:"initialize",value:function(e){}},{key:"update",value:function(e,i){var s=e.position.x/this.scale.x,r=e.position.y/this.scale.y,o=e.position.z/this.scale.z;this.temp.set(0,0,0);for(var a=1,l=0;l<this.octaves;l++)this.temp2.set(this.generator.noise4D(s*a,r*a,o*a,this.timeOffset.x*a)/a,this.generator.noise4D(s*a,r*a,o*a,this.timeOffset.y*a)/a,this.generator.noise4D(s*a,r*a,o*a,this.timeOffset.z*a)/a),this.temp.add(this.temp2),a*=2;this.temp.multiply(this.velocityMultiplier),e.velocity.addScaledVector(this.temp,i)}},{key:"toJSON",value:function(){return{type:this.type,scale:[this.scale.x,this.scale.y,this.scale.z],octaves:this.octaves,velocityMultiplier:[this.velocityMultiplier.x,this.velocityMultiplier.y,this.velocityMultiplier.z],timeScale:[this.timeScale.x,this.timeScale.y,this.timeScale.z]}}},{key:"frameUpdate",value:function(e){this.timeOffset.x+=e*this.timeScale.x,this.timeOffset.y+=e*this.timeScale.y,this.timeOffset.z+=e*this.timeScale.z}},{key:"clone",value:function(){return new n(this.scale.clone(),this.octaves,this.velocityMultiplier.clone(),this.timeScale.clone())}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(e){return new n(new C(e.scale[0],e.scale[1],e.scale[2]),e.octaves,new C(e.velocityMultiplier[0],e.velocityMultiplier[1],e.velocityMultiplier[2]),new C(e.timeScale[0],e.timeScale[1],e.timeScale[2]))}}]),n}(),QT=new ne,zT=function(){function n(t,e){Oe(this,n),F(this,"type","Rotation3DOverLife"),F(this,"tempQuat",new ne),this.angularVelocity=t,this.dynamic=e}return Le(n,[{key:"initialize",value:function(e){!this.dynamic&&e instanceof wg&&(e.angularVelocity=new ne,this.angularVelocity.genValue(e.angularVelocity))}},{key:"update",value:function(e,i){this.dynamic?(this.angularVelocity.genValue(this.tempQuat,e.age/e.life),this.tempQuat.slerpQuaternions(QT,this.tempQuat,i),e.rotation.multiply(this.tempQuat)):e instanceof wg&&(this.tempQuat.slerpQuaternions(QT,e.angularVelocity,i),e.rotation.multiply(this.tempQuat))}},{key:"toJSON",value:function(){return{type:this.type,angularVelocity:this.angularVelocity.toJSON(),dynamic:this.dynamic}}},{key:"frameUpdate",value:function(e){}},{key:"clone",value:function(){return new n(this.angularVelocity.clone(),this.dynamic)}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(e){return new n(Jk(e.angularVelocity),e.dynamic)}}]),n}(),jT=function(){function n(t,e,i){Oe(this,n),F(this,"type","ForceOverLife"),F(this,"_temp",new C),this.x=t,this.y=e,this.z=i}return Le(n,[{key:"initialize",value:function(e){}},{key:"update",value:function(e){this._temp.set(this.x.genValue(e.age/e.life),this.y.genValue(e.age/e.life),this.z.genValue(e.age/e.life)),e.velocity.add(this._temp)}},{key:"toJSON",value:function(){return{type:this.type,x:this.x.toJSON(),y:this.y.toJSON(),z:this.z.toJSON()}}},{key:"frameUpdate",value:function(e){}},{key:"clone",value:function(){return new n(this.x.clone(),this.y.clone(),this.z.clone())}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(e){return new n(qt(e.x),qt(e.y),qt(e.z))}}]),n}(),GT=function(){function n(t,e){Oe(this,n),F(this,"type","Noise"),F(this,"generator",new Zk),F(this,"duration",0),F(this,"temp",new C),this.frequency=t,this.power=e}return Le(n,[{key:"initialize",value:function(e){e.startTime=this.duration}},{key:"update",value:function(e,i){this.temp.set(this.generator.noise2D(e.startTime*this.frequency.x,e.life/e.age*this.frequency.x),this.generator.noise2D(e.startTime*this.frequency.y+100.25,e.life/e.age*this.frequency.y+100.154),this.generator.noise2D(e.startTime*this.frequency.z+200.89,e.life/e.age*this.frequency.z+200.1)).multiply(this.power),e.position.addScaledVector(this.temp,i)}},{key:"toJSON",value:function(){return{type:this.type,frequency:[this.frequency.x,this.frequency.y,this.frequency.z],power:[this.power.x,this.power.y,this.power.z]}}},{key:"frameUpdate",value:function(e){this.duration+=e}},{key:"clone",value:function(){return new n(this.frequency.clone(),this.power.clone())}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(e){return new n(new C(e.frequency[0],e.frequency[1],e.frequency[2]),new C(e.power[0],e.power[1],e.power[2]))}}]),n}(),U9={ApplyForce:{type:"ApplyForce",constructor:DT,params:[["direction","vec3"],["magnitude","value"]],loadJSON:DT.fromJSON},Noise:{type:"Noise",constructor:GT,params:[["frequency","vec3"],["power","vec3"]],loadJSON:GT.fromJSON},TurbulenceField:{type:"TurbulenceField",constructor:NT,params:[["scale","vec3"],["octaves","number"],["velocityMultiplier","vec3"],["timeScale","vec3"]],loadJSON:NT.fromJSON},GravityForce:{type:"GravityForce",constructor:kT,params:[["center","vec3"],["magnitude","number"]],loadJSON:kT.fromJSON},ColorOverLife:{type:"ColorOverLife",constructor:CT,params:[["color","colorFunc"]],loadJSON:CT.fromJSON},RotationOverLife:{type:"RotationOverLife",constructor:ST,params:[["angularVelocity","valueFunc"],["dynamic","boolean"]],loadJSON:ST.fromJSON},Rotation3DOverLife:{type:"Rotation3DOverLife",constructor:zT,params:[["angularVelocity","rotationFunc"],["dynamic","boolean"]],loadJSON:zT.fromJSON},SizeOverLife:{type:"SizeOverLife",constructor:ET,params:[["size","valueFunc"]],loadJSON:ET.fromJSON},ColorBySpeed:{type:"ColorBySpeed",constructor:BT,params:[["color","colorFunc"],["speedRange","range"]],loadJSON:BT.fromJSON},RotationBySpeed:{type:"RotationBySpeed",constructor:TT,params:[["angularVelocity","valueFunc"],["speedRange","range"]],loadJSON:TT.fromJSON},SizeBySpeed:{type:"SizeBySpeed",constructor:RT,params:[["size","valueFunc"],["speedRange","range"]],loadJSON:RT.fromJSON},SpeedOverLife:{type:"SpeedOverLife",constructor:IT,params:[["speed","valueFunc"]],loadJSON:IT.fromJSON},FrameOverLife:{type:"FrameOverLife",constructor:PT,params:[["frame","valueFunc"]],loadJSON:PT.fromJSON},ForceOverLife:{type:"ForceOverLife",constructor:jT,params:[["x","valueFunc"],["y","valueFunc"],["z","valueFunc"]],loadJSON:jT.fromJSON},OrbitOverLife:{type:"OrbitOverLife",constructor:MT,params:[["orbitSpeed","valueFunc"],["axis","vec3"]],loadJSON:MT.fromJSON},WidthOverLength:{type:"WidthOverLength",constructor:OT,params:[["width","valueFunc"]],loadJSON:OT.fromJSON},ChangeEmitDirection:{type:"ChangeEmitDirection",constructor:LT,params:[["angle","value"]],loadJSON:LT.fromJSON},EmitSubParticleSystem:{type:"EmitSubParticleSystem",constructor:UT,params:[["particleSystem","self"],["useVelocityAsBasis","boolean"],["subParticleSystem","particleSystem"]],loadJSON:UT.fromJSON}};function N9(n,t){return U9[n.type].loadJSON(n,t)}var HT=function(){function n(){var t,e,i,s,r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Oe(this,n),F(this,"type","cone"),F(this,"radius",void 0),F(this,"arc",void 0),F(this,"thickness",void 0),F(this,"angle",void 0),this.radius=(t=r.radius)!==null&&t!==void 0?t:10,this.arc=(e=r.arc)!==null&&e!==void 0?e:2*Math.PI,this.thickness=(i=r.thickness)!==null&&i!==void 0?i:1,this.angle=(s=r.angle)!==null&&s!==void 0?s:Math.PI/6}return Le(n,[{key:"initialize",value:function(e){var i=Math.random(),s=vt.lerp(1-this.thickness,1,Math.random()),r=i*this.arc,o=Math.sqrt(s),a=Math.sin(r),l=Math.cos(r);e.position.x=o*l,e.position.y=o*a,e.position.z=0;var h=this.angle*o;e.velocity.set(0,0,Math.cos(h)).addScaledVector(e.position,Math.sin(h)).multiplyScalar(e.startSpeed),e.position.multiplyScalar(this.radius)}},{key:"toJSON",value:function(){return{type:"cone",radius:this.radius,arc:this.arc,thickness:this.thickness,angle:this.angle}}},{key:"clone",value:function(){return new n({radius:this.radius,arc:this.arc,thickness:this.thickness,angle:this.angle})}}],[{key:"fromJSON",value:function(e){return new n(e)}}]),n}(),VT=function(){function n(){var t,e,i,s,r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Oe(this,n),F(this,"type","donut"),F(this,"radius",void 0),F(this,"arc",void 0),F(this,"thickness",void 0),F(this,"angle",void 0),this.radius=(t=r.radius)!==null&&t!==void 0?t:10,this.arc=(e=r.arc)!==null&&e!==void 0?e:2*Math.PI,this.thickness=(i=r.thickness)!==null&&i!==void 0?i:1,this.angle=(s=r.angle)!==null&&s!==void 0?s:Math.PI/6}return Le(n,[{key:"initialize",value:function(e){var i=Math.random(),s=vt.lerp(this.thickness,1,Math.random()),r=i*this.arc,o=Math.sqrt(s),a=Math.sin(r),l=Math.cos(r);e.position.x=o*l,e.position.y=o*a,e.position.z=0;var h=this.angle*o;e.velocity.set(0,0,Math.cos(h)).addScaledVector(e.position,Math.sin(h)).multiplyScalar(e.startSpeed),e.position.multiplyScalar(this.radius)}},{key:"toJSON",value:function(){return{type:"donut",radius:this.radius,arc:this.arc,thickness:this.thickness,angle:this.angle}}},{key:"clone",value:function(){return new n({radius:this.radius,arc:this.arc,thickness:this.thickness,angle:this.angle})}}],[{key:"fromJSON",value:function(e){return new n(e)}}]),n}(),WT=function(){function n(){Oe(this,n),F(this,"type","point")}return Le(n,[{key:"initialize",value:function(e){var i=Math.random(),s=Math.random(),r=i*Math.PI*2,o=Math.acos(2*s-1),a=Math.cbrt(Math.random()),l=Math.sin(r),h=Math.cos(r),u=Math.sin(o),d=Math.cos(o);e.velocity.x=a*u*h,e.velocity.y=a*u*l,e.velocity.z=a*d,e.velocity.multiplyScalar(e.startSpeed),e.position.setScalar(0)}},{key:"toJSON",value:function(){return{type:"point"}}},{key:"clone",value:function(){return new n}}],[{key:"fromJSON",value:function(e){return new n}}]),n}(),Jw=function(){function n(){var t,e,i,s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Oe(this,n),F(this,"type","sphere"),F(this,"radius",void 0),F(this,"arc",void 0),F(this,"thickness",void 0),this.radius=(t=s.radius)!==null&&t!==void 0?t:10,this.arc=(e=s.arc)!==null&&e!==void 0?e:2*Math.PI,this.thickness=(i=s.thickness)!==null&&i!==void 0?i:1}return Le(n,[{key:"initialize",value:function(e){var i=Math.random(),s=Math.random(),r=vt.lerp(1-this.thickness,1,Math.random()),o=i*this.arc,a=Math.acos(2*s-1),l=Math.cbrt(r),h=Math.sin(o),u=Math.cos(o),d=Math.sin(a),f=Math.cos(a);e.position.x=l*d*u,e.position.y=l*d*h,e.position.z=l*f,e.velocity.setScalar(0).addScaledVector(e.position,e.startSpeed),e.position.multiplyScalar(this.radius)}},{key:"toJSON",value:function(){return{type:"sphere",radius:this.radius,arc:this.arc,thickness:this.thickness}}},{key:"clone",value:function(){return new n({radius:this.radius,arc:this.arc,thickness:this.thickness})}}],[{key:"fromJSON",value:function(e){return new n(e)}}]),n}(),qT=function(){function n(t){Oe(this,n),F(this,"type","mesh_surface"),F(this,"_triangleIndexToArea",[]),F(this,"_geometry",void 0),F(this,"_tempA",new C),F(this,"_tempB",new C),F(this,"_tempC",new C),t&&(this.geometry=t)}return Le(n,[{key:"geometry",get:function(){return this._geometry},set:function(e){if(this._geometry=e,e!==void 0&&typeof e!="string"){var i=new ZR;this._triangleIndexToArea.length=0;var s=0;if(e.getIndex()){var r=e.getIndex().array,o=r.length/3;this._triangleIndexToArea.push(0);for(var a=0;a<o;a++)i.setFromAttributeAndIndices(e.getAttribute("position"),r[a*3],r[a*3+1],r[a*3+2]),s+=i.getArea(),this._triangleIndexToArea.push(s);e.userData.triangleIndexToArea=this._triangleIndexToArea}}}},{key:"initialize",value:function(e){var i=this._geometry;if(!i||i.getIndex()===null){e.position.set(0,0,0),e.velocity.set(0,0,1).multiplyScalar(e.startSpeed);return}for(var s=this._triangleIndexToArea.length-1,r=0,o=s,a=Math.random()*this._triangleIndexToArea[s];r+1<o;){var l=Math.floor((r+o)/2);a<this._triangleIndexToArea[l]?o=l:r=l}var h=Math.random(),u=Math.random();h+u>1&&(h=1-h,u=1-u);var d=i.getIndex().array[r*3],f=i.getIndex().array[r*3+1],p=i.getIndex().array[r*3+2],g=i.getAttribute("position");this._tempA.fromBufferAttribute(g,d),this._tempB.fromBufferAttribute(g,f),this._tempC.fromBufferAttribute(g,p),this._tempB.sub(this._tempA),this._tempC.sub(this._tempA),this._tempA.addScaledVector(this._tempB,h).addScaledVector(this._tempC,u),e.position.copy(this._tempA),this._tempA.copy(this._tempB).cross(this._tempC).normalize(),e.velocity.copy(this._tempA).normalize().multiplyScalar(e.startSpeed)}},{key:"toJSON",value:function(){return{type:"mesh_surface",mesh:this._geometry?this._geometry.uuid:""}}},{key:"clone",value:function(){return new n(this._geometry)}}],[{key:"fromJSON",value:function(e,i){return new n(i.geometries[e.geometry])}}]),n}(),XT=function(){function n(){var t,e,i,s,r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Oe(this,n),F(this,"type","grid"),F(this,"width",void 0),F(this,"height",void 0),F(this,"column",void 0),F(this,"row",void 0),this.width=(t=r.width)!==null&&t!==void 0?t:1,this.height=(e=r.height)!==null&&e!==void 0?e:1,this.column=(i=r.column)!==null&&i!==void 0?i:10,this.row=(s=r.row)!==null&&s!==void 0?s:10}return Le(n,[{key:"initialize",value:function(e){var i=Math.floor(Math.random()*this.row),s=Math.floor(Math.random()*this.column);e.position.x=s*this.width/this.column-this.width/2,e.position.y=i*this.height/this.row-this.height/2,e.position.z=0,e.velocity.set(0,0,e.startSpeed)}},{key:"toJSON",value:function(){return{type:"grid",width:this.width,height:this.height,column:this.column,row:this.row}}},{key:"clone",value:function(){return new n({width:this.width,height:this.height,column:this.column,row:this.row})}}],[{key:"fromJSON",value:function(e){return new n(e)}}]),n}(),Q9={cone:{type:"cone",params:[["radius","number"],["arc","radian"],["thickness","number"],["angle","radian"]],constructor:HT,loadJSON:HT.fromJSON},donut:{type:"donut",params:[["radius","number"],["arc","radian"],["thickness","number"],["angle","radian"]],constructor:VT,loadJSON:VT.fromJSON},point:{type:"point",params:[],constructor:WT,loadJSON:WT.fromJSON},sphere:{type:"sphere",params:[["radius","number"],["arc","radian"],["thickness","number"],["angle","radian"]],constructor:Jw,loadJSON:Jw.fromJSON},grid:{type:"grid",params:[["width","number"],["height","number"],["rows","number"],["column","number"]],constructor:XT,loadJSON:XT.fromJSON},mesh_surface:{type:"mesh_surface",params:[["geometry","geometry"]],constructor:qT,loadJSON:qT.fromJSON}};function z9(n,t){return Q9[n.type].loadJSON(n,t)}var ye=function(n){return n[n.BillBoard=0]="BillBoard",n[n.StretchedBillBoard=1]="StretchedBillBoard",n[n.Mesh=2]="Mesh",n[n.Trail=3]="Trail",n[n.HorizontalBillBoard=4]="HorizontalBillBoard",n[n.VerticalBillBoard=5]="VerticalBillBoard",n}({}),$k=function(n){uf(e,n);var t=df(e);function e(i){var s;Oe(this,e),s=t.call(this),F(rt(s),"type","VFXBatch"),F(rt(s),"systems",void 0),F(rt(s),"settings",void 0),F(rt(s),"maxParticles",void 0),s.maxParticles=1e3,s.systems=new Set;var r=new $r;return r.mask=i.layers.mask,s.settings={instancingGeometry:i.instancingGeometry,renderMode:i.renderMode,renderOrder:i.renderOrder,material:i.material.clone(),uTileCount:i.uTileCount,vTileCount:i.vTileCount,layers:r},s.frustumCulled=!1,s.renderOrder=s.settings.renderOrder,s}return Le(e,[{key:"addSystem",value:function(s){this.systems.add(s)}},{key:"removeSystem",value:function(s){this.systems.delete(s)}}]),e}(J),j9=new C(0,0,1),a_=new ne,G9=new C,H9=new C;new C;var YT=60,V9=new Ys(1,1,1,1),W9=function(){function n(t){var e,i,s,r,o,a,l,h,u,d,f,p,g,m,v,y,b,_,x,S,T;Oe(this,n),F(this,"autoDestroy",void 0),F(this,"prewarm",void 0),F(this,"looping",void 0),F(this,"duration",void 0),F(this,"startLife",void 0),F(this,"startSpeed",void 0),F(this,"startRotation",void 0),F(this,"startSize",void 0),F(this,"startColor",void 0),F(this,"startTileIndex",void 0),F(this,"rendererEmitterSettings",void 0),F(this,"emissionOverTime",void 0),F(this,"emissionOverDistance",void 0),F(this,"emissionBursts",void 0),F(this,"onlyUsedByOther",void 0),F(this,"worldSpace",void 0),F(this,"speedFactor",void 0),F(this,"particleNum",void 0),F(this,"paused",void 0),F(this,"particles",void 0),F(this,"emitterShape",void 0),F(this,"emitter",void 0),F(this,"rendererSettings",void 0),F(this,"neededToUpdateRender",void 0),F(this,"behaviors",void 0),F(this,"prewarmed",void 0),F(this,"emissionState",void 0),F(this,"emitEnded",void 0),F(this,"markForDestroy",void 0),F(this,"previousWorldPos",void 0),F(this,"temp",new C),F(this,"travelDistance",0),F(this,"normalMatrix",new gc),F(this,"_renderer",void 0),this.autoDestroy=t.autoDestroy===void 0?!1:t.autoDestroy,this.duration=(e=t.duration)!==null&&e!==void 0?e:1,this.looping=t.looping===void 0?!0:t.looping,this.prewarm=t.prewarm===void 0?!1:t.prewarm,this.startLife=(i=t.startLife)!==null&&i!==void 0?i:new ts(5),this.startSpeed=(s=t.startSpeed)!==null&&s!==void 0?s:new ts(0),this.startRotation=(r=t.startRotation)!==null&&r!==void 0?r:new ts(0),this.startSize=(o=t.startSize)!==null&&o!==void 0?o:new ts(1),this.startColor=(a=t.startColor)!==null&&a!==void 0?a:new Hv(new ke(1,1,1,1)),this.emissionOverTime=(l=t.emissionOverTime)!==null&&l!==void 0?l:new ts(10),this.emissionOverDistance=(h=t.emissionOverDistance)!==null&&h!==void 0?h:new ts(0),this.emissionBursts=(u=t.emissionBursts)!==null&&u!==void 0?u:[],this.onlyUsedByOther=(d=t.onlyUsedByOther)!==null&&d!==void 0?d:!1,this.emitterShape=(f=t.shape)!==null&&f!==void 0?f:new Jw,this.behaviors=(p=t.behaviors)!==null&&p!==void 0?p:new Array,this.worldSpace=(g=t.worldSpace)!==null&&g!==void 0?g:!1,this.speedFactor=(m=t.speedFactor)!==null&&m!==void 0?m:0,this.rendererEmitterSettings=(v=t.rendererEmitterSettings)!==null&&v!==void 0?v:{},this.rendererSettings={instancingGeometry:(y=t.instancingGeometry)!==null&&y!==void 0?y:V9,renderMode:(b=t.renderMode)!==null&&b!==void 0?b:ye.BillBoard,renderOrder:(_=t.renderOrder)!==null&&_!==void 0?_:0,material:t.material,uTileCount:(x=t.uTileCount)!==null&&x!==void 0?x:1,vTileCount:(S=t.vTileCount)!==null&&S!==void 0?S:1,layers:(T=t.layers)!==null&&T!==void 0?T:new $r},this.neededToUpdateRender=!0,this.particles=new Array,this.startTileIndex=t.startTileIndex||new ts(0),this.emitter=new b9(this),this.paused=!1,this.particleNum=0,this.emissionState={burstIndex:0,burstWaveIndex:0,time:0,waitEmiting:0},this.emitEnded=!1,this.markForDestroy=!1,this.prewarmed=!1}return Le(n,[{key:"time",get:function(){return this.emissionState.time},set:function(e){this.emissionState.time=e}},{key:"layers",get:function(){return this.rendererSettings.layers}},{key:"texture",get:function(){return this.rendererSettings.material.map},set:function(e){this.rendererSettings.material.map=e,this.neededToUpdateRender=!0}},{key:"material",get:function(){return this.rendererSettings.material},set:function(e){this.rendererSettings.material=e,this.neededToUpdateRender=!0}},{key:"uTileCount",get:function(){return this.rendererSettings.uTileCount},set:function(e){this.rendererSettings.uTileCount=e,this.neededToUpdateRender=!0}},{key:"vTileCount",get:function(){return this.rendererSettings.vTileCount},set:function(e){this.rendererSettings.vTileCount=e,this.neededToUpdateRender=!0}},{key:"instancingGeometry",get:function(){return this.rendererSettings.instancingGeometry},set:function(e){this.restart(),this.particles.length=0,this.rendererSettings.instancingGeometry=e,this.neededToUpdateRender=!0}},{key:"renderMode",get:function(){return this.rendererSettings.renderMode},set:function(e){if((this.rendererSettings.renderMode!=ye.Trail&&e===ye.Trail||this.rendererSettings.renderMode==ye.Trail&&e!==ye.Trail)&&(this.restart(),this.particles.length=0),this.rendererSettings.renderMode!==e)switch(e){case ye.Trail:this.rendererEmitterSettings={startLength:new ts(30),followLocalOrigin:!1};break;case ye.Mesh:this.rendererEmitterSettings={geometry:new Ys(1,1)},this.startRotation=new Kk(new C(0,1,0),new ts(0));break;case ye.BillBoard:case ye.VerticalBillBoard:case ye.HorizontalBillBoard:case ye.StretchedBillBoard:this.rendererEmitterSettings={},this.rendererSettings.renderMode===ye.Mesh&&(this.startRotation=new ts(0));break}this.rendererSettings.renderMode=e,this.neededToUpdateRender=!0}},{key:"renderOrder",get:function(){return this.rendererSettings.renderOrder},set:function(e){this.rendererSettings.renderOrder=e,this.neededToUpdateRender=!0}},{key:"blending",get:function(){return this.rendererSettings.material.blending},set:function(e){this.rendererSettings.material.blending=e,this.neededToUpdateRender=!0}},{key:"pause",value:function(){this.paused=!0}},{key:"play",value:function(){this.paused=!1}},{key:"spawn",value:function(e,i,s){a_.setFromRotationMatrix(s);var r=G9,o=a_,a=H9;s.decompose(r,o,a);for(var l=0;l<e;l++){for(this.particleNum++;this.particles.length<this.particleNum;)this.rendererSettings.renderMode===ye.Trail?this.particles.push(new xg):this.particles.push(new wg);var h=this.particles[this.particleNum-1];if(this.startColor.genColor(h.startColor,this.emissionState.time,{}),h.color.copy(h.startColor),h.startSpeed=this.startSpeed.genValue(i.time/this.duration),h.life=this.startLife.genValue(i.time/this.duration),h.age=0,h.startSize=this.startSize.genValue(i.time/this.duration),h.uvTile=Math.floor(this.startTileIndex.genValue()),h.size=h.startSize,this.rendererSettings.renderMode===ye.Mesh||this.rendererSettings.renderMode===ye.BillBoard||this.rendererSettings.renderMode===ye.VerticalBillBoard||this.rendererSettings.renderMode===ye.HorizontalBillBoard||this.rendererSettings.renderMode===ye.StretchedBillBoard){var u=h;this.rendererSettings.renderMode===ye.Mesh?(u.rotation instanceof ne||(u.rotation=new ne),this.startRotation.type==="rotation"?this.startRotation.genValue(u.rotation,i.time/this.duration):u.rotation.setFromAxisAngle(j9,this.startRotation.genValue(i.time/this.duration))):this.startRotation.type==="rotation"?u.rotation=0:u.rotation=this.startRotation.genValue(i.time/this.duration)}else if(this.rendererSettings.renderMode===ye.Trail){var d=h;d.length=this.rendererEmitterSettings.startLength.genValue(i.time/this.duration),d.reset()}if(this.emitterShape.initialize(h),this.rendererSettings.renderMode===ye.Trail&&this.rendererEmitterSettings.followLocalOrigin){var f=h;f.localPosition=new C().copy(f.position)}this.worldSpace?(h.position.applyMatrix4(s),h.startSize=h.startSize*(Math.abs(a.x)+Math.abs(a.y)+Math.abs(a.z))/3,h.size=h.startSize,h.velocity.multiply(a).applyMatrix3(this.normalMatrix),h.rotation&&h.rotation instanceof ne&&h.rotation.multiplyQuaternions(a_,h.rotation)):this.onlyUsedByOther&&(h.parentMatrix=s);for(var p=0;p<this.behaviors.length;p++)this.behaviors[p].initialize(h)}}},{key:"endEmit",value:function(){this.emitEnded=!0,this.autoDestroy&&(this.markForDestroy=!0)}},{key:"dispose",value:function(){this._renderer&&this._renderer.deleteSystem(this),this.emitter.dispose(),this.emitter.parent&&this.emitter.parent.remove(this.emitter)}},{key:"restart",value:function(){this.paused=!1,this.particleNum=0,this.emissionState.burstIndex=0,this.emissionState.burstWaveIndex=0,this.emissionState.time=0,this.emissionState.waitEmiting=0,this.behaviors.forEach(function(e){e.reset()}),this.emitEnded=!1,this.markForDestroy=!1,this.prewarmed=!1}},{key:"update",value:function(e){if(!this.paused){for(var i=this.emitter;i.parent;)i=i.parent;if(i.type!=="Scene"){this.dispose();return}if(this.emitEnded&&this.particleNum===0){this.markForDestroy&&this.emitter.parent&&this.dispose();return}if(this.looping&&this.prewarm&&!this.prewarmed){this.prewarmed=!0;for(var s=0;s<this.duration*YT;s++)this.update(1/YT)}e>.1&&(e=.1),this.neededToUpdateRender&&(this._renderer&&this._renderer.updateSystem(this),this.neededToUpdateRender=!1),this.onlyUsedByOther||this.emit(e,this.emissionState,this.emitter.matrixWorld);for(var r=0;r<this.behaviors.length;r++){for(var o=0;o<this.particleNum;o++)this.particles[o].died||this.behaviors[r].update(this.particles[o],e);this.behaviors[r].frameUpdate(e)}for(var a=0;a<this.particleNum;a++)this.rendererEmitterSettings.followLocalOrigin&&this.particles[a].localPosition?(this.particles[a].position.copy(this.particles[a].localPosition),this.particles[a].parentMatrix?this.particles[a].position.applyMatrix4(this.particles[a].parentMatrix):this.particles[a].position.applyMatrix4(this.emitter.matrixWorld)):this.particles[a].position.addScaledVector(this.particles[a].velocity,e),this.particles[a].age+=e;if(this.rendererSettings.renderMode===ye.Trail)for(var l=0;l<this.particleNum;l++){var h=this.particles[l];h.update()}for(var u=0;u<this.particleNum;u++){var d=this.particles[u];d.died&&(!(d instanceof xg)||d.previous.length===0)&&(this.particles[u]=this.particles[this.particleNum-1],this.particles[this.particleNum-1]=d,this.particleNum--,u--)}}}},{key:"emit",value:function(e,i,s){i.time>this.duration&&(this.looping?(i.time-=this.duration,i.burstIndex=0,this.behaviors.forEach(function(h){h.reset()})):!this.emitEnded&&!this.onlyUsedByOther&&this.endEmit()),this.normalMatrix.getNormalMatrix(s);var r=Math.ceil(i.waitEmiting);for(this.spawn(r,i,s),i.waitEmiting-=r;i.burstIndex<this.emissionBursts.length&&this.emissionBursts[i.burstIndex].time<=i.time;){if(Math.random()<this.emissionBursts[i.burstIndex].probability){var o=this.emissionBursts[i.burstIndex].count;this.spawn(o,i,s)}i.burstIndex++}if(!this.emitEnded&&(i.waitEmiting+=e*this.emissionOverTime.genValue(i.time/this.duration),this.previousWorldPos!=null)){this.emitter.getWorldPosition(this.temp),this.travelDistance+=this.previousWorldPos.distanceTo(this.temp);var a=this.emissionOverDistance.genValue(i.time/this.duration);if(this.travelDistance*a>0){var l=Math.floor(this.travelDistance*a);this.travelDistance-=l/a,i.waitEmiting+=l}}this.previousWorldPos===void 0&&(this.previousWorldPos=new C),this.emitter.getWorldPosition(this.previousWorldPos),i.time+=e}},{key:"toJSON",value:function(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=e===void 0||typeof e=="string";if(s&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}}),e.materials[this.rendererSettings.material.uuid]=this.rendererSettings.material.toJSON(e),i.useUrlForImage&&this.texture.source!==void 0){var r=this.texture.source;e.images[r.uuid]={uuid:r.uuid,url:this.texture.image.url}}var o;this.renderMode===ye.Trail?o={startLength:this.rendererEmitterSettings.startLength.toJSON(),followLocalOrigin:this.rendererEmitterSettings.followLocalOrigin}:this.renderMode===ye.Mesh?o={}:o={};var a=this.rendererSettings.instancingGeometry;return e.geometries&&!e.geometries[a.uuid]&&(e.geometries[a.uuid]=a.toJSON()),{version:"2.0",autoDestroy:this.autoDestroy,looping:this.looping,prewarm:this.prewarm,duration:this.duration,shape:this.emitterShape.toJSON(),startLife:this.startLife.toJSON(),startSpeed:this.startSpeed.toJSON(),startRotation:this.startRotation.toJSON(),startSize:this.startSize.toJSON(),startColor:this.startColor.toJSON(),emissionOverTime:this.emissionOverTime.toJSON(),emissionOverDistance:this.emissionOverDistance.toJSON(),emissionBursts:this.emissionBursts,onlyUsedByOther:this.onlyUsedByOther,instancingGeometry:this.rendererSettings.instancingGeometry.uuid,renderOrder:this.renderOrder,renderMode:this.renderMode,rendererEmitterSettings:o,speedFactor:this.renderMode===ye.StretchedBillBoard?this.speedFactor:0,material:this.rendererSettings.material.uuid,layers:this.layers.mask,startTileIndex:this.startTileIndex.toJSON(),uTileCount:this.uTileCount,vTileCount:this.vTileCount,behaviors:this.behaviors.map(function(l){return l.toJSON()}),worldSpace:this.worldSpace}}},{key:"addBehavior",value:function(e){this.behaviors.push(e)}},{key:"getRendererSettings",value:function(){return this.rendererSettings}},{key:"clone",value:function(){var e=[],i=wT(this.emissionBursts),s;try{for(i.s();!(s=i.n()).done;){var r=s.value,o={};Object.assign(o,r),e.push(o)}}catch(p){i.e(p)}finally{i.f()}var a=[],l=wT(this.behaviors),h;try{for(l.s();!(h=l.n()).done;){var u=h.value;a.push(u.clone())}}catch(p){l.e(p)}finally{l.f()}var d;this.renderMode===ye.Trail?d={startLength:this.rendererEmitterSettings.startLength.clone(),followLocalOrigin:this.rendererEmitterSettings.followLocalOrigin}:d={};var f=new $r;return f.mask=this.layers.mask,new n({autoDestroy:this.autoDestroy,looping:this.looping,duration:this.duration,shape:this.emitterShape.clone(),startLife:this.startLife.clone(),startSpeed:this.startSpeed.clone(),startRotation:this.startRotation.clone(),startSize:this.startSize.clone(),startColor:this.startColor.clone(),emissionOverTime:this.emissionOverTime.clone(),emissionOverDistance:this.emissionOverDistance.clone(),emissionBursts:e,onlyUsedByOther:this.onlyUsedByOther,instancingGeometry:this.rendererSettings.instancingGeometry,renderMode:this.renderMode,renderOrder:this.renderOrder,rendererEmitterSettings:d,speedFactor:this.speedFactor,material:this.rendererSettings.material,startTileIndex:this.startTileIndex,uTileCount:this.uTileCount,vTileCount:this.vTileCount,behaviors:a,worldSpace:this.worldSpace,layers:f})}}],[{key:"fromJSON",value:function(e,i,s){var r,o=z9(e.shape,i),a;e.renderMode===ye.Trail?a={startLength:e.rendererEmitterSettings.startLength!=null?qt(e.rendererEmitterSettings.startLength):new ts(30),followLocalOrigin:e.rendererEmitterSettings.followLocalOrigin}:e.renderMode===ye.Mesh?a={}:a={};var l=new $r;e.layers&&(l.mask=e.layers);var h=new n({autoDestroy:e.autoDestroy,looping:e.looping,prewarm:e.prewarm,duration:e.duration,shape:o,startLife:qt(e.startLife),startSpeed:qt(e.startSpeed),startRotation:B9(e.startRotation),startSize:qt(e.startSize),startColor:aS(e.startColor),emissionOverTime:qt(e.emissionOverTime),emissionOverDistance:qt(e.emissionOverDistance),emissionBursts:e.emissionBursts,onlyUsedByOther:e.onlyUsedByOther,instancingGeometry:i.geometries[e.instancingGeometry],renderMode:e.renderMode,rendererEmitterSettings:a,renderOrder:e.renderOrder,speedFactor:e.speedFactor,layers:l,material:e.material?i.materials[e.material]:e.texture?new St({map:i.textures[e.texture],transparent:(r=e.transparent)!==null&&r!==void 0?r:!0,blending:e.blending,side:pi}):new St({color:16777215,transparent:!0,blending:cy,side:pi}),startTileIndex:typeof e.startTileIndex=="number"?new ts(e.startTileIndex):qt(e.startTileIndex),uTileCount:e.uTileCount,vTileCount:e.vTileCount,behaviors:[],worldSpace:e.worldSpace});return h.behaviors=e.behaviors.map(function(u){var d=N9(u,h);return d.type==="EmitSubParticleSystem"&&(s[u.subParticleSystem]=d),d}),h}}]),n}(),l_=`

#include <common>
#include <uv_pars_fragment>
#include <color_pars_fragment>
#include <map_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
#include <alphatest_pars_fragment>

void main() {

    #include <clipping_planes_fragment>
    
    vec3 outgoingLight = vec3( 0.0 );
    vec4 diffuseColor = vColor;
    
    #include <logdepthbuf_fragment>
    
    #ifdef USE_MAP
    diffuseColor *= texture2D( map, vMapUv);
    #endif
    
    #include <alphatest_fragment>

    outgoingLight = diffuseColor.rgb;
    
    gl_FragColor = vec4( outgoingLight, diffuseColor.a );
    
    #include <tonemapping_fragment>

}
`,q9=`
#define STANDARD
#ifdef PHYSICAL
#define IOR
#define SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
uniform float ior;
#endif
#ifdef SPECULAR
uniform float specularIntensity;
uniform vec3 specularColor;
#ifdef USE_SPECULARINTENSITYMAP
uniform sampler2D specularIntensityMap;
#endif
#ifdef USE_SPECULARCOLORMAP
uniform sampler2D specularColorMap;
#endif
#endif
#ifdef USE_CLEARCOAT
uniform float clearcoat;
uniform float clearcoatRoughness;
#endif
#ifdef USE_IRIDESCENCE
uniform float iridescence;
uniform float iridescenceIOR;
uniform float iridescenceThicknessMinimum;
uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
uniform vec3 sheenColor;
uniform float sheenRoughness;
#ifdef USE_SHEENCOLORMAP
uniform sampler2D sheenColorMap;
#endif
#ifdef USE_SHEENROUGHNESSMAP
uniform sampler2D sheenRoughnessMap;
#endif
#endif

varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <bsdfs>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>

void main() {
    #include <clipping_planes_fragment>
    vec4 diffuseColor = vec4( diffuse, opacity );
    ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
    vec3 totalEmissiveRadiance = emissive;
    #include <logdepthbuf_fragment>
    #include <map_fragment>
    #include <color_fragment>
    #include <alphamap_fragment>
    #include <alphatest_fragment>
    #include <roughnessmap_fragment>
    #include <metalnessmap_fragment>
    #include <normal_fragment_begin>
    #include <normal_fragment_maps>
    #include <clearcoat_normal_fragment_begin>
    #include <clearcoat_normal_fragment_maps>
    #include <emissivemap_fragment>
    // accumulation
    #include <lights_physical_fragment>
    #include <lights_fragment_begin>
    #include <lights_fragment_maps>
    #include <lights_fragment_end>
    // modulation
    #include <aomap_fragment>
    vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
    vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
    #include <transmission_fragment>
    vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
    #ifdef USE_SHEEN
    // Sheen energy compensation approximation calculation can be found at the end of
        // https://drive.google.com/file/d/1T0D1VSyR4AllqIJTQAraEIzjlb5h4FKH/view?usp=sharing
        float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
        outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;
    #endif
    #ifdef USE_CLEARCOAT
        float dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );
        vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
        outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;
    #endif
    #include <output_fragment>
    #include <tonemapping_fragment>
    #include <encodings_fragment>
    #include <fog_fragment>
    #include <premultiplied_alpha_fragment>
    #include <dithering_fragment>
}`,om=`

    #ifdef UV_TILE
        float col = mod(uvTile, tileCount.x);
        float row = (tileCount.y - floor(uvTile / tileCount.x) - 1.0);
        
        mat3 tileTransform = mat3(
          1.0 / tileCount.x, 0.0, 0.0,
          0.0, 1.0 / tileCount.y, 0.0, 
          col / tileCount.x, row / tileCount.y, 1.0);
    #else
        mat3 tileTransform = mat3(1.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 1.0);
    #endif

#if defined( USE_UV ) || defined( USE_ANISOTROPY )

vUv = (tileTransform *vec3( uv, 1 )).xy;

#endif
#ifdef USE_MAP

vMapUv = ( tileTransform * (mapTransform * vec3( MAP_UV, 1 ) )).xy;

#endif
#ifdef USE_ALPHAMAP

vAlphaMapUv = ( tileTransform * (alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_LIGHTMAP

vLightMapUv = ( tileTransform * (lightMapTransform * vec3( LIGHTMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_AOMAP

vAoMapUv = ( tileTransform * (aoMapTransform * vec3( AOMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_BUMPMAP

vBumpMapUv = ( tileTransform * (bumpMapTransform * vec3( BUMPMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_NORMALMAP

vNormalMapUv = ( tileTransform * (normalMapTransform * vec3( NORMALMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_DISPLACEMENTMAP

vDisplacementMapUv = ( tileTransform * (displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_EMISSIVEMAP

vEmissiveMapUv = ( tileTransform * (emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_METALNESSMAP

vMetalnessMapUv = ( tileTransform * (metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_ROUGHNESSMAP

vRoughnessMapUv = ( tileTransform * (roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_ANISOTROPYMAP

vAnisotropyMapUv = ( tileTransform * (anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_CLEARCOATMAP

vClearcoatMapUv = ( tileTransform * (clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_CLEARCOAT_NORMALMAP

vClearcoatNormalMapUv = ( tileTransform * (clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP

vClearcoatRoughnessMapUv = ( tileTransform * (clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_IRIDESCENCEMAP

vIridescenceMapUv = ( tileTransform * (iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP

vIridescenceThicknessMapUv = ( tileTransform * (iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_SHEEN_COLORMAP

vSheenColorMapUv = ( tileTransform * (sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_SHEEN_ROUGHNESSMAP

vSheenRoughnessMapUv = ( tileTransform * (sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_SPECULARMAP

vSpecularMapUv = ( tileTransform * (specularMapTransform * vec3( SPECULARMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_SPECULAR_COLORMAP

vSpecularColorMapUv = ( tileTransform * (specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_SPECULAR_INTENSITYMAP

vSpecularIntensityMapUv = ( tileTransform * (specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_TRANSMISSIONMAP

vTransmissionMapUv = ( tileTransform * transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_THICKNESSMAP

vThicknessMapUv = ( tileTransform * thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) )).xy;

#endif
`,X9=`
#include <common>
#include <color_pars_vertex>
#include <uv_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>

attribute vec3 offset;
attribute float rotation;
attribute float size;
attribute float uvTile;

#ifdef UV_TILE
uniform vec2 tileCount;
#endif

void main() {

    `.concat(om,`
	
    vec2 alignedPosition = ( position.xy ) * size;
    
    vec2 rotatedPosition;
    rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
    rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
#ifdef HORIZONTAL
    vec4 mvPosition = modelMatrix * vec4( offset, 1.0 );
    mvPosition.x += rotatedPosition.x;
    mvPosition.z -= rotatedPosition.y;
    mvPosition = viewMatrix * mvPosition;
#elif defined(VERTICAL)
    vec4 mvPosition = modelMatrix * vec4( offset, 1.0 );
    mvPosition.y += rotatedPosition.y;
    mvPosition = viewMatrix * mvPosition;
    mvPosition.x += rotatedPosition.x;
#else
    vec4 mvPosition = modelViewMatrix * vec4( offset, 1.0 );
    mvPosition.xy += rotatedPosition;
#endif

	vColor = color;

	gl_Position = projectionMatrix * mvPosition;

	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>

}
`),Y9=`
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>

attribute vec3 offset;
attribute vec4 rotation;
attribute float size;
// attribute vec4 color;
attribute float uvTile;

#ifdef UV_TILE
uniform vec2 tileCount;
#endif

void main() {

    `.concat(om,`
    
    float x2 = rotation.x + rotation.x, y2 = rotation.y + rotation.y, z2 = rotation.z + rotation.z;
    float xx = rotation.x * x2, xy = rotation.x * y2, xz = rotation.x * z2;
    float yy = rotation.y * y2, yz = rotation.y * z2, zz = rotation.z * z2;
    float wx = rotation.w * x2, wy = rotation.w * y2, wz = rotation.w * z2;
    float sx = size, sy = size, sz = size;
    
    mat4 matrix = mat4(( 1.0 - ( yy + zz ) ) * sx, ( xy + wz ) * sx, ( xz - wy ) * sx, 0.0,  // 1. column
                      ( xy - wz ) * sy, ( 1.0 - ( xx + zz ) ) * sy, ( yz + wx ) * sy, 0.0,  // 2. column
                      ( xz + wy ) * sz, ( yz - wx ) * sz, ( 1.0 - ( xx + yy ) ) * sz, 0.0,  // 3. column
                      offset.x, offset.y, offset.z, 1.0);
    
    vec4 mvPosition = modelViewMatrix * (matrix * vec4( position, 1.0 ));

	vColor = color;

	gl_Position = projectionMatrix * mvPosition;

	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>

}
`),K9=`
#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <uv_pars_vertex>

attribute vec3 offset;
attribute vec4 rotation;
attribute float size;
attribute float uvTile;

#ifdef UV_TILE
uniform vec2 tileCount;
#endif

#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>

void main() {
    `.concat(om,`

    float x2 = rotation.x + rotation.x, y2 = rotation.y + rotation.y, z2 = rotation.z + rotation.z;
    float xx = rotation.x * x2, xy = rotation.x * y2, xz = rotation.x * z2;
    float yy = rotation.y * y2, yz = rotation.y * z2, zz = rotation.z * z2;
    float wx = rotation.w * x2, wy = rotation.w * y2, wz = rotation.w * z2;
    float sx = size, sy = size, sz = size;

    mat4 particleMatrix = mat4(( 1.0 - ( yy + zz ) ) * sx, ( xy + wz ) * sx, ( xz - wy ) * sx, 0.0,  // 1. column
                      ( xy - wz ) * sy, ( 1.0 - ( xx + zz ) ) * sy, ( yz + wx ) * sy, 0.0,  // 2. column
                      ( xz + wy ) * sz, ( yz - wx ) * sz, ( 1.0 - ( xx + yy ) ) * sz, 0.0,  // 3. column
                      offset.x, offset.y, offset.z, 1.0);

	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>

	// replace defaultnormal_vertex
	vec3 transformedNormal = objectNormal;
    mat3 m = mat3( particleMatrix );
    transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );
    transformedNormal = m * transformedNormal;
    transformedNormal = normalMatrix * transformedNormal;
    #ifdef FLIP_SIDED
        transformedNormal = - transformedNormal;
    #endif
    #ifdef USE_TANGENT
        vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;
        #ifdef FLIP_SIDED
        transformedTangent = - transformedTangent;
        #endif
    #endif

	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>

	// replace include <project_vertex>
  vec4 mvPosition = vec4( transformed, 1.0 );
  mvPosition = modelViewMatrix * (particleMatrix * mvPosition);
	gl_Position = projectionMatrix * mvPosition;

	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	
	vViewPosition = - mvPosition.xyz;
	
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}
`),J9=`
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>

attribute vec3 offset;
attribute float rotation;
attribute float size;
attribute vec3 velocity;
attribute float uvTile;

#ifdef UV_TILE
uniform vec2 tileCount;
#endif

uniform float speedFactor;

void main() {

    `.concat(om,`
	
    vec4 mvPosition = modelViewMatrix * vec4( offset, 1.0 );
    vec3 viewVelocity = normalMatrix * velocity;

    vec3 scaledPos = vec3(position.xy * size, position.z);
    mvPosition.xyz += scaledPos + dot(scaledPos, viewVelocity) * viewVelocity / length(viewVelocity) * speedFactor;

	vColor = color;

	gl_Position = projectionMatrix * mvPosition;

	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>

}
`);function Zw(n){return n===0?"uv":"uv".concat(n)}new C(0,0,1);var Z9=function(n){uf(e,n);var t=df(e);function e(i){var s;return Oe(this,e),s=t.call(this,i),F(rt(s),"offsetBuffer",void 0),F(rt(s),"rotationBuffer",void 0),F(rt(s),"sizeBuffer",void 0),F(rt(s),"colorBuffer",void 0),F(rt(s),"uvTileBuffer",void 0),F(rt(s),"velocityBuffer",void 0),F(rt(s),"vector_",new C),F(rt(s),"vector2_",new C),F(rt(s),"vector3_",new C),F(rt(s),"quaternion_",new ne),F(rt(s),"quaternion2_",new ne),F(rt(s),"quaternion3_",new ne),F(rt(s),"rotationMat_",new gc),F(rt(s),"rotationMat2_",new gc),s.maxParticles=1e3,s.setupBuffers(),s.rebuildMaterial(),s}return Le(e,[{key:"buildExpandableBuffers",value:function(){this.offsetBuffer=new ec(new Float32Array(this.maxParticles*3),3),this.offsetBuffer.setUsage(Ss),this.geometry.setAttribute("offset",this.offsetBuffer),this.colorBuffer=new ec(new Float32Array(this.maxParticles*4),4),this.colorBuffer.setUsage(Ss),this.geometry.setAttribute("color",this.colorBuffer),this.settings.renderMode===ye.Mesh?(this.rotationBuffer=new ec(new Float32Array(this.maxParticles*4),4),this.rotationBuffer.setUsage(Ss),this.geometry.setAttribute("rotation",this.rotationBuffer)):(this.settings.renderMode===ye.BillBoard||this.settings.renderMode===ye.HorizontalBillBoard||this.settings.renderMode===ye.VerticalBillBoard||this.settings.renderMode===ye.StretchedBillBoard)&&(this.rotationBuffer=new ec(new Float32Array(this.maxParticles),1),this.rotationBuffer.setUsage(Ss),this.geometry.setAttribute("rotation",this.rotationBuffer)),this.sizeBuffer=new ec(new Float32Array(this.maxParticles),1),this.sizeBuffer.setUsage(Ss),this.geometry.setAttribute("size",this.sizeBuffer),this.uvTileBuffer=new ec(new Float32Array(this.maxParticles),1),this.uvTileBuffer.setUsage(Ss),this.geometry.setAttribute("uvTile",this.uvTileBuffer),this.settings.renderMode===ye.StretchedBillBoard&&(this.velocityBuffer=new ec(new Float32Array(this.maxParticles*3),3),this.velocityBuffer.setUsage(Ss),this.geometry.setAttribute("velocity",this.velocityBuffer))}},{key:"setupBuffers",value:function(){this.geometry&&this.geometry.dispose(),this.geometry=new $R,this.geometry.setIndex(this.settings.instancingGeometry.getIndex()),this.settings.instancingGeometry.hasAttribute("normal")&&this.geometry.setAttribute("normal",this.settings.instancingGeometry.getAttribute("normal")),this.geometry.setAttribute("position",this.settings.instancingGeometry.getAttribute("position")),this.geometry.setAttribute("uv",this.settings.instancingGeometry.getAttribute("uv")),this.buildExpandableBuffers()}},{key:"expandBuffers",value:function(s){for(;s>=this.maxParticles;)this.maxParticles*=2;this.setupBuffers()}},{key:"rebuildMaterial",value:function(){this.layers.mask=this.settings.layers.mask;var s,r={};if(this.settings.material.type==="MeshStandardMaterial"||this.settings.material.type==="MeshPhysicalMaterial"){var o=this.settings.material;s=ly.merge([In.common,In.envmap,In.aomap,In.lightmap,In.emissivemap,In.bumpmap,In.normalmap,In.displacementmap,In.roughnessmap,In.metalnessmap,In.fog,In.lights,{emissive:{value:new we(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),s.diffuse.value=o.color,s.opacity.value=o.opacity,s.emissive.value=o.emissive,s.roughness.value=o.roughness,s.metalness.value=o.metalness,o.envMap&&(s.envMap.value=o.envMap,s.envMapIntensity.value=o.envMapIntensity),o.normalMap&&(s.normalMap.value=o.normalMap,s.normalScale.value=o.normalScale),o.roughnessMap&&(s.roughnessMap.value=o.roughnessMap),o.metalnessMap&&(s.metalnessMap.value=o.metalnessMap),o.map&&(s.map=new $(o.map))}else s={},s.map=new $(this.settings.material.map);this.settings.material.alphaTest&&(r.USE_ALPHATEST="",s.alphaTest=new $(this.settings.material.alphaTest)),r.USE_UV="";var a=this.settings.uTileCount,l=this.settings.vTileCount;(a>1||l>1)&&(r.UV_TILE="",s.tileCount=new $(new ae(a,l))),this.settings.material.normalMap&&(r.USE_NORMALMAP="",r.NORMALMAP_UV=Zw(this.settings.material.normalMap.channel),s.normalMapTransform=new $(new gc().copy(this.settings.material.normalMap.matrix))),this.settings.material.map&&(r.USE_MAP="",r.MAP_UV=Zw(this.settings.material.map.channel),s.mapTransform=new $(new gc().copy(this.settings.material.map.matrix))),r.USE_COLOR_ALPHA="";var h=!1;if(this.settings.renderMode===ye.BillBoard||this.settings.renderMode===ye.VerticalBillBoard||this.settings.renderMode===ye.HorizontalBillBoard||this.settings.renderMode===ye.Mesh){var u,d;this.settings.renderMode===ye.Mesh?this.settings.material.type==="MeshStandardMaterial"||this.settings.material.type==="MeshPhysicalMaterial"?(r.USE_COLOR="",u=K9,d=q9,h=!0):(u=Y9,d=l_):(u=X9,d=l_),this.settings.renderMode===ye.VerticalBillBoard?r.VERTICAL="":this.settings.renderMode===ye.HorizontalBillBoard&&(r.HORIZONTAL=""),this.material=new $e({uniforms:s,defines:r,vertexShader:u,fragmentShader:d,transparent:this.settings.material.transparent,depthWrite:!this.settings.material.transparent,blending:this.settings.material.blending,side:this.settings.material.side,alphaTest:this.settings.material.alphaTest,lights:h})}else if(this.settings.renderMode===ye.StretchedBillBoard)s.speedFactor=new $(1),this.material=new $e({uniforms:s,defines:r,vertexShader:J9,fragmentShader:l_,transparent:this.settings.material.transparent,depthWrite:!this.settings.material.transparent,blending:this.settings.material.blending,side:this.settings.material.side,alphaTest:this.settings.material.alphaTest});else throw new Error("render mode unavailable")}},{key:"update",value:function(){var s=this,r=0,o=0;this.systems.forEach(function(a){o+=a.particleNum}),o>this.maxParticles&&this.expandBuffers(o),this.systems.forEach(function(a){var l=a.particles,h=a.particleNum,u=s.quaternion2_,d=s.vector2_,f=s.vector3_;a.emitter.matrixWorld.decompose(d,u,f),s.rotationMat_.setFromMatrix4(a.emitter.matrixWorld);for(var p=0;p<h;p++,r++){var g=l[p];if(s.settings.renderMode===ye.Mesh){var m=void 0;if(a.worldSpace)m=g.rotation;else{var v=void 0;g.parentMatrix?v=s.quaternion3_.setFromRotationMatrix(g.parentMatrix):v=u,m=s.quaternion_,m.copy(g.rotation).multiply(v)}s.rotationBuffer.setXYZW(r,m.x,m.y,m.z,m.w)}else(s.settings.renderMode===ye.StretchedBillBoard||s.settings.renderMode===ye.VerticalBillBoard||s.settings.renderMode===ye.HorizontalBillBoard||s.settings.renderMode===ye.BillBoard)&&s.rotationBuffer.setX(r,g.rotation);var y=void 0;if(a.worldSpace?y=g.position:(y=s.vector_,g.parentMatrix?y.copy(g.position).applyMatrix4(g.parentMatrix):y.copy(g.position).applyMatrix4(a.emitter.matrixWorld)),s.offsetBuffer.setXYZ(r,y.x,y.y,y.z),s.colorBuffer.setXYZW(r,g.color.x,g.color.y,g.color.z,g.color.w),a.worldSpace||g.parentMatrix?s.sizeBuffer.setX(r,g.size):s.sizeBuffer.setX(r,g.size*(Math.abs(f.x)+Math.abs(f.y)+Math.abs(f.z))/3),s.uvTileBuffer.setX(r,g.uvTile),s.settings.renderMode===ye.StretchedBillBoard&&s.velocityBuffer){var b=a.speedFactor,_=void 0;a.worldSpace?_=g.velocity:(_=s.vector_,g.parentMatrix?(s.rotationMat2_.setFromMatrix4(g.parentMatrix),_.copy(g.velocity).applyMatrix3(s.rotationMat2_)):_.copy(g.velocity).applyMatrix3(s.rotationMat_)),s.velocityBuffer.setXYZ(r,_.x*b,_.y*b,_.z*b)}}}),this.geometry.instanceCount=r,r>0&&(this.offsetBuffer.updateRange.count=r*3,this.offsetBuffer.needsUpdate=!0,this.sizeBuffer.updateRange.count=r,this.sizeBuffer.needsUpdate=!0,this.colorBuffer.updateRange.count=r*4,this.colorBuffer.needsUpdate=!0,this.uvTileBuffer.updateRange.count=r,this.uvTileBuffer.needsUpdate=!0,this.settings.renderMode===ye.StretchedBillBoard&&this.velocityBuffer&&(this.velocityBuffer.updateRange.count=r*3,this.velocityBuffer.needsUpdate=!0),this.settings.renderMode===ye.Mesh?(this.rotationBuffer.updateRange.count=r*4,this.rotationBuffer.needsUpdate=!0):(this.settings.renderMode===ye.StretchedBillBoard||this.settings.renderMode===ye.HorizontalBillBoard||this.settings.renderMode===ye.VerticalBillBoard||this.settings.renderMode===ye.BillBoard)&&(this.rotationBuffer.updateRange.count=r,this.rotationBuffer.needsUpdate=!0))}},{key:"dispose",value:function(){this.geometry.dispose()}}]),e}($k),$9=`

#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>

uniform sampler2D alphaMap;
uniform float useAlphaMap;
uniform float visibility;
uniform float alphaTest;
uniform vec2 repeat;

varying vec4 vColor;
    
void main() {
    #include <clipping_planes_fragment>
    #include <logdepthbuf_fragment>

    vec4 c = vColor;
    
    #ifdef USE_MAP
    c *= texture2D( map, vUv * repeat );
    #endif
    if( useAlphaMap == 1. ) c.a *= texture2D( alphaMap, vUv * repeat ).a;
    if( c.a < alphaTest ) discard;
    gl_FragColor = c;

    #include <fog_fragment>
    #include <tonemapping_fragment>
}`,eW=`
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <clipping_planes_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <fog_pars_vertex>

attribute vec3 previous;
attribute vec3 next;
attribute float side;
attribute float width;

uniform vec2 resolution;
uniform float lineWidth;
uniform float sizeAttenuation;
    
vec2 fix(vec4 i, float aspect) {
    vec2 res = i.xy / i.w;
    res.x *= aspect;
    return res;
}
    
void main() {

    `.concat(om,`
    
    float aspect = resolution.x / resolution.y;

    vColor = color;

    mat4 m = projectionMatrix * modelViewMatrix;
    vec4 finalPosition = m * vec4( position, 1.0 );
    vec4 prevPos = m * vec4( previous, 1.0 );
    vec4 nextPos = m * vec4( next, 1.0 );

    vec2 currentP = fix( finalPosition, aspect );
    vec2 prevP = fix( prevPos, aspect );
    vec2 nextP = fix( nextPos, aspect );

    float w = lineWidth * width;

    vec2 dir;
    if( nextP == currentP ) dir = normalize( currentP - prevP );
    else if( prevP == currentP ) dir = normalize( nextP - currentP );
    else {
        vec2 dir1 = normalize( currentP - prevP );
        vec2 dir2 = normalize( nextP - currentP );
        dir = normalize( dir1 + dir2 );

        vec2 perp = vec2( -dir1.y, dir1.x );
        vec2 miter = vec2( -dir.y, dir.x );
        //w = clamp( w / dot( miter, perp ), 0., 4., * lineWidth * width );

    }

    //vec2 normal = ( cross( vec3( dir, 0. ) vec3( 0., 0., 1. ) ) ).xy;
    vec4 normal = vec4( -dir.y, dir.x, 0., 1. );
    normal.xy *= .5 * w;
    normal *= projectionMatrix;
    if( sizeAttenuation == 0. ) {
        normal.xy *= finalPosition.w;
        normal.xy /= ( vec4( resolution, 0., 1. ) * projectionMatrix ).xy;
    }

    finalPosition.xy += normal.xy * side;

    gl_Position = finalPosition;

	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	
    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );
    
	#include <fog_vertex>
}`);new C(0,0,1);var tW=function(n){uf(e,n);var t=df(e);function e(i){var s;return Oe(this,e),s=t.call(this,i),F(rt(s),"positionBuffer",void 0),F(rt(s),"previousBuffer",void 0),F(rt(s),"nextBuffer",void 0),F(rt(s),"uvBuffer",void 0),F(rt(s),"sideBuffer",void 0),F(rt(s),"widthBuffer",void 0),F(rt(s),"colorBuffer",void 0),F(rt(s),"indexBuffer",void 0),F(rt(s),"vector_",new C),F(rt(s),"vector2_",new C),F(rt(s),"vector3_",new C),F(rt(s),"quaternion_",new ne),s.maxParticles=1e4,s.setupBuffers(),s.rebuildMaterial(),s}return Le(e,[{key:"setupBuffers",value:function(){this.geometry&&this.geometry.dispose(),this.geometry=new jt,this.indexBuffer=new Ve(new Uint32Array(this.maxParticles*6),1),this.indexBuffer.setUsage(Ss),this.geometry.setIndex(this.indexBuffer),this.positionBuffer=new Ve(new Float32Array(this.maxParticles*6),3),this.positionBuffer.setUsage(Ss),this.geometry.setAttribute("position",this.positionBuffer),this.previousBuffer=new Ve(new Float32Array(this.maxParticles*6),3),this.previousBuffer.setUsage(Ss),this.geometry.setAttribute("previous",this.previousBuffer),this.nextBuffer=new Ve(new Float32Array(this.maxParticles*6),3),this.nextBuffer.setUsage(Ss),this.geometry.setAttribute("next",this.nextBuffer),this.widthBuffer=new Ve(new Float32Array(this.maxParticles*2),1),this.widthBuffer.setUsage(Ss),this.geometry.setAttribute("width",this.widthBuffer),this.sideBuffer=new Ve(new Float32Array(this.maxParticles*2),1),this.sideBuffer.setUsage(Ss),this.geometry.setAttribute("side",this.sideBuffer),this.uvBuffer=new Ve(new Float32Array(this.maxParticles*4),2),this.uvBuffer.setUsage(Ss),this.geometry.setAttribute("uv",this.uvBuffer),this.colorBuffer=new Ve(new Float32Array(this.maxParticles*8),4),this.colorBuffer.setUsage(Ss),this.geometry.setAttribute("color",this.colorBuffer)}},{key:"expandBuffers",value:function(s){for(;s>=this.maxParticles;)this.maxParticles*=2;this.setupBuffers()}},{key:"rebuildMaterial",value:function(){this.layers.mask=this.settings.layers.mask;var s={lineWidth:{value:1},map:{value:null},useMap:{value:0},alphaMap:{value:null},useAlphaMap:{value:0},resolution:{value:new ae(1,1)},sizeAttenuation:{value:1},visibility:{value:1},alphaTest:{value:0},repeat:{value:new ae(1,1)}},r={};if(r.USE_UV="",r.USE_COLOR_ALPHA="",this.settings.material.map&&(r.USE_MAP="",r.MAP_UV=Zw(this.settings.material.map.channel),s.map=new $(this.settings.material.map),s.mapTransform=new $(new gc().copy(this.settings.material.map.matrix))),this.settings.renderMode===ye.Trail)this.material=new $e({uniforms:s,defines:r,vertexShader:eW,fragmentShader:$9,transparent:this.settings.material.transparent,depthWrite:!this.settings.material.transparent,side:this.settings.material.side,blending:this.settings.material.blending||cy});else throw new Error("render mode unavailable")}},{key:"update",value:function(){var s=this,r=0,o=0,a=0;this.systems.forEach(function(l){for(var h=0;h<l.particleNum;h++)a+=l.particles[h].previous.length*2}),a>this.maxParticles&&this.expandBuffers(a),this.systems.forEach(function(l){var h=s.quaternion_,u=s.vector2_,d=s.vector3_;l.emitter.matrixWorld.decompose(u,h,d);for(var f=l.particles,p=l.particleNum,g=s.settings.uTileCount,m=s.settings.vTileCount,v=1/g,y=1/m,b=0;b<p;b++){var _=f[b],x=_.uvTile%m,S=Math.floor(_.uvTile/m),T=_.previous.values(),L=T.next(),I=L.value,P=I;L.done||(L=T.next());var R=void 0;L.value!==void 0?R=L.value:R=P;for(var B=0;B<_.previous.length;B++,r+=2){if(s.positionBuffer.setXYZ(r,P.position.x,P.position.y,P.position.z),s.positionBuffer.setXYZ(r+1,P.position.x,P.position.y,P.position.z),l.worldSpace?(s.positionBuffer.setXYZ(r,P.position.x,P.position.y,P.position.z),s.positionBuffer.setXYZ(r+1,P.position.x,P.position.y,P.position.z)):(_.parentMatrix?s.vector_.copy(P.position).applyMatrix4(_.parentMatrix):s.vector_.copy(P.position).applyMatrix4(l.emitter.matrixWorld),s.positionBuffer.setXYZ(r,s.vector_.x,s.vector_.y,s.vector_.z),s.positionBuffer.setXYZ(r+1,s.vector_.x,s.vector_.y,s.vector_.z)),l.worldSpace?(s.previousBuffer.setXYZ(r,I.position.x,I.position.y,I.position.z),s.previousBuffer.setXYZ(r+1,I.position.x,I.position.y,I.position.z)):(_.parentMatrix?s.vector_.copy(I.position).applyMatrix4(_.parentMatrix):s.vector_.copy(I.position).applyMatrix4(l.emitter.matrixWorld),s.previousBuffer.setXYZ(r,s.vector_.x,s.vector_.y,s.vector_.z),s.previousBuffer.setXYZ(r+1,s.vector_.x,s.vector_.y,s.vector_.z)),l.worldSpace?(s.nextBuffer.setXYZ(r,R.position.x,R.position.y,R.position.z),s.nextBuffer.setXYZ(r+1,R.position.x,R.position.y,R.position.z)):(_.parentMatrix?s.vector_.copy(R.position).applyMatrix4(_.parentMatrix):s.vector_.copy(R.position).applyMatrix4(l.emitter.matrixWorld),s.nextBuffer.setXYZ(r,s.vector_.x,s.vector_.y,s.vector_.z),s.nextBuffer.setXYZ(r+1,s.vector_.x,s.vector_.y,s.vector_.z)),s.sideBuffer.setX(r,-1),s.sideBuffer.setX(r+1,1),l.worldSpace)s.widthBuffer.setX(r,P.size),s.widthBuffer.setX(r+1,P.size);else if(_.parentMatrix)s.widthBuffer.setX(r,P.size),s.widthBuffer.setX(r+1,P.size);else{var Q=(Math.abs(d.x)+Math.abs(d.y)+Math.abs(d.z))/3;s.widthBuffer.setX(r,P.size*Q),s.widthBuffer.setX(r+1,P.size*Q)}s.uvBuffer.setXY(r,(B/_.previous.length+x)*v,(m-S-1)*y),s.uvBuffer.setXY(r+1,(B/_.previous.length+x)*v,(m-S)*y),s.colorBuffer.setXYZW(r,P.color.x,P.color.y,P.color.z,P.color.w),s.colorBuffer.setXYZW(r+1,P.color.x,P.color.y,P.color.z,P.color.w),B+1<_.previous.length&&(s.indexBuffer.setX(o*3,r),s.indexBuffer.setX(o*3+1,r+1),s.indexBuffer.setX(o*3+2,r+2),o++,s.indexBuffer.setX(o*3,r+2),s.indexBuffer.setX(o*3+1,r+1),s.indexBuffer.setX(o*3+2,r+3),o++),I=P,P=R,L.done||(L=T.next(),L.value!==void 0&&(R=L.value))}}}),this.positionBuffer.updateRange.count=r*3,this.positionBuffer.needsUpdate=!0,this.previousBuffer.updateRange.count=r*3,this.previousBuffer.needsUpdate=!0,this.nextBuffer.updateRange.count=r*3,this.nextBuffer.needsUpdate=!0,this.sideBuffer.updateRange.count=r,this.sideBuffer.needsUpdate=!0,this.widthBuffer.updateRange.count=r,this.widthBuffer.needsUpdate=!0,this.uvBuffer.updateRange.count=r*2,this.uvBuffer.needsUpdate=!0,this.colorBuffer.updateRange.count=r*4,this.colorBuffer.needsUpdate=!0,this.indexBuffer.updateRange.count=o*3,this.indexBuffer.needsUpdate=!0,this.geometry.setDrawRange(0,o*3)}},{key:"dispose",value:function(){this.geometry.dispose()}}]),e}($k),iW=function(n){uf(e,n);var t=df(e);function e(){var i;return Oe(this,e),i=t.call(this),F(rt(i),"batches",[]),F(rt(i),"systemToBatchIndex",new Map),F(rt(i),"type","BatchedRenderer"),i}return Le(e,[{key:"addSystem",value:function(s){s._renderer=this;for(var r=s.getRendererSettings(),o=0;o<this.batches.length;o++)if(e.equals(this.batches[o].settings,r)){this.batches[o].addSystem(s),this.systemToBatchIndex.set(s,o);return}var a;switch(r.renderMode){case ye.Trail:a=new tW(r);break;case ye.Mesh:case ye.BillBoard:case ye.VerticalBillBoard:case ye.HorizontalBillBoard:case ye.StretchedBillBoard:a=new Z9(r);break}a.addSystem(s),this.batches.push(a),this.systemToBatchIndex.set(s,this.batches.length-1),this.add(a)}},{key:"deleteSystem",value:function(s){var r=this.systemToBatchIndex.get(s);r!=null&&(this.batches[r].removeSystem(s),this.systemToBatchIndex.delete(s))}},{key:"updateSystem",value:function(s){this.deleteSystem(s),this.addSystem(s)}},{key:"update",value:function(s){this.systemToBatchIndex.forEach(function(o,a){a.update(s)});for(var r=0;r<this.batches.length;r++)this.batches[r].update()}}],[{key:"equals",value:function(s,r){return s.material.side===r.material.side&&s.material.blending===r.material.blending&&s.material.transparent===r.material.transparent&&s.material.type===r.material.type&&s.material.alphaTest===r.material.alphaTest&&s.material.map===r.material.map&&s.renderMode===r.renderMode&&s.uTileCount===r.uTileCount&&s.vTileCount===r.vTileCount&&s.instancingGeometry===r.instancingGeometry&&s.renderOrder===r.renderOrder&&s.layers.mask===r.layers.mask}}]),e}(re),nW=iW,KT=function(){function n(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:new C;Oe(this,n),F(this,"locations",[]),this.scaleX=t,this.scaleY=e,this.position=i}return Le(n,[{key:"transform",value:function(e,i){e.x=this.locations[i%this.locations.length].x*this.scaleX+this.position.x,e.y=this.locations[i%this.locations.length].y*this.scaleY+this.position.y,e.z=this.position.z}},{key:"clone",value:function(){var e=new n(this.scaleX,this.scaleY,this.position.clone());return e.locations=this.locations.map(function(i){return i.clone()}),e}},{key:"toJSON",value:function(){return{scaleX:this.scaleX,scaleY:this.scaleY,position:this.position,locations:this.locations.map(function(e){return{x:e.x,y:e.y}})}}},{key:"fromImage",value:function(e,i){var s=document.createElement("canvas");s.width=e.width,s.height=e.height;var r=s.getContext("2d");if(r){r.drawImage(e,0,0);var o=r.getImageData(0,0,s.width,s.height,{colorSpace:"srgb"});s.remove(),this.locations.length=0;for(var a=0;a<o.height;a++)for(var l=0;l<o.width;l++)o.data[(a*o.width+l)*4+3]>i&&this.locations.push(new ae(l,o.height-a))}}}],[{key:"fromJSON",value:function(e){var i=new n(e.scaleX,e.scaleY,new C(e.position[0],e.position[1],e.position[2]));return i.locations=e.locations.map(function(s){return new ae(s.x,s.y)}),i}}]),n}();function sW(n){switch(n.type){case"TextureSequencer":return KT.fromJSON(n);default:return new KT}}var rW=function(){function n(t){Oe(this,n),F(this,"type","ApplySequences"),F(this,"sequencers",[]),F(this,"time",0),F(this,"index",0),F(this,"pCount",0),F(this,"delay",void 0),F(this,"tempV",new C),this.delay=t}return Le(n,[{key:"initialize",value:function(e){e.id=this.pCount,e.dst=new C,e.begin=new C,e.inMotion=!1,this.pCount++}},{key:"reset",value:function(){this.time=0,this.index=0,this.pCount=0}},{key:"update",value:function(e,i){var s=this.sequencers[this.index],r=e.id*this.delay;this.time>=s[0].a+r&&this.time<=s[0].b+r?(e.inMotion||(e.inMotion=!0,e.begin.copy(e.position),s[1].transform(e.dst,e.id)),e.position.lerpVectors(e.begin,e.dst,n.BEZIER.genValue((this.time-s[0].a-r)/(s[0].b-s[0].a)))):this.time>s[0].b+r&&(e.inMotion=!1)}},{key:"frameUpdate",value:function(e){for(;this.index+1<this.sequencers.length&&this.time>=this.sequencers[this.index+1][0].a;)this.index++;this.time+=e}},{key:"appendSequencer",value:function(e,i){this.sequencers.push([e,i])}},{key:"toJSON",value:function(){return{type:this.type,delay:this.delay,sequencers:this.sequencers.map(function(e){var i=xd(e,2),s=i[0],r=i[1];return{range:s.toJSON(),sequencer:r.toJSON()}})}}},{key:"clone",value:function(){var e=new n(this.delay);return e.sequencers=this.sequencers.map(function(i){return[i[0].clone(),i[1].clone()]}),e}}],[{key:"fromJSON",value:function(e){var i=new n(e.delay);return e.sequencers.forEach(function(s){i.sequencers.push([qt(s.range),sW(s.sequencer)])}),i}}]),n}();F(rW,"BEZIER",new Xw(0,0,1,1));var q=function(n){return n[n.Number=0]="Number",n[n.Vec2=1]="Vec2",n[n.Vec3=2]="Vec3",n[n.Vec4=3]="Vec4",n[n.Boolean=4]="Boolean",n[n.AnyType=5]="AnyType",n}({}),JT=Le(function n(t,e,i,s){Oe(this,n),F(this,"input",void 0),F(this,"inputIndex",void 0),F(this,"output",void 0),F(this,"outputIndex",void 0),this.input=t,this.inputIndex=e,this.input.outputs[e].push(this),this.output=i,this.outputIndex=s,this.output.inputs[s]=this}),oW=function(){function n(){Oe(this,n),F(this,"visited",new Set),F(this,"graph_",void 0),F(this,"context_",void 0),n.Instance=this}return Le(n,[{key:"traverse",value:function(e){if(this.context_===void 0)throw new Error("context is undefined");if(this.graph_===void 0)throw new Error("graph is undefined");this.visited.add(e.id);for(var i=[],s=0;s<e.inputs.length;s++)if(e.inputs[s]instanceof JT){var r=e.inputs[s].input;this.visited.has(r.id)||this.traverse(r),i.push(r.outputValues[e.inputs[s].inputIndex])}else i.push(e.inputs[s].getValue(this.context_));e.func(this.context_,i,e.outputValues),this.graph_.nodesInOrder.push(e)}},{key:"executeCompiledGraph",value:function(){if(this.context_===void 0)throw new Error("context is undefined");if(this.graph_===void 0)throw new Error("graph is undefined");for(var e=this.graph_.nodesInOrder,i=0;i<e.length;i++){for(var s=[],r=e[i],o=0;o<r.inputs.length;o++)if(r.inputs[o]instanceof JT)s.push(r.inputs[o].input.outputValues[r.inputs[o].inputIndex]);else if(r.inputs[o]!==void 0)s.push(r.inputs[o].getValue(this.context_));else throw new Error("miss input for node ".concat(r.id));r.func(this.context_,s,r.outputValues)}}},{key:"run",value:function(e,i){if(this.graph_=e,this.context_=i,e.compiled)this.executeCompiledGraph();else{e.nodesInOrder.length=0,this.visited.clear();for(var s=0;s<e.outputNodes.length;s++){var r=e.outputNodes[s];this.traverse(r)}e.compiled=!0}}}]),n}();F(oW,"Instance",void 0);var ut=function(){function n(t){Oe(this,n),F(this,"name",void 0),F(this,"nodeTypeSignatures",[]),this.name=t}return Le(n,[{key:"addSignature",value:function(e,i,s){this.nodeTypeSignatures.push({inputTypes:e,outputTypes:i,func:s})}}]),n}(),b0=new ut("add");b0.addSignature([q.Number,q.Number],[q.Number],function(n,t,e,i){i[0]=e[0]+e[1]});b0.addSignature([q.Vec2,q.Vec2],[q.Vec2],function(n,t,e,i){i[0].addVectors(e[0],e[1])});b0.addSignature([q.Vec3,q.Vec3],[q.Vec3],function(n,t,e,i){i[0].addVectors(e[0],e[1])});b0.addSignature([q.Vec4,q.Vec4],[q.Vec4],function(n,t,e,i){i[0].addVectors(e[0],e[1])});var _0=new ut("sub");_0.addSignature([q.Number,q.Number],[q.Number],function(n,t,e,i){i[0]=e[0]-e[1]});_0.addSignature([q.Vec2,q.Vec2],[q.Vec2],function(n,t,e,i){i[0].subVectors(e[0],e[1])});_0.addSignature([q.Vec3,q.Vec3],[q.Vec3],function(n,t,e,i){i[0].subVectors(e[0],e[1])});_0.addSignature([q.Vec4,q.Vec4],[q.Vec4],function(n,t,e,i){i[0].subVectors(e[0],e[1])});var w0=new ut("mul");w0.addSignature([q.Number,q.Number],[q.Number],function(n,t,e,i){i[0]=e[0]*e[1]});w0.addSignature([q.Vec2,q.Number],[q.Vec2],function(n,t,e,i){i[0].copy(e[0]).multiplyScalar(e[1])});w0.addSignature([q.Vec3,q.Number],[q.Vec3],function(n,t,e,i){i[0].copy(e[0]).multiplyScalar(e[1])});w0.addSignature([q.Vec4,q.Number],[q.Vec4],function(n,t,e,i){i[0].copy(e[0]).multiplyScalar(e[1])});var x0=new ut("div");x0.addSignature([q.Number,q.Number],[q.Number],function(n,t,e,i){i[0]=e[0]/e[1]});x0.addSignature([q.Vec2,q.Number],[q.Vec2],function(n,t,e,i){i[0].copy(e[0]).divideScalar(e[1])});x0.addSignature([q.Vec3,q.Number],[q.Vec3],function(n,t,e,i){i[0].copy(e[0]).divideScalar(e[1])});x0.addSignature([q.Vec4,q.Number],[q.Vec4],function(n,t,e,i){i[0].copy(e[0]).divideScalar(e[1])});var aW=new ut("sin");aW.addSignature([q.Number],[q.Number],function(n,t,e,i){i[0]=Math.sin(e[0])});var lW=new ut("cos");lW.addSignature([q.Number],[q.Number],function(n,t,e,i){i[0]=Math.cos(e[0])});var cW=new ut("tan");cW.addSignature([q.Number],[q.Number],function(n,t,e,i){i[0]=Math.tan(e[0])});var hW=new ut("abs");hW.addSignature([q.Number],[q.Number],function(n,t,e,i){i[0]=Math.abs(e[0])});var uW=new ut("min");uW.addSignature([q.Number,q.Number],[q.Number],function(n,t,e,i){i[0]=Math.min(e[0],e[1])});var dW=new ut("max");dW.addSignature([q.Number,q.Number],[q.Number],function(n,t,e,i){i[0]=Math.max(e[0],e[1])});var lS=new ut("dot");lS.addSignature([q.Vec2,q.Vec2],[q.Number],function(n,t,e,i){i[0]=e[0].dot(e[1])});lS.addSignature([q.Vec3,q.Vec3],[q.Number],function(n,t,e,i){i[0]=e[0].dot(e[1])});lS.addSignature([q.Vec4,q.Vec4],[q.Number],function(n,t,e,i){i[0]=e[0].dot(e[1])});var fW=new ut("cross");fW.addSignature([q.Vec3,q.Vec3],[q.Vec3],function(n,t,e,i){i[0].crossVectors(e[0],e[1])});var cS=new ut("length");cS.addSignature([q.Vec2],[q.Number],function(n,t,e,i){i[0]=e[0].length()});cS.addSignature([q.Vec3],[q.Number],function(n,t,e,i){i[0]=e[0].length()});cS.addSignature([q.Vec4],[q.Number],function(n,t,e,i){i[0]=e[0].length()});var hS=new ut("lengthSq");hS.addSignature([q.Vec2],[q.Number],function(n,t,e,i){i[0]=e[0].lengthSq()});hS.addSignature([q.Vec3],[q.Number],function(n,t,e,i){i[0]=e[0].lengthSq()});hS.addSignature([q.Vec4],[q.Number],function(n,t,e,i){i[0]=e[0].lengthSq()});var uS=new ut("normalize");uS.addSignature([q.Vec2],[q.Vec2],function(n,t,e,i){i[0].copy(e[0]).normalize()});uS.addSignature([q.Vec3],[q.Vec3],function(n,t,e,i){i[0].copy(e[0]).normalize()});uS.addSignature([q.Vec4],[q.Vec4],function(n,t,e,i){i[0].copy(e[0]).normalize()});var eO=new ut("distance");eO.addSignature([q.Vec2,q.Vec2],[q.Number],function(n,t,e,i){i[0]=e[0].distanceTo(e[1])});eO.addSignature([q.Vec3,q.Vec3],[q.Number],function(n,t,e,i){i[0]=e[0].distanceTo(e[1])});var pW=new ut("and");pW.addSignature([q.Boolean,q.Boolean],[q.Boolean],function(n,t,e,i){i[0]=e[0]&&e[1]});var gW=new ut("or");gW.addSignature([q.Boolean,q.Boolean],[q.Boolean],function(n,t,e,i){i[0]=e[0]||e[1]});var mW=new ut("not");mW.addSignature([q.Boolean],[q.Boolean],function(n,t,e,i){i[0]=!e[0]});var C0=new ut("equal");C0.addSignature([q.Number,q.Number],[q.Boolean],function(n,t,e,i){i[0]=e[0]===e[1]});C0.addSignature([q.Vec2,q.Vec2],[q.Boolean],function(n,t,e,i){i[0]=e[0].equals(e[1])});C0.addSignature([q.Vec3,q.Vec3],[q.Boolean],function(n,t,e,i){i[0]=e[0].equals(e[1])});C0.addSignature([q.Vec4,q.Vec4],[q.Boolean],function(n,t,e,i){i[0]=e[0].equals(e[1])});var AW=new ut("lessThan");AW.addSignature([q.Number,q.Number],[q.Boolean],function(n,t,e,i){i[0]=e[0]<e[1]});var vW=new ut("greaterThan");vW.addSignature([q.Number,q.Number],[q.Boolean],function(n,t,e,i){i[0]=e[0]>e[1]});var yW=new ut("lessThanOrEqual");yW.addSignature([q.Number,q.Number],[q.Boolean],function(n,t,e,i){i[0]=e[0]<=e[1]});var bW=new ut("greaterThanOrEqual");bW.addSignature([q.Number,q.Number],[q.Boolean],function(n,t,e,i){i[0]=e[0]>=e[1]});var _W=new ut("if");_W.addSignature([q.Boolean,q.AnyType,q.AnyType],[q.AnyType],function(n,t,e,i){i[0]=e[0]?e[1]:e[2]});var wW=new ut("number");wW.addSignature([],[q.Number],function(n,t,e,i){i[0]=t.value});var xW=new ut("vec2");xW.addSignature([],[q.Vec2],function(n,t,e,i){i[0]=t.value});var CW=new ut("vec3");CW.addSignature([],[q.Vec3],function(n,t,e,i){i[0]=t.value});var SW=new ut("vec4");SW.addSignature([],[q.Vec4],function(n,t,e,i){i[0]=t.value});var EW=new ut("bool");EW.addSignature([],[q.Boolean],function(n,t,e,i){i[0]=t.value});var IW=new ut("particlePosition");IW.addSignature([],[q.Vec3],function(n,t,e,i){i[0]=n.particle[t.property]});var TW=new ut("particleVelocity");TW.addSignature([],[q.Vec3],function(n,t,e,i){i[0]=n.particle[t.property]});var RW=new ut("particleRotation");RW.addSignature([],[q.Number],function(n,t,e,i){i[0]=n.particle[t.property]});var BW=new ut("particleAge");BW.addSignature([],[q.Number],function(n,t,e,i){i[0]=n.particle[t.property]});var am=new ut("output");am.addSignature([q.Number],[q.Number],function(n,t,e,i){i[0]=e[0]});am.addSignature([q.Vec2],[q.Vec2],function(n,t,e,i){i[0]=e[0]});am.addSignature([q.Vec3],[q.Vec3],function(n,t,e,i){i[0]=e[0]});am.addSignature([q.Vec4],[q.Vec4],function(n,t,e,i){i[0]=e[0]});am.addSignature([q.Boolean],[q.Boolean],function(n,t,e,i){i[0]=e[0]});console.log("%c Particle system powered by three.quarks. https://quarks.art/","font-size: 16px; font-weight: bold;");var vi=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};const hp=N("debugparticles"),PW=N("noprogressive"),MW=N("debugprogressive");var Vv;(function(n){n[n.Birth=0]="Birth",n[n.Collision=1]="Collision",n[n.Death=2]="Death",n[n.Trigger=3]="Trigger",n[n.Manual=4]="Manual"})(Vv||(Vv={}));class Ho extends se{constructor(){super(...arguments);c(this,"renderMode");c(this,"particleMaterial");c(this,"trailMaterial");c(this,"particleMesh");c(this,"maxParticleSize");c(this,"minParticleSize");c(this,"velocityScale");c(this,"cameraVelocityScale");c(this,"lengthScale")}start(){if(this.maxParticleSize!==.5&&this.minParticleSize!==0&&xe()){const e=`ParticleSystem "${this.name}" has non-default min/max particle size. This may not render correctly. Please set min size to 0 and the max size to 0.5 and use the "StartSize" setting instead`;console.warn(e)}}get transparent(){var i;return((i=this.particleMaterial)==null?void 0:i.transparent)??!1}getMaterial(e=!1){let i=e===!0&&this.trailMaterial?this.trailMaterial:this.particleMaterial;return i&&e&&i.side===Oa&&(i=i.clone(),i.side=pc,e?this.trailMaterial=i:this.particleMaterial=i),i&&!PW&&i._didRequestTextureLOD===void 0&&(i._didRequestTextureLOD=0,MW&&console.log("Load material LOD",i.name),ct.assignTextureLOD(i,0)),i}getMesh(e){let i=null;if(!i&&(this.particleMesh instanceof J&&(i=this.particleMesh.geometry),i===null)){i=new Ys(1,1);const r=i.attributes.uv;for(let o=0;o<r.count;o++)r.setX(o,1-r.getX(o))}return new J(i,this.getMaterial())}}vi([A()],Ho.prototype,"renderMode",void 0);vi([A(ft)],Ho.prototype,"particleMaterial",void 0);vi([A(ft)],Ho.prototype,"trailMaterial",void 0);vi([A()],Ho.prototype,"maxParticleSize",void 0);vi([A()],Ho.prototype,"minParticleSize",void 0);vi([A()],Ho.prototype,"velocityScale",void 0);vi([A()],Ho.prototype,"cameraVelocityScale",void 0);vi([A()],Ho.prototype,"lengthScale",void 0);class mA{constructor(t,e=1){c(this,"_curve");c(this,"_factor");c(this,"type","function");this._curve=t,this._factor=e}genValue(t){return this._curve.evaluate(t,Math.random())*this._factor}toJSON(){throw new Error("Method not implemented.")}clone(){throw new Error("Method not implemented.")}}class dS{constructor(t){c(this,"type","value");c(this,"system");this.system=t}toJSON(){throw new Error("Method not implemented.")}clone(){throw new Error("Method not implemented.")}}class DW extends dS{genValue(){return this.system.textureSheetAnimation.getStartIndex()}}class kW extends dS{constructor(){super(...arguments);c(this,"_lastPosition",new C);c(this,"_lastDistance",0)}update(){const e=qe(this.system.gameObject);this._lastDistance=this._lastPosition.distanceTo(e),this._lastPosition.copy(e)}genValue(){if(!this.system.isPlaying||!this.system.emission.enabled||this.system.currentParticles>=this.system.maxParticles)return 0;let e=this.system.emission.rateOverTime.evaluate(this.system.time/this.system.duration,Math.random());if(this.system.deltaTime>0){const r=this.system.emission.rateOverDistance.evaluate(this.system.time/this.system.duration,Math.random());let a=this._lastDistance/this.system.deltaTime*r;Number.isFinite(a)||(a=0),e+=a}const i=this.system.emission.getBurst();i>0&&(e+=i/this.system.deltaTime);const s=this.system.maxParticles-this.system.currentParticles;return Ae.clamp(e,0,s/this.system.deltaTime)}}class OW extends dS{genValue(){return this.system.isPlaying,0}}class au{constructor(t){c(this,"system");c(this,"type");this.type=Object.getPrototypeOf(this).constructor.name||"ParticleSystemBaseBehaviour",t&&(this.system=t)}get context(){return this.system.context}initialize(t){}update(t,e){}frameUpdate(t){}toJSON(){throw new Error("Method not implemented.")}clone(){throw new Error("Method not implemented.")}reset(){}}class LW extends au{constructor(){super(...arguments);c(this,"type","NeedleTextureSheet")}update(e,i){const s=this.system.textureSheetAnimation;if(s.enabled){const r=e.age/e.life,o=s.evaluate(r);o!==void 0&&(e.uvTile=o)}}}const ZT=Symbol("particleRotation");class FW extends au{constructor(){super(...arguments);c(this,"type","NeedleRotation")}initialize(e){e[ZT]=Math.random()}update(e,i){if(e.rotation===void 0)return;const s=e.age/e.life;if(typeof e.rotation=="number"&&(this.system.rotationOverLifetime.enabled?e.rotation+=this.system.rotationOverLifetime.evaluate(s,e[ZT])*i:this.system.renderer.renderMode===ga.Billboard&&(e.rotation=Math.PI),this.system.rotationBySpeed.enabled)){const r=e.velocity.length();e.rotation+=this.system.rotationBySpeed.evaluate(s,r)*i}}}const $T=Symbol("sizeLerpFactor"),UW=new C;class NW extends au{constructor(){super(...arguments);c(this,"type","NeedleSize");c(this,"_minSize",0);c(this,"_maxSize",1)}initialize(e){e[$T]=Math.random(),this._minSize=this.system.renderer.minParticleSize,this._maxSize=this.system.renderer.maxParticleSize}update(e,i){const s=e.age/e.life;let r=1;this.system.sizeOverLifetime.enabled&&(r*=this.system.sizeOverLifetime.evaluate(s,void 0,e[$T]).x);let o=1;if(this.system.renderer.renderMode!==ga.Mesh&&(o=this.system.worldScale.x/this.system.cameraScale),e.size=e.startSize*r*o,this.system.localspace){const a=tO(this.system,UW);e.size*=a.x}}}const nd=Symbol("particleLife"),c_=Symbol("trailLifetime"),eR=Symbol("trailStartLength"),h_=Symbol("trailWidthRandom");class QW extends au{constructor(){super(...arguments);c(this,"type","NeedleTrail")}initialize(e){e instanceof xg&&(e[nd]=e.life,this.system.trails.enabled&&this.system.trails.dieWithParticles===!1&&(e[c_]=this.system.trails.lifetime.evaluate(Math.random(),Math.random()),e.life+=e[c_]),e[eR]=e.length,e[h_]=Math.random())}update(e){var i;if((i=this.system.trails)!=null&&i.enabled&&e instanceof xg){const s=e,r=e.age/e[nd],o=e.previous.values(),a=e.previous.length;for(let l=0;l<a;l++){const u=o.next().value,d=1-l/(a-1);let f=e.size;f<=0&&!this.system.trails.sizeAffectsWidth&&(f=20*this.system.trails.widthOverTrail.evaluate(.5,s[h_])),u.size=this.system.trails.getWidth(f,r,d,s[h_]),u.color.copy(e.color),this.system.trails.getColor(u.color,r,d)}if(e.age>e[nd]){e.velocity.set(0,0,0);const l=(e.age-e[nd])/e[c_];s.length=Ae.lerp(e[eR],0,l)}}}}const AA=Symbol("startVelocity"),tR=Symbol("gravityModifier"),u_=Symbol("gravitySpeed"),vA=Symbol("velocity lerp factor"),$w=new C;class zW extends au{constructor(){super(...arguments);c(this,"type","NeedleVelocity");c(this,"_gravityDirection",new C)}initialize(e){var r,o;const i=this.system.main.simulationSpeed;e.startSpeed=this.system.main.startSpeed.evaluate(Math.random(),Math.random()),e.velocity.copy(this.system.shape.getDirection(e,e.position)).multiplyScalar(e.startSpeed),(r=this.system.inheritVelocity)!=null&&r.enabled&&this.system.inheritVelocity.applyInitial(e.velocity),e[AA]?e[AA].copy(e.velocity):e[AA]=e.velocity.clone();const s=this.system.main.gravityModifier.evaluate(Math.random(),Math.random());e[tR]=s*i,e[u_]=s*i*.5,e[vA]=Math.random(),(o=this.system.velocityOverLifetime)==null||o.init(e),this._gravityDirection.set(0,-1,0),this.system.main.simulationSpace===Po.Local&&this._gravityDirection.applyQuaternion(this.system.worldQuaternionInverted).normalize()}update(e,i){var f;const s=e[AA],r=e[tR];if(r!==0){const p=r*e[u_];$w.copy(this._gravityDirection).multiplyScalar(p),e[u_]+=i*.05,s.add($w)}e.velocity.copy(s);const o=e.age/e.life;(f=this.system.inheritVelocity)!=null&&f.enabled&&this.system.inheritVelocity.applyCurrent(e.velocity,o,e[vA]);const a=this.system.noise;a.enabled&&a.apply(0,e.position,e.velocity,i,e.age,e.life);const l=this.system.sizeBySpeed;l!=null&&l.enabled&&(e.size=l.evaluate(e.velocity,o,e[vA],e.size));const h=this.system.colorBySpeed;h!=null&&h.enabled&&h.evaluate(e.velocity,e[vA],e.color);const u=this.system.velocityOverLifetime;u.enabled&&u.apply(e,0,e.position,e.velocity,i,e.age,e.life);const d=this.system.limitVelocityOverLifetime;d.enabled&&d.apply(e.position,s,e.velocity,e.size,o,i,1),this.system.worldspace&&e.velocity.multiply(this.system.worldScale)}}const iR=Symbol("colorLerpFactor"),nR=new Ot(1,1,1,1),ih=new Ot(1,1,1,1);class jW extends au{constructor(){super(...arguments);c(this,"type","NeedleColor")}initialize(e){}_init(e){const i=this.system.renderer.particleMaterial;ih.copy(this.system.main.startColor.evaluate(Math.random())),i!=null&&i.color&&(nR.copy(i.color),ih.multiply(nR)),ih.convertLinearToSRGB(),e.startColor.set(ih.r,ih.g,ih.b,ih.alpha),e.color.copy(e.startColor),e[iR]=Math.random()}update(e,i){if(e.age===0&&this._init(e),this.system.colorOverLifetime.enabled){const s=e.age/e.life,r=this.system.colorOverLifetime.color.evaluate(s,e[iR]);e.color.set(r.r,r.g,r.b,r.alpha).multiply(e.startColor)}else e.color.copy(e.startColor)}}class GW{constructor(t){c(this,"system");c(this,"emission");c(this,"autoDestroy");c(this,"startLength");c(this,"emissionBursts");c(this,"onlyUsedByOther");c(this,"behaviors",[]);c(this,"rendererEmitterSettings",{startLength:new ts(220),followLocalOrigin:!1});c(this,"flatWhiteTexture");c(this,"clonedTexture",{original:void 0,clone:void 0});this.system=t,this.emission=new kW(this.system)}get anim(){return this.system.textureSheetAnimation}get prewarm(){return!1}get material(){return this.system.renderer.getMaterial(this.system.trails.enabled)}get layers(){return this.system.gameObject.layers}update(){this.emission.update()}get looping(){return this.system.main.loop}get duration(){return this.system.duration}get shape(){return this.system.shape}get startLife(){return new mA(this.system.main.startLifetime)}get startSpeed(){return new mA(this.system.main.startSpeed)}get startRotation(){return new mA(this.system.main.startRotation)}get startSize(){return new mA(this.system.main.startSize)}get startColor(){return new Hv(new ke(1,1,1,1))}get emissionOverTime(){return this.emission}get emissionOverDistance(){return new OW(this.system)}get instancingGeometry(){return this.system.renderer.getMesh(this.system.renderer.renderMode).geometry}get renderMode(){if(this.system.trails.enabled===!0)return ye.Trail;switch(this.system.renderer.renderMode){case ga.Billboard:return ye.BillBoard;case ga.Stretch:return ye.StretchedBillBoard;case ga.HorizontalBillboard:return ye.HorizontalBillBoard;case ga.VerticalBillboard:return ye.VerticalBillBoard;case ga.Mesh:return ye.Mesh}return ye.BillBoard}get speedFactor(){var e;let t=this.system.main.simulationSpeed;return((e=this.system.renderer)==null?void 0:e.renderMode)===ga.Stretch&&(t*=this.system.renderer.velocityScale??1),t}get texture(){const t=this.material;if(t&&t.map){const e=t.map;if(this.clonedTexture.original!==e||!this.clonedTexture.clone){const i=e.clone();i.premultiplyAlpha=!1,i.colorSpace=Di,this.clonedTexture.original=e,this.clonedTexture.clone=i}return this.clonedTexture.clone}return this.flatWhiteTexture||(this.flatWhiteTexture=QD(new Ot(1,1,1,1),1)),this.flatWhiteTexture}get startTileIndex(){return new DW(this.system)}get uTileCount(){var t;return this.anim.enabled?(t=this.anim)==null?void 0:t.numTilesX:void 0}get vTileCount(){var t;return this.anim.enabled?(t=this.anim)==null?void 0:t.numTilesY:void 0}get renderOrder(){return 1}get blending(){var t;return((t=this.system.renderer.particleMaterial)==null?void 0:t.blending)??K2}get transparent(){return this.system.renderer.transparent}get worldSpace(){return this.system.main.simulationSpace===Po.World}}class HW{constructor(){c(this,"burstIndex",0);c(this,"burstWaveIndex",0);c(this,"time",0);c(this,"waitEmiting",0)}}class gi extends se{constructor(){super(...arguments);c(this,"_state");c(this,"colorOverLifetime");c(this,"main");c(this,"emission");c(this,"sizeOverLifetime");c(this,"shape");c(this,"noise");c(this,"trails");c(this,"velocityOverLifetime");c(this,"limitVelocityOverLifetime");c(this,"inheritVelocity");c(this,"colorBySpeed");c(this,"textureSheetAnimation");c(this,"rotationOverLifetime");c(this,"rotationBySpeed");c(this,"sizeBySpeed");c(this,"_cameraScale",1);c(this,"__worldQuaternion",new ne);c(this,"_worldQuaternionInverted",new ne);c(this,"_worldScale",new C);c(this,"_worldPositionFrame",-1);c(this,"_worldPos",new C);c(this,"_renderer");c(this,"_batchSystem");c(this,"_particleSystem");c(this,"_interface");c(this,"_container");c(this,"_time",0);c(this,"_isPlaying",!0);c(this,"_isUsedAsSubsystem",!1);c(this,"_didPreWarm",!1);c(this,"_bursts");c(this,"_subEmitterSystems");c(this,"_lastBatchesCount",-1);c(this,"lastMaterialVersion",-1)}play(e=!1){var i;e&&z.foreachComponent(this.gameObject,s=>{s instanceof gi&&s!==this&&s.play(!1)},!0),this._isPlaying=!0,this._particleSystem&&(this._particleSystem.emissionState.time=0,this._particleSystem.emitEnded=!1),(i=this.emission)==null||i.reset()}pause(e=!0){e&&z.foreachComponent(this.gameObject,i=>{i instanceof gi&&i!==this&&i.pause(!1)},!0),this._isPlaying=!1}stop(e=!0,i=!1){e&&z.foreachComponent(this.gameObject,s=>{s instanceof gi&&s!==this&&s.stop(!1,i)},!0),this._isPlaying=!1,this._time=0,i&&this.reset()}reset(){var e;this._time=0,this._particleSystem&&(this._particleSystem.particleNum=0,this._particleSystem.emissionState.time=0,this._particleSystem.emitEnded=!1,(e=this.emission)==null||e.reset())}emit(e){if(this._particleSystem){this.onUpdate(),e=Math.min(e,this.maxParticles-this.currentParticles),this._state||(this._state=new HW),this._state.waitEmiting=e,this._state.time=0;const i=this._particleSystem.emitEnded;this._particleSystem.emitEnded=!1,this._particleSystem.emit(this.deltaTime,this._state,this._particleSystem.emitter.matrixWorld),this._particleSystem.emitEnded=i}}get playOnAwake(){return this.main.playOnAwake}set playOnAwake(e){this.main.playOnAwake=e}get renderer(){return this._renderer}get isPlaying(){return this._isPlaying}get currentParticles(){var e;return((e=this._particleSystem)==null?void 0:e.particleNum)??0}get maxParticles(){return this.main.maxParticles}get time(){return this._time}get duration(){return this.main.duration}get deltaTime(){return this.context.time.deltaTime*this.main.simulationSpeed}get scale(){return this.gameObject.scale.x}get cameraScale(){return this._cameraScale}get container(){return this._container}get worldspace(){return this.main.simulationSpace===Po.World}get localspace(){return this.main.simulationSpace===Po.Local}get worldQuaternion(){return this.__worldQuaternion}get worldQuaternionInverted(){return this._worldQuaternionInverted}get worldScale(){return this._worldScale}get worldPos(){return this._worldPositionFrame!==this.context.time.frame&&(this._worldPositionFrame=this.context.time.frame,qe(this.gameObject,this._worldPos)),this._worldPos}get matrixWorld(){return this._container.matrixWorld}get isSubsystem(){return this._isUsedAsSubsystem}addBehaviour(e){return this._particleSystem?(e instanceof au&&(e.system=this),xe()&&console.log("add behaviour",e),this._particleSystem.addBehavior(e),!0):!1}removeBehaviour(e){if(!this._particleSystem)return!1;const i=this._particleSystem.behaviors,s=i.indexOf(e);return s!==-1&&i.splice(s,1),!0}removeAllBehaviours(){return this._particleSystem?(this._particleSystem.behaviors.length=0,!0):!1}get behaviours(){return this._particleSystem?this._particleSystem.behaviors:null}get particleSystem(){return this._particleSystem??null}set bursts(e){for(let i=0;i<e.length;i++){const s=e[i];if(!(s instanceof Ov)){const r=new Ov;Dd(r,s),e[i]=r}}this._bursts=e}set subEmitterSystems(e){for(let i=0;i<e.length;i++){const s=e[i];if(!(s instanceof Wv)){const r=new Wv;Dd(r,s),e[i]=r}}hp&&e.length>0&&console.log("SubEmitters: ",e,this),this._subEmitterSystems=e}onAfterDeserialize(e){if(this._subEmitterSystems&&Array.isArray(this._subEmitterSystems))for(const i of this._subEmitterSystems)i._deserialize(this.context,this.gameObject)}awake(){if(this._worldPositionFrame=-1,this._renderer=this.gameObject.getComponent(Ho),!this.main)throw new Error("Not Supported: ParticleSystem needs a serialized MainModule. Creating new particle systems at runtime is currently not supported.");this._container=new re,this._container.matrixAutoUpdate=!1,this.context.scene.add(this._container),this._batchSystem=new nW,this._batchSystem.name=this.gameObject.name,this._container.add(this._batchSystem),this._interface=new GW(this),this._particleSystem=new W9(this._interface),this._particleSystem.addBehavior(new NW(this)),this._particleSystem.addBehavior(new jW(this)),this._particleSystem.addBehavior(new LW(this)),this._particleSystem.addBehavior(new FW(this)),this._particleSystem.addBehavior(new zW(this)),this._particleSystem.addBehavior(new QW(this)),this._batchSystem.addSystem(this._particleSystem);const e=this._particleSystem.emitter;this.context.scene.add(e),this.inheritVelocity.system&&this.inheritVelocity.system!==this&&(this.inheritVelocity=this.inheritVelocity.clone()),this.inheritVelocity.awake(this),hp&&(console.log(this),this.gameObject.add(new Do(1)))}start(){this.addSubParticleSystems(),this.updateLayers(),this.renderer.particleMesh instanceof J&&this._interface.renderMode==ye.Mesh&&ct.assignMeshLOD(this.renderer.particleMesh,0).then(e=>{e&&this.particleSystem&&this._interface.renderMode==ye.Mesh&&(this.particleSystem.instancingGeometry=e)})}onDestroy(){var e,i,s,r;(e=this._container)==null||e.removeFromParent(),(i=this._batchSystem)==null||i.removeFromParent(),(s=this._particleSystem)==null||s.emitter.removeFromParent(),(r=this._particleSystem)==null||r.dispose()}onEnable(){this.main&&(this.inheritVelocity&&(this.inheritVelocity.system=this),this._batchSystem&&(this._batchSystem.visible=!0),this.playOnAwake&&this.play(),this._isPlaying=this.playOnAwake)}onDisable(){this._batchSystem&&(this._batchSystem.visible=!1)}onBeforeRender(){var e;this.main&&(this._didPreWarm===!1&&((e=this.main)==null?void 0:e.prewarm)===!0&&(this._didPreWarm=!0,this.preWarm()),this.onUpdate(),this.onSimulate(this.deltaTime))}preWarm(){var u;if(!((u=this.emission)!=null&&u.enabled)||this.emission.rateOverTime.getMax()<=0)return;const i=1/60,s=this.main.duration,r=this.main.startLifetime.getMax(),o=1e3,a=Math.min(Math.max(s,r)/Math.max(.01,this.main.simulationSpeed),o),l=Math.ceil(a/i),h=Date.now();hp&&console.log(`Particles ${this.name} - Prewarm for ${l} frames (${a} sec). Duration: ${s}, Lifetime: ${r}`);for(let d=0;d<l&&!(this.currentParticles>=this.maxParticles);d++){const f=Date.now()-h;if(f>2e3){console.warn(`Particles ${this.name} - Prewarm took too long. Aborting: ${f}`);break}this.onUpdate(),this.onSimulate(i)}}onSimulate(e){if(this._batchSystem){let i=this.context.time.frameCount%60===0;this._lastBatchesCount!==this._batchSystem.batches.length&&(this._lastBatchesCount=this._batchSystem.batches.length,i=!0),i&&this.updateLayers(),this._batchSystem.update(e)}this._time+=e,this._time>this.duration&&(this._time=0)}updateLayers(){if(this._batchSystem)for(let e=0;e<this._batchSystem.batches.length;e++){const i=this._batchSystem.batches[e];i.layers.disableAll();const s=this.layer;i.layers.mask=1<<s}}onUpdate(){var o,a;const e=this.renderer.getMaterial(this.trails.enabled);if(e&&e.version!=this.lastMaterialVersion&&this._particleSystem&&(this.lastMaterialVersion=e.version,this._particleSystem.texture=this._interface.texture),this._bursts&&(this.emission.bursts=this._bursts,delete this._bursts),!this._isPlaying)return;const i=this.context.mainCamera;if(i){const l=ai(i);this._cameraScale=l.x}const s=!this.worldspace,r=this.gameObject;if(Nt(r,this.__worldQuaternion),this._worldQuaternionInverted.copy(this.__worldQuaternion).invert(),ai(this.gameObject,this._worldScale),s&&this._container&&((o=this.gameObject)!=null&&o.parent)){const l=tO(this,$w);this._container.matrix.makeScale(l.x,l.y,l.z),this._container.matrix.makeRotationFromQuaternion(this.__worldQuaternion),this._container.matrix.setPosition(this.worldPos),this._container.matrix.scale(this.gameObject.scale)}this.emission.system=this,this._interface.update(),this.shape.update(this,this.context,this.main.simulationSpace,this.gameObject),this.noise.update(this.context),(a=this.inheritVelocity)==null||a.update(this.context),this.velocityOverLifetime.update(this)}addSubParticleSystems(){var e;if(this._subEmitterSystems&&this._particleSystem)for(const i of this._subEmitterSystems){i.particleSystem&&(i.particleSystem.__internalAwake?i.particleSystem.__internalAwake():xe()&&console.warn("SubParticleSystem serialization issue(?)",i.particleSystem,i));const s=(e=i.particleSystem)==null?void 0:e._particleSystem;if(s){i.particleSystem._isUsedAsSubsystem=!0;const r=new fS(this,this._particleSystem,i.particleSystem,s);r.emitterType=i.type,r.emitterProbability=i.emitProbability,this._particleSystem.addBehavior(r)}else hp&&console.warn("Could not add SubParticleSystem",i,this)}}}vi([A(r0)],gi.prototype,"colorOverLifetime",void 0);vi([A(ls)],gi.prototype,"main",void 0);vi([A(Ol)],gi.prototype,"emission",void 0);vi([A(iu)],gi.prototype,"sizeOverLifetime",void 0);vi([A(Xt)],gi.prototype,"shape",void 0);vi([A(Lt)],gi.prototype,"noise",void 0);vi([A(Ai)],gi.prototype,"trails",void 0);vi([A(Si)],gi.prototype,"velocityOverLifetime",void 0);vi([A(Ji)],gi.prototype,"limitVelocityOverLifetime",void 0);vi([A(Ll)],gi.prototype,"inheritVelocity",void 0);vi([A(nf)],gi.prototype,"colorBySpeed",void 0);vi([A(cs)],gi.prototype,"textureSheetAnimation",void 0);vi([A(jo)],gi.prototype,"rotationOverLifetime",void 0);vi([A(oo)],gi.prototype,"rotationBySpeed",void 0);vi([A(Zs)],gi.prototype,"sizeBySpeed",void 0);class Wv{constructor(){c(this,"particleSystem");c(this,"emitProbability",1);c(this,"properties");c(this,"type")}_deserialize(t,e){const i=this.particleSystem;if(i instanceof gi)return;let s="";i&&typeof i.guid=="string"&&(s=i.guid,this.particleSystem=z.findByGuid(s,e)),hp&&!(this.particleSystem instanceof gi)&&console.warn("Could not find particle system for sub emitter",s,e,this)}}function tO(n,t){if(t.set(1,1,1),n.gameObject.parent&&n.localspace)switch(n.main.scalingMode){case kv.Local:t=ai(n.gameObject.parent,t),t.x=1/t.x,t.y=1/t.y,t.z=1/t.z;break;default:if(!n.unsupported_scaling_mode){n.unsupported_scaling_mode=!0;const e="ParticleSystem scale mode "+kv[n.main.scalingMode]+" is not supported";xe()&&Yt(e),console.warn(e,n.name,n)}t=ai(n.gameObject,t);break}return t}new C(1,1,1);new C(0,0,1);class fS{constructor(t,e,i,s){c(this,"system");c(this,"particleSystem");c(this,"subSystem");c(this,"subParticleSystem");c(this,"type","NeedleParticleSubEmitter");c(this,"emitterType");c(this,"emitterProbability");c(this,"q_",new ne);c(this,"v_",new C);c(this,"v2_",new C);c(this,"_emitterMatrix",new ce);c(this,"_circularBuffer");this.system=t,this.particleSystem=e,this.subSystem=i,this.subParticleSystem=s,this.subParticleSystem&&this.subParticleSystem&&(this.subParticleSystem.onlyUsedByOther=!0);const r=1e3;this._circularBuffer=new ko(()=>new ce,r)}clone(){throw new Error("Method not implemented.")}initialize(t){t.emissionState={burstIndex:0,burstWaveIndex:0,time:0,waitEmiting:0},this._emitterMatrix.copy(this.subSystem.matrixWorld).invert().premultiply(this.system.matrixWorld),this._emitterMatrix.setPosition(0,0,0),this.emitterType===Vv.Birth&&this.run(t)}update(t,e){this.run(t)}frameUpdate(t){}toJSON(){}reset(){}run(t){if(this.subSystem.currentParticles>=this.subSystem.main.maxParticles||!this.subParticleSystem||!t.emissionState||this.emitterProbability&&Math.random()>this.emitterProbability)return;const e=this.system.deltaTime;if(this.emitterType===Vv.Death){let s=t.life;if(t[nd]!==void 0&&(s=t[nd]),!(t.age+e*1.2>=s))return;const o=this.subSystem.main.maxParticles-this.subSystem.currentParticles;t.emissionState.waitEmiting=o}const i=new ce;i.set(1,0,0,t.position.x,0,1,0,t.position.y,0,0,1,t.position.z,0,0,0,1),this.particleSystem.worldSpace||i.multiplyMatrices(this._emitterMatrix,i),this.subParticleSystem.emit(e,t.emissionState,i)}}var VW=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};class S0 extends Ds{constructor(){super(...arguments);c(this,"granularity")}get typeName(){return"PixelationEffect"}onCreateEffect(){const e=new BM;return this.granularity.onValueChanged=i=>{e.granularity=i},e}}VW([A(je)],S0.prototype,"granularity",void 0);zo("PixelationEffect",S0);class Eg extends se{constructor(){super(...arguments);c(this,"_didAssignPlayerColor",!1);c(this,"tryAssignColor",()=>{const e=z.getComponentInParent(this.gameObject,ns);if(e&&e.owner)return this._didAssignPlayerColor=!0,this.assignUserColor(e.owner),!0;const i=z.getComponentInParent(this.gameObject,un);return i!=null&&i.connectionId?(this._didAssignPlayerColor=!0,this.assignUserColor(i.connectionId),!0):!1})}onEnable(){this.context.connection.beginListen(Ye.JoinedRoom,this.tryAssignColor),this._didAssignPlayerColor||this.startCoroutine(this.waitForConnection())}onDisable(){this.context.connection.stopListen(Ye.JoinedRoom,this.tryAssignColor)}*waitForConnection(){for(;!this.destroyed&&this.activeAndEnabled&&(yield A6(.2),!this.tryAssignColor()););}assignUserColor(e){const i=Eg.hashCode(e),s=Eg.colorFromHashCode(i);if(this.gameObject.type==="Mesh"){const r=this.gameObject;this.assignColor(s,e,r)}else if(this.gameObject.children)for(const r of this.gameObject.children){const o=r;o.material&&o.material.color&&this.assignColor(s,e,o)}}assignColor(e,i,s){let r=s.material;r&&(r._playerMaterial!==i&&(r=r.clone(),r._playerMaterial=i,s.material=r),r.color=e)}static hashCode(e){var i=0,s,r;if(e.length===0)return i;for(s=0;s<e.length;s++)r=e.charCodeAt(s),i=(i<<5)-i+r,i|=0;return i}static colorFromHashCode(e){const i=(e&16711680)>>16,s=(e&65280)>>8,r=e&255;return new we(i/255,s/255,r/255)}}async function pS(n){const{NeedleEngineHTMLElement:t}=await hy(()=>Promise.resolve().then(()=>O7),void 0,import.meta.url);t.observedAttributes.includes(n)||t.observedAttributes.push(n)}var lm=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};const Hr=N("debugskybox");pS("skybox-image");pS("environment-image");function sR(n,t,e,i,s){const r=new Pl;r.allowDrop=!1,r.allowNetworking=!1,r.background=e,r.environment=i,z.addComponent(n.scene,r);const o=a=>{typeof a=="string"&&(Hr&&console.log(s,"CHANGED TO",a),r.setSkybox(a))};return uL(n.domElement,s,o),r.addEventListener("destroy",()=>{Hr&&console.log("Destroyed attribute remote skybox",s),dL(n.domElement,s,o)}),r.setSkybox(t)}mt.addContextCreatedCallback(n=>{var r;const t=n.context,e=t.domElement.getAttribute("skybox-image"),i=t.domElement.getAttribute("environment-image"),s=new Array;if(e){Hr&&console.log("Creating remote skybox to load "+e),((r=t.mainCameraComponent)==null?void 0:r.clearFlags)!==Gr.Skybox&&console.warn('"skybox-image" attribute has no effect: camera clearflags are not set to "Skybox"');const o=sR(t,e,!0,!1,"skybox-image");s.push(o)}if(i){Hr&&console.log("Creating remote environment to load "+i);const o=sR(t,i,!1,!0,"environment-image");s.push(o)}return s.length>0?vx(s):Promise.resolve()});function iO(){return globalThis.NEEDLE_ENGINE_SKYBOX_TEXTURES||(globalThis.NEEDLE_ENGINE_SKYBOX_TEXTURES=new Array),globalThis.NEEDLE_ENGINE_SKYBOX_TEXTURES}function rR(n){const e=iO().find(i=>i.src===n);return e?(Hr&&console.log("Skybox: Found previously loaded texture for "+n),e.texture):null}async function WW(n){const t=await n;uM(t,!0),Jt(t)}function qW(n,t){const e=iO();for(;e.length>5;){const i=e.shift();i&&WW(i.texture)}t.then(i=>uM(i,!1)),e.push({src:n,texture:t})}class Pl extends se{constructor(){super(...arguments);c(this,"url");c(this,"allowDrop",!0);c(this,"background",!0);c(this,"environment",!0);c(this,"allowNetworking",!0);c(this,"_loader");c(this,"_prevUrl");c(this,"_prevLoadedEnvironment");c(this,"_prevEnvironment",null);c(this,"_prevBackground",null);c(this,"validTextureTypes",[".hdr",".exr",".jpg",".jpeg",".png"]);c(this,"onDragOverEvent",e=>{if(this.allowDrop&&e.dataTransfer)for(const i of e.dataTransfer.types)(i==="text/uri-list"||i==="Files")&&e.preventDefault()});c(this,"onDrop",e=>{var i,s,r,o;if(this.allowDrop&&e.dataTransfer){for(const a of e.dataTransfer.types)if(Hr&&console.log(a),a==="text/uri-list"){const l=e.dataTransfer.getData(a);Hr&&console.log(a,l);let h=(s=(i=new RegExp(/polyhaven.com\/asset_img\/.+?\/(?<name>.+)\.png/).exec(l))==null?void 0:i.groups)==null?void 0:s.name;if(h||(h=(o=(r=new RegExp(/polyhaven\.com\/a\/(?<name>.+)/).exec(l))==null?void 0:r.groups)==null?void 0:o.name),Hr&&console.log(h),h){const u="https://dl.polyhaven.org/file/ph-assets/HDRIs/exr/1k/"+h+"_1k.exr";console.log(`[Remote Skybox] Setting skybox from url: ${u}`),e.preventDefault(),this.setSkybox(u);break}else if(this.isValidTextureType(l)){console.log("[Remote Skybox] Setting skybox from url: "+l),e.preventDefault(),this.setSkybox(l);break}else{console.warn(`[RemoteSkybox] Unknown url ${l}. If you want to load a skybox from a url, make sure it is a valid image url. Url must end with${this.validTextureTypes.join(", ")}.`);const u=new CustomEvent("dropped-unknown-url",{detail:{sender:this,event:e,url:l,apply:d=>{e.preventDefault(),this.setSkybox(d)}}});this.dispatchEvent(u)}}else if(a=="Files"){const l=e.dataTransfer.files.item(0);if(Hr&&console.log(a,l),!l)continue;if(!this.isValidTextureType(l.name)){console.warn(`[RemoteSkybox]: File "${l.name}" is not supported. Supported files are ${this.validTextureTypes.join(", ")}`);return}if(rR(l.name)===null){const h=new Blob([l]),u=URL.createObjectURL(h);e.preventDefault(),this.setSkybox(u,l.name)}else e.preventDefault(),this.setSkybox(l.name);break}}})}onEnable(){this.setSkybox(this.url),this.registerDropEvents()}onDisable(){var e;this.context.scene.environment===this._prevLoadedEnvironment&&(this.context.scene.environment=this._prevEnvironment,Bt.backgroundShouldBeTransparent(this.context)||(this.context.scene.background=this._prevBackground),this._prevLoadedEnvironment=void 0),this.unregisterDropEvents(),(e=this.context.mainCameraComponent)==null||e.applyClearFlags()}urlChangedSyncField(){this.allowNetworking&&this.url&&this.isRemoteTexture(this.url)&&this.setSkybox(this.url)}async setSkybox(e,i){var o;if(!this.activeAndEnabled||!e)return!1;if(i??(i=e),this.isValidTextureType(i)||console.warn("Potentially invalid skybox url",i,"on",this.name),Hr&&console.log("Set remote skybox url: "+e),this._prevUrl===e&&this._prevLoadedEnvironment)return this.applySkybox(),!0;(o=this._prevLoadedEnvironment)==null||o.dispose(),this._prevLoadedEnvironment=void 0,this._prevUrl=e;const s=await this.loadTexture(e,i);if(!s||!this.enabled)return!1;this.url=e;const r=e.lastIndexOf("/");return s.name=e.substring(r>=0?r+1:0),this._loader instanceof Ra&&(s.colorSpace=Ue),this._prevLoadedEnvironment=s,this.applySkybox(),!0}async loadTexture(e,i){var h,u,d,f,p;if(!e)return Promise.resolve(null);i??(i=e);const s=rR(i);if(s){const g=await s;if(((u=(h=g.source)==null?void 0:h.data)==null?void 0:u.length)>0||(p=(f=(d=g.source)==null?void 0:d.data)==null?void 0:f.data)!=null&&p.length)return g}const r=i.endsWith(".exr"),o=i.endsWith(".hdr");r?this._loader instanceof yv||(this._loader=new yv):o?this._loader instanceof Cw||(this._loader=new Cw):this._loader instanceof Ra||(this._loader=new Ra),Hr&&console.log("Loading skybox: "+e);const a=this._loader.loadAsync(e);return qW(i,a),await a}applySkybox(){var i;const e=this._prevLoadedEnvironment;e&&(e.mapping=J2,e.needsUpdate=!0,this.context.scene.background!==e&&(this._prevBackground=this.context.scene.background),this.context.scene.environment!==e&&(this._prevEnvironment=this.context.scene.environment),Hr&&console.log("Set remote skybox",this.url,!Bt.backgroundShouldBeTransparent(this.context)),this.environment&&(this.context.scene.environment=e),this.background&&!Bt.backgroundShouldBeTransparent(this.context)&&(this.context.scene.background=e),((i=this.context.mainCameraComponent)==null?void 0:i.backgroundBlurriness)!==void 0&&(this.context.scene.backgroundBlurriness=this.context.mainCameraComponent.backgroundBlurriness))}isRemoteTexture(e){return e.startsWith("http://")||e.startsWith("https://")}isValidTextureType(e){for(const i of this.validTextureTypes)if(e.endsWith(i))return!0;return!1}registerDropEvents(){this.unregisterDropEvents(),this.context.domElement.addEventListener("dragover",this.onDragOverEvent),this.context.domElement.addEventListener("drop",this.onDrop)}unregisterDropEvents(){this.context.domElement.removeEventListener("dragover",this.onDragOverEvent),this.context.domElement.removeEventListener("drop",this.onDrop)}}lm([ak(Pl.prototype.urlChangedSyncField),A(URL)],Pl.prototype,"url",void 0);lm([A()],Pl.prototype,"allowDrop",void 0);lm([A()],Pl.prototype,"background",void 0);lm([A()],Pl.prototype,"environment",void 0);lm([A()],Pl.prototype,"allowNetworking",void 0);var xr=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};const hr=N("debugsceneswitcher"),qA="scene";pS(qA);const $l=Promise.resolve(!1);class Os extends se{constructor(){super(...arguments);c(this,"autoLoadFirstScene",!0);c(this,"scenes",[]);c(this,"loadingScene");c(this,"queryParameterName","scene");c(this,"useSceneName",!0);c(this,"clamp",!0);c(this,"useHistory",!0);c(this,"useKeyboard",!0);c(this,"useSwipe",!0);c(this,"useSceneLighting",!0);c(this,"preloadNext",1);c(this,"preloadPrevious",1);c(this,"preloadConcurrent",2);c(this,"_currentIndex",-1);c(this,"_currentScene");c(this,"_engineElementOverserver");c(this,"_preloadScheduler");c(this,"onPopState",async e=>{if(!this.useHistory)return;const i=this.useHistory;try{this.useHistory=!1;let s=!1;if(this.queryParameterName&&(s=await this.tryLoadFromQueryParam()),!s){const r=e==null?void 0:e.state;if(r&&r.startsWith(this.guid)){const o=r.substr(this.guid.length+2);hr&&console.log("PopState",o),await this.trySelectSceneFromValue(o)}}}finally{this.useHistory=i}});c(this,"normalizedSwipeThresholdX",.1);c(this,"_didSwipe",!1);c(this,"onInputPointerMove",e=>{if(this.useSwipe&&!this._didSwipe&&e.button===0&&e.pointerType==="touch"&&this.context.input.getPointerPressedCount()===1){const i=this.context.input.getPointerPositionDelta(e.button);if(i){const s=i.x/this.context.domWidth;s>=this.normalizedSwipeThresholdX?(this._didSwipe=!0,this.selectPrev()):s<=-this.normalizedSwipeThresholdX&&(this._didSwipe=!0,this.selectNext())}}});c(this,"onInputPointerUp",e=>{e.button===0&&(this._didSwipe=!1)});c(this,"onInputKeyDown",e=>{if(!this.useKeyboard||!this.scenes)return;const i=e.key.toLowerCase();if(!i)return;const s=parseInt(i)-1;if(s>=0){this.trySelectSceneFromValue(s);return}switch(i){case"arrowright":case"d":this.selectNext();break;case"arrowleft":case"a":this.selectPrev();break}});c(this,"__lastSwitchScene");c(this,"__lastSwitchScenePromise");c(this,"_currentlyLoadingScene");c(this,"_lastLoadingScene");c(this,"_loadingScenePromise");c(this,"_isCurrentlyLoading",!1);c(this,"_currentLoadingProgress")}get currentIndex(){return this._currentIndex}get currentLoadingProgress(){return this._currentLoadingProgress}get currentlyLoadingScene(){return this._currentlyLoadingScene}get currentlyLoadedScene(){return this._currentScene}awake(){this.scenes===void 0&&(this.scenes=[]),hr&&console.log("SceneSwitcher",this)}async onEnable(){if(globalThis.addEventListener("popstate",this.onPopState),this.context.input.addEventListener(at.KeyDown,this.onInputKeyDown),this.context.input.addEventListener(at.PointerMove,this.onInputPointerMove),this.context.input.addEventListener(at.PointerUp,this.onInputPointerUp),this._engineElementOverserver||(this._engineElementOverserver=new MutationObserver(e=>{for(const i of e)if(i.type==="attributes"&&i.attributeName===qA){const s=this.context.domElement.getAttribute(qA);s!==null&&this.trySelectSceneFromValue(s)}})),this._engineElementOverserver.observe(this.context.domElement,{attributes:!0}),this._preloadScheduler||(this._preloadScheduler=new XW(this)),this._preloadScheduler.maxLoadAhead=this.preloadNext,this._preloadScheduler.maxLoadBehind=this.preloadPrevious,this._preloadScheduler.maxConcurrent=this.preloadConcurrent,this._preloadScheduler.begin(),this.autoLoadFirstScene&&this._currentIndex===-1&&!await this.tryLoadFromQueryParam()){const e=this.context.domElement.getAttribute(qA);try{(e===null||!await this.trySelectSceneFromValue(e))&&this._currentIndex===-1&&this.select(0)}finally{}}}onDisable(){var e;globalThis.removeEventListener("popstate",this.onPopState),this.context.input.removeEventListener(at.KeyDown,this.onInputKeyDown),this.context.input.removeEventListener(at.PointerMove,this.onInputPointerMove),this.context.input.removeEventListener(at.PointerUp,this.onInputPointerUp),(e=this._preloadScheduler)==null||e.stop()}addScene(e){if(typeof e=="string"){let i=this.context.addressables.findAssetReference(e);return i||(i=new it(e),this.context.addressables.registerAssetReference(i)),this.scenes.push(i),i}return this.scenes.push(e),e}selectNext(){return this.select(this._currentIndex+1)}selectPrev(){return this.select(this._currentIndex-1)}select(e){var s,r,o;if(hr&&console.log("select",e),typeof e=="object"&&console.warn('Switching to "'+e+'" might not work. Please either use an index or a AssetReference (not a scene reference)'),typeof e=="string"){const a=(s=this.scenes)==null?void 0:s.find(l=>l.uri===e);if(!a){const l=it.getOrCreate(this.sourceId??"",e,this.context);return this.switchScene(l)}if(a)e=(r=this.scenes)==null?void 0:r.indexOf(a);else return $l}if(!((o=this.scenes)!=null&&o.length))return $l;if(e<0){if(this.clamp)return $l;e=this.scenes.length-1}else if(e>=this.scenes.length){if(this.clamp)return $l;e=0}const i=this.scenes[e];return this.switchScene(i)}async switchScene(e){if(!(e instanceof it)){const s=typeof e;return s==="string"?this.select(e):s==="number"?this.select(e):(console.warn("SceneSwitcher: Can't switch to scene",e,"of type",s),!1)}return e.uri===this.sourceId?(console.warn("SceneSwitcher: can't load own scene - prevent recursive loading",this.sourceId),!1):this.__lastSwitchScene===e&&this.__lastSwitchScenePromise?this.__lastSwitchScenePromise:(this.__lastSwitchScene=e,this.__lastSwitchScenePromise=this.__internalSwitchScene(e),await this.__lastSwitchScenePromise)}async __internalSwitchScene(e){var s,r;if(this._currentScene){hr&&console.log("UNLOAD",e.uri);const o=this.tryGetSceneEventListener(this._currentScene.asset);if(o!=null&&o.sceneClosing){const a=o.sceneClosing();a instanceof Promise&&await a}this._currentScene.unload()}this._currentScene=void 0;const i=this._currentIndex=((s=this.scenes)==null?void 0:s.indexOf(e))??-1;try{this._currentlyLoadingScene=e,this._currentLoadingProgress=new ProgressEvent("progress",{loaded:0,total:1});const o=new CustomEvent("loadscene-start",{detail:{scene:e,switcher:this,index:i}});this.dispatchEvent(o),await this.onStartLoading(),await e.loadAssetAsync((l,h)=>{this._currentLoadingProgress=h,this.dispatchEvent(h)}).catch(console.error),await this.onEndLoading();const a=new CustomEvent("loadscene-finished",{detail:{scene:e,switcher:this,index:i}});if(this.dispatchEvent(a),this._currentLoadingProgress=void 0,this._currentlyLoadingScene=void 0,a.defaultPrevented)return hr&&console.warn("Adding loaded scene prevented:",e,a),!1;if(!e.asset)return hr&&console.warn("Failed loading scene:",e),!1;if(this._currentIndex===i){if(hr&&console.log("ADD",e.uri),this._currentScene=e,z.add(e.asset,this.gameObject),this.useSceneLighting&&this.context.sceneLighting.enable(e),this.useHistory&&i>=0){let u=i.toString();if(this.useSceneName&&(u=oR(e.uri)),(r=this.queryParameterName)!=null&&r.length)R_(this.queryParameterName,u,this.useHistory);else{const d=history.state,f=this.guid+"::"+i;d!==f&&history.pushState(f,"unused",location.href)}}const l=this.tryGetSceneEventListener(e.asset);if(l!=null&&l.sceneOpened){const u=l.sceneOpened(this);u instanceof Promise&&await u}const h=new CustomEvent("scene-opened",{detail:{scene:e,switcher:this,index:i}});return this.dispatchEvent(h),!0}}catch(o){console.error(o)}return!1}preload(e){if(e>=0&&e<this.scenes.length){const i=this.scenes[e];if(i instanceof it)return i.preload()}return $l}tryLoadFromQueryParam(){var i;if(!((i=this.queryParameterName)!=null&&i.length))return $l;const e=N(this.queryParameterName);return typeof e=="boolean"?$l:this.trySelectSceneFromValue(e)}trySelectSceneFromValue(e){if(typeof e=="string"){const i=parseInt(e);if(i>=0&&i<this.scenes.length)return this.select(i);{const s=e.toLowerCase();for(let r=0;r<this.scenes.length;r++){const o=this.scenes[r];if(o&&oR(o.uri).toLowerCase().includes(s))return this.select(r)}}}else if(typeof e=="number"&&e>=0&&e<this.scenes.length)return this.select(e);return qs()&&console.warn('Can not find scene: "'+e+'"',this),$l}async onStartLoading(){var e,i;if(this._isCurrentlyLoading=!0,this.loadingScene&&(this._lastLoadingScene!==this.loadingScene&&(this._loadingScenePromise=void 0),this._lastLoadingScene=this.loadingScene,this._loadingScenePromise||(this._loadingScenePromise=(e=this.loadingScene)==null?void 0:e.loadAssetAsync()),await this._loadingScenePromise,this._isCurrentlyLoading&&((i=this.loadingScene)!=null&&i.asset))){hr&&console.log("Add loading scene",this.loadingScene.uri,this.loadingScene.asset);const s=this.loadingScene.asset;z.add(s,this.gameObject);const r=this.tryGetSceneEventListener(s);if(r!=null&&r.sceneOpened){const o=r.sceneOpened(this);o instanceof Promise&&await o}}if(this._isCurrentlyLoading){const s=this.tryGetSceneEventListener(this.gameObject);if(s&&s.sceneOpened){const r=s.sceneOpened(this);r instanceof Promise&&await r}}}async onEndLoading(){var e;if(this._isCurrentlyLoading=!1,(e=this.loadingScene)!=null&&e.asset){hr&&console.log("Remove loading scene",this.loadingScene.uri);const i=this.loadingScene.asset,s=this.tryGetSceneEventListener(i);if(typeof(s==null?void 0:s.sceneClosing)=="function"){const r=s.sceneClosing();r instanceof Promise&&await r}z.remove(i)}if(!this._isCurrentlyLoading){const i=this.tryGetSceneEventListener(this.gameObject);if(i&&i.sceneClosing){const s=i.sceneClosing();s instanceof Promise&&await s}}}tryGetSceneEventListener(e,i=0){const s=z.foreachComponent(e,r=>r.sceneClosing?r:void 0);if(i===0&&!s&&e.children.length)for(const r of e.children){const o=this.tryGetSceneEventListener(r,i+1);if(o)return o}return s||null}}xr([A()],Os.prototype,"autoLoadFirstScene",void 0);xr([A(it)],Os.prototype,"scenes",void 0);xr([A(it)],Os.prototype,"loadingScene",void 0);xr([A()],Os.prototype,"queryParameterName",void 0);xr([A()],Os.prototype,"useSceneName",void 0);xr([A()],Os.prototype,"clamp",void 0);xr([A()],Os.prototype,"useHistory",void 0);xr([A()],Os.prototype,"useKeyboard",void 0);xr([A()],Os.prototype,"useSwipe",void 0);xr([A()],Os.prototype,"useSceneLighting",void 0);xr([A()],Os.prototype,"preloadNext",void 0);xr([A()],Os.prototype,"preloadPrevious",void 0);xr([A()],Os.prototype,"preloadConcurrent",void 0);function oR(n){const t=n.split("/").pop(),e=t==null?void 0:t.split(".").shift();return e!=null&&e.length?e:n}class XW{constructor(t,e=1,i=1,s=2){c(this,"maxLoadAhead");c(this,"maxLoadBehind");c(this,"maxConcurrent");c(this,"_isRunning",!1);c(this,"_switcher");c(this,"_loadTasks",[]);c(this,"_maxConcurrentLoads",1);this._switcher=t,this.maxLoadAhead=e,this.maxLoadBehind=i,this.maxConcurrent=s}begin(){if(this._isRunning)return;hr&&console.log("Preload begin"),this._isRunning=!0;let t=-1,e,i;const s=this._switcher.scenes,r=setInterval(()=>{if(this.allLoaded()&&(hr&&console.log("All scenes loaded"),this.stop()),!this._isRunning){clearInterval(r);return}if(this.canLoadNewScene()===!1)return;t!==this._switcher.currentIndex&&(t=this._switcher.currentIndex,i=0,e=0);const o=i%2===0;o&&(e+=1),i+=1;const a=o?this.maxLoadAhead:this.maxLoadBehind;if(e>a)return;const l=o?t+e:t-e;if(l<0||l<0||l>=s.length)return;const h=s[l];new YW(l,h,this._loadTasks)},200)}stop(){this._isRunning=!1}canLoadNewScene(){return this._loadTasks.length<this._maxConcurrentLoads}allLoaded(){if(this._switcher.scenes){for(const t of this._switcher.scenes)if((t==null?void 0:t.isLoaded())===!1)return!1}return!0}}class YW{constructor(t,e,i){c(this,"index");c(this,"asset");c(this,"tasks");this.index=t,this.asset=e,this.tasks=i,i.push(this),this.awaitLoading()}async awaitLoading(){this.asset&&!this.asset.isLoaded()&&(hr&&console.log("Preload start: "+this.asset.uri,this.index),await this.asset.preload(),hr&&console.log("Preload finished: "+this.asset.uri,this.index));const t=this.tasks.indexOf(this);t>=0&&this.tasks.splice(t,1)}}function KW(){return new Promise((n,t)=>{const i=()=>{i!=null&&(document.removeEventListener("pointerdown",i),document.removeEventListener("click",i),document.removeEventListener("dragstart",i),document.removeEventListener("touchstart",i),n())};document.addEventListener("pointerdown",i),document.addEventListener("click",i),document.addEventListener("dragstart",i),document.addEventListener("touchstart",i)})}async function JW(n){await KW(),n()}var Cr=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};const sn=N("debugvideo");var fc;(function(n){n[n.None=0]="None",n[n.AdjustHeight=1]="AdjustHeight",n[n.AdjustWidth=2]="AdjustWidth"})(fc||(fc={}));var rl;(function(n){n[n.VideoClip=0]="VideoClip",n[n.Url=1]="Url"})(rl||(rl={}));var Up;(function(n){n[n.None=0]="None",n[n.AudioSource=1]="AudioSource",n[n.Direct=2]="Direct",n[n.APIOnly=3]="APIOnly"})(Up||(Up={}));var Np;(function(n){n[n.CameraFarPlane=0]="CameraFarPlane",n[n.CameraNearPlane=1]="CameraNearPlane",n[n.RenderTexture=2]="RenderTexture",n[n.MaterialOverride=3]="MaterialOverride"})(Np||(Np={}));class pn extends se{constructor(){super();c(this,"playOnAwake",!0);c(this,"aspectMode",fc.None);c(this,"clip",null);c(this,"source",rl.Url);c(this,"_url",null);c(this,"renderMode");c(this,"targetMaterialProperty");c(this,"targetMaterialRenderer");c(this,"targetTexture");c(this,"time",0);c(this,"_playbackSpeed",1);c(this,"_isLooping",!1);c(this,"_muted",!1);c(this,"_audioOutputMode",Up.Direct);c(this,"playInBackground",!0);c(this,"_crossOrigin","anonymous");c(this,"_videoElement",null);c(this,"_videoTexture",null);c(this,"_videoMaterial",null);c(this,"_isPlaying",!1);c(this,"wasPlaying",!1);c(this,"visibilityChanged",e=>{switch(document.visibilityState){case"hidden":this.playInBackground||(this.wasPlaying=this._isPlaying,this.pause());break;case"visible":this.wasPlaying&&!this._isPlaying&&this.play();break}});c(this,"_receivedInput",!1);c(this,"_overlay",null);c(this,"_targetObjects");c(this,"_updateAspectRoutineId",-1);c(this,"_hls");c(this,"onHlsAvailable",()=>{var e;sn&&console.log("HLS: available",this.clip),!(!this.shouldUseM3U||!this.url)&&(this._hls||(this._hls=new Hls),this.videoElement.autoplay=!0,this._hls.loadSource(this.url),this._hls.attachMedia(this.videoElement),(e=this._videoElement)==null||e.play(),sn&&console.log("HLS: loaded",this.clip))});JW(()=>{this._receivedInput=!0,this.updateVideoElementSettings()}),this._targetObjects=[],N("videoscreenspace")&&window.addEventListener("keydown",e=>{e.key==="f"&&(this.screenspace=!this.screenspace)})}get url(){return this._url}set url(e){const s=this._url!==e;this.__didAwake?s&&this.setClipURL(e??""):this._url=e}get playbackSpeed(){var e;return((e=this._videoElement)==null?void 0:e.playbackRate)??this._playbackSpeed}set playbackSpeed(e){this._playbackSpeed=e,this._videoElement&&(this._videoElement.playbackRate=e)}get isLooping(){var e;return((e=this._videoElement)==null?void 0:e.loop)??this._isLooping}set isLooping(e){this._isLooping=e,this._videoElement&&(this._videoElement.loop=e)}get currentTime(){var e;return((e=this._videoElement)==null?void 0:e.currentTime)??this.time}set currentTime(e){this._videoElement?this._videoElement.currentTime=e:this.time=e}get isPlaying(){const e=this._videoElement;if(e){if(e.currentTime>0&&!e.paused&&!e.ended&&e.readyState>e.HAVE_CURRENT_DATA)return!0;if(e.srcObject&&e.srcObject.active)return!0}return!1}get crossOrigin(){var e;return((e=this._videoElement)==null?void 0:e.crossOrigin)??this._crossOrigin}set crossOrigin(e){this._crossOrigin=e,this._videoElement&&(e!==null?this._videoElement.setAttribute("crossorigin",e):this._videoElement.removeAttribute("crossorigin"))}get videoMaterial(){return!this._videoMaterial&&!this.create(!1)?null:this._videoMaterial}get videoTexture(){return!this._videoTexture&&!this.create(!1)?null:this._videoTexture}get videoElement(){return!this._videoElement&&!this.create(!1)?null:this._videoElement}get muted(){var e;return((e=this._videoElement)==null?void 0:e.muted)??this._muted}set muted(e){this._muted=e,this._videoElement&&(this._videoElement.muted=e)}get currentVideo(){return this.clip}set audioOutputMode(e){e!==this._audioOutputMode&&(e===Up.AudioSource&&xe()&&console.warn("VideoAudioOutputMode.AudioSource is not yet implemented"),this._audioOutputMode=e,this.updateVideoElementSettings())}get audioOutputMode(){return this._audioOutputMode}preloadVideo(){sn&&console.log("Video Preload: "+this.name,this.clip),this.create(!1)}preload(){this.preloadVideo()}setVideo(e){this.clip=e,this.source=rl.VideoClip,this._videoElement?(this._videoElement.srcObject=e,this._isPlaying&&this.play(),this.updateAspect()):this.create(this.playOnAwake)}setClipURL(e){this._url!==e&&(this._url=e,this.source=rl.Url,sn&&console.log("set url",e),this._videoElement?e.endsWith(".m3u8")||e.includes(".m3u")?this.ensureM3UCanBePlayed():(this._videoElement.src=e,this._isPlaying&&(this.stop(),this.play())):this.create(this.playOnAwake))}onEnable(){var e,i;sn&&console.log("VideoPlayer.onEnable",rl[this.source],this.clip,this.url,this),window.addEventListener("visibilitychange",this.visibilityChanged),this.playOnAwake===!0?this.create(!0):this.preloadVideo(),this.screenspace?(e=this._overlay)==null||e.start():(i=this._overlay)==null||i.stop()}onDisable(){var e;window.removeEventListener("visibilitychange",this.visibilityChanged),(e=this._overlay)==null||e.stop(),this.pause()}onDestroy(){var e;this._videoElement&&((e=this.videoElement)==null||e.remove(),this._videoElement=null),this._videoTexture&&(this._videoTexture.dispose(),this._videoTexture=null)}play(){var e,i;if(this._videoElement||this.create(!1),!this._videoElement){sn&&console.warn("Can not play: no video element found",this);return}if(!(this._isPlaying&&!((e=this._videoElement)!=null&&e.ended)&&!((i=this._videoElement)!=null&&i.paused))){if(this._isPlaying=!0,this._receivedInput||(this._videoElement.muted=!0),this.handleBeginPlaying(!1),this.shouldUseM3U){this.ensureM3UCanBePlayed();return}sn&&console.log("Video Play()",this.clip,this._videoElement,this.time),this._videoElement.currentTime=this.time,this._videoElement.play().catch(s=>{var r;console.log(s),sn&&console.error("Error playing video",s,"CODE="+s.code,(r=this.videoElement)==null?void 0:r.src,this),setTimeout(()=>{this._isPlaying&&!this.destroyed&&this.activeAndEnabled&&this.play()},1e3)}),sn&&console.log("play",this._videoElement,this.time)}}stop(){this._isPlaying=!1,this.time=0,this._videoElement&&(this._videoElement.currentTime=0,this._videoElement.pause(),sn&&console.log("STOP",this))}pause(){var e,i;this.time=((e=this._videoElement)==null?void 0:e.currentTime)??0,this._isPlaying=!1,(i=this._videoElement)==null||i.pause(),sn&&console.log("PAUSE",this,this.currentTime)}create(e){let i;switch(this.source){case rl.VideoClip:i=this.clip;break;case rl.Url:i=this.url,!(i!=null&&i.length)&&typeof this.clip=="string"&&(i=this.clip);break}return i?(this._videoElement||(sn&&console.warn("Create VideoElement",this),this._videoElement=this.createVideoElement(),this.context.domElement.shadowRoot.prepend(this._videoElement),this.updateVideoElementStyles()),typeof i=="string"?(sn&&console.log("Set Video src",i),this._videoElement.src=i):(sn&&console.log("Set Video srcObject",i),this._videoElement.srcObject=i),this._videoTexture||(this._videoTexture=new Z2(this._videoElement)),this._videoTexture.flipY=!1,this._videoTexture.colorSpace=Ue,e&&this.handleBeginPlaying(e),sn&&console.log("Video: handle playing done...",i,e),!0):(sn&&console.warn("No video source set",this),!1)}updateAspect(){this.aspectMode!==fc.None&&this.startCoroutine(this.updateAspectImpl())}get screenspace(){var e;return((e=this._overlay)==null?void 0:e.enabled)??!1}set screenspace(e){var i;if(e){if(!this._videoTexture)return;this._overlay||(this._overlay=new ZW(this.context)),this._overlay.add(this._videoTexture)}else(i=this._overlay)==null||i.remove(this._videoTexture);this._overlay&&(this._overlay.enabled=e)}createVideoElement(){const e=document.createElement("video");return this._crossOrigin&&e.setAttribute("crossorigin",this._crossOrigin),sn&&console.log("created video element",e),e}handleBeginPlaying(e){var r,o;if(!this.activeAndEnabled||!this._videoElement)return;this._targetObjects.length=0;let i=this.gameObject;switch(this.renderMode){case Np.MaterialOverride:i=(r=this.targetMaterialRenderer)==null?void 0:r.gameObject,i||(i=(o=z.getComponent(this.gameObject,ci))==null?void 0:o.gameObject);break;case Np.RenderTexture:console.error("VideoPlayer renderTexture not implemented yet. Please use material override instead");return}if(!i){console.error("Missing target for video material renderer",this.name,Np[this.renderMode],this);return}const s=i.material;if(s){this._targetObjects.push(i),s!==this._videoMaterial&&(this._videoMaterial=s.clone(),i.material=this._videoMaterial);const a="map",l=this._videoMaterial;if(!this.targetMaterialProperty)l[a]=this._videoTexture;else switch(this.targetMaterialProperty){default:l[a]=this._videoTexture;break}}else{console.warn("Can not play video, no material found, this might be a multimaterial case which is not supported yet");return}this.updateVideoElementSettings(),this.updateVideoElementStyles(),e&&(this.shouldUseM3U&&this.ensureM3UCanBePlayed(),this.play())}updateVideoElementSettings(){if(!this._videoElement)return;this._videoElement.loop=this._isLooping,this._videoElement.currentTime=this.currentTime,this._videoElement.playbackRate=this._playbackSpeed,this._videoElement.playsInline=!0;let e=!this._receivedInput||this.audioOutputMode===Up.None;!e&&this._muted&&(e=!0),this._videoElement.muted=e,this.playOnAwake&&(this._videoElement.autoplay=!0)}updateVideoElementStyles(){this._videoElement&&(this._videoElement.style.userSelect="none",this._videoElement.style.visibility="hidden",this._videoElement.style.display="none",this.updateAspect())}*updateAspectImpl(){const e=++this._updateAspectRoutineId,i=void 0,s=this.clip;for(;e===this._updateAspectRoutineId&&this.aspectMode!==fc.None&&this.clip&&s===this.clip&&this._isPlaying;){if(!s||typeof s=="string")return;let r;for(const o of s.getVideoTracks()){const a=o.getSettings();if(a&&a.width&&a.height){r=a.width/a.height;break}else r=this.context.renderer.domElement.clientWidth/this.context.renderer.domElement.clientHeight}if(r===void 0){for(let o=0;o<10;o++)yield;if(!this.isPlaying)break;continue}if(i===r){yield;continue}for(const o of this._targetObjects){let a=1;if(o.parent){const l=ai(o.parent);a=l.x/l.y}switch(this.aspectMode){case fc.AdjustHeight:o.scale.y=1/r*o.scale.x*a;break;case fc.AdjustWidth:o.scale.x=r*o.scale.y*a;break}}for(let o=0;o<3;o++)yield}}get shouldUseM3U(){return this.url!=null&&(this.url.endsWith(".m3u8")||this.url.endsWith(".m3u"))&&this.source===rl.Url}ensureM3UCanBePlayed(){if(!this.shouldUseM3U)return;let e=document.head.querySelector("script[data-hls_library]");e?globalThis.Hls?this.onHlsAvailable():e.addEventListener("load",this.onHlsAvailable):(sn&&console.log("HLS: load script"),e=document.createElement("script"),e.dataset.hls_library="hls.js",e.src="https://cdn.jsdelivr.net/npm/hls.js@1",e.addEventListener("load",this.onHlsAvailable),document.head.append(e))}}Cr([A()],pn.prototype,"playOnAwake",void 0);Cr([A()],pn.prototype,"aspectMode",void 0);Cr([A(URL)],pn.prototype,"clip",void 0);Cr([A()],pn.prototype,"source",void 0);Cr([A(URL)],pn.prototype,"url",null);Cr([A()],pn.prototype,"renderMode",void 0);Cr([A()],pn.prototype,"targetMaterialProperty",void 0);Cr([A(ci)],pn.prototype,"targetMaterialRenderer",void 0);Cr([A(pt)],pn.prototype,"targetTexture",void 0);Cr([A()],pn.prototype,"time",void 0);Cr([A()],pn.prototype,"playbackSpeed",null);Cr([A()],pn.prototype,"isLooping",null);Cr([A()],pn.prototype,"audioOutputMode",null);class ZW{constructor(t){c(this,"context");c(this,"_videos",[]);c(this,"_screenspaceModeQuad");c(this,"_isInScreenspaceMode",!1);c(this,"_input");this.context=t,this._input=new $W(this)}get enabled(){return this._isInScreenspaceMode}set enabled(t){t?this.start():this.stop()}add(t){this._videos.indexOf(t)===-1&&this._videos.push(t)}remove(t){if(!t)return;const e=this._videos.indexOf(t);e>=0&&this._videos.splice(e,1)}start(){var s;if(this._isInScreenspaceMode||this._videos.length<0)return;const t=this._videos[this._videos.length-1];if(!t)return;if(this._isInScreenspaceMode=!0,!this._screenspaceModeQuad){if(this._screenspaceModeQuad=Py.createPrimitive(Da.Quad,{material:new e7(t)}),!this._screenspaceModeQuad)return;this._screenspaceModeQuad.geometry.scale(2,2,2)}const e=this._screenspaceModeQuad;this.context.scene.add(e),this.updateScreenspaceMaterialUniforms();const i=e.material;i==null||i.reset(),(s=this._input)==null||s.enable(i)}stop(){var t;this._isInScreenspaceMode=!1,this._screenspaceModeQuad&&((t=this._input)==null||t.disable(),this._screenspaceModeQuad.removeFromParent())}updateScreenspaceMaterialUniforms(){var e;const t=(e=this._screenspaceModeQuad)==null?void 0:e.material;t&&(t.screenAspect=this.context.domElement.clientWidth/this.context.domElement.clientHeight)}}class $W{constructor(t){c(this,"_onResizeScreenFn");c(this,"_onKeyUpFn");c(this,"_onMouseWheelFn");c(this,"context");c(this,"overlay");c(this,"_material");c(this,"_isPinching",!1);c(this,"_lastPinch",0);this.overlay=t,this.context=t.context}enable(t){this._material=t,window.addEventListener("resize",this._onResizeScreenFn=()=>{this.overlay.updateScreenspaceMaterialUniforms()}),window.addEventListener("keyup",this._onKeyUpFn=s=>{s.key==="Escape"&&this.overlay.stop()}),window.addEventListener("wheel",this._onMouseWheelFn=s=>{this.overlay.enabled&&(t.zoom+=s.deltaY*5e-4,s.preventDefault())},{passive:!1});const e=new ae;window.addEventListener("mousemove",s=>{if(this.overlay.enabled&&this.context.input.getPointerPressed(0)){const r=new ae(s.movementX,s.movementY);r.x/=this.context.domElement.clientWidth,r.y/=this.context.domElement.clientHeight,e.set(r.x,r.y),e.multiplyScalar(t.zoom/-this.context.time.deltaTime*.01),t.offset=t.offset.add(e)}}),window.addEventListener("pointermove",s=>{this.overlay.enabled&&this.context.input.getPointerPressed(0)&&this.context.input.getTouchesPressedCount()===1&&(e.set(s.movementX,s.movementY),e.multiplyScalar(t.zoom*-this.context.time.deltaTime*.05),t.offset=t.offset.add(e))});let i=0;window.addEventListener("touchstart",s=>{if(s.touches.length<2){this.context.time.time-i<.3&&this.overlay.stop(),i=this.context.time.time;return}this._isPinching=!0,this._lastPinch=0}),window.addEventListener("touchmove",s=>{if(!this._isPinching||!this._material)return;const r=s.touches[0],o=s.touches[1],a=r.clientX-o.clientX,l=r.clientY-o.clientY,h=Math.sqrt(a*a+l*l);if(this._lastPinch!==0){const u=h-this._lastPinch;this._material.zoom-=u*.004}this._lastPinch=h}),window.addEventListener("touchend",()=>{this._isPinching=!1})}disable(){this._onResizeScreenFn&&(window.removeEventListener("resize",this._onResizeScreenFn),this._onResizeScreenFn=void 0),this._onKeyUpFn&&(window.removeEventListener("keyup",this._onKeyUpFn),this._onKeyUpFn=void 0),this._onMouseWheelFn&&(window.removeEventListener("wheel",this._onMouseWheelFn),this._onMouseWheelFn=void 0)}}class e7 extends $e{constructor(e){super();c(this,"_offset",new ae);this.uniforms={map:{value:e},screenAspect:{value:1},offsetScale:{value:new ke(0,0,1,1)}},this.vertexShader=`
        uniform sampler2D map;
        uniform float screenAspect;
        uniform vec4 offsetScale;
        varying vec2 vUv;

        void main() {

            gl_Position = vec4( position , 1.0 );
            vUv = uv;
            vUv.y = 1. - vUv.y;

            // fit into screen
            ivec2 res = textureSize(map, 0);
            float videoAspect = float(res.x) / float(res.y);
            float aspect = videoAspect / screenAspect;
            if(aspect >= 1.0) 
            {
                vUv.y = vUv.y * aspect;
                float offset = (1. - aspect) * .5;
                vUv.y = vUv.y + offset;
            }
            else
            {
                vUv.x = vUv.x / aspect;
                float offset = (1. - 1. / aspect) * .5;
                vUv.x = vUv.x + offset;
            }

            vUv.x -= .5;
            vUv.y -= .5;

            vUv.x *= offsetScale.z;
            vUv.y *= offsetScale.z;
            vUv.x += offsetScale.x;
            vUv.y += offsetScale.y;

            vUv.x += .5;
            vUv.y += .5;
        }

        `,this.fragmentShader=`
        uniform sampler2D map;
        varying vec2 vUv;
        void main() {
            if(vUv.x < 0. || vUv.x > 1. || vUv.y < 0. || vUv.y > 1.)
                gl_FragColor = vec4(0., 0., 0., 1.);
            else
            {
                vec4 texcolor = texture2D(map, vUv);
                texcolor = LinearTosRGB(texcolor);
                gl_FragColor = texcolor;
            }
        }
        `}set screenAspect(e){this.uniforms.screenAspect.value=e,this.needsUpdate=!0}set offset(e){const i=this.uniforms.offsetScale.value;i.x=e.x,i.y=e.y,this.uniforms.offsetScale.value=i,this.needsUpdate=!0}get offset(){const e=this.uniforms.offsetScale.value;return this._offset.set(e.x,e.y),this._offset}set zoom(e){const i=this.uniforms.offsetScale.value;e<.001&&(e=.001),i.z=e,this.needsUpdate=!0}get zoom(){return this.uniforms.offsetScale.value.z}reset(){this.offset=this.offset.set(0,0),this.zoom=1,this.needsUpdate=!0}}var cm=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};const xn=N("debugscreensharing");var ex;(function(n){n[n.Screen=0]="Screen",n[n.Camera=1]="Camera",n[n.Canvas=2]="Canvas",n[n.Microphone=3]="Microphone"})(ex||(ex={}));var or;(function(n){n[n.Idle=0]="Idle",n[n.Sending=1]="Sending",n[n.Receiving=2]="Receiving"})(or||(or={}));class lu extends se{constructor(){super(...arguments);c(this,"allowStartOnClick",!0);c(this,"autoConnect",!1);c(this,"_videoPlayer");c(this,"_audioSource");c(this,"device","Screen");c(this,"deviceName");c(this,"deviceFilter");c(this,"_net");c(this,"_requestOpen",!1);c(this,"_currentStream",null);c(this,"_currentMode",or.Idle);c(this,"onJoinedRoom",async()=>{await El(1e3),this.autoConnect&&!this.isSending&&!this.isReceiving&&this.context.connection.isInRoom&&this.share()});c(this,"_activeShareRequest",null);c(this,"onReceiveStream",e=>{var i;((i=e.stream)==null?void 0:i.active)===!0&&this.setStream(e.stream,or.Receiving)});c(this,"onCallEnded",e=>{xn&&console.log("CALL ENDED",this.isReceiving,this==null?void 0:this.screenspace),this.isReceiving&&(this.screenspace=!1)})}onPointerEnter(){this.context.connection.allowEditing!=!1&&this.allowStartOnClick&&this.context.input.setCursorPointer()}onPointerExit(){this.context.connection.allowEditing!=!1&&this.allowStartOnClick&&this.context.input.setCursorNormal()}onPointerClick(e){var i;if(this.context.connection.allowEditing!=!1&&this.allowStartOnClick&&!(e&&e.pointerId!==0)){if(this.isReceiving&&((i=this.videoPlayer)!=null&&i.isPlaying)){this.videoPlayer&&(this.videoPlayer.screenspace=!this.videoPlayer.screenspace);return}if(this.isSending){this.close();return}this.share()}}set videoPlayer(e){this._videoPlayer&&(this.isSending||this.isReceiving)&&this._videoPlayer.stop(),this._videoPlayer=e,this._videoPlayer&&this._currentStream&&(this.isSending||this.isReceiving)&&this._videoPlayer.setVideo(this._currentStream)}get videoPlayer(){return this._videoPlayer}get screenspace(){var e;return((e=this.videoPlayer)==null?void 0:e.screenspace)??!1}set screenspace(e){this.videoPlayer&&(this.videoPlayer.screenspace=e)}get currentScream(){return this._currentStream}get currentMode(){return this._currentMode}get isSending(){var e;return((e=this._currentStream)==null?void 0:e.active)&&this._currentMode===or.Sending}get isReceiving(){if(this._currentMode===or.Receiving){if(!this._currentStream||this._currentStream.active===!1)return!1;const e=this._currentStream.getTracks();for(const i of e)if(i.readyState==="live")return!0}return!1}get requiresVideoPlayer(){return this.device!=="Microphone"}awake(){typeof this.device=="number"&&(this.device=ex[this.device]),xn&&console.log("Screensharing",this.name,this),kt.registerWaitForAllowAudio(()=>{this._videoPlayer&&this._currentStream&&this._currentMode===or.Receiving&&(this._videoPlayer.playInBackground=!0,this._videoPlayer.setVideo(this._currentStream))});const e=Bp.getOrCreate(this.context,this.guid);this._net=new Xy(this.context,e)}onEnable(){var e,i,s;(e=this._net)==null||e.enable(),(i=this._net)==null||i.addEventListener(xi.StreamReceived,this.onReceiveStream),(s=this._net)==null||s.addEventListener(xi.StreamEnded,this.onCallEnded),this.context.connection.beginListen(Ye.JoinedRoom,this.onJoinedRoom),this.autoConnect&&El(1e3).then(()=>(this.enabled&&this.autoConnect&&!this.isReceiving&&!this.isSending&&this.context.connection.isInRoom&&this.share(),0))}onDisable(){var e,i,s;(e=this._net)==null||e.removeEventListener(xi.StreamReceived,this.onReceiveStream),(i=this._net)==null||i.removeEventListener(xi.StreamEnded,this.onCallEnded),this.context.connection.stopListen(Ye.JoinedRoom,this.onJoinedRoom),(s=this._net)==null||s.disable(),this.close()}_ensureVideoPlayer(){const e=new pn;e.aspectMode=fc.AdjustWidth,z.addComponent(this.gameObject,e),this._videoPlayer=e}async share(e){return this._activeShareRequest?this._activeShareRequest:(this._activeShareRequest=this.internalShare(e),this._activeShareRequest.then(()=>this._activeShareRequest=null))}async internalShare(e){if(this.context.connection.isInRoom===!1){console.warn("Can not start screensharing: requires network connection"),xe()&&Yt("Can not start screensharing: requires network connection. Add a SyncedRoom component or join a room first.");return}if(e!=null&&e.device&&(this.device=e.device),!this.videoPlayer&&this.requiresVideoPlayer&&(this._videoPlayer||(this._videoPlayer=z.getComponent(this.gameObject,pn)??void 0),this.videoPlayer||this._ensureVideoPlayer(),!this.videoPlayer)){console.warn("Can not share video without a videoPlayer assigned");return}this._requestOpen=!0;try{const i=(e==null?void 0:e.constraints)??{echoCancellation:!0,autoGainControl:!1},s={video:i,audio:i},r=s.video;switch(r!==void 0&&typeof r!="boolean"&&(r.width||(r.width={max:1920}),r.height||(r.height={max:1920}),r.aspectRatio||(r.aspectRatio={ideal:1.7777777778}),r.frameRate||(r.frameRate={ideal:24}),r.facingMode||(r.facingMode={ideal:"user"})),this.device){case"Camera":this.tryShareUserCamera(s,e);break;case"Screen":{if(!navigator.mediaDevices.getDisplayMedia){console.error("No getDisplayMedia support");return}const l=await navigator.mediaDevices.getDisplayMedia(s);this._requestOpen?this.setStream(l,or.Sending):_c(l)}break;case"Canvas":const o=0,a=this.context.renderer.domElement.captureStream(o);this.setStream(a,or.Sending);break;case"Microphone":{if(!navigator.mediaDevices.getUserMedia){console.error("No getDisplayMedia support");return}s.video=!1;const l=await navigator.mediaDevices.getUserMedia(s);this._requestOpen?this.setStream(l,or.Sending):_c(l)}break;default:console.error("Can not start screen sharing: Unknown device type",this.device)}}catch(i){if(i.name==="NotAllowedError"){console.log("Selection cancelled"),this._requestOpen=!1;return}console.error("Error opening video",i)}}close(){var e;this._requestOpen=!1,this._currentStream&&(xn&&console.warn("Close current stream / disposing resources, stream was active?",this._currentStream.active),(e=this._net)==null||e.stopSendingStream(this._currentStream),_c(this._currentStream),this._currentMode=or.Idle,this._currentStream=null)}setStream(e,i){var o,a,l;if(e===this._currentStream||(this.close(),!e))return;this._currentStream=e,this._requestOpen=!0,this._currentMode=i;const s=this.device!=="Microphone",r=i===or.Sending;s?(this._videoPlayer||this._ensureVideoPlayer(),this._videoPlayer?this._videoPlayer.setVideo(e):console.error("No video player assigned for video stream")):(this._audioSource||(this._audioSource=new kt,this._audioSource.spatialBlend=0,this._audioSource.volume=1,this.gameObject.addComponent(this._audioSource)),r||(xn&&console.log("PLAY",e.getAudioTracks()),this._audioSource.volume=1,(o=this._audioSource)==null||o.play(e))),r&&((a=this._net)==null||a.startSendingStream(e)),r&&(this._videoPlayer&&(this._videoPlayer.muted=!0),(l=this._audioSource)==null||l.stop());for(const h of e.getTracks())h.addEventListener("ended",()=>{xn&&console.log("Track ended",h),this.close()}),xn&&h.kind==="video"&&console.log(r?"Video â†’":"Video â†",h.getSettings())}async tryShareUserCamera(e,i){const s=(await navigator.mediaDevices.enumerateDevices()).filter(o=>o.kind==="videoinput");xn&&console.log(`Request camera. These are your kind:videoinput devices:
`,s);let r=!1;for(const o of s)try{if(!this._requestOpen){xn&&console.log("Camera selection cancelled");break}if(o.kind!=="videoinput"){xn&&console.log("Skipping non-video device",o);continue}const a=o.deviceId;if((i==null?void 0:i.deviceId)!=null||(i==null?void 0:i.deviceFilter)!=null){if((i==null?void 0:i.deviceId)!==void 0&&a!==i.deviceId){xn&&console.log("Skipping device due to options.deviceId: "+o.label+"; "+o.deviceId);continue}if(i!=null&&i.deviceFilter&&i.deviceFilter(o)===!1){xn&&console.log("Skipping device due to options.deviceFilter: "+o.label+"; "+o.deviceId);continue}}else if(this.deviceFilter)if(this.deviceFilter(o)===!1){xn&&console.log("Skipping device due to ScreenShare.deviceFilter: "+o.label+"; "+o.deviceId);continue}else xn&&console.log("Selected device by filter",o);else if(this.deviceName){const u=o.label.toLowerCase(),d=this.deviceName.toLowerCase(),f=u.includes(d),p=o.deviceId===this.deviceName;if(!f&&!p){xn&&console.log("Skipping device due to ScreenShare.deviceName: "+o.label+"; "+o.deviceId);continue}else xn&&console.log("Selected device by name",o)}e.video!==!1&&((typeof e.video>"u"||typeof e.video=="boolean")&&(e.video={}),e.video.deviceId=a),r=!0;const h=await navigator.mediaDevices.getUserMedia(e).catch(u=>(console.error("Failed to get user media",u),null));if(h===null)continue;this._requestOpen?(this.setStream(h,or.Sending),xn&&console.log("Selected camera",o)):(_c(h),xn&&console.log("Camera selection cancelled"));break}catch(a){if(a.message==="Failed to allocate videosource"||a.message==="Could not start video source"){Yt("Failed to start video: Try another camera (Code "+a.code+")"),console.warn(a);continue}else console.error("Failed to get user media",a.message,a.code,a)}!r&&xe()&&(Yt("No camera found for sharing. Please connect a camera (see console for more information)"),console.warn("No camera found for sharing. Please connect a camera",s,this.deviceName,"Using deviceFilter? "+this.deviceFilter!=null,"Using options? "+i!=null,"Using deviceName? "+this.deviceName!=null,"Using options.deviceId? "+(i==null?void 0:i.deviceId)!=null,"Using options.deviceFilter? "+(i==null?void 0:i.deviceFilter)!=null))}}cm([A()],lu.prototype,"allowStartOnClick",void 0);cm([A()],lu.prototype,"autoConnect",void 0);cm([A(pn)],lu.prototype,"videoPlayer",null);cm([A()],lu.prototype,"device",void 0);cm([A()],lu.prototype,"deviceName",void 0);var hm=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};class Wc extends Ds{constructor(){super(...arguments);c(this,"intensity");c(this,"falloff");c(this,"samples");c(this,"color");c(this,"luminanceInfluence");c(this,"_ssao")}get typeName(){return"ScreenSpaceAmbientOcclusion"}onBeforeRender(){if(this._ssao&&this.context.mainCamera instanceof xt){const e=this.context.mainCamera.far-this.context.mainCamera.near;this._ssao.ssaoMaterial.worldDistanceFalloff=e*.01,this._ssao.ssaoMaterial.worldDistanceThreshold=this.context.mainCamera.far}}onCreateEffect(){const e=this.context.mainCamera,i=new LM(this.context.scene,e),s=new rC({normalBuffer:i.texture,resolutionScale:.5}),r=this._ssao=new DM(e,i.texture,{normalDepthBuffer:s.texture,worldDistanceThreshold:1,worldDistanceFalloff:1,worldProximityThreshold:.1,worldProximityFalloff:2,intensity:1,blendFunction:Xe.MULTIPLY,luminanceInfluence:.5});this.intensity.onValueChanged=a=>{r.intensity=a},this.falloff.onValueChanged=a=>{r.ssaoMaterial.radius=a*.1},this.samples.onValueChanged=a=>{r.samples=a},this.color.onValueChanged=a=>{r.color||(r.color=new we),r.color.copy(a)},this.luminanceInfluence.onValueChanged=a=>{r.luminanceInfluence=a};const o=new Array;return o.push(i),o.push(s),o.push(r),o}}hm([A(je)],Wc.prototype,"intensity",void 0);hm([A(je)],Wc.prototype,"falloff",void 0);hm([A(je)],Wc.prototype,"samples",void 0);hm([A(je)],Wc.prototype,"color",void 0);hm([A(je)],Wc.prototype,"luminanceInfluence",void 0);zo("ScreenSpaceAmbientOcclusion",Wc);var cu=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r},Qp;(function(n){n[n.Performance=0]="Performance",n[n.Low=1]="Low",n[n.Medium=2]="Medium",n[n.High=3]="High",n[n.Ultra=4]="Ultra"})(Qp||(Qp={}));class Wa extends Ds{constructor(){super(...arguments);c(this,"gammaCorrection",!0);c(this,"intensity");c(this,"falloff");c(this,"aoRadius");c(this,"screenspaceRadius",!1);c(this,"color");c(this,"quality",Qp.Medium);c(this,"_ssao")}get typeName(){return"ScreenSpaceAmbientOcclusionN8"}onValidate(){this._ssao&&(this._ssao.setQualityMode(Qp[this.quality]),this._ssao.configuration.gammaCorrection=this.gammaCorrection,this._ssao.configuration.screenSpaceRadius=this.screenspaceRadius)}onCreateEffect(){const e=this.context.mainCamera,i=this._ssao=new Sk(this.context.scene,e,this.context.domWidth,this.context.domHeight),s=Qp[this.quality];i.setQualityMode(s),i.configuration.gammaCorrection=this.gammaCorrection,i.configuration.screenSpaceRadius=this.screenspaceRadius,this.intensity.onValueChanged=o=>{i.configuration.intensity=o},this.falloff.onValueChanged=o=>{i.configuration.distanceFalloff=o},this.aoRadius.onValueChanged=o=>{i.configuration.aoRadius=o},this.color.onValueChanged=o=>{i.color||(i.color=new we),i.configuration.color.copy(o)};const r=new Array;return r.push(i),r}}cu([as(),A()],Wa.prototype,"gammaCorrection",void 0);cu([A(je)],Wa.prototype,"intensity",void 0);cu([A(je)],Wa.prototype,"falloff",void 0);cu([A(je)],Wa.prototype,"aoRadius",void 0);cu([as(),A()],Wa.prototype,"screenspaceRadius",void 0);cu([A(je)],Wa.prototype,"color",void 0);cu([as(),A()],Wa.prototype,"quality",void 0);zo("ScreenSpaceAmbientOcclusionN8",Wa);var nO=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r},sd;(function(n){n[n.ShadowMask=0]="ShadowMask",n[n.Additive=1]="Additive",n[n.Occluder=2]="Occluder"})(sd||(sd={}));class E0 extends se{constructor(){super(...arguments);c(this,"mode",sd.ShadowMask);c(this,"shadowColor",new Ot(0,0,0,1));c(this,"targetMesh")}start(){if(this.gameObject instanceof J)this.gameObject instanceof J&&this.gameObject.material&&(this.gameObject.material=this.gameObject.material.clone(),this.targetMesh=this.gameObject);else{const e=Py.createPrimitive(Da.Quad,{name:"ShadowCatcher",material:new mr({color:10066329,roughness:1,metalness:0,transparent:!0})});e.receiveShadow=!0,e.geometry.rotateX(-Math.PI/2),this.gameObject.add(e),this.targetMesh=e}if(!this.targetMesh){console.warn("ShadowCatcher: no mesh to apply shadow catching to. Groups are currently not supported.");return}switch(this.targetMesh.layers.set(2),this.mode){case sd.ShadowMask:this.applyShadowMaterial();break;case sd.Additive:this.applyLightBlendMaterial();break;case sd.Occluder:this.applyOccluderMaterial();break}}applyLightBlendMaterial(){if(!this.targetMesh)return;const e=this.targetMesh.material;e.blending=cy,this.applyMaterialOptions(e),e.onBeforeCompile=i=>{i.fragmentShader=i.fragmentShader.replace("vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;",`vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
            // diffuse-only lighting with overdrive to somewhat compensate
            // for the loss of indirect lighting and to make it more visible.
            vec3 direct = (reflectedLight.directDiffuse + reflectedLight.directSpecular) * 6.6;
            float max = max(direct.r, max(direct.g, direct.b));
            
            // early out - we're simply returning direct lighting and some alpha based on it so it can 
            // be blended onto the scene.
            gl_FragColor = vec4(direct, max);
            return;
            `)}}applyShadowMaterial(){if(this.targetMesh)if(this.targetMesh.material.type!=="ShadowMaterial"){const e=new IR;e.color=this.shadowColor,e.opacity=this.shadowColor.alpha,this.applyMaterialOptions(e),this.targetMesh.material=e}else{const e=this.targetMesh.material;e.color=this.shadowColor,e.opacity=this.shadowColor.alpha,this.applyMaterialOptions(e)}}applyOccluderMaterial(){if(this.targetMesh){let e=this.targetMesh.material;if(!e){const i=new St;this.targetMesh.material=i,e=i}e.depthWrite=!0,e.stencilWrite=!0,e.colorWrite=!1,this.gameObject.renderOrder=-100}}applyMaterialOptions(e){e&&(e.depthWrite=!1,e.stencilWrite=!1)}}nO([A()],E0.prototype,"mode",void 0);nO([A(Ot)],E0.prototype,"shadowColor",void 0);var I0=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};const NS=class extends se{constructor(){super(...arguments);c(this,"target",null);c(this,"followFactor",.1);c(this,"rotateFactor",.1);c(this,"positionAxes",Yu.All);c(this,"flipForward",!1);c(this,"_firstUpdate",!0)}onBeforeRender(){this.updateNow(!1)}updateNow(e){if(!(!this.target||this.target===this.gameObject)){if(this.followFactor>0){const i=qe(this.target),s=this._firstUpdate||e?1:Ae.clamp01(this.context.time.deltaTime*this.followFactor),r=this.worldPosition;this.positionAxes&Yu.X&&(r.x=Ae.lerp(r.x,i.x,s)),this.positionAxes&Yu.Y&&(r.y=Ae.lerp(r.y,i.y,s)),this.positionAxes&Yu.Z&&(r.z=Ae.lerp(r.z,i.z,s)),this.worldPosition=r}if(this.rotateFactor>0){const i=Nt(this.target);this.flipForward&&i.premultiply(NS._invertForward);const s=this._firstUpdate||e?1:Ae.clamp01(this.context.time.deltaTime*this.rotateFactor);this.worldQuaternion=this.worldQuaternion.slerp(i,s)}this._firstUpdate=!1}}};let ka=NS;c(ka,"_invertForward",new ne().setFromAxisAngle(new C(0,1,0),Math.PI));I0([A(re)],ka.prototype,"target",void 0);I0([A()],ka.prototype,"followFactor",void 0);I0([A()],ka.prototype,"rotateFactor",void 0);I0([A()],ka.prototype,"positionAxes",void 0);class t7 extends J{constructor(t){const e=new i7(t),i=new Ys(e.image.width*.001,e.image.height*.001),s=new St({map:e,toneMapped:!1,transparent:!0});super(i,s);function r(o){s.map.dispatchDOMEvent(o)}this.addEventListener("mousedown",r),this.addEventListener("mousemove",r),this.addEventListener("mouseup",r),this.addEventListener("click",r),this.dispose=function(){i.dispose(),s.dispose(),s.map.dispose(),tx.delete(t),this.removeEventListener("mousedown",r),this.removeEventListener("mousemove",r),this.removeEventListener("mouseup",r),this.removeEventListener("click",r)}}}class i7 extends tB{constructor(t){super(aR(t)),this.dom=t,this.anisotropy=16,this.colorSpace=Ue,this.minFilter=Tt,this.magFilter=Tt;const e=new MutationObserver(()=>{this.scheduleUpdate||(this.scheduleUpdate=setTimeout(()=>this.update(),16))}),i={attributes:!0,childList:!0,subtree:!0,characterData:!0};e.observe(t,i),this.observer=e}dispatchDOMEvent(t){t.data&&n7(this.dom,t.type,t.data.x,t.data.y)}update(){this.image=aR(this.dom),this.needsUpdate=!0,this.scheduleUpdate=null}dispose(){this.observer&&this.observer.disconnect(),this.scheduleUpdate=clearTimeout(this.scheduleUpdate),super.dispose()}}const tx=new WeakMap;function aR(n){const t=document.createRange(),e=new we;function i(f){const p=[];let g=!1;function m(){if(g&&(g=!1,f.restore()),p.length===0)return;let v=-1/0,y=-1/0,b=1/0,_=1/0;for(let x=0;x<p.length;x++){const S=p[x];v=Math.max(v,S.x),y=Math.max(y,S.y),b=Math.min(b,S.x+S.width),_=Math.min(_,S.y+S.height)}f.save(),f.beginPath(),f.rect(v,y,b-v,_-y),f.clip(),g=!0}return{add:function(v){p.push(v),m()},remove:function(){p.pop(),m()}}}function s(f,p,g,m){m!==""&&(f.textTransform==="uppercase"&&(m=m.toUpperCase()),u.font=f.fontWeight+" "+f.fontSize+" "+f.fontFamily,u.textBaseline="top",u.fillStyle=f.color,u.fillText(m,p,g+parseFloat(f.fontSize)*.1))}function r(f,p,g,m,v){g<2*v&&(v=g/2),m<2*v&&(v=m/2),u.beginPath(),u.moveTo(f+v,p),u.arcTo(f+g,p,f+g,p+m,v),u.arcTo(f+g,p+m,f,p+m,v),u.arcTo(f,p+m,f,p,v),u.arcTo(f,p,f+g,p,v),u.closePath()}function o(f,p,g,m,v,y){const b=f[p+"Width"],_=f[p+"Style"],x=f[p+"Color"];b!=="0px"&&_!=="none"&&x!=="transparent"&&x!=="rgba(0, 0, 0, 0)"&&(u.strokeStyle=x,u.lineWidth=parseFloat(b),u.beginPath(),u.moveTo(g,m),u.lineTo(g+v,m+y),u.stroke())}function a(f,p){let g=0,m=0,v=0,y=0;if(f.nodeType===Node.TEXT_NODE){t.selectNode(f);const _=t.getBoundingClientRect();g=_.left-l.left-.5,m=_.top-l.top-.5,v=_.width,y=_.height,s(p,g,m,f.nodeValue.trim())}else{if(f.nodeType===Node.COMMENT_NODE)return;if(f instanceof HTMLCanvasElement){if(f.style.display==="none")return;const _=f.getBoundingClientRect();g=_.left-l.left-.5,m=_.top-l.top-.5,u.save();const x=window.devicePixelRatio;u.scale(1/x,1/x),u.drawImage(f,g,m),u.restore()}else if(f instanceof HTMLImageElement){if(f.style.display==="none")return;const _=f.getBoundingClientRect();g=_.left-l.left-.5,m=_.top-l.top-.5,v=_.width,y=_.height,u.drawImage(f,g,m,v,y)}else{if(f.style.display==="none")return;const _=f.getBoundingClientRect();g=_.left-l.left-.5,m=_.top-l.top-.5,v=_.width,y=_.height,p=window.getComputedStyle(f),r(g,m,v,y,parseFloat(p.borderRadius));const x=p.backgroundColor;x!=="transparent"&&x!=="rgba(0, 0, 0, 0)"&&(u.fillStyle=x,u.fill());const S=["borderTop","borderLeft","borderBottom","borderRight"];let T=!0,L=null;for(const I of S){if(L!==null&&(T=p[I+"Width"]===p[L+"Width"]&&p[I+"Color"]===p[L+"Color"]&&p[I+"Style"]===p[L+"Style"]),T===!1)break;L=I}if(T===!0){const I=parseFloat(p.borderTopWidth);p.borderTopWidth!=="0px"&&p.borderTopStyle!=="none"&&p.borderTopColor!=="transparent"&&p.borderTopColor!=="rgba(0, 0, 0, 0)"&&(u.strokeStyle=p.borderTopColor,u.lineWidth=I,u.stroke())}else o(p,"borderTop",g,m,v,0),o(p,"borderLeft",g,m,0,y),o(p,"borderBottom",g,m+y,v,0),o(p,"borderRight",g+v,m,0,y);if(f instanceof HTMLInputElement){let I=p.accentColor;(I===void 0||I==="auto")&&(I=p.color),e.set(I);const R=Math.sqrt(.299*e.r**2+.587*e.g**2+.114*e.b**2)<.5?"white":"#111111";if(f.type==="radio"&&(r(g,m,v,y,y),u.fillStyle="white",u.strokeStyle=I,u.lineWidth=1,u.fill(),u.stroke(),f.checked&&(r(g+2,m+2,v-4,y-4,y),u.fillStyle=I,u.strokeStyle=R,u.lineWidth=2,u.fill(),u.stroke())),f.type==="checkbox"&&(r(g,m,v,y,2),u.fillStyle=f.checked?I:"white",u.strokeStyle=f.checked?R:I,u.lineWidth=1,u.stroke(),u.fill(),f.checked)){const B=u.textAlign;u.textAlign="center";const Q={color:R,fontFamily:p.fontFamily,fontSize:y+"px",fontWeight:"bold"};s(Q,g+v/2,m,"âœ”"),u.textAlign=B}if(f.type==="range"){const[B,Q,G]=["min","max","value"].map(X=>parseFloat(f[X])),V=(G-B)/(Q-B)*(v-y);r(g,m+y/4,v,y/2,y/4),u.fillStyle=R,u.strokeStyle=I,u.lineWidth=1,u.fill(),u.stroke(),r(g,m+y/4,V+y/2,y/2,y/4),u.fillStyle=I,u.fill(),r(g+V,m,y,y,y/2),u.fillStyle=I,u.fill()}(f.type==="color"||f.type==="text"||f.type==="number")&&(d.add({x:g,y:m,width:v,height:y}),s(p,g+parseInt(p.paddingLeft),m+parseInt(p.paddingTop),f.value),d.remove())}}}const b=p.overflow==="auto"||p.overflow==="hidden";b&&d.add({x:g,y:m,width:v,height:y});for(let _=0;_<f.childNodes.length;_++)a(f.childNodes[_],p);b&&d.remove()}const l=n.getBoundingClientRect();let h=tx.get(n);h===void 0&&(h=document.createElement("canvas"),h.width=l.width,h.height=l.height,tx.set(n,h));const u=h.getContext("2d"),d=new i(u);return u.clearRect(0,0,h.width,h.height),a(n),h}function n7(n,t,e,i){const s={clientX:e*n.offsetWidth+n.offsetLeft,clientY:i*n.offsetHeight+n.offsetTop,view:n.ownerDocument.defaultView};window.dispatchEvent(new MouseEvent(t,s));const r=n.getBoundingClientRect();e=e*r.width+r.left,i=i*r.height+r.top;function o(a){if(a.nodeType!==Node.TEXT_NODE&&a.nodeType!==Node.COMMENT_NODE){const l=a.getBoundingClientRect();if(e>l.left&&e<l.right&&i>l.top&&i<l.bottom&&(a.dispatchEvent(new MouseEvent(t,s)),a instanceof HTMLInputElement&&a.type==="range"&&(t==="mousedown"||t==="click"))){const[h,u]=["min","max"].map(g=>parseFloat(a[g])),d=l.width,p=(e-l.x)/d;a.value=h+(u-h)*p,a.dispatchEvent(new InputEvent("input",{bubbles:!0}))}for(let h=0;h<a.childNodes.length;h++)o(a.childNodes[h])}}o(n)}const XA=new ae,Tu={type:"",data:XA},lR=new jd;class s7 extends To{listenToPointerEvents(t,e){const i=this,s=new jd,r=t.domElement;function o(a){a.stopPropagation();const l=t.domElement.getBoundingClientRect();XA.x=(a.clientX-l.left)/l.width*2-1,XA.y=-(a.clientY-l.top)/l.height*2+1,s.setFromCamera(XA,e);const h=s.intersectObjects(i.children,!1);if(h.length>0){const u=h[0],d=u.object,f=u.uv;Tu.type=a.type,Tu.data.set(f.x,1-f.y),d.dispatchEvent(Tu)}}r.addEventListener("pointerdown",o),r.addEventListener("pointerup",o),r.addEventListener("pointermove",o),r.addEventListener("mousedown",o),r.addEventListener("mouseup",o),r.addEventListener("mousemove",o),r.addEventListener("click",o)}listenToXRControllerEvents(t){const e=this,i={move:"mousemove",select:"click",selectstart:"mousedown",selectend:"mouseup"};function s(r){const o=r.target;lR.setFromXRController(o);const a=lR.intersectObjects(e.children,!1);if(a.length>0){const l=a[0],h=l.object,u=l.uv;Tu.type=i[r.type],Tu.data.set(u.x,1-u.y),h.dispatchEvent(Tu)}}t.addEventListener("move",s),t.addEventListener("select",s),t.addEventListener("selectstart",s),t.addEventListener("selectend",s)}}var sO=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};class T0 extends se{constructor(){super(...arguments);c(this,"id",null);c(this,"keepAspect",!1);c(this,"_object",null)}onEnable(){if(this._object){this.gameObject.add(this._object);return}if(!this.id||!this.context.mainCamera)return;const e=document.getElementById(this.id);if(!e){console.warn('Could not find element with id "'+this.id+'"');return}e.style.display="block",e.style.visibility="hidden";const i=new s7;i.listenToPointerEvents(this.context.renderer,this.context.mainCamera),this.gameObject.add(i);const s=new t7(e);i.add(s),s.visible=!1;const r=s.material;r.transparent=!0,setTimeout(()=>{s.visible=!0;const o=vy(this.gameObject).clone();yy(this.gameObject,0,0,0),this.gameObject.updateMatrixWorld();const a=new Nn;a.setFromObject(i),this.setWorldRotation(o.x,o.y,o.z);const l=a.max.x-a.min.x,h=a.max.y-a.min.y;if(this.keepAspect){const d=l/h;l>h?s.scale.set(1/l,1/h/d,1):s.scale.set(1/l*d,1/h,1)}else s.scale.set(1/l,1/h,1);const u=this.gameObject.scale;s.scale.multiply(u)},1)}onDisable(){var e;(e=this._object)==null||e.removeFromParent()}}sO([A()],T0.prototype,"id",void 0);sO([A()],T0.prototype,"keepAspect",void 0);var um=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};const zp=N("debugspatialtrigger"),cR=new $r,hR=new $r;function r7(n,t){return cR.mask=n,hR.mask=t,cR.test(hR)}class Cl extends se{constructor(){super(...arguments);c(this,"triggerMask",0);c(this,"onEnter");c(this,"onStay");c(this,"onExit");c(this,"currentIntersected",[]);c(this,"lastIntersected",[])}start(){zp&&console.log(this.name,this.triggerMask,this)}update(){this.currentIntersected.length=0;for(const e of kh.triggers)r7(e.triggerMask,this.triggerMask)&&e.test(this.gameObject)&&this.currentIntersected.push(e);for(let e=this.lastIntersected.length-1;e>=0;e--){const i=this.lastIntersected[e];this.currentIntersected.indexOf(i)<0&&(this.onExitTrigger(i),this.lastIntersected.splice(e,1))}for(const e of this.currentIntersected)this.lastIntersected.indexOf(e)<0&&this.onEnterTrigger(e),this.onStayTrigger(e);this.lastIntersected.length=0,this.lastIntersected.push(...this.currentIntersected)}onEnterTrigger(e){var i;zp&&console.log("ENTER TRIGGER",this.name,e.name,this,e),e.raiseOnEnterEvent(this),(i=this.onEnter)==null||i.invoke(this,e)}onExitTrigger(e){var i;zp&&console.log("EXIT TRIGGER",this.name,e.name,this,e),e.raiseOnExitEvent(this),(i=this.onExit)==null||i.invoke(this,e)}onStayTrigger(e){var i;e.raiseOnStayEvent(this),(i=this.onStay)==null||i.invoke(this,e)}}um([A()],Cl.prototype,"triggerMask",void 0);um([A(dn)],Cl.prototype,"onEnter",void 0);um([A(dn)],Cl.prototype,"onStay",void 0);um([A(dn)],Cl.prototype,"onExit",void 0);const Jp=class extends se{constructor(){super(...arguments);c(this,"triggerMask");c(this,"boxHelper")}start(){zp&&console.log(this.name,this.triggerMask,this)}onEnable(){var e;Jp.triggers.push(this),this.boxHelper||(this.boxHelper=z.addNewComponent(this.gameObject,So),(e=this.boxHelper)==null||e.showHelper(null,zp))}onDisable(){Jp.triggers.splice(Jp.triggers.indexOf(this),1)}test(e){return this.boxHelper?this.boxHelper.isInBox(e)??!1:!1}raiseOnEnterEvent(e){z.foreachComponent(this.gameObject,i=>{i!==e&&i instanceof Cl&&i.onEnterTrigger(this)},!1)}raiseOnStayEvent(e){z.foreachComponent(this.gameObject,i=>{i!==e&&i instanceof Cl&&i.onStayTrigger(this)},!1)}raiseOnExitEvent(e){z.foreachComponent(this.gameObject,i=>{i!==e&&i instanceof Cl&&i.onExitTrigger(this)},!1)}};let kh=Jp;c(kh,"triggers",[]);um([A()],kh.prototype,"triggerMask",void 0);var o7=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r},Nd;(function(n){n[n.FirstPerson=0]="FirstPerson",n[n.ThirdPerson=1]="ThirdPerson"})(Nd||(Nd={}));const dr=N("debugspectator");class gS extends se{constructor(){super(...arguments);c(this,"cam",null);c(this,"useKeys",!0);c(this,"_mode",Nd.FirstPerson);c(this,"orbit",null);c(this,"_handler");c(this,"eventSub_WebXRRequestStartEvent",null);c(this,"eventSub_WebXRStartEvent",null);c(this,"eventSub_WebXREndEvent",null);c(this,"_debug");c(this,"_networking")}get mode(){return this._mode}set mode(e){this._mode=e}get isSpectating(){var e;return((e=this._handler)==null?void 0:e.currentTarget)!==void 0}isSpectatingUser(e){var i;return((i=this.target)==null?void 0:i.userId)===e}isFollowedBy(e){var i;return(i=this.followers)==null?void 0:i.includes(e)}get followers(){return this._networking.followers}stopSpectating(){if(this.context.isInXR){this.followSelf();return}this.target=void 0}get localId(){return this.context.connection.connectionId??"local"}set target(e){var i;if(this._handler){const s=(i=this._handler.currentTarget)==null?void 0:i.userId,r=this.context.players.getPlayerView(this.localId);e===void 0||this.context.isInXR===!1&&(r==null?void 0:r.currentObject)===e.currentObject?this._handler.currentTarget!==void 0&&(this._handler.disable(),z.setActive(this.gameObject,!1),this.orbit&&(this.orbit.enabled=!0),this._networking.onSpectatedObjectChanged(e,s)):this._handler.currentTarget!==e&&(this._handler.set(e),z.setActive(this.gameObject,!0),this.orbit&&(this.orbit.enabled=!1),this._networking.onSpectatedObjectChanged(e,s))}}get target(){var e;return(e=this._handler)==null?void 0:e.currentTarget}requestAllFollowMe(){this._networking.onRequestFollowMe()}get isSpectatingSelf(){var e,i;return this.isSpectating&&((e=this.target)==null?void 0:e.currentObject)===((i=this.context.players.getPlayerView(this.localId))==null?void 0:i.currentObject)}awake(){if(this._debug=new c7(this.context,this),this._networking=new d7(this.context,this),this._networking.awake(),z.setActive(this.gameObject,!1),this.cam=z.getComponent(this.gameObject,Bt),!this.cam){console.warn("SpectatorCamera: Spectator camera needs camera component on the same object.",this);return}!this._handler&&this.cam&&(this._handler=new a7(this.context,this.cam,this)),this.orbit=z.getComponent(this.context.mainCamera,Et)}onDestroy(){var e,i;this.stopSpectating(),(e=this._handler)==null||e.destroy(),(i=this._networking)==null||i.destroy()}isSupportedPlatform(){const e=window.navigator.userAgent,i=/Windows|MacOS/.test(e),s=/Windows NT/.test(e)&&/Edg/.test(e)&&!/Win64/.test(e);return i&&!s}onBeforeXR(e){this.isSupportedPlatform()&&z.setActive(this.gameObject,!0)}onEnterXR(e){this.isSupportedPlatform()&&(dr&&console.log(this.context.mainCamera),this.context.mainCamera&&this.followSelf())}onLeaveXR(e){var i,s;this.context.removeCamera(this.cam),z.setActive(this.gameObject,!1),this.orbit&&(this.orbit.enabled=!0),(i=this._handler)==null||i.set(void 0),(s=this._handler)==null||s.disable(),this.isSpectatingSelf&&this.stopSpectating()}followSelf(){this.target=this.context.players.getPlayerView(this.context.connection.connectionId),this.target||(this.context.players.setPlayerView(this.localId,this.context.mainCamera,yl.Headset),this.target=this.context.players.getPlayerView(this.localId)),dr&&console.log("Follow self",this.target)}onAfterRender(){var u,d,f;if(!this.cam)return;const e=this.context.renderer,i=e.xr.enabled;if(!e.xr.isPresenting&&!((u=this._handler)!=null&&u.currentTarget))return;(d=this._handler)==null||d.update(this._mode);const s=e.getRenderTarget();let r=null;const o=e.state;if(!s){if(!e.state.bindFramebuffer||!o.bindXRFramebuffer)return;r=e._framebuffer,o.bindXRFramebuffer(null)}this.setAvatarFlagsBeforeRender();const a=this.context.mainCameraComponent;if(a){const p=a.backgroundColor;p&&e.setClearColor(p,p.alpha),this.cam.backgroundColor=p,this.cam.clearFlags=a.clearFlags,this.cam.nearClipPlane=a.nearClipPlane,this.cam.farClipPlane=a.farClipPlane}else e.setClearColor(new we(1,1,1));e.setRenderTarget(null),e.xr.enabled=!1;const l=(f=this.cam)==null?void 0:f.cam;this.context.updateAspect(l);const h=e.xr.isPresenting;e.xr.isPresenting=!1,e.setSize(this.context.domWidth,this.context.domHeight),e.render(this.context.scene,l),e.xr.isPresenting=h,e.xr.enabled=i,s?e.setRenderTarget(s):o.bindXRFramebuffer&&o.bindXRFramebuffer(r),this.resetAvatarFlags()}setAvatarFlagsBeforeRender(){const e=this._mode===Nd.FirstPerson;for(const i of un.instances)if(i.avatar&&"isLocalAvatar"in i.avatar&&"flags"in i.avatar){let s=Kr.All;this.isSpectatingSelf&&(s=e&&i.avatar.isLocalAvatar?Kr.FirstPerson:Kr.ThirdPerson);const r=i.avatar.flags;if(!r)continue;for(const o of r)o.UpdateVisible(s)}}resetAvatarFlags(){var e;for(const i of un.instances)if(i.avatar&&"flags"in i.avatar){const s=i.avatar.flags;if(!s)continue;for(const r of s)"isLocalAvatar"in i.avatar&&((e=i.avatar)!=null&&e.isLocalAvatar)?r.UpdateVisible(Kr.FirstPerson):r.UpdateVisible(Kr.ThirdPerson)}}}o7([A()],gS.prototype,"useKeys",void 0);class a7{constructor(t,e,i){c(this,"context");c(this,"cam");c(this,"spectator");c(this,"follow");c(this,"target");c(this,"view");c(this,"currentObject");this.context=t,this.cam=e,this.spectator=i}get currentTarget(){return this.view}set(t){const e=t==null?void 0:t.currentObject;if(!e){this.spectator.stopSpectating();return}e!==this.currentObject&&(this.currentObject=e,this.view=t,this.follow||(this.follow=z.addNewComponent(this.cam.gameObject,ka)),this.target||(this.target=new re),e.add(this.target),this.follow.enabled=!0,this.follow.target=this.target,dr&&console.log("FOLLOW",e),this.context.isInXR?this.context.removeCamera(this.cam):this.context.setCurrentCamera(this.cam))}disable(){dr&&console.log("STOP FOLLOW",this.currentObject),this.view=void 0,this.currentObject=void 0,this.context.removeCamera(this.cam),this.follow&&(this.follow.enabled=!1)}destroy(){var t;(t=this.target)==null||t.removeFromParent(),this.follow&&z.destroy(this.follow)}update(t){var s,r,o,a,l,h;if(((s=this.currentTarget)==null?void 0:s.isConnected)===!1||((r=this.currentTarget)==null?void 0:r.removed)===!0){dr&&console.log("Target disconnected or timeout",this.currentTarget),this.spectator.stopSpectating();return}this.currentTarget&&((o=this.currentTarget)==null?void 0:o.currentObject)!==this.currentObject&&(dr&&console.log("Target changed",this.currentObject,"to",this.currentTarget.currentObject),this.set(this.currentTarget));const e=this.context.mainCamera;e&&(this.cam.cam.near!==e.near||this.cam.cam.far!==e.far)&&(this.cam.cam.near=e.near,this.cam.cam.far=e.far,this.cam.cam.updateProjectionMatrix());const i=(a=this.follow)==null?void 0:a.target;if(!(!i||!this.follow)){switch(t){case Nd.FirstPerson:((l=this.view)==null?void 0:l.viewDevice)!==yl.Browser?(this.follow.followFactor=5,this.follow.rotateFactor=5):(this.follow.followFactor=50,this.follow.rotateFactor=50),i.position.set(0,0,0);break;case Nd.ThirdPerson:this.follow.followFactor=3,this.follow.rotateFactor=2,i.position.set(0,.5,1.5);break}this.follow.flipForward=!1,((h=this.view)==null?void 0:h.viewDevice)!==yl.Browser?i.quaternion.copy(l7):i.quaternion.identity()}}}const l7=new ne().setFromAxisAngle(new C(0,1,0),Math.PI);class c7{constructor(t,e){c(this,"context");c(this,"spectator");this.context=t,this.spectator=e,console.log("Click other avatars or cameras to follow them. Press ESC to exit spectator mode."),this.context.domElement.addEventListener("keydown",s=>{if(!this.spectator.useKeys)return;s.key==="Escape"&&this.spectator.stopSpectating()});let i=0;this.context.input.addEventListener(at.PointerDown,s=>{i=this.context.time.time}),this.context.input.addEventListener(at.PointerUp,s=>{const r=this.context.time.time-i;r>1?this.spectator.stopSpectating():this.context.input.getPointerClicked(0)&&r<.3&&this.trySelectObject()})}trySelectObject(){const t=new Lo;t.setMask(16777215);const e=this.context.physics.raycast(t);if(dr&&console.log(...e),e!=null&&e.length)for(const i of e){if(i.distance<.2)continue;const s=i.object,r=z.getComponentInParent(s,un),o=r==null?void 0:r.connectionId;if(o){const a=this.context.players.getPlayerView(o);this.spectator.target=a,dr&&console.log("spectate",o,r);break}}}}class h7{constructor(t,e,i){c(this,"guid");c(this,"dontSave",!0);c(this,"targetUserId");c(this,"stoppedFollowing");this.guid=t,this.targetUserId=e,this.stoppedFollowing=i}}class u7{constructor(t,e){c(this,"guid");c(this,"userId");this.guid=t.guid,this.userId=e}}class d7{constructor(t,e){c(this,"followers",[]);c(this,"context");c(this,"spectator");c(this,"_followerEventMethod");c(this,"_requestFollowMethod");c(this,"_joinedRoomMethod");c(this,"_lastRequestFollowUser");c(this,"_enforceFollowInterval");this.context=t,this.spectator=e,this._followerEventMethod=this.onFollowerEvent.bind(this),this._requestFollowMethod=this.onRequestFollowEvent.bind(this),this._joinedRoomMethod=this.onUserJoinedRoom.bind(this)}awake(){this.context.connection.beginListen("spectator-follower-changed",this._followerEventMethod),this.context.connection.beginListen("spectator-request-follow",this._requestFollowMethod),this.context.connection.beginListen(Ye.JoinedRoom,this._joinedRoomMethod),this.context.domElement.addEventListener("keydown",t=>{this.spectator.useKeys&&(t.key==="f"?this.onRequestFollowMe():t.key==="Escape"&&this.onRequestFollowMe(!0))})}destroy(){this.context.connection.stopListen("spectator-follower-changed",this._followerEventMethod),this.context.connection.stopListen("spectator-request-follow",this._requestFollowMethod),this.context.connection.stopListen(Ye.JoinedRoom,this._joinedRoomMethod)}onSpectatedObjectChanged(t,e){if(dr&&console.log(this.context.connection.connectionId,"onSpectatedObjectChanged",t,e),this.context.connection.connectionId){const i=(t==null?void 0:t.userId)===void 0,s=i?e:t==null?void 0:t.userId,r=new h7(this.context.connection.connectionId,s,i);this.context.connection.send("spectator-follower-changed",r)}}onRequestFollowMe(t=!1){if(dr&&console.log("Request follow",this.context.connection.connectionId),this.context.connection.connectionId){this.spectator.stopSpectating();const e=t?void 0:this.context.connection.connectionId,i=new u7(this.spectator,e);this.context.connection.send("spectator-request-follow",i)}}onUserJoinedRoom(){N("followme")&&this.onRequestFollowMe()}onFollowerEvent(t){const e=t.targetUserId,i=t.guid;if(dr&&console.log(t),e===this.context.connection.connectionId)if(t.stoppedFollowing){const s=this.followers.indexOf(i);s!==-1&&(this.followers.splice(s,1),this.removeDisconnectedFollowers(),console.log(i,"unfollows you",this.followers.length))}else this.followers.includes(i)||(this.followers.push(i),this.removeDisconnectedFollowers(),console.log(i,"follows you",this.followers.length))}removeDisconnectedFollowers(){for(let t=this.followers.length-1;t>=0;t--){const e=this.followers[t];this.context.connection.userIsInRoom(e)===!1&&this.followers.splice(t,1)}}onRequestFollowEvent(t){if(this._lastRequestFollowUser=t,t.userId===this.context.connection.connectionId)this.spectator.stopSpectating();else if(t.userId===void 0)this.spectator.stopSpectating();else{const e=this.context.players.getPlayerView(t.userId);if(e)this.spectator.target=e;else return dr&&console.warn("Could not find view",t.userId),this.enforceFollow(),!1}return!0}enforceFollow(){this._enforceFollowInterval||(this._enforceFollowInterval=setInterval(()=>{this._lastRequestFollowUser===void 0||this._lastRequestFollowUser.userId&&this.spectator.isFollowedBy(this._lastRequestFollowUser.userId)?(clearInterval(this._enforceFollowInterval),this._enforceFollowInterval=void 0):(dr&&console.log("REQUEST FOLLOW AGAIN",this._lastRequestFollowUser.userId),this.onRequestFollowEvent(this._lastRequestFollowUser))},1e3))}}class ma{constructor(){c(this,"bb",null);c(this,"bb_pos",0)}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsSyncedCameraModel(t,e){return(e||new ma).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsSyncedCameraModel(t,e){return t.setPosition(t.position()+cC),(e||new ma).__init(t.readInt32(t.position())+t.position(),t)}userId(t){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.__string(this.bb_pos+e,t):null}guid(t){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.__string(this.bb_pos+e,t):null}dontSave(){const t=this.bb.__offset(this.bb_pos,8);return t?!!this.bb.readInt8(this.bb_pos+t):!1}pos(t){const e=this.bb.__offset(this.bb_pos,10);return e?(t||new Th).__init(this.bb_pos+e,this.bb):null}rot(t){const e=this.bb.__offset(this.bb_pos,12);return e?(t||new Th).__init(this.bb_pos+e,this.bb):null}static startSyncedCameraModel(t){t.startObject(5)}static addUserId(t,e){t.addFieldOffset(0,e,0)}static addGuid(t,e){t.addFieldOffset(1,e,0)}static addDontSave(t,e){t.addFieldInt8(2,+e,0)}static addPos(t,e){t.addFieldStruct(3,e,0)}static addRot(t,e){t.addFieldStruct(4,e,0)}static endSyncedCameraModel(t){return t.endObject()}static finishSyncedCameraModelBuffer(t,e){t.finish(e)}static finishSizePrefixedSyncedCameraModelBuffer(t,e){t.finish(e,void 0,!0)}}var f7=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};const qv="SCAM";XM(qv,ma.getRootAsSyncedCameraModel);const sr=new Lg;class p7{constructor(t,e){c(this,"userId");c(this,"guid");this.guid=e,this.userId=t}send(t,e){if(t){sr.clear();const i=sr.createString(this.guid),s=sr.createString(this.userId);ma.startSyncedCameraModel(sr),ma.addGuid(sr,i),ma.addUserId(sr,s);const r=qe(t),o=vy(t);ma.addPos(sr,Th.createVec3(sr,r.x,r.y,r.z)),ma.addRot(sr,Th.createVec3(sr,o.x,o.y,o.z));const a=ma.endSyncedCameraModel(sr);sr.finish(a,qv),e.sendBinary(sr.asUint8Array())}}}const ry=class extends se{constructor(){super(...arguments);c(this,"cameraPrefab",null);c(this,"_lastWorldPosition");c(this,"_lastWorldQuaternion");c(this,"_model",null);c(this,"_needsUpdate",!0);c(this,"_lastUpdateTime",0);c(this,"remoteCams",{});c(this,"userToCamMap",{});c(this,"_camTimeoutInSeconds",10);c(this,"_receiveCallback",null)}getCameraObject(e){const i=this.userToCamMap[e];return i?this.remoteCams[i].obj:null}async awake(){this._lastWorldPosition=this.worldPosition.clone(),this._lastWorldQuaternion=this.worldQuaternion.clone(),this.cameraPrefab&&("uri"in this.cameraPrefab&&(this.cameraPrefab=await this.cameraPrefab.instantiate(this.gameObject)),this.cameraPrefab&&"isObject3D"in this.cameraPrefab&&(this.cameraPrefab.visible=!1))}onEnable(){this._receiveCallback=this.context.connection.beginListenBinary(qv,this.onReceivedRemoteCameraInfoBin.bind(this))}onDisable(){this.context.connection.stopListenBinary(qv,this._receiveCallback)}update(){for(const r in this.remoteCams){const o=this.remoteCams[r],a=this.context.time.realtimeSinceStartup-o.lastUpdate;if(!o||a>this._camTimeoutInSeconds){xe()&&console.log("Remote cam timeout",r),o!=null&&o.obj&&z.destroy(o.obj),delete this.remoteCams[r],o&&delete this.userToCamMap[o.userId],ry.instances.push(o),this.context.players.removePlayerView(o.userId,yl.Browser);continue}}if(this.context.isInXR)return;const e=this.context.mainCamera;if(e===null){this.enabled=!1;return}if(!this.context.connection.isConnected||this.context.connection.connectionId===null)return;this._model===null&&(this._model=new p7(this.context.connection.connectionId,this.context.connection.connectionId+"_camera"));const i=qe(e),s=Nt(e);(i.distanceTo(this._lastWorldPosition)>.001||s.angleTo(this._lastWorldQuaternion)>.01)&&(this._needsUpdate=!0),this._lastWorldPosition.copy(i),this._lastWorldQuaternion.copy(s),!((!this._needsUpdate||this.context.time.frameCount%2!==0)&&!(this.context.time.realtimeSinceStartup-this._lastUpdateTime>this._camTimeoutInSeconds*.5))&&(this._lastUpdateTime=this.context.time.realtimeSinceStartup,this._needsUpdate=!1,this._model.send(e,this.context.connection),this.context.isInXR||this.context.players.setPlayerView(this.context.connection.connectionId,e,yl.Browser))}onReceivedRemoteCameraInfoBin(e){const i=e.guid();if(!i)return;const s=e.userId();if(!s||!this.context.connection.userIsInRoom(s)||!this.cameraPrefab)return;let r=this.remoteCams[i];if(!r)if("isObject3D"in this.cameraPrefab){const h=new za;h.context=this.context;const u=z.instantiate(this.cameraPrefab,h);r=this.remoteCams[i]={obj:u,lastUpdate:this.context.time.realtimeSinceStartup,userId:s},r.obj.visible=!0,this.gameObject.add(u),this.userToCamMap[s]=i,ry.instances.push(r);const d=z.getOrAddComponent(u,un);d.connectionId=s,d.avatar=u}else return;const o=r.obj;this.context.players.setPlayerView(s,o,yl.Browser),r.lastUpdate=this.context.time.realtimeSinceStartup,Bo.markDirty(o);const a=e.pos();a&&Pd(o,a.x(),a.y(),a.z());const l=e.rot();l&&yy(o,l.x(),l.y(),l.z())}};let Cd=ry;c(Cd,"instances",[]);f7([A([re,it])],Cd.prototype,"cameraPrefab",void 0);var ff=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};const d_="view",f_=N("debugsyncedroom");class qc extends se{constructor(){super(...arguments);c(this,"roomName");c(this,"urlParameterName","room");c(this,"joinRandomRoom",!0);c(this,"requireRoomParameter",!1);c(this,"autoRejoin",!0);c(this,"createJoinButton",!0);c(this,"_roomPrefix");c(this,"_lastJoinedRoom","");c(this,"_lastPingTime",0);c(this,"_lastRoomTime",-1);c(this,"_userWantsToBeInARoom",!1);c(this,"_roomButton");c(this,"_roomButtonIconJoin");c(this,"_roomButtonIconLeave");c(this,"updateRoomButtonState",()=>{var e,i;this._roomButton&&(this.context.connection.isInRoom?(this._roomButton.title="Leave the networked room",this._roomButton.textContent="Leave Room",(e=this._roomButtonIconJoin)==null||e.remove(),this._roomButton.prepend(this._roomButtonIconLeave)):(this._roomButton.title="Create or join a networked room",this._roomButton.textContent="Join Room",(i=this._roomButtonIconLeave)==null||i.remove(),this._roomButton.prepend(this._roomButtonIconJoin)))})}get roomPrefix(){return this._roomPrefix}get RoomPrefix(){return this._roomPrefix}awake(){f_&&console.log("Room",this.roomName,this.urlParameterName,this.joinRandomRoom,this.requireRoomParameter,this.autoRejoin),this._roomPrefix===void 0&&(this._roomPrefix=this.roomName,this.roomName="")}onEnable(){const e=N(d_);if(e&&typeof e=="string"&&e.length>0){console.log("Join as viewer"),this.context.connection.joinRoom(e,!0);return}if((this.joinRandomRoom||N(this.urlParameterName))&&this.tryJoinRoom(),this.createJoinButton){const i=this.createRoomButton();this.context.menu.appendChild(i)}}onDisable(){var e;(e=this._roomButton)==null||e.remove(),this.roomName&&this.roomName.length>0&&this.context.connection.leaveRoom(this.roomName)}onDestroy(){this.destroyRoomButton()}tryJoinRandomRoom(){this.setRandomRoomUrlParameter(),this.tryJoinRoom()}tryJoinRoom(e=0){e===void 0&&(e=0);let i=!1;if(this.urlParameterName){const s=N(this.urlParameterName);if(s&&typeof s=="string"||s==="number"){i=!0;const r=sL(s);this.roomName=r}else if(this.joinRandomRoom&&(console.log("No room name found in url, generating random one"),this.setRandomRoomUrlParameter(),e<1))return this.tryJoinRoom(e+1)}else this.joinRandomRoom&&(this.roomName===null||this.roomName===void 0||this.roomName.length<=0)&&(console.log("generate room name"),this.roomName=this.generateRoomName());return this.requireRoomParameter&&!i?(f_&&console.log('No required room parameter "'+this.urlParameterName+'" in url - will not connect to networking backend.'),!1):(this.context.connection.isConnected||this.context.connection.connect(),f_&&console.log("Join "+this.roomName),this._lastJoinedRoom=this.roomName,this._roomPrefix&&(this.roomName=this._roomPrefix+this.roomName),this._userWantsToBeInARoom=!0,this.context.connection.joinRoom(this.roomName),!0)}update(){this.context.connection.isConnected&&(this.context.time.time-this._lastPingTime>3&&(this._lastPingTime=this.context.time.time,this.context.connection.sendPing()),this.context.connection.isInRoom&&(this._lastRoomTime=this.context.time.time)),this._lastRoomTime>0&&this.context.time.time-this._lastRoomTime>.3&&(this._lastRoomTime=-1,this.autoRejoin?this._userWantsToBeInARoom&&(console.log("Disconnected from networking backend - attempt reconnecting now"),this.tryJoinRoom()):xe()&&console.warn("You are not connected to a room anymore (possibly because the tab was inactive for too long and the server kicked you?)"))}get currentRoomName(){const e=N(d_);return e||N(this.urlParameterName)}setRandomRoomUrlParameter(){const e=uy(),i=this.generateRoomName();N(this.urlParameterName)?e.set(this.urlParameterName,i):e.append(this.urlParameterName,i),sB(i,e)}generateRoomName(){return rB()+"_"+Math.floor(Ae.random(100,999))}getViewOnlyUrl(){if(this.context.connection.isConnected&&this.context.connection.currentRoomViewId){const e=window.location.search,i=new URLSearchParams(e);return i.has(this.urlParameterName)&&i.delete(this.urlParameterName),i.set(d_,this.context.connection.currentRoomViewId),window.location.origin+window.location.pathname+"?"+i.toString()}return null}createRoomButton(){if(this._roomButton)return this._roomButton;const e=document.createElement("button");return this._roomButton=e,e.classList.add("create-room-button"),e.setAttribute("priority","90"),e.onclick=()=>{this.context.connection.isInRoom?(this.urlParameterName&&R_(this.urlParameterName,null),this.context.connection.leaveRoom(),this._userWantsToBeInARoom=!1):(this.urlParameterName&&(N(this.urlParameterName)||(this._lastJoinedRoom?R_(this.urlParameterName,this._lastJoinedRoom):this.setRandomRoomUrlParameter())),this.tryJoinRoom())},this._roomButtonIconJoin=Xr("group"),this._roomButtonIconLeave=Xr("group_off"),this.updateRoomButtonState(),this.context.connection.beginListen(Ye.JoinedRoom,this.updateRoomButtonState),this.context.connection.beginListen(Ye.LeftRoom,this.updateRoomButtonState),e}destroyRoomButton(){this.context.connection.stopListen(Ye.JoinedRoom,this.updateRoomButtonState),this.context.connection.stopListen(Ye.LeftRoom,this.updateRoomButtonState)}}ff([A()],qc.prototype,"roomName",void 0);ff([A()],qc.prototype,"urlParameterName",void 0);ff([A()],qc.prototype,"joinRandomRoom",void 0);ff([A()],qc.prototype,"requireRoomParameter",void 0);ff([A()],qc.prototype,"autoRejoin",void 0);ff([A()],qc.prototype,"createJoinButton",void 0);function g7(){const n=N("testwindowcount")||0;n&&n>0&&m7(n)}function m7(n){if(N("testwindow"))return null;const t=new URL(window.location.href);XS(t.searchParams,lH,1),XS(t.searchParams,"testwindow",1);const e=t.toString(),i=[];window.onbeforeunload=()=>{for(const l of i)l.close()};const s=.05,r=128;let o=0,a=0;for(let l=0;l<n;l++){o*r+r*.01>=window.innerWidth&&(a+=1,o=0);const h=o*(r*(1+s))+window.screenLeft,u=a*(r*(1+s))+window.screenTop+90+60*a;o+=1;const d=window.open(e,"test window "+l,`popup=yes width=${r} height=${r} top=${u} left=${h}`);if(!d){console.warn("Failed to open window");continue}i.push(d),d.onload=()=>{d.onbeforeunload=()=>{for(let f=0;f<i.length;f++){const p=i[f];p!==d&&p.close()}i.length=0}}}return i}class rO extends se{awake(){g7()}}class oO extends se{constructor(){super(...arguments);c(this,"transformsPerFrame",10);c(this,"interval",0);c(this,"useFlatbuffers",!0);c(this,"builder",null);c(this,"models",null)}awake(){if(this.useFlatbuffers)this.context.connection.beginListenBinary(bg,e=>{});else{this.models=[];for(let e=0;e<this.transformsPerFrame;e++)this.models.push(new aO(this.context.connection.connectionId+"_simulatedTransform_"+e,this))}}update(){if(this.context.connection.isConnected){if(this.useFlatbuffers){if(!this.context.connection.connectionId||this.context.time.frameCount%this.interval!==0)return;this.builder===null&&(this.builder=new Lg(1024));const e=this.builder;for(let i=0;i<this.transformsPerFrame;i++){e.clear();const s=rk(this.context.connection.connectionId,this);this.context.connection.sendBinary(s)}}else if(this.models)for(let e=0;e<this.models.length;e++){const i=this.models[e];i.dontSave=!0,i.update(this,null),this.context.connection.send("TestSimulateUserData-"+e,i)}}}}class aO{constructor(t,e){c(this,"guid");c(this,"fast",!1);c(this,"position");c(this,"rotation");c(this,"velocity");c(this,"dontSave");this.guid=t,this.position={x:0,y:0,z:0},this.rotation={x:0,y:0,z:0,w:0},this.update(e,null)}isValid(){return this.fast!==void 0||this.position!==void 0||this.rotation!==void 0||this.velocity!==void 0}update(t,e){const i=t.worldPosition;this.position.x=i.x,this.position.y=i.y,this.position.z=i.z;const s=t.worldQuaternion;if(this.rotation.x=s.x,this.rotation.y=s.y,this.rotation.z=s.z,this.rotation.w=s.w,this.fast=!1,e){const r=e.getVelocity();this.velocity===void 0&&(this.velocity={x:0,y:0,z:0}),this.velocity.x=r.x,this.velocity.y=r.y,this.velocity.z=r.z}}}c(aO,"temp",new C);var pf=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};class Nl extends Ds{constructor(){super(...arguments);c(this,"offset");c(this,"rotation");c(this,"focusArea");c(this,"feather");c(this,"kernelSize");c(this,"resolutionScale")}get typeName(){return"TiltShiftEffect"}init(){this.offset.defaultValue=0,this.rotation.defaultValue=0,this.focusArea.defaultValue=.4,this.feather.defaultValue=.3,this.kernelSize.defaultValue=Il.MEDIUM,this.resolutionScale.defaultValue=1/window.devicePixelRatio}onCreateEffect(){console.log(this);const e=new w8({kernelSize:Il.VERY_LARGE});return this.offset.onValueChanged=i=>e.offset=i,this.rotation.onValueChanged=i=>e.rotation=i,this.focusArea.onValueChanged=i=>e.focusArea=i,this.feather.onValueChanged=i=>e.feather=i,this.kernelSize.onValueChanged=i=>e.blurPass.kernelSize=i,this.resolutionScale.onValueChanged=i=>e.resolution.scale=i/window.devicePixelRatio,e}}pf([A(je)],Nl.prototype,"offset",void 0);pf([A(je)],Nl.prototype,"rotation",void 0);pf([A(je)],Nl.prototype,"focusArea",void 0);pf([A(je)],Nl.prototype,"feather",void 0);pf([A(je)],Nl.prototype,"kernelSize",void 0);pf([A(je)],Nl.prototype,"resolutionScale",void 0);zo("TiltShiftEffect",Nl);var A7=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r},jp;(function(n){n[n.None=0]="None",n[n.Neutral=1]="Neutral",n[n.ACES=2]="ACES"})(jp||(jp={}));class R0 extends Ds{constructor(){super(...arguments);c(this,"mode")}get typeName(){return"ToneMapping"}get isToneMapping(){return!0}init(){this.mode||(this.mode=new je(sg)),this.mode.defaultValue=sg}apply(){this.mode||this.init(),this.mode.onValueChanged=this._apply.bind(this),this._apply(this.mode.value)}_apply(e){this.context.renderer.toneMapping=this.getThreeToneMapping(e)}getThreeToneMapping(e){switch(e){case jp.None:return tv;case jp.Neutral:return YR;case jp.ACES:return KR;default:return tv}}}A7([A(je)],R0.prototype,"mode",void 0);zo("Tonemapping",R0);var B0=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};class gf extends se{constructor(){super(...arguments);c(this,"isGizmo",!1);c(this,"translationSnap",1);c(this,"rotationSnapAngle",15);c(this,"scaleSnap",.25);c(this,"control");c(this,"orbit");c(this,"onControlChangedEvent",e=>{const i=this.orbit;if(i&&(i.enabled=!e.value),e.value){const s=z.getComponentInParent(this.gameObject,Qh);s&&s.requestOwnership()}});c(this,"windowKeyDownListener",e=>{if(this.enabled&&this.control)switch(e.keyCode){case 81:this.control.setSpace(this.control.space==="local"?"world":"local");break;case 16:this.enableSnapping();break;case 87:this.control.setMode("translate");break;case 69:this.control.setMode("rotate");break;case 82:this.control.setMode("scale");break;case 187:case 107:this.control.setSize(this.control.size+.1);break;case 189:case 109:this.control.setSize(Math.max(this.control.size-.1,.1));break;case 88:this.control.showX=!this.control.showX;break;case 89:this.control.showY=!this.control.showY;break;case 90:this.control.showZ=!this.control.showZ;break;case 32:this.control.enabled=!this.control.enabled;break}});c(this,"windowKeyUpListener",e=>{if(this.enabled)switch(e.keyCode){case 16:this.disableSnapping();break}})}onEnable(){var e;this.isGizmo&&!Og||this.context.mainCamera&&(this.control||(this.control=new nz(this.context.mainCamera,this.context.renderer.domElement),this.control.visible=!0,this.control.enabled=!0,this.control.getRaycaster().layers.set(2),this.control.size=1,this.control.traverse(i=>{const s=i;if(s.layers.set(2),s){const r=s.material;r&&(r.opacity=.3)}}),this.orbit=z.getComponentInParent(this.context.mainCamera,Et)??void 0),this.control&&(this.context.scene.add(this.control),this.control.attach(this.gameObject),(e=this.control)==null||e.addEventListener("dragging-changed",this.onControlChangedEvent),window.addEventListener("keydown",this.windowKeyDownListener),window.addEventListener("keyup",this.windowKeyUpListener)))}onDisable(){var e,i;(e=this.control)==null||e.removeFromParent(),(i=this.control)==null||i.removeEventListener("dragging-changed",this.onControlChangedEvent),window.removeEventListener("keydown",this.windowKeyDownListener),window.removeEventListener("keyup",this.windowKeyUpListener)}enableSnapping(){this.control&&(this.control.setTranslationSnap(this.translationSnap),this.control.setRotationSnap(vt.degToRad(this.rotationSnapAngle)),this.control.setScaleSnap(this.scaleSnap))}disableSnapping(){this.control&&(this.control.setTranslationSnap(null),this.control.setRotationSnap(null),this.control.setScaleSnap(null))}}B0([A()],gf.prototype,"isGizmo",void 0);B0([A()],gf.prototype,"translationSnap",void 0);B0([A()],gf.prototype,"rotationSnapAngle",void 0);B0([A()],gf.prototype,"scaleSnap",void 0);var mS=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};class mf extends Ds{constructor(){super(...arguments);c(this,"color");c(this,"intensity");c(this,"center")}get typeName(){return"Vignette"}init(){this.color.defaultValue={r:0,g:0,b:0,a:1},this.intensity.defaultValue=0,this.center.defaultValue={x:.5,y:.5}}onCreateEffect(){const e=new OM;return this.intensity.onValueChanged=i=>{e.offset=i,this.updateDarkness(e)},this.color.onValueChanged=i=>{this.updateDarkness(e)},e}updateDarkness(e){const i=this.intensity.value;e.darkness=i}}mS([A(je)],mf.prototype,"color",void 0);mS([A(je)],mf.prototype,"intensity",void 0);mS([A(je)],mf.prototype,"center",void 0);zo("Vignette",mf);var v7=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};const YA=N("debugarcamera");class AS extends se{constructor(){super(...arguments);c(this,"backgroundTint",new Ot(1,1,1,1));c(this,"backgroundPlane");c(this,"threeTexture");c(this,"forceTextureInitialization",function(){const e=new St,i=new Ys,s=new Ws;s.add(new J(i,e));const r=new xt;return function(a,l){e.map=l,a.render(s,r),YA&&console.warn("Force texture initialization")}}());c(this,"preRender",()=>{if(!this||!this.gameObject)return;const i=this.context.renderer.xr.getFrame();i&&(!this.threeTexture&&this.context.renderer&&(this.threeTexture=new pt,this.forceTextureInitialization(this.context.renderer,this.threeTexture)),this.backgroundPlane===void 0&&(this.backgroundPlane=b7(this.backgroundTint)),this.backgroundPlane.parent!==this.scene&&this.scene.add(this.backgroundPlane),this.updateFromFrame(i))})}onBeforeXR(e,i){i.optionalFeatures=i.optionalFeatures||[],i.optionalFeatures.push("camera-access"),YA&&console.warn("Requesting camera-access")}onEnterXR(e){this.backgroundPlane&&(this.context.scene.add(this.backgroundPlane),this.backgroundPlane.visible=!1),this.backgroundPlane&&this.context.scene.add(this.backgroundPlane),this.context.pre_render_callbacks.push(this.preRender)}onLeaveXR(e){this.backgroundPlane&&this.backgroundPlane.removeFromParent();const i=this.context.pre_render_callbacks.indexOf(this.preRender);i>=0&&this.context.pre_render_callbacks.splice(i,1)}get background(){return this.backgroundPlane}onBeforeRender(e){this.updateFromFrame(e)}updateFromFrame(e){if(!e)return;const i=e.session.enabledFeatures;if(i&&!i.some(r=>r==="camera-access")){this.background&&(this.background.visible=!1);return}const s=e.getViewerPose(this.context.renderer.xr.getReferenceSpace());if(s){for(const r of s.views)if("camera"in r&&r.camera){let a=this.context.renderer.xr.getBinding();if(a||(a=new XRWebGLBinding(e.session,this.context.renderer.getContext())),a){let l=null;if("getCameraImage"in a){l=a.getCameraImage(r.camera);const h=this.context.renderer.properties.get(this.threeTexture);h.__webglTexture=l,this.backgroundPlane?(this.backgroundPlane.setTexture(this.threeTexture),this.backgroundPlane.visible=!0):YA&&console.warn("No background plane to set texture on")}}}}}}v7([A(Ot)],AS.prototype,"backgroundTint",void 0);const y7=`
uniform sampler2D t2D;

varying vec2 vUv;

void main() {

    vec4 texColor = texture2D( t2D, vUv );
    texColor.w = 1.0;

    // inline sRGB decode
    texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );

    gl_FragColor = texColor * <backgroundTint>;

    #include <tonemapping_fragment>
    #include <colorspace_fragment>
}
`;function b7(n){const t="vec4("+n.r.toFixed(3)+","+n.g.toFixed(3)+","+n.b.toFixed(3)+","+n.a.toFixed(3)+")";YA&&console.log(t);const e=new J(new Ys(2,2),new $e({name:"BackgroundMaterial",uniforms:ly.clone(gd.background.uniforms),vertexShader:gd.background.vertexShader,fragmentShader:y7.replaceAll("<backgroundTint>",t),side:pi,depthTest:!1,depthWrite:!1,fog:!1}));return e.geometry.deleteAttribute("normal"),Object.defineProperty(e.material,"map",{get:function(){return this.threeTexture}}),e.renderOrder=-1e4,e.layers.set(2),e.frustumCulled=!1,e.setTexture=function(i){e.material.uniforms.t2D.value=i},e}var hu=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};const uR=N("debugimagetracking"),oy=class{constructor(t,e,i,s,r,o){c(this,"measuredSize");c(this,"state");c(this,"_position");c(this,"_rotation");c(this,"_trackingComponent");c(this,"_trackedImage");c(this,"_bitmap");c(this,"_pose");this._trackingComponent=t,this._trackedImage=e,this._bitmap=i,this.measuredSize=s,this.state=r,this._pose=o}get url(){return this._trackedImage.image??""}get widthInMeters(){return this._trackedImage.widthInMeters??void 0}get bitmap(){return this._bitmap}get model(){return this._trackedImage}getPosition(t){return this.ensureTransformData(),t.copy(this._position),t}getQuaternion(t){return this.ensureTransformData(),t.copy(this._rotation),t}applyToObject(t,e=void 0){this.ensureTransformData();const i=t.position.distanceToSquared(this._position)/.05+t.quaternion.angleTo(this._rotation)/.05;e&&(e*=Math.max(1,i)),e===void 0||e>=1?(t.position.copy(this._position),t.quaternion.copy(this._rotation)):(e=Math.max(0,Math.min(1,e)),t.position.lerp(this._position,e),t.quaternion.slerp(this._rotation,e))}ensureTransformData(){if(!this._position){this._position=oy._positionBuffer.get(),this._rotation=oy._rotationBuffer.get();const t=this._pose.transform,e=Me.active.convertSpace(t);this._position.copy(e==null?void 0:e.position),this._rotation.copy(e==null?void 0:e.quaternion)}}};let vh=oy;c(vh,"_positionBuffer",new ko(()=>new C,20)),c(vh,"_rotationBuffer",new ko(()=>new ne,20));class Ql{constructor(){c(this,"image");c(this,"widthInMeters",.25);c(this,"object");c(this,"createObjectInstance",!1);c(this,"imageDoesNotMove",!1);c(this,"hideWhenTrackingIsLost",!0)}}hu([A(URL)],Ql.prototype,"image",void 0);hu([A()],Ql.prototype,"widthInMeters",void 0);hu([A(it)],Ql.prototype,"object",void 0);hu([A()],Ql.prototype,"createObjectInstance",void 0);hu([A()],Ql.prototype,"imageDoesNotMove",void 0);hu([A()],Ql.prototype,"hideWhenTrackingIsLost",void 0);class _7{constructor(t,e,i){c(this,"filename");c(this,"widthInMeters");c(this,"imageData");this.filename=t,this.imageData=e,this.widthInMeters=i}get extensionName(){return"image-tracking"}onAfterHierarchy(t,e){e.beginBlock('def Preliminary_ReferenceImage "AnchoringReferenceImage"'),e.appendLine("uniform asset image = @image_tracking/"+this.filename+"@"),e.appendLine("uniform double physicalWidth = "+(this.widthInMeters*100).toFixed(8)),e.closeBlock()}onBeforeBuildDocument(t){const e=z.findObjectOfType(Pc);!e||!e.trackedImages||e.trackedImages.length>1&&(xe()&&Yt("USDZ: Only one tracked image is supported."),console.warn("USDZ: Only one tracked image is supported."))}onAfterSerialize(t){t.files["image_tracking/"+this.filename]=this.imageData}onExportObject(t,e,i){var r;const s=z.findObjectOfType(Pc);if(!(!s||!s.trackedImages)){for(const o of s.trackedImages)if(((r=o.object)==null?void 0:r.asset)===t){const a=z.findObjectOfType(li);if(!a)continue;const{scale:l,target:h}=a.getARScaleAndTarget();let u=t;const d=new ce;if(t!==h)for(;u.parent&&u.parent!==h;)u=u.parent,d.premultiply(u.matrix);const f=d.clone().invert();e.matrix=f.scale(new C(l,l,l));break}}}}const dd=class extends se{constructor(){super(...arguments);c(this,"trackedImages");c(this,"smooth",!0);c(this,"trackedImageIndexMap",new Map);c(this,"imageToObjectMap",new Map);c(this,"currentImages",[]);c(this,"onImageTrackingUpdate",e=>{const i=Me.active;if(i)for(const s of e){const r=s.model,o=s.state==="tracked";if(!r.object)continue;let a=this.imageToObjectMap.get(r);if(a===void 0)a={object:null,frames:0,lastTrackingTime:Date.now()},this.imageToObjectMap.set(r,a),r.object.loadAssetAsync().then(l=>{if(r.createObjectInstance&&l&&(l=z.instantiate(l)),l){a.object=l;for(const h of l.getComponentsInChildren(ci))h.setInstancingEnabled(!1);i.rig?(i.rig.gameObject.add(l),s.applyToObject(l),l.activeSelf||z.setActive(l,!0)):console.warn("XRImageTracking: missing XRRig")}});else{if(a.frames++,o&&(a.lastTrackingTime=Date.now()),r.imageDoesNotMove&&a.frames>10||!a.object)continue;i.rig&&(i.rig.gameObject.add(a.object),s.applyToObject(a.object,this.smooth?this.context.time.deltaTimeUnscaled*3:void 0),a.object.activeSelf||z.setActive(a.object,!0))}}})}awake(){if(uR&&console.log(this),!!this.trackedImages){for(const e of this.trackedImages)if(e.image&&!dd._imageElements.has(e.image)){const i=e.image;dd._imageElements.set(i,null);const s=document.createElement("img");s.src=i,s.addEventListener("load",async()=>{const r=await createImageBitmap(s);dd._imageElements.set(i,r);const o=await YQ(r);if(o){const l=await(await o.convertToBlob({type:"image/png"})).arrayBuffer(),h=z.findObjectOfType(li);h&&this.trackedImages&&(h.extensions.push(new _7("marker.png",new Uint8Array(l),this.trackedImages[0].widthInMeters)),h.anchoringType="image")}})}}}onBeforeXR(e,i){var s;if(this.trackedImages){i.optionalFeatures=i.optionalFeatures||[],i.optionalFeatures.includes("image-tracking")||i.optionalFeatures.push("image-tracking"),i.trackedImages=[];for(const r of this.trackedImages)if((s=r.image)!=null&&s.length&&r.widthInMeters>0){const o=dd._imageElements.get(r.image);o&&(this.trackedImageIndexMap.set(i.trackedImages.length,r),i.trackedImages.push({image:o,widthInMeters:r.widthInMeters}))}}}onEnterXR(e){var i;if(this.trackedImages){for(const s of this.trackedImages)if((i=s.object)!=null&&i.asset){const r=s.object.asset;r.userData||(r.userData={});const o={visible:r.visible,parent:r.parent,matrix:r.matrix.clone()};r.userData["image-tracking"]=o}}for(const s of this.imageToObjectMap.values())s.frames=0}onLeaveXR(e){var i,s;if(this.trackedImages){for(const r of this.trackedImages)if((i=r.object)!=null&&i.asset){const o=r.object.asset;if(o.userData){const a=o.userData["image-tracking"];a&&(o.visible=a.visible,(s=a.parent)==null||s.add(o),o.matrix.copy(a.matrix),o.matrix.decompose(o.position,o.quaternion,o.scale)),delete o.userData["image-tracking"]}}}}onUpdateXR(e){var r;this.currentImages.length=0;const i=e.xr.frame;if(!i)return;if("getImageTrackingResults"in i){if(((r=e.xr.session.enabledFeatures)==null?void 0:r.includes("image-tracking"))===!1)return;if(i.session&&typeof i.getImageTrackingResults=="function"){const o=i.getImageTrackingResults();if(o.length>0){const a=this.context.renderer.xr.getReferenceSpace();if(a){for(const l of o){const h=l.trackingState,u=l.index,d=this.trackedImageIndexMap.get(u);if(d){const f=i.getPose(l.imageSpace,a),p=new vh(this,d,l.image,l.measuredSize,h,f);this.currentImages.push(p)}else uR&&console.warn("No tracked image for index",u)}if(this.currentImages.length>0)try{this.dispatchEvent(new CustomEvent("image-tracking",{detail:this.currentImages})),this.onImageTrackingUpdate(this.currentImages)}catch(l){console.error(l)}}}}}else{const o=`Image tracking is currently not supported on this device. On Chrome for Android, you can enable the <a target="_blank" href="#" onclick="() => console.log('I')">chrome://flags/#webxr-incubations</a> flag.`;this.didPrintWarning||(this.didPrintWarning=!0,console.log(o)),Yt(o);return}const s=1e3;for(const[o,a]of this.imageToObjectMap){if(!a.object||!o||o.hideWhenTrackingIsLost===!1)continue;let l=!1;for(const h of this.currentImages)if(h.model===o){const u=Date.now()-a.lastTrackingTime;if(o.imageDoesNotMove||h.state==="tracked"||u<=s){l=!0;break}}l||z.setActive(a.object,!1)}}};let Pc=dd;c(Pc,"_imageElements",new Map);hu([A(Ql)],Pc.prototype,"trackedImages",void 0);var dm=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};const yA=N("debugplanetracking");class uu extends se{constructor(){super(...arguments);c(this,"dataTemplate");c(this,"initiateRoomCaptureIfNoData",!0);c(this,"usePlaneData",!0);c(this,"useMeshData",!0);c(this,"runInVR",!0);c(this,"_dataId",1);c(this,"_allPlanes",new Map);c(this,"_allMeshes",new Map);c(this,"firstTimeNoPlanesDetected",-100);c(this,"_flipForwardMatrix",new ce().makeRotationY(Math.PI));c(this,"_verticesCache",new Map)}get trackedPlanes(){return this._allPlanes.values()}get trackedMeshes(){return this._allMeshes.values()}onBeforeXR(e,i){e==="immersive-vr"&&!this.runInVR||(i.optionalFeatures=i.optionalFeatures||[],this.usePlaneData&&!i.optionalFeatures.includes("plane-detection")&&i.optionalFeatures.push("plane-detection"),this.useMeshData&&!i.optionalFeatures.includes("mesh-detection")&&i.optionalFeatures.push("mesh-detection"))}onEnterXR(e){for(const i of this._allPlanes.keys())this.removeData(i,this._allPlanes);for(const i of this._allMeshes.keys())this.removeData(i,this._allMeshes)}onUpdateXR(e){if(!this.runInVR&&e.xr.isVR)return;const i=e.xr.rig;if(!i){console.warn("No XR rig found, cannot parent tracked planes to it");return}const s=e.xr.frame;if(!this.context.renderer.xr.getReferenceSpace())return;const a=s.detectedPlanes,l=s.detectedMeshes,h=a!==void 0&&a.size>0,u=l!==void 0&&l.size>0;this.initiateRoomCaptureIfNoData&&(!h&&!u&&this.firstTimeNoPlanesDetected<-10&&(this.firstTimeNoPlanesDetected=Date.now()),(h||u)&&(this.firstTimeNoPlanesDetected=-1),this.firstTimeNoPlanesDetected>0&&Date.now()-this.firstTimeNoPlanesDetected>2500&&"initiateRoomCapture"in s.session&&(s.session.initiateRoomCapture(),this.firstTimeNoPlanesDetected=-1)),a!==void 0&&this.processFrameData(e.xr,i.gameObject,s,a,this._allPlanes),l!==void 0&&this.processFrameData(e.xr,i.gameObject,s,l,this._allMeshes)}removeData(e,i){const s=i.get(e);if(!s)return;i.delete(e),yA&&console.log("Plane no longer tracked, id="+s.id),s.mesh&&s.mesh.parent&&(s.mesh.parent.remove(s.mesh),Ua(s.mesh,!0,!0));const r=new CustomEvent("plane-tracking",{detail:{type:"plane-removed",context:s}});this.dispatchEvent(r)}processFrameData(e,i,s,r,o){const l=this.context.renderer.xr.getReferenceSpace();if(l){for(const h of o.keys())r.has(h)||this.removeData(h,o);for(const h of r){const u="planeSpace"in h?h.planeSpace:"meshSpace"in h?h.meshSpace:void 0;if(!u)continue;const d=s.getPose(u,l);let f;const p=g=>{if(g){if(g instanceof Array){for(const m of g)p(m);return}g.name.includes("Occlu")&&(g.colorWrite=!1,g.depthWrite=!0,g.transparent=!1,g.polygonOffset=!0,g.polygonOffsetFactor=1,g.polygonOffsetUnits=.1,g._renderOrder=-1e3)}};if(o.has(h)){const g=o.get(h);if(f=g.mesh,g.timestamp<h.lastChangedTime){if(g.timestamp=h.lastChangedTime,g.mesh){const v=this.createGeometry(h);if(g.mesh instanceof J)g.mesh.geometry.dispose(),g.mesh.geometry=v,p(g.mesh.material);else if(g.mesh instanceof To)for(const y of g.mesh.children)y instanceof J&&(y.geometry.dispose(),y.geometry=v,p(y.material));if(g.collider){const y=g.mesh;g.collider.sharedMesh=y,g.collider.convex=this.checkIfContextShouldBeConvex(y,g.xrData),g.collider.onDisable(),g.collider.onEnable()}yA&&console.log("Plane updated, id="+g.id,g)}const m=new CustomEvent("plane-tracking",{detail:{type:"plane-updated",context:g}});this.dispatchEvent(m)}}else{if(!this.dataTemplate){const g=new J;yA?g.material=new NR:g.material=new St({wireframe:!0,opacity:.33,transparent:!0,color:0}),this.dataTemplate=new it("","",g)}if(!this.dataTemplate.asset)this.dataTemplate.loadAssetAsync();else{const g=z.instantiate(this.dataTemplate.asset);if(f=g,g instanceof J)Jt(g.geometry),g.geometry=this.createGeometry(h),p(g.material);else if(g instanceof To)for(const y of g.children)y instanceof J&&(Jt(y.geometry),y.geometry=this.createGeometry(h),p(y.material));const m=g.getComponent(Zd);if(m){const y=g;m.sharedMesh=y,m.convex=this.checkIfContextShouldBeConvex(y,h),m.onDisable(),m.onEnable()}g.matrixAutoUpdate=!1,g.matrixWorldNeedsUpdate=!0,i.add(g);const v={id:this._dataId++,xrData:h,timestamp:h.lastChangedTime,mesh:g,collider:m};o.set(h,v),yA&&console.log("New plane detected, id="+v.id,v);try{const y=new CustomEvent("plane-tracking",{detail:{type:"plane-added",context:v}});this.dispatchEvent(y)}catch(y){console.error(y)}}}f&&(d?(f.visible=!0,f.matrix.fromArray(d.transform.matrix),f.matrix.premultiply(this._flipForwardMatrix)):f.visible=!1)}}}checkIfContextShouldBeConvex(e,i){if(!e)return!0;if(e){const s=new Nn;s.expandByObject(e);const r=new C;s.getSize(r);let o=!0;return r.x>2&&r.y>2&&r.z>1.5&&(o=!1),o&&"semanticLabel"in i&&i.semanticLabel==="wall"&&(o=!0),o}return!0}createGeometry(e){return"polygon"in e?this.createPlaneGeometry(e.polygon):"vertices"in e&&"indices"in e?this.createMeshGeometry(e.vertices,e.indices):new jt}createMeshGeometry(e,i){const s=e.toString()+"_"+i.toString();if(this._verticesCache.has(s))return this._verticesCache.get(s);const r=new jt;r.setIndex(new Ve(i,1)),r.setAttribute("position",new Ve(e,3));const o=Array();for(let a=0;a<e.length;a+=3)o.push(e[a],e[a+2]);return r.setAttribute("uv",new Ve(new Float32Array(o),2)),this._verticesCache.set(s,r),r}createPlaneGeometry(e){const i=new jt,s=[],r=[];e.forEach(p=>{s.push(p.x,p.y,p.z),r.push(p.x,p.z)});const o=new C(s[0],s[1],s[2]),a=new C(s[3],s[4],s[5]),l=new C(s[6],s[7],s[8]),h=new C,u=new C;h.subVectors(a,o),u.subVectors(l,o),h.cross(u),h.normalize();const d=[];for(let p=0;p<s.length/3;p++)d.push(h.x,h.y,h.z);const f=[];for(let p=2;p<e.length;++p)f.push(0,p-1,p);return i.setAttribute("position",new Ve(new Float32Array(s),3)),i.setAttribute("uv",new Ve(new Float32Array(r),2)),i.setAttribute("normal",new Ve(new Float32Array(d),3)),i.setIndex(f),i}}dm([A(it)],uu.prototype,"dataTemplate",void 0);dm([A()],uu.prototype,"initiateRoomCaptureIfNoData",void 0);dm([A()],uu.prototype,"usePlaneData",void 0);dm([A()],uu.prototype,"useMeshData",void 0);dm([A()],uu.prototype,"runInVR",void 0);var lO=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};class P0 extends se{constructor(){super(...arguments);c(this,"side","none");c(this,"controller",!0);c(this,"hands",!1);c(this,"controlVisibility",!0);c(this,"useGripSpace",!1)}get activeAndEnabled(){return!0}onUpdateXR(e){const i=e.xr.getController(this.side);if(i){if(i.hand&&!this.hands){this.controlVisibility&&(this.gameObject.visible=!1);return}else if(!this.controller){this.controlVisibility&&(this.gameObject.visible=!1);return}this.controlVisibility&&(this.gameObject.visible=!0),this.useGripSpace||i.targetRayMode==="transient-pointer"?(this.gameObject.worldPosition=i.gripWorldPosition,this.gameObject.worldQuaternion=i.gripWorldQuaternion):(this.gameObject.worldPosition=i.rayWorldPosition,this.gameObject.worldQuaternion=i.rayWorldQuaternion)}}}lO([A()],P0.prototype,"side",void 0);lO([A()],P0.prototype,"controller",void 0);var w7=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};const dR=N("debugwebxr");class vS extends se{constructor(){super(...arguments);c(this,"priority",0);c(this,"_startScale")}get isActive(){return this.activeAndEnabled&&this.gameObject.visible}setAsActiveXRRig(){var e;(e=Me.active)==null||e.setRigActive(this)}awake(){if(dR){const e=new re;e.position.y+=.5,this.gameObject.add(e);const i=e.addNewComponent($d);i&&(i.isGizmo=!1);const s=new Do(.5);this.gameObject.add(s)}}isXRRig(){return!0}supportsXR(e){return!0}onEnterXR(e){this._startScale=this.gameObject.scale.clone(),e.xr.addRig(this),dR&&console.log("WebXR: add Rig",this.name,this.priority)}onLeaveXR(e){e.xr.removeRig(this),this._startScale&&this.gameObject&&this.gameObject.scale.copy(this._startScale)}}w7([A()],vS.prototype,"priority",void 0);class cO{}const x7=Object.freeze(Object.defineProperty({__proto__:null,ActionBuilder:At,ActionCollection:oM,ActionModel:ur,AlignmentConstraint:Uy,Animation:Ps,AnimationCurve:Tl,AnimationExtension:Hy,AnimationTrackHandler:IC,Animator:zn,AnimatorController:to,Antialiasing:Wy,AudioExtension:Zh,AudioListener:Rh,AudioSource:kt,AudioTrackHandler:bd,Avatar:Yd,AvatarBlink_Simple:Jd,AvatarEyeLook_Rotation:Bc,AvatarLoader:dk,AvatarMarker:un,AvatarModel:DC,Avatar_Brain_LookAt:Bv,Avatar_MouthShapes:Yy,Avatar_MustacheShake:uk,Avatar_POI:bl,AxesHelper:Vg,BaseUIComponent:Fo,BasicIKConstraint:fk,BehaviorExtension:OC,BehaviorModel:Ki,Bloom:_l,BoxCollider:qg,BoxGizmo:$d,BoxHelperComponent:So,Button:jc,CallInfo:_g,Camera:Bt,CameraTargetReachedEvent:Iv,Canvas:fn,CanvasGroup:zh,CapsuleCollider:Oc,ChangeMaterialOnClick:gl,ChangeTransformOnClick:ef,CharacterController:tf,CharacterControllerInput:Hc,ChromaticAberration:t0,Collider:ro,ColorAdjustments:eu,ColorBySpeedModule:nf,ColorOverLifetimeModule:r0,ContactShadows:Mo,ControlTrackHandler:TC,CustomBranding:su,Deletable:Nk,DeleteBox:qC,DepthOfField:Ha,DeviceFlag:XC,DocumentExtension:Qk,DragControls:Is,DropListener:u0,Duplicatable:af,EmissionModule:Ol,EmphasizeOnClick:Zg,EventList:dn,EventListEvent:xC,EventSystem:pr,EventTrigger:$C,FieldWithDefault:Dk,FixedJoint:jk,FlyControls:Gk,Fog:im,GltfExport:_a,GltfExportBox:Wk,Gradient:tu,Graphic:wl,GraphicRaycaster:CC,GridHelper:nm,GridLayoutGroup:bk,GroundProjectedEnv:lf,GroupActionModel:ph,HideOnStart:_k,HingeJoint:f0,HorizontalLayoutGroup:yk,Image:Kg,InheritVelocityModule:Ll,InputField:Wr,InstanceHandle:wd,InstancingHandler:_d,Interactable:Uk,Keyframe:Qo,LODGroup:m0,LODModel:cf,Light:wr,LimitVelocityOverLifetimeModule:Ji,LogStats:qk,LookAt:xl,LookAtConstraint:Xd,MainModule:ls,MaskableGraphic:Jy,MeshCollider:Zd,MeshRenderer:s0,MinMaxCurve:Se,MinMaxGradient:Un,NeedleMenu:Fl,NestedGltf:rS,Networking:Bl,NoiseModule:Lt,ObjectRaycaster:no,OffsetConstraint:hf,OpenURL:rm,OrbitControls:Et,Outline:Xg,Padding:$h,ParticleBurst:Ov,ParticleSubEmitter:fS,ParticleSystem:gi,ParticleSystemRenderer:Ho,PhysicsExtension:HC,PixelationEffect:S0,PlayAnimationOnClick:Ia,PlayAudioOnClick:jh,PlayableDirector:Rc,PlayerColor:Eg,PointerEventData:zg,PostProcessingHandler:zC,PreliminaryAction:$g,PreliminaryTrigger:$y,RGBAColor:Ot,RawImage:NC,Rect:mk,RectTransform:jn,ReflectionProbe:ml,RegisteredAnimationInfo:RC,RemoteSkybox:Pl,Renderer:ci,RendererLightmap:Mv,Rigidbody:Pt,RotationBySpeedModule:oo,RotationOverLifetimeModule:jo,SceneSwitcher:Os,ScreenCapture:lu,ScreenSpaceAmbientOcclusion:Wc,ScreenSpaceAmbientOcclusionN8:Wa,SetActiveOnClick:Vr,ShadowCatcher:E0,ShapeModule:Xt,SignalAsset:zy,SignalReceiver:Tc,SignalReceiverEvent:Gg,SignalTrackHandler:Tv,Size:gk,SizeBySpeedModule:Zs,SizeOverLifetimeModule:iu,SkinnedMeshRenderer:kk,SmoothFollow:ka,SpatialGrabRaycaster:Sv,SpatialHtml:T0,SpatialTrigger:kh,SpatialTriggerReceiver:Cl,SpectatorCamera:gS,SphereCollider:Wg,Sprite:Vc,SpriteData:tm,SpriteRenderer:Go,SpriteSheet:o0,SubEmitterSystem:Wv,SyncedCamera:Cd,SyncedRoom:qc,SyncedTransform:Qh,TapGestureTrigger:wk,TeleportTarget:GC,TestRunner:rO,TestSimulateUserData:oO,Text:ks,TextBuilder:VC,TextExtension:c0,TextureSheetAnimationModule:cs,TiltShiftEffect:Nl,ToneMapping:R0,TrailModule:Ai,TransformData:Yi,TransformGizmo:gf,TriggerBuilder:Ln,TriggerModel:Ic,UIRaycastUtils:SC,UIRootComponent:Ny,USDZExporter:li,USDZText:Ah,USDZUIExtension:WC,UsageMarker:h0,VariantAction:rM,VelocityOverLifetimeModule:Si,VerticalLayoutGroup:vk,VideoPlayer:pn,Vignette:mf,VisibilityAction:e0,Voip:Kd,Volume:i0,VolumeParameter:je,VolumeProfile:Vy,WebARCameraBackground:AS,WebARSessionRoot:Xs,WebXR:l0,WebXRButtonFactory:Dh,WebXRImageTracking:Pc,WebXRImageTrackingModel:Ql,WebXRPlaneTracking:uu,WebXRTrackedImage:vh,XRControllerFollow:P0,XRControllerModel:Rl,XRControllerMovement:Uo,XRFlag:Dn,XRRig:vS,XRState:ss,__Ignore:cO},Symbol.toStringTag,{value:"Module"}));class C7 extends se{constructor(){super(...arguments);c(this,"toggleKey","KeyP")}update(){this.context.input.isKeyDown(this.toggleKey)&&this.context.domElement.classList.toggle("presentation-mode")}}D.add("__Ignore",cO);D.add("ActionBuilder",At);D.add("ActionCollection",oM);D.add("ActionModel",ur);D.add("AlignmentConstraint",Uy);D.add("Animation",Ps);D.add("AnimationCurve",Tl);D.add("AnimationExtension",Hy);D.add("AnimationTrackHandler",IC);D.add("Animator",zn);D.add("AnimatorController",to);D.add("Antialiasing",Wy);D.add("AudioExtension",Zh);D.add("AudioListener",Rh);D.add("AudioSource",kt);D.add("AudioTrackHandler",bd);D.add("Avatar",Yd);D.add("Avatar_Brain_LookAt",Bv);D.add("Avatar_MouthShapes",Yy);D.add("Avatar_MustacheShake",uk);D.add("Avatar_POI",bl);D.add("AvatarBlink_Simple",Jd);D.add("AvatarEyeLook_Rotation",Bc);D.add("AvatarLoader",dk);D.add("AvatarMarker",un);D.add("AvatarModel",DC);D.add("AxesHelper",Vg);D.add("BaseUIComponent",Fo);D.add("BasicIKConstraint",fk);D.add("BehaviorExtension",OC);D.add("BehaviorModel",Ki);D.add("Bloom",_l);D.add("BoxCollider",qg);D.add("BoxGizmo",$d);D.add("BoxHelperComponent",So);D.add("Button",jc);D.add("CallInfo",_g);D.add("Camera",Bt);D.add("CameraTargetReachedEvent",Iv);D.add("Canvas",fn);D.add("CanvasGroup",zh);D.add("CapsuleCollider",Oc);D.add("ChangeMaterialOnClick",gl);D.add("ChangeTransformOnClick",ef);D.add("CharacterController",tf);D.add("CharacterControllerInput",Hc);D.add("ChromaticAberration",t0);D.add("Collider",ro);D.add("ColorAdjustments",eu);D.add("ColorBySpeedModule",nf);D.add("ColorOverLifetimeModule",r0);D.add("ContactShadows",Mo);D.add("ControlTrackHandler",TC);D.add("CustomBranding",su);D.add("Deletable",Nk);D.add("DeleteBox",qC);D.add("DepthOfField",Ha);D.add("DeviceFlag",XC);D.add("DocumentExtension",Qk);D.add("DragControls",Is);D.add("DropListener",u0);D.add("Duplicatable",af);D.add("EmissionModule",Ol);D.add("EmphasizeOnClick",Zg);D.add("EventList",dn);D.add("EventListEvent",xC);D.add("EventSystem",pr);D.add("EventTrigger",$C);D.add("FieldWithDefault",Dk);D.add("FixedJoint",jk);D.add("FlyControls",Gk);D.add("Fog",im);D.add("GltfExport",_a);D.add("GltfExportBox",Wk);D.add("Gradient",tu);D.add("Graphic",wl);D.add("GraphicRaycaster",CC);D.add("GridHelper",nm);D.add("GridLayoutGroup",bk);D.add("GroundProjectedEnv",lf);D.add("GroupActionModel",ph);D.add("HideOnStart",_k);D.add("HingeJoint",f0);D.add("HorizontalLayoutGroup",yk);D.add("Image",Kg);D.add("InheritVelocityModule",Ll);D.add("InputField",Wr);D.add("InstanceHandle",wd);D.add("InstancingHandler",_d);D.add("Interactable",Uk);D.add("Keyframe",Qo);D.add("Light",wr);D.add("LimitVelocityOverLifetimeModule",Ji);D.add("LODGroup",m0);D.add("LODModel",cf);D.add("LogStats",qk);D.add("LookAt",xl);D.add("LookAtConstraint",Xd);D.add("MainModule",ls);D.add("MaskableGraphic",Jy);D.add("MeshCollider",Zd);D.add("MeshRenderer",s0);D.add("MinMaxCurve",Se);D.add("MinMaxGradient",Un);D.add("NeedleMenu",Fl);D.add("NestedGltf",rS);D.add("Networking",Bl);D.add("NoiseModule",Lt);D.add("ObjectRaycaster",no);D.add("OffsetConstraint",hf);D.add("OpenURL",rm);D.add("OrbitControls",Et);D.add("Outline",Xg);D.add("Padding",$h);D.add("ParticleBurst",Ov);D.add("ParticleSubEmitter",fS);D.add("ParticleSystem",gi);D.add("ParticleSystemRenderer",Ho);D.add("PhysicsExtension",HC);D.add("PixelationEffect",S0);D.add("PlayableDirector",Rc);D.add("PlayAnimationOnClick",Ia);D.add("PlayAudioOnClick",jh);D.add("PlayerColor",Eg);D.add("PlayerState",ns);D.add("PlayerSync",Hg);D.add("PointerEventData",zg);D.add("PostProcessingHandler",zC);D.add("PreliminaryAction",$g);D.add("PreliminaryTrigger",$y);D.add("PresentationMode",C7);D.add("RawImage",NC);D.add("Rect",mk);D.add("RectTransform",jn);D.add("ReflectionProbe",ml);D.add("RegisteredAnimationInfo",RC);D.add("RemoteSkybox",Pl);D.add("Renderer",ci);D.add("RendererLightmap",Mv);D.add("RGBAColor",Ot);D.add("Rigidbody",Pt);D.add("RotationBySpeedModule",oo);D.add("RotationOverLifetimeModule",jo);D.add("SceneSwitcher",Os);D.add("ScreenCapture",lu);D.add("ScreenSpaceAmbientOcclusion",Wc);D.add("ScreenSpaceAmbientOcclusionN8",Wa);D.add("SetActiveOnClick",Vr);D.add("ShadowCatcher",E0);D.add("ShapeModule",Xt);D.add("SignalAsset",zy);D.add("SignalReceiver",Tc);D.add("SignalReceiverEvent",Gg);D.add("SignalTrackHandler",Tv);D.add("Size",gk);D.add("SizeBySpeedModule",Zs);D.add("SizeOverLifetimeModule",iu);D.add("SkinnedMeshRenderer",kk);D.add("SmoothFollow",ka);D.add("SpatialGrabRaycaster",Sv);D.add("SpatialHtml",T0);D.add("SpatialTrigger",kh);D.add("SpatialTriggerReceiver",Cl);D.add("SpectatorCamera",gS);D.add("SphereCollider",Wg);D.add("Sprite",Vc);D.add("SpriteData",tm);D.add("SpriteRenderer",Go);D.add("SpriteSheet",o0);D.add("SubEmitterSystem",Wv);D.add("SyncedCamera",Cd);D.add("SyncedRoom",qc);D.add("SyncedTransform",Qh);D.add("TapGestureTrigger",wk);D.add("TeleportTarget",GC);D.add("TestRunner",rO);D.add("TestSimulateUserData",oO);D.add("Text",ks);D.add("TextBuilder",VC);D.add("TextExtension",c0);D.add("TextureSheetAnimationModule",cs);D.add("TiltShiftEffect",Nl);D.add("ToneMapping",R0);D.add("TrailModule",Ai);D.add("TransformData",Yi);D.add("TransformGizmo",gf);D.add("TriggerBuilder",Ln);D.add("TriggerModel",Ic);D.add("UIRaycastUtils",SC);D.add("UIRootComponent",Ny);D.add("UsageMarker",h0);D.add("USDZExporter",li);D.add("USDZText",Ah);D.add("USDZUIExtension",WC);D.add("VariantAction",rM);D.add("VelocityOverLifetimeModule",Si);D.add("VerticalLayoutGroup",vk);D.add("VideoPlayer",pn);D.add("Vignette",mf);D.add("VisibilityAction",e0);D.add("Voip",Kd);D.add("Volume",i0);D.add("VolumeParameter",je);D.add("VolumeProfile",Vy);D.add("WebARCameraBackground",AS);D.add("WebARSessionRoot",Xs);D.add("WebXR",l0);D.add("WebXRButtonFactory",Dh);D.add("WebXRImageTracking",Pc);D.add("WebXRImageTrackingModel",Ql);D.add("WebXRPlaneTracking",uu);D.add("WebXRTrackedImage",vh);D.add("XRControllerFollow",P0);D.add("XRControllerModel",Rl);D.add("XRControllerMovement",Uo);D.add("XRFlag",Dn);D.add("XRRig",vS);D.add("XRState",ss);const Gp=Fn,S7=N("debugtypestore");S7&&console.log(D);function E7(n,t){const i=N8(n,t);return i!==void 0?i:null}const I7=new U8,p_=Symbol("deserialize-queue");async function T7(n,t,e,i=null,s){if(!e)return;let r=i;typeof r=="number"&&(r=new Qn(i));const o=t.indexOf("?");t=o===-1?t:t.substring(0,o);const a=new FM(e.scene);a.gltfId=t,a.context=n,a.gltf=e,a.nodeToObject=s==null?void 0:s.nodeToObjectMap,a.implementationInformation=I7;let l=n[p_];if(l||(l=n[p_]=[]),e.scenes)for(const h of e.scenes)await sx(a,h,l);if(e.children)for(const h of e.children)await sx(a,h,l);n.new_scripts_pre_setup_callbacks.push(()=>{const h=n[p_];if(h){for(const u of h)R7(u,a);h.length=0}if(r){const u={},d=[];nx(e,r,u,d);for(const f of e.scenes)nx(f,r,u,d);for(const f of d)f.resolveGuids(u)}})}const ix=Symbol("original-component-name"),Ru=new Map;function nx(n,t,e,i){if(t===null||!n)return;const s=n.guid,r=n.guid;r!=null&&r.length&&(Ru.has(r)||(Gp&&console.log('Creating InstanceIdProvider with key "'+r+'" for object '+n.name),Ru.set(r,new Qn(r))));const o=r&&Ru.get(r)||t;if(n.guid=o.generateUUID(),s&&s!=="invalid"&&(e[s]=n.guid),n&&n.userData&&n.userData.components)for(const a of n.userData.components){if(a===null)continue;const l=a.guid;l?Ru.has(l)||(Gp&&console.log('Creating InstanceIdProvider with key "'+l+'" for component '+a[ix]),Ru.set(l,new Qn(l))):Gp&&console.warn("Can not create IdProvider: component "+a[ix]+" has no guid",a.guid);const h=Ru.get(l)||t,u=a.guid;a.guid=h.generateUUID(),u&&u!=="invalid"&&(e[u]=a.guid),a.resolveGuids&&i.push(a)}if(n.children)for(const a of n.children)nx(a,t,e,i)}const Gf=[];async function sx(n,t,e,i){if(!t)return;const s=t.userData;if(s){const r=s.builtin_components;if(r&&r.length>0)for(const o of r)try{if(o===null)continue;const a=D.get(o.name);if(a!=null){const l=new a;l.sourceId=n.gltfId,Dd(l,o,n.implementationInformation),l.context=n.context,"guid"in o&&(l[TA]=o.guid),l[ix]=o.name,Sh(t,l,!1),e.push({instance:l,compData:o,obj:t}),l.isCamera&&n.context&&n.context.mainCamera===null&&l.tag==="MainCamera"&&n.context.setCurrentCamera(l)}else Gp&&console.debug("unknown component: "+o.name),Gf.includes(o.name)||Gf.push(o.name)}catch(a){console.error(o.name+" - "+a.message,a)}if(Gf.length>0){const o=Gf.join(", ");console.warn("unknown components: "+o),Gf.length=0,qs()&&Ci(`<strong>Unknown components in scene</strong>:

${o}

This could mean you forgot to add a npmdef to your ExportInfo
<a href="https://engine.needle.tools/docs/project_structure.html#creating-and-installing-a-npmdef" target="_blank">documentation</a>`,Ui.Warn)}}if(t.children)for(const r of t.children)await sx(n,r,e)}function R7(n,t){const{instance:e,compData:i,obj:s}=n;t.object=s,t.target=e,ow(e,i,t),Gp&&console.debug("add "+i.name,i,e)}class hO{createBuiltinComponents(t,e,i,s,r){return T7(t,e,i,s,r)}writeBuiltinComponentData(t,e){return E7(t,e)}parseSync(t,e,i,s){return B7(t,e,i,s)}loadSync(t,e,i,s,r){return gO(t,e,i,s,r)}}nB(hO);const uO=N("printGltf")||N("printgltf"),dO=N("downloadgltf");var Mc;(function(n){n[n.BeforeLoad=0]="BeforeLoad",n[n.AfterLoaded=1]="AfterLoaded",n[n.FinishedSetup=10]="FinishedSetup"})(Mc||(Mc={}));class Sd{constructor(t,e,i,s){c(this,"context");c(this,"loader");c(this,"path");c(this,"gltf");this.context=t,this.path=e,this.loader=i,this.gltf=s}}const Dc={};function RX(n,t){Dc[n]=Dc[n]||[],Dc[n].push(t)}function BX(n,t){if(Dc[n]){const e=Dc[n].indexOf(t);e>=0&&Dc[n].splice(e,1)}}function Ed(n,t){if(Dc[n])for(const e of Dc[n])e(t)}async function fO(n,t,e,i,s){uO&&console.warn("glTF",t,e),t.includes("?")&&(t=t.split("?")[0]),await La().createBuiltinComponents(n,t,e,i,s)}async function pO(n,t){switch((n.split("?")[0].split(".").pop()||"").toLowerCase()){case"fbx":return new yQ;case"obj":return new LQ}const i=new Fc;return await Bk(i,t,n),i}async function B7(n,t,e,i){typeof e!="string"&&(console.warn("Parse gltf binary without path, this might lead to errors in resolving extensions. Please provide the source path of the gltf/glb file",e,typeof e),e=""),uO&&console.log("Parse glTF",e);const s=await pO(e,n);if(!(s instanceof Fc)){const o=s.parse(t,e);return{animations:o.animations,scene:o,scenes:[o]}}const r=Rk(s);return new Promise((o,a)=>{try{let l=e.split("?")[0].trimEnd();if(l.endsWith(".glb")||l.endsWith(".gltf")){const u=l.split("/");u.pop(),l=u.join("/"),l.endsWith("/")||(l+="/")}s.resourcePath=l,wy(s,n),Ed(Mc.BeforeLoad,new Sd(n,e,s));const h=n.mainCamera;s.parse(t,"",async u=>{Pk(e,u,n),Ed(Mc.AfterLoaded,new Sd(n,e,s,u)),await fO(n,e,u,i,r),await mO(u.scene,n,h),Ed(Mc.FinishedSetup,new Sd(n,e,s,u)),o(u),dO&&AO(t)},u=>{console.error("failed loading "+e,u),o(void 0)})}catch(l){console.error(l),a(l)}})}async function gO(n,t,e,i,s){P7(t);const r=await pO(t,n);if(!(r instanceof Fc)){const a=await r.loadAsync(t,s);return a.traverseVisible(l=>{if(l instanceof J&&l.material instanceof up){const h=l.material;l["material:source"]=h,l.material=new mr;for(const u of Object.keys(h))u!=="type"&&l.material[u]!==void 0&&(l.material[u]=h[u])}}),{animations:a.animations,scene:a,scenes:[a]}}const o=Rk(r);return new Promise((a,l)=>{try{wy(r,n),Ed(Mc.BeforeLoad,new Sd(n,t,r));const h=n.mainCamera;r.load(t,async u=>{Pk(t,u,n),Ed(Mc.AfterLoaded,new Sd(n,t,r,u)),await fO(n,e,u,i,o),await mO(u.scene,n,h),Ed(Mc.FinishedSetup,new Sd(n,t,r,u)),a(u),dO&&AO(t)},u=>{s==null||s.call(r,u)},u=>{console.error("failed loading "+t,u),a(void 0)})}catch(h){console.error(h),l(h)}})}async function mO(n,t,e){e||(e=t.mainCamera),e?await t.renderer.compileAsync(n,e,t.scene):wz(n,t)}function P7(n){if(new URL(n,window.location.href).href.startsWith("file://")){const e=`Hi - it looks like you are trying to load a local file which will not work. You need to use a webserver to serve your files.
Please refer to the documentation on <a href="https://fwd.needle.tools/needle-engine/docs/local-server">https://docs.needle.tools</a> or ask for help in our <a href="https://discord.needle.tools">discord community</a>`;Ci(e),console.warn(e)}}function AO(n){if(typeof n=="string"){const t=document.createElement("a");t.href=n,t.download=n.split("/").pop(),t.click()}else{const t=new Blob([n],{type:"application/octet-stream"}),e=window.URL.createObjectURL(t),i=document.createElement("a");i.href=e,i.download="download.glb",i.click()}}nB(hO);const ti=N("debugwebcomponent"),fR="needle-engine",vO="vr",yO="desktop",M7=[bP,vO,yO],Hf="ar-session-active",Vf="desktop-session-active",D7=["hash","src","camera-controls","loadstart","progress","loadfinished","dracoDecoderPath","dracoDecoderType","ktx2DecoderPath"];class bO extends HTMLElement{constructor(){super();c(this,"_context");c(this,"_overlay_ar");c(this,"_loadingProgress01",0);c(this,"_loadingView");c(this,"_previousSrc",null);c(this,"_didFullyLoad",!1);c(this,"_loadId",0);c(this,"_abortController",null);c(this,"_lastSourceFiles",null);c(this,"_createContextPromise",null);c(this,"onXRSessionStarted",()=>{var i;const e=this.context.xrSessionMode;e==="immersive-ar"?this.onEnterAR(this.context.xrSession):e==="immersive-vr"&&this.onEnterVR(this.context.xrSession),(i=this.context.xrSession)==null||i.addEventListener("end",()=>{this.dispatchEvent(new CustomEvent("xr-session-ended",{detail:{session:this.context.xrSession,context:this._context,sessionMode:e}})),e==="immersive-ar"?this.onExitAR(this.context.xrSession):e==="immersive-vr"&&this.onExitVR(this.context.xrSession)})});c(this,"onReady",()=>{var e;return(e=this._loadingView)==null?void 0:e.onLoadingFinished()});c(this,"onError",()=>{var e;return(e=this._loadingView)==null?void 0:e.setMessage("Loading failed!")});c(this,"_previouslyRegisteredMap",new Map);this._overlay_ar=new GN,this.addEventListener("ready",this.onReady),zD(),this.attachShadow({mode:"open"});const e=document.createElement("template");e.innerHTML=`<style>
    @import url('https://fonts.googleapis.com/css2?family=Roboto+Flex:opsz,wght@8..144,100..1000&display=swap');

    :host {
        position: absolute;
        display: block;
        width: max(600px, 100%);
        height: max(300px, 100%);
    }

    @media (max-width: 600px) {
        :host {
            width: 100%;
        }
    }
    @media (max-height: 300px) {
        :host {
            height: 100%;
        }
    }
    :host canvas {   
        position: absolute;
        user-select: none;
        /** allow touch panning but no pinch zoom **/
        /** but this doesnt work yet: 
         * touch-action: pan-x, pan-y;
         **/
    }
    :host .content {
        position: absolute;
        width: 100%;
        height: 100%;
        visibility: visible;
        z-index: 500; /* < must be less than the webxr buttons element */
        pointer-events: none;
    }
    :host .overlay-content {
        position: absolute;
        user-select: auto;
        pointer-events: all;
    }
    :host slot[name="quit-ar"]:hover {
        cursor: pointer;
    }
    :host .quit-ar-button {
        position: absolute;
        // top: env(titlebar-area-y); /** this doesnt work **/
        top: 60px; /** camera access needs a bit more space **/
        right: 20px;
        z-index: 9999;
    }
</style>
<div> <!-- this wrapper is necessary for WebXR https://github.com/meta-quest/immersive-web-emulator/issues/55 -->
    <canvas></canvas>
</div>
<div class="content">
    <slot class="overlay-content"></slot>
</div>
`,this.shadowRoot&&this.shadowRoot.appendChild(e.content.cloneNode(!0)),this._context=new Ne({domElement:this}),this.addEventListener("error",this.onError)}static get observedAttributes(){return D7}get loadingProgress01(){return this._loadingProgress01}get loadingFinished(){return this.loadingProgress01>.999}get cameraControls(){const e=this.getAttribute("camera-controls");return e==null?null:!(e===null||e==="False"||e==="false"||e==="0")}getContext(){return new Promise((e,i)=>{if(this._context&&this.loadingFinished)e(this._context);else{const s=()=>{this.removeEventListener("loadfinished",s),this._context&&this.loadingFinished&&e(this._context)};this.addEventListener("loadfinished",s)}})}get context(){return this._context}async connectedCallback(){if(ti&&console.log("<needle-engine> connected"),this.addEventListener("xr-session-started",this.onXRSessionStarted),this.onSetupDesktop(),!this.getAttribute("src")){const i=globalThis["needle:codegen_files"];ti&&console.log('src is null, trying to load from globalThis["needle:codegen_files"]',i),i&&(ti&&console.log('globalThis["needle:codegen_files"]',i),this.setAttribute("src",i))}ti&&console.log("src",this.getAttribute("src"));const e=this._loadId;setTimeout(()=>{this.isConnected!==!1&&e===this._loadId&&this.onLoad()},1),Eo!=null&&Eo.length&&this.setAttribute("version",Eo)}disconnectedCallback(){var s;this.removeEventListener("xr-session-started",this.onXRSessionStarted),this._didFullyLoad=!1;const e=this.getAttribute("keep-alive"),i=e==null||(e==null?void 0:e.length)>0&&e!=="true"&&e!=="1";ti&&console.warn('<needle-engine> disconnected, keep-alive: "'+e+'"',typeof e,"Dispose=",i),i?(ti&&console.warn("<needle-engine> dispose"),(s=this._context)==null||s.dispose(),this._context=null,this._lastSourceFiles=null,this._loadId+=1):ti&&console.warn("<needle-engine> is not disposed because keep-alive is set")}attributeChangedCallback(e,i,s){switch(ti&&console.log("attributeChangedCallback",e,i,s),e){case"src":ti&&console.warn(`<needle-engine src>
changed from "`,i,'" to "',s,'"'),this.onLoad();break;case"hash":this._context&&(this._context.hash=s);break;case"loadstart":case"progress":case"loadfinished":typeof s=="string"&&s.length>0&&(ti&&console.log(e+" attribute changed",s),this.registerEventFromAttribute(e,s));break;case"dracoDecoderPath":ti&&console.log("dracoDecoderPath",s),kE(s);break;case"dracoDecoderType":s==="wasm"||s==="js"?(ti&&console.log("dracoDecoderType",s),OE(s)):console.error("Invalid dracoDecoderType",s,"expected js or wasm");break;case"ktx2DecoderPath":ti&&console.log("ktx2DecoderPath",s),LE(s);break}}async onLoad(){var g,m;if(!this.isConnected)return;if(this._context||(ti&&console.warn("Create new context"),this._context=new Ne({domElement:this})),!this._context){console.error("Needle Engine: Context not initialized");return}const e=this.getSourceFiles();if(!this.checkIfSourceHasChanged(e,this._lastSourceFiles))return;this._abortController&&(ti&&console.warn("Abort previous loading process"),this._abortController.abort(),this._abortController=null),this._lastSourceFiles=e;const i=++this._loadId;if((e==null||e.length<=0)&&(ti&&console.warn("Clear scene",e),this._context.clear(),i!==this._loadId))return;const s=this.getAttribute("alias");this.classList.add("loading");const r=Sc();this.ensureLoadStartIsRegistered();let o=this.dispatchEvent(new CustomEvent("loadstart",{detail:{context:this._context,alias:s},cancelable:!0}));if(r){const v=this.getAttribute("hide-loading-overlay");v!=null&&v!=="0"&&(o=!1)}o===!1&&!r&&(xe()||(o=!0),console.warn("Needle Engine: You need a commercial license to override the default loading view. Visit https://needle.tools/pricing"),xe()&&Yt('You need a <a target="_blank" href="https://needle.tools/pricing">commercial license</a> to override the default loading view. This will not work in production.')),!this._loadingView&&o&&(this._loadingView=new RA(this)),o&&(this._didFullyLoad!==!0?(g=this._loadingView)==null||g.onLoadingBegin("begin load"):setTimeout(()=>{this._loadingView&&this._loadingProgress01<.3&&this._loadId===i&&this._loadingView.onLoadingBegin("begin load")},300)),ti&&console.warn(`--------------
Needle Engine: Begin loading `+i+`
`,e),this.onBeforeBeginLoading();const a=[],l={context:this._context,name:"",progress:{},index:0,count:e.length,totalProgress01:this._loadingProgress01},h=new CustomEvent("progress",{detail:l}),u=new Array,d=new AbortController;this._abortController=d;const f={files:e,abortSignal:d.signal,onLoadingProgress:v=>{var b;if(d.signal.aborted)return;const y=v.index;!u[y]&&v.name&&(u[y]=k7(v.name)),v.name=u[y],o&&((b=this._loadingView)==null||b.onLoadingUpdate(v)),l.name=v.name,l.progress=v.progress,this._loadingProgress01=yP(v),l.totalProgress01=this._loadingProgress01,this.dispatchEvent(h)},onLoadingFinished:(v,y,b)=>{d.signal.aborted||b&&a.push({src:y,file:b})}},p=this.getAttribute("hash");if(p!=null&&(this._context.hash=p),this._context.alias=s,this._createContextPromise=this._context.create(f),await this._createContextPromise,ti&&console.warn(`--------------
Needle Engine: finished loading `+i+`
`,e,`Aborted? ${d.signal.aborted}`),this._loadId!==i||d.signal.aborted){console.log("Loading finished but aborted...");return}this._loadingProgress01=1,o&&((m=this._loadingView)==null||m.onLoadingUpdate(1,"creating scene")),this._didFullyLoad=!0,this.classList.remove("loading"),this.classList.add("loading-finished"),this.dispatchEvent(new CustomEvent("loadfinished",{detail:{context:this._context,src:s,loadedFiles:a}}))}internalSetLoadingMessage(e){var i;(i=this._loadingView)==null||i.setMessage(e)}getSourceFiles(){const e=this.getAttribute("src");if(!e)return[];let i;Array.isArray(e)?i=e:e.startsWith("[")&&e.endsWith("]")?i=JSON.parse(e):e.includes(",")?i=e.split(","):i=[e];for(let s=i.length-1;s>=0;s--){const r=i[s];(r==="null"||r==="undefined"||(r==null?void 0:r.length)<=0)&&i.splice(s,1)}return i}checkIfSourceHasChanged(e,i){if((e==null?void 0:e.length)!==(i==null?void 0:i.length)||e==null&&i!==null||e!==null&&i==null)return!0;if(e!==null&&i!==null){for(let s=0;s<(e==null?void 0:e.length);s++)if(e[s]!==i[s])return!0}return!1}ensureLoadStartIsRegistered(){const e=this.getAttribute("loadstart");e&&this.registerEventFromAttribute("loadstart",e)}registerEventFromAttribute(e,i){const s=this._previouslyRegisteredMap.get(e);if(s&&(this._previouslyRegisteredMap.delete(e),this.removeEventListener(e,s)),typeof i=="string"&&i.length>0)try{const r=(0,eval)(i);typeof r=="function"&&(this._previouslyRegisteredMap.set(e,r),this.addEventListener(e,o=>r==null?void 0:r.call(globalThis,this._context,o)))}catch(r){console.error("Error registering event "+e+'="'+i+`" failed with the following error:
`,r)}}getAROverlayContainer(){return this._overlay_ar.createOverlayContainer(this)}getVROverlayContainer(){for(let e=0;e<this.children.length;e++){const i=this.children[e];if(i.classList.contains("vr"))return i}return null}onEnterAR(e){var s;this.onSetupAR();const i=this.getAROverlayContainer();this._overlay_ar.onBegin(this._context,i,e),this.dispatchEvent(new CustomEvent("enter-ar",{detail:{session:e,context:this._context,htmlContainer:(s=this._overlay_ar)==null?void 0:s.ARContainer}}))}onExitAR(e){var i;this._overlay_ar.onEnd(this._context),this.onSetupDesktop(),this.dispatchEvent(new CustomEvent("exit-ar",{detail:{session:e,context:this._context,htmlContainer:(i=this._overlay_ar)==null?void 0:i.ARContainer}}))}onEnterVR(e){this.onSetupVR(),this.dispatchEvent(new CustomEvent("enter-vr",{detail:{session:e,context:this._context}}))}onExitVR(e){this.onSetupDesktop(),this.dispatchEvent(new CustomEvent("exit-vr",{detail:{session:e,context:this._context}}))}onSetupAR(){this.classList.add(Hf),this.classList.remove(Vf);const e=this.getAROverlayContainer();ti&&console.warn("onSetupAR:",e),e&&(e.classList.add(Hf),e.classList.remove(Vf)),this.foreachHtmlElement(i=>this.setupElementsForMode(i,bP))}onSetupVR(){this.classList.remove(Hf),this.classList.remove(Vf),this.foreachHtmlElement(e=>this.setupElementsForMode(e,vO))}onSetupDesktop(){this.classList.remove(Hf),this.classList.add(Vf);const e=this.getAROverlayContainer();e&&(e.classList.remove(Hf),e.classList.add(Vf)),this.foreachHtmlElement(i=>this.setupElementsForMode(i,yO))}setupElementsForMode(e,i,s=null){var o,a;if(e===((a=(o=this._context)==null?void 0:o.renderer)==null?void 0:a.domElement)||e.id==="VRButton"||e.id==="ARButton")return;if(e.classList.contains(i))e.style.visibility="visible",e.style.display==="none"&&(e.style.display="block");else for(const l of M7)e.classList.contains(l)&&(e.style.visibility="hidden",e.style.display="none")}foreachHtmlElement(e){for(let i=0;i<this.children.length;i++){const s=this.children[i];s.style&&e(s)}}onBeforeBeginLoading(){const e=this.getAttribute("dracoDecoderPath");e&&(ti&&console.log("using custom draco decoder path",e),kE(e));const i=this.getAttribute("dracoDecoderType");i&&(ti&&console.log("using custom draco decoder type",i),OE(i));const s=this.getAttribute("ktx2DecoderPath");s&&(ti&&console.log("using custom ktx2 decoder path",s),LE(s))}}typeof window<"u"&&!window.customElements.get(fR)&&window.customElements.define(fR,bO);function k7(n){if(n.startsWith("blob:"))return"blob";const t=n.split("/");let e=t[t.length-1];const i=e.indexOf("?");i>0&&(e=e.substring(0,i));const s=e.indexOf("=");s>0&&(e=e.substring(s));const r=e.split(".").pop();if((r==="glb"||r==="gltf")&&(e=e.substring(0,e.length-4)),e=decodeURIComponent(e),e.length>3){let o="";for(let a=0;a<e.length;a++){let l=e[a];if(l===" "&&o.length<=0)continue;const h=o.length===0,u=l>="0"&&l<="9";h==!1&&l===l.toUpperCase()&&!u?o+=" "+l:(h&&(l=l.toUpperCase()),o+=l)}return ti&&console.log("displayName",e,o),o}return ti&&console.log("displayName",e),e}const O7=Object.freeze(Object.defineProperty({__proto__:null,NeedleEngineHTMLElement:bO},Symbol.toStringTag,{value:"Module"}));function L7(){vl.registerWaitForAllowAudio(()=>{const n=$2.getContext();n.addEventListener("statechange",()=>{setTimeout(()=>{const t=n.state;(t==="suspended"||t==="interrupted")&&n.resume().then(()=>{console.log("AudioContext resumed successfully")}).catch(e=>{console.log("Failed to resume AudioContext: "+e)})},500)})})}setTimeout(L7,1e3);const KA=N("debughotreload");let Ig=!1;const Hp=new Map;function PX(){return Ig}function MX(n){var i;if(Ig)return;const e=n.constructor.name;Hp.has(e)?(i=Hp.get(e))==null||i.push(n):Hp.set(e,[n])}function DX(n){if(Ig)return;const e=n.constructor.name,i=Hp.get(e);if(!i)return;const s=i.indexOf(n);s!==-1&&i.splice(s,1)}let pR=!1;function F7(){if(KA||pR)return;pR=!0;const n=console.error;console.error=(...t)=>{if(t.length){const e=t[0];if(typeof e=="string"&&e.includes("[hmr] Failed to reload ")){console.log("[Needle Engine] Hot reloading failed"),window.location.reload();return}}n.apply(console,t)}}function kX(n){KA&&console.log("[HMR] Apply changes",n,Object.keys(n)),F7();for(const t of Object.keys(n))try{Ig=!0;const e=D.get(t);if(!e){KA&&console.log("[HMR] Type not found: "+t);continue}const i=n[t],s=Hp.get(i.name);let r="[Needle Engine] Updating type: "+t;const o=(s==null?void 0:s.length)??-1;o>0?r+=" x"+o:r+=" - no instances",console.log(r);const a=Object.getOwnPropertyNames(e.prototype),l=Object.getOwnPropertyDescriptors(i.prototype);for(const h in l)l[h].writable&&(e.prototype[h]=n[t].prototype[h]);for(const h of a)l[h]||delete e.prototype[h];if(s){const h=new i,u=Object.getOwnPropertyDescriptors(h);for(const d of s){const f=d,p=f.isComponent===!0,g=p?f.activeAndEnabled:!0,m=p?f.context:void 0;try{if(p&&m&&cl(f,m),p&&g&&(f.enabled=!1),d.onBeforeHotReloadFields&&d.onBeforeHotReloadFields()===!1)continue;for(const v in u)if(u[v].writable){if(d[v]===void 0)d[v]=h[v];else if(typeof d[v]=="function"&&!d[v].prototype){const b=d[v],_=b.name,x="bound ";if(_===x)continue;const S=b.name.substring(x.length),T=i.prototype[S];T&&(d[v]=T.bind(d))}}d.onAfterHotReloadFields&&d.onAfterHotReloadFields()}finally{p&&m&&eC(f,m),p&&g&&(f.enabled=!0)}}}}catch(e){if(KA)console.error(e);else return!1}finally{Ig=!1,xa(Ui.Log,"Script changes applied (HMR)")}return!0}let oe;const Tg=new Array(128).fill(void 0);Tg.push(void 0,null,!0,!1);Tg.length;let bA=null;function gR(){return bA!==null&&bA.byteLength!==0||(bA=new Int32Array(oe.memory.buffer)),bA}const U7=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&U7.decode();function Ee(n,t){if(!(n instanceof t))throw new Error(`expected instance of ${t.name}`);return n.ptr}let _A=null;function N7(){return _A!==null&&_A.byteLength!==0||(_A=new Float32Array(oe.memory.buffer)),_A}let Vp=128;function mR(n){if(Vp==1)throw new Error("out of js stack");return Tg[--Vp]=n,Vp}let wA=null;function Q7(){return wA!==null&&wA.byteLength!==0||(wA=new Uint32Array(oe.memory.buffer)),wA}let ar=0;function nh(n,t){const e=t(4*n.length,4)>>>0;return N7().set(n,e/4),ar=n.length,e}function xA(n,t){const e=t(4*n.length,4)>>>0;return Q7().set(n,e/4),ar=n.length,e}const Cn=Object.freeze({Ball:0,0:"Ball",Cuboid:1,1:"Cuboid",Capsule:2,2:"Capsule",Segment:3,3:"Segment",Polyline:4,4:"Polyline",Triangle:5,5:"Triangle",TriMesh:6,6:"TriMesh",HeightField:7,7:"HeightField",Compound:8,8:"Compound",ConvexPolyhedron:9,9:"ConvexPolyhedron",Cylinder:10,10:"Cylinder",Cone:11,11:"Cone",RoundCuboid:12,12:"RoundCuboid",RoundTriangle:13,13:"RoundTriangle",RoundCylinder:14,14:"RoundCylinder",RoundCone:15,15:"RoundCone",RoundConvexPolyhedron:16,16:"RoundConvexPolyhedron",HalfSpace:17,17:"HalfSpace"});class z7{__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,t}free(){const t=this.__destroy_into_raw();oe.__wbg_raweventqueue_free(t)}constructor(t){const e=oe.raweventqueue_new(t);return this.__wbg_ptr=e>>>0,this}drainCollisionEvents(t){try{oe.raweventqueue_drainCollisionEvents(this.__wbg_ptr,mR(t))}finally{Tg[Vp++]=void 0}}drainContactForceEvents(t){try{oe.raweventqueue_drainContactForceEvents(this.__wbg_ptr,mR(t))}finally{Tg[Vp++]=void 0}}clear(){oe.raweventqueue_clear(this.__wbg_ptr)}}class is{static __wrap(t){t>>>=0;const e=Object.create(is.prototype);return e.__wbg_ptr=t,e}__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,t}free(){const t=this.__destroy_into_raw();oe.__wbg_rawgenericjoint_free(t)}static generic(t,e,i,s){Ee(t,be),Ee(e,be),Ee(i,be);const r=oe.rawgenericjoint_generic(t.__wbg_ptr,e.__wbg_ptr,i.__wbg_ptr,s);return r===0?void 0:is.__wrap(r)}static spring(t,e,i,s,r){Ee(s,be),Ee(r,be);const o=oe.rawgenericjoint_spring(t,e,i,s.__wbg_ptr,r.__wbg_ptr);return is.__wrap(o)}static rope(t,e,i){Ee(e,be),Ee(i,be);const s=oe.rawgenericjoint_rope(t,e.__wbg_ptr,i.__wbg_ptr);return is.__wrap(s)}static spherical(t,e){Ee(t,be),Ee(e,be);const i=oe.rawgenericjoint_spherical(t.__wbg_ptr,e.__wbg_ptr);return is.__wrap(i)}static prismatic(t,e,i,s,r,o){Ee(t,be),Ee(e,be),Ee(i,be);const a=oe.rawgenericjoint_prismatic(t.__wbg_ptr,e.__wbg_ptr,i.__wbg_ptr,s,r,o);return a===0?void 0:is.__wrap(a)}static fixed(t,e,i,s){Ee(t,be),Ee(e,Pn),Ee(i,be),Ee(s,Pn);const r=oe.rawgenericjoint_fixed(t.__wbg_ptr,e.__wbg_ptr,i.__wbg_ptr,s.__wbg_ptr);return is.__wrap(r)}static revolute(t,e,i){Ee(t,be),Ee(e,be),Ee(i,be);const s=oe.rawgenericjoint_revolute(t.__wbg_ptr,e.__wbg_ptr,i.__wbg_ptr);return s===0?void 0:is.__wrap(s)}}class yS{static __wrap(t){t>>>=0;const e=Object.create(yS.prototype);return e.__wbg_ptr=t,e}__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,t}free(){const t=this.__destroy_into_raw();oe.__wbg_rawpointprojection_free(t)}point(){const t=oe.rawpointprojection_point(this.__wbg_ptr);return be.__wrap(t)}isInside(){return oe.rawpointprojection_isInside(this.__wbg_ptr)!==0}}class bS{static __wrap(t){t>>>=0;const e=Object.create(bS.prototype);return e.__wbg_ptr=t,e}__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,t}free(){const t=this.__destroy_into_raw();oe.__wbg_rawrayintersection_free(t)}normal(){const t=oe.rawraycolliderintersection_normal(this.__wbg_ptr);return be.__wrap(t)}toi(){return oe.rawraycolliderintersection_toi(this.__wbg_ptr)}featureType(){return oe.rawpointcolliderprojection_featureType(this.__wbg_ptr)}featureId(){try{const i=oe.__wbindgen_add_to_stack_pointer(-16);oe.rawpointcolliderprojection_featureId(i,this.__wbg_ptr);var t=gR()[i/4+0],e=gR()[i/4+1];return t===0?void 0:e>>>0}finally{oe.__wbindgen_add_to_stack_pointer(16)}}}class Pn{static __wrap(t){t>>>=0;const e=Object.create(Pn.prototype);return e.__wbg_ptr=t,e}__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,t}free(){const t=this.__destroy_into_raw();oe.__wbg_rawrotation_free(t)}constructor(t,e,i,s){const r=oe.rawrotation_new(t,e,i,s);return this.__wbg_ptr=r>>>0,this}static identity(){const t=oe.rawrotation_identity();return Pn.__wrap(t)}get x(){return oe.rawrotation_x(this.__wbg_ptr)}get y(){return oe.rawintegrationparameters_dt(this.__wbg_ptr)}get z(){return oe.rawraycolliderintersection_toi(this.__wbg_ptr)}get w(){return oe.rawintegrationparameters_erp(this.__wbg_ptr)}}class Ke{static __wrap(t){t>>>=0;const e=Object.create(Ke.prototype);return e.__wbg_ptr=t,e}__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,t}free(){const t=this.__destroy_into_raw();oe.__wbg_rawshape_free(t)}static cuboid(t,e,i){const s=oe.rawshape_cuboid(t,e,i);return Ke.__wrap(s)}static roundCuboid(t,e,i,s){const r=oe.rawshape_roundCuboid(t,e,i,s);return Ke.__wrap(r)}static ball(t){const e=oe.rawshape_ball(t);return Ke.__wrap(e)}static halfspace(t){Ee(t,be);const e=oe.rawshape_halfspace(t.__wbg_ptr);return Ke.__wrap(e)}static capsule(t,e){const i=oe.rawshape_capsule(t,e);return Ke.__wrap(i)}static cylinder(t,e){const i=oe.rawshape_cylinder(t,e);return Ke.__wrap(i)}static roundCylinder(t,e,i){const s=oe.rawshape_roundCylinder(t,e,i);return Ke.__wrap(s)}static cone(t,e){const i=oe.rawshape_cone(t,e);return Ke.__wrap(i)}static roundCone(t,e,i){const s=oe.rawshape_roundCone(t,e,i);return Ke.__wrap(s)}static polyline(t,e){const i=nh(t,oe.__wbindgen_malloc),s=ar,r=xA(e,oe.__wbindgen_malloc),o=ar,a=oe.rawshape_polyline(i,s,r,o);return Ke.__wrap(a)}static trimesh(t,e){const i=nh(t,oe.__wbindgen_malloc),s=ar,r=xA(e,oe.__wbindgen_malloc),o=ar,a=oe.rawshape_trimesh(i,s,r,o);return Ke.__wrap(a)}static heightfield(t,e,i,s){const r=nh(i,oe.__wbindgen_malloc),o=ar;Ee(s,be);const a=oe.rawshape_heightfield(t,e,r,o,s.__wbg_ptr);return Ke.__wrap(a)}static segment(t,e){Ee(t,be),Ee(e,be);const i=oe.rawshape_segment(t.__wbg_ptr,e.__wbg_ptr);return Ke.__wrap(i)}static triangle(t,e,i){Ee(t,be),Ee(e,be),Ee(i,be);const s=oe.rawshape_triangle(t.__wbg_ptr,e.__wbg_ptr,i.__wbg_ptr);return Ke.__wrap(s)}static roundTriangle(t,e,i,s){Ee(t,be),Ee(e,be),Ee(i,be);const r=oe.rawshape_roundTriangle(t.__wbg_ptr,e.__wbg_ptr,i.__wbg_ptr,s);return Ke.__wrap(r)}static convexHull(t){const e=nh(t,oe.__wbindgen_malloc),i=ar,s=oe.rawshape_convexHull(e,i);return s===0?void 0:Ke.__wrap(s)}static roundConvexHull(t,e){const i=nh(t,oe.__wbindgen_malloc),s=ar,r=oe.rawshape_roundConvexHull(i,s,e);return r===0?void 0:Ke.__wrap(r)}static convexMesh(t,e){const i=nh(t,oe.__wbindgen_malloc),s=ar,r=xA(e,oe.__wbindgen_malloc),o=ar,a=oe.rawshape_convexMesh(i,s,r,o);return a===0?void 0:Ke.__wrap(a)}static roundConvexMesh(t,e,i){const s=nh(t,oe.__wbindgen_malloc),r=ar,o=xA(e,oe.__wbindgen_malloc),a=ar,l=oe.rawshape_roundConvexMesh(s,r,o,a,i);return l===0?void 0:Ke.__wrap(l)}castShape(t,e,i,s,r,o,a,l,h){Ee(t,be),Ee(e,Pn),Ee(i,be),Ee(s,Ke),Ee(r,be),Ee(o,Pn),Ee(a,be);const u=oe.rawshape_castShape(this.__wbg_ptr,t.__wbg_ptr,e.__wbg_ptr,i.__wbg_ptr,s.__wbg_ptr,r.__wbg_ptr,o.__wbg_ptr,a.__wbg_ptr,l,h);return u===0?void 0:wS.__wrap(u)}intersectsShape(t,e,i,s,r){return Ee(t,be),Ee(e,Pn),Ee(i,Ke),Ee(s,be),Ee(r,Pn),oe.rawshape_intersectsShape(this.__wbg_ptr,t.__wbg_ptr,e.__wbg_ptr,i.__wbg_ptr,s.__wbg_ptr,r.__wbg_ptr)!==0}contactShape(t,e,i,s,r,o){Ee(t,be),Ee(e,Pn),Ee(i,Ke),Ee(s,be),Ee(r,Pn);const a=oe.rawshape_contactShape(this.__wbg_ptr,t.__wbg_ptr,e.__wbg_ptr,i.__wbg_ptr,s.__wbg_ptr,r.__wbg_ptr,o);return a===0?void 0:_S.__wrap(a)}containsPoint(t,e,i){return Ee(t,be),Ee(e,Pn),Ee(i,be),oe.rawshape_containsPoint(this.__wbg_ptr,t.__wbg_ptr,e.__wbg_ptr,i.__wbg_ptr)!==0}projectPoint(t,e,i,s){Ee(t,be),Ee(e,Pn),Ee(i,be);const r=oe.rawshape_projectPoint(this.__wbg_ptr,t.__wbg_ptr,e.__wbg_ptr,i.__wbg_ptr,s);return yS.__wrap(r)}intersectsRay(t,e,i,s,r){return Ee(t,be),Ee(e,Pn),Ee(i,be),Ee(s,be),oe.rawshape_intersectsRay(this.__wbg_ptr,t.__wbg_ptr,e.__wbg_ptr,i.__wbg_ptr,s.__wbg_ptr,r)!==0}castRay(t,e,i,s,r,o){return Ee(t,be),Ee(e,Pn),Ee(i,be),Ee(s,be),oe.rawshape_castRay(this.__wbg_ptr,t.__wbg_ptr,e.__wbg_ptr,i.__wbg_ptr,s.__wbg_ptr,r,o)}castRayAndGetNormal(t,e,i,s,r,o){Ee(t,be),Ee(e,Pn),Ee(i,be),Ee(s,be);const a=oe.rawshape_castRayAndGetNormal(this.__wbg_ptr,t.__wbg_ptr,e.__wbg_ptr,i.__wbg_ptr,s.__wbg_ptr,r,o);return a===0?void 0:bS.__wrap(a)}}class _S{static __wrap(t){t>>>=0;const e=Object.create(_S.prototype);return e.__wbg_ptr=t,e}__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,t}free(){const t=this.__destroy_into_raw();oe.__wbg_rawshapecontact_free(t)}distance(){return oe.rawkinematiccharactercontroller_maxSlopeClimbAngle(this.__wbg_ptr)}point1(){const t=oe.rawpointprojection_point(this.__wbg_ptr);return be.__wrap(t)}point2(){const t=oe.rawraycolliderintersection_normal(this.__wbg_ptr);return be.__wrap(t)}normal1(){const t=oe.rawshapecollidertoi_witness2(this.__wbg_ptr);return be.__wrap(t)}normal2(){const t=oe.rawcharactercollision_translationDeltaApplied(this.__wbg_ptr);return be.__wrap(t)}}class wS{static __wrap(t){t>>>=0;const e=Object.create(wS.prototype);return e.__wbg_ptr=t,e}__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,t}free(){const t=this.__destroy_into_raw();oe.__wbg_rawshapetoi_free(t)}toi(){return oe.rawrotation_x(this.__wbg_ptr)}witness1(){const t=oe.rawshapetoi_witness1(this.__wbg_ptr);return be.__wrap(t)}witness2(){const t=oe.rawcontactforceevent_total_force(this.__wbg_ptr);return be.__wrap(t)}normal1(){const t=oe.rawshapetoi_normal1(this.__wbg_ptr);return be.__wrap(t)}normal2(){const t=oe.rawshapetoi_normal2(this.__wbg_ptr);return be.__wrap(t)}}class be{static __wrap(t){t>>>=0;const e=Object.create(be.prototype);return e.__wbg_ptr=t,e}__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,t}free(){const t=this.__destroy_into_raw();oe.__wbg_rawvector_free(t)}static zero(){const t=oe.rawvector_zero();return be.__wrap(t)}constructor(t,e,i){const s=oe.rawvector_new(t,e,i);return this.__wbg_ptr=s>>>0,this}get x(){return oe.rawrotation_x(this.__wbg_ptr)}set x(t){oe.rawvector_set_x(this.__wbg_ptr,t)}get y(){return oe.rawintegrationparameters_dt(this.__wbg_ptr)}set y(t){oe.rawintegrationparameters_set_dt(this.__wbg_ptr,t)}get z(){return oe.rawraycolliderintersection_toi(this.__wbg_ptr)}set z(t){oe.rawvector_set_z(this.__wbg_ptr,t)}xyz(){const t=oe.rawvector_xyz(this.__wbg_ptr);return be.__wrap(t)}yxz(){const t=oe.rawvector_yxz(this.__wbg_ptr);return be.__wrap(t)}zxy(){const t=oe.rawvector_zxy(this.__wbg_ptr);return be.__wrap(t)}xzy(){const t=oe.rawvector_xzy(this.__wbg_ptr);return be.__wrap(t)}yzx(){const t=oe.rawvector_yzx(this.__wbg_ptr);return be.__wrap(t)}zyx(){const t=oe.rawvector_zyx(this.__wbg_ptr);return be.__wrap(t)}}class j7{constructor(t,e,i){this.x=t,this.y=e,this.z=i}}class ie{static new(t,e,i){return new j7(t,e,i)}static intoRaw(t){return new be(t.x,t.y,t.z)}static zeros(){return ie.new(0,0,0)}static fromRaw(t){if(!t)return null;let e=ie.new(t.x,t.y,t.z);return t.free(),e}static copy(t,e){t.x=e.x,t.y=e.y,t.z=e.z}}class AR{constructor(t,e,i,s){this.x=t,this.y=e,this.z=i,this.w=s}}class Vt{static identity(){return new AR(0,0,0,1)}static fromRaw(t){if(!t)return null;let e=new AR(t.x,t.y,t.z,t.w);return t.free(),e}static intoRaw(t){return new Pn(t.x,t.y,t.z,t.w)}static copy(t,e){t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w}}class G7{constructor(t){this.elements=t}get m11(){return this.elements[0]}get m12(){return this.elements[1]}get m21(){return this.m12}get m13(){return this.elements[2]}get m31(){return this.m13}get m22(){return this.elements[3]}get m23(){return this.elements[4]}get m32(){return this.m23}get m33(){return this.elements[5]}}class vR{static fromRaw(t){const e=new G7(t.elements());return t.free(),e}}var Wp,$n,yR,bR,Li,rx,ki,_R,Xv,ox,wR,Yv,rd;(function(n){n[n.Dynamic=0]="Dynamic",n[n.Fixed=1]="Fixed",n[n.KinematicPositionBased=2]="KinematicPositionBased",n[n.KinematicVelocityBased=3]="KinematicVelocityBased"})(Wp||(Wp={}));class xR{constructor(t,e,i){this.rawSet=t,this.colliderSet=e,this.handle=i}finalizeDeserialization(t){this.colliderSet=t}isValid(){return this.rawSet.contains(this.handle)}lockTranslations(t,e){return this.rawSet.rbLockTranslations(this.handle,t,e)}lockRotations(t,e){return this.rawSet.rbLockRotations(this.handle,t,e)}setEnabledTranslations(t,e,i,s){return this.rawSet.rbSetEnabledTranslations(this.handle,t,e,i,s)}restrictTranslations(t,e,i,s){this.setEnabledTranslations(t,e,i,s)}setEnabledRotations(t,e,i,s){return this.rawSet.rbSetEnabledRotations(this.handle,t,e,i,s)}restrictRotations(t,e,i,s){this.setEnabledRotations(t,e,i,s)}dominanceGroup(){return this.rawSet.rbDominanceGroup(this.handle)}setDominanceGroup(t){this.rawSet.rbSetDominanceGroup(this.handle,t)}additionalSolverIterations(){return this.rawSet.rbAdditionalSolverIterations(this.handle)}setAdditionalSolverIterations(t){this.rawSet.rbSetAdditionalSolverIterations(this.handle,t)}enableCcd(t){this.rawSet.rbEnableCcd(this.handle,t)}translation(){let t=this.rawSet.rbTranslation(this.handle);return ie.fromRaw(t)}rotation(){let t=this.rawSet.rbRotation(this.handle);return Vt.fromRaw(t)}nextTranslation(){let t=this.rawSet.rbNextTranslation(this.handle);return ie.fromRaw(t)}nextRotation(){let t=this.rawSet.rbNextRotation(this.handle);return Vt.fromRaw(t)}setTranslation(t,e){this.rawSet.rbSetTranslation(this.handle,t.x,t.y,t.z,e)}setLinvel(t,e){let i=ie.intoRaw(t);this.rawSet.rbSetLinvel(this.handle,i,e),i.free()}gravityScale(){return this.rawSet.rbGravityScale(this.handle)}setGravityScale(t,e){this.rawSet.rbSetGravityScale(this.handle,t,e)}setRotation(t,e){this.rawSet.rbSetRotation(this.handle,t.x,t.y,t.z,t.w,e)}setAngvel(t,e){let i=ie.intoRaw(t);this.rawSet.rbSetAngvel(this.handle,i,e),i.free()}setNextKinematicTranslation(t){this.rawSet.rbSetNextKinematicTranslation(this.handle,t.x,t.y,t.z)}setNextKinematicRotation(t){this.rawSet.rbSetNextKinematicRotation(this.handle,t.x,t.y,t.z,t.w)}linvel(){return ie.fromRaw(this.rawSet.rbLinvel(this.handle))}angvel(){return ie.fromRaw(this.rawSet.rbAngvel(this.handle))}mass(){return this.rawSet.rbMass(this.handle)}effectiveInvMass(){return ie.fromRaw(this.rawSet.rbEffectiveInvMass(this.handle))}invMass(){return this.rawSet.rbInvMass(this.handle)}localCom(){return ie.fromRaw(this.rawSet.rbLocalCom(this.handle))}worldCom(){return ie.fromRaw(this.rawSet.rbWorldCom(this.handle))}invPrincipalInertiaSqrt(){return ie.fromRaw(this.rawSet.rbInvPrincipalInertiaSqrt(this.handle))}principalInertia(){return ie.fromRaw(this.rawSet.rbPrincipalInertia(this.handle))}principalInertiaLocalFrame(){return Vt.fromRaw(this.rawSet.rbPrincipalInertiaLocalFrame(this.handle))}effectiveWorldInvInertiaSqrt(){return vR.fromRaw(this.rawSet.rbEffectiveWorldInvInertiaSqrt(this.handle))}effectiveAngularInertia(){return vR.fromRaw(this.rawSet.rbEffectiveAngularInertia(this.handle))}sleep(){this.rawSet.rbSleep(this.handle)}wakeUp(){this.rawSet.rbWakeUp(this.handle)}isCcdEnabled(){return this.rawSet.rbIsCcdEnabled(this.handle)}numColliders(){return this.rawSet.rbNumColliders(this.handle)}collider(t){return this.colliderSet.get(this.rawSet.rbCollider(this.handle,t))}setEnabled(t){this.rawSet.rbSetEnabled(this.handle,t)}isEnabled(){return this.rawSet.rbIsEnabled(this.handle)}bodyType(){return this.rawSet.rbBodyType(this.handle)}setBodyType(t,e){return this.rawSet.rbSetBodyType(this.handle,t,e)}isSleeping(){return this.rawSet.rbIsSleeping(this.handle)}isMoving(){return this.rawSet.rbIsMoving(this.handle)}isFixed(){return this.rawSet.rbIsFixed(this.handle)}isKinematic(){return this.rawSet.rbIsKinematic(this.handle)}isDynamic(){return this.rawSet.rbIsDynamic(this.handle)}linearDamping(){return this.rawSet.rbLinearDamping(this.handle)}angularDamping(){return this.rawSet.rbAngularDamping(this.handle)}setLinearDamping(t){this.rawSet.rbSetLinearDamping(this.handle,t)}recomputeMassPropertiesFromColliders(){this.rawSet.rbRecomputeMassPropertiesFromColliders(this.handle,this.colliderSet.raw)}setAdditionalMass(t,e){this.rawSet.rbSetAdditionalMass(this.handle,t,e)}setAdditionalMassProperties(t,e,i,s,r){let o=ie.intoRaw(e),a=ie.intoRaw(i),l=Vt.intoRaw(s);this.rawSet.rbSetAdditionalMassProperties(this.handle,t,o,a,l,r),o.free(),a.free(),l.free()}setAngularDamping(t){this.rawSet.rbSetAngularDamping(this.handle,t)}resetForces(t){this.rawSet.rbResetForces(this.handle,t)}resetTorques(t){this.rawSet.rbResetTorques(this.handle,t)}addForce(t,e){const i=ie.intoRaw(t);this.rawSet.rbAddForce(this.handle,i,e),i.free()}applyImpulse(t,e){const i=ie.intoRaw(t);this.rawSet.rbApplyImpulse(this.handle,i,e),i.free()}addTorque(t,e){const i=ie.intoRaw(t);this.rawSet.rbAddTorque(this.handle,i,e),i.free()}applyTorqueImpulse(t,e){const i=ie.intoRaw(t);this.rawSet.rbApplyTorqueImpulse(this.handle,i,e),i.free()}addForceAtPoint(t,e,i){const s=ie.intoRaw(t),r=ie.intoRaw(e);this.rawSet.rbAddForceAtPoint(this.handle,s,r,i),s.free(),r.free()}applyImpulseAtPoint(t,e,i){const s=ie.intoRaw(t),r=ie.intoRaw(e);this.rawSet.rbApplyImpulseAtPoint(this.handle,s,r,i),s.free(),r.free()}}(function(n){n[n.Revolute=0]="Revolute",n[n.Fixed=1]="Fixed",n[n.Prismatic=2]="Prismatic",n[n.Rope=3]="Rope",n[n.Spring=4]="Spring",n[n.Spherical=5]="Spherical",n[n.Generic=6]="Generic"})($n||($n={})),function(n){n[n.AccelerationBased=0]="AccelerationBased",n[n.ForceBased=1]="ForceBased"}(yR||(yR={})),function(n){n[n.X=1]="X",n[n.Y=2]="Y",n[n.Z=4]="Z",n[n.AngX=8]="AngX",n[n.AngY=16]="AngY",n[n.AngZ=32]="AngZ"}(bR||(bR={}));class ol{constructor(){}static fixed(t,e,i,s){let r=new ol;return r.anchor1=t,r.anchor2=i,r.frame1=e,r.frame2=s,r.jointType=$n.Fixed,r}static spring(t,e,i,s,r){let o=new ol;return o.anchor1=s,o.anchor2=r,o.length=t,o.stiffness=e,o.damping=i,o.jointType=$n.Spring,o}static rope(t,e,i){let s=new ol;return s.anchor1=e,s.anchor2=i,s.length=t,s.jointType=$n.Rope,s}static generic(t,e,i,s){let r=new ol;return r.anchor1=t,r.anchor2=e,r.axis=i,r.axesMask=s,r.jointType=$n.Generic,r}static spherical(t,e){let i=new ol;return i.anchor1=t,i.anchor2=e,i.jointType=$n.Spherical,i}static prismatic(t,e,i){let s=new ol;return s.anchor1=t,s.anchor2=e,s.axis=i,s.jointType=$n.Prismatic,s}static revolute(t,e,i){let s=new ol;return s.anchor1=t,s.anchor2=e,s.axis=i,s.jointType=$n.Revolute,s}intoRaw(){let t,e,i=ie.intoRaw(this.anchor1),s=ie.intoRaw(this.anchor2),r=!1,o=0,a=0;switch(this.jointType){case $n.Fixed:let l=Vt.intoRaw(this.frame1),h=Vt.intoRaw(this.frame2);e=is.fixed(i,l,s,h),l.free(),h.free();break;case $n.Spring:e=is.spring(this.length,this.stiffness,this.damping,i,s);break;case $n.Rope:e=is.rope(this.length,i,s);break;case $n.Prismatic:t=ie.intoRaw(this.axis),this.limitsEnabled&&(r=!0,o=this.limits[0],a=this.limits[1]),e=is.prismatic(i,s,t,r,o,a),t.free();break;case $n.Generic:t=ie.intoRaw(this.axis);let u=this.axesMask;e=is.generic(i,s,t,u);break;case $n.Spherical:e=is.spherical(i,s);break;case $n.Revolute:t=ie.intoRaw(this.axis),e=is.revolute(i,s,t),t.free()}return i.free(),s.free(),e}}(function(n){n[n.Average=0]="Average",n[n.Min=1]="Min",n[n.Multiply=2]="Multiply",n[n.Max=3]="Max"})(Li||(Li={}));class Rg{constructor(t,e,i,s,r){this.distance=t,this.point1=e,this.point2=i,this.normal1=s,this.normal2=r}static fromRaw(t){if(!t)return null;const e=new Rg(t.distance(),ie.fromRaw(t.point1()),ie.fromRaw(t.point2()),ie.fromRaw(t.normal1()),ie.fromRaw(t.normal2()));return t.free(),e}}(function(n){n[n.Vertex=0]="Vertex",n[n.Edge=1]="Edge",n[n.Face=2]="Face",n[n.Unknown=3]="Unknown"})(rx||(rx={}));class M0{constructor(t,e){this.point=t,this.isInside=e}static fromRaw(t){if(!t)return null;const e=new M0(ie.fromRaw(t.point()),t.isInside());return t.free(),e}}class H7{constructor(t,e){this.origin=t,this.dir=e}pointAt(t){return{x:this.origin.x+this.dir.x*t,y:this.origin.y+this.dir.y*t,z:this.origin.z+this.dir.z*t}}}class D0{constructor(t,e,i,s){this.featureType=rx.Unknown,this.featureId=void 0,this.toi=t,this.normal=e,s!==void 0&&(this.featureId=s),i!==void 0&&(this.featureType=i)}static fromRaw(t){if(!t)return null;const e=new D0(t.toi(),ie.fromRaw(t.normal()),t.featureType(),t.featureId());return t.free(),e}}class fm{constructor(t,e,i,s,r){this.toi=t,this.witness1=e,this.witness2=i,this.normal1=s,this.normal2=r}static fromRaw(t,e){if(!e)return null;const i=new fm(e.toi(),ie.fromRaw(e.witness1()),ie.fromRaw(e.witness2()),ie.fromRaw(e.normal1()),ie.fromRaw(e.normal2()));return e.free(),i}}class xS extends fm{constructor(t,e,i,s,r,o){super(e,i,s,r,o),this.collider=t}static fromRaw(t,e){if(!e)return null;const i=new xS(t.get(e.colliderHandle()),e.toi(),ie.fromRaw(e.witness1()),ie.fromRaw(e.witness2()),ie.fromRaw(e.normal1()),ie.fromRaw(e.normal2()));return e.free(),i}}class gn{static fromRaw(t,e){const i=t.coShapeType(e);let s,r,o,a,l,h,u;switch(i){case Cn.Ball:return new CS(t.coRadius(e));case Cn.Cuboid:return s=t.coHalfExtents(e),new _O(s.x,s.y,s.z);case Cn.RoundCuboid:return s=t.coHalfExtents(e),r=t.coRoundRadius(e),new wO(s.x,s.y,s.z,r);case Cn.Capsule:return l=t.coHalfHeight(e),h=t.coRadius(e),new xO(l,h);case Cn.Segment:return o=t.coVertices(e),new CO(ie.new(o[0],o[1],o[2]),ie.new(o[3],o[4],o[5]));case Cn.Polyline:return o=t.coVertices(e),a=t.coIndices(e),new IO(o,a);case Cn.Triangle:return o=t.coVertices(e),new SO(ie.new(o[0],o[1],o[2]),ie.new(o[3],o[4],o[5]),ie.new(o[6],o[7],o[8]));case Cn.RoundTriangle:return o=t.coVertices(e),r=t.coRoundRadius(e),new EO(ie.new(o[0],o[1],o[2]),ie.new(o[3],o[4],o[5]),ie.new(o[6],o[7],o[8]),r);case Cn.HalfSpace:return u=ie.fromRaw(t.coHalfspaceNormal(e)),new V7(u);case Cn.TriMesh:return o=t.coVertices(e),a=t.coIndices(e),new TO(o,a);case Cn.HeightField:const d=t.coHeightfieldScale(e),f=t.coHeightfieldHeights(e),p=t.coHeightfieldNRows(e),g=t.coHeightfieldNCols(e);return new RO(p,g,f,d);case Cn.ConvexPolyhedron:return o=t.coVertices(e),a=t.coIndices(e),new ax(o,a);case Cn.RoundConvexPolyhedron:return o=t.coVertices(e),a=t.coIndices(e),r=t.coRoundRadius(e),new lx(o,a,r);case Cn.Cylinder:return l=t.coHalfHeight(e),h=t.coRadius(e),new BO(l,h);case Cn.RoundCylinder:return l=t.coHalfHeight(e),h=t.coRadius(e),r=t.coRoundRadius(e),new PO(l,h,r);case Cn.Cone:return l=t.coHalfHeight(e),h=t.coRadius(e),new MO(l,h);case Cn.RoundCone:return l=t.coHalfHeight(e),h=t.coRadius(e),r=t.coRoundRadius(e),new DO(l,h,r);default:throw new Error("unknown shape type: "+i)}}castShape(t,e,i,s,r,o,a,l,h){let u=ie.intoRaw(t),d=Vt.intoRaw(e),f=ie.intoRaw(i),p=ie.intoRaw(r),g=Vt.intoRaw(o),m=ie.intoRaw(a),v=this.intoRaw(),y=s.intoRaw(),b=fm.fromRaw(null,v.castShape(u,d,f,y,p,g,m,l,h));return u.free(),d.free(),f.free(),p.free(),g.free(),m.free(),v.free(),y.free(),b}intersectsShape(t,e,i,s,r){let o=ie.intoRaw(t),a=Vt.intoRaw(e),l=ie.intoRaw(s),h=Vt.intoRaw(r),u=this.intoRaw(),d=i.intoRaw(),f=u.intersectsShape(o,a,d,l,h);return o.free(),a.free(),l.free(),h.free(),u.free(),d.free(),f}contactShape(t,e,i,s,r,o){let a=ie.intoRaw(t),l=Vt.intoRaw(e),h=ie.intoRaw(s),u=Vt.intoRaw(r),d=this.intoRaw(),f=i.intoRaw(),p=Rg.fromRaw(d.contactShape(a,l,f,h,u,o));return a.free(),l.free(),h.free(),u.free(),d.free(),f.free(),p}containsPoint(t,e,i){let s=ie.intoRaw(t),r=Vt.intoRaw(e),o=ie.intoRaw(i),a=this.intoRaw(),l=a.containsPoint(s,r,o);return s.free(),r.free(),o.free(),a.free(),l}projectPoint(t,e,i,s){let r=ie.intoRaw(t),o=Vt.intoRaw(e),a=ie.intoRaw(i),l=this.intoRaw(),h=M0.fromRaw(l.projectPoint(r,o,a,s));return r.free(),o.free(),a.free(),l.free(),h}intersectsRay(t,e,i,s){let r=ie.intoRaw(e),o=Vt.intoRaw(i),a=ie.intoRaw(t.origin),l=ie.intoRaw(t.dir),h=this.intoRaw(),u=h.intersectsRay(r,o,a,l,s);return r.free(),o.free(),a.free(),l.free(),h.free(),u}castRay(t,e,i,s,r){let o=ie.intoRaw(e),a=Vt.intoRaw(i),l=ie.intoRaw(t.origin),h=ie.intoRaw(t.dir),u=this.intoRaw(),d=u.castRay(o,a,l,h,s,r);return o.free(),a.free(),l.free(),h.free(),u.free(),d}castRayAndGetNormal(t,e,i,s,r){let o=ie.intoRaw(e),a=Vt.intoRaw(i),l=ie.intoRaw(t.origin),h=ie.intoRaw(t.dir),u=this.intoRaw(),d=D0.fromRaw(u.castRayAndGetNormal(o,a,l,h,s,r));return o.free(),a.free(),l.free(),h.free(),u.free(),d}}(function(n){n[n.Ball=0]="Ball",n[n.Cuboid=1]="Cuboid",n[n.Capsule=2]="Capsule",n[n.Segment=3]="Segment",n[n.Polyline=4]="Polyline",n[n.Triangle=5]="Triangle",n[n.TriMesh=6]="TriMesh",n[n.HeightField=7]="HeightField",n[n.ConvexPolyhedron=9]="ConvexPolyhedron",n[n.Cylinder=10]="Cylinder",n[n.Cone=11]="Cone",n[n.RoundCuboid=12]="RoundCuboid",n[n.RoundTriangle=13]="RoundTriangle",n[n.RoundCylinder=14]="RoundCylinder",n[n.RoundCone=15]="RoundCone",n[n.RoundConvexPolyhedron=16]="RoundConvexPolyhedron",n[n.HalfSpace=17]="HalfSpace"})(ki||(ki={}));class CS extends gn{constructor(t){super(),this.type=ki.Ball,this.radius=t}intoRaw(){return Ke.ball(this.radius)}}class V7 extends gn{constructor(t){super(),this.type=ki.HalfSpace,this.normal=t}intoRaw(){let t=ie.intoRaw(this.normal),e=Ke.halfspace(t);return t.free(),e}}class _O extends gn{constructor(t,e,i){super(),this.type=ki.Cuboid,this.halfExtents=ie.new(t,e,i)}intoRaw(){return Ke.cuboid(this.halfExtents.x,this.halfExtents.y,this.halfExtents.z)}}class wO extends gn{constructor(t,e,i,s){super(),this.type=ki.RoundCuboid,this.halfExtents=ie.new(t,e,i),this.borderRadius=s}intoRaw(){return Ke.roundCuboid(this.halfExtents.x,this.halfExtents.y,this.halfExtents.z,this.borderRadius)}}class xO extends gn{constructor(t,e){super(),this.type=ki.Capsule,this.halfHeight=t,this.radius=e}intoRaw(){return Ke.capsule(this.halfHeight,this.radius)}}class CO extends gn{constructor(t,e){super(),this.type=ki.Segment,this.a=t,this.b=e}intoRaw(){let t=ie.intoRaw(this.a),e=ie.intoRaw(this.b),i=Ke.segment(t,e);return t.free(),e.free(),i}}class SO extends gn{constructor(t,e,i){super(),this.type=ki.Triangle,this.a=t,this.b=e,this.c=i}intoRaw(){let t=ie.intoRaw(this.a),e=ie.intoRaw(this.b),i=ie.intoRaw(this.c),s=Ke.triangle(t,e,i);return t.free(),e.free(),i.free(),s}}class EO extends gn{constructor(t,e,i,s){super(),this.type=ki.RoundTriangle,this.a=t,this.b=e,this.c=i,this.borderRadius=s}intoRaw(){let t=ie.intoRaw(this.a),e=ie.intoRaw(this.b),i=ie.intoRaw(this.c),s=Ke.roundTriangle(t,e,i,this.borderRadius);return t.free(),e.free(),i.free(),s}}class IO extends gn{constructor(t,e){super(),this.type=ki.Polyline,this.vertices=t,this.indices=e??new Uint32Array(0)}intoRaw(){return Ke.polyline(this.vertices,this.indices)}}class TO extends gn{constructor(t,e){super(),this.type=ki.TriMesh,this.vertices=t,this.indices=e}intoRaw(){return Ke.trimesh(this.vertices,this.indices)}}class ax extends gn{constructor(t,e){super(),this.type=ki.ConvexPolyhedron,this.vertices=t,this.indices=e}intoRaw(){return this.indices?Ke.convexMesh(this.vertices,this.indices):Ke.convexHull(this.vertices)}}class lx extends gn{constructor(t,e,i){super(),this.type=ki.RoundConvexPolyhedron,this.vertices=t,this.indices=e,this.borderRadius=i}intoRaw(){return this.indices?Ke.roundConvexMesh(this.vertices,this.indices,this.borderRadius):Ke.roundConvexHull(this.vertices,this.borderRadius)}}class RO extends gn{constructor(t,e,i,s){super(),this.type=ki.HeightField,this.nrows=t,this.ncols=e,this.heights=i,this.scale=s}intoRaw(){let t=ie.intoRaw(this.scale),e=Ke.heightfield(this.nrows,this.ncols,this.heights,t);return t.free(),e}}class BO extends gn{constructor(t,e){super(),this.type=ki.Cylinder,this.halfHeight=t,this.radius=e}intoRaw(){return Ke.cylinder(this.halfHeight,this.radius)}}class PO extends gn{constructor(t,e,i){super(),this.type=ki.RoundCylinder,this.borderRadius=i,this.halfHeight=t,this.radius=e}intoRaw(){return Ke.roundCylinder(this.halfHeight,this.radius,this.borderRadius)}}class MO extends gn{constructor(t,e){super(),this.type=ki.Cone,this.halfHeight=t,this.radius=e}intoRaw(){return Ke.cone(this.halfHeight,this.radius)}}class DO extends gn{constructor(t,e,i){super(),this.type=ki.RoundCone,this.halfHeight=t,this.radius=e,this.borderRadius=i}intoRaw(){return Ke.roundCone(this.halfHeight,this.radius,this.borderRadius)}}(function(n){n[n.EXCLUDE_FIXED=1]="EXCLUDE_FIXED",n[n.EXCLUDE_KINEMATIC=2]="EXCLUDE_KINEMATIC",n[n.EXCLUDE_DYNAMIC=4]="EXCLUDE_DYNAMIC",n[n.EXCLUDE_SENSORS=8]="EXCLUDE_SENSORS",n[n.EXCLUDE_SOLIDS=16]="EXCLUDE_SOLIDS",n[n.ONLY_DYNAMIC=3]="ONLY_DYNAMIC",n[n.ONLY_KINEMATIC=5]="ONLY_KINEMATIC",n[n.ONLY_FIXED=6]="ONLY_FIXED"})(_R||(_R={}));(function(n){n[n.NONE=0]="NONE",n[n.COLLISION_EVENTS=1]="COLLISION_EVENTS",n[n.CONTACT_FORCE_EVENTS=2]="CONTACT_FORCE_EVENTS"})(Xv||(Xv={}));class W7{free(){this.raw&&this.raw.free(),this.raw=void 0}collider1(){return this.raw.collider1()}collider2(){return this.raw.collider2()}totalForce(){return ie.fromRaw(this.raw.total_force())}totalForceMagnitude(){return this.raw.total_force_magnitude()}maxForceDirection(){return ie.fromRaw(this.raw.max_force_direction())}maxForceMagnitude(){return this.raw.max_force_magnitude()}}class q7{constructor(t,e){this.raw=e||new z7(t)}free(){this.raw&&this.raw.free(),this.raw=void 0}drainCollisionEvents(t){this.raw.drainCollisionEvents(t)}drainContactForceEvents(t){let e=new W7;this.raw.drainContactForceEvents(i=>{e.raw=i,t(e),e.free()})}clear(){this.raw.clear()}}(function(n){n[n.NONE=0]="NONE",n[n.FILTER_CONTACT_PAIRS=1]="FILTER_CONTACT_PAIRS",n[n.FILTER_INTERSECTION_PAIRS=2]="FILTER_INTERSECTION_PAIRS"})(ox||(ox={})),function(n){n[n.EMPTY=0]="EMPTY",n[n.COMPUTE_IMPULSE=1]="COMPUTE_IMPULSE"}(wR||(wR={})),function(n){n[n.DYNAMIC_DYNAMIC=1]="DYNAMIC_DYNAMIC",n[n.DYNAMIC_KINEMATIC=12]="DYNAMIC_KINEMATIC",n[n.DYNAMIC_FIXED=2]="DYNAMIC_FIXED",n[n.KINEMATIC_KINEMATIC=52224]="KINEMATIC_KINEMATIC",n[n.KINEMATIC_FIXED=8704]="KINEMATIC_FIXED",n[n.FIXED_FIXED=32]="FIXED_FIXED",n[n.DEFAULT=15]="DEFAULT",n[n.ALL=60943]="ALL"}(Yv||(Yv={}));class CR{constructor(t,e,i,s){this.colliderSet=t,this.handle=e,this._parent=i,this._shape=s}finalizeDeserialization(t){this.handle!=null&&(this._parent=t.get(this.colliderSet.raw.coParent(this.handle)))}ensureShapeIsCached(){this._shape||(this._shape=gn.fromRaw(this.colliderSet.raw,this.handle))}get shape(){return this.ensureShapeIsCached(),this._shape}isValid(){return this.colliderSet.raw.contains(this.handle)}translation(){return ie.fromRaw(this.colliderSet.raw.coTranslation(this.handle))}rotation(){return Vt.fromRaw(this.colliderSet.raw.coRotation(this.handle))}isSensor(){return this.colliderSet.raw.coIsSensor(this.handle)}setSensor(t){this.colliderSet.raw.coSetSensor(this.handle,t)}setShape(t){let e=t.intoRaw();this.colliderSet.raw.coSetShape(this.handle,e),e.free(),this._shape=t}setEnabled(t){this.colliderSet.raw.coSetEnabled(this.handle,t)}isEnabled(){return this.colliderSet.raw.coIsEnabled(this.handle)}setRestitution(t){this.colliderSet.raw.coSetRestitution(this.handle,t)}setFriction(t){this.colliderSet.raw.coSetFriction(this.handle,t)}frictionCombineRule(){return this.colliderSet.raw.coFrictionCombineRule(this.handle)}setFrictionCombineRule(t){this.colliderSet.raw.coSetFrictionCombineRule(this.handle,t)}restitutionCombineRule(){return this.colliderSet.raw.coRestitutionCombineRule(this.handle)}setRestitutionCombineRule(t){this.colliderSet.raw.coSetRestitutionCombineRule(this.handle,t)}setCollisionGroups(t){this.colliderSet.raw.coSetCollisionGroups(this.handle,t)}setSolverGroups(t){this.colliderSet.raw.coSetSolverGroups(this.handle,t)}activeHooks(){return this.colliderSet.raw.coActiveHooks(this.handle)}setActiveHooks(t){this.colliderSet.raw.coSetActiveHooks(this.handle,t)}activeEvents(){return this.colliderSet.raw.coActiveEvents(this.handle)}setActiveEvents(t){this.colliderSet.raw.coSetActiveEvents(this.handle,t)}activeCollisionTypes(){return this.colliderSet.raw.coActiveCollisionTypes(this.handle)}setContactForceEventThreshold(t){return this.colliderSet.raw.coSetContactForceEventThreshold(this.handle,t)}contactForceEventThreshold(){return this.colliderSet.raw.coContactForceEventThreshold(this.handle)}setActiveCollisionTypes(t){this.colliderSet.raw.coSetActiveCollisionTypes(this.handle,t)}setDensity(t){this.colliderSet.raw.coSetDensity(this.handle,t)}setMass(t){this.colliderSet.raw.coSetMass(this.handle,t)}setMassProperties(t,e,i,s){let r=ie.intoRaw(e),o=ie.intoRaw(i),a=Vt.intoRaw(s);this.colliderSet.raw.coSetMassProperties(this.handle,t,r,o,a),r.free(),o.free(),a.free()}setTranslation(t){this.colliderSet.raw.coSetTranslation(this.handle,t.x,t.y,t.z)}setTranslationWrtParent(t){this.colliderSet.raw.coSetTranslationWrtParent(this.handle,t.x,t.y,t.z)}setRotation(t){this.colliderSet.raw.coSetRotation(this.handle,t.x,t.y,t.z,t.w)}setRotationWrtParent(t){this.colliderSet.raw.coSetRotationWrtParent(this.handle,t.x,t.y,t.z,t.w)}shapeType(){return this.colliderSet.raw.coShapeType(this.handle)}halfExtents(){return ie.fromRaw(this.colliderSet.raw.coHalfExtents(this.handle))}setHalfExtents(t){const e=ie.intoRaw(t);this.colliderSet.raw.coSetHalfExtents(this.handle,e)}radius(){return this.colliderSet.raw.coRadius(this.handle)}setRadius(t){this.colliderSet.raw.coSetRadius(this.handle,t)}roundRadius(){return this.colliderSet.raw.coRoundRadius(this.handle)}setRoundRadius(t){this.colliderSet.raw.coSetRoundRadius(this.handle,t)}halfHeight(){return this.colliderSet.raw.coHalfHeight(this.handle)}setHalfHeight(t){this.colliderSet.raw.coSetHalfHeight(this.handle,t)}vertices(){return this.colliderSet.raw.coVertices(this.handle)}indices(){return this.colliderSet.raw.coIndices(this.handle)}heightfieldHeights(){return this.colliderSet.raw.coHeightfieldHeights(this.handle)}heightfieldScale(){let t=this.colliderSet.raw.coHeightfieldScale(this.handle);return ie.fromRaw(t)}heightfieldNRows(){return this.colliderSet.raw.coHeightfieldNRows(this.handle)}heightfieldNCols(){return this.colliderSet.raw.coHeightfieldNCols(this.handle)}parent(){return this._parent}friction(){return this.colliderSet.raw.coFriction(this.handle)}restitution(){return this.colliderSet.raw.coRestitution(this.handle)}density(){return this.colliderSet.raw.coDensity(this.handle)}mass(){return this.colliderSet.raw.coMass(this.handle)}volume(){return this.colliderSet.raw.coVolume(this.handle)}collisionGroups(){return this.colliderSet.raw.coCollisionGroups(this.handle)}solverGroups(){return this.colliderSet.raw.coSolverGroups(this.handle)}containsPoint(t){let e=ie.intoRaw(t),i=this.colliderSet.raw.coContainsPoint(this.handle,e);return e.free(),i}projectPoint(t,e){let i=ie.intoRaw(t),s=M0.fromRaw(this.colliderSet.raw.coProjectPoint(this.handle,i,e));return i.free(),s}intersectsRay(t,e){let i=ie.intoRaw(t.origin),s=ie.intoRaw(t.dir),r=this.colliderSet.raw.coIntersectsRay(this.handle,i,s,e);return i.free(),s.free(),r}castShape(t,e,i,s,r,o,a){let l=ie.intoRaw(t),h=ie.intoRaw(i),u=Vt.intoRaw(s),d=ie.intoRaw(r),f=e.intoRaw(),p=fm.fromRaw(this.colliderSet,this.colliderSet.raw.coCastShape(this.handle,l,f,h,u,d,o,a));return l.free(),h.free(),u.free(),d.free(),f.free(),p}castCollider(t,e,i,s,r){let o=ie.intoRaw(t),a=ie.intoRaw(i),l=xS.fromRaw(this.colliderSet,this.colliderSet.raw.coCastCollider(this.handle,o,e.handle,a,s,r));return o.free(),a.free(),l}intersectsShape(t,e,i){let s=ie.intoRaw(e),r=Vt.intoRaw(i),o=t.intoRaw(),a=this.colliderSet.raw.coIntersectsShape(this.handle,o,s,r);return s.free(),r.free(),o.free(),a}contactShape(t,e,i,s){let r=ie.intoRaw(e),o=Vt.intoRaw(i),a=t.intoRaw(),l=Rg.fromRaw(this.colliderSet.raw.coContactShape(this.handle,a,r,o,s));return r.free(),o.free(),a.free(),l}contactCollider(t,e){return Rg.fromRaw(this.colliderSet.raw.coContactCollider(this.handle,t.handle,e))}castRay(t,e,i){let s=ie.intoRaw(t.origin),r=ie.intoRaw(t.dir),o=this.colliderSet.raw.coCastRay(this.handle,s,r,e,i);return s.free(),r.free(),o}castRayAndGetNormal(t,e,i){let s=ie.intoRaw(t.origin),r=ie.intoRaw(t.dir),o=D0.fromRaw(this.colliderSet.raw.coCastRayAndGetNormal(this.handle,s,r,e,i));return s.free(),r.free(),o}}(function(n){n[n.Density=0]="Density",n[n.Mass=1]="Mass",n[n.MassProps=2]="MassProps"})(rd||(rd={}));class ri{constructor(t){this.enabled=!0,this.shape=t,this.massPropsMode=rd.Density,this.density=1,this.friction=.5,this.restitution=0,this.rotation=Vt.identity(),this.translation=ie.zeros(),this.isSensor=!1,this.collisionGroups=4294967295,this.solverGroups=4294967295,this.frictionCombineRule=Li.Average,this.restitutionCombineRule=Li.Average,this.activeCollisionTypes=Yv.DEFAULT,this.activeEvents=Xv.NONE,this.activeHooks=ox.NONE,this.mass=0,this.centerOfMass=ie.zeros(),this.contactForceEventThreshold=0,this.principalAngularInertia=ie.zeros(),this.angularInertiaLocalFrame=Vt.identity()}static ball(t){const e=new CS(t);return new ri(e)}static capsule(t,e){const i=new xO(t,e);return new ri(i)}static segment(t,e){const i=new CO(t,e);return new ri(i)}static triangle(t,e,i){const s=new SO(t,e,i);return new ri(s)}static roundTriangle(t,e,i,s){const r=new EO(t,e,i,s);return new ri(r)}static polyline(t,e){const i=new IO(t,e);return new ri(i)}static trimesh(t,e){const i=new TO(t,e);return new ri(i)}static cuboid(t,e,i){const s=new _O(t,e,i);return new ri(s)}static roundCuboid(t,e,i,s){const r=new wO(t,e,i,s);return new ri(r)}static heightfield(t,e,i,s){const r=new RO(t,e,i,s);return new ri(r)}static cylinder(t,e){const i=new BO(t,e);return new ri(i)}static roundCylinder(t,e,i){const s=new PO(t,e,i);return new ri(s)}static cone(t,e){const i=new MO(t,e);return new ri(i)}static roundCone(t,e,i){const s=new DO(t,e,i);return new ri(s)}static convexHull(t){const e=new ax(t,null);return new ri(e)}static convexMesh(t,e){const i=new ax(t,e);return new ri(i)}static roundConvexHull(t,e){const i=new lx(t,null,e);return new ri(i)}static roundConvexMesh(t,e,i){const s=new lx(t,e,i);return new ri(s)}setTranslation(t,e,i){if(typeof t!="number"||typeof e!="number"||typeof i!="number")throw TypeError("The translation components must be numbers.");return this.translation={x:t,y:e,z:i},this}setRotation(t){return Vt.copy(this.rotation,t),this}setSensor(t){return this.isSensor=t,this}setEnabled(t){return this.enabled=t,this}setDensity(t){return this.massPropsMode=rd.Density,this.density=t,this}setMass(t){return this.massPropsMode=rd.Mass,this.mass=t,this}setMassProperties(t,e,i,s){return this.massPropsMode=rd.MassProps,this.mass=t,ie.copy(this.centerOfMass,e),ie.copy(this.principalAngularInertia,i),Vt.copy(this.angularInertiaLocalFrame,s),this}setRestitution(t){return this.restitution=t,this}setFriction(t){return this.friction=t,this}setFrictionCombineRule(t){return this.frictionCombineRule=t,this}setRestitutionCombineRule(t){return this.restitutionCombineRule=t,this}setCollisionGroups(t){return this.collisionGroups=t,this}setSolverGroups(t){return this.solverGroups=t,this}setActiveHooks(t){return this.activeHooks=t,this}setActiveEvents(t){return this.activeEvents=t,this}setActiveCollisionTypes(t){return this.activeCollisionTypes=t,this}setContactForceEventThreshold(t){return this.contactForceEventThreshold=t,this}}for(var OX={byteLength:function(n){var t=SR(n),e=t[0],i=t[1];return 3*(e+i)/4-i},toByteArray:function(n){var t,e,i=SR(n),s=i[0],r=i[1],o=new X7(function(h,u,d){return 3*(u+d)/4-d}(0,s,r)),a=0,l=r>0?s-4:s;for(e=0;e<l;e+=4)t=Or[n.charCodeAt(e)]<<18|Or[n.charCodeAt(e+1)]<<12|Or[n.charCodeAt(e+2)]<<6|Or[n.charCodeAt(e+3)],o[a++]=t>>16&255,o[a++]=t>>8&255,o[a++]=255&t;return r===2&&(t=Or[n.charCodeAt(e)]<<2|Or[n.charCodeAt(e+1)]>>4,o[a++]=255&t),r===1&&(t=Or[n.charCodeAt(e)]<<10|Or[n.charCodeAt(e+1)]<<4|Or[n.charCodeAt(e+2)]>>2,o[a++]=t>>8&255,o[a++]=255&t),o},fromByteArray:function(n){for(var t,e=n.length,i=e%3,s=[],r=16383,o=0,a=e-i;o<a;o+=r)s.push(K7(n,o,o+r>a?a:o+r));return i===1?(t=n[e-1],s.push(Aa[t>>2]+Aa[t<<4&63]+"==")):i===2&&(t=(n[e-2]<<8)+n[e-1],s.push(Aa[t>>10]+Aa[t>>4&63]+Aa[t<<2&63]+"=")),s.join("")}},Aa=[],Or=[],X7=typeof Uint8Array<"u"?Uint8Array:Array,g_="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Bu=0,Y7=g_.length;Bu<Y7;++Bu)Aa[Bu]=g_[Bu],Or[g_.charCodeAt(Bu)]=Bu;function SR(n){var t=n.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var e=n.indexOf("=");return e===-1&&(e=t),[e,e===t?0:4-e%4]}function K7(n,t,e){for(var i,s,r=[],o=t;o<e;o+=3)i=(n[o]<<16&16711680)+(n[o+1]<<8&65280)+(255&n[o+2]),r.push(Aa[(s=i)>>18&63]+Aa[s>>12&63]+Aa[s>>6&63]+Aa[63&s]);return r.join("")}Or["-".charCodeAt(0)]=62,Or["_".charCodeAt(0)]=63;const LX=Symbol("object"),m_=new ko(()=>new C,20);class J7{constructor(t,e,i,s,r,o){c(this,"_point");c(this,"_normal");c(this,"_tangentVelocity");c(this,"distance");c(this,"impulse");c(this,"friction");this._point=t,this.distance=e,this._normal=i,this.impulse=s,this.friction=r,this._tangentVelocity=o}get point(){return m_.get().set(this._point.x,this._point.y,this._point.z)}get normal(){return m_.get().set(this._normal.x,this._normal.y,this._normal.z)}get tangentVelocity(){return m_.get().set(this._tangentVelocity.x,this._tangentVelocity.y,this._tangentVelocity.z)}}class Z7{constructor(t,e,i){c(this,"contacts");c(this,"me");c(this,"_collider");c(this,"_gameObject");this.me=t,this._collider=e,this._gameObject=e.gameObject,this.contacts=i}get collider(){return this._collider}get gameObject(){return this._gameObject}get rigidBody(){var t;return(t=this.collider)==null?void 0:t.attachedRigidbody}}class $7{constructor(t,e){c(this,"object");c(this,"collider");this.object=t,this.collider=e}}const En=N("debugphysics"),A_=N("debugcolliderplacement"),v_=N("debugcollisions"),eq=N("showcolliders"),y_=N("debugraycasts"),js=Symbol("needle component"),bs=Symbol("physics body"),ER=Symbol("rigidbody");let sh;globalThis.false=globalThis.false!==void 0?globalThis.false:!0;En&&console.log("Use Rapier",!1,globalThis.false);const Zp=class{constructor(){c(this,"debugRenderColliders",!1);c(this,"debugRenderRaycasts",!1);c(this,"context");c(this,"_initializePromise");c(this,"_isInitialized",!1);c(this,"rapierRay",new H7({x:0,y:0,z:0},{x:0,y:0,z:1}));c(this,"raycastVectorsBuffer",new ko(()=>new C,10));c(this,"rapierSphere",null);c(this,"rapierColliderArray",[]);c(this,"rapierIdentityRotation",{x:0,y:0,z:0,w:1});c(this,"rapierForwardVector",{x:0,y:0,z:1});c(this,"enabled",!1);c(this,"_tempPosition",new C);c(this,"_tempQuaternion",new ne);c(this,"_tempScale",new C);c(this,"_tempMatrix",new ce);c(this,"_isUpdatingPhysicsWorld",!1);c(this,"_world");c(this,"_hasCreatedWorld",!1);c(this,"eventQueue");c(this,"collisionHandler");c(this,"objects",[]);c(this,"bodies",[]);c(this,"_meshCache",new Map);c(this,"_gravity",{x:0,y:-9.81,z:0});c(this,"lines");c(this,"_tempCenterPos",new C);c(this,"_tempCenterVec",new C);c(this,"_tempCenterQuaternion",new ne)}removeBody(t){var i,s,r;if(!t)return;this.validate();const e=t[bs];if(t[bs]=null,e&&this.world){const o=this.objects.findIndex(a=>a===t);if(o>=0){const a=this.bodies[o];if(this.bodies.splice(o,1),this.objects.splice(o,1),a instanceof CR){const l=a;(i=this.world)==null||i.removeCollider(l,!0);const h=l.parent();h&&h.numColliders()<=0&&(h[js]||(s=this.world)==null||s.removeRigidBody(h))}else a instanceof xR&&(a.numColliders()<=0?(r=this.world)==null||r.removeRigidBody(a):xe()&&(a.did_log_removing||setTimeout(()=>{a.numColliders()>0&&(a.did_log_removing=!0,console.warn("RapierPhysics: removing rigidbody with colliders from the physics world is not possible right now, please remove the colliders first"))},1)))}}}updateBody(t,e,i){if(this.validate(),!!this.enabled&&!(t.destroyed||!t.gameObject)&&!(!e&&!i))if(t.isCollider===!0)console.warn("TODO: implement updating collider position");else{const s=t,r=s[bs];r&&this.syncPhysicsBody(s.gameObject,r,e,i)}}updateProperties(t){if(this.validate(),t.isCollider){const e=t,i=e[bs];i&&(this.internalUpdateColliderProperties(e,i),e.sharedMaterial&&this.updatePhysicsMaterial(e))}else{const e=t,i=this.internal_getRigidbody(e);i&&this.internalUpdateRigidbodyProperties(e,i)}}addForce(t,e,i){this.validate();const s=this.internal_getRigidbody(t);s?s.addForce(e,i):console.warn("Rigidbody doesn't exist: can not apply force")}addImpulse(t,e,i){this.validate();const s=this.internal_getRigidbody(t);s?s.applyImpulse(e,i):console.warn("Rigidbody doesn't exist: can not apply impulse")}getLinearVelocity(t){this.validate();const e=this.internal_getRigidbody(t);return e?e.linvel():null}getAngularVelocity(t){this.validate();const e=this.internal_getRigidbody(t);return e?e.angvel():null}resetForces(t,e){this.validate();const i=this.internal_getRigidbody(t);i==null||i.resetForces(e)}resetTorques(t,e){this.validate();const i=this.internal_getRigidbody(t);i==null||i.resetTorques(e)}applyImpulse(t,e,i){this.validate();const s=this.internal_getRigidbody(t);s?s.applyImpulse(e,i):console.warn("Rigidbody doesn't exist: can not apply impulse")}wakeup(t){this.validate();const e=this.internal_getRigidbody(t);e?e.wakeUp():console.warn("Rigidbody doesn't exist: can not wake up")}isSleeping(t){this.validate();const e=this.internal_getRigidbody(t);return e==null?void 0:e.isSleeping()}setAngularVelocity(t,e,i){this.validate();const s=this.internal_getRigidbody(t);s?s.setAngvel(e,i):console.warn("Rigidbody doesn't exist: can not set angular velocity")}setLinearVelocity(t,e,i){this.validate();const s=this.internal_getRigidbody(t);s?s.setLinvel(e,i):console.warn("Rigidbody doesn't exist: can not set linear velocity")}async initialize(t){return this.context=t,this._initializePromise||(this._initializePromise=this.internalInitialization()),this._initializePromise}async internalInitialization(){return En&&console.log("Initialize rapier physics engine"),"env"in import.meta&&{}.VITE_NEEDLE_USE_RAPIER==="false"&&En&&console.log("Rapier disabled"),!1}validate(){this._isInitialized||En&&(this._lastWarnTime=this._lastWarnTime??0,Date.now()-this._lastWarnTime>1e3&&(this._lastWarnTime=Date.now(),console.warn("Physics engine is not initialized")))}raycast(t,e,i){var l;let s=i==null?void 0:i.maxDistance,r=i==null?void 0:i.solid;s===void 0&&(s=1/0),r===void 0&&(r=!0);const o=this.getPhysicsRay(this.rapierRay,t,e);if(!o)return null;(this.debugRenderRaycasts||y_)&&De.DrawRay(o.origin,o.dir,255,1);const a=(l=this.world)==null?void 0:l.castRay(o,s,r,i==null?void 0:i.queryFilterFlags,i==null?void 0:i.filterGroups,void 0,void 0,h=>{const u=h[js];return i!=null&&i.filterPredicate?i.filterPredicate(u):!(u!=null&&u.gameObject.layers.isEnabled(2))});if(a){const h=o.pointAt(a.toi),u=this.raycastVectorsBuffer.get();return u.set(h.x,h.y,h.z),{point:u,collider:a.collider[js]}}return null}raycastAndGetNormal(t,e,i){var l;let s=i==null?void 0:i.maxDistance,r=i==null?void 0:i.solid;s===void 0&&(s=1/0),r===void 0&&(r=!0);const o=this.getPhysicsRay(this.rapierRay,t,e);if(!o)return null;(this.debugRenderRaycasts||y_)&&De.DrawRay(o.origin,o.dir,255,1);const a=(l=this.world)==null?void 0:l.castRayAndGetNormal(o,s,r,i==null?void 0:i.queryFilterFlags,i==null?void 0:i.filterGroups,void 0,void 0,h=>{const u=h[js];return i!=null&&i.filterPredicate?i.filterPredicate(u):!(u!=null&&u.gameObject.layers.isEnabled(2))});if(a){const h=o.pointAt(a.toi),u=a.normal,d=this.raycastVectorsBuffer.get(),f=this.raycastVectorsBuffer.get();return d.set(h.x,h.y,h.z),f.set(u.x,u.y,u.z),{point:d,normal:f,collider:a.collider[js]}}return null}getPhysicsRay(t,e,i){var a,l,h;const s=(a=this.context)==null?void 0:a.mainCamera;if(e===void 0){const u=(l=this.context)==null?void 0:l.input.getPointerPosition(0);if(u)e=u;else return null}if(e.z===void 0){if(!s)return console.error("Can not perform raycast from 2d point - no main camera found"),null;const u=this.raycastVectorsBuffer.get();u.x=e.x,u.y=e.y,u.z=0,(u.x>1||u.y>1||u.y<-1||u.x<-1)&&(En&&console.warn("Converting screenspace to raycast space",u),(h=this.context)==null||h.input.convertScreenspaceToRaycastSpace(u)),u.unproject(s),e=u}const r=e;t.origin.x=r.x,t.origin.y=r.y,t.origin.z=r.z;const o=this.raycastVectorsBuffer.get();if(i)o.set(i.x,i.y,i.z);else{if(!s)return console.error("Can not perform raycast - no camera found"),null;o.set(t.origin.x,t.origin.y,t.origin.z);const u=qe(s);o.sub(u)}return o.normalize(),t.dir.x=o.x,t.dir.y=o.y,t.dir.z=o.z,t}sphereOverlap(t,e){return this.rapierColliderArray.length=0,this.world?(this.rapierSphere||(this.rapierSphere=new CS(e)),this.rapierSphere.radius=e,(this.debugRenderRaycasts||y_)&&De.DrawWireSphere(t,e,3359999,1),this.world.intersectionsWithShape(t,this.rapierIdentityRotation,this.rapierSphere,i=>{const s=i[js],r=new $7(s.gameObject,s);return this.rapierColliderArray.push(r),!0},void 0,void 0,void 0,void 0,i=>i.isSensor()?!1:i[js].gameObject.layers.isEnabled(2)==!1),this.rapierColliderArray):this.rapierColliderArray}get world(){return this._world}get isUpdating(){return this._isUpdatingPhysicsWorld}get gravity(){var t;return((t=this.world)==null?void 0:t.gravity)??this._gravity}set gravity(t){this.world?this.world.gravity=t:this._gravity=t}clearCaches(){var t,e,i,s;this._meshCache.clear(),(t=this.eventQueue)!=null&&t.raw&&((e=this.eventQueue)==null||e.free()),(i=this.world)!=null&&i.bodies&&((s=this.world)==null||s.free())}async addBoxCollider(t,e){if(this._isInitialized||await this.initialize(t.context),!t.activeAndEnabled)return;if(!this.enabled){En&&console.warn("Physics are disabled");return}const i=t.gameObject,s=ai(i,this._tempPosition).multiply(e);s.multiplyScalar(.5),s.x<0&&(s.x=Math.abs(s.x)),s.y<0&&(s.y=Math.abs(s.y)),s.z<0&&(s.z=Math.abs(s.z)),s.x==0&&(s.x=1e-7),s.y==0&&(s.y=1e-7),s.z==0&&(s.z=1e-7);const r=ri.cuboid(s.x,s.y,s.z);this.createCollider(t,r)}async addSphereCollider(t){if(this._isInitialized||await this.initialize(t.context),!t.activeAndEnabled)return;if(!this.enabled){En&&console.warn("Physics are disabled");return}const e=ri.ball(.5);this.createCollider(t,e),this.updateProperties(t)}async addCapsuleCollider(t,e,i){if(this._isInitialized||await this.initialize(t.context),!t.activeAndEnabled)return;if(!this.enabled){En&&console.warn("Physics are disabled");return}const s=t.gameObject,r=ai(s,this._tempPosition);r.x=Math.abs(r.x),r.y=Math.abs(r.y);const o=i*r.x;e=Math.max(e,o*2);const a=Ae.clamp(e*.5*r.y-i*r.x,0,Number.MAX_SAFE_INTEGER),l=ri.capsule(a,o);this.createCollider(t,l)}async addMeshCollider(t,e,i,s){var h,u,d;if(this._isInitialized||await this.initialize(t.context),!t.activeAndEnabled)return;if(!this.enabled){En&&console.warn("Physics are disabled");return}let r=e.geometry;if(!r){En&&console.warn("Missing mesh geometry",e.name);return}(u=(h=r.index)==null?void 0:h.array)!=null&&u.length||(console.warn(`Your MeshCollider is missing vertices or indices in the assined mesh "${e.name}". Consider providing an indexed geometry.`),r=r4(r));let o=r.getAttribute("position").array;const a=(d=r.index)==null?void 0:d.array;if(Math.abs(s.x-1)>1e-4||Math.abs(s.y-1)>1e-4||Math.abs(s.z-1)>1e-4){const f=r.uuid+"_"+s.x+"_"+s.y+"_"+s.z+"_"+i;if(this._meshCache.has(f))En&&console.warn("Use cached mesh collider"),o=this._meshCache.get(f);else{(En||xe())&&console.warn(`Your MeshCollider "${t.name}" is scaled: consider applying the scale to the collider mesh instead (${s.x}, ${s.y}, ${s.z})`);const p=new Float32Array(o.length);for(let g=0;g<o.length;g+=3)p[g]=o[g]*s.x,p[g+1]=o[g+1]*s.y,p[g+2]=o[g+2]*s.z;o=p,this._meshCache.set(f,p)}}const l=i?ri.convexHull(o):ri.trimesh(o,a);l&&this.createCollider(t,l)}updatePhysicsMaterial(t){if(!t)return;const e=t.sharedMaterial,i=t[bs];if(i&&e){if(e.bounciness!==void 0&&i.setRestitution(e.bounciness),e.bounceCombine!==void 0)switch(e.bounceCombine){case rn.Average:i.setRestitutionCombineRule(Li.Average);break;case rn.Maximum:i.setRestitutionCombineRule(Li.Max);break;case rn.Minimum:i.setRestitutionCombineRule(Li.Min);break;case rn.Multiply:i.setRestitutionCombineRule(Li.Multiply);break}if(e.dynamicFriction!==void 0&&i.setFriction(e.dynamicFriction),e.frictionCombine!==void 0)switch(e.frictionCombine){case rn.Average:i.setFrictionCombineRule(Li.Average);break;case rn.Maximum:i.setFrictionCombineRule(Li.Max);break;case rn.Minimum:i.setFrictionCombineRule(Li.Min);break;case rn.Multiply:i.setFrictionCombineRule(Li.Multiply);break}}}getBody(t){return t?t[bs]:null}getComponent(t){return t?t[js]:null}createCollider(t,e){var o;if(!this.world)throw new Error("Physics world not initialized");const i=this._tempMatrix;let s;t.attachedRigidbody?s=this.getRigidbody(t,this._tempMatrix):(En&&console.log("Create collider without rigidbody",t.name),i.makeRotationFromQuaternion(Nt(t.gameObject)),i.setPosition(qe(t.gameObject))),i.decompose(this._tempPosition,this._tempQuaternion,this._tempScale),this.tryApplyCenter(t,this._tempPosition),e.setTranslation(this._tempPosition.x,this._tempPosition.y,this._tempPosition.z),e.setRotation(this._tempQuaternion),e.setSensor(t.isTrigger);const r=t.sharedMaterial;if(r){if(r.bounciness!==void 0&&e.setRestitution(r.bounciness),r.bounceCombine!==void 0)switch(r.bounceCombine){case rn.Average:e.setRestitutionCombineRule(Li.Average);break;case rn.Maximum:e.setRestitutionCombineRule(Li.Max);break;case rn.Minimum:e.setRestitutionCombineRule(Li.Min);break;case rn.Multiply:e.setRestitutionCombineRule(Li.Multiply);break}if(r.dynamicFriction!==void 0&&e.setFriction(r.dynamicFriction),r.frictionCombine!==void 0)switch(r.frictionCombine){case rn.Average:e.setFrictionCombineRule(Li.Average);break;case rn.Maximum:e.setFrictionCombineRule(Li.Max);break;case rn.Minimum:e.setFrictionCombineRule(Li.Min);break;case rn.Multiply:e.setFrictionCombineRule(Li.Multiply);break}}((o=t.attachedRigidbody)==null?void 0:o.autoMass)===!1&&(e.setDensity(1e-6),e.setMass(1e-6));try{const a=this.world.createCollider(e,s);return a[js]=t,t[bs]=a,a.setActiveEvents(Xv.COLLISION_EVENTS),a.setActiveCollisionTypes(Yv.ALL),this.objects.push(t),this.bodies.push(a),this.updateColliderCollisionGroups(t),a}catch(a){return console.error('Error creating collider "'+t.name+`"
Error:`,a),null}}updateColliderCollisionGroups(t){const e=t[bs],i=t.membership;let s=0;if(i==null)s=65535;else for(let a=0;a<i.length;a++){const l=i[a];l>31?console.error(`Rapier only supports 32 layers, layer ${l} is not supported`):s|=1<<Math.floor(l)}const r=t.filter;let o=0;if(r==null)o=65535;else for(let a=0;a<r.length;a++){const l=r[a];l>31?console.error(`Rapier only supports 32 layers, layer ${l} is not supported`):o|=1<<Math.floor(l)}e.setCollisionGroups(s<<16|o)}getRigidbody(t,e){if(!this.world)throw new Error("Physics world not initialized");let i=null;if(t.attachedRigidbody){const s=t.attachedRigidbody;if(i=s[bs],!i){const r=s.isKinematic&&!A_;En&&console.log("Create rigidbody",r);const o=r?sh.RigidBodyDesc.kinematicPositionBased():sh.RigidBodyDesc.dynamic(),a=qe(t.attachedRigidbody.gameObject);o.setTranslation(a.x,a.y,a.z),o.setRotation(Nt(t.attachedRigidbody.gameObject)),o.centerOfMass=new sh.Vector3(s.centerOfMass.x,s.centerOfMass.y,s.centerOfMass.z),i=this.world.createRigidBody(o),this.bodies.push(i),this.objects.push(s)}i[js]=s,s[bs]=i,this.internalUpdateRigidbodyProperties(s,i),this.getRigidbodyRelativeMatrix(t.gameObject,s.gameObject,e),t[ER]=i}else{const s=sh.RigidBodyDesc.kinematicPositionBased(),r=qe(t.gameObject);s.setTranslation(r.x,r.y,r.z),s.setRotation(Nt(t.gameObject)),i=this.world.createRigidBody(s),e.identity(),i[js]=null}return i}internal_getRigidbody(t){return t.isCollider===!0?t[ER]:t[bs]}internalUpdateColliderProperties(t,e){const i=e.shape;let s=!1;switch(i.type){case ki.Ball:{const f=i,p=t,g=t.gameObject,m=ai(g,this._tempPosition),v=Math.abs(p.radius*m.x);s=f.radius!==v,f.radius=v,s&&e.setShape(f);break}case ki.Cuboid:const r=i,o=t,a=t.gameObject,l=ai(a,this._tempPosition),h=o.size.x*.5*l.x,u=o.size.y*.5*l.y,d=o.size.z*.5*l.z;s=r.halfExtents.x!==h||r.halfExtents.y!==u||r.halfExtents.z!==d,r.halfExtents.x=h,r.halfExtents.y=u,r.halfExtents.z=d,s&&e.setShape(r);break}if(s){const r=t.attachedRigidbody;if(r!=null&&r.autoMass){const o=this.getBody(r);o==null||o.recomputeMassPropertiesFromColliders()}}this.updateColliderCollisionGroups(t),t.isTrigger!==e.isSensor()&&e.setSensor(t.isTrigger)}internalUpdateRigidbodyProperties(t,e){if(e.enableCcd(t.collisionDetectionMode!==Cv.Discrete),e.setLinearDamping(t.drag),e.setAngularDamping(t.angularDrag),e.setGravityScale(t.useGravity?t.gravityScale:0,!0),t.dominanceGroup<=127&&t.dominanceGroup>=-127?e.setDominanceGroup(Math.floor(t.dominanceGroup)):e.setDominanceGroup(0),t.autoMass){e.setAdditionalMass(0,!1);for(let i=0;i<e.numColliders();i++)e.collider(i).setDensity(1);e.recomputeMassPropertiesFromColliders()}else{e.setAdditionalMass(t.mass,!1);for(let i=0;i<e.numColliders();i++)e.collider(i).setDensity(1e-7);e.recomputeMassPropertiesFromColliders()}e.setEnabledRotations(!t.lockRotationX,!t.lockRotationY,!t.lockRotationZ,!1),e.setEnabledTranslations(!t.lockPositionX,!t.lockPositionY,!t.lockPositionZ,!1),t.isKinematic?e.setBodyType(sh.RigidBodyType.KinematicPositionBased,!1):e.setBodyType(sh.RigidBodyType.Dynamic,!1)}step(t){if(this.world&&this.enabled){if(this._isUpdatingPhysicsWorld=!0,this.eventQueue||(this.eventQueue=new q7(!1)),t===void 0||t<=0){this._isUpdatingPhysicsWorld=!1;return}else t!==void 0&&(this.world.timestep=Ae.lerp(this.world.timestep,t,.8));try{this.world.step(this.eventQueue)}catch(e){console.warn("Error running physics step",e)}this._isUpdatingPhysicsWorld=!1}}postStep(){this.world&&this.enabled&&(this._isUpdatingPhysicsWorld=!0,this.syncObjects(),this._isUpdatingPhysicsWorld=!1,this.eventQueue&&!this.collisionHandler&&(this.collisionHandler=new tq(this.world,this.eventQueue)),this.collisionHandler&&(this.collisionHandler.handleCollisionEvents(),this.collisionHandler.update()),this.updateDebugRendering(this.world))}updateDebugRendering(t){var e,i,s,r;if(En||A_||eq||this.debugRenderColliders===!0){if(!this.lines){const a=new Ba({color:7855479,fog:!1}),l=new jt;this.lines=new tg(l,a),this.lines.layers.disableAll(),this.lines.layers.enable(2)}this.lines.parent!==((e=this.context)==null?void 0:e.scene)&&((i=this.context)==null||i.scene.add(this.lines));const o=t.debugRender();this.lines.geometry.setAttribute("position",new Ve(o.vertices,3)),this.lines.geometry.setAttribute("color",new Ve(o.colors,4)),(this.context.time.frame%30===0||((s=this.lines.geometry.boundingSphere)==null?void 0:s.radius)===0)&&this.lines.geometry.computeBoundingSphere()}else this.lines&&((r=this.context)==null||r.scene.remove(this.lines))}syncObjects(){if(!A_)for(let t=0;t<this.bodies.length;t++){const e=this.objects[t],i=this.bodies[t],s=e;if((s==null?void 0:s.isCollider)===!0&&!s.attachedRigidbody){const l=i.parent();l?this.syncPhysicsBody(e.gameObject,l,!0,!0):this.syncPhysicsBody(e.gameObject,i,!0,!0);continue}const r=i.translation(),o=i.rotation();if(Number.isNaN(r.x)||Number.isNaN(o.x)){!s.__COLLIDER_NAN&&xe()&&(console.warn("Collider has NaN values",s.name,s.gameObject,i),s.__COLLIDER_NAN=!0);continue}const a=e.center;if(a&&a.isVector3){this._tempQuaternion.set(o.x,o.y,o.z,o.w);const l=this._tempPosition.copy(a).applyQuaternion(this._tempQuaternion),h=ai(e.gameObject);l.multiply(h),r.x-=l.x,r.y-=l.y,r.z-=l.z}Pd(e.gameObject,r.x,r.y,r.z),aP(e.gameObject,o.x,o.y,o.z,o.w)}}syncPhysicsBody(t,e,i,s){if(e instanceof xR){const r=qe(t,this._tempPosition),o=Nt(t,this._tempQuaternion);switch(e.bodyType()){case Wp.Fixed:case Wp.KinematicPositionBased:case Wp.KinematicVelocityBased:i&&e.setNextKinematicTranslation(r),s&&e.setNextKinematicRotation(o);break;default:i&&e.setTranslation(r,!1),s&&e.setRotation(o,!1);break}}else if(e instanceof CR){const r=qe(t,this._tempPosition),o=Nt(t,this._tempQuaternion),a=e[js];if(this.tryApplyCenter(a,r),i){const l=e.translation();(l.x!==r.x||l.y!==r.y||l.z!==r.z)&&e.setTranslation(r)}if(s){const l=e.rotation();(l.x!==o.x||l.y!==o.y||l.z!==o.z||l.w!==o.w)&&e.setRotation(o)}}}tryApplyCenter(t,e){const i=t.center;i&&t.gameObject&&(i.x!==0||i.y!==0||i.z!==0)&&(this._tempCenterPos.x=-i.x,this._tempCenterPos.y=i.y,this._tempCenterPos.z=i.z,ai(t.gameObject,this._tempCenterVec),this._tempCenterPos.multiply(this._tempCenterVec),t.attachedRigidbody?this._tempCenterPos.applyQuaternion(t.gameObject.quaternion):(Nt(t.gameObject,this._tempCenterQuaternion),this._tempCenterPos.applyQuaternion(this._tempCenterQuaternion)),e.x+=this._tempCenterPos.x,e.y+=this._tempCenterPos.y,e.z+=this._tempCenterPos.z)}getRigidbodyRelativeMatrix(t,e,i,s){if(s===void 0&&(s=Zp._matricesBuffer,s.length=0),t===e){const r=ai(t,this._tempPosition);i.makeScale(r.x,r.y,r.z);for(let o=s.length-1;o>=0;o--)i.multiply(s[o]);return i}return s.push(t.matrix),t.parent&&this.getRigidbodyRelativeMatrix(t.parent,e,i,s),i}addFixedJoint(t,e){if(!this.world){console.error("Physics world not initialized");return}const i=t[bs],s=e[bs];this.calculateJointRelativeMatrices(t.gameObject,e.gameObject,this._tempMatrix),this._tempMatrix.decompose(this._tempPosition,this._tempQuaternion,this._tempScale);const r=ol.fixed(Zp.centerConnectionPos,Zp.centerConnectionRot,this._tempPosition,this._tempQuaternion),o=this.world.createImpulseJoint(r,i,s,!0);En&&console.log("ADD FIXED JOINT",o)}addHingeJoint(t,e,i,s){if(!this.world){console.error("Physics world not initialized");return}const r=t[bs],o=e[bs];this.calculateJointRelativeMatrices(t.gameObject,e.gameObject,this._tempMatrix),this._tempMatrix.decompose(this._tempPosition,this._tempQuaternion,this._tempScale);const a=sh.JointData.revolute(i,this._tempPosition,s),l=this.world.createImpulseJoint(a,r,o,!0);En&&console.log("ADD HINGE JOINT",l)}calculateJointRelativeMatrices(t,e,i){t.updateWorldMatrix(!0,!1),e.updateWorldMatrix(!0,!1);const s=t.matrixWorld,r=e.matrixWorld;s.elements[0]=1,s.elements[5]=1,s.elements[10]=1,r.elements[0]=1,r.elements[5]=1,r.elements[10]=1,i.copy(r).premultiply(s.invert()).invert()}};let Pu=Zp;c(Pu,"_didLoadPhysicsEngine",!1),c(Pu,"_matricesBuffer",[]),c(Pu,"centerConnectionPos",{x:0,y:0,z:0}),c(Pu,"centerConnectionRot",{x:0,y:0,z:0,w:1});class tq{constructor(t,e){c(this,"world");c(this,"eventQueue");c(this,"activeCollisions",[]);c(this,"activeCollisionsStay",[]);c(this,"activeTriggers",[]);this.world=t,this.eventQueue=e}handleCollisionEvents(){this.eventQueue&&this.world&&this.eventQueue.drainCollisionEvents((t,e,i)=>{const s=this.world.getCollider(t),r=this.world.getCollider(e);if(!s||!r)return;const o=s[js],a=r[js];v_&&console.log("EVT",o.name,a.name,i,s,r),o&&a&&(i?(this.onCollisionStarted(o,s,a,r),this.onCollisionStarted(a,r,o,s)):(this.onCollisionEnded(o,a),this.onCollisionEnded(a,o)))})}update(){this.onHandleCollisionStay()}onCollisionStarted(t,e,i,s){let r=null;if(t.isTrigger||i.isTrigger)Fd(t.gameObject,o=>{o.onTriggerEnter&&!o.destroyed&&o.onTriggerEnter(i),this.activeTriggers.push({collider:t,component:o,otherCollider:i})});else{const o=t.gameObject;this.world.contactPair(e,s,(a,l)=>{Fd(o,h=>{var d;if(h.destroyed)return;const u=h.onCollisionEnter||h.onCollisionStay||h.onCollisionExit;if(u||v_){if(!r){const f=[],p=a.normal();for(let g=0;g<a.numSolverContacts();g++){const m=a.solverContactPoint(g),v=a.contactImpulse(g);if(m){const y=a.contactDist(g),b=a.solverContactFriction(g),_=a.solverContactTangentVelocity(g),x=new J7(m,y,p,v,b,_);f.push(x),v_&&De.DrawDirection(m,p,16711680,3,!0)}}r=new Z7(o,i,f)}if(u){const f={collider:t,component:h,collision:r};this.activeCollisions.push(f),h.onCollisionStay&&this.activeCollisionsStay.push(f),(d=h.onCollisionEnter)==null||d.call(h,r)}}})})}}onHandleCollisionStay(){for(const t of this.activeCollisionsStay){const e=t.component;if(!e.destroyed&&e.activeAndEnabled&&e.onCollisionStay){if(t.collision.collider.destroyed)continue;const i=t.collision;e.onCollisionStay(i)}}for(const t of this.activeTriggers){const e=t.component;if(!e.destroyed&&e.activeAndEnabled&&e.onTriggerStay){const i=t.otherCollider;if(i.destroyed)continue;e.onTriggerStay(i)}}}onCollisionEnded(t,e){if(!(t.destroyed||e.destroyed)){for(let i=0;i<this.activeCollisions.length;i++){const s=this.activeCollisions[i],r=s.collider;if(r.destroyed||s.collision.collider.destroyed){this.activeCollisions.splice(i,1),i--;continue}if(r===t&&s.collision.collider===e){const o=s.component;if(this.activeCollisions.splice(i,1),i--,o.activeAndEnabled&&o.onCollisionExit){const a=s.collision;o.onCollisionExit(a)}}}for(let i=0;i<this.activeCollisionsStay.length;i++){const s=this.activeCollisionsStay[i],r=s.collider;if(r.destroyed||s.collision.collider.destroyed){this.activeCollisionsStay.splice(i,1),i--;continue}if(r===t&&s.collision.collider===e){const o=s.component;if(this.activeCollisionsStay.splice(i,1),i--,o.activeAndEnabled&&o.onCollisionExit){const a=s.collision;o.onCollisionExit(a)}}}for(let i=0;i<this.activeTriggers.length;i++){const s=this.activeTriggers[i],r=s.collider;if(r.destroyed||s.otherCollider.destroyed){this.activeTriggers.splice(i,1),i--;continue}if(r===t&&s.otherCollider===e){const o=s.component;if(this.activeTriggers.splice(i,1),i--,o.activeAndEnabled&&o.onTriggerExit){const a=s.otherCollider;o.onTriggerExit(a)}}}}}}function FX(n,t,e,i="image/webp",s){return iq({context:n,width:t,height:e,mimeType:i,camera:s})}function iq(n={mimeType:"image/png",transparent:!1}){n||(n={});let{context:t,width:e,height:i,camera:s}=n;const{mimeType:r}=n;if(!t&&(t=mt.Current,!t))return console.error("Can not save screenshot: No needle-engine context found or provided."),null;if(!s&&(s=t.mainCamera,!s))return console.error("No camera found"),null;const o=t.renderer.domElement.width,a=t.renderer.domElement.height;e||(e=o),i||(i=a);const l=window.devicePixelRatio||1;e/=l,i/=l,t.renderer.domElement.style.width=e+"px",t.renderer.domElement.style.height=i+"px";const h=t.renderer.getClearColor(new we);try{n!=null&&n.transparent&&t.renderer.setClearColor(0,0);const u=t.renderer.domElement;return t.renderer.setSize(e,i,!1),s instanceof xt&&t.updateAspect(s,e,i),t.renderNow(),u.toDataURL(r)}finally{t.renderer.setSize(o,a,!1),t.updateSize(),t.renderer.setClearColor(h)}return null}let Wf=null;function UX(n,t){if(n){if(!n.startsWith("data:image")){console.error("Can not save image: Data url is not an image",n);return}Wf||(Wf=document.createElement("a")),Wf.href=n,Wf.download=t,Wf.click()}}Object.defineProperty(xt.prototype,"fov",{get:function(){return this._fov},set:function(n){const t=n!==this._fov;this._fov=n,t&&this.view!==void 0&&this.updateProjectionMatrix()}});Object.defineProperty(xt.prototype,"near",{get:function(){return this._near},set:function(n){const t=n!==this._near;this._near=n,t&&this.view!==void 0&&this.updateProjectionMatrix()}});Object.defineProperty(xt.prototype,"far",{get:function(){return this._far},set:function(n){const t=n!==this._far;this._far=n,t&&this.view!==void 0&&this.updateProjectionMatrix()}});const Kv=N("debugmissingcamera");mt.registerCallback(yt.MissingCamera,n=>{var o,a,l;Kv&&console.warn("Creating missing camera");const t=n.context.scene,e=new xt;e.name="Default Fallback Camera",t.add(e);const i=new Bt;i.sourceId=((a=(o=n.files)==null?void 0:o[0])==null?void 0:a.src)??"unknown",(l=n.context.domElement.getAttribute("skybox-image"))!=null&&l.length||0>0||n.context.lightmaps.tryGetSkybox(i.sourceId)?i.clearFlags=Gr.Skybox:i.clearFlags=Gr.SolidColor,i.backgroundColor=new Ot(.5,.5,.5,1),i.fieldOfView=35,i.backgroundBlurriness=.2;const s=Sh(e,i,!0);e.position.x=0,e.position.y=1,e.position.z=2;const r=n.context.domElement;return(r==null?void 0:r.cameraControls)!=!1&&kO(n.context,s),s});mt.registerCallback(yt.ContextCreated,n=>{if(!n.context.mainCamera){Kv&&console.log("Will not auto-fit because a default camera exists");return}const t=n.context.domElement;if((t==null?void 0:t.cameraControls)==!0){const e=lN(n.context.mainCamera);if((e==null?void 0:e.isCameraController)==!0){Kv&&console.log("Will not auto-fit because a camera controller exists");return}kO(n.context)}});function kO(n,t){t=t??n.mainCameraComponent;const e=t==null?void 0:t.gameObject;if(Kv&&console.log("Creating default camera controls",t==null?void 0:t.name),e){const i=ky(e,Et);i.sourceId=(t==null?void 0:t.sourceId)??"unknown";const s=n.domElement.getAttribute("auto-rotate");i.autoRotate=s!==void 0&&(s===""||s==="true"),i.autoRotateSpeed=.5,i.autoFit=!0}else console.warn("Missing camera object, can not add orbit controls")}const SS={Context:Ne,glTF:{loadFromURL:gO}};globalThis.Needle!==void 0&&console.warn("Needle Engine is already imported");globalThis.Needle=SS;function OO(n){for(const t in n)SS[t]=n[t]}OO(h5);OO(x7);for(const n of Object.getOwnPropertyNames(z))switch(n){case"prototype":case"constructor":case"length":case"name":continue;default:SS[n]=z[n];break}globalThis.THREE?console.warn("Threejs is already imported"):globalThis.THREE=eL;export{LX as $physicsKey,At as ActionBuilder,oM as ActionCollection,ur as ActionModel,$8 as Addressables,Uy as AlignmentConstraint,ya as AmbientMode,Ps as Animation,Tl as AnimationCurve,Hy as AnimationExtension,IC as AnimationTrackHandler,zn as Animator,oc as AnimatorConditionMode,to as AnimatorController,Mw as AnimatorControllerParameterType,Km as AnimatorStateInfo,Wy as Antialiasing,vl as Application,Ch as ApplicationEvents,fz as AssetDatabase,it as AssetReference,Zh as AudioExtension,Rh as AudioListener,kt as AudioSource,bd as AudioTrackHandler,Yd as Avatar,Jd as AvatarBlink_Simple,Bc as AvatarEyeLook_Rotation,dk as AvatarLoader,un as AvatarMarker,DC as AvatarModel,Bv as Avatar_Brain_LookAt,Yy as Avatar_MouthShapes,uk as Avatar_MustacheShake,bl as Avatar_POI,Yu as Axes,Vg as AxesHelper,mP as BUILD_TIME,Fo as BaseUIComponent,fk as BasicIKConstraint,OC as BehaviorExtension,Ki as BehaviorModel,se as Behaviour,_l as Bloom,qg as BoxCollider,$d as BoxGizmo,So as BoxHelperComponent,jc as Button,Sa as ButtonsFactory,dc as CallDirection,_g as CallInfo,Bt as Camera,Iv as CameraTargetReachedEvent,fn as Canvas,zh as CanvasGroup,Oc as CapsuleCollider,gl as ChangeMaterialOnClick,ef as ChangeTransformOnClick,tf as CharacterController,Hc as CharacterControllerInput,t0 as ChromaticAberration,ko as CircularBuffer,Gr as ClearFlags,na as ClipExtrapolation,ro as Collider,Z7 as Collision,Cv as CollisionDetectionMode,eu as ColorAdjustments,nf as ColorBySpeedModule,r0 as ColorOverLifetimeModule,se as Component,gg as ComponentEvents,Ey as ComponentLifecycleEvents,xw as ConnectionEvents,J7 as ContactPoint,Mo as ContactShadows,Ne as Context,lX as ContextArgs,yt as ContextEvent,mt as ContextRegistry,TC as ControlTrackHandler,su as CustomBranding,kr as CustomShader,yg as DefaultReflectionMode,Nk as Deletable,qC as DeleteBox,Ha as DepthOfField,XC as DeviceFlag,Qk as DocumentExtension,Is as DragControls,Vs as DragMode,u0 as DropListener,af as Duplicatable,ll as EXTENSION_NAME,Ol as EmissionModule,Zg as EmphasizeOnClick,RA as EngineLoadingView,dn as EventList,xC as EventListEvent,pr as EventSystem,$C as EventTrigger,Dk as FieldWithDefault,wp as FileReference,nG as FileReferenceSerializer,BV as FileSpawnModel,Qv as File_Event,jk as FixedJoint,Gk as FlyControls,im as Fog,ze as FrameEvent,Vx as GENERATOR,z as GameObject,De as Gizmos,_a as GltfExport,Wk as GltfExportBox,Sd as GltfLoadEvent,Mc as GltfLoadEventType,tu as Gradient,wl as Graphic,CC as GraphicRaycaster,ia as Graphics,nm as GridHelper,bk as GridLayoutGroup,lf as GroundProjectedEnv,ph as GroupActionModel,_I as HideFlags,_k as HideOnStart,f0 as HingeJoint,yk as HorizontalLayoutGroup,cX as HostData,Kg as Image,_p as ImageReference,iG as ImageReferenceSerializer,Ll as InheritVelocityModule,gG as Input,fa as InputEventQueue,at as InputEvents,Wr as InputField,wd as InstanceHandle,_d as InstancingHandler,Bo as InstancingUtil,Nh as InstantiateEvent,Qn as InstantiateIdProvider,za as InstantiateOptions,Uk as Interactable,iX as JoinedRoomResponse,$q as KeyEventArgs,Qo as Keyframe,m0 as LODGroup,cf as LODModel,cc as LODsManager,nX as LeftRoomResponse,wr as Light,k6 as LightData,Ji as LimitVelocityOverLifetimeModule,Cq as LoadingElementOptions,qk as LogStats,Ui as LogType,xl as LookAt,Xd as LookAtConstraint,ls as MainModule,Pw as MarkerType,Jy as MaskableGraphic,Ae as Mathf,Zd as MeshCollider,s0 as MeshRenderer,Se as MinMaxCurve,Un as MinMaxGradient,ct as NEEDLE_progressive,km as NEKeyboardEvent,tc as NEPointerEvent,mt as NeedleEngine,bO as NeedleEngineHTMLElement,hO as NeedleGltfLoader,Fl as NeedleMenu,bb as NeedlePatchesKey,HQ as NeedleUSDZExporter,WM as NeedleXRController,Me as NeedleXRSession,c6 as NeedleXRSync,m6 as NeedleXRUtils,rS as NestedGltf,l6 as NetworkConnection,xi as NetworkedStreamEvents,Xy as NetworkedStreams,Bl as Networking,W6 as NewInstanceModel,Lt as NoiseModule,no as ObjectRaycaster,Py as ObjectUtils,hf as OffsetConstraint,H0 as OneEuroFilter,rP as OneEuroFilterXYZ,rm as OpenURL,Et as OrbitControls,Xg as Outline,Zn as OwnershipEvent,UD as OwnershipModel,$h as Padding,Ov as ParticleBurst,fS as ParticleSubEmitter,gi as ParticleSystem,au as ParticleSystemBaseBehaviour,Ho as ParticleSystemRenderer,xs as ParticleSystemShapeType,Bp as PeerHandle,r6 as PeerNetworking,x6 as Physics,HC as PhysicsExtension,rn as PhysicsMaterialCombine,S0 as PixelationEffect,Ia as PlayAnimationOnClick,jh as PlayAudioOnClick,Rc as PlayableDirector,Eg as PlayerColor,ns as PlayerState,Ow as PlayerStateEvent,Hg as PlayerSync,S6 as PlayerView,E6 as PlayerViewManager,zg as PointerEventData,yc as PointerType,Ds as PostProcessingEffect,zC as PostProcessingHandler,$g as PreliminaryAction,$y as PreliminaryTrigger,Da as PrimitiveType,st as Progress,vx as PromiseAllWithErrors,ZS as PromiseErrorResult,Ot as RGBAColor,Pu as RapierPhysics,NC as RawImage,Lo as RaycastOptions,mk as Rect,jn as RectTransform,ml as ReflectionProbe,RC as RegisteredAnimationInfo,Pl as RemoteSkybox,Ih as RenderTexture,S5 as RenderTextureSerializer,ci as Renderer,D6 as RendererData,Mv as RendererLightmap,Pt as Rigidbody,Ii as RigidbodyConstraints,Ye as RoomEvents,oo as RotationBySpeedModule,jo as RotationOverLifetimeModule,Fw as SceneLightSettings,Os as SceneSwitcher,lu as ScreenCapture,Wc as ScreenSpaceAmbientOcclusion,Wa as ScreenSpaceAmbientOcclusionN8,jr as SendQueue,FM as SerializationContext,Vr as SetActiveOnClick,E0 as ShadowCatcher,Xt as ShapeModule,zy as SignalAsset,Tc as SignalReceiver,Gg as SignalReceiverEvent,Tv as SignalTrackHandler,gk as Size,Zs as SizeBySpeedModule,iu as SizeOverLifetimeModule,kk as SkinnedMeshRenderer,ka as SmoothFollow,Sv as SpatialGrabRaycaster,T0 as SpatialHtml,kh as SpatialTrigger,Cl as SpatialTriggerReceiver,gS as SpectatorCamera,Wg as SphereCollider,w6 as SphereIntersection,$7 as SphereOverlapResult,Vc as Sprite,tm as SpriteData,Go as SpriteRenderer,o0 as SpriteSheet,_X as StateMachineBehaviour,sH as StreamEndedEvent,rH as StreamReceivedEvent,Wv as SubEmitterSystem,Cd as SyncedCamera,qc as SyncedRoom,Qh as SyncedTransform,wk as TapGestureTrigger,GC as TeleportTarget,rO as TestRunner,oO as TestSimulateUserData,ks as Text,VC as TextBuilder,c0 as TextExtension,cs as TextureSheetAnimationModule,Nl as TiltShiftEffect,O6 as Time,R0 as ToneMapping,jy as TrackHandler,rr as TrackType,Ai as TrailModule,Yi as TransformData,gf as TransformGizmo,Ln as TriggerBuilder,Ic as TriggerModel,D as TypeStore,SC as UIRaycastUtils,Ny as UIRootComponent,rs as USDObject,jQ as USDWriter,li as USDZExporter,Ah as USDZText,WC as USDZUIExtension,I1 as Upload_Result,E5 as UriSerializer,h0 as UsageMarker,sX as UserJoinedOrLeftRoomModel,Eo as VERSION,rM as VariantAction,Si as VelocityOverLifetimeModule,vk as VerticalLayoutGroup,pn as VideoPlayer,yl as ViewDevice,mf as Vignette,e0 as VisibilityAction,Kd as Voip,i0 as Volume,je as VolumeParameter,Vy as VolumeProfile,rX as WaitForFrames,v6 as WaitForPromise,A6 as WaitForSeconds,xc as Watch,AS as WebARCameraBackground,Xs as WebARSessionRoot,l0 as WebXR,Dh as WebXRButtonFactory,Pc as WebXRImageTracking,Ql as WebXRImageTrackingModel,uu as WebXRPlaneTracking,vh as WebXRTrackedImage,P0 as XRControllerFollow,Rl as XRControllerModel,Uo as XRControllerMovement,Dn as XRFlag,vS as XRRig,ss as XRState,Kr as XRStateFlag,cO as __Ignore,gz as __internalNotifyObjectDestroyed,Cc as activeInHierarchyFieldName,uL as addAttributeChangeCallback,Eh as addComponent,CX as addCustomExtensionPlugin,UP as addDracoAndKTX2Loaders,PV as addFile,MV as addFileFromUrl,RX as addGltfLoadEventListener,Sh as addNewComponent,Zx as addPatch,bC as apply,kX as applyHMRChanges,V6 as beginListenDestroy,DV as beginListenFileSpawn,q6 as beginListenInstantiate,qM as binaryIdentifierCasts,aX as build_scene_functions,Du as builtinComponentKeyName,yP as calculateProgress01,Aq as clearBalloonMessages,Aq as clearOverlayMessages,yX as colorSerializer,Lb as componentSerializer,yN as copyTexture,pO as createLoader,FP as createLoaders,N5 as createMotion,Qs as debugNet,zm as debugOwner,dy as deepClone,El as delay,rL as delayForFrames,ow as deserializeObject,Ua as destroy,l5 as destroyComponentInstance,Jt as disposeObjectResources,_c as disposeStream,Z8 as download,GM as download_file,TA as editorGuidKeyName,jI as effectsOrder,dg as enableSpatialConsole,bX as eventListSerializer,Dy as findByGuid,tk as findObjectOfType,c5 as findObjectsOfType,fM as findResourceUsers,Fd as foreachComponent,XD as foreachComponentEnumerator,bq as forward,pL as generateQRCode,vC as generateSeed,dP as getBoundingBox,lN as getCameraController,qd as getComponent,Ly as getComponentInChildren,xv as getComponentInParent,Oy as getComponents,Fy as getComponentsInChildren,_C as getComponentsInParent,QQ as getFormattedDate,Xr as getIconElement,AI as getIconTexture,pq as getIp,gq as getIpAndLocation,fq as getIpCloudflare,La as getLoader,ky as getOrAddComponent,N as getParam,_q as getParentHierarchyPath,dq as getPath,eX as getPeerOptions,s6 as getPeerjsInstance,Dg as getRaycastMesh,Vq as getResourceUserCount,Gu as getTempQuaternion,Pi as getTempVector,uy as getUrlParams,lP as getWorldDirection,cP as getWorldEuler,qe as getWorldPosition,Nt as getWorldQuaternion,vy as getWorldRotation,ai as getWorldScale,Sc as hasCommercialLicense,AP as hasIndieLicense,BI as hasPointerEventComponent,_h as hasProLicense,jM as hash,YQ as imageToCanvas,Qg as instantiate,Pk as invokeAfterImportPluginHooks,rG as invokeXRSessionEnd,sG as invokeXRSessionStart,J6 as isActiveInHierarchy,Ng as isActiveSelf,lL as isAndroidDevice,vN as isAnimationAction,lq as isDebugMode,Id as isDesktop,Ld as isDestroyed,xe as isDevEnvironment,Hq as isDisposed,tL as isHostedOnGlitch,PX as isHotReloading,L6 as isIconElement,qs as isLocalNetwork,No as isMobileDevice,md as isMozillaXR,Ax as isQuest,pz as isResourceTrackingEnabled,dp as isSafari,yC as isUsingInstancing,Td as isiOS,gO as loadSync,F_ as logHierarchy,yq as lookAtInverse,Ay as lookAtObject,hq as makeId,rB as makeIdFromRandomWords,Fa as makeNameSafeForUSD,Z6 as markAsInstancedRendered,JS as microphonePermissionsGranted,aq as nameof,iL as nameofFactory,_5 as objectSerializer,Yq as offXRSessionEnd,Xq as offXRSessionStart,AX as onAfterRender,mX as onBeforeRender,fX as onClear,pX as onDestroy,dX as onInitialized,gX as onStart,p5 as onUpdate,HM as onXRSessionEnd,aC as onXRSessionStart,B7 as parseSync,W4 as patchModelViewer,vX as prefix,nL as pushState,uq as randomNumber,XM as registerBinaryType,mC as registerComponent,Rk as registerComponentExtension,zo as registerCustomEffectType,WH as registerExportExtensions,Bk as registerExtensions,MX as registerHotReloadType,nB as registerLoader,Y6 as registerPrefabProvider,Nq as registerType,oL as relativePathPrefix,dL as removeAttributeChangeCallback,ZD as removeComponent,SX as removeCustomImportExtensionType,BX as removeGltfLoadEventListener,jq as removePatch,qh as resolveUrl,sL as sanitizeString,UX as saveImage,FX as screenshot,iq as screenshot2,H6 as sendDestroyed,A as serializable,N8 as serializeObject,kg as serializeable,jA as setActive,AL as setAllowBalloonMessages,mq as setAllowOverlayMessages,fE as setAutoFitEnabled,dE as setCameraController,$6 as setDestroyed,xq as setDevEnvironment,uM as setDisposable,wI as setDontDestroy,n4 as setDracoDecoderLocation,s4 as setKTX2TranscoderLocation,XS as setOrAddParamsToUrl,cq as setParam,R_ as setParamWithoutReload,tX as setPeerOptions,z4 as setRaycastMesh,Gq as setResourceTrackingEnabled,sB as setState,hP as setWorldEuler,Ts as setWorldPosition,Pd as setWorldPositionXYZ,Oo as setWorldQuaternion,aP as setWorldQuaternionXYZW,uP as setWorldRotation,yy as setWorldRotationXYZ,lv as setWorldScale,pP as showBalloonError,Ci as showBalloonMessage,Yt as showBalloonWarning,fB as showDebugConsole,vq as slerp,AC as syncDestroy,ak as syncField,HD as syncInstantiate,wq as textureToCanvas,_G as tryCastBinary,rg as tryFindObject,wG as tryGetGuid,DX as unregisterHotReloadType,oB as unwatchWrite,J8 as upload_file,cN as useForAutoFit,Uq as useNeedleProgressive,Fq as useRaycastMeshes,as as validate,mx as watchWrite};
